function xie(l,a){for(var h=0;h<a.length;h++){const _=a[h];if(typeof _!="string"&&!Array.isArray(_)){for(const S in _)if(S!=="default"&&!(S in l)){const y=Object.getOwnPropertyDescriptor(_,S);y&&Object.defineProperty(l,S,y.get?y:{enumerable:!0,get:()=>_[S]})}}}return Object.freeze(Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}))}(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const S of document.querySelectorAll('link[rel="modulepreload"]'))_(S);new MutationObserver(S=>{for(const y of S)if(y.type==="childList")for(const b of y.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&_(b)}).observe(document,{childList:!0,subtree:!0});function h(S){const y={};return S.integrity&&(y.integrity=S.integrity),S.referrerPolicy&&(y.referrerPolicy=S.referrerPolicy),S.crossOrigin==="use-credentials"?y.credentials="include":S.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function _(S){if(S.ep)return;S.ep=!0;const y=h(S);fetch(S.href,y)}})();var sq=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function L7(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var oq={exports:{}},vj={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wJ;function Vie(){if(wJ)return vj;wJ=1;var l=Symbol.for("react.transitional.element"),a=Symbol.for("react.fragment");function h(_,S,y){var b=null;if(y!==void 0&&(b=""+y),S.key!==void 0&&(b=""+S.key),"key"in S){y={};for(var D in S)D!=="key"&&(y[D]=S[D])}else y=S;return S=y.ref,{$$typeof:l,type:_,key:b,ref:S!==void 0?S:null,props:y}}return vj.Fragment=a,vj.jsx=h,vj.jsxs=h,vj}var OJ;function Fie(){return OJ||(OJ=1,oq.exports=Vie()),oq.exports}var ze=Fie(),aq={exports:{}},nr={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var NJ;function Bie(){if(NJ)return nr;NJ=1;var l=Symbol.for("react.transitional.element"),a=Symbol.for("react.portal"),h=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),y=Symbol.for("react.consumer"),b=Symbol.for("react.context"),D=Symbol.for("react.forward_ref"),U=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),q=Symbol.for("react.lazy"),J=Symbol.iterator;function ee(xe){return xe===null||typeof xe!="object"?null:(xe=J&&xe[J]||xe["@@iterator"],typeof xe=="function"?xe:null)}var ue={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},oe=Object.assign,le={};function pe(xe,it,ft){this.props=xe,this.context=it,this.refs=le,this.updater=ft||ue}pe.prototype.isReactComponent={},pe.prototype.setState=function(xe,it){if(typeof xe!="object"&&typeof xe!="function"&&xe!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,xe,it,"setState")},pe.prototype.forceUpdate=function(xe){this.updater.enqueueForceUpdate(this,xe,"forceUpdate")};function Ne(){}Ne.prototype=pe.prototype;function Ve(xe,it,ft){this.props=xe,this.context=it,this.refs=le,this.updater=ft||ue}var Ae=Ve.prototype=new Ne;Ae.constructor=Ve,oe(Ae,pe.prototype),Ae.isPureReactComponent=!0;var Ue=Array.isArray,ke={H:null,A:null,T:null,S:null,V:null},qe=Object.prototype.hasOwnProperty;function Te(xe,it,ft,pt,xt,ln){return ft=ln.ref,{$$typeof:l,type:xe,key:it,ref:ft!==void 0?ft:null,props:ln}}function he(xe,it){return Te(xe.type,it,void 0,void 0,void 0,xe.props)}function _e(xe){return typeof xe=="object"&&xe!==null&&xe.$$typeof===l}function ye(xe){var it={"=":"=0",":":"=2"};return"$"+xe.replace(/[=:]/g,function(ft){return it[ft]})}var Ie=/\/+/g;function $(xe,it){return typeof xe=="object"&&xe!==null&&xe.key!=null?ye(""+xe.key):it.toString(36)}function me(){}function Xe(xe){switch(xe.status){case"fulfilled":return xe.value;case"rejected":throw xe.reason;default:switch(typeof xe.status=="string"?xe.then(me,me):(xe.status="pending",xe.then(function(it){xe.status==="pending"&&(xe.status="fulfilled",xe.value=it)},function(it){xe.status==="pending"&&(xe.status="rejected",xe.reason=it)})),xe.status){case"fulfilled":return xe.value;case"rejected":throw xe.reason}}throw xe}function ct(xe,it,ft,pt,xt){var ln=typeof xe;(ln==="undefined"||ln==="boolean")&&(xe=null);var pn=!1;if(xe===null)pn=!0;else switch(ln){case"bigint":case"string":case"number":pn=!0;break;case"object":switch(xe.$$typeof){case l:case a:pn=!0;break;case q:return pn=xe._init,ct(pn(xe._payload),it,ft,pt,xt)}}if(pn)return xt=xt(xe),pn=pt===""?"."+$(xe,0):pt,Ue(xt)?(ft="",pn!=null&&(ft=pn.replace(Ie,"$&/")+"/"),ct(xt,it,ft,"",function(si){return si})):xt!=null&&(_e(xt)&&(xt=he(xt,ft+(xt.key==null||xe&&xe.key===xt.key?"":(""+xt.key).replace(Ie,"$&/")+"/")+pn)),it.push(xt)),1;pn=0;var Zn=pt===""?".":pt+":";if(Ue(xe))for(var ri=0;ri<xe.length;ri++)pt=xe[ri],ln=Zn+$(pt,ri),pn+=ct(pt,it,ft,ln,xt);else if(ri=ee(xe),typeof ri=="function")for(xe=ri.call(xe),ri=0;!(pt=xe.next()).done;)pt=pt.value,ln=Zn+$(pt,ri++),pn+=ct(pt,it,ft,ln,xt);else if(ln==="object"){if(typeof xe.then=="function")return ct(Xe(xe),it,ft,pt,xt);throw it=String(xe),Error("Objects are not valid as a React child (found: "+(it==="[object Object]"?"object with keys {"+Object.keys(xe).join(", ")+"}":it)+"). If you meant to render a collection of children, use an array instead.")}return pn}function Me(xe,it,ft){if(xe==null)return xe;var pt=[],xt=0;return ct(xe,pt,"","",function(ln){return it.call(ft,ln,xt++)}),pt}function Je(xe){if(xe._status===-1){var it=xe._result;it=it(),it.then(function(ft){(xe._status===0||xe._status===-1)&&(xe._status=1,xe._result=ft)},function(ft){(xe._status===0||xe._status===-1)&&(xe._status=2,xe._result=ft)}),xe._status===-1&&(xe._status=0,xe._result=it)}if(xe._status===1)return xe._result.default;throw xe._result}var mt=typeof reportError=="function"?reportError:function(xe){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var it=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof xe=="object"&&xe!==null&&typeof xe.message=="string"?String(xe.message):String(xe),error:xe});if(!window.dispatchEvent(it))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",xe);return}console.error(xe)};function yt(){}return nr.Children={map:Me,forEach:function(xe,it,ft){Me(xe,function(){it.apply(this,arguments)},ft)},count:function(xe){var it=0;return Me(xe,function(){it++}),it},toArray:function(xe){return Me(xe,function(it){return it})||[]},only:function(xe){if(!_e(xe))throw Error("React.Children.only expected to receive a single React element child.");return xe}},nr.Component=pe,nr.Fragment=h,nr.Profiler=S,nr.PureComponent=Ve,nr.StrictMode=_,nr.Suspense=U,nr.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ke,nr.__COMPILER_RUNTIME={__proto__:null,c:function(xe){return ke.H.useMemoCache(xe)}},nr.cache=function(xe){return function(){return xe.apply(null,arguments)}},nr.cloneElement=function(xe,it,ft){if(xe==null)throw Error("The argument must be a React element, but you passed "+xe+".");var pt=oe({},xe.props),xt=xe.key,ln=void 0;if(it!=null)for(pn in it.ref!==void 0&&(ln=void 0),it.key!==void 0&&(xt=""+it.key),it)!qe.call(it,pn)||pn==="key"||pn==="__self"||pn==="__source"||pn==="ref"&&it.ref===void 0||(pt[pn]=it[pn]);var pn=arguments.length-2;if(pn===1)pt.children=ft;else if(1<pn){for(var Zn=Array(pn),ri=0;ri<pn;ri++)Zn[ri]=arguments[ri+2];pt.children=Zn}return Te(xe.type,xt,void 0,void 0,ln,pt)},nr.createContext=function(xe){return xe={$$typeof:b,_currentValue:xe,_currentValue2:xe,_threadCount:0,Provider:null,Consumer:null},xe.Provider=xe,xe.Consumer={$$typeof:y,_context:xe},xe},nr.createElement=function(xe,it,ft){var pt,xt={},ln=null;if(it!=null)for(pt in it.key!==void 0&&(ln=""+it.key),it)qe.call(it,pt)&&pt!=="key"&&pt!=="__self"&&pt!=="__source"&&(xt[pt]=it[pt]);var pn=arguments.length-2;if(pn===1)xt.children=ft;else if(1<pn){for(var Zn=Array(pn),ri=0;ri<pn;ri++)Zn[ri]=arguments[ri+2];xt.children=Zn}if(xe&&xe.defaultProps)for(pt in pn=xe.defaultProps,pn)xt[pt]===void 0&&(xt[pt]=pn[pt]);return Te(xe,ln,void 0,void 0,null,xt)},nr.createRef=function(){return{current:null}},nr.forwardRef=function(xe){return{$$typeof:D,render:xe}},nr.isValidElement=_e,nr.lazy=function(xe){return{$$typeof:q,_payload:{_status:-1,_result:xe},_init:Je}},nr.memo=function(xe,it){return{$$typeof:x,type:xe,compare:it===void 0?null:it}},nr.startTransition=function(xe){var it=ke.T,ft={};ke.T=ft;try{var pt=xe(),xt=ke.S;xt!==null&&xt(ft,pt),typeof pt=="object"&&pt!==null&&typeof pt.then=="function"&&pt.then(yt,mt)}catch(ln){mt(ln)}finally{ke.T=it}},nr.unstable_useCacheRefresh=function(){return ke.H.useCacheRefresh()},nr.use=function(xe){return ke.H.use(xe)},nr.useActionState=function(xe,it,ft){return ke.H.useActionState(xe,it,ft)},nr.useCallback=function(xe,it){return ke.H.useCallback(xe,it)},nr.useContext=function(xe){return ke.H.useContext(xe)},nr.useDebugValue=function(){},nr.useDeferredValue=function(xe,it){return ke.H.useDeferredValue(xe,it)},nr.useEffect=function(xe,it,ft){var pt=ke.H;if(typeof ft=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return pt.useEffect(xe,it)},nr.useId=function(){return ke.H.useId()},nr.useImperativeHandle=function(xe,it,ft){return ke.H.useImperativeHandle(xe,it,ft)},nr.useInsertionEffect=function(xe,it){return ke.H.useInsertionEffect(xe,it)},nr.useLayoutEffect=function(xe,it){return ke.H.useLayoutEffect(xe,it)},nr.useMemo=function(xe,it){return ke.H.useMemo(xe,it)},nr.useOptimistic=function(xe,it){return ke.H.useOptimistic(xe,it)},nr.useReducer=function(xe,it,ft){return ke.H.useReducer(xe,it,ft)},nr.useRef=function(xe){return ke.H.useRef(xe)},nr.useState=function(xe){return ke.H.useState(xe)},nr.useSyncExternalStore=function(xe,it,ft){return ke.H.useSyncExternalStore(xe,it,ft)},nr.useTransition=function(){return ke.H.useTransition()},nr.version="19.1.1",nr}var DJ;function M7(){return DJ||(DJ=1,aq.exports=Bie()),aq.exports}var ae=M7();const mE=L7(ae),Wq=xie({__proto__:null,default:mE},[ae]);var cq={exports:{}},yj={},lq={exports:{}},dq={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var PJ;function jie(){return PJ||(PJ=1,(function(l){function a(Me,Je){var mt=Me.length;Me.push(Je);e:for(;0<mt;){var yt=mt-1>>>1,xe=Me[yt];if(0<S(xe,Je))Me[yt]=Je,Me[mt]=xe,mt=yt;else break e}}function h(Me){return Me.length===0?null:Me[0]}function _(Me){if(Me.length===0)return null;var Je=Me[0],mt=Me.pop();if(mt!==Je){Me[0]=mt;e:for(var yt=0,xe=Me.length,it=xe>>>1;yt<it;){var ft=2*(yt+1)-1,pt=Me[ft],xt=ft+1,ln=Me[xt];if(0>S(pt,mt))xt<xe&&0>S(ln,pt)?(Me[yt]=ln,Me[xt]=mt,yt=xt):(Me[yt]=pt,Me[ft]=mt,yt=ft);else if(xt<xe&&0>S(ln,mt))Me[yt]=ln,Me[xt]=mt,yt=xt;else break e}}return Je}function S(Me,Je){var mt=Me.sortIndex-Je.sortIndex;return mt!==0?mt:Me.id-Je.id}if(l.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var y=performance;l.unstable_now=function(){return y.now()}}else{var b=Date,D=b.now();l.unstable_now=function(){return b.now()-D}}var U=[],x=[],q=1,J=null,ee=3,ue=!1,oe=!1,le=!1,pe=!1,Ne=typeof setTimeout=="function"?setTimeout:null,Ve=typeof clearTimeout=="function"?clearTimeout:null,Ae=typeof setImmediate<"u"?setImmediate:null;function Ue(Me){for(var Je=h(x);Je!==null;){if(Je.callback===null)_(x);else if(Je.startTime<=Me)_(x),Je.sortIndex=Je.expirationTime,a(U,Je);else break;Je=h(x)}}function ke(Me){if(le=!1,Ue(Me),!oe)if(h(U)!==null)oe=!0,qe||(qe=!0,$());else{var Je=h(x);Je!==null&&ct(ke,Je.startTime-Me)}}var qe=!1,Te=-1,he=5,_e=-1;function ye(){return pe?!0:!(l.unstable_now()-_e<he)}function Ie(){if(pe=!1,qe){var Me=l.unstable_now();_e=Me;var Je=!0;try{e:{oe=!1,le&&(le=!1,Ve(Te),Te=-1),ue=!0;var mt=ee;try{t:{for(Ue(Me),J=h(U);J!==null&&!(J.expirationTime>Me&&ye());){var yt=J.callback;if(typeof yt=="function"){J.callback=null,ee=J.priorityLevel;var xe=yt(J.expirationTime<=Me);if(Me=l.unstable_now(),typeof xe=="function"){J.callback=xe,Ue(Me),Je=!0;break t}J===h(U)&&_(U),Ue(Me)}else _(U);J=h(U)}if(J!==null)Je=!0;else{var it=h(x);it!==null&&ct(ke,it.startTime-Me),Je=!1}}break e}finally{J=null,ee=mt,ue=!1}Je=void 0}}finally{Je?$():qe=!1}}}var $;if(typeof Ae=="function")$=function(){Ae(Ie)};else if(typeof MessageChannel<"u"){var me=new MessageChannel,Xe=me.port2;me.port1.onmessage=Ie,$=function(){Xe.postMessage(null)}}else $=function(){Ne(Ie,0)};function ct(Me,Je){Te=Ne(function(){Me(l.unstable_now())},Je)}l.unstable_IdlePriority=5,l.unstable_ImmediatePriority=1,l.unstable_LowPriority=4,l.unstable_NormalPriority=3,l.unstable_Profiling=null,l.unstable_UserBlockingPriority=2,l.unstable_cancelCallback=function(Me){Me.callback=null},l.unstable_forceFrameRate=function(Me){0>Me||125<Me?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):he=0<Me?Math.floor(1e3/Me):5},l.unstable_getCurrentPriorityLevel=function(){return ee},l.unstable_next=function(Me){switch(ee){case 1:case 2:case 3:var Je=3;break;default:Je=ee}var mt=ee;ee=Je;try{return Me()}finally{ee=mt}},l.unstable_requestPaint=function(){pe=!0},l.unstable_runWithPriority=function(Me,Je){switch(Me){case 1:case 2:case 3:case 4:case 5:break;default:Me=3}var mt=ee;ee=Me;try{return Je()}finally{ee=mt}},l.unstable_scheduleCallback=function(Me,Je,mt){var yt=l.unstable_now();switch(typeof mt=="object"&&mt!==null?(mt=mt.delay,mt=typeof mt=="number"&&0<mt?yt+mt:yt):mt=yt,Me){case 1:var xe=-1;break;case 2:xe=250;break;case 5:xe=1073741823;break;case 4:xe=1e4;break;default:xe=5e3}return xe=mt+xe,Me={id:q++,callback:Je,priorityLevel:Me,startTime:mt,expirationTime:xe,sortIndex:-1},mt>yt?(Me.sortIndex=mt,a(x,Me),h(U)===null&&Me===h(x)&&(le?(Ve(Te),Te=-1):le=!0,ct(ke,mt-yt))):(Me.sortIndex=xe,a(U,Me),oe||ue||(oe=!0,qe||(qe=!0,$()))),Me},l.unstable_shouldYield=ye,l.unstable_wrapCallback=function(Me){var Je=ee;return function(){var mt=ee;ee=Je;try{return Me.apply(this,arguments)}finally{ee=mt}}}})(dq)),dq}var kJ;function Gie(){return kJ||(kJ=1,lq.exports=jie()),lq.exports}var uq={exports:{}},jd={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var LJ;function Wie(){if(LJ)return jd;LJ=1;var l=M7();function a(U){var x="https://react.dev/errors/"+U;if(1<arguments.length){x+="?args[]="+encodeURIComponent(arguments[1]);for(var q=2;q<arguments.length;q++)x+="&args[]="+encodeURIComponent(arguments[q])}return"Minified React error #"+U+"; visit "+x+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function h(){}var _={d:{f:h,r:function(){throw Error(a(522))},D:h,C:h,L:h,m:h,X:h,S:h,M:h},p:0,findDOMNode:null},S=Symbol.for("react.portal");function y(U,x,q){var J=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:S,key:J==null?null:""+J,children:U,containerInfo:x,implementation:q}}var b=l.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function D(U,x){if(U==="font")return"";if(typeof x=="string")return x==="use-credentials"?x:""}return jd.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=_,jd.createPortal=function(U,x){var q=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!x||x.nodeType!==1&&x.nodeType!==9&&x.nodeType!==11)throw Error(a(299));return y(U,x,null,q)},jd.flushSync=function(U){var x=b.T,q=_.p;try{if(b.T=null,_.p=2,U)return U()}finally{b.T=x,_.p=q,_.d.f()}},jd.preconnect=function(U,x){typeof U=="string"&&(x?(x=x.crossOrigin,x=typeof x=="string"?x==="use-credentials"?x:"":void 0):x=null,_.d.C(U,x))},jd.prefetchDNS=function(U){typeof U=="string"&&_.d.D(U)},jd.preinit=function(U,x){if(typeof U=="string"&&x&&typeof x.as=="string"){var q=x.as,J=D(q,x.crossOrigin),ee=typeof x.integrity=="string"?x.integrity:void 0,ue=typeof x.fetchPriority=="string"?x.fetchPriority:void 0;q==="style"?_.d.S(U,typeof x.precedence=="string"?x.precedence:void 0,{crossOrigin:J,integrity:ee,fetchPriority:ue}):q==="script"&&_.d.X(U,{crossOrigin:J,integrity:ee,fetchPriority:ue,nonce:typeof x.nonce=="string"?x.nonce:void 0})}},jd.preinitModule=function(U,x){if(typeof U=="string")if(typeof x=="object"&&x!==null){if(x.as==null||x.as==="script"){var q=D(x.as,x.crossOrigin);_.d.M(U,{crossOrigin:q,integrity:typeof x.integrity=="string"?x.integrity:void 0,nonce:typeof x.nonce=="string"?x.nonce:void 0})}}else x==null&&_.d.M(U)},jd.preload=function(U,x){if(typeof U=="string"&&typeof x=="object"&&x!==null&&typeof x.as=="string"){var q=x.as,J=D(q,x.crossOrigin);_.d.L(U,q,{crossOrigin:J,integrity:typeof x.integrity=="string"?x.integrity:void 0,nonce:typeof x.nonce=="string"?x.nonce:void 0,type:typeof x.type=="string"?x.type:void 0,fetchPriority:typeof x.fetchPriority=="string"?x.fetchPriority:void 0,referrerPolicy:typeof x.referrerPolicy=="string"?x.referrerPolicy:void 0,imageSrcSet:typeof x.imageSrcSet=="string"?x.imageSrcSet:void 0,imageSizes:typeof x.imageSizes=="string"?x.imageSizes:void 0,media:typeof x.media=="string"?x.media:void 0})}},jd.preloadModule=function(U,x){if(typeof U=="string")if(x){var q=D(x.as,x.crossOrigin);_.d.m(U,{as:typeof x.as=="string"&&x.as!=="script"?x.as:void 0,crossOrigin:q,integrity:typeof x.integrity=="string"?x.integrity:void 0})}else _.d.m(U)},jd.requestFormReset=function(U){_.d.r(U)},jd.unstable_batchedUpdates=function(U,x){return U(x)},jd.useFormState=function(U,x,q){return b.H.useFormState(U,x,q)},jd.useFormStatus=function(){return b.H.useHostTransitionStatus()},jd.version="19.1.1",jd}var MJ;function w$(){if(MJ)return uq.exports;MJ=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(a){console.error(a)}}return l(),uq.exports=Wie(),uq.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var UJ;function Hie(){if(UJ)return yj;UJ=1;var l=Gie(),a=M7(),h=w$();function _(f){var E="https://react.dev/errors/"+f;if(1<arguments.length){E+="?args[]="+encodeURIComponent(arguments[1]);for(var v=2;v<arguments.length;v++)E+="&args[]="+encodeURIComponent(arguments[v])}return"Minified React error #"+f+"; visit "+E+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function S(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function y(f){var E=f,v=f;if(f.alternate)for(;E.return;)E=E.return;else{f=E;do E=f,(E.flags&4098)!==0&&(v=E.return),f=E.return;while(f)}return E.tag===3?v:null}function b(f){if(f.tag===13){var E=f.memoizedState;if(E===null&&(f=f.alternate,f!==null&&(E=f.memoizedState)),E!==null)return E.dehydrated}return null}function D(f){if(y(f)!==f)throw Error(_(188))}function U(f){var E=f.alternate;if(!E){if(E=y(f),E===null)throw Error(_(188));return E!==f?null:f}for(var v=f,C=E;;){var P=v.return;if(P===null)break;var B=P.alternate;if(B===null){if(C=P.return,C!==null){v=C;continue}break}if(P.child===B.child){for(B=P.child;B;){if(B===v)return D(P),f;if(B===C)return D(P),E;B=B.sibling}throw Error(_(188))}if(v.return!==C.return)v=P,C=B;else{for(var ce=!1,Ee=P.child;Ee;){if(Ee===v){ce=!0,v=P,C=B;break}if(Ee===C){ce=!0,C=P,v=B;break}Ee=Ee.sibling}if(!ce){for(Ee=B.child;Ee;){if(Ee===v){ce=!0,v=B,C=P;break}if(Ee===C){ce=!0,C=B,v=P;break}Ee=Ee.sibling}if(!ce)throw Error(_(189))}}if(v.alternate!==C)throw Error(_(190))}if(v.tag!==3)throw Error(_(188));return v.stateNode.current===v?f:E}function x(f){var E=f.tag;if(E===5||E===26||E===27||E===6)return f;for(f=f.child;f!==null;){if(E=x(f),E!==null)return E;f=f.sibling}return null}var q=Object.assign,J=Symbol.for("react.element"),ee=Symbol.for("react.transitional.element"),ue=Symbol.for("react.portal"),oe=Symbol.for("react.fragment"),le=Symbol.for("react.strict_mode"),pe=Symbol.for("react.profiler"),Ne=Symbol.for("react.provider"),Ve=Symbol.for("react.consumer"),Ae=Symbol.for("react.context"),Ue=Symbol.for("react.forward_ref"),ke=Symbol.for("react.suspense"),qe=Symbol.for("react.suspense_list"),Te=Symbol.for("react.memo"),he=Symbol.for("react.lazy"),_e=Symbol.for("react.activity"),ye=Symbol.for("react.memo_cache_sentinel"),Ie=Symbol.iterator;function $(f){return f===null||typeof f!="object"?null:(f=Ie&&f[Ie]||f["@@iterator"],typeof f=="function"?f:null)}var me=Symbol.for("react.client.reference");function Xe(f){if(f==null)return null;if(typeof f=="function")return f.$$typeof===me?null:f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case oe:return"Fragment";case pe:return"Profiler";case le:return"StrictMode";case ke:return"Suspense";case qe:return"SuspenseList";case _e:return"Activity"}if(typeof f=="object")switch(f.$$typeof){case ue:return"Portal";case Ae:return(f.displayName||"Context")+".Provider";case Ve:return(f._context.displayName||"Context")+".Consumer";case Ue:var E=f.render;return f=f.displayName,f||(f=E.displayName||E.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case Te:return E=f.displayName||null,E!==null?E:Xe(f.type)||"Memo";case he:E=f._payload,f=f._init;try{return Xe(f(E))}catch{}}return null}var ct=Array.isArray,Me=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Je=h.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,mt={pending:!1,data:null,method:null,action:null},yt=[],xe=-1;function it(f){return{current:f}}function ft(f){0>xe||(f.current=yt[xe],yt[xe]=null,xe--)}function pt(f,E){xe++,yt[xe]=f.current,f.current=E}var xt=it(null),ln=it(null),pn=it(null),Zn=it(null);function ri(f,E){switch(pt(pn,E),pt(ln,f),pt(xt,null),E.nodeType){case 9:case 11:f=(f=E.documentElement)&&(f=f.namespaceURI)?xN(f):0;break;default:if(f=E.tagName,E=E.namespaceURI)E=xN(E),f=VN(E,f);else switch(f){case"svg":f=1;break;case"math":f=2;break;default:f=0}}ft(xt),pt(xt,f)}function si(){ft(xt),ft(ln),ft(pn)}function En(f){f.memoizedState!==null&&pt(Zn,f);var E=xt.current,v=VN(E,f.type);E!==v&&(pt(ln,f),pt(xt,v))}function oi(f){ln.current===f&&(ft(xt),ft(ln)),Zn.current===f&&(ft(Zn),NT._currentValue=mt)}var ui=Object.prototype.hasOwnProperty,Kn=l.unstable_scheduleCallback,qn=l.unstable_cancelCallback,Zi=l.unstable_shouldYield,Gi=l.unstable_requestPaint,yi=l.unstable_now,vn=l.unstable_getCurrentPriorityLevel,xn=l.unstable_ImmediatePriority,ir=l.unstable_UserBlockingPriority,Bi=l.unstable_NormalPriority,Sn=l.unstable_LowPriority,Us=l.unstable_IdlePriority,Rn=l.log,Kt=l.unstable_setDisableYieldValue,wt=null,Ot=null;function un(f){if(typeof Rn=="function"&&Kt(f),Ot&&typeof Ot.setStrictMode=="function")try{Ot.setStrictMode(wt,f)}catch{}}var rn=Math.clz32?Math.clz32:is,Vn=Math.log,Ci=Math.LN2;function is(f){return f>>>=0,f===0?32:31-(Vn(f)/Ci|0)|0}var ur=256,wr=4194304;function hn(f){var E=f&42;if(E!==0)return E;switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return f&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return f}}function hr(f,E,v){var C=f.pendingLanes;if(C===0)return 0;var P=0,B=f.suspendedLanes,ce=f.pingedLanes;f=f.warmLanes;var Ee=C&134217727;return Ee!==0?(C=Ee&~B,C!==0?P=hn(C):(ce&=Ee,ce!==0?P=hn(ce):v||(v=Ee&~f,v!==0&&(P=hn(v))))):(Ee=C&~B,Ee!==0?P=hn(Ee):ce!==0?P=hn(ce):v||(v=C&~f,v!==0&&(P=hn(v)))),P===0?0:E!==0&&E!==P&&(E&B)===0&&(B=P&-P,v=E&-E,B>=v||B===32&&(v&4194048)!==0)?E:P}function rs(f,E){return(f.pendingLanes&~(f.suspendedLanes&~f.pingedLanes)&E)===0}function eo(f,E){switch(f){case 1:case 2:case 4:case 8:case 64:return E+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return E+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Qc(){var f=ur;return ur<<=1,(ur&4194048)===0&&(ur=256),f}function Rf(){var f=wr;return wr<<=1,(wr&62914560)===0&&(wr=4194304),f}function Yd(f){for(var E=[],v=0;31>v;v++)E.push(f);return E}function Xr(f,E){f.pendingLanes|=E,E!==268435456&&(f.suspendedLanes=0,f.pingedLanes=0,f.warmLanes=0)}function ho(f,E,v,C,P,B){var ce=f.pendingLanes;f.pendingLanes=v,f.suspendedLanes=0,f.pingedLanes=0,f.warmLanes=0,f.expiredLanes&=v,f.entangledLanes&=v,f.errorRecoveryDisabledLanes&=v,f.shellSuspendCounter=0;var Ee=f.entanglements,Fe=f.expirationTimes,Ze=f.hiddenUpdates;for(v=ce&~v;0<v;){var Et=31-rn(v),Nt=1<<Et;Ee[Et]=0,Fe[Et]=-1;var ot=Ze[Et];if(ot!==null)for(Ze[Et]=null,Et=0;Et<ot.length;Et++){var at=ot[Et];at!==null&&(at.lane&=-536870913)}v&=~Nt}C!==0&&Fo(f,C,0),B!==0&&P===0&&f.tag!==0&&(f.suspendedLanes|=B&~(ce&~E))}function Fo(f,E,v){f.pendingLanes|=E,f.suspendedLanes&=~E;var C=31-rn(E);f.entangledLanes|=E,f.entanglements[C]=f.entanglements[C]|1073741824|v&4194090}function ju(f,E){var v=f.entangledLanes|=E;for(f=f.entanglements;v;){var C=31-rn(v),P=1<<C;P&E|f[C]&E&&(f[C]|=E),v&=~P}}function Ts(f){switch(f){case 2:f=1;break;case 8:f=4;break;case 32:f=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:f=128;break;case 268435456:f=134217728;break;default:f=0}return f}function bE(f){return f&=-f,2<f?8<f?(f&134217727)!==0?32:268435456:8:2}function Cf(){var f=Je.p;return f!==0?f:(f=window.event,f===void 0?32:ZN(f.type))}function gy(f,E){var v=Je.p;try{return Je.p=f,E()}finally{Je.p=v}}var hi=Math.random().toString(36).slice(2),Sa="__reactFiber$"+hi,oa="__reactProps$"+hi,ka="__reactContainer$"+hi,B_="__reactEvents$"+hi,kS="__reactListeners$"+hi,Gu="__reactHandles$"+hi,Sy="__reactResources$"+hi,Hh="__reactMarker$"+hi;function Kh(f){delete f[Sa],delete f[oa],delete f[B_],delete f[kS],delete f[Gu]}function bf(f){var E=f[Sa];if(E)return E;for(var v=f.parentNode;v;){if(E=v[ka]||v[Sa]){if(v=E.alternate,E.child!==null||v!==null&&v.child!==null)for(f=GN(f);f!==null;){if(v=f[Sa])return v;f=GN(f)}return E}f=v,v=f.parentNode}return null}function Wu(f){if(f=f[Sa]||f[ka]){var E=f.tag;if(E===5||E===6||E===13||E===26||E===27||E===3)return f}return null}function Hu(f){var E=f.tag;if(E===5||E===26||E===27||E===6)return f.stateNode;throw Error(_(33))}function Ja(f){var E=f[Sy];return E||(E=f[Sy]={hoistableStyles:new Map,hoistableScripts:new Map}),E}function po(f){f[Hh]=!0}var zh=new Set,If={};function Bo(f,E){Yh(f,E),Yh(f+"Capture",E)}function Yh(f,E){for(If[f]=E,f=0;f<E.length;f++)zh.add(E[f])}var Ty=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ao={},j_={};function vy(f){return ui.call(j_,f)?!0:ui.call(Ao,f)?!1:Ty.test(f)?j_[f]=!0:(Ao[f]=!0,!1)}function bi(f,E,v){if(vy(E))if(v===null)f.removeAttribute(E);else{switch(typeof v){case"undefined":case"function":case"symbol":f.removeAttribute(E);return;case"boolean":var C=E.toLowerCase().slice(0,5);if(C!=="data-"&&C!=="aria-"){f.removeAttribute(E);return}}f.setAttribute(E,""+v)}}function Ku(f,E,v){if(v===null)f.removeAttribute(E);else{switch(typeof v){case"undefined":case"function":case"symbol":case"boolean":f.removeAttribute(E);return}f.setAttribute(E,""+v)}}function Qa(f,E,v,C){if(C===null)f.removeAttribute(v);else{switch(typeof C){case"undefined":case"function":case"symbol":case"boolean":f.removeAttribute(v);return}f.setAttributeNS(E,v,""+C)}}var G_,yy;function Ol(f){if(G_===void 0)try{throw Error()}catch(v){var E=v.stack.trim().match(/\n( *(at )?)/);G_=E&&E[1]||"",yy=-1<v.stack.indexOf(`
    at`)?" (<anonymous>)":-1<v.stack.indexOf("@")?"@unknown:0:0":""}return`
`+G_+f+yy}var IE=!1;function Af(f,E){if(!f||IE)return"";IE=!0;var v=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var C={DetermineComponentFrameRoot:function(){try{if(E){var Nt=function(){throw Error()};if(Object.defineProperty(Nt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Nt,[])}catch(at){var ot=at}Reflect.construct(f,[],Nt)}else{try{Nt.call()}catch(at){ot=at}f.call(Nt.prototype)}}else{try{throw Error()}catch(at){ot=at}(Nt=f())&&typeof Nt.catch=="function"&&Nt.catch(function(){})}}catch(at){if(at&&ot&&typeof at.stack=="string")return[at.stack,ot.stack]}return[null,null]}};C.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var P=Object.getOwnPropertyDescriptor(C.DetermineComponentFrameRoot,"name");P&&P.configurable&&Object.defineProperty(C.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var B=C.DetermineComponentFrameRoot(),ce=B[0],Ee=B[1];if(ce&&Ee){var Fe=ce.split(`
`),Ze=Ee.split(`
`);for(P=C=0;C<Fe.length&&!Fe[C].includes("DetermineComponentFrameRoot");)C++;for(;P<Ze.length&&!Ze[P].includes("DetermineComponentFrameRoot");)P++;if(C===Fe.length||P===Ze.length)for(C=Fe.length-1,P=Ze.length-1;1<=C&&0<=P&&Fe[C]!==Ze[P];)P--;for(;1<=C&&0<=P;C--,P--)if(Fe[C]!==Ze[P]){if(C!==1||P!==1)do if(C--,P--,0>P||Fe[C]!==Ze[P]){var Et=`
`+Fe[C].replace(" at new "," at ");return f.displayName&&Et.includes("<anonymous>")&&(Et=Et.replace("<anonymous>",f.displayName)),Et}while(1<=C&&0<=P);break}}}finally{IE=!1,Error.prepareStackTrace=v}return(v=f?f.displayName||f.name:"")?Ol(v):""}function LS(f){switch(f.tag){case 26:case 27:case 5:return Ol(f.type);case 16:return Ol("Lazy");case 13:return Ol("Suspense");case 19:return Ol("SuspenseList");case 0:case 15:return Af(f.type,!1);case 11:return Af(f.type.render,!1);case 1:return Af(f.type,!0);case 31:return Ol("Activity");default:return""}}function AE(f){try{var E="";do E+=LS(f),f=f.return;while(f);return E}catch(v){return`
Error generating stack: `+v.message+`
`+v.stack}}function Nc(f){switch(typeof f){case"bigint":case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function Dc(f){var E=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(E==="checkbox"||E==="radio")}function W_(f){var E=Dc(f)?"checked":"value",v=Object.getOwnPropertyDescriptor(f.constructor.prototype,E),C=""+f[E];if(!f.hasOwnProperty(E)&&typeof v<"u"&&typeof v.get=="function"&&typeof v.set=="function"){var P=v.get,B=v.set;return Object.defineProperty(f,E,{configurable:!0,get:function(){return P.call(this)},set:function(ce){C=""+ce,B.call(this,ce)}}),Object.defineProperty(f,E,{enumerable:v.enumerable}),{getValue:function(){return C},setValue:function(ce){C=""+ce},stopTracking:function(){f._valueTracker=null,delete f[E]}}}}function wE(f){f._valueTracker||(f._valueTracker=W_(f))}function Fn(f){if(!f)return!1;var E=f._valueTracker;if(!E)return!0;var v=E.getValue(),C="";return f&&(C=Dc(f)?f.checked?"true":"false":f.value),f=C,f!==v?(E.setValue(f),!0):!1}function H_(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}var MS=/[\n"\\]/g;function wo(f){return f.replace(MS,function(E){return"\\"+E.charCodeAt(0).toString(16)+" "})}function Nl(f,E,v,C,P,B,ce,Ee){f.name="",ce!=null&&typeof ce!="function"&&typeof ce!="symbol"&&typeof ce!="boolean"?f.type=ce:f.removeAttribute("type"),E!=null?ce==="number"?(E===0&&f.value===""||f.value!=E)&&(f.value=""+Nc(E)):f.value!==""+Nc(E)&&(f.value=""+Nc(E)):ce!=="submit"&&ce!=="reset"||f.removeAttribute("value"),E!=null?wf(f,ce,Nc(E)):v!=null?wf(f,ce,Nc(v)):C!=null&&f.removeAttribute("value"),P==null&&B!=null&&(f.defaultChecked=!!B),P!=null&&(f.checked=P&&typeof P!="function"&&typeof P!="symbol"),Ee!=null&&typeof Ee!="function"&&typeof Ee!="symbol"&&typeof Ee!="boolean"?f.name=""+Nc(Ee):f.removeAttribute("name")}function K_(f,E,v,C,P,B,ce,Ee){if(B!=null&&typeof B!="function"&&typeof B!="symbol"&&typeof B!="boolean"&&(f.type=B),E!=null||v!=null){if(!(B!=="submit"&&B!=="reset"||E!=null))return;v=v!=null?""+Nc(v):"",E=E!=null?""+Nc(E):v,Ee||E===f.value||(f.value=E),f.defaultValue=E}C=C??P,C=typeof C!="function"&&typeof C!="symbol"&&!!C,f.checked=Ee?f.checked:!!C,f.defaultChecked=!!C,ce!=null&&typeof ce!="function"&&typeof ce!="symbol"&&typeof ce!="boolean"&&(f.name=ce)}function wf(f,E,v){E==="number"&&H_(f.ownerDocument)===f||f.defaultValue===""+v||(f.defaultValue=""+v)}function qh(f,E,v,C){if(f=f.options,E){E={};for(var P=0;P<v.length;P++)E["$"+v[P]]=!0;for(v=0;v<f.length;v++)P=E.hasOwnProperty("$"+f[v].value),f[v].selected!==P&&(f[v].selected=P),P&&C&&(f[v].defaultSelected=!0)}else{for(v=""+Nc(v),E=null,P=0;P<f.length;P++){if(f[P].value===v){f[P].selected=!0,C&&(f[P].defaultSelected=!0);return}E!==null||f[P].disabled||(E=f[P])}E!==null&&(E.selected=!0)}}function hs(f,E,v){if(E!=null&&(E=""+Nc(E),E!==f.value&&(f.value=E),v==null)){f.defaultValue!==E&&(f.defaultValue=E);return}f.defaultValue=v!=null?""+Nc(v):""}function z_(f,E,v,C){if(E==null){if(C!=null){if(v!=null)throw Error(_(92));if(ct(C)){if(1<C.length)throw Error(_(93));C=C[0]}v=C}v==null&&(v=""),E=v}v=Nc(E),f.defaultValue=v,C=f.textContent,C===v&&C!==""&&C!==null&&(f.value=C)}function hc(f,E){if(E){var v=f.firstChild;if(v&&v===f.lastChild&&v.nodeType===3){v.nodeValue=E;return}}f.textContent=E}var Xh=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Of(f,E,v){var C=E.indexOf("--")===0;v==null||typeof v=="boolean"||v===""?C?f.setProperty(E,""):E==="float"?f.cssFloat="":f[E]="":C?f.setProperty(E,v):typeof v!="number"||v===0||Xh.has(E)?E==="float"?f.cssFloat=v:f[E]=(""+v).trim():f[E]=v+"px"}function US(f,E,v){if(E!=null&&typeof E!="object")throw Error(_(62));if(f=f.style,v!=null){for(var C in v)!v.hasOwnProperty(C)||E!=null&&E.hasOwnProperty(C)||(C.indexOf("--")===0?f.setProperty(C,""):C==="float"?f.cssFloat="":f[C]="");for(var P in E)C=E[P],E.hasOwnProperty(P)&&v[P]!==C&&Of(f,P,C)}else for(var B in E)E.hasOwnProperty(B)&&Of(f,B,E[B])}function Jh(f){if(f.indexOf("-")===-1)return!1;switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jb=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),xS=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function OE(f){return xS.test(""+f)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":f}var Qh=null;function cd(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var Zh=null,$h=null;function VS(f){var E=Wu(f);if(E&&(f=E.stateNode)){var v=f[oa]||null;e:switch(f=E.stateNode,E.type){case"input":if(Nl(f,v.value,v.defaultValue,v.defaultValue,v.checked,v.defaultChecked,v.type,v.name),E=v.name,v.type==="radio"&&E!=null){for(v=f;v.parentNode;)v=v.parentNode;for(v=v.querySelectorAll('input[name="'+wo(""+E)+'"][type="radio"]'),E=0;E<v.length;E++){var C=v[E];if(C!==f&&C.form===f.form){var P=C[oa]||null;if(!P)throw Error(_(90));Nl(C,P.value,P.defaultValue,P.defaultValue,P.checked,P.defaultChecked,P.type,P.name)}}for(E=0;E<v.length;E++)C=v[E],C.form===f.form&&Fn(C)}break e;case"textarea":hs(f,v.value,v.defaultValue);break e;case"select":E=v.value,E!=null&&qh(f,!!v.multiple,E,!1)}}}var zu=!1;function Ry(f,E,v){if(zu)return f(E,v);zu=!0;try{var C=f(E);return C}finally{if(zu=!1,(Zh!==null||$h!==null)&&(ah(),Zh&&(E=Zh,f=$h,$h=Zh=null,VS(E),f)))for(E=0;E<f.length;E++)VS(f[E])}}function ep(f,E){var v=f.stateNode;if(v===null)return null;var C=v[oa]||null;if(C===null)return null;v=C[E];e:switch(E){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(C=!C.disabled)||(f=f.type,C=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!C;break e;default:f=!1}if(f)return null;if(v&&typeof v!="function")throw Error(_(231,E,typeof v));return v}var qd=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ld=!1;if(qd)try{var Y_={};Object.defineProperty(Y_,"passive",{get:function(){ld=!0}}),window.addEventListener("test",Y_,Y_),window.removeEventListener("test",Y_,Y_)}catch{ld=!1}var La=null,Nf=null,tp=null;function FS(){if(tp)return tp;var f,E=Nf,v=E.length,C,P="value"in La?La.value:La.textContent,B=P.length;for(f=0;f<v&&E[f]===P[f];f++);var ce=v-f;for(C=1;C<=ce&&E[v-C]===P[B-C];C++);return tp=P.slice(f,1<C?1-C:void 0)}function Yu(f){var E=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&E===13&&(f=13)):f=E,f===10&&(f=13),32<=f||f===13?f:0}function dd(){return!0}function BS(){return!1}function Ma(f){function E(v,C,P,B,ce){this._reactName=v,this._targetInst=P,this.type=C,this.nativeEvent=B,this.target=ce,this.currentTarget=null;for(var Ee in f)f.hasOwnProperty(Ee)&&(v=f[Ee],this[Ee]=v?v(B):B[Ee]);return this.isDefaultPrevented=(B.defaultPrevented!=null?B.defaultPrevented:B.returnValue===!1)?dd:BS,this.isPropagationStopped=BS,this}return q(E.prototype,{preventDefault:function(){this.defaultPrevented=!0;var v=this.nativeEvent;v&&(v.preventDefault?v.preventDefault():typeof v.returnValue!="unknown"&&(v.returnValue=!1),this.isDefaultPrevented=dd)},stopPropagation:function(){var v=this.nativeEvent;v&&(v.stopPropagation?v.stopPropagation():typeof v.cancelBubble!="unknown"&&(v.cancelBubble=!0),this.isPropagationStopped=dd)},persist:function(){},isPersistent:dd}),E}var ss={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},aa=Ma(ss),os=q({},ss,{view:0,detail:0}),NE=Ma(os),DE,PE,qu,lr=q({},os,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:J_,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==qu&&(qu&&f.type==="mousemove"?(DE=f.screenX-qu.screenX,PE=f.screenY-qu.screenY):PE=DE=0,qu=f),DE)},movementY:function(f){return"movementY"in f?f.movementY:PE}}),ud=Ma(lr),Cy=q({},lr,{dataTransfer:0}),Gb=Ma(Cy),Dl=q({},os,{relatedTarget:0}),Df=Ma(Dl),jS=q({},ss,{animationName:0,elapsedTime:0,pseudoElement:0}),Xu=Ma(jS),by=q({},ss,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),Ju=Ma(by),q_=q({},ss,{data:0}),np=Ma(q_),X_={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Iy={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},pc={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pl(f){var E=this.nativeEvent;return E.getModifierState?E.getModifierState(f):(f=pc[f])?!!E[f]:!1}function J_(){return Pl}var Ay=q({},os,{key:function(f){if(f.key){var E=X_[f.key]||f.key;if(E!=="Unidentified")return E}return f.type==="keypress"?(f=Yu(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?Iy[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:J_,charCode:function(f){return f.type==="keypress"?Yu(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?Yu(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),kE=Ma(Ay),wy=q({},lr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),GS=Ma(wy),Ta=q({},os,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:J_}),Oy=Ma(Ta),Zc=q({},ss,{propertyName:0,elapsedTime:0,pseudoElement:0}),LE=Ma(Zc),Ny=q({},lr,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),Ut=Ma(Ny),Dy=q({},ss,{newState:0,oldState:0}),Py=Ma(Dy),Pf=[9,13,27,32],N=qd&&"CompositionEvent"in window,X=null;qd&&"documentMode"in document&&(X=document.documentMode);var ie=qd&&"TextEvent"in window&&!X,ve=qd&&(!N||X&&8<X&&11>=X),tt=" ",lt=!1;function Ht(f,E){switch(f){case"keyup":return Pf.indexOf(E.keyCode)!==-1;case"keydown":return E.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Jr(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var xs=!1;function pr(f,E){switch(f){case"compositionend":return Jr(E);case"keypress":return E.which!==32?null:(lt=!0,tt);case"textInput":return f=E.data,f===tt&&lt?null:f;default:return null}}function Vr(f,E){if(xs)return f==="compositionend"||!N&&Ht(f,E)?(f=FS(),tp=Nf=La=null,xs=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(E.ctrlKey||E.altKey||E.metaKey)||E.ctrlKey&&E.altKey){if(E.char&&1<E.char.length)return E.char;if(E.which)return String.fromCharCode(E.which)}return null;case"compositionend":return ve&&E.locale!=="ko"?null:E.data;default:return null}}var Ua={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ip(f){var E=f&&f.nodeName&&f.nodeName.toLowerCase();return E==="input"?!!Ua[f.type]:E==="textarea"}function $c(f,E,v,C){Zh?$h?$h.push(C):$h=[C]:Zh=C,E=_g(E,"onChange"),0<E.length&&(v=new aa("onChange","change",null,v,C),f.push({event:v,listeners:E}))}var hd=null,kl=null;function cL(f){fg(f,0)}function ky(f){var E=Hu(f);if(Fn(E))return f}function mO(f,E){if(f==="change")return E}var to=!1;if(qd){var Wb;if(qd){var Hb="oninput"in document;if(!Hb){var EO=document.createElement("div");EO.setAttribute("oninput","return;"),Hb=typeof EO.oninput=="function"}Wb=Hb}else Wb=!1;to=Wb&&(!document.documentMode||9<document.documentMode)}function gO(){hd&&(hd.detachEvent("onpropertychange",Ly),kl=hd=null)}function Ly(f){if(f.propertyName==="value"&&ky(kl)){var E=[];$c(E,kl,f,cd(f)),Ry(cL,E)}}function lL(f,E,v){f==="focusin"?(gO(),hd=E,kl=v,hd.attachEvent("onpropertychange",Ly)):f==="focusout"&&gO()}function dL(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return ky(kl)}function Kb(f,E){if(f==="click")return ky(E)}function WS(f,E){if(f==="input"||f==="change")return ky(E)}function uL(f,E){return f===E&&(f!==0||1/f===1/E)||f!==f&&E!==E}var Ll=typeof Object.is=="function"?Object.is:uL;function Xd(f,E){if(Ll(f,E))return!0;if(typeof f!="object"||f===null||typeof E!="object"||E===null)return!1;var v=Object.keys(f),C=Object.keys(E);if(v.length!==C.length)return!1;for(C=0;C<v.length;C++){var P=v[C];if(!ui.call(E,P)||!Ll(f[P],E[P]))return!1}return!0}function SO(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function TO(f,E){var v=SO(f);f=0;for(var C;v;){if(v.nodeType===3){if(C=f+v.textContent.length,f<=E&&C>=E)return{node:v,offset:E-f};f=C}e:{for(;v;){if(v.nextSibling){v=v.nextSibling;break e}v=v.parentNode}v=void 0}v=SO(v)}}function vO(f,E){return f&&E?f===E?!0:f&&f.nodeType===3?!1:E&&E.nodeType===3?vO(f,E.parentNode):"contains"in f?f.contains(E):f.compareDocumentPosition?!!(f.compareDocumentPosition(E)&16):!1:!1}function fc(f){f=f!=null&&f.ownerDocument!=null&&f.ownerDocument.defaultView!=null?f.ownerDocument.defaultView:window;for(var E=H_(f.document);E instanceof f.HTMLIFrameElement;){try{var v=typeof E.contentWindow.location.href=="string"}catch{v=!1}if(v)f=E.contentWindow;else break;E=H_(f.document)}return E}function zb(f){var E=f&&f.nodeName&&f.nodeName.toLowerCase();return E&&(E==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||E==="textarea"||f.contentEditable==="true")}var hL=qd&&"documentMode"in document&&11>=document.documentMode,Fr=null,Yb=null,HS=null,qb=!1;function yO(f,E,v){var C=v.window===v?v.document:v.nodeType===9?v:v.ownerDocument;qb||Fr==null||Fr!==H_(C)||(C=Fr,"selectionStart"in C&&zb(C)?C={start:C.selectionStart,end:C.selectionEnd}:(C=(C.ownerDocument&&C.ownerDocument.defaultView||window).getSelection(),C={anchorNode:C.anchorNode,anchorOffset:C.anchorOffset,focusNode:C.focusNode,focusOffset:C.focusOffset}),HS&&Xd(HS,C)||(HS=C,C=_g(Yb,"onSelect"),0<C.length&&(E=new aa("onSelect","select",null,E,v),f.push({event:E,listeners:C}),E.target=Fr)))}function rp(f,E){var v={};return v[f.toLowerCase()]=E.toLowerCase(),v["Webkit"+f]="webkit"+E,v["Moz"+f]="moz"+E,v}var ME={animationend:rp("Animation","AnimationEnd"),animationiteration:rp("Animation","AnimationIteration"),animationstart:rp("Animation","AnimationStart"),transitionrun:rp("Transition","TransitionRun"),transitionstart:rp("Transition","TransitionStart"),transitioncancel:rp("Transition","TransitionCancel"),transitionend:rp("Transition","TransitionEnd")},Xb={},RO={};qd&&(RO=document.createElement("div").style,"AnimationEvent"in window||(delete ME.animationend.animation,delete ME.animationiteration.animation,delete ME.animationstart.animation),"TransitionEvent"in window||delete ME.transitionend.transition);function sp(f){if(Xb[f])return Xb[f];if(!ME[f])return f;var E=ME[f],v;for(v in E)if(E.hasOwnProperty(v)&&v in RO)return Xb[f]=E[v];return f}var CO=sp("animationend"),bO=sp("animationiteration"),UE=sp("animationstart"),KS=sp("transitionrun"),pL=sp("transitionstart"),Re=sp("transitioncancel"),IO=sp("transitionend"),AO=new Map,Jb="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Jb.push("scrollEnd");function Jd(f,E){AO.set(f,E),Bo(E,[f])}var My=new WeakMap;function el(f,E){if(typeof f=="object"&&f!==null){var v=My.get(f);return v!==void 0?v:(E={value:f,source:E,stack:AE(E)},My.set(f,E),E)}return{value:f,source:E,stack:AE(E)}}var pd=[],xE=0,Qb=0;function Qu(){for(var f=xE,E=Qb=xE=0;E<f;){var v=pd[E];pd[E++]=null;var C=pd[E];pd[E++]=null;var P=pd[E];pd[E++]=null;var B=pd[E];if(pd[E++]=null,C!==null&&P!==null){var ce=C.pending;ce===null?P.next=P:(P.next=ce.next,ce.next=P),C.pending=P}B!==0&&kf(v,P,B)}}function fd(f,E,v,C){pd[xE++]=f,pd[xE++]=E,pd[xE++]=v,pd[xE++]=C,Qb|=C,f.lanes|=C,f=f.alternate,f!==null&&(f.lanes|=C)}function Zb(f,E,v,C){return fd(f,E,v,C),Lf(f)}function VE(f,E){return fd(f,null,null,E),Lf(f)}function kf(f,E,v){f.lanes|=v;var C=f.alternate;C!==null&&(C.lanes|=v);for(var P=!1,B=f.return;B!==null;)B.childLanes|=v,C=B.alternate,C!==null&&(C.childLanes|=v),B.tag===22&&(f=B.stateNode,f===null||f._visibility&1||(P=!0)),f=B,B=B.return;return f.tag===3?(B=f.stateNode,P&&E!==null&&(P=31-rn(v),f=B.hiddenUpdates,C=f[P],C===null?f[P]=[E]:C.push(E),E.lane=v|536870912),B):null}function Lf(f){if(50<gT)throw gT=0,DI=null,Error(_(185));for(var E=f.return;E!==null;)f=E,E=f.return;return f.tag===3?f.stateNode:null}var _d={};function fL(f,E,v,C){this.tag=f,this.key=v,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=E,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=C,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ml(f,E,v,C){return new fL(f,E,v,C)}function $b(f){return f=f.prototype,!(!f||!f.isReactComponent)}function op(f,E){var v=f.alternate;return v===null?(v=Ml(f.tag,E,f.key,f.mode),v.elementType=f.elementType,v.type=f.type,v.stateNode=f.stateNode,v.alternate=f,f.alternate=v):(v.pendingProps=E,v.type=f.type,v.flags=0,v.subtreeFlags=0,v.deletions=null),v.flags=f.flags&65011712,v.childLanes=f.childLanes,v.lanes=f.lanes,v.child=f.child,v.memoizedProps=f.memoizedProps,v.memoizedState=f.memoizedState,v.updateQueue=f.updateQueue,E=f.dependencies,v.dependencies=E===null?null:{lanes:E.lanes,firstContext:E.firstContext},v.sibling=f.sibling,v.index=f.index,v.ref=f.ref,v.refCleanup=f.refCleanup,v}function FE(f,E){f.flags&=65011714;var v=f.alternate;return v===null?(f.childLanes=0,f.lanes=E,f.child=null,f.subtreeFlags=0,f.memoizedProps=null,f.memoizedState=null,f.updateQueue=null,f.dependencies=null,f.stateNode=null):(f.childLanes=v.childLanes,f.lanes=v.lanes,f.child=v.child,f.subtreeFlags=0,f.deletions=null,f.memoizedProps=v.memoizedProps,f.memoizedState=v.memoizedState,f.updateQueue=v.updateQueue,f.type=v.type,E=v.dependencies,f.dependencies=E===null?null:{lanes:E.lanes,firstContext:E.firstContext}),f}function Uy(f,E,v,C,P,B){var ce=0;if(C=f,typeof f=="function")$b(f)&&(ce=1);else if(typeof f=="string")ce=wT(f,v,xt.current)?26:f==="html"||f==="head"||f==="body"?27:5;else e:switch(f){case _e:return f=Ml(31,v,E,P),f.elementType=_e,f.lanes=B,f;case oe:return ap(v.children,P,B,E);case le:ce=8,P|=24;break;case pe:return f=Ml(12,v,E,P|2),f.elementType=pe,f.lanes=B,f;case ke:return f=Ml(13,v,E,P),f.elementType=ke,f.lanes=B,f;case qe:return f=Ml(19,v,E,P),f.elementType=qe,f.lanes=B,f;default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case Ne:case Ae:ce=10;break e;case Ve:ce=9;break e;case Ue:ce=11;break e;case Te:ce=14;break e;case he:ce=16,C=null;break e}ce=29,v=Error(_(130,f===null?"null":typeof f,"")),C=null}return E=Ml(ce,v,E,P),E.elementType=f,E.type=C,E.lanes=B,E}function ap(f,E,v,C){return f=Ml(7,f,C,E),f.lanes=v,f}function Ks(f,E,v){return f=Ml(6,f,null,E),f.lanes=v,f}function eI(f,E,v){return E=Ml(4,f.children!==null?f.children:[],f.key,E),E.lanes=v,E.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},E}var tl=[],BE=0,xy=null,Vy=0,nl=[],md=0,Q_=null,cp=1,Ul="";function Z_(f,E){tl[BE++]=Vy,tl[BE++]=xy,xy=f,Vy=E}function Fy(f,E,v){nl[md++]=cp,nl[md++]=Ul,nl[md++]=Q_,Q_=f;var C=cp;f=Ul;var P=32-rn(C)-1;C&=~(1<<P),v+=1;var B=32-rn(E)+P;if(30<B){var ce=P-P%5;B=(C&(1<<ce)-1).toString(32),C>>=ce,P-=ce,cp=1<<32-rn(E)+P|v<<P|C,Ul=B+f}else cp=1<<B|v<<P|C,Ul=f}function zS(f){f.return!==null&&(Z_(f,1),Fy(f,1,0))}function tI(f){for(;f===xy;)xy=tl[--BE],tl[BE]=null,Vy=tl[--BE],tl[BE]=null;for(;f===Q_;)Q_=nl[--md],nl[md]=null,Ul=nl[--md],nl[md]=null,cp=nl[--md],nl[md]=null}var Za=null,ps=null,Hr=!1,$_=null,Zu=!1,nI=Error(_(519));function em(f){var E=Error(_(418,""));throw qS(el(E,f)),nI}function By(f){var E=f.stateNode,v=f.type,C=f.memoizedProps;switch(E[Sa]=f,E[oa]=C,v){case"dialog":Vi("cancel",E),Vi("close",E);break;case"iframe":case"object":case"embed":Vi("load",E);break;case"video":case"audio":for(v=0;v<gm.length;v++)Vi(gm[v],E);break;case"source":Vi("error",E);break;case"img":case"image":case"link":Vi("error",E),Vi("load",E);break;case"details":Vi("toggle",E);break;case"input":Vi("invalid",E),K_(E,C.value,C.defaultValue,C.checked,C.defaultChecked,C.type,C.name,!0),wE(E);break;case"select":Vi("invalid",E);break;case"textarea":Vi("invalid",E),z_(E,C.value,C.defaultValue,C.children),wE(E)}v=C.children,typeof v!="string"&&typeof v!="number"&&typeof v!="bigint"||E.textContent===""+v||C.suppressHydrationWarning===!0||Eg(E.textContent,v)?(C.popover!=null&&(Vi("beforetoggle",E),Vi("toggle",E)),C.onScroll!=null&&Vi("scroll",E),C.onScrollEnd!=null&&Vi("scrollend",E),C.onClick!=null&&(E.onclick=gg),E=!0):E=!1,E||em(f)}function jE(f){for(Za=f.return;Za;)switch(Za.tag){case 5:case 13:Zu=!1;return;case 27:case 3:Zu=!0;return;default:Za=Za.return}}function YS(f){if(f!==Za)return!1;if(!Hr)return jE(f),Hr=!0,!1;var E=f.tag,v;if((v=E!==3&&E!==27)&&((v=E===5)&&(v=f.type,v=!(v!=="form"&&v!=="button")||jI(f.type,f.memoizedProps)),v=!v),v&&ps&&em(f),jE(f),E===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(_(317));e:{for(f=f.nextSibling,E=0;f;){if(f.nodeType===8)if(v=f.data,v==="/$"){if(E===0){ps=au(f.nextSibling);break e}E--}else v!=="$"&&v!=="$!"&&v!=="$?"||E++;f=f.nextSibling}ps=null}}else E===27?(E=ps,a_(f.type)?(f=HI,HI=null,ps=f):ps=E):ps=Za?au(f.stateNode.nextSibling):null;return!0}function lp(){ps=Za=null,Hr=!1}function wO(){var f=$_;return f!==null&&(io===null?io=f:io.push.apply(io,f),$_=null),f}function qS(f){$_===null?$_=[f]:$_.push(f)}var iI=it(null),tm=null,dp=null;function Mf(f,E,v){pt(iI,E._currentValue),E._currentValue=v}function up(f){f._currentValue=iI.current,ft(iI)}function rI(f,E,v){for(;f!==null;){var C=f.alternate;if((f.childLanes&E)!==E?(f.childLanes|=E,C!==null&&(C.childLanes|=E)):C!==null&&(C.childLanes&E)!==E&&(C.childLanes|=E),f===v)break;f=f.return}}function sI(f,E,v,C){var P=f.child;for(P!==null&&(P.return=f);P!==null;){var B=P.dependencies;if(B!==null){var ce=P.child;B=B.firstContext;e:for(;B!==null;){var Ee=B;B=P;for(var Fe=0;Fe<E.length;Fe++)if(Ee.context===E[Fe]){B.lanes|=v,Ee=B.alternate,Ee!==null&&(Ee.lanes|=v),rI(B.return,v,f),C||(ce=null);break e}B=Ee.next}}else if(P.tag===18){if(ce=P.return,ce===null)throw Error(_(341));ce.lanes|=v,B=ce.alternate,B!==null&&(B.lanes|=v),rI(ce,v,f),ce=null}else ce=P.child;if(ce!==null)ce.return=P;else for(ce=P;ce!==null;){if(ce===f){ce=null;break}if(P=ce.sibling,P!==null){P.return=ce.return,ce=P;break}ce=ce.return}P=ce}}function XS(f,E,v,C){f=null;for(var P=E,B=!1;P!==null;){if(!B){if((P.flags&524288)!==0)B=!0;else if((P.flags&262144)!==0)break}if(P.tag===10){var ce=P.alternate;if(ce===null)throw Error(_(387));if(ce=ce.memoizedProps,ce!==null){var Ee=P.type;Ll(P.pendingProps.value,ce.value)||(f!==null?f.push(Ee):f=[Ee])}}else if(P===Zn.current){if(ce=P.alternate,ce===null)throw Error(_(387));ce.memoizedState.memoizedState!==P.memoizedState.memoizedState&&(f!==null?f.push(NT):f=[NT])}P=P.return}f!==null&&sI(E,f,v,C),E.flags|=262144}function jy(f){for(f=f.firstContext;f!==null;){if(!Ll(f.context._currentValue,f.memoizedValue))return!0;f=f.next}return!1}function xl(f){tm=f,dp=null,f=f.dependencies,f!==null&&(f.firstContext=null)}function Oo(f){return OO(tm,f)}function Uf(f,E){return tm===null&&xl(f),OO(f,E)}function OO(f,E){var v=E._currentValue;if(E={context:E,memoizedValue:v,next:null},dp===null){if(f===null)throw Error(_(308));dp=E,f.dependencies={lanes:0,firstContext:E},f.flags|=524288}else dp=dp.next=E;return v}var _L=typeof AbortController<"u"?AbortController:function(){var f=[],E=this.signal={aborted:!1,addEventListener:function(v,C){f.push(C)}};this.abort=function(){E.aborted=!0,f.forEach(function(v){return v()})}},mL=l.unstable_scheduleCallback,oI=l.unstable_NormalPriority,jo={$$typeof:Ae,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function nm(){return{controller:new _L,data:new Map,refCount:0}}function JS(f){f.refCount--,f.refCount===0&&mL(oI,function(){f.controller.abort()})}var QS=null,Qd=0,GE=0,WE=null;function EL(f,E){if(QS===null){var v=QS=[];Qd=0,GE=Op(),WE={status:"pending",value:void 0,then:function(C){v.push(C)}}}return Qd++,E.then(NO,NO),E}function NO(){if(--Qd===0&&QS!==null){WE!==null&&(WE.status="fulfilled");var f=QS;QS=null,GE=0,WE=null;for(var E=0;E<f.length;E++)(0,f[E])()}}function gL(f,E){var v=[],C={status:"pending",value:null,reason:null,then:function(P){v.push(P)}};return f.then(function(){C.status="fulfilled",C.value=E;for(var P=0;P<v.length;P++)(0,v[P])(E)},function(P){for(C.status="rejected",C.reason=P,P=0;P<v.length;P++)(0,v[P])(void 0)}),C}var DO=Me.S;Me.S=function(f,E){typeof E=="object"&&E!==null&&typeof E.then=="function"&&EL(f,E),DO!==null&&DO(f,E)};var hp=it(null);function aI(){var f=hp.current;return f!==null?f:Fs.pooledCache}function Gy(f,E){E===null?pt(hp,hp.current):pt(hp,E.pool)}function PO(){var f=aI();return f===null?null:{parent:jo._currentValue,pool:f}}var pp=Error(_(460)),kO=Error(_(474)),Wy=Error(_(542)),fp={then:function(){}};function LO(f){return f=f.status,f==="fulfilled"||f==="rejected"}function Hy(){}function MO(f,E,v){switch(v=f[v],v===void 0?f.push(E):v!==E&&(E.then(Hy,Hy),E=v),E.status){case"fulfilled":return E.value;case"rejected":throw f=E.reason,xO(f),f;default:if(typeof E.status=="string")E.then(Hy,Hy);else{if(f=Fs,f!==null&&100<f.shellSuspendCounter)throw Error(_(482));f=E,f.status="pending",f.then(function(C){if(E.status==="pending"){var P=E;P.status="fulfilled",P.value=C}},function(C){if(E.status==="pending"){var P=E;P.status="rejected",P.reason=C}})}switch(E.status){case"fulfilled":return E.value;case"rejected":throw f=E.reason,xO(f),f}throw ZS=E,pp}}var ZS=null;function UO(){if(ZS===null)throw Error(_(459));var f=ZS;return ZS=null,f}function xO(f){if(f===pp||f===Wy)throw Error(_(483))}var il=!1;function $S(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function cI(f,E){f=f.updateQueue,E.updateQueue===f&&(E.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,callbacks:null})}function xf(f){return{lane:f,tag:0,payload:null,callback:null,next:null}}function $u(f,E,v){var C=f.updateQueue;if(C===null)return null;if(C=C.shared,(Or&2)!==0){var P=C.pending;return P===null?E.next=E:(E.next=P.next,P.next=E),C.pending=E,E=Lf(f),kf(f,null,v),E}return fd(f,C,E,v),Lf(f)}function eT(f,E,v){if(E=E.updateQueue,E!==null&&(E=E.shared,(v&4194048)!==0)){var C=E.lanes;C&=f.pendingLanes,v|=C,E.lanes=v,ju(f,v)}}function lI(f,E){var v=f.updateQueue,C=f.alternate;if(C!==null&&(C=C.updateQueue,v===C)){var P=null,B=null;if(v=v.firstBaseUpdate,v!==null){do{var ce={lane:v.lane,tag:v.tag,payload:v.payload,callback:null,next:null};B===null?P=B=ce:B=B.next=ce,v=v.next}while(v!==null);B===null?P=B=E:B=B.next=E}else P=B=E;v={baseState:C.baseState,firstBaseUpdate:P,lastBaseUpdate:B,shared:C.shared,callbacks:C.callbacks},f.updateQueue=v;return}f=v.lastBaseUpdate,f===null?v.firstBaseUpdate=E:f.next=E,v.lastBaseUpdate=E}var dI=!1;function _p(){if(dI){var f=WE;if(f!==null)throw f}}function mp(f,E,v,C){dI=!1;var P=f.updateQueue;il=!1;var B=P.firstBaseUpdate,ce=P.lastBaseUpdate,Ee=P.shared.pending;if(Ee!==null){P.shared.pending=null;var Fe=Ee,Ze=Fe.next;Fe.next=null,ce===null?B=Ze:ce.next=Ze,ce=Fe;var Et=f.alternate;Et!==null&&(Et=Et.updateQueue,Ee=Et.lastBaseUpdate,Ee!==ce&&(Ee===null?Et.firstBaseUpdate=Ze:Ee.next=Ze,Et.lastBaseUpdate=Fe))}if(B!==null){var Nt=P.baseState;ce=0,Et=Ze=Fe=null,Ee=B;do{var ot=Ee.lane&-536870913,at=ot!==Ee.lane;if(at?(_r&ot)===ot:(C&ot)===ot){ot!==0&&ot===GE&&(dI=!0),Et!==null&&(Et=Et.next={lane:0,tag:Ee.tag,payload:Ee.payload,callback:null,next:null});e:{var Si=f,Xn=Ee;ot=E;var _s=v;switch(Xn.tag){case 1:if(Si=Xn.payload,typeof Si=="function"){Nt=Si.call(_s,Nt,ot);break e}Nt=Si;break e;case 3:Si.flags=Si.flags&-65537|128;case 0:if(Si=Xn.payload,ot=typeof Si=="function"?Si.call(_s,Nt,ot):Si,ot==null)break e;Nt=q({},Nt,ot);break e;case 2:il=!0}}ot=Ee.callback,ot!==null&&(f.flags|=64,at&&(f.flags|=8192),at=P.callbacks,at===null?P.callbacks=[ot]:at.push(ot))}else at={lane:ot,tag:Ee.tag,payload:Ee.payload,callback:Ee.callback,next:null},Et===null?(Ze=Et=at,Fe=Nt):Et=Et.next=at,ce|=ot;if(Ee=Ee.next,Ee===null){if(Ee=P.shared.pending,Ee===null)break;at=Ee,Ee=at.next,at.next=null,P.lastBaseUpdate=at,P.shared.pending=null}}while(!0);Et===null&&(Fe=Nt),P.baseState=Fe,P.firstBaseUpdate=Ze,P.lastBaseUpdate=Et,B===null&&(P.shared.lanes=0),al|=ce,f.lanes=ce,f.memoizedState=Nt}}function Ky(f,E){if(typeof f!="function")throw Error(_(191,f));f.call(E)}function HE(f,E){var v=f.callbacks;if(v!==null)for(f.callbacks=null,f=0;f<v.length;f++)Ky(v[f],E)}var Vf=it(null),KE=it(0);function Ff(f,E){f=ru,pt(KE,f),pt(Vf,E),ru=f|E.baseLanes}function Zd(){pt(KE,ru),pt(Vf,Vf.current)}function uI(){ru=KE.current,ft(Vf),ft(KE)}var Bf=0,xi=null,fs=null,ca=null,zE=!1,YE=!1,im=!1,zy=0,tT=0,qE=null,SL=0;function fo(){throw Error(_(321))}function Vl(f,E){if(E===null)return!1;for(var v=0;v<E.length&&v<f.length;v++)if(!Ll(f[v],E[v]))return!1;return!0}function hI(f,E,v,C,P,B){return Bf=B,xi=E,E.memoizedState=null,E.updateQueue=null,E.lanes=0,Me.H=f===null||f.memoizedState===null?Ed:sl,im=!1,B=v(C,P),im=!1,YE&&(B=FO(E,v,C,P)),VO(f),B}function VO(f){Me.H=No;var E=fs!==null&&fs.next!==null;if(Bf=0,ca=fs=xi=null,zE=!1,tT=0,qE=null,E)throw Error(_(300));f===null||xa||(f=f.dependencies,f!==null&&jy(f)&&(xa=!0))}function FO(f,E,v,C){xi=f;var P=0;do{if(YE&&(qE=null),tT=0,YE=!1,25<=P)throw Error(_(301));if(P+=1,ca=fs=null,f.updateQueue!=null){var B=f.updateQueue;B.lastEffect=null,B.events=null,B.stores=null,B.memoCache!=null&&(B.memoCache.index=0)}Me.H=RI,B=E(v,C)}while(YE);return B}function pI(){var f=Me.H,E=f.useState()[0];return E=typeof E.then=="function"?iT(E):E,f=f.useState()[0],(fs!==null?fs.memoizedState:null)!==f&&(xi.flags|=1024),E}function fI(){var f=zy!==0;return zy=0,f}function nT(f,E,v){E.updateQueue=f.updateQueue,E.flags&=-2053,f.lanes&=~v}function _I(f){if(zE){for(f=f.memoizedState;f!==null;){var E=f.queue;E!==null&&(E.pending=null),f=f.next}zE=!1}Bf=0,ca=fs=xi=null,YE=!1,tT=zy=0,qE=null}function rl(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ca===null?xi.memoizedState=ca=f:ca=ca.next=f,ca}function la(){if(fs===null){var f=xi.alternate;f=f!==null?f.memoizedState:null}else f=fs.next;var E=ca===null?xi.memoizedState:ca.next;if(E!==null)ca=E,fs=f;else{if(f===null)throw xi.alternate===null?Error(_(467)):Error(_(310));fs=f,f={memoizedState:fs.memoizedState,baseState:fs.baseState,baseQueue:fs.baseQueue,queue:fs.queue,next:null},ca===null?xi.memoizedState=ca=f:ca=ca.next=f}return ca}function Ep(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function iT(f){var E=tT;return tT+=1,qE===null&&(qE=[]),f=MO(qE,f,E),E=xi,(ca===null?E.memoizedState:ca.next)===null&&(E=E.alternate,Me.H=E===null||E.memoizedState===null?Ed:sl),f}function Yy(f){if(f!==null&&typeof f=="object"){if(typeof f.then=="function")return iT(f);if(f.$$typeof===Ae)return Oo(f)}throw Error(_(438,String(f)))}function mI(f){var E=null,v=xi.updateQueue;if(v!==null&&(E=v.memoCache),E==null){var C=xi.alternate;C!==null&&(C=C.updateQueue,C!==null&&(C=C.memoCache,C!=null&&(E={data:C.data.map(function(P){return P.slice()}),index:0})))}if(E==null&&(E={data:[],index:0}),v===null&&(v=Ep(),xi.updateQueue=v),v.memoCache=E,v=E.data[E.index],v===void 0)for(v=E.data[E.index]=Array(f),C=0;C<f;C++)v[C]=ye;return E.index++,v}function gp(f,E){return typeof E=="function"?E(f):E}function qy(f){var E=la();return EI(E,fs,f)}function EI(f,E,v){var C=f.queue;if(C===null)throw Error(_(311));C.lastRenderedReducer=v;var P=f.baseQueue,B=C.pending;if(B!==null){if(P!==null){var ce=P.next;P.next=B.next,B.next=ce}E.baseQueue=P=B,C.pending=null}if(B=f.baseState,P===null)f.memoizedState=B;else{E=P.next;var Ee=ce=null,Fe=null,Ze=E,Et=!1;do{var Nt=Ze.lane&-536870913;if(Nt!==Ze.lane?(_r&Nt)===Nt:(Bf&Nt)===Nt){var ot=Ze.revertLane;if(ot===0)Fe!==null&&(Fe=Fe.next={lane:0,revertLane:0,action:Ze.action,hasEagerState:Ze.hasEagerState,eagerState:Ze.eagerState,next:null}),Nt===GE&&(Et=!0);else if((Bf&ot)===ot){Ze=Ze.next,ot===GE&&(Et=!0);continue}else Nt={lane:0,revertLane:Ze.revertLane,action:Ze.action,hasEagerState:Ze.hasEagerState,eagerState:Ze.eagerState,next:null},Fe===null?(Ee=Fe=Nt,ce=B):Fe=Fe.next=Nt,xi.lanes|=ot,al|=ot;Nt=Ze.action,im&&v(B,Nt),B=Ze.hasEagerState?Ze.eagerState:v(B,Nt)}else ot={lane:Nt,revertLane:Ze.revertLane,action:Ze.action,hasEagerState:Ze.hasEagerState,eagerState:Ze.eagerState,next:null},Fe===null?(Ee=Fe=ot,ce=B):Fe=Fe.next=ot,xi.lanes|=Nt,al|=Nt;Ze=Ze.next}while(Ze!==null&&Ze!==E);if(Fe===null?ce=B:Fe.next=Ee,!Ll(B,f.memoizedState)&&(xa=!0,Et&&(v=WE,v!==null)))throw v;f.memoizedState=B,f.baseState=ce,f.baseQueue=Fe,C.lastRenderedState=B}return P===null&&(C.lanes=0),[f.memoizedState,C.dispatch]}function rm(f){var E=la(),v=E.queue;if(v===null)throw Error(_(311));v.lastRenderedReducer=f;var C=v.dispatch,P=v.pending,B=E.memoizedState;if(P!==null){v.pending=null;var ce=P=P.next;do B=f(B,ce.action),ce=ce.next;while(ce!==P);Ll(B,E.memoizedState)||(xa=!0),E.memoizedState=B,E.baseQueue===null&&(E.baseState=B),v.lastRenderedState=B}return[B,C]}function BO(f,E,v){var C=xi,P=la(),B=Hr;if(B){if(v===void 0)throw Error(_(407));v=v()}else v=E();var ce=!Ll((fs||P).memoizedState,v);ce&&(P.memoizedState=v,xa=!0),P=P.queue;var Ee=Jy.bind(null,C,P,f);if(sm(2048,8,Ee,[f]),P.getSnapshot!==E||ce||ca!==null&&ca.memoizedState.tag&1){if(C.flags|=2048,XE(9,eR(),jO.bind(null,C,P,v,E),null),Fs===null)throw Error(_(349));B||(Bf&124)!==0||Xy(C,E,v)}return v}function Xy(f,E,v){f.flags|=16384,f={getSnapshot:E,value:v},E=xi.updateQueue,E===null?(E=Ep(),xi.updateQueue=E,E.stores=[f]):(v=E.stores,v===null?E.stores=[f]:v.push(f))}function jO(f,E,v,C){E.value=v,E.getSnapshot=C,GO(E)&&WO(f)}function Jy(f,E,v){return v(function(){GO(E)&&WO(f)})}function GO(f){var E=f.getSnapshot;f=f.value;try{var v=E();return!Ll(f,v)}catch{return!0}}function WO(f){var E=VE(f,2);E!==null&&kc(E,f,2)}function gI(f){var E=rl();if(typeof f=="function"){var v=f;if(f=v(),im){un(!0);try{v()}finally{un(!1)}}}return E.memoizedState=E.baseState=f,E.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:gp,lastRenderedState:f},E}function HO(f,E,v,C){return f.baseState=v,EI(f,fs,typeof C=="function"?C:gp)}function TL(f,E,v,C,P){if(eg(f))throw Error(_(485));if(f=E.action,f!==null){var B={payload:P,action:f,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ce){B.listeners.push(ce)}};Me.T!==null?v(!0):B.isTransition=!1,C(B),v=E.pending,v===null?(B.next=E.pending=B,KO(E,B)):(B.next=v.next,E.pending=v.next=B)}}function KO(f,E){var v=E.action,C=E.payload,P=f.state;if(E.isTransition){var B=Me.T,ce={};Me.T=ce;try{var Ee=v(P,C),Fe=Me.S;Fe!==null&&Fe(ce,Ee),Qy(f,E,Ee)}catch(Ze){SI(f,E,Ze)}finally{Me.T=B}}else try{B=v(P,C),Qy(f,E,B)}catch(Ze){SI(f,E,Ze)}}function Qy(f,E,v){v!==null&&typeof v=="object"&&typeof v.then=="function"?v.then(function(C){zO(f,E,C)},function(C){return SI(f,E,C)}):zO(f,E,v)}function zO(f,E,v){E.status="fulfilled",E.value=v,Zy(E),f.state=v,E=f.pending,E!==null&&(v=E.next,v===E?f.pending=null:(v=v.next,E.next=v,KO(f,v)))}function SI(f,E,v){var C=f.pending;if(f.pending=null,C!==null){C=C.next;do E.status="rejected",E.reason=v,Zy(E),E=E.next;while(E!==C)}f.action=null}function Zy(f){f=f.listeners;for(var E=0;E<f.length;E++)(0,f[E])()}function YO(f,E){return E}function jf(f,E){if(Hr){var v=Fs.formState;if(v!==null){e:{var C=xi;if(Hr){if(ps){t:{for(var P=ps,B=Zu;P.nodeType!==8;){if(!B){P=null;break t}if(P=au(P.nextSibling),P===null){P=null;break t}}B=P.data,P=B==="F!"||B==="F"?P:null}if(P){ps=au(P.nextSibling),C=P.data==="F!";break e}}em(C)}C=!1}C&&(E=v[0])}}return v=rl(),v.memoizedState=v.baseState=E,C={pending:null,lanes:0,dispatch:null,lastRenderedReducer:YO,lastRenderedState:E},v.queue=C,v=$E.bind(null,xi,C),C.dispatch=v,C=gI(!1),B=yI.bind(null,xi,!1,C.queue),C=rl(),P={state:E,dispatch:null,action:f,pending:null},C.queue=P,v=TL.bind(null,xi,P,B,v),P.dispatch=v,C.memoizedState=f,[E,v,!1]}function $y(f){var E=la();return eh(E,fs,f)}function eh(f,E,v){if(E=EI(f,E,YO)[0],f=qy(gp)[0],typeof E=="object"&&E!==null&&typeof E.then=="function")try{var C=iT(E)}catch(ce){throw ce===pp?Wy:ce}else C=E;E=la();var P=E.queue,B=P.dispatch;return v!==E.memoizedState&&(xi.flags|=2048,XE(9,eR(),vL.bind(null,P,v),null)),[C,B,f]}function vL(f,E){f.action=E}function qO(f){var E=la(),v=fs;if(v!==null)return eh(E,v,f);la(),E=E.memoizedState,v=la();var C=v.queue.dispatch;return v.memoizedState=f,[E,C,!1]}function XE(f,E,v,C){return f={tag:f,create:v,deps:C,inst:E,next:null},E=xi.updateQueue,E===null&&(E=Ep(),xi.updateQueue=E),v=E.lastEffect,v===null?E.lastEffect=f.next=f:(C=v.next,v.next=f,f.next=C,E.lastEffect=f),f}function eR(){return{destroy:void 0,resource:void 0}}function Gf(){return la().memoizedState}function tR(f,E,v,C){var P=rl();C=C===void 0?null:C,xi.flags|=f,P.memoizedState=XE(1|E,eR(),v,C)}function sm(f,E,v,C){var P=la();C=C===void 0?null:C;var B=P.memoizedState.inst;fs!==null&&C!==null&&Vl(C,fs.memoizedState.deps)?P.memoizedState=XE(E,B,v,C):(xi.flags|=f,P.memoizedState=XE(1|E,B,v,C))}function JE(f,E){tR(8390656,8,f,E)}function QE(f,E){sm(2048,8,f,E)}function XO(f,E){return sm(4,2,f,E)}function JO(f,E){return sm(4,4,f,E)}function QO(f,E){if(typeof E=="function"){f=f();var v=E(f);return function(){typeof v=="function"?v():E(null)}}if(E!=null)return f=f(),E.current=f,function(){E.current=null}}function ZO(f,E,v){v=v!=null?v.concat([f]):null,sm(4,4,QO.bind(null,E,f),v)}function TI(){}function Wf(f,E){var v=la();E=E===void 0?null:E;var C=v.memoizedState;return E!==null&&Vl(E,C[1])?C[0]:(v.memoizedState=[f,E],f)}function $O(f,E){var v=la();E=E===void 0?null:E;var C=v.memoizedState;if(E!==null&&Vl(E,C[1]))return C[0];if(C=f(),im){un(!0);try{f()}finally{un(!1)}}return v.memoizedState=[C,E],C}function Fl(f,E,v){return v===void 0||(Bf&1073741824)!==0?f.memoizedState=E:(f.memoizedState=v,f=dg(),xi.lanes|=f,al|=f,v)}function ZE(f,E,v,C){return Ll(v,E)?v:Vf.current!==null?(f=Fl(f,v,C),Ll(f,E)||(xa=!0),f):(Bf&42)===0?(xa=!0,f.memoizedState=v):(f=dg(),xi.lanes|=f,al|=f,E)}function Hf(f,E,v,C,P){var B=Je.p;Je.p=B!==0&&8>B?B:8;var ce=Me.T,Ee={};Me.T=Ee,yI(f,!1,E,v);try{var Fe=P(),Ze=Me.S;if(Ze!==null&&Ze(Ee,Fe),Fe!==null&&typeof Fe=="object"&&typeof Fe.then=="function"){var Et=gL(Fe,C);sT(f,E,Et,Gl(f))}else sT(f,E,C,Gl(f))}catch(Nt){sT(f,E,{then:function(){},status:"rejected",reason:Nt},Gl())}finally{Je.p=B,Me.T=ce}}function Sp(){}function Tp(f,E,v,C){if(f.tag!==5)throw Error(_(476));var P=eN(f).queue;Hf(f,P,E,mt,v===null?Sp:function(){return nR(f),v(C)})}function eN(f){var E=f.memoizedState;if(E!==null)return E;E={memoizedState:mt,baseState:mt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gp,lastRenderedState:mt},next:null};var v={};return E.next={memoizedState:v,baseState:v,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gp,lastRenderedState:v},next:null},f.memoizedState=E,f=f.alternate,f!==null&&(f.memoizedState=E),E}function nR(f){var E=eN(f).next.queue;sT(f,E,{},Gl())}function vI(){return Oo(NT)}function iR(){return la().memoizedState}function tN(){return la().memoizedState}function yL(f){for(var E=f.return;E!==null;){switch(E.tag){case 24:case 3:var v=Gl();f=xf(v);var C=$u(E,f,v);C!==null&&(kc(C,E,v),eT(C,E,v)),E={cache:nm()},f.payload=E;return}E=E.return}}function rT(f,E,v){var C=Gl();v={lane:C,revertLane:0,action:v,hasEagerState:!1,eagerState:null,next:null},eg(f)?tg(E,v):(v=Zb(f,E,v,C),v!==null&&(kc(v,f,C),nN(v,E,C)))}function $E(f,E,v){var C=Gl();sT(f,E,v,C)}function sT(f,E,v,C){var P={lane:C,revertLane:0,action:v,hasEagerState:!1,eagerState:null,next:null};if(eg(f))tg(E,P);else{var B=f.alternate;if(f.lanes===0&&(B===null||B.lanes===0)&&(B=E.lastRenderedReducer,B!==null))try{var ce=E.lastRenderedState,Ee=B(ce,v);if(P.hasEagerState=!0,P.eagerState=Ee,Ll(Ee,ce))return fd(f,E,P,0),Fs===null&&Qu(),!1}catch{}finally{}if(v=Zb(f,E,P,C),v!==null)return kc(v,f,C),nN(v,E,C),!0}return!1}function yI(f,E,v,C){if(C={lane:2,revertLane:Op(),action:C,hasEagerState:!1,eagerState:null,next:null},eg(f)){if(E)throw Error(_(479))}else E=Zb(f,v,C,2),E!==null&&kc(E,f,2)}function eg(f){var E=f.alternate;return f===xi||E!==null&&E===xi}function tg(f,E){YE=zE=!0;var v=f.pending;v===null?E.next=E:(E.next=v.next,v.next=E),f.pending=E}function nN(f,E,v){if((v&4194048)!==0){var C=E.lanes;C&=f.pendingLanes,v|=C,E.lanes=v,ju(f,v)}}var No={readContext:Oo,use:Yy,useCallback:fo,useContext:fo,useEffect:fo,useImperativeHandle:fo,useLayoutEffect:fo,useInsertionEffect:fo,useMemo:fo,useReducer:fo,useRef:fo,useState:fo,useDebugValue:fo,useDeferredValue:fo,useTransition:fo,useSyncExternalStore:fo,useId:fo,useHostTransitionStatus:fo,useFormState:fo,useActionState:fo,useOptimistic:fo,useMemoCache:fo,useCacheRefresh:fo},Ed={readContext:Oo,use:Yy,useCallback:function(f,E){return rl().memoizedState=[f,E===void 0?null:E],f},useContext:Oo,useEffect:JE,useImperativeHandle:function(f,E,v){v=v!=null?v.concat([f]):null,tR(4194308,4,QO.bind(null,E,f),v)},useLayoutEffect:function(f,E){return tR(4194308,4,f,E)},useInsertionEffect:function(f,E){tR(4,2,f,E)},useMemo:function(f,E){var v=rl();E=E===void 0?null:E;var C=f();if(im){un(!0);try{f()}finally{un(!1)}}return v.memoizedState=[C,E],C},useReducer:function(f,E,v){var C=rl();if(v!==void 0){var P=v(E);if(im){un(!0);try{v(E)}finally{un(!1)}}}else P=E;return C.memoizedState=C.baseState=P,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:P},C.queue=f,f=f.dispatch=rT.bind(null,xi,f),[C.memoizedState,f]},useRef:function(f){var E=rl();return f={current:f},E.memoizedState=f},useState:function(f){f=gI(f);var E=f.queue,v=$E.bind(null,xi,E);return E.dispatch=v,[f.memoizedState,v]},useDebugValue:TI,useDeferredValue:function(f,E){var v=rl();return Fl(v,f,E)},useTransition:function(){var f=gI(!1);return f=Hf.bind(null,xi,f.queue,!0,!1),rl().memoizedState=f,[!1,f]},useSyncExternalStore:function(f,E,v){var C=xi,P=rl();if(Hr){if(v===void 0)throw Error(_(407));v=v()}else{if(v=E(),Fs===null)throw Error(_(349));(_r&124)!==0||Xy(C,E,v)}P.memoizedState=v;var B={value:v,getSnapshot:E};return P.queue=B,JE(Jy.bind(null,C,B,f),[f]),C.flags|=2048,XE(9,eR(),jO.bind(null,C,B,v,E),null),v},useId:function(){var f=rl(),E=Fs.identifierPrefix;if(Hr){var v=Ul,C=cp;v=(C&~(1<<32-rn(C)-1)).toString(32)+v,E="«"+E+"R"+v,v=zy++,0<v&&(E+="H"+v.toString(32)),E+="»"}else v=SL++,E="«"+E+"r"+v.toString(32)+"»";return f.memoizedState=E},useHostTransitionStatus:vI,useFormState:jf,useActionState:jf,useOptimistic:function(f){var E=rl();E.memoizedState=E.baseState=f;var v={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return E.queue=v,E=yI.bind(null,xi,!0,v),v.dispatch=E,[f,E]},useMemoCache:mI,useCacheRefresh:function(){return rl().memoizedState=yL.bind(null,xi)}},sl={readContext:Oo,use:Yy,useCallback:Wf,useContext:Oo,useEffect:QE,useImperativeHandle:ZO,useInsertionEffect:XO,useLayoutEffect:JO,useMemo:$O,useReducer:qy,useRef:Gf,useState:function(){return qy(gp)},useDebugValue:TI,useDeferredValue:function(f,E){var v=la();return ZE(v,fs.memoizedState,f,E)},useTransition:function(){var f=qy(gp)[0],E=la().memoizedState;return[typeof f=="boolean"?f:iT(f),E]},useSyncExternalStore:BO,useId:iR,useHostTransitionStatus:vI,useFormState:$y,useActionState:$y,useOptimistic:function(f,E){var v=la();return HO(v,fs,f,E)},useMemoCache:mI,useCacheRefresh:tN},RI={readContext:Oo,use:Yy,useCallback:Wf,useContext:Oo,useEffect:QE,useImperativeHandle:ZO,useInsertionEffect:XO,useLayoutEffect:JO,useMemo:$O,useReducer:rm,useRef:Gf,useState:function(){return rm(gp)},useDebugValue:TI,useDeferredValue:function(f,E){var v=la();return fs===null?Fl(v,f,E):ZE(v,fs.memoizedState,f,E)},useTransition:function(){var f=rm(gp)[0],E=la().memoizedState;return[typeof f=="boolean"?f:iT(f),E]},useSyncExternalStore:BO,useId:iR,useHostTransitionStatus:vI,useFormState:qO,useActionState:qO,useOptimistic:function(f,E){var v=la();return fs!==null?HO(v,fs,f,E):(v.baseState=f,[f,v.queue.dispatch])},useMemoCache:mI,useCacheRefresh:tN},Kf=null,$a=0;function zf(f){var E=$a;return $a+=1,Kf===null&&(Kf=[]),MO(Kf,f,E)}function oT(f,E){E=E.props.ref,f.ref=E!==void 0?E:null}function ng(f,E){throw E.$$typeof===J?Error(_(525)):(f=Object.prototype.toString.call(E),Error(_(31,f==="[object Object]"?"object with keys {"+Object.keys(E).join(", ")+"}":f)))}function iN(f){var E=f._init;return E(f._payload)}function rR(f){function E(Qe,Ke){if(f){var et=Qe.deletions;et===null?(Qe.deletions=[Ke],Qe.flags|=16):et.push(Ke)}}function v(Qe,Ke){if(!f)return null;for(;Ke!==null;)E(Qe,Ke),Ke=Ke.sibling;return null}function C(Qe){for(var Ke=new Map;Qe!==null;)Qe.key!==null?Ke.set(Qe.key,Qe):Ke.set(Qe.index,Qe),Qe=Qe.sibling;return Ke}function P(Qe,Ke){return Qe=op(Qe,Ke),Qe.index=0,Qe.sibling=null,Qe}function B(Qe,Ke,et){return Qe.index=et,f?(et=Qe.alternate,et!==null?(et=et.index,et<Ke?(Qe.flags|=67108866,Ke):et):(Qe.flags|=67108866,Ke)):(Qe.flags|=1048576,Ke)}function ce(Qe){return f&&Qe.alternate===null&&(Qe.flags|=67108866),Qe}function Ee(Qe,Ke,et,bt){return Ke===null||Ke.tag!==6?(Ke=Ks(et,Qe.mode,bt),Ke.return=Qe,Ke):(Ke=P(Ke,et),Ke.return=Qe,Ke)}function Fe(Qe,Ke,et,bt){var Zt=et.type;return Zt===oe?Et(Qe,Ke,et.props.children,bt,et.key):Ke!==null&&(Ke.elementType===Zt||typeof Zt=="object"&&Zt!==null&&Zt.$$typeof===he&&iN(Zt)===Ke.type)?(Ke=P(Ke,et.props),oT(Ke,et),Ke.return=Qe,Ke):(Ke=Uy(et.type,et.key,et.props,null,Qe.mode,bt),oT(Ke,et),Ke.return=Qe,Ke)}function Ze(Qe,Ke,et,bt){return Ke===null||Ke.tag!==4||Ke.stateNode.containerInfo!==et.containerInfo||Ke.stateNode.implementation!==et.implementation?(Ke=eI(et,Qe.mode,bt),Ke.return=Qe,Ke):(Ke=P(Ke,et.children||[]),Ke.return=Qe,Ke)}function Et(Qe,Ke,et,bt,Zt){return Ke===null||Ke.tag!==7?(Ke=ap(et,Qe.mode,bt,Zt),Ke.return=Qe,Ke):(Ke=P(Ke,et),Ke.return=Qe,Ke)}function Nt(Qe,Ke,et){if(typeof Ke=="string"&&Ke!==""||typeof Ke=="number"||typeof Ke=="bigint")return Ke=Ks(""+Ke,Qe.mode,et),Ke.return=Qe,Ke;if(typeof Ke=="object"&&Ke!==null){switch(Ke.$$typeof){case ee:return et=Uy(Ke.type,Ke.key,Ke.props,null,Qe.mode,et),oT(et,Ke),et.return=Qe,et;case ue:return Ke=eI(Ke,Qe.mode,et),Ke.return=Qe,Ke;case he:var bt=Ke._init;return Ke=bt(Ke._payload),Nt(Qe,Ke,et)}if(ct(Ke)||$(Ke))return Ke=ap(Ke,Qe.mode,et,null),Ke.return=Qe,Ke;if(typeof Ke.then=="function")return Nt(Qe,zf(Ke),et);if(Ke.$$typeof===Ae)return Nt(Qe,Uf(Qe,Ke),et);ng(Qe,Ke)}return null}function ot(Qe,Ke,et,bt){var Zt=Ke!==null?Ke.key:null;if(typeof et=="string"&&et!==""||typeof et=="number"||typeof et=="bigint")return Zt!==null?null:Ee(Qe,Ke,""+et,bt);if(typeof et=="object"&&et!==null){switch(et.$$typeof){case ee:return et.key===Zt?Fe(Qe,Ke,et,bt):null;case ue:return et.key===Zt?Ze(Qe,Ke,et,bt):null;case he:return Zt=et._init,et=Zt(et._payload),ot(Qe,Ke,et,bt)}if(ct(et)||$(et))return Zt!==null?null:Et(Qe,Ke,et,bt,null);if(typeof et.then=="function")return ot(Qe,Ke,zf(et),bt);if(et.$$typeof===Ae)return ot(Qe,Ke,Uf(Qe,et),bt);ng(Qe,et)}return null}function at(Qe,Ke,et,bt,Zt){if(typeof bt=="string"&&bt!==""||typeof bt=="number"||typeof bt=="bigint")return Qe=Qe.get(et)||null,Ee(Ke,Qe,""+bt,Zt);if(typeof bt=="object"&&bt!==null){switch(bt.$$typeof){case ee:return Qe=Qe.get(bt.key===null?et:bt.key)||null,Fe(Ke,Qe,bt,Zt);case ue:return Qe=Qe.get(bt.key===null?et:bt.key)||null,Ze(Ke,Qe,bt,Zt);case he:var qi=bt._init;return bt=qi(bt._payload),at(Qe,Ke,et,bt,Zt)}if(ct(bt)||$(bt))return Qe=Qe.get(et)||null,Et(Ke,Qe,bt,Zt,null);if(typeof bt.then=="function")return at(Qe,Ke,et,zf(bt),Zt);if(bt.$$typeof===Ae)return at(Qe,Ke,et,Uf(Ke,bt),Zt);ng(Ke,bt)}return null}function Si(Qe,Ke,et,bt){for(var Zt=null,qi=null,Bn=Ke,pi=Ke=0,Fa=null;Bn!==null&&pi<et.length;pi++){Bn.index>pi?(Fa=Bn,Bn=null):Fa=Bn.sibling;var mr=ot(Qe,Bn,et[pi],bt);if(mr===null){Bn===null&&(Bn=Fa);break}f&&Bn&&mr.alternate===null&&E(Qe,Bn),Ke=B(mr,Ke,pi),qi===null?Zt=mr:qi.sibling=mr,qi=mr,Bn=Fa}if(pi===et.length)return v(Qe,Bn),Hr&&Z_(Qe,pi),Zt;if(Bn===null){for(;pi<et.length;pi++)Bn=Nt(Qe,et[pi],bt),Bn!==null&&(Ke=B(Bn,Ke,pi),qi===null?Zt=Bn:qi.sibling=Bn,qi=Bn);return Hr&&Z_(Qe,pi),Zt}for(Bn=C(Bn);pi<et.length;pi++)Fa=at(Bn,Qe,pi,et[pi],bt),Fa!==null&&(f&&Fa.alternate!==null&&Bn.delete(Fa.key===null?pi:Fa.key),Ke=B(Fa,Ke,pi),qi===null?Zt=Fa:qi.sibling=Fa,qi=Fa);return f&&Bn.forEach(function(uh){return E(Qe,uh)}),Hr&&Z_(Qe,pi),Zt}function Xn(Qe,Ke,et,bt){if(et==null)throw Error(_(151));for(var Zt=null,qi=null,Bn=Ke,pi=Ke=0,Fa=null,mr=et.next();Bn!==null&&!mr.done;pi++,mr=et.next()){Bn.index>pi?(Fa=Bn,Bn=null):Fa=Bn.sibling;var uh=ot(Qe,Bn,mr.value,bt);if(uh===null){Bn===null&&(Bn=Fa);break}f&&Bn&&uh.alternate===null&&E(Qe,Bn),Ke=B(uh,Ke,pi),qi===null?Zt=uh:qi.sibling=uh,qi=uh,Bn=Fa}if(mr.done)return v(Qe,Bn),Hr&&Z_(Qe,pi),Zt;if(Bn===null){for(;!mr.done;pi++,mr=et.next())mr=Nt(Qe,mr.value,bt),mr!==null&&(Ke=B(mr,Ke,pi),qi===null?Zt=mr:qi.sibling=mr,qi=mr);return Hr&&Z_(Qe,pi),Zt}for(Bn=C(Bn);!mr.done;pi++,mr=et.next())mr=at(Bn,Qe,pi,mr.value,bt),mr!==null&&(f&&mr.alternate!==null&&Bn.delete(mr.key===null?pi:mr.key),Ke=B(mr,Ke,pi),qi===null?Zt=mr:qi.sibling=mr,qi=mr);return f&&Bn.forEach(function(s1){return E(Qe,s1)}),Hr&&Z_(Qe,pi),Zt}function _s(Qe,Ke,et,bt){if(typeof et=="object"&&et!==null&&et.type===oe&&et.key===null&&(et=et.props.children),typeof et=="object"&&et!==null){switch(et.$$typeof){case ee:e:{for(var Zt=et.key;Ke!==null;){if(Ke.key===Zt){if(Zt=et.type,Zt===oe){if(Ke.tag===7){v(Qe,Ke.sibling),bt=P(Ke,et.props.children),bt.return=Qe,Qe=bt;break e}}else if(Ke.elementType===Zt||typeof Zt=="object"&&Zt!==null&&Zt.$$typeof===he&&iN(Zt)===Ke.type){v(Qe,Ke.sibling),bt=P(Ke,et.props),oT(bt,et),bt.return=Qe,Qe=bt;break e}v(Qe,Ke);break}else E(Qe,Ke);Ke=Ke.sibling}et.type===oe?(bt=ap(et.props.children,Qe.mode,bt,et.key),bt.return=Qe,Qe=bt):(bt=Uy(et.type,et.key,et.props,null,Qe.mode,bt),oT(bt,et),bt.return=Qe,Qe=bt)}return ce(Qe);case ue:e:{for(Zt=et.key;Ke!==null;){if(Ke.key===Zt)if(Ke.tag===4&&Ke.stateNode.containerInfo===et.containerInfo&&Ke.stateNode.implementation===et.implementation){v(Qe,Ke.sibling),bt=P(Ke,et.children||[]),bt.return=Qe,Qe=bt;break e}else{v(Qe,Ke);break}else E(Qe,Ke);Ke=Ke.sibling}bt=eI(et,Qe.mode,bt),bt.return=Qe,Qe=bt}return ce(Qe);case he:return Zt=et._init,et=Zt(et._payload),_s(Qe,Ke,et,bt)}if(ct(et))return Si(Qe,Ke,et,bt);if($(et)){if(Zt=$(et),typeof Zt!="function")throw Error(_(150));return et=Zt.call(et),Xn(Qe,Ke,et,bt)}if(typeof et.then=="function")return _s(Qe,Ke,zf(et),bt);if(et.$$typeof===Ae)return _s(Qe,Ke,Uf(Qe,et),bt);ng(Qe,et)}return typeof et=="string"&&et!==""||typeof et=="number"||typeof et=="bigint"?(et=""+et,Ke!==null&&Ke.tag===6?(v(Qe,Ke.sibling),bt=P(Ke,et),bt.return=Qe,Qe=bt):(v(Qe,Ke),bt=Ks(et,Qe.mode,bt),bt.return=Qe,Qe=bt),ce(Qe)):v(Qe,Ke)}return function(Qe,Ke,et,bt){try{$a=0;var Zt=_s(Qe,Ke,et,bt);return Kf=null,Zt}catch(Bn){if(Bn===pp||Bn===Wy)throw Bn;var qi=Ml(29,Bn,null,Qe.mode);return qi.lanes=bt,qi.return=Qe,qi}finally{}}}var Yf=rR(!0),rN=rR(!1),Vs=it(null),th=null;function qf(f){var E=f.alternate;pt(va,va.current&1),pt(Vs,f),th===null&&(E===null||Vf.current!==null||E.memoizedState!==null)&&(th=f)}function sN(f){if(f.tag===22){if(pt(va,va.current),pt(Vs,f),th===null){var E=f.alternate;E!==null&&E.memoizedState!==null&&(th=f)}}else Xf()}function Xf(){pt(va,va.current),pt(Vs,Vs.current)}function $d(f){ft(Vs),th===f&&(th=null),ft(va)}var va=it(0);function Jf(f){for(var E=f;E!==null;){if(E.tag===13){var v=E.memoizedState;if(v!==null&&(v=v.dehydrated,v===null||v.data==="$?"||bT(v)))return E}else if(E.tag===19&&E.memoizedProps.revealOrder!==void 0){if((E.flags&128)!==0)return E}else if(E.child!==null){E.child.return=E,E=E.child;continue}if(E===f)break;for(;E.sibling===null;){if(E.return===null||E.return===f)return null;E=E.return}E.sibling.return=E.return,E=E.sibling}return null}function aT(f,E,v,C){E=f.memoizedState,v=v(C,E),v=v==null?E:q({},E,v),f.memoizedState=v,f.lanes===0&&(f.updateQueue.baseState=v)}var CI={enqueueSetState:function(f,E,v){f=f._reactInternals;var C=Gl(),P=xf(C);P.payload=E,v!=null&&(P.callback=v),E=$u(f,P,C),E!==null&&(kc(E,f,C),eT(E,f,C))},enqueueReplaceState:function(f,E,v){f=f._reactInternals;var C=Gl(),P=xf(C);P.tag=1,P.payload=E,v!=null&&(P.callback=v),E=$u(f,P,C),E!==null&&(kc(E,f,C),eT(E,f,C))},enqueueForceUpdate:function(f,E){f=f._reactInternals;var v=Gl(),C=xf(v);C.tag=2,E!=null&&(C.callback=E),E=$u(f,C,v),E!==null&&(kc(E,f,v),eT(E,f,v))}};function sR(f,E,v,C,P,B,ce){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(C,B,ce):E.prototype&&E.prototype.isPureReactComponent?!Xd(v,C)||!Xd(P,B):!0}function oN(f,E,v,C){f=E.state,typeof E.componentWillReceiveProps=="function"&&E.componentWillReceiveProps(v,C),typeof E.UNSAFE_componentWillReceiveProps=="function"&&E.UNSAFE_componentWillReceiveProps(v,C),E.state!==f&&CI.enqueueReplaceState(E,E.state,null)}function om(f,E){var v=E;if("ref"in E){v={};for(var C in E)C!=="ref"&&(v[C]=E[C])}if(f=f.defaultProps){v===E&&(v=q({},v));for(var P in f)v[P]===void 0&&(v[P]=f[P])}return v}var oR=typeof reportError=="function"?reportError:function(f){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var E=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof f=="object"&&f!==null&&typeof f.message=="string"?String(f.message):String(f),error:f});if(!window.dispatchEvent(E))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",f);return}console.error(f)};function aN(f){oR(f)}function cN(f){console.error(f)}function lN(f){oR(f)}function aR(f,E){try{var v=f.onUncaughtError;v(E.value,{componentStack:E.stack})}catch(C){setTimeout(function(){throw C})}}function cR(f,E,v){try{var C=f.onCaughtError;C(v.value,{componentStack:v.stack,errorBoundary:E.tag===1?E.stateNode:null})}catch(P){setTimeout(function(){throw P})}}function ya(f,E,v){return v=xf(v),v.tag=3,v.payload={element:null},v.callback=function(){aR(f,E)},v}function dN(f){return f=xf(f),f.tag=3,f}function uN(f,E,v,C){var P=v.type.getDerivedStateFromError;if(typeof P=="function"){var B=C.value;f.payload=function(){return P(B)},f.callback=function(){cR(E,v,C)}}var ce=v.stateNode;ce!==null&&typeof ce.componentDidCatch=="function"&&(f.callback=function(){cR(E,v,C),typeof P!="function"&&(oh===null?oh=new Set([this]):oh.add(this));var Ee=C.stack;this.componentDidCatch(C.value,{componentStack:Ee!==null?Ee:""})})}function RL(f,E,v,C,P){if(v.flags|=32768,C!==null&&typeof C=="object"&&typeof C.then=="function"){if(E=v.alternate,E!==null&&XS(E,v,P,!0),v=Vs.current,v!==null){switch(v.tag){case 13:return th===null?su():v.alternate===null&&no===0&&(no=3),v.flags&=-257,v.flags|=65536,v.lanes=P,C===fp?v.flags|=16384:(E=v.updateQueue,E===null?v.updateQueue=new Set([C]):E.add(C),Ap(f,C,P)),!1;case 22:return v.flags|=65536,C===fp?v.flags|=16384:(E=v.updateQueue,E===null?(E={transitions:null,markerInstances:null,retryQueue:new Set([C])},v.updateQueue=E):(v=E.retryQueue,v===null?E.retryQueue=new Set([C]):v.add(C)),Ap(f,C,P)),!1}throw Error(_(435,v.tag))}return Ap(f,C,P),su(),!1}if(Hr)return E=Vs.current,E!==null?((E.flags&65536)===0&&(E.flags|=256),E.flags|=65536,E.lanes=P,C!==nI&&(f=Error(_(422),{cause:C}),qS(el(f,v)))):(C!==nI&&(E=Error(_(423),{cause:C}),qS(el(E,v))),f=f.current.alternate,f.flags|=65536,P&=-P,f.lanes|=P,C=el(C,v),P=ya(f.stateNode,C,P),lI(f,P),no!==4&&(no=2)),!1;var B=Error(_(520),{cause:C});if(B=el(B,v),pm===null?pm=[B]:pm.push(B),no!==4&&(no=2),E===null)return!0;C=el(C,v),v=E;do{switch(v.tag){case 3:return v.flags|=65536,f=P&-P,v.lanes|=f,f=ya(v.stateNode,C,f),lI(v,f),!1;case 1:if(E=v.type,B=v.stateNode,(v.flags&128)===0&&(typeof E.getDerivedStateFromError=="function"||B!==null&&typeof B.componentDidCatch=="function"&&(oh===null||!oh.has(B))))return v.flags|=65536,P&=-P,v.lanes|=P,P=dN(P),uN(P,f,v,C),lI(v,P),!1}v=v.return}while(v!==null);return!1}var hN=Error(_(461)),xa=!1;function ec(f,E,v,C){E.child=f===null?rN(E,null,v,C):Yf(E,f.child,v,C)}function ig(f,E,v,C,P){v=v.render;var B=E.ref;if("ref"in C){var ce={};for(var Ee in C)Ee!=="ref"&&(ce[Ee]=C[Ee])}else ce=C;return xl(E),C=hI(f,E,v,ce,B,P),Ee=fI(),f!==null&&!xa?(nT(f,E,P),eu(f,E,P)):(Hr&&Ee&&zS(E),E.flags|=1,ec(f,E,C,P),E.child)}function pN(f,E,v,C,P){if(f===null){var B=v.type;return typeof B=="function"&&!$b(B)&&B.defaultProps===void 0&&v.compare===null?(E.tag=15,E.type=B,fN(f,E,B,C,P)):(f=Uy(v.type,null,C,E,E.mode,P),f.ref=E.ref,f.return=E,E.child=f)}if(B=f.child,!cT(f,P)){var ce=B.memoizedProps;if(v=v.compare,v=v!==null?v:Xd,v(ce,C)&&f.ref===E.ref)return eu(f,E,P)}return E.flags|=1,f=op(B,C),f.ref=E.ref,f.return=E,E.child=f}function fN(f,E,v,C,P){if(f!==null){var B=f.memoizedProps;if(Xd(B,C)&&f.ref===E.ref)if(xa=!1,E.pendingProps=C=B,cT(f,P))(f.flags&131072)!==0&&(xa=!0);else return E.lanes=f.lanes,eu(f,E,P)}return bI(f,E,v,C,P)}function _N(f,E,v){var C=E.pendingProps,P=C.children,B=f!==null?f.memoizedState:null;if(C.mode==="hidden"){if((E.flags&128)!==0){if(C=B!==null?B.baseLanes|v:v,f!==null){for(P=E.child=f.child,B=0;P!==null;)B=B|P.lanes|P.childLanes,P=P.sibling;E.childLanes=B&~C}else E.childLanes=0,E.child=null;return mN(f,E,C,v)}if((v&536870912)!==0)E.memoizedState={baseLanes:0,cachePool:null},f!==null&&Gy(E,B!==null?B.cachePool:null),B!==null?Ff(E,B):Zd(),sN(E);else return E.lanes=E.childLanes=536870912,mN(f,E,B!==null?B.baseLanes|v:v,v)}else B!==null?(Gy(E,B.cachePool),Ff(E,B),Xf(),E.memoizedState=null):(f!==null&&Gy(E,null),Zd(),Xf());return ec(f,E,P,v),E.child}function mN(f,E,v,C){var P=aI();return P=P===null?null:{parent:jo._currentValue,pool:P},E.memoizedState={baseLanes:v,cachePool:P},f!==null&&Gy(E,null),Zd(),sN(E),f!==null&&XS(f,E,C,!0),null}function lR(f,E){var v=E.ref;if(v===null)f!==null&&f.ref!==null&&(E.flags|=4194816);else{if(typeof v!="function"&&typeof v!="object")throw Error(_(284));(f===null||f.ref!==v)&&(E.flags|=4194816)}}function bI(f,E,v,C,P){return xl(E),v=hI(f,E,v,C,void 0,P),C=fI(),f!==null&&!xa?(nT(f,E,P),eu(f,E,P)):(Hr&&C&&zS(E),E.flags|=1,ec(f,E,v,P),E.child)}function dR(f,E,v,C,P,B){return xl(E),E.updateQueue=null,v=FO(E,C,v,P),VO(f),C=fI(),f!==null&&!xa?(nT(f,E,B),eu(f,E,B)):(Hr&&C&&zS(E),E.flags|=1,ec(f,E,v,B),E.child)}function uR(f,E,v,C,P){if(xl(E),E.stateNode===null){var B=_d,ce=v.contextType;typeof ce=="object"&&ce!==null&&(B=Oo(ce)),B=new v(C,B),E.memoizedState=B.state!==null&&B.state!==void 0?B.state:null,B.updater=CI,E.stateNode=B,B._reactInternals=E,B=E.stateNode,B.props=C,B.state=E.memoizedState,B.refs={},$S(E),ce=v.contextType,B.context=typeof ce=="object"&&ce!==null?Oo(ce):_d,B.state=E.memoizedState,ce=v.getDerivedStateFromProps,typeof ce=="function"&&(aT(E,v,ce,C),B.state=E.memoizedState),typeof v.getDerivedStateFromProps=="function"||typeof B.getSnapshotBeforeUpdate=="function"||typeof B.UNSAFE_componentWillMount!="function"&&typeof B.componentWillMount!="function"||(ce=B.state,typeof B.componentWillMount=="function"&&B.componentWillMount(),typeof B.UNSAFE_componentWillMount=="function"&&B.UNSAFE_componentWillMount(),ce!==B.state&&CI.enqueueReplaceState(B,B.state,null),mp(E,C,B,P),_p(),B.state=E.memoizedState),typeof B.componentDidMount=="function"&&(E.flags|=4194308),C=!0}else if(f===null){B=E.stateNode;var Ee=E.memoizedProps,Fe=om(v,Ee);B.props=Fe;var Ze=B.context,Et=v.contextType;ce=_d,typeof Et=="object"&&Et!==null&&(ce=Oo(Et));var Nt=v.getDerivedStateFromProps;Et=typeof Nt=="function"||typeof B.getSnapshotBeforeUpdate=="function",Ee=E.pendingProps!==Ee,Et||typeof B.UNSAFE_componentWillReceiveProps!="function"&&typeof B.componentWillReceiveProps!="function"||(Ee||Ze!==ce)&&oN(E,B,C,ce),il=!1;var ot=E.memoizedState;B.state=ot,mp(E,C,B,P),_p(),Ze=E.memoizedState,Ee||ot!==Ze||il?(typeof Nt=="function"&&(aT(E,v,Nt,C),Ze=E.memoizedState),(Fe=il||sR(E,v,Fe,C,ot,Ze,ce))?(Et||typeof B.UNSAFE_componentWillMount!="function"&&typeof B.componentWillMount!="function"||(typeof B.componentWillMount=="function"&&B.componentWillMount(),typeof B.UNSAFE_componentWillMount=="function"&&B.UNSAFE_componentWillMount()),typeof B.componentDidMount=="function"&&(E.flags|=4194308)):(typeof B.componentDidMount=="function"&&(E.flags|=4194308),E.memoizedProps=C,E.memoizedState=Ze),B.props=C,B.state=Ze,B.context=ce,C=Fe):(typeof B.componentDidMount=="function"&&(E.flags|=4194308),C=!1)}else{B=E.stateNode,cI(f,E),ce=E.memoizedProps,Et=om(v,ce),B.props=Et,Nt=E.pendingProps,ot=B.context,Ze=v.contextType,Fe=_d,typeof Ze=="object"&&Ze!==null&&(Fe=Oo(Ze)),Ee=v.getDerivedStateFromProps,(Ze=typeof Ee=="function"||typeof B.getSnapshotBeforeUpdate=="function")||typeof B.UNSAFE_componentWillReceiveProps!="function"&&typeof B.componentWillReceiveProps!="function"||(ce!==Nt||ot!==Fe)&&oN(E,B,C,Fe),il=!1,ot=E.memoizedState,B.state=ot,mp(E,C,B,P),_p();var at=E.memoizedState;ce!==Nt||ot!==at||il||f!==null&&f.dependencies!==null&&jy(f.dependencies)?(typeof Ee=="function"&&(aT(E,v,Ee,C),at=E.memoizedState),(Et=il||sR(E,v,Et,C,ot,at,Fe)||f!==null&&f.dependencies!==null&&jy(f.dependencies))?(Ze||typeof B.UNSAFE_componentWillUpdate!="function"&&typeof B.componentWillUpdate!="function"||(typeof B.componentWillUpdate=="function"&&B.componentWillUpdate(C,at,Fe),typeof B.UNSAFE_componentWillUpdate=="function"&&B.UNSAFE_componentWillUpdate(C,at,Fe)),typeof B.componentDidUpdate=="function"&&(E.flags|=4),typeof B.getSnapshotBeforeUpdate=="function"&&(E.flags|=1024)):(typeof B.componentDidUpdate!="function"||ce===f.memoizedProps&&ot===f.memoizedState||(E.flags|=4),typeof B.getSnapshotBeforeUpdate!="function"||ce===f.memoizedProps&&ot===f.memoizedState||(E.flags|=1024),E.memoizedProps=C,E.memoizedState=at),B.props=C,B.state=at,B.context=Fe,C=Et):(typeof B.componentDidUpdate!="function"||ce===f.memoizedProps&&ot===f.memoizedState||(E.flags|=4),typeof B.getSnapshotBeforeUpdate!="function"||ce===f.memoizedProps&&ot===f.memoizedState||(E.flags|=1024),C=!1)}return B=C,lR(f,E),C=(E.flags&128)!==0,B||C?(B=E.stateNode,v=C&&typeof v.getDerivedStateFromError!="function"?null:B.render(),E.flags|=1,f!==null&&C?(E.child=Yf(E,f.child,null,P),E.child=Yf(E,null,v,P)):ec(f,E,v,P),E.memoizedState=B.state,f=E.child):f=eu(f,E,P),f}function EN(f,E,v,C){return lp(),E.flags|=256,ec(f,E,v,C),E.child}var II={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function vp(f){return{baseLanes:f,cachePool:PO()}}function am(f,E,v){return f=f!==null?f.childLanes&~v:0,E&&(f|=gd),f}function hR(f,E,v){var C=E.pendingProps,P=!1,B=(E.flags&128)!==0,ce;if((ce=B)||(ce=f!==null&&f.memoizedState===null?!1:(va.current&2)!==0),ce&&(P=!0,E.flags&=-129),ce=(E.flags&32)!==0,E.flags&=-33,f===null){if(Hr){if(P?qf(E):Xf(),Hr){var Ee=ps,Fe;if(Fe=Ee){e:{for(Fe=Ee,Ee=Zu;Fe.nodeType!==8;){if(!Ee){Ee=null;break e}if(Fe=au(Fe.nextSibling),Fe===null){Ee=null;break e}}Ee=Fe}Ee!==null?(E.memoizedState={dehydrated:Ee,treeContext:Q_!==null?{id:cp,overflow:Ul}:null,retryLane:536870912,hydrationErrors:null},Fe=Ml(18,null,null,0),Fe.stateNode=Ee,Fe.return=E,E.child=Fe,Za=E,ps=null,Fe=!0):Fe=!1}Fe||em(E)}if(Ee=E.memoizedState,Ee!==null&&(Ee=Ee.dehydrated,Ee!==null))return bT(Ee)?E.lanes=32:E.lanes=536870912,null;$d(E)}return Ee=C.children,C=C.fallback,P?(Xf(),P=E.mode,Ee=rg({mode:"hidden",children:Ee},P),C=ap(C,P,v,null),Ee.return=E,C.return=E,Ee.sibling=C,E.child=Ee,P=E.child,P.memoizedState=vp(v),P.childLanes=am(f,ce,v),E.memoizedState=II,C):(qf(E),yp(E,Ee))}if(Fe=f.memoizedState,Fe!==null&&(Ee=Fe.dehydrated,Ee!==null)){if(B)E.flags&256?(qf(E),E.flags&=-257,E=AI(f,E,v)):E.memoizedState!==null?(Xf(),E.child=f.child,E.flags|=128,E=null):(Xf(),P=C.fallback,Ee=E.mode,C=rg({mode:"visible",children:C.children},Ee),P=ap(P,Ee,v,null),P.flags|=2,C.return=E,P.return=E,C.sibling=P,E.child=C,Yf(E,f.child,null,v),C=E.child,C.memoizedState=vp(v),C.childLanes=am(f,ce,v),E.memoizedState=II,E=P);else if(qf(E),bT(Ee)){if(ce=Ee.nextSibling&&Ee.nextSibling.dataset,ce)var Ze=ce.dgst;ce=Ze,C=Error(_(419)),C.stack="",C.digest=ce,qS({value:C,source:null,stack:null}),E=AI(f,E,v)}else if(xa||XS(f,E,v,!1),ce=(v&f.childLanes)!==0,xa||ce){if(ce=Fs,ce!==null&&(C=v&-v,C=(C&42)!==0?1:Ts(C),C=(C&(ce.suspendedLanes|v))!==0?0:C,C!==0&&C!==Fe.retryLane))throw Fe.retryLane=C,VE(f,C),kc(ce,f,C),hN;Ee.data==="$?"||su(),E=AI(f,E,v)}else Ee.data==="$?"?(E.flags|=192,E.child=f.child,E=null):(f=Fe.treeContext,ps=au(Ee.nextSibling),Za=E,Hr=!0,$_=null,Zu=!1,f!==null&&(nl[md++]=cp,nl[md++]=Ul,nl[md++]=Q_,cp=f.id,Ul=f.overflow,Q_=E),E=yp(E,C.children),E.flags|=4096);return E}return P?(Xf(),P=C.fallback,Ee=E.mode,Fe=f.child,Ze=Fe.sibling,C=op(Fe,{mode:"hidden",children:C.children}),C.subtreeFlags=Fe.subtreeFlags&65011712,Ze!==null?P=op(Ze,P):(P=ap(P,Ee,v,null),P.flags|=2),P.return=E,C.return=E,C.sibling=P,E.child=C,C=P,P=E.child,Ee=f.child.memoizedState,Ee===null?Ee=vp(v):(Fe=Ee.cachePool,Fe!==null?(Ze=jo._currentValue,Fe=Fe.parent!==Ze?{parent:Ze,pool:Ze}:Fe):Fe=PO(),Ee={baseLanes:Ee.baseLanes|v,cachePool:Fe}),P.memoizedState=Ee,P.childLanes=am(f,ce,v),E.memoizedState=II,C):(qf(E),v=f.child,f=v.sibling,v=op(v,{mode:"visible",children:C.children}),v.return=E,v.sibling=null,f!==null&&(ce=E.deletions,ce===null?(E.deletions=[f],E.flags|=16):ce.push(f)),E.child=v,E.memoizedState=null,v)}function yp(f,E){return E=rg({mode:"visible",children:E},f.mode),E.return=f,f.child=E}function rg(f,E){return f=Ml(22,f,null,E),f.lanes=0,f.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},f}function AI(f,E,v){return Yf(E,f.child,null,v),f=yp(E,E.pendingProps.children),f.flags|=2,E.memoizedState=null,f}function pR(f,E,v){f.lanes|=E;var C=f.alternate;C!==null&&(C.lanes|=E),rI(f.return,E,v)}function Rp(f,E,v,C,P){var B=f.memoizedState;B===null?f.memoizedState={isBackwards:E,rendering:null,renderingStartTime:0,last:C,tail:v,tailMode:P}:(B.isBackwards=E,B.rendering=null,B.renderingStartTime=0,B.last=C,B.tail=v,B.tailMode=P)}function gN(f,E,v){var C=E.pendingProps,P=C.revealOrder,B=C.tail;if(ec(f,E,C.children,v),C=va.current,(C&2)!==0)C=C&1|2,E.flags|=128;else{if(f!==null&&(f.flags&128)!==0)e:for(f=E.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&pR(f,v,E);else if(f.tag===19)pR(f,v,E);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===E)break e;for(;f.sibling===null;){if(f.return===null||f.return===E)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}C&=1}switch(pt(va,C),P){case"forwards":for(v=E.child,P=null;v!==null;)f=v.alternate,f!==null&&Jf(f)===null&&(P=v),v=v.sibling;v=P,v===null?(P=E.child,E.child=null):(P=v.sibling,v.sibling=null),Rp(E,!1,P,v,B);break;case"backwards":for(v=null,P=E.child,E.child=null;P!==null;){if(f=P.alternate,f!==null&&Jf(f)===null){E.child=P;break}f=P.sibling,P.sibling=v,v=P,P=f}Rp(E,!0,v,null,B);break;case"together":Rp(E,!1,null,null,void 0);break;default:E.memoizedState=null}return E.child}function eu(f,E,v){if(f!==null&&(E.dependencies=f.dependencies),al|=E.lanes,(v&E.childLanes)===0)if(f!==null){if(XS(f,E,v,!1),(v&E.childLanes)===0)return null}else return null;if(f!==null&&E.child!==f.child)throw Error(_(153));if(E.child!==null){for(f=E.child,v=op(f,f.pendingProps),E.child=v,v.return=E;f.sibling!==null;)f=f.sibling,v=v.sibling=op(f,f.pendingProps),v.return=E;v.sibling=null}return E.child}function cT(f,E){return(f.lanes&E)!==0?!0:(f=f.dependencies,!!(f!==null&&jy(f)))}function CL(f,E,v){switch(E.tag){case 3:ri(E,E.stateNode.containerInfo),Mf(E,jo,f.memoizedState.cache),lp();break;case 27:case 5:En(E);break;case 4:ri(E,E.stateNode.containerInfo);break;case 10:Mf(E,E.type,E.memoizedProps.value);break;case 13:var C=E.memoizedState;if(C!==null)return C.dehydrated!==null?(qf(E),E.flags|=128,null):(v&E.child.childLanes)!==0?hR(f,E,v):(qf(E),f=eu(f,E,v),f!==null?f.sibling:null);qf(E);break;case 19:var P=(f.flags&128)!==0;if(C=(v&E.childLanes)!==0,C||(XS(f,E,v,!1),C=(v&E.childLanes)!==0),P){if(C)return gN(f,E,v);E.flags|=128}if(P=E.memoizedState,P!==null&&(P.rendering=null,P.tail=null,P.lastEffect=null),pt(va,va.current),C)break;return null;case 22:case 23:return E.lanes=0,_N(f,E,v);case 24:Mf(E,jo,f.memoizedState.cache)}return eu(f,E,v)}function Qf(f,E,v){if(f!==null)if(f.memoizedProps!==E.pendingProps)xa=!0;else{if(!cT(f,v)&&(E.flags&128)===0)return xa=!1,CL(f,E,v);xa=(f.flags&131072)!==0}else xa=!1,Hr&&(E.flags&1048576)!==0&&Fy(E,Vy,E.index);switch(E.lanes=0,E.tag){case 16:e:{f=E.pendingProps;var C=E.elementType,P=C._init;if(C=P(C._payload),E.type=C,typeof C=="function")$b(C)?(f=om(C,f),E.tag=1,E=uR(null,E,C,f,v)):(E.tag=0,E=bI(null,E,C,f,v));else{if(C!=null){if(P=C.$$typeof,P===Ue){E.tag=11,E=ig(null,E,C,f,v);break e}else if(P===Te){E.tag=14,E=pN(null,E,C,f,v);break e}}throw E=Xe(C)||C,Error(_(306,E,""))}}return E;case 0:return bI(f,E,E.type,E.pendingProps,v);case 1:return C=E.type,P=om(C,E.pendingProps),uR(f,E,C,P,v);case 3:e:{if(ri(E,E.stateNode.containerInfo),f===null)throw Error(_(387));C=E.pendingProps;var B=E.memoizedState;P=B.element,cI(f,E),mp(E,C,null,v);var ce=E.memoizedState;if(C=ce.cache,Mf(E,jo,C),C!==B.cache&&sI(E,[jo],v,!0),_p(),C=ce.element,B.isDehydrated)if(B={element:C,isDehydrated:!1,cache:ce.cache},E.updateQueue.baseState=B,E.memoizedState=B,E.flags&256){E=EN(f,E,C,v);break e}else if(C!==P){P=el(Error(_(424)),E),qS(P),E=EN(f,E,C,v);break e}else{switch(f=E.stateNode.containerInfo,f.nodeType){case 9:f=f.body;break;default:f=f.nodeName==="HTML"?f.ownerDocument.body:f}for(ps=au(f.firstChild),Za=E,Hr=!0,$_=null,Zu=!0,v=rN(E,null,C,v),E.child=v;v;)v.flags=v.flags&-3|4096,v=v.sibling}else{if(lp(),C===P){E=eu(f,E,v);break e}ec(f,E,C,v)}E=E.child}return E;case 26:return lR(f,E),f===null?(v=zN(E.type,null,E.pendingProps,null))?E.memoizedState=v:Hr||(v=E.type,f=E.pendingProps,C=MR(pn.current).createElement(v),C[Sa]=E,C[oa]=f,Ra(C,v,f),po(C),E.stateNode=C):E.memoizedState=zN(E.type,f.memoizedProps,E.pendingProps,f.memoizedState),null;case 27:return En(E),f===null&&Hr&&(C=E.stateNode=WN(E.type,E.pendingProps,pn.current),Za=E,Zu=!0,P=ps,a_(E.type)?(HI=P,ps=au(C.firstChild)):ps=P),ec(f,E,E.pendingProps.children,v),lR(f,E),f===null&&(E.flags|=4194304),E.child;case 5:return f===null&&Hr&&((P=C=ps)&&(C=GL(C,E.type,E.pendingProps,Zu),C!==null?(E.stateNode=C,Za=E,ps=au(C.firstChild),Zu=!1,P=!0):P=!1),P||em(E)),En(E),P=E.type,B=E.pendingProps,ce=f!==null?f.memoizedProps:null,C=B.children,jI(P,B)?C=null:ce!==null&&jI(P,ce)&&(E.flags|=32),E.memoizedState!==null&&(P=hI(f,E,pI,null,null,v),NT._currentValue=P),lR(f,E),ec(f,E,C,v),E.child;case 6:return f===null&&Hr&&((f=v=ps)&&(v=WL(v,E.pendingProps,Zu),v!==null?(E.stateNode=v,Za=E,ps=null,f=!0):f=!1),f||em(E)),null;case 13:return hR(f,E,v);case 4:return ri(E,E.stateNode.containerInfo),C=E.pendingProps,f===null?E.child=Yf(E,null,C,v):ec(f,E,C,v),E.child;case 11:return ig(f,E,E.type,E.pendingProps,v);case 7:return ec(f,E,E.pendingProps,v),E.child;case 8:return ec(f,E,E.pendingProps.children,v),E.child;case 12:return ec(f,E,E.pendingProps.children,v),E.child;case 10:return C=E.pendingProps,Mf(E,E.type,C.value),ec(f,E,C.children,v),E.child;case 9:return P=E.type._context,C=E.pendingProps.children,xl(E),P=Oo(P),C=C(P),E.flags|=1,ec(f,E,C,v),E.child;case 14:return pN(f,E,E.type,E.pendingProps,v);case 15:return fN(f,E,E.type,E.pendingProps,v);case 19:return gN(f,E,v);case 31:return C=E.pendingProps,v=E.mode,C={mode:C.mode,children:C.children},f===null?(v=rg(C,v),v.ref=E.ref,E.child=v,v.return=E,E=v):(v=op(f.child,C),v.ref=E.ref,E.child=v,v.return=E,E=v),E;case 22:return _N(f,E,v);case 24:return xl(E),C=Oo(jo),f===null?(P=aI(),P===null&&(P=Fs,B=nm(),P.pooledCache=B,B.refCount++,B!==null&&(P.pooledCacheLanes|=v),P=B),E.memoizedState={parent:C,cache:P},$S(E),Mf(E,jo,P)):((f.lanes&v)!==0&&(cI(f,E),mp(E,null,null,v),_p()),P=f.memoizedState,B=E.memoizedState,P.parent!==C?(P={parent:C,cache:C},E.memoizedState=P,E.lanes===0&&(E.memoizedState=E.updateQueue.baseState=P),Mf(E,jo,C)):(C=B.cache,Mf(E,jo,C),C!==P.cache&&sI(E,[jo],v,!0))),ec(f,E,E.pendingProps.children,v),E.child;case 29:throw E.pendingProps}throw Error(_(156,E.tag))}function tu(f){f.flags|=4}function SN(f,E){if(E.type!=="stylesheet"||(E.state.loading&4)!==0)f.flags&=-16777217;else if(f.flags|=16777216,!qN(E)){if(E=Vs.current,E!==null&&((_r&4194048)===_r?th!==null:(_r&62914560)!==_r&&(_r&536870912)===0||E!==th))throw ZS=fp,kO;f.flags|=8192}}function fR(f,E){E!==null&&(f.flags|=4),f.flags&16384&&(E=f.tag!==22?Rf():536870912,f.lanes|=E,n_|=E)}function lT(f,E){if(!Hr)switch(f.tailMode){case"hidden":E=f.tail;for(var v=null;E!==null;)E.alternate!==null&&(v=E),E=E.sibling;v===null?f.tail=null:v.sibling=null;break;case"collapsed":v=f.tail;for(var C=null;v!==null;)v.alternate!==null&&(C=v),v=v.sibling;C===null?E||f.tail===null?f.tail=null:f.tail.sibling=null:C.sibling=null}}function as(f){var E=f.alternate!==null&&f.alternate.child===f.child,v=0,C=0;if(E)for(var P=f.child;P!==null;)v|=P.lanes|P.childLanes,C|=P.subtreeFlags&65011712,C|=P.flags&65011712,P.return=f,P=P.sibling;else for(P=f.child;P!==null;)v|=P.lanes|P.childLanes,C|=P.subtreeFlags,C|=P.flags,P.return=f,P=P.sibling;return f.subtreeFlags|=C,f.childLanes=v,E}function bL(f,E,v){var C=E.pendingProps;switch(tI(E),E.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return as(E),null;case 1:return as(E),null;case 3:return v=E.stateNode,C=null,f!==null&&(C=f.memoizedState.cache),E.memoizedState.cache!==C&&(E.flags|=2048),up(jo),si(),v.pendingContext&&(v.context=v.pendingContext,v.pendingContext=null),(f===null||f.child===null)&&(YS(E)?tu(E):f===null||f.memoizedState.isDehydrated&&(E.flags&256)===0||(E.flags|=1024,wO())),as(E),null;case 26:return v=E.memoizedState,f===null?(tu(E),v!==null?(as(E),SN(E,v)):(as(E),E.flags&=-16777217)):v?v!==f.memoizedState?(tu(E),as(E),SN(E,v)):(as(E),E.flags&=-16777217):(f.memoizedProps!==C&&tu(E),as(E),E.flags&=-16777217),null;case 27:oi(E),v=pn.current;var P=E.type;if(f!==null&&E.stateNode!=null)f.memoizedProps!==C&&tu(E);else{if(!C){if(E.stateNode===null)throw Error(_(166));return as(E),null}f=xt.current,YS(E)?By(E):(f=WN(P,C,v),E.stateNode=f,tu(E))}return as(E),null;case 5:if(oi(E),v=E.type,f!==null&&E.stateNode!=null)f.memoizedProps!==C&&tu(E);else{if(!C){if(E.stateNode===null)throw Error(_(166));return as(E),null}if(f=xt.current,YS(E))By(E);else{switch(P=MR(pn.current),f){case 1:f=P.createElementNS("http://www.w3.org/2000/svg",v);break;case 2:f=P.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;default:switch(v){case"svg":f=P.createElementNS("http://www.w3.org/2000/svg",v);break;case"math":f=P.createElementNS("http://www.w3.org/1998/Math/MathML",v);break;case"script":f=P.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild);break;case"select":f=typeof C.is=="string"?P.createElement("select",{is:C.is}):P.createElement("select"),C.multiple?f.multiple=!0:C.size&&(f.size=C.size);break;default:f=typeof C.is=="string"?P.createElement(v,{is:C.is}):P.createElement(v)}}f[Sa]=E,f[oa]=C;e:for(P=E.child;P!==null;){if(P.tag===5||P.tag===6)f.appendChild(P.stateNode);else if(P.tag!==4&&P.tag!==27&&P.child!==null){P.child.return=P,P=P.child;continue}if(P===E)break e;for(;P.sibling===null;){if(P.return===null||P.return===E)break e;P=P.return}P.sibling.return=P.return,P=P.sibling}E.stateNode=f;e:switch(Ra(f,v,C),v){case"button":case"input":case"select":case"textarea":f=!!C.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&tu(E)}}return as(E),E.flags&=-16777217,null;case 6:if(f&&E.stateNode!=null)f.memoizedProps!==C&&tu(E);else{if(typeof C!="string"&&E.stateNode===null)throw Error(_(166));if(f=pn.current,YS(E)){if(f=E.stateNode,v=E.memoizedProps,C=null,P=Za,P!==null)switch(P.tag){case 27:case 5:C=P.memoizedProps}f[Sa]=E,f=!!(f.nodeValue===v||C!==null&&C.suppressHydrationWarning===!0||Eg(f.nodeValue,v)),f||em(E)}else f=MR(f).createTextNode(C),f[Sa]=E,E.stateNode=f}return as(E),null;case 13:if(C=E.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(P=YS(E),C!==null&&C.dehydrated!==null){if(f===null){if(!P)throw Error(_(318));if(P=E.memoizedState,P=P!==null?P.dehydrated:null,!P)throw Error(_(317));P[Sa]=E}else lp(),(E.flags&128)===0&&(E.memoizedState=null),E.flags|=4;as(E),P=!1}else P=wO(),f!==null&&f.memoizedState!==null&&(f.memoizedState.hydrationErrors=P),P=!0;if(!P)return E.flags&256?($d(E),E):($d(E),null)}if($d(E),(E.flags&128)!==0)return E.lanes=v,E;if(v=C!==null,f=f!==null&&f.memoizedState!==null,v){C=E.child,P=null,C.alternate!==null&&C.alternate.memoizedState!==null&&C.alternate.memoizedState.cachePool!==null&&(P=C.alternate.memoizedState.cachePool.pool);var B=null;C.memoizedState!==null&&C.memoizedState.cachePool!==null&&(B=C.memoizedState.cachePool.pool),B!==P&&(C.flags|=2048)}return v!==f&&v&&(E.child.flags|=8192),fR(E,E.updateQueue),as(E),null;case 4:return si(),f===null&&RT(E.stateNode.containerInfo),as(E),null;case 10:return up(E.type),as(E),null;case 19:if(ft(va),P=E.memoizedState,P===null)return as(E),null;if(C=(E.flags&128)!==0,B=P.rendering,B===null)if(C)lT(P,!1);else{if(no!==0||f!==null&&(f.flags&128)!==0)for(f=E.child;f!==null;){if(B=Jf(f),B!==null){for(E.flags|=128,lT(P,!1),f=B.updateQueue,E.updateQueue=f,fR(E,f),E.subtreeFlags=0,f=v,v=E.child;v!==null;)FE(v,f),v=v.sibling;return pt(va,va.current&1|2),E.child}f=f.sibling}P.tail!==null&&yi()>i_&&(E.flags|=128,C=!0,lT(P,!1),E.lanes=4194304)}else{if(!C)if(f=Jf(B),f!==null){if(E.flags|=128,C=!0,f=f.updateQueue,E.updateQueue=f,fR(E,f),lT(P,!0),P.tail===null&&P.tailMode==="hidden"&&!B.alternate&&!Hr)return as(E),null}else 2*yi()-P.renderingStartTime>i_&&v!==536870912&&(E.flags|=128,C=!0,lT(P,!1),E.lanes=4194304);P.isBackwards?(B.sibling=E.child,E.child=B):(f=P.last,f!==null?f.sibling=B:E.child=B,P.last=B)}return P.tail!==null?(E=P.tail,P.rendering=E,P.tail=E.sibling,P.renderingStartTime=yi(),E.sibling=null,f=va.current,pt(va,C?f&1|2:f&1),E):(as(E),null);case 22:case 23:return $d(E),uI(),C=E.memoizedState!==null,f!==null?f.memoizedState!==null!==C&&(E.flags|=8192):C&&(E.flags|=8192),C?(v&536870912)!==0&&(E.flags&128)===0&&(as(E),E.subtreeFlags&6&&(E.flags|=8192)):as(E),v=E.updateQueue,v!==null&&fR(E,v.retryQueue),v=null,f!==null&&f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(v=f.memoizedState.cachePool.pool),C=null,E.memoizedState!==null&&E.memoizedState.cachePool!==null&&(C=E.memoizedState.cachePool.pool),C!==v&&(E.flags|=2048),f!==null&&ft(hp),null;case 24:return v=null,f!==null&&(v=f.memoizedState.cache),E.memoizedState.cache!==v&&(E.flags|=2048),up(jo),as(E),null;case 25:return null;case 30:return null}throw Error(_(156,E.tag))}function IL(f,E){switch(tI(E),E.tag){case 1:return f=E.flags,f&65536?(E.flags=f&-65537|128,E):null;case 3:return up(jo),si(),f=E.flags,(f&65536)!==0&&(f&128)===0?(E.flags=f&-65537|128,E):null;case 26:case 27:case 5:return oi(E),null;case 13:if($d(E),f=E.memoizedState,f!==null&&f.dehydrated!==null){if(E.alternate===null)throw Error(_(340));lp()}return f=E.flags,f&65536?(E.flags=f&-65537|128,E):null;case 19:return ft(va),null;case 4:return si(),null;case 10:return up(E.type),null;case 22:case 23:return $d(E),uI(),f!==null&&ft(hp),f=E.flags,f&65536?(E.flags=f&-65537|128,E):null;case 24:return up(jo),null;case 25:return null;default:return null}}function TN(f,E){switch(tI(E),E.tag){case 3:up(jo),si();break;case 26:case 27:case 5:oi(E);break;case 4:si();break;case 13:$d(E);break;case 19:ft(va);break;case 10:up(E.type);break;case 22:case 23:$d(E),uI(),f!==null&&ft(hp);break;case 24:up(jo)}}function cm(f,E){try{var v=E.updateQueue,C=v!==null?v.lastEffect:null;if(C!==null){var P=C.next;v=P;do{if((v.tag&f)===f){C=void 0;var B=v.create,ce=v.inst;C=B(),ce.destroy=C}v=v.next}while(v!==P)}}catch(Ee){ys(E,E.return,Ee)}}function Zf(f,E,v){try{var C=E.updateQueue,P=C!==null?C.lastEffect:null;if(P!==null){var B=P.next;C=B;do{if((C.tag&f)===f){var ce=C.inst,Ee=ce.destroy;if(Ee!==void 0){ce.destroy=void 0,P=E;var Fe=v,Ze=Ee;try{Ze()}catch(Et){ys(P,Fe,Et)}}}C=C.next}while(C!==B)}}catch(Et){ys(E,E.return,Et)}}function vN(f){var E=f.updateQueue;if(E!==null){var v=f.stateNode;try{HE(E,v)}catch(C){ys(f,f.return,C)}}}function sg(f,E,v){v.props=om(f.type,f.memoizedProps),v.state=f.memoizedState;try{v.componentWillUnmount()}catch(C){ys(f,E,C)}}function dT(f,E){try{var v=f.ref;if(v!==null){switch(f.tag){case 26:case 27:case 5:var C=f.stateNode;break;case 30:C=f.stateNode;break;default:C=f.stateNode}typeof v=="function"?f.refCleanup=v(C):v.current=C}}catch(P){ys(f,E,P)}}function ol(f,E){var v=f.ref,C=f.refCleanup;if(v!==null)if(typeof C=="function")try{C()}catch(P){ys(f,E,P)}finally{f.refCleanup=null,f=f.alternate,f!=null&&(f.refCleanup=null)}else if(typeof v=="function")try{v(null)}catch(P){ys(f,E,P)}else v.current=null}function yN(f){var E=f.type,v=f.memoizedProps,C=f.stateNode;try{e:switch(E){case"button":case"input":case"select":case"textarea":v.autoFocus&&C.focus();break e;case"img":v.src?C.src=v.src:v.srcSet&&(C.srcset=v.srcSet)}}catch(P){ys(f,f.return,P)}}function uT(f,E,v){try{var C=f.stateNode;xL(C,f.type,v,E),C[oa]=E}catch(P){ys(f,f.return,P)}}function RN(f){return f.tag===5||f.tag===3||f.tag===26||f.tag===27&&a_(f.type)||f.tag===4}function wI(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||RN(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.tag===27&&a_(f.type)||f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function hT(f,E,v){var C=f.tag;if(C===5||C===6)f=f.stateNode,E?(v.nodeType===9?v.body:v.nodeName==="HTML"?v.ownerDocument.body:v).insertBefore(f,E):(E=v.nodeType===9?v.body:v.nodeName==="HTML"?v.ownerDocument.body:v,E.appendChild(f),v=v._reactRootContainer,v!=null||E.onclick!==null||(E.onclick=gg));else if(C!==4&&(C===27&&a_(f.type)&&(v=f.stateNode,E=null),f=f.child,f!==null))for(hT(f,E,v),f=f.sibling;f!==null;)hT(f,E,v),f=f.sibling}function _R(f,E,v){var C=f.tag;if(C===5||C===6)f=f.stateNode,E?v.insertBefore(f,E):v.appendChild(f);else if(C!==4&&(C===27&&a_(f.type)&&(v=f.stateNode),f=f.child,f!==null))for(_R(f,E,v),f=f.sibling;f!==null;)_R(f,E,v),f=f.sibling}function CN(f){var E=f.stateNode,v=f.memoizedProps;try{for(var C=f.type,P=E.attributes;P.length;)E.removeAttributeNode(P[0]);Ra(E,C,v),E[Sa]=f,E[oa]=v}catch(B){ys(f,f.return,B)}}var nu=!1,_o=!1,lm=!1,bN=typeof WeakSet=="function"?WeakSet:Set,Va=null;function Cp(f,E){if(f=f.containerInfo,BI=WR,f=fc(f),zb(f)){if("selectionStart"in f)var v={start:f.selectionStart,end:f.selectionEnd};else e:{v=(v=f.ownerDocument)&&v.defaultView||window;var C=v.getSelection&&v.getSelection();if(C&&C.rangeCount!==0){v=C.anchorNode;var P=C.anchorOffset,B=C.focusNode;C=C.focusOffset;try{v.nodeType,B.nodeType}catch{v=null;break e}var ce=0,Ee=-1,Fe=-1,Ze=0,Et=0,Nt=f,ot=null;t:for(;;){for(var at;Nt!==v||P!==0&&Nt.nodeType!==3||(Ee=ce+P),Nt!==B||C!==0&&Nt.nodeType!==3||(Fe=ce+C),Nt.nodeType===3&&(ce+=Nt.nodeValue.length),(at=Nt.firstChild)!==null;)ot=Nt,Nt=at;for(;;){if(Nt===f)break t;if(ot===v&&++Ze===P&&(Ee=ce),ot===B&&++Et===C&&(Fe=ce),(at=Nt.nextSibling)!==null)break;Nt=ot,ot=Nt.parentNode}Nt=at}v=Ee===-1||Fe===-1?null:{start:Ee,end:Fe}}else v=null}v=v||{start:0,end:0}}else v=null;for(Dp={focusedElem:f,selectionRange:v},WR=!1,Va=E;Va!==null;)if(E=Va,f=E.child,(E.subtreeFlags&1024)!==0&&f!==null)f.return=E,Va=f;else for(;Va!==null;){switch(E=Va,B=E.alternate,f=E.flags,E.tag){case 0:break;case 11:case 15:break;case 1:if((f&1024)!==0&&B!==null){f=void 0,v=E,P=B.memoizedProps,B=B.memoizedState,C=v.stateNode;try{var Si=om(v.type,P,v.elementType===v.type);f=C.getSnapshotBeforeUpdate(Si,B),C.__reactInternalSnapshotBeforeUpdate=f}catch(Xn){ys(v,v.return,Xn)}}break;case 3:if((f&1024)!==0){if(f=E.stateNode.containerInfo,v=f.nodeType,v===9)WI(f);else if(v===1)switch(f.nodeName){case"HEAD":case"HTML":case"BODY":WI(f);break;default:f.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((f&1024)!==0)throw Error(_(163))}if(f=E.sibling,f!==null){f.return=E.return,Va=f;break}Va=E.return}}function mR(f,E,v){var C=v.flags;switch(v.tag){case 0:case 11:case 15:Do(f,v),C&4&&cm(5,v);break;case 1:if(Do(f,v),C&4)if(f=v.stateNode,E===null)try{f.componentDidMount()}catch(ce){ys(v,v.return,ce)}else{var P=om(v.type,E.memoizedProps);E=E.memoizedState;try{f.componentDidUpdate(P,E,f.__reactInternalSnapshotBeforeUpdate)}catch(ce){ys(v,v.return,ce)}}C&64&&vN(v),C&512&&dT(v,v.return);break;case 3:if(Do(f,v),C&64&&(f=v.updateQueue,f!==null)){if(E=null,v.child!==null)switch(v.child.tag){case 27:case 5:E=v.child.stateNode;break;case 1:E=v.child.stateNode}try{HE(f,E)}catch(ce){ys(v,v.return,ce)}}break;case 27:E===null&&C&4&&CN(v);case 26:case 5:Do(f,v),E===null&&C&4&&yN(v),C&512&&dT(v,v.return);break;case 12:Do(f,v);break;case 13:Do(f,v),C&4&&IN(f,v),C&64&&(f=v.memoizedState,f!==null&&(f=f.dehydrated,f!==null&&(v=PL.bind(null,v),HL(f,v))));break;case 22:if(C=v.memoizedState!==null||nu,!C){E=E!==null&&E.memoizedState!==null||_o,P=nu;var B=_o;nu=C,(_o=E)&&!B?da(f,v,(v.subtreeFlags&8772)!==0):Do(f,v),nu=P,_o=B}break;case 30:break;default:Do(f,v)}}function nh(f){var E=f.alternate;E!==null&&(f.alternate=null,nh(E)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(E=f.stateNode,E!==null&&Kh(E)),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}var fr=null,_c=!1;function Bl(f,E,v){for(v=v.child;v!==null;)$f(f,E,v),v=v.sibling}function $f(f,E,v){if(Ot&&typeof Ot.onCommitFiberUnmount=="function")try{Ot.onCommitFiberUnmount(wt,v)}catch{}switch(v.tag){case 26:_o||ol(v,E),Bl(f,E,v),v.memoizedState?v.memoizedState.count--:v.stateNode&&(v=v.stateNode,v.parentNode.removeChild(v));break;case 27:_o||ol(v,E);var C=fr,P=_c;a_(v.type)&&(fr=v.stateNode,_c=!1),Bl(f,E,v),IT(v.stateNode),fr=C,_c=P;break;case 5:_o||ol(v,E);case 6:if(C=fr,P=_c,fr=null,Bl(f,E,v),fr=C,_c=P,fr!==null)if(_c)try{(fr.nodeType===9?fr.body:fr.nodeName==="HTML"?fr.ownerDocument.body:fr).removeChild(v.stateNode)}catch(B){ys(v,E,B)}else try{fr.removeChild(v.stateNode)}catch(B){ys(v,E,B)}break;case 18:fr!==null&&(_c?(f=fr,jN(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,v.stateNode),LT(f)):jN(fr,v.stateNode));break;case 4:C=fr,P=_c,fr=v.stateNode.containerInfo,_c=!0,Bl(f,E,v),fr=C,_c=P;break;case 0:case 11:case 14:case 15:_o||Zf(2,v,E),_o||Zf(4,v,E),Bl(f,E,v);break;case 1:_o||(ol(v,E),C=v.stateNode,typeof C.componentWillUnmount=="function"&&sg(v,E,C)),Bl(f,E,v);break;case 21:Bl(f,E,v);break;case 22:_o=(C=_o)||v.memoizedState!==null,Bl(f,E,v),_o=C;break;default:Bl(f,E,v)}}function IN(f,E){if(E.memoizedState===null&&(f=E.alternate,f!==null&&(f=f.memoizedState,f!==null&&(f=f.dehydrated,f!==null))))try{LT(f)}catch(v){ys(E,E.return,v)}}function AL(f){switch(f.tag){case 13:case 19:var E=f.stateNode;return E===null&&(E=f.stateNode=new bN),E;case 22:return f=f.stateNode,E=f._retryCache,E===null&&(E=f._retryCache=new bN),E;default:throw Error(_(435,f.tag))}}function OI(f,E){var v=AL(f);E.forEach(function(C){var P=kL.bind(null,f,C);v.has(C)||(v.add(C),C.then(P,P))})}function Pc(f,E){var v=E.deletions;if(v!==null)for(var C=0;C<v.length;C++){var P=v[C],B=f,ce=E,Ee=ce;e:for(;Ee!==null;){switch(Ee.tag){case 27:if(a_(Ee.type)){fr=Ee.stateNode,_c=!1;break e}break;case 5:fr=Ee.stateNode,_c=!1;break e;case 3:case 4:fr=Ee.stateNode.containerInfo,_c=!0;break e}Ee=Ee.return}if(fr===null)throw Error(_(160));$f(B,ce,P),fr=null,_c=!1,B=P.alternate,B!==null&&(B.return=null),P.return=null}if(E.subtreeFlags&13878)for(E=E.child;E!==null;)AN(E,f),E=E.sibling}var iu=null;function AN(f,E){var v=f.alternate,C=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:Pc(E,f),jl(f),C&4&&(Zf(3,f,f.return),cm(3,f),Zf(5,f,f.return));break;case 1:Pc(E,f),jl(f),C&512&&(_o||v===null||ol(v,v.return)),C&64&&nu&&(f=f.updateQueue,f!==null&&(C=f.callbacks,C!==null&&(v=f.shared.hiddenCallbacks,f.shared.hiddenCallbacks=v===null?C:v.concat(C))));break;case 26:var P=iu;if(Pc(E,f),jl(f),C&512&&(_o||v===null||ol(v,v.return)),C&4){var B=v!==null?v.memoizedState:null;if(C=f.memoizedState,v===null)if(C===null)if(f.stateNode===null){e:{C=f.type,v=f.memoizedProps,P=P.ownerDocument||P;t:switch(C){case"title":B=P.getElementsByTagName("title")[0],(!B||B[Hh]||B[Sa]||B.namespaceURI==="http://www.w3.org/2000/svg"||B.hasAttribute("itemprop"))&&(B=P.createElement(C),P.head.insertBefore(B,P.querySelector("head > title"))),Ra(B,C,v),B[Sa]=f,po(B),C=B;break e;case"link":var ce=FR("link","href",P).get(C+(v.href||""));if(ce){for(var Ee=0;Ee<ce.length;Ee++)if(B=ce[Ee],B.getAttribute("href")===(v.href==null||v.href===""?null:v.href)&&B.getAttribute("rel")===(v.rel==null?null:v.rel)&&B.getAttribute("title")===(v.title==null?null:v.title)&&B.getAttribute("crossorigin")===(v.crossOrigin==null?null:v.crossOrigin)){ce.splice(Ee,1);break t}}B=P.createElement(C),Ra(B,C,v),P.head.appendChild(B);break;case"meta":if(ce=FR("meta","content",P).get(C+(v.content||""))){for(Ee=0;Ee<ce.length;Ee++)if(B=ce[Ee],B.getAttribute("content")===(v.content==null?null:""+v.content)&&B.getAttribute("name")===(v.name==null?null:v.name)&&B.getAttribute("property")===(v.property==null?null:v.property)&&B.getAttribute("http-equiv")===(v.httpEquiv==null?null:v.httpEquiv)&&B.getAttribute("charset")===(v.charSet==null?null:v.charSet)){ce.splice(Ee,1);break t}}B=P.createElement(C),Ra(B,C,v),P.head.appendChild(B);break;default:throw Error(_(468,C))}B[Sa]=f,po(B),C=B}f.stateNode=C}else YN(P,f.type,f.stateNode);else f.stateNode=Rg(P,C,f.memoizedProps);else B!==C?(B===null?v.stateNode!==null&&(v=v.stateNode,v.parentNode.removeChild(v)):B.count--,C===null?YN(P,f.type,f.stateNode):Rg(P,C,f.memoizedProps)):C===null&&f.stateNode!==null&&uT(f,f.memoizedProps,v.memoizedProps)}break;case 27:Pc(E,f),jl(f),C&512&&(_o||v===null||ol(v,v.return)),v!==null&&C&4&&uT(f,f.memoizedProps,v.memoizedProps);break;case 5:if(Pc(E,f),jl(f),C&512&&(_o||v===null||ol(v,v.return)),f.flags&32){P=f.stateNode;try{hc(P,"")}catch(at){ys(f,f.return,at)}}C&4&&f.stateNode!=null&&(P=f.memoizedProps,uT(f,P,v!==null?v.memoizedProps:P)),C&1024&&(lm=!0);break;case 6:if(Pc(E,f),jl(f),C&4){if(f.stateNode===null)throw Error(_(162));C=f.memoizedProps,v=f.stateNode;try{v.nodeValue=C}catch(at){ys(f,f.return,at)}}break;case 3:if(VR=null,P=iu,iu=UR(E.containerInfo),Pc(E,f),iu=P,jl(f),C&4&&v!==null&&v.memoizedState.isDehydrated)try{LT(E.containerInfo)}catch(at){ys(f,f.return,at)}lm&&(lm=!1,og(f));break;case 4:C=iu,iu=UR(f.stateNode.containerInfo),Pc(E,f),jl(f),iu=C;break;case 12:Pc(E,f),jl(f);break;case 13:Pc(E,f),jl(f),f.child.flags&8192&&f.memoizedState!==null!=(v!==null&&v.memoizedState!==null)&&(_m=yi()),C&4&&(C=f.updateQueue,C!==null&&(f.updateQueue=null,OI(f,C)));break;case 22:P=f.memoizedState!==null;var Fe=v!==null&&v.memoizedState!==null,Ze=nu,Et=_o;if(nu=Ze||P,_o=Et||Fe,Pc(E,f),_o=Et,nu=Ze,jl(f),C&8192)e:for(E=f.stateNode,E._visibility=P?E._visibility&-2:E._visibility|1,P&&(v===null||Fe||nu||_o||dm(f)),v=null,E=f;;){if(E.tag===5||E.tag===26){if(v===null){Fe=v=E;try{if(B=Fe.stateNode,P)ce=B.style,typeof ce.setProperty=="function"?ce.setProperty("display","none","important"):ce.display="none";else{Ee=Fe.stateNode;var Nt=Fe.memoizedProps.style,ot=Nt!=null&&Nt.hasOwnProperty("display")?Nt.display:null;Ee.style.display=ot==null||typeof ot=="boolean"?"":(""+ot).trim()}}catch(at){ys(Fe,Fe.return,at)}}}else if(E.tag===6){if(v===null){Fe=E;try{Fe.stateNode.nodeValue=P?"":Fe.memoizedProps}catch(at){ys(Fe,Fe.return,at)}}}else if((E.tag!==22&&E.tag!==23||E.memoizedState===null||E===f)&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===f)break e;for(;E.sibling===null;){if(E.return===null||E.return===f)break e;v===E&&(v=null),E=E.return}v===E&&(v=null),E.sibling.return=E.return,E=E.sibling}C&4&&(C=f.updateQueue,C!==null&&(v=C.retryQueue,v!==null&&(C.retryQueue=null,OI(f,v))));break;case 19:Pc(E,f),jl(f),C&4&&(C=f.updateQueue,C!==null&&(f.updateQueue=null,OI(f,C)));break;case 30:break;case 21:break;default:Pc(E,f),jl(f)}}function jl(f){var E=f.flags;if(E&2){try{for(var v,C=f.return;C!==null;){if(RN(C)){v=C;break}C=C.return}if(v==null)throw Error(_(160));switch(v.tag){case 27:var P=v.stateNode,B=wI(f);_R(f,B,P);break;case 5:var ce=v.stateNode;v.flags&32&&(hc(ce,""),v.flags&=-33);var Ee=wI(f);_R(f,Ee,ce);break;case 3:case 4:var Fe=v.stateNode.containerInfo,Ze=wI(f);hT(f,Ze,Fe);break;default:throw Error(_(161))}}catch(Et){ys(f,f.return,Et)}f.flags&=-3}E&4096&&(f.flags&=-4097)}function og(f){if(f.subtreeFlags&1024)for(f=f.child;f!==null;){var E=f;og(E),E.tag===5&&E.flags&1024&&E.stateNode.reset(),f=f.sibling}}function Do(f,E){if(E.subtreeFlags&8772)for(E=E.child;E!==null;)mR(f,E.alternate,E),E=E.sibling}function dm(f){for(f=f.child;f!==null;){var E=f;switch(E.tag){case 0:case 11:case 14:case 15:Zf(4,E,E.return),dm(E);break;case 1:ol(E,E.return);var v=E.stateNode;typeof v.componentWillUnmount=="function"&&sg(E,E.return,v),dm(E);break;case 27:IT(E.stateNode);case 26:case 5:ol(E,E.return),dm(E);break;case 22:E.memoizedState===null&&dm(E);break;case 30:dm(E);break;default:dm(E)}f=f.sibling}}function da(f,E,v){for(v=v&&(E.subtreeFlags&8772)!==0,E=E.child;E!==null;){var C=E.alternate,P=f,B=E,ce=B.flags;switch(B.tag){case 0:case 11:case 15:da(P,B,v),cm(4,B);break;case 1:if(da(P,B,v),C=B,P=C.stateNode,typeof P.componentDidMount=="function")try{P.componentDidMount()}catch(Ze){ys(C,C.return,Ze)}if(C=B,P=C.updateQueue,P!==null){var Ee=C.stateNode;try{var Fe=P.shared.hiddenCallbacks;if(Fe!==null)for(P.shared.hiddenCallbacks=null,P=0;P<Fe.length;P++)Ky(Fe[P],Ee)}catch(Ze){ys(C,C.return,Ze)}}v&&ce&64&&vN(B),dT(B,B.return);break;case 27:CN(B);case 26:case 5:da(P,B,v),v&&C===null&&ce&4&&yN(B),dT(B,B.return);break;case 12:da(P,B,v);break;case 13:da(P,B,v),v&&ce&4&&IN(P,B);break;case 22:B.memoizedState===null&&da(P,B,v),dT(B,B.return);break;case 30:break;default:da(P,B,v)}E=E.sibling}}function pT(f,E){var v=null;f!==null&&f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(v=f.memoizedState.cachePool.pool),f=null,E.memoizedState!==null&&E.memoizedState.cachePool!==null&&(f=E.memoizedState.cachePool.pool),f!==v&&(f!=null&&f.refCount++,v!=null&&JS(v))}function vs(f,E){f=null,E.alternate!==null&&(f=E.alternate.memoizedState.cache),E=E.memoizedState.cache,E!==f&&(E.refCount++,f!=null&&JS(f))}function ih(f,E,v,C){if(E.subtreeFlags&10256)for(E=E.child;E!==null;)wN(f,E,v,C),E=E.sibling}function wN(f,E,v,C){var P=E.flags;switch(E.tag){case 0:case 11:case 15:ih(f,E,v,C),P&2048&&cm(9,E);break;case 1:ih(f,E,v,C);break;case 3:ih(f,E,v,C),P&2048&&(f=null,E.alternate!==null&&(f=E.alternate.memoizedState.cache),E=E.memoizedState.cache,E!==f&&(E.refCount++,f!=null&&JS(f)));break;case 12:if(P&2048){ih(f,E,v,C),f=E.stateNode;try{var B=E.memoizedProps,ce=B.id,Ee=B.onPostCommit;typeof Ee=="function"&&Ee(ce,E.alternate===null?"mount":"update",f.passiveEffectDuration,-0)}catch(Fe){ys(E,E.return,Fe)}}else ih(f,E,v,C);break;case 13:ih(f,E,v,C);break;case 23:break;case 22:B=E.stateNode,ce=E.alternate,E.memoizedState!==null?B._visibility&2?ih(f,E,v,C):fT(f,E):B._visibility&2?ih(f,E,v,C):(B._visibility|=2,e_(f,E,v,C,(E.subtreeFlags&10256)!==0)),P&2048&&pT(ce,E);break;case 24:ih(f,E,v,C),P&2048&&vs(E.alternate,E);break;default:ih(f,E,v,C)}}function e_(f,E,v,C,P){for(P=P&&(E.subtreeFlags&10256)!==0,E=E.child;E!==null;){var B=f,ce=E,Ee=v,Fe=C,Ze=ce.flags;switch(ce.tag){case 0:case 11:case 15:e_(B,ce,Ee,Fe,P),cm(8,ce);break;case 23:break;case 22:var Et=ce.stateNode;ce.memoizedState!==null?Et._visibility&2?e_(B,ce,Ee,Fe,P):fT(B,ce):(Et._visibility|=2,e_(B,ce,Ee,Fe,P)),P&&Ze&2048&&pT(ce.alternate,ce);break;case 24:e_(B,ce,Ee,Fe,P),P&&Ze&2048&&vs(ce.alternate,ce);break;default:e_(B,ce,Ee,Fe,P)}E=E.sibling}}function fT(f,E){if(E.subtreeFlags&10256)for(E=E.child;E!==null;){var v=f,C=E,P=C.flags;switch(C.tag){case 22:fT(v,C),P&2048&&pT(C.alternate,C);break;case 24:fT(v,C),P&2048&&vs(C.alternate,C);break;default:fT(v,C)}E=E.sibling}}var um=8192;function t_(f){if(f.subtreeFlags&um)for(f=f.child;f!==null;)ON(f),f=f.sibling}function ON(f){switch(f.tag){case 26:t_(f),f.flags&um&&f.memoizedState!==null&&e1(iu,f.memoizedState,f.memoizedProps);break;case 5:t_(f);break;case 3:case 4:var E=iu;iu=UR(f.stateNode.containerInfo),t_(f),iu=E;break;case 22:f.memoizedState===null&&(E=f.alternate,E!==null&&E.memoizedState!==null?(E=um,um=16777216,t_(f),um=E):t_(f));break;default:t_(f)}}function ER(f){var E=f.alternate;if(E!==null&&(f=E.child,f!==null)){E.child=null;do E=f.sibling,f.sibling=null,f=E;while(f!==null)}}function _T(f){var E=f.deletions;if((f.flags&16)!==0){if(E!==null)for(var v=0;v<E.length;v++){var C=E[v];Va=C,ag(C,f)}ER(f)}if(f.subtreeFlags&10256)for(f=f.child;f!==null;)NN(f),f=f.sibling}function NN(f){switch(f.tag){case 0:case 11:case 15:_T(f),f.flags&2048&&Zf(9,f,f.return);break;case 3:_T(f);break;case 12:_T(f);break;case 22:var E=f.stateNode;f.memoizedState!==null&&E._visibility&2&&(f.return===null||f.return.tag!==13)?(E._visibility&=-3,gR(f)):_T(f);break;default:_T(f)}}function gR(f){var E=f.deletions;if((f.flags&16)!==0){if(E!==null)for(var v=0;v<E.length;v++){var C=E[v];Va=C,ag(C,f)}ER(f)}for(f=f.child;f!==null;){switch(E=f,E.tag){case 0:case 11:case 15:Zf(8,E,E.return),gR(E);break;case 22:v=E.stateNode,v._visibility&2&&(v._visibility&=-3,gR(E));break;default:gR(E)}f=f.sibling}}function ag(f,E){for(;Va!==null;){var v=Va;switch(v.tag){case 0:case 11:case 15:Zf(8,v,E);break;case 23:case 22:if(v.memoizedState!==null&&v.memoizedState.cachePool!==null){var C=v.memoizedState.cachePool.pool;C!=null&&C.refCount++}break;case 24:JS(v.memoizedState.cache)}if(C=v.child,C!==null)C.return=v,Va=C;else e:for(v=f;Va!==null;){C=Va;var P=C.sibling,B=C.return;if(nh(C),C===v){Va=null;break e}if(P!==null){P.return=B,Va=P;break e}Va=B}}}var mT={getCacheForType:function(f){var E=Oo(jo),v=E.data.get(f);return v===void 0&&(v=f(),E.data.set(f,v)),v}},wL=typeof WeakMap=="function"?WeakMap:Map,Or=0,Fs=null,Wi=null,_r=0,Nr=0,Go=null,rh=!1,sh=!1,hm=!1,ru=0,no=0,al=0,bp=0,NI=0,gd=0,n_=0,pm=null,io=null,fm=!1,_m=0,i_=1/0,cg=null,oh=null,tc=0,r_=null,mc=null,lg=0,ET=0,mm=null,DN=null,gT=0,DI=null;function Gl(){if((Or&2)!==0&&_r!==0)return _r&-_r;if(Me.T!==null){var f=GE;return f!==0?f:Op()}return Cf()}function dg(){gd===0&&(gd=(_r&536870912)===0||Hr?Qc():536870912);var f=Vs.current;return f!==null&&(f.flags|=32),gd}function kc(f,E,v){(f===Fs&&(Nr===2||Nr===9)||f.cancelPendingCommit!==null)&&(s_(f,0),Sd(f,_r,gd,!1)),Xr(f,v),((Or&2)===0||f!==Fs)&&(f===Fs&&((Or&2)===0&&(bp|=v),no===4&&Sd(f,_r,gd,!1)),ll(f))}function SR(f,E,v){if((Or&6)!==0)throw Error(_(327));var C=!v&&(E&124)===0&&(E&f.expiredLanes)===0||rs(f,E),P=C?NL(f,E):PI(f,E,!0),B=C;do{if(P===0){sh&&!C&&Sd(f,E,0,!1);break}else{if(v=f.current.alternate,B&&!Em(v)){P=PI(f,E,!1),B=!1;continue}if(P===2){if(B=E,f.errorRecoveryDisabledLanes&B)var ce=0;else ce=f.pendingLanes&-536870913,ce=ce!==0?ce:ce&536870912?536870912:0;if(ce!==0){E=ce;e:{var Ee=f;P=pm;var Fe=Ee.current.memoizedState.isDehydrated;if(Fe&&(s_(Ee,ce).flags|=256),ce=PI(Ee,ce,!1),ce!==2){if(hm&&!Fe){Ee.errorRecoveryDisabledLanes|=B,bp|=B,P=4;break e}B=io,io=P,B!==null&&(io===null?io=B:io.push.apply(io,B))}P=ce}if(B=!1,P!==2)continue}}if(P===1){s_(f,0),Sd(f,E,0,!0);break}e:{switch(C=f,B=P,B){case 0:case 1:throw Error(_(345));case 4:if((E&4194048)!==E)break;case 6:Sd(C,E,gd,!rh);break e;case 2:io=null;break;case 3:case 5:break;default:throw Error(_(329))}if((E&62914560)===E&&(P=_m+300-yi(),10<P)){if(Sd(C,E,gd,!rh),hr(C,0,!0)!==0)break e;C.timeoutHandle=FN(TR.bind(null,C,v,io,cg,fm,E,gd,bp,n_,rh,B,2,-0,0),P);break e}TR(C,v,io,cg,fm,E,gd,bp,n_,rh,B,0,-0,0)}}break}while(!0);ll(f)}function TR(f,E,v,C,P,B,ce,Ee,Fe,Ze,Et,Nt,ot,at){if(f.timeoutHandle=-1,Nt=E.subtreeFlags,(Nt&8192||(Nt&16785408)===16785408)&&(OT={stylesheets:null,count:0,unsuspend:$L},ON(E),Nt=XI(),Nt!==null)){f.cancelPendingCommit=Nt(kN.bind(null,f,E,B,v,C,P,ce,Ee,Fe,Et,1,ot,at)),Sd(f,B,ce,!Ze);return}kN(f,E,B,v,C,P,ce,Ee,Fe)}function Em(f){for(var E=f;;){var v=E.tag;if((v===0||v===11||v===15)&&E.flags&16384&&(v=E.updateQueue,v!==null&&(v=v.stores,v!==null)))for(var C=0;C<v.length;C++){var P=v[C],B=P.getSnapshot;P=P.value;try{if(!Ll(B(),P))return!1}catch{return!1}}if(v=E.child,E.subtreeFlags&16384&&v!==null)v.return=E,E=v;else{if(E===f)break;for(;E.sibling===null;){if(E.return===null||E.return===f)return!0;E=E.return}E.sibling.return=E.return,E=E.sibling}}return!0}function Sd(f,E,v,C){E&=~NI,E&=~bp,f.suspendedLanes|=E,f.pingedLanes&=~E,C&&(f.warmLanes|=E),C=f.expirationTimes;for(var P=E;0<P;){var B=31-rn(P),ce=1<<B;C[B]=-1,P&=~ce}v!==0&&Fo(f,v,E)}function ah(){return(Or&6)===0?(ST(0),!1):!0}function Ip(){if(Wi!==null){if(Nr===0)var f=Wi.return;else f=Wi,dp=tm=null,_I(f),Kf=null,$a=0,f=Wi;for(;f!==null;)TN(f.alternate,f),f=f.return;Wi=null}}function s_(f,E){var v=f.timeoutHandle;v!==-1&&(f.timeoutHandle=-1,FL(v)),v=f.cancelPendingCommit,v!==null&&(f.cancelPendingCommit=null,v()),Ip(),Fs=f,Wi=v=op(f.current,null),_r=E,Nr=0,Go=null,rh=!1,sh=rs(f,E),hm=!1,n_=gd=NI=bp=al=no=0,io=pm=null,fm=!1,(E&8)!==0&&(E|=E&32);var C=f.entangledLanes;if(C!==0)for(f=f.entanglements,C&=E;0<C;){var P=31-rn(C),B=1<<P;E|=f[P],C&=~B}return ru=E,Qu(),v}function Td(f,E){xi=null,Me.H=No,E===pp||E===Wy?(E=UO(),Nr=3):E===kO?(E=UO(),Nr=4):Nr=E===hN?8:E!==null&&typeof E=="object"&&typeof E.then=="function"?6:1,Go=E,Wi===null&&(no=1,aR(f,el(E,f.current)))}function cl(){var f=Me.H;return Me.H=No,f===null?No:f}function PN(){var f=Me.A;return Me.A=mT,f}function su(){no=4,rh||(_r&4194048)!==_r&&Vs.current!==null||(sh=!0),(al&134217727)===0&&(bp&134217727)===0||Fs===null||Sd(Fs,_r,gd,!1)}function PI(f,E,v){var C=Or;Or|=2;var P=cl(),B=PN();(Fs!==f||_r!==E)&&(cg=null,s_(f,E)),E=!1;var ce=no;e:do try{if(Nr!==0&&Wi!==null){var Ee=Wi,Fe=Go;switch(Nr){case 8:Ip(),ce=6;break e;case 3:case 2:case 9:case 6:Vs.current===null&&(E=!0);var Ze=Nr;if(Nr=0,Go=null,o_(f,Ee,Fe,Ze),v&&sh){ce=0;break e}break;default:Ze=Nr,Nr=0,Go=null,o_(f,Ee,Fe,Ze)}}OL(),ce=no;break}catch(Et){Td(f,Et)}while(!0);return E&&f.shellSuspendCounter++,dp=tm=null,Or=C,Me.H=P,Me.A=B,Wi===null&&(Fs=null,_r=0,Qu()),ce}function OL(){for(;Wi!==null;)vR(Wi)}function NL(f,E){var v=Or;Or|=2;var C=cl(),P=PN();Fs!==f||_r!==E?(cg=null,i_=yi()+500,s_(f,E)):sh=rs(f,E);e:do try{if(Nr!==0&&Wi!==null){E=Wi;var B=Go;t:switch(Nr){case 1:Nr=0,Go=null,o_(f,E,B,1);break;case 2:case 9:if(LO(B)){Nr=0,Go=null,ug(E);break}E=function(){Nr!==2&&Nr!==9||Fs!==f||(Nr=7),ll(f)},B.then(E,E);break e;case 3:Nr=7;break e;case 4:Nr=5;break e;case 7:LO(B)?(Nr=0,Go=null,ug(E)):(Nr=0,Go=null,o_(f,E,B,7));break;case 5:var ce=null;switch(Wi.tag){case 26:ce=Wi.memoizedState;case 5:case 27:var Ee=Wi;if(!ce||qN(ce)){Nr=0,Go=null;var Fe=Ee.sibling;if(Fe!==null)Wi=Fe;else{var Ze=Ee.return;Ze!==null?(Wi=Ze,yR(Ze)):Wi=null}break t}}Nr=0,Go=null,o_(f,E,B,5);break;case 6:Nr=0,Go=null,o_(f,E,B,6);break;case 8:Ip(),no=6;break e;default:throw Error(_(462))}}DL();break}catch(Et){Td(f,Et)}while(!0);return dp=tm=null,Me.H=C,Me.A=P,Or=v,Wi!==null?0:(Fs=null,_r=0,Qu(),no)}function DL(){for(;Wi!==null&&!Zi();)vR(Wi)}function vR(f){var E=Qf(f.alternate,f,ru);f.memoizedProps=f.pendingProps,E===null?yR(f):Wi=E}function ug(f){var E=f,v=E.alternate;switch(E.tag){case 15:case 0:E=dR(v,E,E.pendingProps,E.type,void 0,_r);break;case 11:E=dR(v,E,E.pendingProps,E.type.render,E.ref,_r);break;case 5:_I(E);default:TN(v,E),E=Wi=FE(E,ru),E=Qf(v,E,ru)}f.memoizedProps=f.pendingProps,E===null?yR(f):Wi=E}function o_(f,E,v,C){dp=tm=null,_I(E),Kf=null,$a=0;var P=E.return;try{if(RL(f,P,E,v,_r)){no=1,aR(f,el(v,f.current)),Wi=null;return}}catch(B){if(P!==null)throw Wi=P,B;no=1,aR(f,el(v,f.current)),Wi=null;return}E.flags&32768?(Hr||C===1?f=!0:sh||(_r&536870912)!==0?f=!1:(rh=f=!0,(C===2||C===9||C===3||C===6)&&(C=Vs.current,C!==null&&C.tag===13&&(C.flags|=16384))),RR(E,f)):yR(E)}function yR(f){var E=f;do{if((E.flags&32768)!==0){RR(E,rh);return}f=E.return;var v=bL(E.alternate,E,ru);if(v!==null){Wi=v;return}if(E=E.sibling,E!==null){Wi=E;return}Wi=E=f}while(E!==null);no===0&&(no=5)}function RR(f,E){do{var v=IL(f.alternate,f);if(v!==null){v.flags&=32767,Wi=v;return}if(v=f.return,v!==null&&(v.flags|=32768,v.subtreeFlags=0,v.deletions=null),!E&&(f=f.sibling,f!==null)){Wi=f;return}Wi=f=v}while(f!==null);no=6,Wi=null}function kN(f,E,v,C,P,B,ce,Ee,Fe){f.cancelPendingCommit=null;do bR();while(tc!==0);if((Or&6)!==0)throw Error(_(327));if(E!==null){if(E===f.current)throw Error(_(177));if(B=E.lanes|E.childLanes,B|=Qb,ho(f,v,B,ce,Ee,Fe),f===Fs&&(Wi=Fs=null,_r=0),mc=E,r_=f,lg=v,ET=B,mm=P,DN=C,(E.subtreeFlags&10256)!==0||(E.flags&10256)!==0?(f.callbackNode=null,f.callbackPriority=0,LL(Bi,function(){return hg(),null})):(f.callbackNode=null,f.callbackPriority=0),C=(E.flags&13878)!==0,(E.subtreeFlags&13878)!==0||C){C=Me.T,Me.T=null,P=Je.p,Je.p=2,ce=Or,Or|=4;try{Cp(f,E,v)}finally{Or=ce,Je.p=P,Me.T=C}}tc=1,ch(),ua(),CR()}}function ch(){if(tc===1){tc=0;var f=r_,E=mc,v=(E.flags&13878)!==0;if((E.subtreeFlags&13878)!==0||v){v=Me.T,Me.T=null;var C=Je.p;Je.p=2;var P=Or;Or|=4;try{AN(E,f);var B=Dp,ce=fc(f.containerInfo),Ee=B.focusedElem,Fe=B.selectionRange;if(ce!==Ee&&Ee&&Ee.ownerDocument&&vO(Ee.ownerDocument.documentElement,Ee)){if(Fe!==null&&zb(Ee)){var Ze=Fe.start,Et=Fe.end;if(Et===void 0&&(Et=Ze),"selectionStart"in Ee)Ee.selectionStart=Ze,Ee.selectionEnd=Math.min(Et,Ee.value.length);else{var Nt=Ee.ownerDocument||document,ot=Nt&&Nt.defaultView||window;if(ot.getSelection){var at=ot.getSelection(),Si=Ee.textContent.length,Xn=Math.min(Fe.start,Si),_s=Fe.end===void 0?Xn:Math.min(Fe.end,Si);!at.extend&&Xn>_s&&(ce=_s,_s=Xn,Xn=ce);var Qe=TO(Ee,Xn),Ke=TO(Ee,_s);if(Qe&&Ke&&(at.rangeCount!==1||at.anchorNode!==Qe.node||at.anchorOffset!==Qe.offset||at.focusNode!==Ke.node||at.focusOffset!==Ke.offset)){var et=Nt.createRange();et.setStart(Qe.node,Qe.offset),at.removeAllRanges(),Xn>_s?(at.addRange(et),at.extend(Ke.node,Ke.offset)):(et.setEnd(Ke.node,Ke.offset),at.addRange(et))}}}}for(Nt=[],at=Ee;at=at.parentNode;)at.nodeType===1&&Nt.push({element:at,left:at.scrollLeft,top:at.scrollTop});for(typeof Ee.focus=="function"&&Ee.focus(),Ee=0;Ee<Nt.length;Ee++){var bt=Nt[Ee];bt.element.scrollLeft=bt.left,bt.element.scrollTop=bt.top}}WR=!!BI,Dp=BI=null}finally{Or=P,Je.p=C,Me.T=v}}f.current=E,tc=2}}function ua(){if(tc===2){tc=0;var f=r_,E=mc,v=(E.flags&8772)!==0;if((E.subtreeFlags&8772)!==0||v){v=Me.T,Me.T=null;var C=Je.p;Je.p=2;var P=Or;Or|=4;try{mR(f,E.alternate,E)}finally{Or=P,Je.p=C,Me.T=v}}tc=3}}function CR(){if(tc===4||tc===3){tc=0,Gi();var f=r_,E=mc,v=lg,C=DN;(E.subtreeFlags&10256)!==0||(E.flags&10256)!==0?tc=5:(tc=0,mc=r_=null,LN(f,f.pendingLanes));var P=f.pendingLanes;if(P===0&&(oh=null),bE(v),E=E.stateNode,Ot&&typeof Ot.onCommitFiberRoot=="function")try{Ot.onCommitFiberRoot(wt,E,void 0,(E.current.flags&128)===128)}catch{}if(C!==null){E=Me.T,P=Je.p,Je.p=2,Me.T=null;try{for(var B=f.onRecoverableError,ce=0;ce<C.length;ce++){var Ee=C[ce];B(Ee.value,{componentStack:Ee.stack})}}finally{Me.T=E,Je.p=P}}(lg&3)!==0&&bR(),ll(f),P=f.pendingLanes,(v&4194090)!==0&&(P&42)!==0?f===DI?gT++:(gT=0,DI=f):gT=0,ST(0)}}function LN(f,E){(f.pooledCacheLanes&=E)===0&&(E=f.pooledCache,E!=null&&(f.pooledCache=null,JS(E)))}function bR(f){return ch(),ua(),CR(),hg()}function hg(){if(tc!==5)return!1;var f=r_,E=ET;ET=0;var v=bE(lg),C=Me.T,P=Je.p;try{Je.p=32>v?32:v,Me.T=null,v=mm,mm=null;var B=r_,ce=lg;if(tc=0,mc=r_=null,lg=0,(Or&6)!==0)throw Error(_(331));var Ee=Or;if(Or|=4,NN(B.current),wN(B,B.current,ce,v),Or=Ee,ST(0,!1),Ot&&typeof Ot.onPostCommitFiberRoot=="function")try{Ot.onPostCommitFiberRoot(wt,B)}catch{}return!0}finally{Je.p=P,Me.T=C,LN(f,E)}}function IR(f,E,v){E=el(v,E),E=ya(f.stateNode,E,2),f=$u(f,E,2),f!==null&&(Xr(f,2),ll(f))}function ys(f,E,v){if(f.tag===3)IR(f,f,v);else for(;E!==null;){if(E.tag===3){IR(E,f,v);break}else if(E.tag===1){var C=E.stateNode;if(typeof E.type.getDerivedStateFromError=="function"||typeof C.componentDidCatch=="function"&&(oh===null||!oh.has(C))){f=el(v,f),v=dN(2),C=$u(E,v,2),C!==null&&(uN(v,C,E,f),Xr(C,2),ll(C));break}}E=E.return}}function Ap(f,E,v){var C=f.pingCache;if(C===null){C=f.pingCache=new wL;var P=new Set;C.set(E,P)}else P=C.get(E),P===void 0&&(P=new Set,C.set(E,P));P.has(v)||(hm=!0,P.add(v),f=Lc.bind(null,f,E,v),E.then(f,f))}function Lc(f,E,v){var C=f.pingCache;C!==null&&C.delete(E),f.pingedLanes|=f.suspendedLanes&v,f.warmLanes&=~v,Fs===f&&(_r&v)===v&&(no===4||no===3&&(_r&62914560)===_r&&300>yi()-_m?(Or&2)===0&&s_(f,0):NI|=v,n_===_r&&(n_=0)),ll(f)}function lh(f,E){E===0&&(E=Rf()),f=VE(f,E),f!==null&&(Xr(f,E),ll(f))}function PL(f){var E=f.memoizedState,v=0;E!==null&&(v=E.retryLane),lh(f,v)}function kL(f,E){var v=0;switch(f.tag){case 13:var C=f.stateNode,P=f.memoizedState;P!==null&&(v=P.retryLane);break;case 19:C=f.stateNode;break;case 22:C=f.stateNode._retryCache;break;default:throw Error(_(314))}C!==null&&C.delete(E),lh(f,v)}function LL(f,E){return Kn(f,E)}var AR=null,dh=null,kI=!1,wR=!1,LI=!1,wp=0;function ll(f){f!==dh&&f.next===null&&(dh===null?AR=dh=f:dh=dh.next=f),wR=!0,kI||(kI=!0,MI())}function ST(f,E){if(!LI&&wR){LI=!0;do for(var v=!1,C=AR;C!==null;){if(f!==0){var P=C.pendingLanes;if(P===0)var B=0;else{var ce=C.suspendedLanes,Ee=C.pingedLanes;B=(1<<31-rn(42|f)+1)-1,B&=P&~(ce&~Ee),B=B&201326741?B&201326741|1:B?B|2:0}B!==0&&(v=!0,NR(C,B))}else B=_r,B=hr(C,C===Fs?B:0,C.cancelPendingCommit!==null||C.timeoutHandle!==-1),(B&3)===0||rs(C,B)||(v=!0,NR(C,B));C=C.next}while(v);LI=!1}}function ML(){MN()}function MN(){wR=kI=!1;var f=0;wp!==0&&(VL()&&(f=wp),wp=0);for(var E=yi(),v=null,C=AR;C!==null;){var P=C.next,B=OR(C,E);B===0?(C.next=null,v===null?AR=P:v.next=P,P===null&&(dh=v)):(v=C,(f!==0||(B&3)!==0)&&(wR=!0)),C=P}ST(f)}function OR(f,E){for(var v=f.suspendedLanes,C=f.pingedLanes,P=f.expirationTimes,B=f.pendingLanes&-62914561;0<B;){var ce=31-rn(B),Ee=1<<ce,Fe=P[ce];Fe===-1?((Ee&v)===0||(Ee&C)!==0)&&(P[ce]=eo(Ee,E)):Fe<=E&&(f.expiredLanes|=Ee),B&=~Ee}if(E=Fs,v=_r,v=hr(f,f===E?v:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),C=f.callbackNode,v===0||f===E&&(Nr===2||Nr===9)||f.cancelPendingCommit!==null)return C!==null&&C!==null&&qn(C),f.callbackNode=null,f.callbackPriority=0;if((v&3)===0||rs(f,v)){if(E=v&-v,E===f.callbackPriority)return E;switch(C!==null&&qn(C),bE(v)){case 2:case 8:v=ir;break;case 32:v=Bi;break;case 268435456:v=Us;break;default:v=Bi}return C=pg.bind(null,f),v=Kn(v,C),f.callbackPriority=E,f.callbackNode=v,E}return C!==null&&C!==null&&qn(C),f.callbackPriority=2,f.callbackNode=null,2}function pg(f,E){if(tc!==0&&tc!==5)return f.callbackNode=null,f.callbackPriority=0,null;var v=f.callbackNode;if(bR()&&f.callbackNode!==v)return null;var C=_r;return C=hr(f,f===Fs?C:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),C===0?null:(SR(f,C,E),OR(f,yi()),f.callbackNode!=null&&f.callbackNode===v?pg.bind(null,f):null)}function NR(f,E){if(bR())return null;SR(f,E,!0)}function MI(){BL(function(){(Or&6)!==0?Kn(xn,ML):MN()})}function Op(){return wp===0&&(wp=Qc()),wp}function DR(f){return f==null||typeof f=="symbol"||typeof f=="boolean"?null:typeof f=="function"?f:OE(""+f)}function UN(f,E){var v=E.ownerDocument.createElement("input");return v.name=E.name,v.value=E.value,f.id&&v.setAttribute("form",f.id),E.parentNode.insertBefore(v,E),f=new FormData(f),v.parentNode.removeChild(v),f}function TT(f,E,v,C,P){if(E==="submit"&&v&&v.stateNode===P){var B=DR((P[oa]||null).action),ce=C.submitter;ce&&(E=(E=ce[oa]||null)?DR(E.formAction):ce.getAttribute("formAction"),E!==null&&(B=E,ce=null));var Ee=new aa("action","action",null,C,P);f.push({event:Ee,listeners:[{instance:null,listener:function(){if(C.defaultPrevented){if(wp!==0){var Fe=ce?UN(P,ce):new FormData(P);Tp(v,{pending:!0,data:Fe,method:P.method,action:B},null,Fe)}}else typeof B=="function"&&(Ee.preventDefault(),Fe=ce?UN(P,ce):new FormData(P),Tp(v,{pending:!0,data:Fe,method:P.method,action:B},B,Fe))},currentTarget:P}]})}}for(var UI=0;UI<Jb.length;UI++){var xI=Jb[UI],Np=xI.toLowerCase(),vT=xI[0].toUpperCase()+xI.slice(1);Jd(Np,"on"+vT)}Jd(CO,"onAnimationEnd"),Jd(bO,"onAnimationIteration"),Jd(UE,"onAnimationStart"),Jd("dblclick","onDoubleClick"),Jd("focusin","onFocus"),Jd("focusout","onBlur"),Jd(KS,"onTransitionRun"),Jd(pL,"onTransitionStart"),Jd(Re,"onTransitionCancel"),Jd(IO,"onTransitionEnd"),Yh("onMouseEnter",["mouseout","mouseover"]),Yh("onMouseLeave",["mouseout","mouseover"]),Yh("onPointerEnter",["pointerout","pointerover"]),Yh("onPointerLeave",["pointerout","pointerover"]),Bo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Bo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Bo("onBeforeInput",["compositionend","keypress","textInput","paste"]),Bo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Bo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Bo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var gm="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),yT=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(gm));function fg(f,E){E=(E&4)!==0;for(var v=0;v<f.length;v++){var C=f[v],P=C.event;C=C.listeners;e:{var B=void 0;if(E)for(var ce=C.length-1;0<=ce;ce--){var Ee=C[ce],Fe=Ee.instance,Ze=Ee.currentTarget;if(Ee=Ee.listener,Fe!==B&&P.isPropagationStopped())break e;B=Ee,P.currentTarget=Ze;try{B(P)}catch(Et){oR(Et)}P.currentTarget=null,B=Fe}else for(ce=0;ce<C.length;ce++){if(Ee=C[ce],Fe=Ee.instance,Ze=Ee.currentTarget,Ee=Ee.listener,Fe!==B&&P.isPropagationStopped())break e;B=Ee,P.currentTarget=Ze;try{B(P)}catch(Et){oR(Et)}P.currentTarget=null,B=Fe}}}}function Vi(f,E){var v=E[B_];v===void 0&&(v=E[B_]=new Set);var C=f+"__bubble";v.has(C)||(kR(E,f,2,!1),v.add(C))}function VI(f,E,v){var C=0;E&&(C|=4),kR(v,f,C,E)}var PR="_reactListening"+Math.random().toString(36).slice(2);function RT(f){if(!f[PR]){f[PR]=!0,zh.forEach(function(v){v!=="selectionchange"&&(yT.has(v)||VI(v,!1,f),VI(v,!0,f))});var E=f.nodeType===9?f:f.ownerDocument;E===null||E[PR]||(E[PR]=!0,VI("selectionchange",!1,E))}}function kR(f,E,v,C){switch(ZN(E)){case 2:var P=n1;break;case 8:P=i1;break;default:P=DT}v=P.bind(null,E,v,f),P=void 0,!ld||E!=="touchstart"&&E!=="touchmove"&&E!=="wheel"||(P=!0),C?P!==void 0?f.addEventListener(E,v,{capture:!0,passive:P}):f.addEventListener(E,v,!0):P!==void 0?f.addEventListener(E,v,{passive:P}):f.addEventListener(E,v,!1)}function CT(f,E,v,C,P){var B=C;if((E&1)===0&&(E&2)===0&&C!==null)e:for(;;){if(C===null)return;var ce=C.tag;if(ce===3||ce===4){var Ee=C.stateNode.containerInfo;if(Ee===P)break;if(ce===4)for(ce=C.return;ce!==null;){var Fe=ce.tag;if((Fe===3||Fe===4)&&ce.stateNode.containerInfo===P)return;ce=ce.return}for(;Ee!==null;){if(ce=bf(Ee),ce===null)return;if(Fe=ce.tag,Fe===5||Fe===6||Fe===26||Fe===27){C=B=ce;continue e}Ee=Ee.parentNode}}C=C.return}Ry(function(){var Ze=B,Et=cd(v),Nt=[];e:{var ot=AO.get(f);if(ot!==void 0){var at=aa,Si=f;switch(f){case"keypress":if(Yu(v)===0)break e;case"keydown":case"keyup":at=kE;break;case"focusin":Si="focus",at=Df;break;case"focusout":Si="blur",at=Df;break;case"beforeblur":case"afterblur":at=Df;break;case"click":if(v.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":at=ud;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":at=Gb;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":at=Oy;break;case CO:case bO:case UE:at=Xu;break;case IO:at=LE;break;case"scroll":case"scrollend":at=NE;break;case"wheel":at=Ut;break;case"copy":case"cut":case"paste":at=Ju;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":at=GS;break;case"toggle":case"beforetoggle":at=Py}var Xn=(E&4)!==0,_s=!Xn&&(f==="scroll"||f==="scrollend"),Qe=Xn?ot!==null?ot+"Capture":null:ot;Xn=[];for(var Ke=Ze,et;Ke!==null;){var bt=Ke;if(et=bt.stateNode,bt=bt.tag,bt!==5&&bt!==26&&bt!==27||et===null||Qe===null||(bt=ep(Ke,Qe),bt!=null&&Xn.push(Sm(Ke,bt,et))),_s)break;Ke=Ke.return}0<Xn.length&&(ot=new at(ot,Si,null,v,Et),Nt.push({event:ot,listeners:Xn}))}}if((E&7)===0){e:{if(ot=f==="mouseover"||f==="pointerover",at=f==="mouseout"||f==="pointerout",ot&&v!==Qh&&(Si=v.relatedTarget||v.fromElement)&&(bf(Si)||Si[ka]))break e;if((at||ot)&&(ot=Et.window===Et?Et:(ot=Et.ownerDocument)?ot.defaultView||ot.parentWindow:window,at?(Si=v.relatedTarget||v.toElement,at=Ze,Si=Si?bf(Si):null,Si!==null&&(_s=y(Si),Xn=Si.tag,Si!==_s||Xn!==5&&Xn!==27&&Xn!==6)&&(Si=null)):(at=null,Si=Ze),at!==Si)){if(Xn=ud,bt="onMouseLeave",Qe="onMouseEnter",Ke="mouse",(f==="pointerout"||f==="pointerover")&&(Xn=GS,bt="onPointerLeave",Qe="onPointerEnter",Ke="pointer"),_s=at==null?ot:Hu(at),et=Si==null?ot:Hu(Si),ot=new Xn(bt,Ke+"leave",at,v,Et),ot.target=_s,ot.relatedTarget=et,bt=null,bf(Et)===Ze&&(Xn=new Xn(Qe,Ke+"enter",Si,v,Et),Xn.target=et,Xn.relatedTarget=_s,bt=Xn),_s=bt,at&&Si)t:{for(Xn=at,Qe=Si,Ke=0,et=Xn;et;et=mg(et))Ke++;for(et=0,bt=Qe;bt;bt=mg(bt))et++;for(;0<Ke-et;)Xn=mg(Xn),Ke--;for(;0<et-Ke;)Qe=mg(Qe),et--;for(;Ke--;){if(Xn===Qe||Qe!==null&&Xn===Qe.alternate)break t;Xn=mg(Xn),Qe=mg(Qe)}Xn=null}else Xn=null;at!==null&&LR(Nt,ot,at,Xn,!1),Si!==null&&_s!==null&&LR(Nt,_s,Si,Xn,!0)}}e:{if(ot=Ze?Hu(Ze):window,at=ot.nodeName&&ot.nodeName.toLowerCase(),at==="select"||at==="input"&&ot.type==="file")var Zt=mO;else if(ip(ot))if(to)Zt=WS;else{Zt=dL;var qi=lL}else at=ot.nodeName,!at||at.toLowerCase()!=="input"||ot.type!=="checkbox"&&ot.type!=="radio"?Ze&&Jh(Ze.elementType)&&(Zt=mO):Zt=Kb;if(Zt&&(Zt=Zt(f,Ze))){$c(Nt,Zt,v,Et);break e}qi&&qi(f,ot,Ze),f==="focusout"&&Ze&&ot.type==="number"&&Ze.memoizedProps.value!=null&&wf(ot,"number",ot.value)}switch(qi=Ze?Hu(Ze):window,f){case"focusin":(ip(qi)||qi.contentEditable==="true")&&(Fr=qi,Yb=Ze,HS=null);break;case"focusout":HS=Yb=Fr=null;break;case"mousedown":qb=!0;break;case"contextmenu":case"mouseup":case"dragend":qb=!1,yO(Nt,v,Et);break;case"selectionchange":if(hL)break;case"keydown":case"keyup":yO(Nt,v,Et)}var Bn;if(N)e:{switch(f){case"compositionstart":var pi="onCompositionStart";break e;case"compositionend":pi="onCompositionEnd";break e;case"compositionupdate":pi="onCompositionUpdate";break e}pi=void 0}else xs?Ht(f,v)&&(pi="onCompositionEnd"):f==="keydown"&&v.keyCode===229&&(pi="onCompositionStart");pi&&(ve&&v.locale!=="ko"&&(xs||pi!=="onCompositionStart"?pi==="onCompositionEnd"&&xs&&(Bn=FS()):(La=Et,Nf="value"in La?La.value:La.textContent,xs=!0)),qi=_g(Ze,pi),0<qi.length&&(pi=new np(pi,f,null,v,Et),Nt.push({event:pi,listeners:qi}),Bn?pi.data=Bn:(Bn=Jr(v),Bn!==null&&(pi.data=Bn)))),(Bn=ie?pr(f,v):Vr(f,v))&&(pi=_g(Ze,"onBeforeInput"),0<pi.length&&(qi=new np("onBeforeInput","beforeinput",null,v,Et),Nt.push({event:qi,listeners:pi}),qi.data=Bn)),TT(Nt,f,Ze,v,Et)}fg(Nt,E)})}function Sm(f,E,v){return{instance:f,listener:E,currentTarget:v}}function _g(f,E){for(var v=E+"Capture",C=[];f!==null;){var P=f,B=P.stateNode;if(P=P.tag,P!==5&&P!==26&&P!==27||B===null||(P=ep(f,v),P!=null&&C.unshift(Sm(f,P,B)),P=ep(f,E),P!=null&&C.push(Sm(f,P,B))),f.tag===3)return C;f=f.return}return[]}function mg(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5&&f.tag!==27);return f||null}function LR(f,E,v,C,P){for(var B=E._reactName,ce=[];v!==null&&v!==C;){var Ee=v,Fe=Ee.alternate,Ze=Ee.stateNode;if(Ee=Ee.tag,Fe!==null&&Fe===C)break;Ee!==5&&Ee!==26&&Ee!==27||Ze===null||(Fe=Ze,P?(Ze=ep(v,B),Ze!=null&&ce.unshift(Sm(v,Ze,Fe))):P||(Ze=ep(v,B),Ze!=null&&ce.push(Sm(v,Ze,Fe)))),v=v.return}ce.length!==0&&f.push({event:E,listeners:ce})}var UL=/\r\n?/g,ou=/\u0000|\uFFFD/g;function vd(f){return(typeof f=="string"?f:""+f).replace(UL,`
`).replace(ou,"")}function Eg(f,E){return E=vd(E),vd(f)===E}function gg(){}function Qr(f,E,v,C,P,B){switch(v){case"children":typeof C=="string"?E==="body"||E==="textarea"&&C===""||hc(f,C):(typeof C=="number"||typeof C=="bigint")&&E!=="body"&&hc(f,""+C);break;case"className":Ku(f,"class",C);break;case"tabIndex":Ku(f,"tabindex",C);break;case"dir":case"role":case"viewBox":case"width":case"height":Ku(f,v,C);break;case"style":US(f,C,B);break;case"data":if(E!=="object"){Ku(f,"data",C);break}case"src":case"href":if(C===""&&(E!=="a"||v!=="href")){f.removeAttribute(v);break}if(C==null||typeof C=="function"||typeof C=="symbol"||typeof C=="boolean"){f.removeAttribute(v);break}C=OE(""+C),f.setAttribute(v,C);break;case"action":case"formAction":if(typeof C=="function"){f.setAttribute(v,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof B=="function"&&(v==="formAction"?(E!=="input"&&Qr(f,E,"name",P.name,P,null),Qr(f,E,"formEncType",P.formEncType,P,null),Qr(f,E,"formMethod",P.formMethod,P,null),Qr(f,E,"formTarget",P.formTarget,P,null)):(Qr(f,E,"encType",P.encType,P,null),Qr(f,E,"method",P.method,P,null),Qr(f,E,"target",P.target,P,null)));if(C==null||typeof C=="symbol"||typeof C=="boolean"){f.removeAttribute(v);break}C=OE(""+C),f.setAttribute(v,C);break;case"onClick":C!=null&&(f.onclick=gg);break;case"onScroll":C!=null&&Vi("scroll",f);break;case"onScrollEnd":C!=null&&Vi("scrollend",f);break;case"dangerouslySetInnerHTML":if(C!=null){if(typeof C!="object"||!("__html"in C))throw Error(_(61));if(v=C.__html,v!=null){if(P.children!=null)throw Error(_(60));f.innerHTML=v}}break;case"multiple":f.multiple=C&&typeof C!="function"&&typeof C!="symbol";break;case"muted":f.muted=C&&typeof C!="function"&&typeof C!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(C==null||typeof C=="function"||typeof C=="boolean"||typeof C=="symbol"){f.removeAttribute("xlink:href");break}v=OE(""+C),f.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",v);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":C!=null&&typeof C!="function"&&typeof C!="symbol"?f.setAttribute(v,""+C):f.removeAttribute(v);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":C&&typeof C!="function"&&typeof C!="symbol"?f.setAttribute(v,""):f.removeAttribute(v);break;case"capture":case"download":C===!0?f.setAttribute(v,""):C!==!1&&C!=null&&typeof C!="function"&&typeof C!="symbol"?f.setAttribute(v,C):f.removeAttribute(v);break;case"cols":case"rows":case"size":case"span":C!=null&&typeof C!="function"&&typeof C!="symbol"&&!isNaN(C)&&1<=C?f.setAttribute(v,C):f.removeAttribute(v);break;case"rowSpan":case"start":C==null||typeof C=="function"||typeof C=="symbol"||isNaN(C)?f.removeAttribute(v):f.setAttribute(v,C);break;case"popover":Vi("beforetoggle",f),Vi("toggle",f),bi(f,"popover",C);break;case"xlinkActuate":Qa(f,"http://www.w3.org/1999/xlink","xlink:actuate",C);break;case"xlinkArcrole":Qa(f,"http://www.w3.org/1999/xlink","xlink:arcrole",C);break;case"xlinkRole":Qa(f,"http://www.w3.org/1999/xlink","xlink:role",C);break;case"xlinkShow":Qa(f,"http://www.w3.org/1999/xlink","xlink:show",C);break;case"xlinkTitle":Qa(f,"http://www.w3.org/1999/xlink","xlink:title",C);break;case"xlinkType":Qa(f,"http://www.w3.org/1999/xlink","xlink:type",C);break;case"xmlBase":Qa(f,"http://www.w3.org/XML/1998/namespace","xml:base",C);break;case"xmlLang":Qa(f,"http://www.w3.org/XML/1998/namespace","xml:lang",C);break;case"xmlSpace":Qa(f,"http://www.w3.org/XML/1998/namespace","xml:space",C);break;case"is":bi(f,"is",C);break;case"innerText":case"textContent":break;default:(!(2<v.length)||v[0]!=="o"&&v[0]!=="O"||v[1]!=="n"&&v[1]!=="N")&&(v=jb.get(v)||v,bi(f,v,C))}}function FI(f,E,v,C,P,B){switch(v){case"style":US(f,C,B);break;case"dangerouslySetInnerHTML":if(C!=null){if(typeof C!="object"||!("__html"in C))throw Error(_(61));if(v=C.__html,v!=null){if(P.children!=null)throw Error(_(60));f.innerHTML=v}}break;case"children":typeof C=="string"?hc(f,C):(typeof C=="number"||typeof C=="bigint")&&hc(f,""+C);break;case"onScroll":C!=null&&Vi("scroll",f);break;case"onScrollEnd":C!=null&&Vi("scrollend",f);break;case"onClick":C!=null&&(f.onclick=gg);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!If.hasOwnProperty(v))e:{if(v[0]==="o"&&v[1]==="n"&&(P=v.endsWith("Capture"),E=v.slice(2,P?v.length-7:void 0),B=f[oa]||null,B=B!=null?B[v]:null,typeof B=="function"&&f.removeEventListener(E,B,P),typeof C=="function")){typeof B!="function"&&B!==null&&(v in f?f[v]=null:f.hasAttribute(v)&&f.removeAttribute(v)),f.addEventListener(E,C,P);break e}v in f?f[v]=C:C===!0?f.setAttribute(v,""):bi(f,v,C)}}}function Ra(f,E,v){switch(E){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Vi("error",f),Vi("load",f);var C=!1,P=!1,B;for(B in v)if(v.hasOwnProperty(B)){var ce=v[B];if(ce!=null)switch(B){case"src":C=!0;break;case"srcSet":P=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(_(137,E));default:Qr(f,E,B,ce,v,null)}}P&&Qr(f,E,"srcSet",v.srcSet,v,null),C&&Qr(f,E,"src",v.src,v,null);return;case"input":Vi("invalid",f);var Ee=B=ce=P=null,Fe=null,Ze=null;for(C in v)if(v.hasOwnProperty(C)){var Et=v[C];if(Et!=null)switch(C){case"name":P=Et;break;case"type":ce=Et;break;case"checked":Fe=Et;break;case"defaultChecked":Ze=Et;break;case"value":B=Et;break;case"defaultValue":Ee=Et;break;case"children":case"dangerouslySetInnerHTML":if(Et!=null)throw Error(_(137,E));break;default:Qr(f,E,C,Et,v,null)}}K_(f,B,Ee,Fe,Ze,ce,P,!1),wE(f);return;case"select":Vi("invalid",f),C=ce=B=null;for(P in v)if(v.hasOwnProperty(P)&&(Ee=v[P],Ee!=null))switch(P){case"value":B=Ee;break;case"defaultValue":ce=Ee;break;case"multiple":C=Ee;default:Qr(f,E,P,Ee,v,null)}E=B,v=ce,f.multiple=!!C,E!=null?qh(f,!!C,E,!1):v!=null&&qh(f,!!C,v,!0);return;case"textarea":Vi("invalid",f),B=P=C=null;for(ce in v)if(v.hasOwnProperty(ce)&&(Ee=v[ce],Ee!=null))switch(ce){case"value":C=Ee;break;case"defaultValue":P=Ee;break;case"children":B=Ee;break;case"dangerouslySetInnerHTML":if(Ee!=null)throw Error(_(91));break;default:Qr(f,E,ce,Ee,v,null)}z_(f,C,P,B),wE(f);return;case"option":for(Fe in v)if(v.hasOwnProperty(Fe)&&(C=v[Fe],C!=null))switch(Fe){case"selected":f.selected=C&&typeof C!="function"&&typeof C!="symbol";break;default:Qr(f,E,Fe,C,v,null)}return;case"dialog":Vi("beforetoggle",f),Vi("toggle",f),Vi("cancel",f),Vi("close",f);break;case"iframe":case"object":Vi("load",f);break;case"video":case"audio":for(C=0;C<gm.length;C++)Vi(gm[C],f);break;case"image":Vi("error",f),Vi("load",f);break;case"details":Vi("toggle",f);break;case"embed":case"source":case"link":Vi("error",f),Vi("load",f);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ze in v)if(v.hasOwnProperty(Ze)&&(C=v[Ze],C!=null))switch(Ze){case"children":case"dangerouslySetInnerHTML":throw Error(_(137,E));default:Qr(f,E,Ze,C,v,null)}return;default:if(Jh(E)){for(Et in v)v.hasOwnProperty(Et)&&(C=v[Et],C!==void 0&&FI(f,E,Et,C,v,void 0));return}}for(Ee in v)v.hasOwnProperty(Ee)&&(C=v[Ee],C!=null&&Qr(f,E,Ee,C,v,null))}function xL(f,E,v,C){switch(E){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var P=null,B=null,ce=null,Ee=null,Fe=null,Ze=null,Et=null;for(at in v){var Nt=v[at];if(v.hasOwnProperty(at)&&Nt!=null)switch(at){case"checked":break;case"value":break;case"defaultValue":Fe=Nt;default:C.hasOwnProperty(at)||Qr(f,E,at,null,C,Nt)}}for(var ot in C){var at=C[ot];if(Nt=v[ot],C.hasOwnProperty(ot)&&(at!=null||Nt!=null))switch(ot){case"type":B=at;break;case"name":P=at;break;case"checked":Ze=at;break;case"defaultChecked":Et=at;break;case"value":ce=at;break;case"defaultValue":Ee=at;break;case"children":case"dangerouslySetInnerHTML":if(at!=null)throw Error(_(137,E));break;default:at!==Nt&&Qr(f,E,ot,at,C,Nt)}}Nl(f,ce,Ee,Fe,Ze,Et,B,P);return;case"select":at=ce=Ee=ot=null;for(B in v)if(Fe=v[B],v.hasOwnProperty(B)&&Fe!=null)switch(B){case"value":break;case"multiple":at=Fe;default:C.hasOwnProperty(B)||Qr(f,E,B,null,C,Fe)}for(P in C)if(B=C[P],Fe=v[P],C.hasOwnProperty(P)&&(B!=null||Fe!=null))switch(P){case"value":ot=B;break;case"defaultValue":Ee=B;break;case"multiple":ce=B;default:B!==Fe&&Qr(f,E,P,B,C,Fe)}E=Ee,v=ce,C=at,ot!=null?qh(f,!!v,ot,!1):!!C!=!!v&&(E!=null?qh(f,!!v,E,!0):qh(f,!!v,v?[]:"",!1));return;case"textarea":at=ot=null;for(Ee in v)if(P=v[Ee],v.hasOwnProperty(Ee)&&P!=null&&!C.hasOwnProperty(Ee))switch(Ee){case"value":break;case"children":break;default:Qr(f,E,Ee,null,C,P)}for(ce in C)if(P=C[ce],B=v[ce],C.hasOwnProperty(ce)&&(P!=null||B!=null))switch(ce){case"value":ot=P;break;case"defaultValue":at=P;break;case"children":break;case"dangerouslySetInnerHTML":if(P!=null)throw Error(_(91));break;default:P!==B&&Qr(f,E,ce,P,C,B)}hs(f,ot,at);return;case"option":for(var Si in v)if(ot=v[Si],v.hasOwnProperty(Si)&&ot!=null&&!C.hasOwnProperty(Si))switch(Si){case"selected":f.selected=!1;break;default:Qr(f,E,Si,null,C,ot)}for(Fe in C)if(ot=C[Fe],at=v[Fe],C.hasOwnProperty(Fe)&&ot!==at&&(ot!=null||at!=null))switch(Fe){case"selected":f.selected=ot&&typeof ot!="function"&&typeof ot!="symbol";break;default:Qr(f,E,Fe,ot,C,at)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Xn in v)ot=v[Xn],v.hasOwnProperty(Xn)&&ot!=null&&!C.hasOwnProperty(Xn)&&Qr(f,E,Xn,null,C,ot);for(Ze in C)if(ot=C[Ze],at=v[Ze],C.hasOwnProperty(Ze)&&ot!==at&&(ot!=null||at!=null))switch(Ze){case"children":case"dangerouslySetInnerHTML":if(ot!=null)throw Error(_(137,E));break;default:Qr(f,E,Ze,ot,C,at)}return;default:if(Jh(E)){for(var _s in v)ot=v[_s],v.hasOwnProperty(_s)&&ot!==void 0&&!C.hasOwnProperty(_s)&&FI(f,E,_s,void 0,C,ot);for(Et in C)ot=C[Et],at=v[Et],!C.hasOwnProperty(Et)||ot===at||ot===void 0&&at===void 0||FI(f,E,Et,ot,C,at);return}}for(var Qe in v)ot=v[Qe],v.hasOwnProperty(Qe)&&ot!=null&&!C.hasOwnProperty(Qe)&&Qr(f,E,Qe,null,C,ot);for(Nt in C)ot=C[Nt],at=v[Nt],!C.hasOwnProperty(Nt)||ot===at||ot==null&&at==null||Qr(f,E,Nt,ot,C,at)}var BI=null,Dp=null;function MR(f){return f.nodeType===9?f:f.ownerDocument}function xN(f){switch(f){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function VN(f,E){if(f===0)switch(E){case"svg":return 1;case"math":return 2;default:return 0}return f===1&&E==="foreignObject"?0:f}function jI(f,E){return f==="textarea"||f==="noscript"||typeof E.children=="string"||typeof E.children=="number"||typeof E.children=="bigint"||typeof E.dangerouslySetInnerHTML=="object"&&E.dangerouslySetInnerHTML!==null&&E.dangerouslySetInnerHTML.__html!=null}var GI=null;function VL(){var f=window.event;return f&&f.type==="popstate"?f===GI?!1:(GI=f,!0):(GI=null,!1)}var FN=typeof setTimeout=="function"?setTimeout:void 0,FL=typeof clearTimeout=="function"?clearTimeout:void 0,BN=typeof Promise=="function"?Promise:void 0,BL=typeof queueMicrotask=="function"?queueMicrotask:typeof BN<"u"?function(f){return BN.resolve(null).then(f).catch(jL)}:FN;function jL(f){setTimeout(function(){throw f})}function a_(f){return f==="head"}function jN(f,E){var v=E,C=0,P=0;do{var B=v.nextSibling;if(f.removeChild(v),B&&B.nodeType===8)if(v=B.data,v==="/$"){if(0<C&&8>C){v=C;var ce=f.ownerDocument;if(v&1&&IT(ce.documentElement),v&2&&IT(ce.body),v&4)for(v=ce.head,IT(v),ce=v.firstChild;ce;){var Ee=ce.nextSibling,Fe=ce.nodeName;ce[Hh]||Fe==="SCRIPT"||Fe==="STYLE"||Fe==="LINK"&&ce.rel.toLowerCase()==="stylesheet"||v.removeChild(ce),ce=Ee}}if(P===0){f.removeChild(B),LT(E);return}P--}else v==="$"||v==="$?"||v==="$!"?P++:C=v.charCodeAt(0)-48;else C=0;v=B}while(v);LT(E)}function WI(f){var E=f.firstChild;for(E&&E.nodeType===10&&(E=E.nextSibling);E;){var v=E;switch(E=E.nextSibling,v.nodeName){case"HTML":case"HEAD":case"BODY":WI(v),Kh(v);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(v.rel.toLowerCase()==="stylesheet")continue}f.removeChild(v)}}function GL(f,E,v,C){for(;f.nodeType===1;){var P=v;if(f.nodeName.toLowerCase()!==E.toLowerCase()){if(!C&&(f.nodeName!=="INPUT"||f.type!=="hidden"))break}else if(C){if(!f[Hh])switch(E){case"meta":if(!f.hasAttribute("itemprop"))break;return f;case"link":if(B=f.getAttribute("rel"),B==="stylesheet"&&f.hasAttribute("data-precedence"))break;if(B!==P.rel||f.getAttribute("href")!==(P.href==null||P.href===""?null:P.href)||f.getAttribute("crossorigin")!==(P.crossOrigin==null?null:P.crossOrigin)||f.getAttribute("title")!==(P.title==null?null:P.title))break;return f;case"style":if(f.hasAttribute("data-precedence"))break;return f;case"script":if(B=f.getAttribute("src"),(B!==(P.src==null?null:P.src)||f.getAttribute("type")!==(P.type==null?null:P.type)||f.getAttribute("crossorigin")!==(P.crossOrigin==null?null:P.crossOrigin))&&B&&f.hasAttribute("async")&&!f.hasAttribute("itemprop"))break;return f;default:return f}}else if(E==="input"&&f.type==="hidden"){var B=P.name==null?null:""+P.name;if(P.type==="hidden"&&f.getAttribute("name")===B)return f}else return f;if(f=au(f.nextSibling),f===null)break}return null}function WL(f,E,v){if(E==="")return null;for(;f.nodeType!==3;)if((f.nodeType!==1||f.nodeName!=="INPUT"||f.type!=="hidden")&&!v||(f=au(f.nextSibling),f===null))return null;return f}function bT(f){return f.data==="$!"||f.data==="$?"&&f.ownerDocument.readyState==="complete"}function HL(f,E){var v=f.ownerDocument;if(f.data!=="$?"||v.readyState==="complete")E();else{var C=function(){E(),v.removeEventListener("DOMContentLoaded",C)};v.addEventListener("DOMContentLoaded",C),f._reactRetry=C}}function au(f){for(;f!=null;f=f.nextSibling){var E=f.nodeType;if(E===1||E===3)break;if(E===8){if(E=f.data,E==="$"||E==="$!"||E==="$?"||E==="F!"||E==="F")break;if(E==="/$")return null}}return f}var HI=null;function GN(f){f=f.previousSibling;for(var E=0;f;){if(f.nodeType===8){var v=f.data;if(v==="$"||v==="$!"||v==="$?"){if(E===0)return f;E--}else v==="/$"&&E++}f=f.previousSibling}return null}function WN(f,E,v){switch(E=MR(v),f){case"html":if(f=E.documentElement,!f)throw Error(_(452));return f;case"head":if(f=E.head,!f)throw Error(_(453));return f;case"body":if(f=E.body,!f)throw Error(_(454));return f;default:throw Error(_(451))}}function IT(f){for(var E=f.attributes;E.length;)f.removeAttributeNode(E[0]);Kh(f)}var yd=new Map,HN=new Set;function UR(f){return typeof f.getRootNode=="function"?f.getRootNode():f.nodeType===9?f:f.ownerDocument}var Pp=Je.d;Je.d={f:KL,r:zL,D:YL,C:qL,L:XL,m:KI,X:QL,S:JL,M:ZL};function KL(){var f=Pp.f(),E=ah();return f||E}function zL(f){var E=Wu(f);E!==null&&E.tag===5&&E.type==="form"?nR(E):Pp.r(f)}var Sg=typeof document>"u"?null:document;function KN(f,E,v){var C=Sg;if(C&&typeof E=="string"&&E){var P=wo(E);P='link[rel="'+f+'"][href="'+P+'"]',typeof v=="string"&&(P+='[crossorigin="'+v+'"]'),HN.has(P)||(HN.add(P),f={rel:f,crossOrigin:v,href:E},C.querySelector(P)===null&&(E=C.createElement("link"),Ra(E,"link",f),po(E),C.head.appendChild(E)))}}function YL(f){Pp.D(f),KN("dns-prefetch",f,null)}function qL(f,E){Pp.C(f,E),KN("preconnect",f,E)}function XL(f,E,v){Pp.L(f,E,v);var C=Sg;if(C&&f&&E){var P='link[rel="preload"][as="'+wo(E)+'"]';E==="image"&&v&&v.imageSrcSet?(P+='[imagesrcset="'+wo(v.imageSrcSet)+'"]',typeof v.imageSizes=="string"&&(P+='[imagesizes="'+wo(v.imageSizes)+'"]')):P+='[href="'+wo(f)+'"]';var B=P;switch(E){case"style":B=Tg(f);break;case"script":B=yg(f)}yd.has(B)||(f=q({rel:"preload",href:E==="image"&&v&&v.imageSrcSet?void 0:f,as:E},v),yd.set(B,f),C.querySelector(P)!==null||E==="style"&&C.querySelector(Tm(B))||E==="script"&&C.querySelector(AT(B))||(E=C.createElement("link"),Ra(E,"link",f),po(E),C.head.appendChild(E)))}}function KI(f,E){Pp.m(f,E);var v=Sg;if(v&&f){var C=E&&typeof E.as=="string"?E.as:"script",P='link[rel="modulepreload"][as="'+wo(C)+'"][href="'+wo(f)+'"]',B=P;switch(C){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":B=yg(f)}if(!yd.has(B)&&(f=q({rel:"modulepreload",href:f},E),yd.set(B,f),v.querySelector(P)===null)){switch(C){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(v.querySelector(AT(B)))return}C=v.createElement("link"),Ra(C,"link",f),po(C),v.head.appendChild(C)}}}function JL(f,E,v){Pp.S(f,E,v);var C=Sg;if(C&&f){var P=Ja(C).hoistableStyles,B=Tg(f);E=E||"default";var ce=P.get(B);if(!ce){var Ee={loading:0,preload:null};if(ce=C.querySelector(Tm(B)))Ee.loading=5;else{f=q({rel:"stylesheet",href:f,"data-precedence":E},v),(v=yd.get(B))&&YI(f,v);var Fe=ce=C.createElement("link");po(Fe),Ra(Fe,"link",f),Fe._p=new Promise(function(Ze,Et){Fe.onload=Ze,Fe.onerror=Et}),Fe.addEventListener("load",function(){Ee.loading|=1}),Fe.addEventListener("error",function(){Ee.loading|=2}),Ee.loading|=4,xR(ce,E,C)}ce={type:"stylesheet",instance:ce,count:1,state:Ee},P.set(B,ce)}}}function QL(f,E){Pp.X(f,E);var v=Sg;if(v&&f){var C=Ja(v).hoistableScripts,P=yg(f),B=C.get(P);B||(B=v.querySelector(AT(P)),B||(f=q({src:f,async:!0},E),(E=yd.get(P))&&qI(f,E),B=v.createElement("script"),po(B),Ra(B,"link",f),v.head.appendChild(B)),B={type:"script",instance:B,count:1,state:null},C.set(P,B))}}function ZL(f,E){Pp.M(f,E);var v=Sg;if(v&&f){var C=Ja(v).hoistableScripts,P=yg(f),B=C.get(P);B||(B=v.querySelector(AT(P)),B||(f=q({src:f,async:!0,type:"module"},E),(E=yd.get(P))&&qI(f,E),B=v.createElement("script"),po(B),Ra(B,"link",f),v.head.appendChild(B)),B={type:"script",instance:B,count:1,state:null},C.set(P,B))}}function zN(f,E,v,C){var P=(P=pn.current)?UR(P):null;if(!P)throw Error(_(446));switch(f){case"meta":case"title":return null;case"style":return typeof v.precedence=="string"&&typeof v.href=="string"?(E=Tg(v.href),v=Ja(P).hoistableStyles,C=v.get(E),C||(C={type:"style",instance:null,count:0,state:null},v.set(E,C)),C):{type:"void",instance:null,count:0,state:null};case"link":if(v.rel==="stylesheet"&&typeof v.href=="string"&&typeof v.precedence=="string"){f=Tg(v.href);var B=Ja(P).hoistableStyles,ce=B.get(f);if(ce||(P=P.ownerDocument||P,ce={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},B.set(f,ce),(B=P.querySelector(Tm(f)))&&!B._p&&(ce.instance=B,ce.state.loading=5),yd.has(f)||(v={rel:"preload",as:"style",href:v.href,crossOrigin:v.crossOrigin,integrity:v.integrity,media:v.media,hrefLang:v.hrefLang,referrerPolicy:v.referrerPolicy},yd.set(f,v),B||zI(P,f,v,ce.state))),E&&C===null)throw Error(_(528,""));return ce}if(E&&C!==null)throw Error(_(529,""));return null;case"script":return E=v.async,v=v.src,typeof v=="string"&&E&&typeof E!="function"&&typeof E!="symbol"?(E=yg(v),v=Ja(P).hoistableScripts,C=v.get(E),C||(C={type:"script",instance:null,count:0,state:null},v.set(E,C)),C):{type:"void",instance:null,count:0,state:null};default:throw Error(_(444,f))}}function Tg(f){return'href="'+wo(f)+'"'}function Tm(f){return'link[rel="stylesheet"]['+f+"]"}function vg(f){return q({},f,{"data-precedence":f.precedence,precedence:null})}function zI(f,E,v,C){f.querySelector('link[rel="preload"][as="style"]['+E+"]")?C.loading=1:(E=f.createElement("link"),C.preload=E,E.addEventListener("load",function(){return C.loading|=1}),E.addEventListener("error",function(){return C.loading|=2}),Ra(E,"link",v),po(E),f.head.appendChild(E))}function yg(f){return'[src="'+wo(f)+'"]'}function AT(f){return"script[async]"+f}function Rg(f,E,v){if(E.count++,E.instance===null)switch(E.type){case"style":var C=f.querySelector('style[data-href~="'+wo(v.href)+'"]');if(C)return E.instance=C,po(C),C;var P=q({},v,{"data-href":v.href,"data-precedence":v.precedence,href:null,precedence:null});return C=(f.ownerDocument||f).createElement("style"),po(C),Ra(C,"style",P),xR(C,v.precedence,f),E.instance=C;case"stylesheet":P=Tg(v.href);var B=f.querySelector(Tm(P));if(B)return E.state.loading|=4,E.instance=B,po(B),B;C=vg(v),(P=yd.get(P))&&YI(C,P),B=(f.ownerDocument||f).createElement("link"),po(B);var ce=B;return ce._p=new Promise(function(Ee,Fe){ce.onload=Ee,ce.onerror=Fe}),Ra(B,"link",C),E.state.loading|=4,xR(B,v.precedence,f),E.instance=B;case"script":return B=yg(v.src),(P=f.querySelector(AT(B)))?(E.instance=P,po(P),P):(C=v,(P=yd.get(B))&&(C=q({},v),qI(C,P)),f=f.ownerDocument||f,P=f.createElement("script"),po(P),Ra(P,"link",C),f.head.appendChild(P),E.instance=P);case"void":return null;default:throw Error(_(443,E.type))}else E.type==="stylesheet"&&(E.state.loading&4)===0&&(C=E.instance,E.state.loading|=4,xR(C,v.precedence,f));return E.instance}function xR(f,E,v){for(var C=v.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),P=C.length?C[C.length-1]:null,B=P,ce=0;ce<C.length;ce++){var Ee=C[ce];if(Ee.dataset.precedence===E)B=Ee;else if(B!==P)break}B?B.parentNode.insertBefore(f,B.nextSibling):(E=v.nodeType===9?v.head:v,E.insertBefore(f,E.firstChild))}function YI(f,E){f.crossOrigin==null&&(f.crossOrigin=E.crossOrigin),f.referrerPolicy==null&&(f.referrerPolicy=E.referrerPolicy),f.title==null&&(f.title=E.title)}function qI(f,E){f.crossOrigin==null&&(f.crossOrigin=E.crossOrigin),f.referrerPolicy==null&&(f.referrerPolicy=E.referrerPolicy),f.integrity==null&&(f.integrity=E.integrity)}var VR=null;function FR(f,E,v){if(VR===null){var C=new Map,P=VR=new Map;P.set(v,C)}else P=VR,C=P.get(v),C||(C=new Map,P.set(v,C));if(C.has(f))return C;for(C.set(f,null),v=v.getElementsByTagName(f),P=0;P<v.length;P++){var B=v[P];if(!(B[Hh]||B[Sa]||f==="link"&&B.getAttribute("rel")==="stylesheet")&&B.namespaceURI!=="http://www.w3.org/2000/svg"){var ce=B.getAttribute(E)||"";ce=f+ce;var Ee=C.get(ce);Ee?Ee.push(B):C.set(ce,[B])}}return C}function YN(f,E,v){f=f.ownerDocument||f,f.head.insertBefore(v,E==="title"?f.querySelector("head > title"):null)}function wT(f,E,v){if(v===1||E.itemProp!=null)return!1;switch(f){case"meta":case"title":return!0;case"style":if(typeof E.precedence!="string"||typeof E.href!="string"||E.href==="")break;return!0;case"link":if(typeof E.rel!="string"||typeof E.href!="string"||E.href===""||E.onLoad||E.onError)break;switch(E.rel){case"stylesheet":return f=E.disabled,typeof E.precedence=="string"&&f==null;default:return!0}case"script":if(E.async&&typeof E.async!="function"&&typeof E.async!="symbol"&&!E.onLoad&&!E.onError&&E.src&&typeof E.src=="string")return!0}return!1}function qN(f){return!(f.type==="stylesheet"&&(f.state.loading&3)===0)}var OT=null;function $L(){}function e1(f,E,v){if(OT===null)throw Error(_(475));var C=OT;if(E.type==="stylesheet"&&(typeof v.media!="string"||matchMedia(v.media).matches!==!1)&&(E.state.loading&4)===0){if(E.instance===null){var P=Tg(v.href),B=f.querySelector(Tm(P));if(B){f=B._p,f!==null&&typeof f=="object"&&typeof f.then=="function"&&(C.count++,C=BR.bind(C),f.then(C,C)),E.state.loading|=4,E.instance=B,po(B);return}B=f.ownerDocument||f,v=vg(v),(P=yd.get(P))&&YI(v,P),B=B.createElement("link"),po(B);var ce=B;ce._p=new Promise(function(Ee,Fe){ce.onload=Ee,ce.onerror=Fe}),Ra(B,"link",v),E.instance=B}C.stylesheets===null&&(C.stylesheets=new Map),C.stylesheets.set(E,f),(f=E.state.preload)&&(E.state.loading&3)===0&&(C.count++,E=BR.bind(C),f.addEventListener("load",E),f.addEventListener("error",E))}}function XI(){if(OT===null)throw Error(_(475));var f=OT;return f.stylesheets&&f.count===0&&vm(f,f.stylesheets),0<f.count?function(E){var v=setTimeout(function(){if(f.stylesheets&&vm(f,f.stylesheets),f.unsuspend){var C=f.unsuspend;f.unsuspend=null,C()}},6e4);return f.unsuspend=E,function(){f.unsuspend=null,clearTimeout(v)}}:null}function BR(){if(this.count--,this.count===0){if(this.stylesheets)vm(this,this.stylesheets);else if(this.unsuspend){var f=this.unsuspend;this.unsuspend=null,f()}}}var Cg=null;function vm(f,E){f.stylesheets=null,f.unsuspend!==null&&(f.count++,Cg=new Map,E.forEach(t1,f),Cg=null,BR.call(f))}function t1(f,E){if(!(E.state.loading&4)){var v=Cg.get(f);if(v)var C=v.get(null);else{v=new Map,Cg.set(f,v);for(var P=f.querySelectorAll("link[data-precedence],style[data-precedence]"),B=0;B<P.length;B++){var ce=P[B];(ce.nodeName==="LINK"||ce.getAttribute("media")!=="not all")&&(v.set(ce.dataset.precedence,ce),C=ce)}C&&v.set(null,C)}P=E.instance,ce=P.getAttribute("data-precedence"),B=v.get(ce)||C,B===C&&v.set(null,P),v.set(ce,P),this.count++,C=BR.bind(this),P.addEventListener("load",C),P.addEventListener("error",C),B?B.parentNode.insertBefore(P,B.nextSibling):(f=f.nodeType===9?f.head:f,f.insertBefore(P,f.firstChild)),E.state.loading|=4}}var NT={$$typeof:Ae,Provider:null,Consumer:null,_currentValue:mt,_currentValue2:mt,_threadCount:0};function JI(f,E,v,C,P,B,ce,Ee){this.tag=1,this.containerInfo=f,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Yd(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Yd(0),this.hiddenUpdates=Yd(null),this.identifierPrefix=C,this.onUncaughtError=P,this.onCaughtError=B,this.onRecoverableError=ce,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Ee,this.incompleteTransitions=new Map}function XN(f,E,v,C,P,B,ce,Ee,Fe,Ze,Et,Nt){return f=new JI(f,E,v,ce,Ee,Fe,Ze,Nt),E=1,B===!0&&(E|=24),B=Ml(3,null,null,E),f.current=B,B.stateNode=f,E=nm(),E.refCount++,f.pooledCache=E,E.refCount++,B.memoizedState={element:C,isDehydrated:v,cache:E},$S(B),f}function jR(f){return f?(f=_d,f):_d}function GR(f,E,v,C,P,B){P=jR(P),C.context===null?C.context=P:C.pendingContext=P,C=xf(E),C.payload={element:v},B=B===void 0?null:B,B!==null&&(C.callback=B),v=$u(f,C,E),v!==null&&(kc(v,f,E),eT(v,f,E))}function JN(f,E){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var v=f.retryLane;f.retryLane=v!==0&&v<E?v:E}}function QI(f,E){JN(f,E),(f=f.alternate)&&JN(f,E)}function QN(f){if(f.tag===13){var E=VE(f,67108864);E!==null&&kc(E,f,67108864),QI(f,67108864)}}var WR=!0;function n1(f,E,v,C){var P=Me.T;Me.T=null;var B=Je.p;try{Je.p=2,DT(f,E,v,C)}finally{Je.p=B,Me.T=P}}function i1(f,E,v,C){var P=Me.T;Me.T=null;var B=Je.p;try{Je.p=8,DT(f,E,v,C)}finally{Je.p=B,Me.T=P}}function DT(f,E,v,C){if(WR){var P=ym(C);if(P===null)CT(f,E,C,bg,v),HR(f,C);else if($I(P,f,E,v,C))C.stopPropagation();else if(HR(f,C),E&4&&-1<cs.indexOf(f)){for(;P!==null;){var B=Wu(P);if(B!==null)switch(B.tag){case 3:if(B=B.stateNode,B.current.memoizedState.isDehydrated){var ce=hn(B.pendingLanes);if(ce!==0){var Ee=B;for(Ee.pendingLanes|=2,Ee.entangledLanes|=2;ce;){var Fe=1<<31-rn(ce);Ee.entanglements[1]|=Fe,ce&=~Fe}ll(B),(Or&6)===0&&(i_=yi()+500,ST(0))}}break;case 13:Ee=VE(B,2),Ee!==null&&kc(Ee,B,2),ah(),QI(B,2)}if(B=ym(C),B===null&&CT(f,E,C,bg,v),B===P)break;P=B}P!==null&&C.stopPropagation()}else CT(f,E,C,null,v)}}function ym(f){return f=cd(f),De(f)}var bg=null;function De(f){if(bg=null,f=bf(f),f!==null){var E=y(f);if(E===null)f=null;else{var v=E.tag;if(v===13){if(f=b(E),f!==null)return f;f=null}else if(v===3){if(E.stateNode.current.memoizedState.isDehydrated)return E.tag===3?E.stateNode.containerInfo:null;f=null}else E!==f&&(f=null)}}return bg=f,null}function ZN(f){switch(f){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(vn()){case xn:return 2;case ir:return 8;case Bi:case Sn:return 32;case Us:return 268435456;default:return 32}default:return 32}}var ZI=!1,c_=null,l_=null,d_=null,kp=new Map,PT=new Map,u_=[],cs="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function HR(f,E){switch(f){case"focusin":case"focusout":c_=null;break;case"dragenter":case"dragleave":l_=null;break;case"mouseover":case"mouseout":d_=null;break;case"pointerover":case"pointerout":kp.delete(E.pointerId);break;case"gotpointercapture":case"lostpointercapture":PT.delete(E.pointerId)}}function kT(f,E,v,C,P,B){return f===null||f.nativeEvent!==B?(f={blockedOn:E,domEventName:v,eventSystemFlags:C,nativeEvent:B,targetContainers:[P]},E!==null&&(E=Wu(E),E!==null&&QN(E)),f):(f.eventSystemFlags|=C,E=f.targetContainers,P!==null&&E.indexOf(P)===-1&&E.push(P),f)}function $I(f,E,v,C,P){switch(E){case"focusin":return c_=kT(c_,f,E,v,C,P),!0;case"dragenter":return l_=kT(l_,f,E,v,C,P),!0;case"mouseover":return d_=kT(d_,f,E,v,C,P),!0;case"pointerover":var B=P.pointerId;return kp.set(B,kT(kp.get(B)||null,f,E,v,C,P)),!0;case"gotpointercapture":return B=P.pointerId,PT.set(B,kT(PT.get(B)||null,f,E,v,C,P)),!0}return!1}function $N(f){var E=bf(f.target);if(E!==null){var v=y(E);if(v!==null){if(E=v.tag,E===13){if(E=b(v),E!==null){f.blockedOn=E,gy(f.priority,function(){if(v.tag===13){var C=Gl();C=Ts(C);var P=VE(v,C);P!==null&&kc(P,v,C),QI(v,C)}});return}}else if(E===3&&v.stateNode.current.memoizedState.isDehydrated){f.blockedOn=v.tag===3?v.stateNode.containerInfo:null;return}}}f.blockedOn=null}function h_(f){if(f.blockedOn!==null)return!1;for(var E=f.targetContainers;0<E.length;){var v=ym(f.nativeEvent);if(v===null){v=f.nativeEvent;var C=new v.constructor(v.type,v);Qh=C,v.target.dispatchEvent(C),Qh=null}else return E=Wu(v),E!==null&&QN(E),f.blockedOn=v,!1;E.shift()}return!0}function KR(f,E,v){h_(f)&&v.delete(E)}function eA(){ZI=!1,c_!==null&&h_(c_)&&(c_=null),l_!==null&&h_(l_)&&(l_=null),d_!==null&&h_(d_)&&(d_=null),kp.forEach(KR),PT.forEach(KR)}function zR(f,E){f.blockedOn===E&&(f.blockedOn=null,ZI||(ZI=!0,l.unstable_scheduleCallback(l.unstable_NormalPriority,eA)))}var YR=null;function qR(f){YR!==f&&(YR=f,l.unstable_scheduleCallback(l.unstable_NormalPriority,function(){YR===f&&(YR=null);for(var E=0;E<f.length;E+=3){var v=f[E],C=f[E+1],P=f[E+2];if(typeof C!="function"){if(De(C||v)===null)continue;break}var B=Wu(v);B!==null&&(f.splice(E,3),E-=3,Tp(B,{pending:!0,data:P,method:v.method,action:C},C,P))}}))}function LT(f){function E(Fe){return zR(Fe,f)}c_!==null&&zR(c_,f),l_!==null&&zR(l_,f),d_!==null&&zR(d_,f),kp.forEach(E),PT.forEach(E);for(var v=0;v<u_.length;v++){var C=u_[v];C.blockedOn===f&&(C.blockedOn=null)}for(;0<u_.length&&(v=u_[0],v.blockedOn===null);)$N(v),v.blockedOn===null&&u_.shift();if(v=(f.ownerDocument||f).$$reactFormReplay,v!=null)for(C=0;C<v.length;C+=3){var P=v[C],B=v[C+1],ce=P[oa]||null;if(typeof B=="function")ce||qR(v);else if(ce){var Ee=null;if(B&&B.hasAttribute("formAction")){if(P=B,ce=B[oa]||null)Ee=ce.formAction;else if(De(P)!==null)continue}else Ee=ce.action;typeof Ee=="function"?v[C+1]=Ee:(v.splice(C,3),C-=3),qR(v)}}}function tA(f){this._internalRoot=f}Ig.prototype.render=tA.prototype.render=function(f){var E=this._internalRoot;if(E===null)throw Error(_(409));var v=E.current,C=Gl();GR(v,C,f,E,null,null)},Ig.prototype.unmount=tA.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var E=f.containerInfo;GR(f.current,2,null,f,null,null),ah(),E[ka]=null}};function Ig(f){this._internalRoot=f}Ig.prototype.unstable_scheduleHydration=function(f){if(f){var E=Cf();f={blockedOn:null,target:f,priority:E};for(var v=0;v<u_.length&&E!==0&&E<u_[v].priority;v++);u_.splice(v,0,f),v===0&&$N(f)}};var eD=a.version;if(eD!=="19.1.1")throw Error(_(527,eD,"19.1.1"));Je.findDOMNode=function(f){var E=f._reactInternals;if(E===void 0)throw typeof f.render=="function"?Error(_(188)):(f=Object.keys(f).join(","),Error(_(268,f)));return f=U(E),f=f!==null?x(f):null,f=f===null?null:f.stateNode,f};var r1={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:Me,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ag=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ag.isDisabled&&Ag.supportsFiber)try{wt=Ag.inject(r1),Ot=Ag}catch{}}return yj.createRoot=function(f,E){if(!S(f))throw Error(_(299));var v=!1,C="",P=aN,B=cN,ce=lN,Ee=null;return E!=null&&(E.unstable_strictMode===!0&&(v=!0),E.identifierPrefix!==void 0&&(C=E.identifierPrefix),E.onUncaughtError!==void 0&&(P=E.onUncaughtError),E.onCaughtError!==void 0&&(B=E.onCaughtError),E.onRecoverableError!==void 0&&(ce=E.onRecoverableError),E.unstable_transitionCallbacks!==void 0&&(Ee=E.unstable_transitionCallbacks)),E=XN(f,1,!1,null,null,v,C,P,B,ce,Ee,null),f[ka]=E.current,RT(f),new tA(E)},yj.hydrateRoot=function(f,E,v){if(!S(f))throw Error(_(299));var C=!1,P="",B=aN,ce=cN,Ee=lN,Fe=null,Ze=null;return v!=null&&(v.unstable_strictMode===!0&&(C=!0),v.identifierPrefix!==void 0&&(P=v.identifierPrefix),v.onUncaughtError!==void 0&&(B=v.onUncaughtError),v.onCaughtError!==void 0&&(ce=v.onCaughtError),v.onRecoverableError!==void 0&&(Ee=v.onRecoverableError),v.unstable_transitionCallbacks!==void 0&&(Fe=v.unstable_transitionCallbacks),v.formState!==void 0&&(Ze=v.formState)),E=XN(f,1,!0,E,v??null,C,P,B,ce,Ee,Fe,Ze),E.context=jR(null),v=E.current,C=Gl(),C=Ts(C),P=xf(C),P.callback=null,$u(v,P,C),v=C,E.current.lanes=v,Xr(E,v),ll(E),f[ka]=E.current,RT(f),new Ig(E)},yj.version="19.1.1",yj}var xJ;function Kie(){if(xJ)return cq.exports;xJ=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(a){console.error(a)}}return l(),cq.exports=Hie(),cq.exports}var zie=Kie();/**
 * react-router v7.9.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var VJ="popstate";function Yie(l={}){function a(_,S){let{pathname:y,search:b,hash:D}=_.location;return Hq("",{pathname:y,search:b,hash:D},S.state&&S.state.usr||null,S.state&&S.state.key||"default")}function h(_,S){return typeof S=="string"?S:Zj(S)}return Xie(a,h,null,l)}function Pa(l,a){if(l===!1||l===null||typeof l>"u")throw new Error(a)}function OS(l,a){if(!l){typeof console<"u"&&console.warn(a);try{throw new Error(a)}catch{}}}function qie(){return Math.random().toString(36).substring(2,10)}function FJ(l,a){return{usr:l.state,key:l.key,idx:a}}function Hq(l,a,h=null,_){return{pathname:typeof l=="string"?l:l.pathname,search:"",hash:"",...typeof a=="string"?Jk(a):a,state:h,key:a&&a.key||_||qie()}}function Zj({pathname:l="/",search:a="",hash:h=""}){return a&&a!=="?"&&(l+=a.charAt(0)==="?"?a:"?"+a),h&&h!=="#"&&(l+=h.charAt(0)==="#"?h:"#"+h),l}function Jk(l){let a={};if(l){let h=l.indexOf("#");h>=0&&(a.hash=l.substring(h),l=l.substring(0,h));let _=l.indexOf("?");_>=0&&(a.search=l.substring(_),l=l.substring(0,_)),l&&(a.pathname=l)}return a}function Xie(l,a,h,_={}){let{window:S=document.defaultView,v5Compat:y=!1}=_,b=S.history,D="POP",U=null,x=q();x==null&&(x=0,b.replaceState({...b.state,idx:x},""));function q(){return(b.state||{idx:null}).idx}function J(){D="POP";let pe=q(),Ne=pe==null?null:pe-x;x=pe,U&&U({action:D,location:le.location,delta:Ne})}function ee(pe,Ne){D="PUSH";let Ve=Hq(le.location,pe,Ne);x=q()+1;let Ae=FJ(Ve,x),Ue=le.createHref(Ve);try{b.pushState(Ae,"",Ue)}catch(ke){if(ke instanceof DOMException&&ke.name==="DataCloneError")throw ke;S.location.assign(Ue)}y&&U&&U({action:D,location:le.location,delta:1})}function ue(pe,Ne){D="REPLACE";let Ve=Hq(le.location,pe,Ne);x=q();let Ae=FJ(Ve,x),Ue=le.createHref(Ve);b.replaceState(Ae,"",Ue),y&&U&&U({action:D,location:le.location,delta:0})}function oe(pe){return Jie(pe)}let le={get action(){return D},get location(){return l(S,b)},listen(pe){if(U)throw new Error("A history only accepts one active listener");return S.addEventListener(VJ,J),U=pe,()=>{S.removeEventListener(VJ,J),U=null}},createHref(pe){return a(S,pe)},createURL:oe,encodeLocation(pe){let Ne=oe(pe);return{pathname:Ne.pathname,search:Ne.search,hash:Ne.hash}},push:ee,replace:ue,go(pe){return b.go(pe)}};return le}function Jie(l,a=!1){let h="http://localhost";typeof window<"u"&&(h=window.location.origin!=="null"?window.location.origin:window.location.href),Pa(h,"No window.location.(origin|href) available to create URL");let _=typeof l=="string"?l:Zj(l);return _=_.replace(/ $/,"%20"),!a&&_.startsWith("//")&&(_=h+_),new URL(_,h)}function O$(l,a,h="/"){return Qie(l,a,h,!1)}function Qie(l,a,h,_){let S=typeof a=="string"?Jk(a):a,y=oy(S.pathname||"/",h);if(y==null)return null;let b=N$(l);Zie(b);let D=null;for(let U=0;D==null&&U<b.length;++U){let x=lre(y);D=are(b[U],x,_)}return D}function N$(l,a=[],h=[],_="",S=!1){let y=(b,D,U=S,x)=>{let q={relativePath:x===void 0?b.path||"":x,caseSensitive:b.caseSensitive===!0,childrenIndex:D,route:b};if(q.relativePath.startsWith("/")){if(!q.relativePath.startsWith(_)&&U)return;Pa(q.relativePath.startsWith(_),`Absolute route path "${q.relativePath}" nested under path "${_}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),q.relativePath=q.relativePath.slice(_.length)}let J=ry([_,q.relativePath]),ee=h.concat(q);b.children&&b.children.length>0&&(Pa(b.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${J}".`),N$(b.children,a,ee,J,U)),!(b.path==null&&!b.index)&&a.push({path:J,score:sre(J,b.index),routesMeta:ee})};return l.forEach((b,D)=>{if(b.path===""||!b.path?.includes("?"))y(b,D);else for(let U of D$(b.path))y(b,D,!0,U)}),a}function D$(l){let a=l.split("/");if(a.length===0)return[];let[h,..._]=a,S=h.endsWith("?"),y=h.replace(/\?$/,"");if(_.length===0)return S?[y,""]:[y];let b=D$(_.join("/")),D=[];return D.push(...b.map(U=>U===""?y:[y,U].join("/"))),S&&D.push(...b),D.map(U=>l.startsWith("/")&&U===""?"/":U)}function Zie(l){l.sort((a,h)=>a.score!==h.score?h.score-a.score:ore(a.routesMeta.map(_=>_.childrenIndex),h.routesMeta.map(_=>_.childrenIndex)))}var $ie=/^:[\w-]+$/,ere=3,tre=2,nre=1,ire=10,rre=-2,BJ=l=>l==="*";function sre(l,a){let h=l.split("/"),_=h.length;return h.some(BJ)&&(_+=rre),a&&(_+=tre),h.filter(S=>!BJ(S)).reduce((S,y)=>S+($ie.test(y)?ere:y===""?nre:ire),_)}function ore(l,a){return l.length===a.length&&l.slice(0,-1).every((_,S)=>_===a[S])?l[l.length-1]-a[a.length-1]:0}function are(l,a,h=!1){let{routesMeta:_}=l,S={},y="/",b=[];for(let D=0;D<_.length;++D){let U=_[D],x=D===_.length-1,q=y==="/"?a:a.slice(y.length)||"/",J=_G({path:U.relativePath,caseSensitive:U.caseSensitive,end:x},q),ee=U.route;if(!J&&x&&h&&!_[_.length-1].route.index&&(J=_G({path:U.relativePath,caseSensitive:U.caseSensitive,end:!1},q)),!J)return null;Object.assign(S,J.params),b.push({params:S,pathname:ry([y,J.pathname]),pathnameBase:pre(ry([y,J.pathnameBase])),route:ee}),J.pathnameBase!=="/"&&(y=ry([y,J.pathnameBase]))}return b}function _G(l,a){typeof l=="string"&&(l={path:l,caseSensitive:!1,end:!0});let[h,_]=cre(l.path,l.caseSensitive,l.end),S=a.match(h);if(!S)return null;let y=S[0],b=y.replace(/(.)\/+$/,"$1"),D=S.slice(1);return{params:_.reduce((x,{paramName:q,isOptional:J},ee)=>{if(q==="*"){let oe=D[ee]||"";b=y.slice(0,y.length-oe.length).replace(/(.)\/+$/,"$1")}const ue=D[ee];return J&&!ue?x[q]=void 0:x[q]=(ue||"").replace(/%2F/g,"/"),x},{}),pathname:y,pathnameBase:b,pattern:l}}function cre(l,a=!1,h=!0){OS(l==="*"||!l.endsWith("*")||l.endsWith("/*"),`Route path "${l}" will be treated as if it were "${l.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${l.replace(/\*$/,"/*")}".`);let _=[],S="^"+l.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(b,D,U)=>(_.push({paramName:D,isOptional:U!=null}),U?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return l.endsWith("*")?(_.push({paramName:"*"}),S+=l==="*"||l==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):h?S+="\\/*$":l!==""&&l!=="/"&&(S+="(?:(?=\\/|$))"),[new RegExp(S,a?void 0:"i"),_]}function lre(l){try{return l.split("/").map(a=>decodeURIComponent(a).replace(/\//g,"%2F")).join("/")}catch(a){return OS(!1,`The URL path "${l}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${a}).`),l}}function oy(l,a){if(a==="/")return l;if(!l.toLowerCase().startsWith(a.toLowerCase()))return null;let h=a.endsWith("/")?a.length-1:a.length,_=l.charAt(h);return _&&_!=="/"?null:l.slice(h)||"/"}function dre(l,a="/"){let{pathname:h,search:_="",hash:S=""}=typeof l=="string"?Jk(l):l;return{pathname:h?h.startsWith("/")?h:ure(h,a):a,search:fre(_),hash:_re(S)}}function ure(l,a){let h=a.replace(/\/+$/,"").split("/");return l.split("/").forEach(S=>{S===".."?h.length>1&&h.pop():S!=="."&&h.push(S)}),h.length>1?h.join("/"):"/"}function hq(l,a,h,_){return`Cannot include a '${l}' character in a manually specified \`to.${a}\` field [${JSON.stringify(_)}].  Please separate it out to the \`to.${h}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function hre(l){return l.filter((a,h)=>h===0||a.route.path&&a.route.path.length>0)}function P$(l){let a=hre(l);return a.map((h,_)=>_===a.length-1?h.pathname:h.pathnameBase)}function k$(l,a,h,_=!1){let S;typeof l=="string"?S=Jk(l):(S={...l},Pa(!S.pathname||!S.pathname.includes("?"),hq("?","pathname","search",S)),Pa(!S.pathname||!S.pathname.includes("#"),hq("#","pathname","hash",S)),Pa(!S.search||!S.search.includes("#"),hq("#","search","hash",S)));let y=l===""||S.pathname==="",b=y?"/":S.pathname,D;if(b==null)D=h;else{let J=a.length-1;if(!_&&b.startsWith("..")){let ee=b.split("/");for(;ee[0]==="..";)ee.shift(),J-=1;S.pathname=ee.join("/")}D=J>=0?a[J]:"/"}let U=dre(S,D),x=b&&b!=="/"&&b.endsWith("/"),q=(y||b===".")&&h.endsWith("/");return!U.pathname.endsWith("/")&&(x||q)&&(U.pathname+="/"),U}var ry=l=>l.join("/").replace(/\/\/+/g,"/"),pre=l=>l.replace(/\/+$/,"").replace(/^\/*/,"/"),fre=l=>!l||l==="?"?"":l.startsWith("?")?l:"?"+l,_re=l=>!l||l==="#"?"":l.startsWith("#")?l:"#"+l;function mre(l){return l!=null&&typeof l.status=="number"&&typeof l.statusText=="string"&&typeof l.internal=="boolean"&&"data"in l}var L$=["POST","PUT","PATCH","DELETE"];new Set(L$);var Ere=["GET",...L$];new Set(Ere);var Qk=ae.createContext(null);Qk.displayName="DataRouter";var JG=ae.createContext(null);JG.displayName="DataRouterState";ae.createContext(!1);var M$=ae.createContext({isTransitioning:!1});M$.displayName="ViewTransition";var gre=ae.createContext(new Map);gre.displayName="Fetchers";var Sre=ae.createContext(null);Sre.displayName="Await";var DS=ae.createContext(null);DS.displayName="Navigation";var E3=ae.createContext(null);E3.displayName="Location";var _y=ae.createContext({outlet:null,matches:[],isDataRoute:!1});_y.displayName="Route";var U7=ae.createContext(null);U7.displayName="RouteError";function Tre(l,{relative:a}={}){Pa(g3(),"useHref() may be used only in the context of a <Router> component.");let{basename:h,navigator:_}=ae.useContext(DS),{hash:S,pathname:y,search:b}=S3(l,{relative:a}),D=y;return h!=="/"&&(D=y==="/"?h:ry([h,y])),_.createHref({pathname:D,search:b,hash:S})}function g3(){return ae.useContext(E3)!=null}function cO(){return Pa(g3(),"useLocation() may be used only in the context of a <Router> component."),ae.useContext(E3).location}var U$="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function x$(l){ae.useContext(DS).static||ae.useLayoutEffect(l)}function vre(){let{isDataRoute:l}=ae.useContext(_y);return l?Lre():yre()}function yre(){Pa(g3(),"useNavigate() may be used only in the context of a <Router> component.");let l=ae.useContext(Qk),{basename:a,navigator:h}=ae.useContext(DS),{matches:_}=ae.useContext(_y),{pathname:S}=cO(),y=JSON.stringify(P$(_)),b=ae.useRef(!1);return x$(()=>{b.current=!0}),ae.useCallback((U,x={})=>{if(OS(b.current,U$),!b.current)return;if(typeof U=="number"){h.go(U);return}let q=k$(U,JSON.parse(y),S,x.relative==="path");l==null&&a!=="/"&&(q.pathname=q.pathname==="/"?a:ry([a,q.pathname])),(x.replace?h.replace:h.push)(q,x.state,x)},[a,h,y,S,l])}ae.createContext(null);function S3(l,{relative:a}={}){let{matches:h}=ae.useContext(_y),{pathname:_}=cO(),S=JSON.stringify(P$(h));return ae.useMemo(()=>k$(l,JSON.parse(S),_,a==="path"),[l,S,_,a])}function Rre(l,a){return V$(l,a)}function V$(l,a,h,_,S){Pa(g3(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:y}=ae.useContext(DS),{matches:b}=ae.useContext(_y),D=b[b.length-1],U=D?D.params:{},x=D?D.pathname:"/",q=D?D.pathnameBase:"/",J=D&&D.route;{let Ve=J&&J.path||"";F$(x,!J||Ve.endsWith("*")||Ve.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${x}" (under <Route path="${Ve}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${Ve}"> to <Route path="${Ve==="/"?"*":`${Ve}/*`}">.`)}let ee=cO(),ue;if(a){let Ve=typeof a=="string"?Jk(a):a;Pa(q==="/"||Ve.pathname?.startsWith(q),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${q}" but pathname "${Ve.pathname}" was given in the \`location\` prop.`),ue=Ve}else ue=ee;let oe=ue.pathname||"/",le=oe;if(q!=="/"){let Ve=q.replace(/^\//,"").split("/");le="/"+oe.replace(/^\//,"").split("/").slice(Ve.length).join("/")}let pe=O$(l,{pathname:le});OS(J||pe!=null,`No routes matched location "${ue.pathname}${ue.search}${ue.hash}" `),OS(pe==null||pe[pe.length-1].route.element!==void 0||pe[pe.length-1].route.Component!==void 0||pe[pe.length-1].route.lazy!==void 0,`Matched leaf route at location "${ue.pathname}${ue.search}${ue.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let Ne=wre(pe&&pe.map(Ve=>Object.assign({},Ve,{params:Object.assign({},U,Ve.params),pathname:ry([q,y.encodeLocation?y.encodeLocation(Ve.pathname).pathname:Ve.pathname]),pathnameBase:Ve.pathnameBase==="/"?q:ry([q,y.encodeLocation?y.encodeLocation(Ve.pathnameBase).pathname:Ve.pathnameBase])})),b,h,_,S);return a&&Ne?ae.createElement(E3.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...ue},navigationType:"POP"}},Ne):Ne}function Cre(){let l=kre(),a=mre(l)?`${l.status} ${l.statusText}`:l instanceof Error?l.message:JSON.stringify(l),h=l instanceof Error?l.stack:null,_="rgba(200,200,200, 0.5)",S={padding:"0.5rem",backgroundColor:_},y={padding:"2px 4px",backgroundColor:_},b=null;return console.error("Error handled by React Router default ErrorBoundary:",l),b=ae.createElement(ae.Fragment,null,ae.createElement("p",null,"💿 Hey developer 👋"),ae.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",ae.createElement("code",{style:y},"ErrorBoundary")," or"," ",ae.createElement("code",{style:y},"errorElement")," prop on your route.")),ae.createElement(ae.Fragment,null,ae.createElement("h2",null,"Unexpected Application Error!"),ae.createElement("h3",{style:{fontStyle:"italic"}},a),h?ae.createElement("pre",{style:S},h):null,b)}var bre=ae.createElement(Cre,null),Ire=class extends ae.Component{constructor(l){super(l),this.state={location:l.location,revalidation:l.revalidation,error:l.error}}static getDerivedStateFromError(l){return{error:l}}static getDerivedStateFromProps(l,a){return a.location!==l.location||a.revalidation!=="idle"&&l.revalidation==="idle"?{error:l.error,location:l.location,revalidation:l.revalidation}:{error:l.error!==void 0?l.error:a.error,location:a.location,revalidation:l.revalidation||a.revalidation}}componentDidCatch(l,a){this.props.unstable_onError?this.props.unstable_onError(l,a):console.error("React Router caught the following error during render",l)}render(){return this.state.error!==void 0?ae.createElement(_y.Provider,{value:this.props.routeContext},ae.createElement(U7.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function Are({routeContext:l,match:a,children:h}){let _=ae.useContext(Qk);return _&&_.static&&_.staticContext&&(a.route.errorElement||a.route.ErrorBoundary)&&(_.staticContext._deepestRenderedBoundaryId=a.route.id),ae.createElement(_y.Provider,{value:l},h)}function wre(l,a=[],h=null,_=null,S=null){if(l==null){if(!h)return null;if(h.errors)l=h.matches;else if(a.length===0&&!h.initialized&&h.matches.length>0)l=h.matches;else return null}let y=l,b=h?.errors;if(b!=null){let x=y.findIndex(q=>q.route.id&&b?.[q.route.id]!==void 0);Pa(x>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(b).join(",")}`),y=y.slice(0,Math.min(y.length,x+1))}let D=!1,U=-1;if(h)for(let x=0;x<y.length;x++){let q=y[x];if((q.route.HydrateFallback||q.route.hydrateFallbackElement)&&(U=x),q.route.id){let{loaderData:J,errors:ee}=h,ue=q.route.loader&&!J.hasOwnProperty(q.route.id)&&(!ee||ee[q.route.id]===void 0);if(q.route.lazy||ue){D=!0,U>=0?y=y.slice(0,U+1):y=[y[0]];break}}}return y.reduceRight((x,q,J)=>{let ee,ue=!1,oe=null,le=null;h&&(ee=b&&q.route.id?b[q.route.id]:void 0,oe=q.route.errorElement||bre,D&&(U<0&&J===0?(F$("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),ue=!0,le=null):U===J&&(ue=!0,le=q.route.hydrateFallbackElement||null)));let pe=a.concat(y.slice(0,J+1)),Ne=()=>{let Ve;return ee?Ve=oe:ue?Ve=le:q.route.Component?Ve=ae.createElement(q.route.Component,null):q.route.element?Ve=q.route.element:Ve=x,ae.createElement(Are,{match:q,routeContext:{outlet:x,matches:pe,isDataRoute:h!=null},children:Ve})};return h&&(q.route.ErrorBoundary||q.route.errorElement||J===0)?ae.createElement(Ire,{location:h.location,revalidation:h.revalidation,component:oe,error:ee,children:Ne(),routeContext:{outlet:null,matches:pe,isDataRoute:!0},unstable_onError:_}):Ne()},null)}function x7(l){return`${l} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Ore(l){let a=ae.useContext(Qk);return Pa(a,x7(l)),a}function Nre(l){let a=ae.useContext(JG);return Pa(a,x7(l)),a}function Dre(l){let a=ae.useContext(_y);return Pa(a,x7(l)),a}function V7(l){let a=Dre(l),h=a.matches[a.matches.length-1];return Pa(h.route.id,`${l} can only be used on routes that contain a unique "id"`),h.route.id}function Pre(){return V7("useRouteId")}function kre(){let l=ae.useContext(U7),a=Nre("useRouteError"),h=V7("useRouteError");return l!==void 0?l:a.errors?.[h]}function Lre(){let{router:l}=Ore("useNavigate"),a=V7("useNavigate"),h=ae.useRef(!1);return x$(()=>{h.current=!0}),ae.useCallback(async(S,y={})=>{OS(h.current,U$),h.current&&(typeof S=="number"?l.navigate(S):await l.navigate(S,{fromRouteId:a,...y}))},[l,a])}var jJ={};function F$(l,a,h){!a&&!jJ[l]&&(jJ[l]=!0,OS(!1,h))}ae.memo(Mre);function Mre({routes:l,future:a,state:h,unstable_onError:_}){return V$(l,void 0,h,_,a)}function Kq(l){Pa(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Ure({basename:l="/",children:a=null,location:h,navigationType:_="POP",navigator:S,static:y=!1}){Pa(!g3(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let b=l.replace(/^\/*/,"/"),D=ae.useMemo(()=>({basename:b,navigator:S,static:y,future:{}}),[b,S,y]);typeof h=="string"&&(h=Jk(h));let{pathname:U="/",search:x="",hash:q="",state:J=null,key:ee="default"}=h,ue=ae.useMemo(()=>{let oe=oy(U,b);return oe==null?null:{location:{pathname:oe,search:x,hash:q,state:J,key:ee},navigationType:_}},[b,U,x,q,J,ee,_]);return OS(ue!=null,`<Router basename="${b}"> is not able to match the URL "${U}${x}${q}" because it does not start with the basename, so the <Router> won't render anything.`),ue==null?null:ae.createElement(DS.Provider,{value:D},ae.createElement(E3.Provider,{children:a,value:ue}))}function xre({children:l,location:a}){return Rre(zq(l),a)}function zq(l,a=[]){let h=[];return ae.Children.forEach(l,(_,S)=>{if(!ae.isValidElement(_))return;let y=[...a,S];if(_.type===ae.Fragment){h.push.apply(h,zq(_.props.children,y));return}Pa(_.type===Kq,`[${typeof _.type=="string"?_.type:_.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Pa(!_.props.index||!_.props.children,"An index route cannot have child routes.");let b={id:_.props.id||y.join("-"),caseSensitive:_.props.caseSensitive,element:_.props.element,Component:_.props.Component,index:_.props.index,path:_.props.path,loader:_.props.loader,action:_.props.action,hydrateFallbackElement:_.props.hydrateFallbackElement,HydrateFallback:_.props.HydrateFallback,errorElement:_.props.errorElement,ErrorBoundary:_.props.ErrorBoundary,hasErrorBoundary:_.props.hasErrorBoundary===!0||_.props.ErrorBoundary!=null||_.props.errorElement!=null,shouldRevalidate:_.props.shouldRevalidate,handle:_.props.handle,lazy:_.props.lazy};_.props.children&&(b.children=zq(_.props.children,y)),h.push(b)}),h}var tG="get",nG="application/x-www-form-urlencoded";function QG(l){return l!=null&&typeof l.tagName=="string"}function Vre(l){return QG(l)&&l.tagName.toLowerCase()==="button"}function Fre(l){return QG(l)&&l.tagName.toLowerCase()==="form"}function Bre(l){return QG(l)&&l.tagName.toLowerCase()==="input"}function jre(l){return!!(l.metaKey||l.altKey||l.ctrlKey||l.shiftKey)}function Gre(l,a){return l.button===0&&(!a||a==="_self")&&!jre(l)}var V6=null;function Wre(){if(V6===null)try{new FormData(document.createElement("form"),0),V6=!1}catch{V6=!0}return V6}var Hre=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function pq(l){return l!=null&&!Hre.has(l)?(OS(!1,`"${l}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${nG}"`),null):l}function Kre(l,a){let h,_,S,y,b;if(Fre(l)){let D=l.getAttribute("action");_=D?oy(D,a):null,h=l.getAttribute("method")||tG,S=pq(l.getAttribute("enctype"))||nG,y=new FormData(l)}else if(Vre(l)||Bre(l)&&(l.type==="submit"||l.type==="image")){let D=l.form;if(D==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let U=l.getAttribute("formaction")||D.getAttribute("action");if(_=U?oy(U,a):null,h=l.getAttribute("formmethod")||D.getAttribute("method")||tG,S=pq(l.getAttribute("formenctype"))||pq(D.getAttribute("enctype"))||nG,y=new FormData(D,l),!Wre()){let{name:x,type:q,value:J}=l;if(q==="image"){let ee=x?`${x}.`:"";y.append(`${ee}x`,"0"),y.append(`${ee}y`,"0")}else x&&y.append(x,J)}}else{if(QG(l))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');h=tG,_=null,S=nG,b=l}return y&&S==="text/plain"&&(b=y,y=void 0),{action:_,method:h.toLowerCase(),encType:S,formData:y,body:b}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function F7(l,a){if(l===!1||l===null||typeof l>"u")throw new Error(a)}function zre(l,a,h){let _=typeof l=="string"?new URL(l,typeof window>"u"?"server://singlefetch/":window.location.origin):l;return _.pathname==="/"?_.pathname=`_root.${h}`:a&&oy(_.pathname,a)==="/"?_.pathname=`${a.replace(/\/$/,"")}/_root.${h}`:_.pathname=`${_.pathname.replace(/\/$/,"")}.${h}`,_}async function Yre(l,a){if(l.id in a)return a[l.id];try{let h=await import(l.module);return a[l.id]=h,h}catch(h){return console.error(`Error loading route module \`${l.module}\`, reloading page...`),console.error(h),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function qre(l){return l==null?!1:l.href==null?l.rel==="preload"&&typeof l.imageSrcSet=="string"&&typeof l.imageSizes=="string":typeof l.rel=="string"&&typeof l.href=="string"}async function Xre(l,a,h){let _=await Promise.all(l.map(async S=>{let y=a.routes[S.route.id];if(y){let b=await Yre(y,h);return b.links?b.links():[]}return[]}));return $re(_.flat(1).filter(qre).filter(S=>S.rel==="stylesheet"||S.rel==="preload").map(S=>S.rel==="stylesheet"?{...S,rel:"prefetch",as:"style"}:{...S,rel:"prefetch"}))}function GJ(l,a,h,_,S,y){let b=(U,x)=>h[x]?U.route.id!==h[x].route.id:!0,D=(U,x)=>h[x].pathname!==U.pathname||h[x].route.path?.endsWith("*")&&h[x].params["*"]!==U.params["*"];return y==="assets"?a.filter((U,x)=>b(U,x)||D(U,x)):y==="data"?a.filter((U,x)=>{let q=_.routes[U.route.id];if(!q||!q.hasLoader)return!1;if(b(U,x)||D(U,x))return!0;if(U.route.shouldRevalidate){let J=U.route.shouldRevalidate({currentUrl:new URL(S.pathname+S.search+S.hash,window.origin),currentParams:h[0]?.params||{},nextUrl:new URL(l,window.origin),nextParams:U.params,defaultShouldRevalidate:!0});if(typeof J=="boolean")return J}return!0}):[]}function Jre(l,a,{includeHydrateFallback:h}={}){return Qre(l.map(_=>{let S=a.routes[_.route.id];if(!S)return[];let y=[S.module];return S.clientActionModule&&(y=y.concat(S.clientActionModule)),S.clientLoaderModule&&(y=y.concat(S.clientLoaderModule)),h&&S.hydrateFallbackModule&&(y=y.concat(S.hydrateFallbackModule)),S.imports&&(y=y.concat(S.imports)),y}).flat(1))}function Qre(l){return[...new Set(l)]}function Zre(l){let a={},h=Object.keys(l).sort();for(let _ of h)a[_]=l[_];return a}function $re(l,a){let h=new Set;return new Set(a),l.reduce((_,S)=>{let y=JSON.stringify(Zre(S));return h.has(y)||(h.add(y),_.push({key:y,link:S})),_},[])}function B$(){let l=ae.useContext(Qk);return F7(l,"You must render this element inside a <DataRouterContext.Provider> element"),l}function ese(){let l=ae.useContext(JG);return F7(l,"You must render this element inside a <DataRouterStateContext.Provider> element"),l}var B7=ae.createContext(void 0);B7.displayName="FrameworkContext";function j$(){let l=ae.useContext(B7);return F7(l,"You must render this element inside a <HydratedRouter> element"),l}function tse(l,a){let h=ae.useContext(B7),[_,S]=ae.useState(!1),[y,b]=ae.useState(!1),{onFocus:D,onBlur:U,onMouseEnter:x,onMouseLeave:q,onTouchStart:J}=a,ee=ae.useRef(null);ae.useEffect(()=>{if(l==="render"&&b(!0),l==="viewport"){let le=Ne=>{Ne.forEach(Ve=>{b(Ve.isIntersecting)})},pe=new IntersectionObserver(le,{threshold:.5});return ee.current&&pe.observe(ee.current),()=>{pe.disconnect()}}},[l]),ae.useEffect(()=>{if(_){let le=setTimeout(()=>{b(!0)},100);return()=>{clearTimeout(le)}}},[_]);let ue=()=>{S(!0)},oe=()=>{S(!1),b(!1)};return h?l!=="intent"?[y,ee,{}]:[y,ee,{onFocus:Rj(D,ue),onBlur:Rj(U,oe),onMouseEnter:Rj(x,ue),onMouseLeave:Rj(q,oe),onTouchStart:Rj(J,ue)}]:[!1,ee,{}]}function Rj(l,a){return h=>{l&&l(h),h.defaultPrevented||a(h)}}function nse({page:l,...a}){let{router:h}=B$(),_=ae.useMemo(()=>O$(h.routes,l,h.basename),[h.routes,l,h.basename]);return _?ae.createElement(rse,{page:l,matches:_,...a}):null}function ise(l){let{manifest:a,routeModules:h}=j$(),[_,S]=ae.useState([]);return ae.useEffect(()=>{let y=!1;return Xre(l,a,h).then(b=>{y||S(b)}),()=>{y=!0}},[l,a,h]),_}function rse({page:l,matches:a,...h}){let _=cO(),{manifest:S,routeModules:y}=j$(),{basename:b}=B$(),{loaderData:D,matches:U}=ese(),x=ae.useMemo(()=>GJ(l,a,U,S,_,"data"),[l,a,U,S,_]),q=ae.useMemo(()=>GJ(l,a,U,S,_,"assets"),[l,a,U,S,_]),J=ae.useMemo(()=>{if(l===_.pathname+_.search+_.hash)return[];let oe=new Set,le=!1;if(a.forEach(Ne=>{let Ve=S.routes[Ne.route.id];!Ve||!Ve.hasLoader||(!x.some(Ae=>Ae.route.id===Ne.route.id)&&Ne.route.id in D&&y[Ne.route.id]?.shouldRevalidate||Ve.hasClientLoader?le=!0:oe.add(Ne.route.id))}),oe.size===0)return[];let pe=zre(l,b,"data");return le&&oe.size>0&&pe.searchParams.set("_routes",a.filter(Ne=>oe.has(Ne.route.id)).map(Ne=>Ne.route.id).join(",")),[pe.pathname+pe.search]},[b,D,_,S,x,a,l,y]),ee=ae.useMemo(()=>Jre(q,S),[q,S]),ue=ise(q);return ae.createElement(ae.Fragment,null,J.map(oe=>ae.createElement("link",{key:oe,rel:"prefetch",as:"fetch",href:oe,...h})),ee.map(oe=>ae.createElement("link",{key:oe,rel:"modulepreload",href:oe,...h})),ue.map(({key:oe,link:le})=>ae.createElement("link",{key:oe,nonce:h.nonce,...le})))}function sse(...l){return a=>{l.forEach(h=>{typeof h=="function"?h(a):h!=null&&(h.current=a)})}}var G$=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{G$&&(window.__reactRouterVersion="7.9.1")}catch{}function ose({basename:l,children:a,window:h}){let _=ae.useRef();_.current==null&&(_.current=Yie({window:h,v5Compat:!0}));let S=_.current,[y,b]=ae.useState({action:S.action,location:S.location}),D=ae.useCallback(U=>{ae.startTransition(()=>b(U))},[b]);return ae.useLayoutEffect(()=>S.listen(D),[S,D]),ae.createElement(Ure,{basename:l,children:a,location:y.location,navigationType:y.action,navigator:S})}var W$=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,$j=ae.forwardRef(function({onClick:a,discover:h="render",prefetch:_="none",relative:S,reloadDocument:y,replace:b,state:D,target:U,to:x,preventScrollReset:q,viewTransition:J,...ee},ue){let{basename:oe}=ae.useContext(DS),le=typeof x=="string"&&W$.test(x),pe,Ne=!1;if(typeof x=="string"&&le&&(pe=x,G$))try{let _e=new URL(window.location.href),ye=x.startsWith("//")?new URL(_e.protocol+x):new URL(x),Ie=oy(ye.pathname,oe);ye.origin===_e.origin&&Ie!=null?x=Ie+ye.search+ye.hash:Ne=!0}catch{OS(!1,`<Link to="${x}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let Ve=Tre(x,{relative:S}),[Ae,Ue,ke]=tse(_,ee),qe=dse(x,{replace:b,state:D,target:U,preventScrollReset:q,relative:S,viewTransition:J});function Te(_e){a&&a(_e),_e.defaultPrevented||qe(_e)}let he=ae.createElement("a",{...ee,...ke,href:pe||Ve,onClick:Ne||y?a:Te,ref:sse(ue,Ue),target:U,"data-discover":!le&&h==="render"?"true":void 0});return Ae&&!le?ae.createElement(ae.Fragment,null,he,ae.createElement(nse,{page:Ve})):he});$j.displayName="Link";var ase=ae.forwardRef(function({"aria-current":a="page",caseSensitive:h=!1,className:_="",end:S=!1,style:y,to:b,viewTransition:D,children:U,...x},q){let J=S3(b,{relative:x.relative}),ee=cO(),ue=ae.useContext(JG),{navigator:oe,basename:le}=ae.useContext(DS),pe=ue!=null&&_se(J)&&D===!0,Ne=oe.encodeLocation?oe.encodeLocation(J).pathname:J.pathname,Ve=ee.pathname,Ae=ue&&ue.navigation&&ue.navigation.location?ue.navigation.location.pathname:null;h||(Ve=Ve.toLowerCase(),Ae=Ae?Ae.toLowerCase():null,Ne=Ne.toLowerCase()),Ae&&le&&(Ae=oy(Ae,le)||Ae);const Ue=Ne!=="/"&&Ne.endsWith("/")?Ne.length-1:Ne.length;let ke=Ve===Ne||!S&&Ve.startsWith(Ne)&&Ve.charAt(Ue)==="/",qe=Ae!=null&&(Ae===Ne||!S&&Ae.startsWith(Ne)&&Ae.charAt(Ne.length)==="/"),Te={isActive:ke,isPending:qe,isTransitioning:pe},he=ke?a:void 0,_e;typeof _=="function"?_e=_(Te):_e=[_,ke?"active":null,qe?"pending":null,pe?"transitioning":null].filter(Boolean).join(" ");let ye=typeof y=="function"?y(Te):y;return ae.createElement($j,{...x,"aria-current":he,className:_e,ref:q,style:ye,to:b,viewTransition:D},typeof U=="function"?U(Te):U)});ase.displayName="NavLink";var cse=ae.forwardRef(({discover:l="render",fetcherKey:a,navigate:h,reloadDocument:_,replace:S,state:y,method:b=tG,action:D,onSubmit:U,relative:x,preventScrollReset:q,viewTransition:J,...ee},ue)=>{let oe=pse(),le=fse(D,{relative:x}),pe=b.toLowerCase()==="get"?"get":"post",Ne=typeof D=="string"&&W$.test(D),Ve=Ae=>{if(U&&U(Ae),Ae.defaultPrevented)return;Ae.preventDefault();let Ue=Ae.nativeEvent.submitter,ke=Ue?.getAttribute("formmethod")||b;oe(Ue||Ae.currentTarget,{fetcherKey:a,method:ke,navigate:h,replace:S,state:y,relative:x,preventScrollReset:q,viewTransition:J})};return ae.createElement("form",{ref:ue,method:pe,action:le,onSubmit:_?U:Ve,...ee,"data-discover":!Ne&&l==="render"?"true":void 0})});cse.displayName="Form";function lse(l){return`${l} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function H$(l){let a=ae.useContext(Qk);return Pa(a,lse(l)),a}function dse(l,{target:a,replace:h,state:_,preventScrollReset:S,relative:y,viewTransition:b}={}){let D=vre(),U=cO(),x=S3(l,{relative:y});return ae.useCallback(q=>{if(Gre(q,a)){q.preventDefault();let J=h!==void 0?h:Zj(U)===Zj(x);D(l,{replace:J,state:_,preventScrollReset:S,relative:y,viewTransition:b})}},[U,D,x,h,_,a,l,S,y,b])}var use=0,hse=()=>`__${String(++use)}__`;function pse(){let{router:l}=H$("useSubmit"),{basename:a}=ae.useContext(DS),h=Pre();return ae.useCallback(async(_,S={})=>{let{action:y,method:b,encType:D,formData:U,body:x}=Kre(_,a);if(S.navigate===!1){let q=S.fetcherKey||hse();await l.fetch(q,h,S.action||y,{preventScrollReset:S.preventScrollReset,formData:U,body:x,formMethod:S.method||b,formEncType:S.encType||D,flushSync:S.flushSync})}else await l.navigate(S.action||y,{preventScrollReset:S.preventScrollReset,formData:U,body:x,formMethod:S.method||b,formEncType:S.encType||D,replace:S.replace,state:S.state,fromRouteId:h,flushSync:S.flushSync,viewTransition:S.viewTransition})},[l,a,h])}function fse(l,{relative:a}={}){let{basename:h}=ae.useContext(DS),_=ae.useContext(_y);Pa(_,"useFormAction must be used inside a RouteContext");let[S]=_.matches.slice(-1),y={...S3(l||".",{relative:a})},b=cO();if(l==null){y.search=b.search;let D=new URLSearchParams(y.search),U=D.getAll("index");if(U.some(q=>q==="")){D.delete("index"),U.filter(J=>J).forEach(J=>D.append("index",J));let q=D.toString();y.search=q?`?${q}`:""}}return(!l||l===".")&&S.route.index&&(y.search=y.search?y.search.replace(/^\?/,"?index&"):"?index"),h!=="/"&&(y.pathname=y.pathname==="/"?h:ry([h,y.pathname])),Zj(y)}function _se(l,{relative:a}={}){let h=ae.useContext(M$);Pa(h!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:_}=H$("useViewTransitionState"),S=S3(l,{relative:a});if(!h.isTransitioning)return!1;let y=oy(h.currentLocation.pathname,_)||h.currentLocation.pathname,b=oy(h.nextLocation.pathname,_)||h.nextLocation.pathname;return _G(S.pathname,b)!=null||_G(S.pathname,y)!=null}var K$=w$();const F6=L7(K$),e3={black:"#000",white:"#fff"},Sk={300:"#e57373",400:"#ef5350",500:"#f44336",700:"#d32f2f",800:"#c62828"},Tk={50:"#f3e5f5",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",700:"#7b1fa2"},vk={50:"#e3f2fd",200:"#90caf9",400:"#42a5f5",700:"#1976d2",800:"#1565c0"},yk={300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",700:"#0288d1",900:"#01579b"},Rk={300:"#81c784",400:"#66bb6a",500:"#4caf50",700:"#388e3c",800:"#2e7d32",900:"#1b5e20"},Cj={300:"#ffb74d",400:"#ffa726",500:"#ff9800",700:"#f57c00",900:"#e65100"},mse={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"};function ay(l,...a){const h=new URL(`https://mui.com/production-error/?code=${l}`);return a.forEach(_=>h.searchParams.append("args[]",_)),`Minified MUI error #${l}; visit ${h} for the full message.`}const RS="$$material";function mG(){return mG=Object.assign?Object.assign.bind():function(l){for(var a=1;a<arguments.length;a++){var h=arguments[a];for(var _ in h)({}).hasOwnProperty.call(h,_)&&(l[_]=h[_])}return l},mG.apply(null,arguments)}function Ese(l){if(l.sheet)return l.sheet;for(var a=0;a<document.styleSheets.length;a++)if(document.styleSheets[a].ownerNode===l)return document.styleSheets[a]}function gse(l){var a=document.createElement("style");return a.setAttribute("data-emotion",l.key),l.nonce!==void 0&&a.setAttribute("nonce",l.nonce),a.appendChild(document.createTextNode("")),a.setAttribute("data-s",""),a}var Sse=(function(){function l(h){var _=this;this._insertTag=function(S){var y;_.tags.length===0?_.insertionPoint?y=_.insertionPoint.nextSibling:_.prepend?y=_.container.firstChild:y=_.before:y=_.tags[_.tags.length-1].nextSibling,_.container.insertBefore(S,y),_.tags.push(S)},this.isSpeedy=h.speedy===void 0?!0:h.speedy,this.tags=[],this.ctr=0,this.nonce=h.nonce,this.key=h.key,this.container=h.container,this.prepend=h.prepend,this.insertionPoint=h.insertionPoint,this.before=null}var a=l.prototype;return a.hydrate=function(_){_.forEach(this._insertTag)},a.insert=function(_){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(gse(this));var S=this.tags[this.tags.length-1];if(this.isSpeedy){var y=Ese(S);try{y.insertRule(_,y.cssRules.length)}catch{}}else S.appendChild(document.createTextNode(_));this.ctr++},a.flush=function(){this.tags.forEach(function(_){var S;return(S=_.parentNode)==null?void 0:S.removeChild(_)}),this.tags=[],this.ctr=0},l})(),Gd="-ms-",EG="-moz-",Ps="-webkit-",z$="comm",j7="rule",G7="decl",Tse="@import",Y$="@keyframes",vse="@layer",yse=Math.abs,ZG=String.fromCharCode,Rse=Object.assign;function Cse(l,a){return od(l,0)^45?(((a<<2^od(l,0))<<2^od(l,1))<<2^od(l,2))<<2^od(l,3):0}function q$(l){return l.trim()}function bse(l,a){return(l=a.exec(l))?l[0]:l}function ks(l,a,h){return l.replace(a,h)}function Yq(l,a){return l.indexOf(a)}function od(l,a){return l.charCodeAt(a)|0}function t3(l,a,h){return l.slice(a,h)}function gS(l){return l.length}function W7(l){return l.length}function B6(l,a){return a.push(l),l}function Ise(l,a){return l.map(a).join("")}var $G=1,Gk=1,X$=0,Gh=0,wc=0,Zk="";function eW(l,a,h,_,S,y,b){return{value:l,root:a,parent:h,type:_,props:S,children:y,line:$G,column:Gk,length:b,return:""}}function bj(l,a){return Rse(eW("",null,null,"",null,null,0),l,{length:-l.length},a)}function Ase(){return wc}function wse(){return wc=Gh>0?od(Zk,--Gh):0,Gk--,wc===10&&(Gk=1,$G--),wc}function vf(){return wc=Gh<X$?od(Zk,Gh++):0,Gk++,wc===10&&(Gk=1,$G++),wc}function CS(){return od(Zk,Gh)}function iG(){return Gh}function T3(l,a){return t3(Zk,l,a)}function n3(l){switch(l){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function J$(l){return $G=Gk=1,X$=gS(Zk=l),Gh=0,[]}function Q$(l){return Zk="",l}function rG(l){return q$(T3(Gh-1,qq(l===91?l+2:l===40?l+1:l)))}function Ose(l){for(;(wc=CS())&&wc<33;)vf();return n3(l)>2||n3(wc)>3?"":" "}function Nse(l,a){for(;--a&&vf()&&!(wc<48||wc>102||wc>57&&wc<65||wc>70&&wc<97););return T3(l,iG()+(a<6&&CS()==32&&vf()==32))}function qq(l){for(;vf();)switch(wc){case l:return Gh;case 34:case 39:l!==34&&l!==39&&qq(wc);break;case 40:l===41&&qq(l);break;case 92:vf();break}return Gh}function Dse(l,a){for(;vf()&&l+wc!==57;)if(l+wc===84&&CS()===47)break;return"/*"+T3(a,Gh-1)+"*"+ZG(l===47?l:vf())}function Pse(l){for(;!n3(CS());)vf();return T3(l,Gh)}function kse(l){return Q$(sG("",null,null,null,[""],l=J$(l),0,[0],l))}function sG(l,a,h,_,S,y,b,D,U){for(var x=0,q=0,J=b,ee=0,ue=0,oe=0,le=1,pe=1,Ne=1,Ve=0,Ae="",Ue=S,ke=y,qe=_,Te=Ae;pe;)switch(oe=Ve,Ve=vf()){case 40:if(oe!=108&&od(Te,J-1)==58){Yq(Te+=ks(rG(Ve),"&","&\f"),"&\f")!=-1&&(Ne=-1);break}case 34:case 39:case 91:Te+=rG(Ve);break;case 9:case 10:case 13:case 32:Te+=Ose(oe);break;case 92:Te+=Nse(iG()-1,7);continue;case 47:switch(CS()){case 42:case 47:B6(Lse(Dse(vf(),iG()),a,h),U);break;default:Te+="/"}break;case 123*le:D[x++]=gS(Te)*Ne;case 125*le:case 59:case 0:switch(Ve){case 0:case 125:pe=0;case 59+q:Ne==-1&&(Te=ks(Te,/\f/g,"")),ue>0&&gS(Te)-J&&B6(ue>32?HJ(Te+";",_,h,J-1):HJ(ks(Te," ","")+";",_,h,J-2),U);break;case 59:Te+=";";default:if(B6(qe=WJ(Te,a,h,x,q,S,D,Ae,Ue=[],ke=[],J),y),Ve===123)if(q===0)sG(Te,a,qe,qe,Ue,y,J,D,ke);else switch(ee===99&&od(Te,3)===110?100:ee){case 100:case 108:case 109:case 115:sG(l,qe,qe,_&&B6(WJ(l,qe,qe,0,0,S,D,Ae,S,Ue=[],J),ke),S,ke,J,D,_?Ue:ke);break;default:sG(Te,qe,qe,qe,[""],ke,0,D,ke)}}x=q=ue=0,le=Ne=1,Ae=Te="",J=b;break;case 58:J=1+gS(Te),ue=oe;default:if(le<1){if(Ve==123)--le;else if(Ve==125&&le++==0&&wse()==125)continue}switch(Te+=ZG(Ve),Ve*le){case 38:Ne=q>0?1:(Te+="\f",-1);break;case 44:D[x++]=(gS(Te)-1)*Ne,Ne=1;break;case 64:CS()===45&&(Te+=rG(vf())),ee=CS(),q=J=gS(Ae=Te+=Pse(iG())),Ve++;break;case 45:oe===45&&gS(Te)==2&&(le=0)}}return y}function WJ(l,a,h,_,S,y,b,D,U,x,q){for(var J=S-1,ee=S===0?y:[""],ue=W7(ee),oe=0,le=0,pe=0;oe<_;++oe)for(var Ne=0,Ve=t3(l,J+1,J=yse(le=b[oe])),Ae=l;Ne<ue;++Ne)(Ae=q$(le>0?ee[Ne]+" "+Ve:ks(Ve,/&\f/g,ee[Ne])))&&(U[pe++]=Ae);return eW(l,a,h,S===0?j7:D,U,x,q)}function Lse(l,a,h){return eW(l,a,h,z$,ZG(Ase()),t3(l,2,-2),0)}function HJ(l,a,h,_){return eW(l,a,h,G7,t3(l,0,_),t3(l,_+1,-1),_)}function kk(l,a){for(var h="",_=W7(l),S=0;S<_;S++)h+=a(l[S],S,l,a)||"";return h}function Mse(l,a,h,_){switch(l.type){case vse:if(l.children.length)break;case Tse:case G7:return l.return=l.return||l.value;case z$:return"";case Y$:return l.return=l.value+"{"+kk(l.children,_)+"}";case j7:l.value=l.props.join(",")}return gS(h=kk(l.children,_))?l.return=l.value+"{"+h+"}":""}function Use(l){var a=W7(l);return function(h,_,S,y){for(var b="",D=0;D<a;D++)b+=l[D](h,_,S,y)||"";return b}}function xse(l){return function(a){a.root||(a=a.return)&&l(a)}}function Z$(l){var a=Object.create(null);return function(h){return a[h]===void 0&&(a[h]=l(h)),a[h]}}var Vse=function(a,h,_){for(var S=0,y=0;S=y,y=CS(),S===38&&y===12&&(h[_]=1),!n3(y);)vf();return T3(a,Gh)},Fse=function(a,h){var _=-1,S=44;do switch(n3(S)){case 0:S===38&&CS()===12&&(h[_]=1),a[_]+=Vse(Gh-1,h,_);break;case 2:a[_]+=rG(S);break;case 4:if(S===44){a[++_]=CS()===58?"&\f":"",h[_]=a[_].length;break}default:a[_]+=ZG(S)}while(S=vf());return a},Bse=function(a,h){return Q$(Fse(J$(a),h))},KJ=new WeakMap,jse=function(a){if(!(a.type!=="rule"||!a.parent||a.length<1)){for(var h=a.value,_=a.parent,S=a.column===_.column&&a.line===_.line;_.type!=="rule";)if(_=_.parent,!_)return;if(!(a.props.length===1&&h.charCodeAt(0)!==58&&!KJ.get(_))&&!S){KJ.set(a,!0);for(var y=[],b=Bse(h,y),D=_.props,U=0,x=0;U<b.length;U++)for(var q=0;q<D.length;q++,x++)a.props[x]=y[U]?b[U].replace(/&\f/g,D[q]):D[q]+" "+b[U]}}},Gse=function(a){if(a.type==="decl"){var h=a.value;h.charCodeAt(0)===108&&h.charCodeAt(2)===98&&(a.return="",a.value="")}};function $$(l,a){switch(Cse(l,a)){case 5103:return Ps+"print-"+l+l;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Ps+l+l;case 5349:case 4246:case 4810:case 6968:case 2756:return Ps+l+EG+l+Gd+l+l;case 6828:case 4268:return Ps+l+Gd+l+l;case 6165:return Ps+l+Gd+"flex-"+l+l;case 5187:return Ps+l+ks(l,/(\w+).+(:[^]+)/,Ps+"box-$1$2"+Gd+"flex-$1$2")+l;case 5443:return Ps+l+Gd+"flex-item-"+ks(l,/flex-|-self/,"")+l;case 4675:return Ps+l+Gd+"flex-line-pack"+ks(l,/align-content|flex-|-self/,"")+l;case 5548:return Ps+l+Gd+ks(l,"shrink","negative")+l;case 5292:return Ps+l+Gd+ks(l,"basis","preferred-size")+l;case 6060:return Ps+"box-"+ks(l,"-grow","")+Ps+l+Gd+ks(l,"grow","positive")+l;case 4554:return Ps+ks(l,/([^-])(transform)/g,"$1"+Ps+"$2")+l;case 6187:return ks(ks(ks(l,/(zoom-|grab)/,Ps+"$1"),/(image-set)/,Ps+"$1"),l,"")+l;case 5495:case 3959:return ks(l,/(image-set\([^]*)/,Ps+"$1$`$1");case 4968:return ks(ks(l,/(.+:)(flex-)?(.*)/,Ps+"box-pack:$3"+Gd+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Ps+l+l;case 4095:case 3583:case 4068:case 2532:return ks(l,/(.+)-inline(.+)/,Ps+"$1$2")+l;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(gS(l)-1-a>6)switch(od(l,a+1)){case 109:if(od(l,a+4)!==45)break;case 102:return ks(l,/(.+:)(.+)-([^]+)/,"$1"+Ps+"$2-$3$1"+EG+(od(l,a+3)==108?"$3":"$2-$3"))+l;case 115:return~Yq(l,"stretch")?$$(ks(l,"stretch","fill-available"),a)+l:l}break;case 4949:if(od(l,a+1)!==115)break;case 6444:switch(od(l,gS(l)-3-(~Yq(l,"!important")&&10))){case 107:return ks(l,":",":"+Ps)+l;case 101:return ks(l,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Ps+(od(l,14)===45?"inline-":"")+"box$3$1"+Ps+"$2$3$1"+Gd+"$2box$3")+l}break;case 5936:switch(od(l,a+11)){case 114:return Ps+l+Gd+ks(l,/[svh]\w+-[tblr]{2}/,"tb")+l;case 108:return Ps+l+Gd+ks(l,/[svh]\w+-[tblr]{2}/,"tb-rl")+l;case 45:return Ps+l+Gd+ks(l,/[svh]\w+-[tblr]{2}/,"lr")+l}return Ps+l+Gd+l+l}return l}var Wse=function(a,h,_,S){if(a.length>-1&&!a.return)switch(a.type){case G7:a.return=$$(a.value,a.length);break;case Y$:return kk([bj(a,{value:ks(a.value,"@","@"+Ps)})],S);case j7:if(a.length)return Ise(a.props,function(y){switch(bse(y,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return kk([bj(a,{props:[ks(y,/:(read-\w+)/,":"+EG+"$1")]})],S);case"::placeholder":return kk([bj(a,{props:[ks(y,/:(plac\w+)/,":"+Ps+"input-$1")]}),bj(a,{props:[ks(y,/:(plac\w+)/,":"+EG+"$1")]}),bj(a,{props:[ks(y,/:(plac\w+)/,Gd+"input-$1")]})],S)}return""})}},Hse=[Wse],Kse=function(a){var h=a.key;if(h==="css"){var _=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(_,function(le){var pe=le.getAttribute("data-emotion");pe.indexOf(" ")!==-1&&(document.head.appendChild(le),le.setAttribute("data-s",""))})}var S=a.stylisPlugins||Hse,y={},b,D=[];b=a.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+h+' "]'),function(le){for(var pe=le.getAttribute("data-emotion").split(" "),Ne=1;Ne<pe.length;Ne++)y[pe[Ne]]=!0;D.push(le)});var U,x=[jse,Gse];{var q,J=[Mse,xse(function(le){q.insert(le)})],ee=Use(x.concat(S,J)),ue=function(pe){return kk(kse(pe),ee)};U=function(pe,Ne,Ve,Ae){q=Ve,ue(pe?pe+"{"+Ne.styles+"}":Ne.styles),Ae&&(oe.inserted[Ne.name]=!0)}}var oe={key:h,sheet:new Sse({key:h,container:b,nonce:a.nonce,speedy:a.speedy,prepend:a.prepend,insertionPoint:a.insertionPoint}),nonce:a.nonce,inserted:y,registered:{},insert:U};return oe.sheet.hydrate(D),oe},fq={exports:{}},Hs={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zJ;function zse(){if(zJ)return Hs;zJ=1;var l=typeof Symbol=="function"&&Symbol.for,a=l?Symbol.for("react.element"):60103,h=l?Symbol.for("react.portal"):60106,_=l?Symbol.for("react.fragment"):60107,S=l?Symbol.for("react.strict_mode"):60108,y=l?Symbol.for("react.profiler"):60114,b=l?Symbol.for("react.provider"):60109,D=l?Symbol.for("react.context"):60110,U=l?Symbol.for("react.async_mode"):60111,x=l?Symbol.for("react.concurrent_mode"):60111,q=l?Symbol.for("react.forward_ref"):60112,J=l?Symbol.for("react.suspense"):60113,ee=l?Symbol.for("react.suspense_list"):60120,ue=l?Symbol.for("react.memo"):60115,oe=l?Symbol.for("react.lazy"):60116,le=l?Symbol.for("react.block"):60121,pe=l?Symbol.for("react.fundamental"):60117,Ne=l?Symbol.for("react.responder"):60118,Ve=l?Symbol.for("react.scope"):60119;function Ae(ke){if(typeof ke=="object"&&ke!==null){var qe=ke.$$typeof;switch(qe){case a:switch(ke=ke.type,ke){case U:case x:case _:case y:case S:case J:return ke;default:switch(ke=ke&&ke.$$typeof,ke){case D:case q:case oe:case ue:case b:return ke;default:return qe}}case h:return qe}}}function Ue(ke){return Ae(ke)===x}return Hs.AsyncMode=U,Hs.ConcurrentMode=x,Hs.ContextConsumer=D,Hs.ContextProvider=b,Hs.Element=a,Hs.ForwardRef=q,Hs.Fragment=_,Hs.Lazy=oe,Hs.Memo=ue,Hs.Portal=h,Hs.Profiler=y,Hs.StrictMode=S,Hs.Suspense=J,Hs.isAsyncMode=function(ke){return Ue(ke)||Ae(ke)===U},Hs.isConcurrentMode=Ue,Hs.isContextConsumer=function(ke){return Ae(ke)===D},Hs.isContextProvider=function(ke){return Ae(ke)===b},Hs.isElement=function(ke){return typeof ke=="object"&&ke!==null&&ke.$$typeof===a},Hs.isForwardRef=function(ke){return Ae(ke)===q},Hs.isFragment=function(ke){return Ae(ke)===_},Hs.isLazy=function(ke){return Ae(ke)===oe},Hs.isMemo=function(ke){return Ae(ke)===ue},Hs.isPortal=function(ke){return Ae(ke)===h},Hs.isProfiler=function(ke){return Ae(ke)===y},Hs.isStrictMode=function(ke){return Ae(ke)===S},Hs.isSuspense=function(ke){return Ae(ke)===J},Hs.isValidElementType=function(ke){return typeof ke=="string"||typeof ke=="function"||ke===_||ke===x||ke===y||ke===S||ke===J||ke===ee||typeof ke=="object"&&ke!==null&&(ke.$$typeof===oe||ke.$$typeof===ue||ke.$$typeof===b||ke.$$typeof===D||ke.$$typeof===q||ke.$$typeof===pe||ke.$$typeof===Ne||ke.$$typeof===Ve||ke.$$typeof===le)},Hs.typeOf=Ae,Hs}var YJ;function Yse(){return YJ||(YJ=1,fq.exports=zse()),fq.exports}var _q,qJ;function qse(){if(qJ)return _q;qJ=1;var l=Yse(),a={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},h={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},_={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},S={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},y={};y[l.ForwardRef]=_,y[l.Memo]=S;function b(oe){return l.isMemo(oe)?S:y[oe.$$typeof]||a}var D=Object.defineProperty,U=Object.getOwnPropertyNames,x=Object.getOwnPropertySymbols,q=Object.getOwnPropertyDescriptor,J=Object.getPrototypeOf,ee=Object.prototype;function ue(oe,le,pe){if(typeof le!="string"){if(ee){var Ne=J(le);Ne&&Ne!==ee&&ue(oe,Ne,pe)}var Ve=U(le);x&&(Ve=Ve.concat(x(le)));for(var Ae=b(oe),Ue=b(le),ke=0;ke<Ve.length;++ke){var qe=Ve[ke];if(!h[qe]&&!(pe&&pe[qe])&&!(Ue&&Ue[qe])&&!(Ae&&Ae[qe])){var Te=q(le,qe);try{D(oe,qe,Te)}catch{}}}}return oe}return _q=ue,_q}qse();var Xse=!0;function eee(l,a,h){var _="";return h.split(" ").forEach(function(S){l[S]!==void 0?a.push(l[S]+";"):S&&(_+=S+" ")}),_}var H7=function(a,h,_){var S=a.key+"-"+h.name;(_===!1||Xse===!1)&&a.registered[S]===void 0&&(a.registered[S]=h.styles)},K7=function(a,h,_){H7(a,h,_);var S=a.key+"-"+h.name;if(a.inserted[h.name]===void 0){var y=h;do a.insert(h===y?"."+S:"",y,a.sheet,!0),y=y.next;while(y!==void 0)}};function Jse(l){for(var a=0,h,_=0,S=l.length;S>=4;++_,S-=4)h=l.charCodeAt(_)&255|(l.charCodeAt(++_)&255)<<8|(l.charCodeAt(++_)&255)<<16|(l.charCodeAt(++_)&255)<<24,h=(h&65535)*1540483477+((h>>>16)*59797<<16),h^=h>>>24,a=(h&65535)*1540483477+((h>>>16)*59797<<16)^(a&65535)*1540483477+((a>>>16)*59797<<16);switch(S){case 3:a^=(l.charCodeAt(_+2)&255)<<16;case 2:a^=(l.charCodeAt(_+1)&255)<<8;case 1:a^=l.charCodeAt(_)&255,a=(a&65535)*1540483477+((a>>>16)*59797<<16)}return a^=a>>>13,a=(a&65535)*1540483477+((a>>>16)*59797<<16),((a^a>>>15)>>>0).toString(36)}var Qse={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Zse=/[A-Z]|^ms/g,$se=/_EMO_([^_]+?)_([^]*?)_EMO_/g,tee=function(a){return a.charCodeAt(1)===45},XJ=function(a){return a!=null&&typeof a!="boolean"},mq=Z$(function(l){return tee(l)?l:l.replace(Zse,"-$&").toLowerCase()}),JJ=function(a,h){switch(a){case"animation":case"animationName":if(typeof h=="string")return h.replace($se,function(_,S,y){return SS={name:S,styles:y,next:SS},S})}return Qse[a]!==1&&!tee(a)&&typeof h=="number"&&h!==0?h+"px":h};function i3(l,a,h){if(h==null)return"";var _=h;if(_.__emotion_styles!==void 0)return _;switch(typeof h){case"boolean":return"";case"object":{var S=h;if(S.anim===1)return SS={name:S.name,styles:S.styles,next:SS},S.name;var y=h;if(y.styles!==void 0){var b=y.next;if(b!==void 0)for(;b!==void 0;)SS={name:b.name,styles:b.styles,next:SS},b=b.next;var D=y.styles+";";return D}return eoe(l,a,h)}case"function":{if(l!==void 0){var U=SS,x=h(l);return SS=U,i3(l,a,x)}break}}var q=h;if(a==null)return q;var J=a[q];return J!==void 0?J:q}function eoe(l,a,h){var _="";if(Array.isArray(h))for(var S=0;S<h.length;S++)_+=i3(l,a,h[S])+";";else for(var y in h){var b=h[y];if(typeof b!="object"){var D=b;a!=null&&a[D]!==void 0?_+=y+"{"+a[D]+"}":XJ(D)&&(_+=mq(y)+":"+JJ(y,D)+";")}else if(Array.isArray(b)&&typeof b[0]=="string"&&(a==null||a[b[0]]===void 0))for(var U=0;U<b.length;U++)XJ(b[U])&&(_+=mq(y)+":"+JJ(y,b[U])+";");else{var x=i3(l,a,b);switch(y){case"animation":case"animationName":{_+=mq(y)+":"+x+";";break}default:_+=y+"{"+x+"}"}}}return _}var QJ=/label:\s*([^\s;{]+)\s*(;|$)/g,SS;function v3(l,a,h){if(l.length===1&&typeof l[0]=="object"&&l[0]!==null&&l[0].styles!==void 0)return l[0];var _=!0,S="";SS=void 0;var y=l[0];if(y==null||y.raw===void 0)_=!1,S+=i3(h,a,y);else{var b=y;S+=b[0]}for(var D=1;D<l.length;D++)if(S+=i3(h,a,l[D]),_){var U=y;S+=U[D]}QJ.lastIndex=0;for(var x="",q;(q=QJ.exec(S))!==null;)x+="-"+q[1];var J=Jse(S)+x;return{name:J,styles:S,next:SS}}var toe=function(a){return a()},nee=Wq.useInsertionEffect?Wq.useInsertionEffect:!1,iee=nee||toe,ZJ=nee||ae.useLayoutEffect,ree=ae.createContext(typeof HTMLElement<"u"?Kse({key:"css"}):null);ree.Provider;var z7=function(a){return ae.forwardRef(function(h,_){var S=ae.useContext(ree);return a(h,S,_)})},y3=ae.createContext({}),Y7={}.hasOwnProperty,Xq="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",noe=function(a,h){var _={};for(var S in h)Y7.call(h,S)&&(_[S]=h[S]);return _[Xq]=a,_},ioe=function(a){var h=a.cache,_=a.serialized,S=a.isStringTag;return H7(h,_,S),iee(function(){return K7(h,_,S)}),null},roe=z7(function(l,a,h){var _=l.css;typeof _=="string"&&a.registered[_]!==void 0&&(_=a.registered[_]);var S=l[Xq],y=[_],b="";typeof l.className=="string"?b=eee(a.registered,y,l.className):l.className!=null&&(b=l.className+" ");var D=v3(y,void 0,ae.useContext(y3));b+=a.key+"-"+D.name;var U={};for(var x in l)Y7.call(l,x)&&x!=="css"&&x!==Xq&&(U[x]=l[x]);return U.className=b,h&&(U.ref=h),ae.createElement(ae.Fragment,null,ae.createElement(ioe,{cache:a,serialized:D,isStringTag:typeof S=="string"}),ae.createElement(S,U))}),soe=roe,$J=function(a,h){var _=arguments;if(h==null||!Y7.call(h,"css"))return ae.createElement.apply(void 0,_);var S=_.length,y=new Array(S);y[0]=soe,y[1]=noe(a,h);for(var b=2;b<S;b++)y[b]=_[b];return ae.createElement.apply(null,y)};(function(l){var a;a||(a=l.JSX||(l.JSX={}))})($J||($J={}));var ooe=z7(function(l,a){var h=l.styles,_=v3([h],void 0,ae.useContext(y3)),S=ae.useRef();return ZJ(function(){var y=a.key+"-global",b=new a.sheet.constructor({key:y,nonce:a.sheet.nonce,container:a.sheet.container,speedy:a.sheet.isSpeedy}),D=!1,U=document.querySelector('style[data-emotion="'+y+" "+_.name+'"]');return a.sheet.tags.length&&(b.before=a.sheet.tags[0]),U!==null&&(D=!0,U.setAttribute("data-emotion",y),b.hydrate([U])),S.current=[b,D],function(){b.flush()}},[a]),ZJ(function(){var y=S.current,b=y[0],D=y[1];if(D){y[1]=!1;return}if(_.next!==void 0&&K7(a,_.next,!0),b.tags.length){var U=b.tags[b.tags.length-1].nextElementSibling;b.before=U,b.flush()}a.insert("",_,b,!1)},[a,_.name]),null});function q7(){for(var l=arguments.length,a=new Array(l),h=0;h<l;h++)a[h]=arguments[h];return v3(a)}function R3(){var l=q7.apply(void 0,arguments),a="animation-"+l.name;return{name:a,styles:"@keyframes "+a+"{"+l.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}var aoe=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|disableRemotePlayback|download|draggable|encType|enterKeyHint|fetchpriority|fetchPriority|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|popover|popoverTarget|popoverTargetAction|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,coe=Z$(function(l){return aoe.test(l)||l.charCodeAt(0)===111&&l.charCodeAt(1)===110&&l.charCodeAt(2)<91}),loe=coe,doe=function(a){return a!=="theme"},eQ=function(a){return typeof a=="string"&&a.charCodeAt(0)>96?loe:doe},tQ=function(a,h,_){var S;if(h){var y=h.shouldForwardProp;S=a.__emotion_forwardProp&&y?function(b){return a.__emotion_forwardProp(b)&&y(b)}:y}return typeof S!="function"&&_&&(S=a.__emotion_forwardProp),S},uoe=function(a){var h=a.cache,_=a.serialized,S=a.isStringTag;return H7(h,_,S),iee(function(){return K7(h,_,S)}),null},hoe=function l(a,h){var _=a.__emotion_real===a,S=_&&a.__emotion_base||a,y,b;h!==void 0&&(y=h.label,b=h.target);var D=tQ(a,h,_),U=D||eQ(S),x=!U("as");return function(){var q=arguments,J=_&&a.__emotion_styles!==void 0?a.__emotion_styles.slice(0):[];if(y!==void 0&&J.push("label:"+y+";"),q[0]==null||q[0].raw===void 0)J.push.apply(J,q);else{var ee=q[0];J.push(ee[0]);for(var ue=q.length,oe=1;oe<ue;oe++)J.push(q[oe],ee[oe])}var le=z7(function(pe,Ne,Ve){var Ae=x&&pe.as||S,Ue="",ke=[],qe=pe;if(pe.theme==null){qe={};for(var Te in pe)qe[Te]=pe[Te];qe.theme=ae.useContext(y3)}typeof pe.className=="string"?Ue=eee(Ne.registered,ke,pe.className):pe.className!=null&&(Ue=pe.className+" ");var he=v3(J.concat(ke),Ne.registered,qe);Ue+=Ne.key+"-"+he.name,b!==void 0&&(Ue+=" "+b);var _e=x&&D===void 0?eQ(Ae):U,ye={};for(var Ie in pe)x&&Ie==="as"||_e(Ie)&&(ye[Ie]=pe[Ie]);return ye.className=Ue,Ve&&(ye.ref=Ve),ae.createElement(ae.Fragment,null,ae.createElement(uoe,{cache:Ne,serialized:he,isStringTag:typeof Ae=="string"}),ae.createElement(Ae,ye))});return le.displayName=y!==void 0?y:"Styled("+(typeof S=="string"?S:S.displayName||S.name||"Component")+")",le.defaultProps=a.defaultProps,le.__emotion_real=le,le.__emotion_base=S,le.__emotion_styles=J,le.__emotion_forwardProp=D,Object.defineProperty(le,"toString",{value:function(){return"."+b}}),le.withComponent=function(pe,Ne){var Ve=l(pe,mG({},h,Ne,{shouldForwardProp:tQ(le,Ne,!0)}));return Ve.apply(void 0,J)},le}},poe=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],Jq=hoe.bind(null);poe.forEach(function(l){Jq[l]=Jq(l)});function foe(l){return l==null||Object.keys(l).length===0}function see(l){const{styles:a,defaultTheme:h={}}=l,_=typeof a=="function"?S=>a(foe(S)?h:S):a;return ze.jsx(ooe,{styles:_})}function oee(l,a){return Jq(l,a)}function _oe(l,a){Array.isArray(l.__emotion_styles)&&(l.__emotion_styles=a(l.__emotion_styles))}const nQ=[];function Ab(l){return nQ[0]=l,v3(nQ)}var Eq={exports:{}},lo={};/**
 * @license React
 * react-is.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var iQ;function moe(){if(iQ)return lo;iQ=1;var l=Symbol.for("react.transitional.element"),a=Symbol.for("react.portal"),h=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),y=Symbol.for("react.consumer"),b=Symbol.for("react.context"),D=Symbol.for("react.forward_ref"),U=Symbol.for("react.suspense"),x=Symbol.for("react.suspense_list"),q=Symbol.for("react.memo"),J=Symbol.for("react.lazy"),ee=Symbol.for("react.view_transition"),ue=Symbol.for("react.client.reference");function oe(le){if(typeof le=="object"&&le!==null){var pe=le.$$typeof;switch(pe){case l:switch(le=le.type,le){case h:case S:case _:case U:case x:case ee:return le;default:switch(le=le&&le.$$typeof,le){case b:case D:case J:case q:return le;case y:return le;default:return pe}}case a:return pe}}}return lo.ContextConsumer=y,lo.ContextProvider=b,lo.Element=l,lo.ForwardRef=D,lo.Fragment=h,lo.Lazy=J,lo.Memo=q,lo.Portal=a,lo.Profiler=S,lo.StrictMode=_,lo.Suspense=U,lo.SuspenseList=x,lo.isContextConsumer=function(le){return oe(le)===y},lo.isContextProvider=function(le){return oe(le)===b},lo.isElement=function(le){return typeof le=="object"&&le!==null&&le.$$typeof===l},lo.isForwardRef=function(le){return oe(le)===D},lo.isFragment=function(le){return oe(le)===h},lo.isLazy=function(le){return oe(le)===J},lo.isMemo=function(le){return oe(le)===q},lo.isPortal=function(le){return oe(le)===a},lo.isProfiler=function(le){return oe(le)===S},lo.isStrictMode=function(le){return oe(le)===_},lo.isSuspense=function(le){return oe(le)===U},lo.isSuspenseList=function(le){return oe(le)===x},lo.isValidElementType=function(le){return typeof le=="string"||typeof le=="function"||le===h||le===S||le===_||le===U||le===x||typeof le=="object"&&le!==null&&(le.$$typeof===J||le.$$typeof===q||le.$$typeof===b||le.$$typeof===y||le.$$typeof===D||le.$$typeof===ue||le.getModuleId!==void 0)},lo.typeOf=oe,lo}var rQ;function Eoe(){return rQ||(rQ=1,Eq.exports=moe()),Eq.exports}var aee=Eoe();function vS(l){if(typeof l!="object"||l===null)return!1;const a=Object.getPrototypeOf(l);return(a===null||a===Object.prototype||Object.getPrototypeOf(a)===null)&&!(Symbol.toStringTag in l)&&!(Symbol.iterator in l)}function cee(l){if(ae.isValidElement(l)||aee.isValidElementType(l)||!vS(l))return l;const a={};return Object.keys(l).forEach(h=>{a[h]=cee(l[h])}),a}function zd(l,a,h={clone:!0}){const _=h.clone?{...l}:l;return vS(l)&&vS(a)&&Object.keys(a).forEach(S=>{ae.isValidElement(a[S])||aee.isValidElementType(a[S])?_[S]=a[S]:vS(a[S])&&Object.prototype.hasOwnProperty.call(l,S)&&vS(l[S])?_[S]=zd(l[S],a[S],h):h.clone?_[S]=vS(a[S])?cee(a[S]):a[S]:_[S]=a[S]}),_}const goe=l=>{const a=Object.keys(l).map(h=>({key:h,val:l[h]}))||[];return a.sort((h,_)=>h.val-_.val),a.reduce((h,_)=>({...h,[_.key]:_.val}),{})};function Soe(l){const{values:a={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:h="px",step:_=5,...S}=l,y=goe(a),b=Object.keys(y);function D(ee){return`@media (min-width:${typeof a[ee]=="number"?a[ee]:ee}${h})`}function U(ee){return`@media (max-width:${(typeof a[ee]=="number"?a[ee]:ee)-_/100}${h})`}function x(ee,ue){const oe=b.indexOf(ue);return`@media (min-width:${typeof a[ee]=="number"?a[ee]:ee}${h}) and (max-width:${(oe!==-1&&typeof a[b[oe]]=="number"?a[b[oe]]:ue)-_/100}${h})`}function q(ee){return b.indexOf(ee)+1<b.length?x(ee,b[b.indexOf(ee)+1]):D(ee)}function J(ee){const ue=b.indexOf(ee);return ue===0?D(b[1]):ue===b.length-1?U(b[ue]):x(ee,b[b.indexOf(ee)+1]).replace("@media","@media not all and")}return{keys:b,values:y,up:D,down:U,between:x,only:q,not:J,unit:h,...S}}function sQ(l,a){if(!l.containerQueries)return a;const h=Object.keys(a).filter(_=>_.startsWith("@container")).sort((_,S)=>{const y=/min-width:\s*([0-9.]+)/;return+(_.match(y)?.[1]||0)-+(S.match(y)?.[1]||0)});return h.length?h.reduce((_,S)=>{const y=a[S];return delete _[S],_[S]=y,_},{...a}):a}function Toe(l,a){return a==="@"||a.startsWith("@")&&(l.some(h=>a.startsWith(`@${h}`))||!!a.match(/^@\d/))}function voe(l,a){const h=a.match(/^@([^/]+)?\/?(.+)?$/);if(!h)return null;const[,_,S]=h,y=Number.isNaN(+_)?_||0:+_;return l.containerQueries(S).up(y)}function yoe(l){const a=(y,b)=>y.replace("@media",b?`@container ${b}`:"@container");function h(y,b){y.up=(...D)=>a(l.breakpoints.up(...D),b),y.down=(...D)=>a(l.breakpoints.down(...D),b),y.between=(...D)=>a(l.breakpoints.between(...D),b),y.only=(...D)=>a(l.breakpoints.only(...D),b),y.not=(...D)=>{const U=a(l.breakpoints.not(...D),b);return U.includes("not all and")?U.replace("not all and ","").replace("min-width:","width<").replace("max-width:","width>").replace("and","or"):U}}const _={},S=y=>(h(_,y),_);return h(S),{...l,containerQueries:S}}const Roe={borderRadius:4};function Vj(l,a){return a?zd(l,a,{clone:!1}):l}const tW={xs:0,sm:600,md:900,lg:1200,xl:1536},oQ={keys:["xs","sm","md","lg","xl"],up:l=>`@media (min-width:${tW[l]}px)`},Coe={containerQueries:l=>({up:a=>{let h=typeof a=="number"?a:tW[a]||a;return typeof h=="number"&&(h=`${h}px`),l?`@container ${l} (min-width:${h})`:`@container (min-width:${h})`}})};function cy(l,a,h){const _=l.theme||{};if(Array.isArray(a)){const y=_.breakpoints||oQ;return a.reduce((b,D,U)=>(b[y.up(y.keys[U])]=h(a[U]),b),{})}if(typeof a=="object"){const y=_.breakpoints||oQ;return Object.keys(a).reduce((b,D)=>{if(Toe(y.keys,D)){const U=voe(_.containerQueries?_:Coe,D);U&&(b[U]=h(a[D],D))}else if(Object.keys(y.values||tW).includes(D)){const U=y.up(D);b[U]=h(a[D],D)}else{const U=D;b[U]=a[U]}return b},{})}return h(a)}function boe(l={}){return l.keys?.reduce((h,_)=>{const S=l.up(_);return h[S]={},h},{})||{}}function aQ(l,a){return l.reduce((h,_)=>{const S=h[_];return(!S||Object.keys(S).length===0)&&delete h[_],h},a)}function _i(l){if(typeof l!="string")throw new Error(ay(7));return l.charAt(0).toUpperCase()+l.slice(1)}function nW(l,a,h=!0){if(!a||typeof a!="string")return null;if(l&&l.vars&&h){const _=`vars.${a}`.split(".").reduce((S,y)=>S&&S[y]?S[y]:null,l);if(_!=null)return _}return a.split(".").reduce((_,S)=>_&&_[S]!=null?_[S]:null,l)}function gG(l,a,h,_=h){let S;return typeof l=="function"?S=l(h):Array.isArray(l)?S=l[h]||_:S=nW(l,h)||_,a&&(S=a(S,_,l)),S}function uc(l){const{prop:a,cssProperty:h=l.prop,themeKey:_,transform:S}=l,y=b=>{if(b[a]==null)return null;const D=b[a],U=b.theme,x=nW(U,_)||{};return cy(b,D,J=>{let ee=gG(x,S,J);return J===ee&&typeof J=="string"&&(ee=gG(x,S,`${a}${J==="default"?"":_i(J)}`,J)),h===!1?ee:{[h]:ee}})};return y.propTypes={},y.filterProps=[a],y}function Ioe(l){const a={};return h=>(a[h]===void 0&&(a[h]=l(h)),a[h])}const Aoe={m:"margin",p:"padding"},woe={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},cQ={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},Ooe=Ioe(l=>{if(l.length>2)if(cQ[l])l=cQ[l];else return[l];const[a,h]=l.split(""),_=Aoe[a],S=woe[h]||"";return Array.isArray(S)?S.map(y=>_+y):[_+S]}),X7=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],J7=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"];[...X7,...J7];function C3(l,a,h,_){const S=nW(l,a,!0)??h;return typeof S=="number"||typeof S=="string"?y=>typeof y=="string"?y:typeof S=="string"?S.startsWith("var(")&&y===0?0:S.startsWith("var(")&&y===1?S:`calc(${y} * ${S})`:S*y:Array.isArray(S)?y=>{if(typeof y=="string")return y;const b=Math.abs(y),D=S[b];return y>=0?D:typeof D=="number"?-D:typeof D=="string"&&D.startsWith("var(")?`calc(-1 * ${D})`:`-${D}`}:typeof S=="function"?S:()=>{}}function Q7(l){return C3(l,"spacing",8)}function b3(l,a){return typeof a=="string"||a==null?a:l(a)}function Noe(l,a){return h=>l.reduce((_,S)=>(_[S]=b3(a,h),_),{})}function Doe(l,a,h,_){if(!a.includes(h))return null;const S=Ooe(h),y=Noe(S,_),b=l[h];return cy(l,b,y)}function lee(l,a){const h=Q7(l.theme);return Object.keys(l).map(_=>Doe(l,a,_,h)).reduce(Vj,{})}function Ya(l){return lee(l,X7)}Ya.propTypes={};Ya.filterProps=X7;function qa(l){return lee(l,J7)}qa.propTypes={};qa.filterProps=J7;function dee(l=8,a=Q7({spacing:l})){if(l.mui)return l;const h=(..._)=>(_.length===0?[1]:_).map(y=>{const b=a(y);return typeof b=="number"?`${b}px`:b}).join(" ");return h.mui=!0,h}function iW(...l){const a=l.reduce((_,S)=>(S.filterProps.forEach(y=>{_[y]=S}),_),{}),h=_=>Object.keys(_).reduce((S,y)=>a[y]?Vj(S,a[y](_)):S,{});return h.propTypes={},h.filterProps=l.reduce((_,S)=>_.concat(S.filterProps),[]),h}function x_(l){return typeof l!="number"?l:`${l}px solid`}function F_(l,a){return uc({prop:l,themeKey:"borders",transform:a})}const Poe=F_("border",x_),koe=F_("borderTop",x_),Loe=F_("borderRight",x_),Moe=F_("borderBottom",x_),Uoe=F_("borderLeft",x_),xoe=F_("borderColor"),Voe=F_("borderTopColor"),Foe=F_("borderRightColor"),Boe=F_("borderBottomColor"),joe=F_("borderLeftColor"),Goe=F_("outline",x_),Woe=F_("outlineColor"),rW=l=>{if(l.borderRadius!==void 0&&l.borderRadius!==null){const a=C3(l.theme,"shape.borderRadius",4),h=_=>({borderRadius:b3(a,_)});return cy(l,l.borderRadius,h)}return null};rW.propTypes={};rW.filterProps=["borderRadius"];iW(Poe,koe,Loe,Moe,Uoe,xoe,Voe,Foe,Boe,joe,rW,Goe,Woe);const sW=l=>{if(l.gap!==void 0&&l.gap!==null){const a=C3(l.theme,"spacing",8),h=_=>({gap:b3(a,_)});return cy(l,l.gap,h)}return null};sW.propTypes={};sW.filterProps=["gap"];const oW=l=>{if(l.columnGap!==void 0&&l.columnGap!==null){const a=C3(l.theme,"spacing",8),h=_=>({columnGap:b3(a,_)});return cy(l,l.columnGap,h)}return null};oW.propTypes={};oW.filterProps=["columnGap"];const aW=l=>{if(l.rowGap!==void 0&&l.rowGap!==null){const a=C3(l.theme,"spacing",8),h=_=>({rowGap:b3(a,_)});return cy(l,l.rowGap,h)}return null};aW.propTypes={};aW.filterProps=["rowGap"];const Hoe=uc({prop:"gridColumn"}),Koe=uc({prop:"gridRow"}),zoe=uc({prop:"gridAutoFlow"}),Yoe=uc({prop:"gridAutoColumns"}),qoe=uc({prop:"gridAutoRows"}),Xoe=uc({prop:"gridTemplateColumns"}),Joe=uc({prop:"gridTemplateRows"}),Qoe=uc({prop:"gridTemplateAreas"}),Zoe=uc({prop:"gridArea"});iW(sW,oW,aW,Hoe,Koe,zoe,Yoe,qoe,Xoe,Joe,Qoe,Zoe);function Lk(l,a){return a==="grey"?a:l}const $oe=uc({prop:"color",themeKey:"palette",transform:Lk}),eae=uc({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:Lk}),tae=uc({prop:"backgroundColor",themeKey:"palette",transform:Lk});iW($oe,eae,tae);function Tf(l){return l<=1&&l!==0?`${l*100}%`:l}const nae=uc({prop:"width",transform:Tf}),Z7=l=>{if(l.maxWidth!==void 0&&l.maxWidth!==null){const a=h=>{const _=l.theme?.breakpoints?.values?.[h]||tW[h];return _?l.theme?.breakpoints?.unit!=="px"?{maxWidth:`${_}${l.theme.breakpoints.unit}`}:{maxWidth:_}:{maxWidth:Tf(h)}};return cy(l,l.maxWidth,a)}return null};Z7.filterProps=["maxWidth"];const iae=uc({prop:"minWidth",transform:Tf}),rae=uc({prop:"height",transform:Tf}),sae=uc({prop:"maxHeight",transform:Tf}),oae=uc({prop:"minHeight",transform:Tf});uc({prop:"size",cssProperty:"width",transform:Tf});uc({prop:"size",cssProperty:"height",transform:Tf});const aae=uc({prop:"boxSizing"});iW(nae,Z7,iae,rae,sae,oae,aae);const I3={border:{themeKey:"borders",transform:x_},borderTop:{themeKey:"borders",transform:x_},borderRight:{themeKey:"borders",transform:x_},borderBottom:{themeKey:"borders",transform:x_},borderLeft:{themeKey:"borders",transform:x_},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},outline:{themeKey:"borders",transform:x_},outlineColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:rW},color:{themeKey:"palette",transform:Lk},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:Lk},backgroundColor:{themeKey:"palette",transform:Lk},p:{style:qa},pt:{style:qa},pr:{style:qa},pb:{style:qa},pl:{style:qa},px:{style:qa},py:{style:qa},padding:{style:qa},paddingTop:{style:qa},paddingRight:{style:qa},paddingBottom:{style:qa},paddingLeft:{style:qa},paddingX:{style:qa},paddingY:{style:qa},paddingInline:{style:qa},paddingInlineStart:{style:qa},paddingInlineEnd:{style:qa},paddingBlock:{style:qa},paddingBlockStart:{style:qa},paddingBlockEnd:{style:qa},m:{style:Ya},mt:{style:Ya},mr:{style:Ya},mb:{style:Ya},ml:{style:Ya},mx:{style:Ya},my:{style:Ya},margin:{style:Ya},marginTop:{style:Ya},marginRight:{style:Ya},marginBottom:{style:Ya},marginLeft:{style:Ya},marginX:{style:Ya},marginY:{style:Ya},marginInline:{style:Ya},marginInlineStart:{style:Ya},marginInlineEnd:{style:Ya},marginBlock:{style:Ya},marginBlockStart:{style:Ya},marginBlockEnd:{style:Ya},displayPrint:{cssProperty:!1,transform:l=>({"@media print":{display:l}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:sW},rowGap:{style:aW},columnGap:{style:oW},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:Tf},maxWidth:{style:Z7},minWidth:{transform:Tf},height:{transform:Tf},maxHeight:{transform:Tf},minHeight:{transform:Tf},boxSizing:{},font:{themeKey:"font"},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}};function cae(...l){const a=l.reduce((_,S)=>_.concat(Object.keys(S)),[]),h=new Set(a);return l.every(_=>h.size===Object.keys(_).length)}function lae(l,a){return typeof l=="function"?l(a):l}function dae(){function l(h,_,S,y){const b={[h]:_,theme:S},D=y[h];if(!D)return{[h]:_};const{cssProperty:U=h,themeKey:x,transform:q,style:J}=D;if(_==null)return null;if(x==="typography"&&_==="inherit")return{[h]:_};const ee=nW(S,x)||{};return J?J(b):cy(b,_,oe=>{let le=gG(ee,q,oe);return oe===le&&typeof oe=="string"&&(le=gG(ee,q,`${h}${oe==="default"?"":_i(oe)}`,oe)),U===!1?le:{[U]:le}})}function a(h){const{sx:_,theme:S={},nested:y}=h||{};if(!_)return null;const b=S.unstable_sxConfig??I3;function D(U){let x=U;if(typeof U=="function")x=U(S);else if(typeof U!="object")return U;if(!x)return null;const q=boe(S.breakpoints),J=Object.keys(q);let ee=q;return Object.keys(x).forEach(ue=>{const oe=lae(x[ue],S);if(oe!=null)if(typeof oe=="object")if(b[ue])ee=Vj(ee,l(ue,oe,S,b));else{const le=cy({theme:S},oe,pe=>({[ue]:pe}));cae(le,oe)?ee[ue]=a({sx:oe,theme:S,nested:!0}):ee=Vj(ee,le)}else ee=Vj(ee,l(ue,oe,S,b))}),!y&&S.modularCssLayers?{"@layer sx":sQ(S,aQ(J,ee))}:sQ(S,aQ(J,ee))}return Array.isArray(_)?_.map(D):D(_)}return a}const Pb=dae();Pb.filterProps=["sx"];function uae(l,a){const h=this;if(h.vars){if(!h.colorSchemes?.[l]||typeof h.getColorSchemeSelector!="function")return{};let _=h.getColorSchemeSelector(l);return _==="&"?a:((_.includes("data-")||_.includes("."))&&(_=`*:where(${_.replace(/\s*&$/,"")}) &`),{[_]:a})}return h.palette.mode===l?a:{}}function cW(l={},...a){const{breakpoints:h={},palette:_={},spacing:S,shape:y={},...b}=l,D=Soe(h),U=dee(S);let x=zd({breakpoints:D,direction:"ltr",components:{},palette:{mode:"light",..._},spacing:U,shape:{...Roe,...y}},b);return x=yoe(x),x.applyStyles=uae,x=a.reduce((q,J)=>zd(q,J),x),x.unstable_sxConfig={...I3,...b?.unstable_sxConfig},x.unstable_sx=function(J){return Pb({sx:J,theme:this})},x}function hae(l){return Object.keys(l).length===0}function $7(l=null){const a=ae.useContext(y3);return!a||hae(a)?l:a}const pae=cW();function lW(l=pae){return $7(l)}function gq(l){const a=Ab(l);return l!==a&&a.styles?(a.styles.match(/^@layer\s+[^{]*$/)||(a.styles=`@layer global{${a.styles}}`),a):l}function uee({styles:l,themeId:a,defaultTheme:h={}}){const _=lW(h),S=a&&_[a]||_;let y=typeof l=="function"?l(S):l;return S.modularCssLayers&&(Array.isArray(y)?y=y.map(b=>gq(typeof b=="function"?b(S):b)):y=gq(y)),ze.jsx(see,{styles:y})}const fae=l=>{const a={systemProps:{},otherProps:{}},h=l?.theme?.unstable_sxConfig??I3;return Object.keys(l).forEach(_=>{h[_]?a.systemProps[_]=l[_]:a.otherProps[_]=l[_]}),a};function hee(l){const{sx:a,...h}=l,{systemProps:_,otherProps:S}=fae(h);let y;return Array.isArray(a)?y=[_,...a]:typeof a=="function"?y=(...b)=>{const D=a(...b);return vS(D)?{..._,...D}:_}:y={..._,...a},{...S,sx:y}}const lQ=l=>l,_ae=()=>{let l=lQ;return{configure(a){l=a},generate(a){return l(a)},reset(){l=lQ}}},pee=_ae();function fee(l){var a,h,_="";if(typeof l=="string"||typeof l=="number")_+=l;else if(typeof l=="object")if(Array.isArray(l)){var S=l.length;for(a=0;a<S;a++)l[a]&&(h=fee(l[a]))&&(_&&(_+=" "),_+=h)}else for(h in l)l[h]&&(_&&(_+=" "),_+=h);return _}function Ui(){for(var l,a,h=0,_="",S=arguments.length;h<S;h++)(l=arguments[h])&&(a=fee(l))&&(_&&(_+=" "),_+=a);return _}function mae(l={}){const{themeId:a,defaultTheme:h,defaultClassName:_="MuiBox-root",generateClassName:S}=l,y=oee("div",{shouldForwardProp:D=>D!=="theme"&&D!=="sx"&&D!=="as"})(Pb);return ae.forwardRef(function(U,x){const q=lW(h),{className:J,component:ee="div",...ue}=hee(U);return ze.jsx(y,{as:ee,ref:x,className:Ui(J,S?S(_):_),theme:a&&q[a]||q,...ue})})}const Eae={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function Ro(l,a,h="Mui"){const _=Eae[a];return _?`${h}-${_}`:`${pee.generate(l)}-${a}`}function Co(l,a,h="Mui"){const _={};return a.forEach(S=>{_[S]=Ro(l,S,h)}),_}function _ee(l){const{variants:a,...h}=l,_={variants:a,style:Ab(h),isProcessed:!0};return _.style===h||a&&a.forEach(S=>{typeof S.style!="function"&&(S.style=Ab(S.style))}),_}const gae=cW();function Sq(l){return l!=="ownerState"&&l!=="theme"&&l!=="sx"&&l!=="as"}function Y0(l,a){return a&&l&&typeof l=="object"&&l.styles&&!l.styles.startsWith("@layer")&&(l.styles=`@layer ${a}{${String(l.styles)}}`),l}function Sae(l){return l?(a,h)=>h[l]:null}function Tae(l,a,h){l.theme=yae(l.theme)?h:l.theme[a]||l.theme}function oG(l,a,h){const _=typeof a=="function"?a(l):a;if(Array.isArray(_))return _.flatMap(S=>oG(l,S,h));if(Array.isArray(_?.variants)){let S;if(_.isProcessed)S=h?Y0(_.style,h):_.style;else{const{variants:y,...b}=_;S=h?Y0(Ab(b),h):b}return mee(l,_.variants,[S],h)}return _?.isProcessed?h?Y0(Ab(_.style),h):_.style:h?Y0(Ab(_),h):_}function mee(l,a,h=[],_=void 0){let S;e:for(let y=0;y<a.length;y+=1){const b=a[y];if(typeof b.props=="function"){if(S??={...l,...l.ownerState,ownerState:l.ownerState},!b.props(S))continue}else for(const D in b.props)if(l[D]!==b.props[D]&&l.ownerState?.[D]!==b.props[D])continue e;typeof b.style=="function"?(S??={...l,...l.ownerState,ownerState:l.ownerState},h.push(_?Y0(Ab(b.style(S)),_):b.style(S))):h.push(_?Y0(Ab(b.style),_):b.style)}return h}function Eee(l={}){const{themeId:a,defaultTheme:h=gae,rootShouldForwardProp:_=Sq,slotShouldForwardProp:S=Sq}=l;function y(D){Tae(D,a,h)}return(D,U={})=>{_oe(D,qe=>qe.filter(Te=>Te!==Pb));const{name:x,slot:q,skipVariantsResolver:J,skipSx:ee,overridesResolver:ue=Sae(Cae(q)),...oe}=U,le=x&&x.startsWith("Mui")||q?"components":"custom",pe=J!==void 0?J:q&&q!=="Root"&&q!=="root"||!1,Ne=ee||!1;let Ve=Sq;q==="Root"||q==="root"?Ve=_:q?Ve=S:Rae(D)&&(Ve=void 0);const Ae=oee(D,{shouldForwardProp:Ve,label:vae(),...oe}),Ue=qe=>{if(qe.__emotion_real===qe)return qe;if(typeof qe=="function")return function(he){return oG(he,qe,he.theme.modularCssLayers?le:void 0)};if(vS(qe)){const Te=_ee(qe);return function(_e){return Te.variants?oG(_e,Te,_e.theme.modularCssLayers?le:void 0):_e.theme.modularCssLayers?Y0(Te.style,le):Te.style}}return qe},ke=(...qe)=>{const Te=[],he=qe.map(Ue),_e=[];if(Te.push(y),x&&ue&&_e.push(function(me){const ct=me.theme.components?.[x]?.styleOverrides;if(!ct)return null;const Me={};for(const Je in ct)Me[Je]=oG(me,ct[Je],me.theme.modularCssLayers?"theme":void 0);return ue(me,Me)}),x&&!pe&&_e.push(function(me){const ct=me.theme?.components?.[x]?.variants;return ct?mee(me,ct,[],me.theme.modularCssLayers?"theme":void 0):null}),Ne||_e.push(Pb),Array.isArray(he[0])){const $=he.shift(),me=new Array(Te.length).fill(""),Xe=new Array(_e.length).fill("");let ct;ct=[...me,...$,...Xe],ct.raw=[...me,...$.raw,...Xe],Te.unshift(ct)}const ye=[...Te,...he,..._e],Ie=Ae(...ye);return D.muiName&&(Ie.muiName=D.muiName),Ie};return Ae.withConfig&&(ke.withConfig=Ae.withConfig),ke}}function vae(l,a){return void 0}function yae(l){for(const a in l)return!1;return!0}function Rae(l){return typeof l=="string"&&l.charCodeAt(0)>96}function Cae(l){return l&&l.charAt(0).toLowerCase()+l.slice(1)}const bae=Eee();function r3(l,a,h=!1){const _={...a};for(const S in l)if(Object.prototype.hasOwnProperty.call(l,S)){const y=S;if(y==="components"||y==="slots")_[y]={...l[y],..._[y]};else if(y==="componentsProps"||y==="slotProps"){const b=l[y],D=a[y];if(!D)_[y]=b||{};else if(!b)_[y]=D;else{_[y]={...D};for(const U in b)if(Object.prototype.hasOwnProperty.call(b,U)){const x=U;_[y][x]=r3(b[x],D[x],h)}}}else y==="className"&&h&&a.className?_.className=Ui(l?.className,a?.className):y==="style"&&h&&a.style?_.style={...l?.style,...a?.style}:_[y]===void 0&&(_[y]=l[y])}return _}function Iae(l){const{theme:a,name:h,props:_}=l;return!a||!a.components||!a.components[h]||!a.components[h].defaultProps?_:r3(a.components[h].defaultProps,_)}function Aae({props:l,name:a,defaultTheme:h,themeId:_}){let S=lW(h);return _&&(S=S[_]||S),Iae({theme:S,name:a,props:l})}const NS=typeof window<"u"?ae.useLayoutEffect:ae.useEffect;function Ak(l,a=Number.MIN_SAFE_INTEGER,h=Number.MAX_SAFE_INTEGER){return Math.max(a,Math.min(l,h))}function eX(l,a=0,h=1){return Ak(l,a,h)}function wae(l){l=l.slice(1);const a=new RegExp(`.{1,${l.length>=6?2:1}}`,"g");let h=l.match(a);return h&&h[0].length===1&&(h=h.map(_=>_+_)),h?`rgb${h.length===4?"a":""}(${h.map((_,S)=>S<3?parseInt(_,16):Math.round(parseInt(_,16)/255*1e3)/1e3).join(", ")})`:""}function kb(l){if(l.type)return l;if(l.charAt(0)==="#")return kb(wae(l));const a=l.indexOf("("),h=l.substring(0,a);if(!["rgb","rgba","hsl","hsla","color"].includes(h))throw new Error(ay(9,l));let _=l.substring(a+1,l.length-1),S;if(h==="color"){if(_=_.split(" "),S=_.shift(),_.length===4&&_[3].charAt(0)==="/"&&(_[3]=_[3].slice(1)),!["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].includes(S))throw new Error(ay(10,S))}else _=_.split(",");return _=_.map(y=>parseFloat(y)),{type:h,values:_,colorSpace:S}}const Oae=l=>{const a=kb(l);return a.values.slice(0,3).map((h,_)=>a.type.includes("hsl")&&_!==0?`${h}%`:h).join(" ")},kj=(l,a)=>{try{return Oae(l)}catch{return l}};function dW(l){const{type:a,colorSpace:h}=l;let{values:_}=l;return a.includes("rgb")?_=_.map((S,y)=>y<3?parseInt(S,10):S):a.includes("hsl")&&(_[1]=`${_[1]}%`,_[2]=`${_[2]}%`),a.includes("color")?_=`${h} ${_.join(" ")}`:_=`${_.join(", ")}`,`${a}(${_})`}function gee(l){l=kb(l);const{values:a}=l,h=a[0],_=a[1]/100,S=a[2]/100,y=_*Math.min(S,1-S),b=(x,q=(x+h/30)%12)=>S-y*Math.max(Math.min(q-3,9-q,1),-1);let D="rgb";const U=[Math.round(b(0)*255),Math.round(b(8)*255),Math.round(b(4)*255)];return l.type==="hsla"&&(D+="a",U.push(a[3])),dW({type:D,values:U})}function Qq(l){l=kb(l);let a=l.type==="hsl"||l.type==="hsla"?kb(gee(l)).values:l.values;return a=a.map(h=>(l.type!=="color"&&(h/=255),h<=.03928?h/12.92:((h+.055)/1.055)**2.4)),Number((.2126*a[0]+.7152*a[1]+.0722*a[2]).toFixed(3))}function Nae(l,a){const h=Qq(l),_=Qq(a);return(Math.max(h,_)+.05)/(Math.min(h,_)+.05)}function SG(l,a){return l=kb(l),a=eX(a),(l.type==="rgb"||l.type==="hsl")&&(l.type+="a"),l.type==="color"?l.values[3]=`/${a}`:l.values[3]=a,dW(l)}function x0(l,a,h){try{return SG(l,a)}catch{return l}}function uW(l,a){if(l=kb(l),a=eX(a),l.type.includes("hsl"))l.values[2]*=1-a;else if(l.type.includes("rgb")||l.type.includes("color"))for(let h=0;h<3;h+=1)l.values[h]*=1-a;return dW(l)}function Zs(l,a,h){try{return uW(l,a)}catch{return l}}function hW(l,a){if(l=kb(l),a=eX(a),l.type.includes("hsl"))l.values[2]+=(100-l.values[2])*a;else if(l.type.includes("rgb"))for(let h=0;h<3;h+=1)l.values[h]+=(255-l.values[h])*a;else if(l.type.includes("color"))for(let h=0;h<3;h+=1)l.values[h]+=(1-l.values[h])*a;return dW(l)}function $s(l,a,h){try{return hW(l,a)}catch{return l}}function Dae(l,a=.15){return Qq(l)>.5?uW(l,a):hW(l,a)}function j6(l,a,h){try{return Dae(l,a)}catch{return l}}const See=ae.createContext(null);function tX(){return ae.useContext(See)}const Pae=typeof Symbol=="function"&&Symbol.for,kae=Pae?Symbol.for("mui.nested"):"__THEME_NESTED__";function Lae(l,a){return typeof a=="function"?a(l):{...l,...a}}function Mae(l){const{children:a,theme:h}=l,_=tX(),S=ae.useMemo(()=>{const y=_===null?{...h}:Lae(_,h);return y!=null&&(y[kae]=_!==null),y},[h,_]);return ze.jsx(See.Provider,{value:S,children:a})}const Tee=ae.createContext();function Uae({value:l,...a}){return ze.jsx(Tee.Provider,{value:l??!0,...a})}const vee=()=>ae.useContext(Tee)??!1,yee=ae.createContext(void 0);function xae({value:l,children:a}){return ze.jsx(yee.Provider,{value:l,children:a})}function Vae(l){const{theme:a,name:h,props:_}=l;if(!a||!a.components||!a.components[h])return _;const S=a.components[h];return S.defaultProps?r3(S.defaultProps,_,a.components.mergeClassNameAndStyle):!S.styleOverrides&&!S.variants?r3(S,_,a.components.mergeClassNameAndStyle):_}function Fae({props:l,name:a}){const h=ae.useContext(yee);return Vae({props:l,name:a,theme:{components:h}})}let dQ=0;function Bae(l){const[a,h]=ae.useState(l),_=l||a;return ae.useEffect(()=>{a==null&&(dQ+=1,h(`mui-${dQ}`))},[a]),_}const jae={...Wq},uQ=jae.useId;function pW(l){if(uQ!==void 0){const a=uQ();return l??a}return Bae(l)}function Gae(l){const a=$7(),h=pW()||"",{modularCssLayers:_}=l;let S="mui.global, mui.components, mui.theme, mui.custom, mui.sx";return!_||a!==null?S="":typeof _=="string"?S=_.replace(/mui(?!\.)/g,S):S=`@layer ${S};`,NS(()=>{const y=document.querySelector("head");if(!y)return;const b=y.firstChild;if(S){if(b&&b.hasAttribute?.("data-mui-layer-order")&&b.getAttribute("data-mui-layer-order")===h)return;const D=document.createElement("style");D.setAttribute("data-mui-layer-order",h),D.textContent=S,y.prepend(D)}else y.querySelector(`style[data-mui-layer-order="${h}"]`)?.remove()},[S,h]),S?ze.jsx(uee,{styles:S}):null}const hQ={};function pQ(l,a,h,_=!1){return ae.useMemo(()=>{const S=l&&a[l]||a;if(typeof h=="function"){const y=h(S),b=l?{...a,[l]:y}:y;return _?()=>b:b}return l?{...a,[l]:h}:{...a,...h}},[l,a,h,_])}function Ree(l){const{children:a,theme:h,themeId:_}=l,S=$7(hQ),y=tX()||hQ,b=pQ(_,S,h),D=pQ(_,y,h,!0),U=(_?b[_]:b).direction==="rtl",x=Gae(b);return ze.jsx(Mae,{theme:D,children:ze.jsx(y3.Provider,{value:b,children:ze.jsx(Uae,{value:U,children:ze.jsxs(xae,{value:_?b[_].components:b.components,children:[x,a]})})})})}const fQ={theme:void 0};function Wae(l){let a,h;return function(S){let y=a;return(y===void 0||S.theme!==h)&&(fQ.theme=S.theme,y=_ee(l(fQ)),a=y,h=S.theme),y}}const nX="mode",iX="color-scheme",Hae="data-color-scheme";function Kae(l){const{defaultMode:a="system",defaultLightColorScheme:h="light",defaultDarkColorScheme:_="dark",modeStorageKey:S=nX,colorSchemeStorageKey:y=iX,attribute:b=Hae,colorSchemeNode:D="document.documentElement",nonce:U}=l||{};let x="",q=b;if(b==="class"&&(q=".%s"),b==="data"&&(q="[data-%s]"),q.startsWith(".")){const ee=q.substring(1);x+=`${D}.classList.remove('${ee}'.replace('%s', light), '${ee}'.replace('%s', dark));
      ${D}.classList.add('${ee}'.replace('%s', colorScheme));`}const J=q.match(/\[([^[\]]+)\]/);if(J){const[ee,ue]=J[1].split("=");ue||(x+=`${D}.removeAttribute('${ee}'.replace('%s', light));
      ${D}.removeAttribute('${ee}'.replace('%s', dark));`),x+=`
      ${D}.setAttribute('${ee}'.replace('%s', colorScheme), ${ue?`${ue}.replace('%s', colorScheme)`:'""'});`}else x+=`${D}.setAttribute('${q}', colorScheme);`;return ze.jsx("script",{suppressHydrationWarning:!0,nonce:typeof window>"u"?U:"",dangerouslySetInnerHTML:{__html:`(function() {
try {
  let colorScheme = '';
  const mode = localStorage.getItem('${S}') || '${a}';
  const dark = localStorage.getItem('${y}-dark') || '${_}';
  const light = localStorage.getItem('${y}-light') || '${h}';
  if (mode === 'system') {
    // handle system mode
    const mql = window.matchMedia('(prefers-color-scheme: dark)');
    if (mql.matches) {
      colorScheme = dark
    } else {
      colorScheme = light
    }
  }
  if (mode === 'light') {
    colorScheme = light;
  }
  if (mode === 'dark') {
    colorScheme = dark;
  }
  if (colorScheme) {
    ${x}
  }
} catch(e){}})();`}},"mui-color-scheme-init")}function zae(){}const Yae=({key:l,storageWindow:a})=>(!a&&typeof window<"u"&&(a=window),{get(h){if(typeof window>"u")return;if(!a)return h;let _;try{_=a.localStorage.getItem(l)}catch{}return _||h},set:h=>{if(a)try{a.localStorage.setItem(l,h)}catch{}},subscribe:h=>{if(!a)return zae;const _=S=>{const y=S.newValue;S.key===l&&h(y)};return a.addEventListener("storage",_),()=>{a.removeEventListener("storage",_)}}});function Tq(){}function _Q(l){if(typeof window<"u"&&typeof window.matchMedia=="function"&&l==="system")return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function Cee(l,a){if(l.mode==="light"||l.mode==="system"&&l.systemMode==="light")return a("light");if(l.mode==="dark"||l.mode==="system"&&l.systemMode==="dark")return a("dark")}function qae(l){return Cee(l,a=>{if(a==="light")return l.lightColorScheme;if(a==="dark")return l.darkColorScheme})}function Xae(l){const{defaultMode:a="light",defaultLightColorScheme:h,defaultDarkColorScheme:_,supportedColorSchemes:S=[],modeStorageKey:y=nX,colorSchemeStorageKey:b=iX,storageWindow:D=typeof window>"u"?void 0:window,storageManager:U=Yae,noSsr:x=!1}=l,q=S.join(","),J=S.length>1,ee=ae.useMemo(()=>U?.({key:y,storageWindow:D}),[U,y,D]),ue=ae.useMemo(()=>U?.({key:`${b}-light`,storageWindow:D}),[U,b,D]),oe=ae.useMemo(()=>U?.({key:`${b}-dark`,storageWindow:D}),[U,b,D]),[le,pe]=ae.useState(()=>{const he=ee?.get(a)||a,_e=ue?.get(h)||h,ye=oe?.get(_)||_;return{mode:he,systemMode:_Q(he),lightColorScheme:_e,darkColorScheme:ye}}),[Ne,Ve]=ae.useState(x||!J);ae.useEffect(()=>{Ve(!0)},[]);const Ae=qae(le),Ue=ae.useCallback(he=>{pe(_e=>{if(he===_e.mode)return _e;const ye=he??a;return ee?.set(ye),{..._e,mode:ye,systemMode:_Q(ye)}})},[ee,a]),ke=ae.useCallback(he=>{he?typeof he=="string"?he&&!q.includes(he)?console.error(`\`${he}\` does not exist in \`theme.colorSchemes\`.`):pe(_e=>{const ye={..._e};return Cee(_e,Ie=>{Ie==="light"&&(ue?.set(he),ye.lightColorScheme=he),Ie==="dark"&&(oe?.set(he),ye.darkColorScheme=he)}),ye}):pe(_e=>{const ye={..._e},Ie=he.light===null?h:he.light,$=he.dark===null?_:he.dark;return Ie&&(q.includes(Ie)?(ye.lightColorScheme=Ie,ue?.set(Ie)):console.error(`\`${Ie}\` does not exist in \`theme.colorSchemes\`.`)),$&&(q.includes($)?(ye.darkColorScheme=$,oe?.set($)):console.error(`\`${$}\` does not exist in \`theme.colorSchemes\`.`)),ye}):pe(_e=>(ue?.set(h),oe?.set(_),{..._e,lightColorScheme:h,darkColorScheme:_}))},[q,ue,oe,h,_]),qe=ae.useCallback(he=>{le.mode==="system"&&pe(_e=>{const ye=he?.matches?"dark":"light";return _e.systemMode===ye?_e:{..._e,systemMode:ye}})},[le.mode]),Te=ae.useRef(qe);return Te.current=qe,ae.useEffect(()=>{if(typeof window.matchMedia!="function"||!J)return;const he=(...ye)=>Te.current(...ye),_e=window.matchMedia("(prefers-color-scheme: dark)");return _e.addListener(he),he(_e),()=>{_e.removeListener(he)}},[J]),ae.useEffect(()=>{if(J){const he=ee?.subscribe(Ie=>{(!Ie||["light","dark","system"].includes(Ie))&&Ue(Ie||a)})||Tq,_e=ue?.subscribe(Ie=>{(!Ie||q.match(Ie))&&ke({light:Ie})})||Tq,ye=oe?.subscribe(Ie=>{(!Ie||q.match(Ie))&&ke({dark:Ie})})||Tq;return()=>{he(),_e(),ye()}}},[ke,Ue,q,a,D,J,ee,ue,oe]),{...le,mode:Ne?le.mode:void 0,systemMode:Ne?le.systemMode:void 0,colorScheme:Ne?Ae:void 0,setMode:Ue,setColorScheme:ke}}const Jae="*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}";function Qae(l){const{themeId:a,theme:h={},modeStorageKey:_=nX,colorSchemeStorageKey:S=iX,disableTransitionOnChange:y=!1,defaultColorScheme:b,resolveTheme:D}=l,U={allColorSchemes:[],colorScheme:void 0,darkColorScheme:void 0,lightColorScheme:void 0,mode:void 0,setColorScheme:()=>{},setMode:()=>{},systemMode:void 0},x=ae.createContext(void 0),q=()=>ae.useContext(x)||U,J={},ee={};function ue(Ne){const{children:Ve,theme:Ae,modeStorageKey:Ue=_,colorSchemeStorageKey:ke=S,disableTransitionOnChange:qe=y,storageManager:Te,storageWindow:he=typeof window>"u"?void 0:window,documentNode:_e=typeof document>"u"?void 0:document,colorSchemeNode:ye=typeof document>"u"?void 0:document.documentElement,disableNestedContext:Ie=!1,disableStyleSheetGeneration:$=!1,defaultMode:me="system",forceThemeRerender:Xe=!1,noSsr:ct}=Ne,Me=ae.useRef(!1),Je=tX(),mt=ae.useContext(x),yt=!!mt&&!Ie,xe=ae.useMemo(()=>Ae||(typeof h=="function"?h():h),[Ae]),it=xe[a],ft=it||xe,{colorSchemes:pt=J,components:xt=ee,cssVarPrefix:ln}=ft,pn=Object.keys(pt).filter(wt=>!!pt[wt]).join(","),Zn=ae.useMemo(()=>pn.split(","),[pn]),ri=typeof b=="string"?b:b.light,si=typeof b=="string"?b:b.dark,En=pt[ri]&&pt[si]?me:pt[ft.defaultColorScheme]?.palette?.mode||ft.palette?.mode,{mode:oi,setMode:ui,systemMode:Kn,lightColorScheme:qn,darkColorScheme:Zi,colorScheme:Gi,setColorScheme:yi}=Xae({supportedColorSchemes:Zn,defaultLightColorScheme:ri,defaultDarkColorScheme:si,modeStorageKey:Ue,colorSchemeStorageKey:ke,defaultMode:En,storageManager:Te,storageWindow:he,noSsr:ct});let vn=oi,xn=Gi;yt&&(vn=mt.mode,xn=mt.colorScheme);let ir=xn||ft.defaultColorScheme;ft.vars&&!Xe&&(ir=ft.defaultColorScheme);const Bi=ae.useMemo(()=>{const wt=ft.generateThemeVars?.()||ft.vars,Ot={...ft,components:xt,colorSchemes:pt,cssVarPrefix:ln,vars:wt};if(typeof Ot.generateSpacing=="function"&&(Ot.spacing=Ot.generateSpacing()),ir){const un=pt[ir];un&&typeof un=="object"&&Object.keys(un).forEach(rn=>{un[rn]&&typeof un[rn]=="object"?Ot[rn]={...Ot[rn],...un[rn]}:Ot[rn]=un[rn]})}return D?D(Ot):Ot},[ft,ir,xt,pt,ln]),Sn=ft.colorSchemeSelector;NS(()=>{if(xn&&ye&&Sn&&Sn!=="media"){const wt=Sn;let Ot=Sn;if(wt==="class"&&(Ot=".%s"),wt==="data"&&(Ot="[data-%s]"),wt?.startsWith("data-")&&!wt.includes("%s")&&(Ot=`[${wt}="%s"]`),Ot.startsWith("."))ye.classList.remove(...Zn.map(un=>Ot.substring(1).replace("%s",un))),ye.classList.add(Ot.substring(1).replace("%s",xn));else{const un=Ot.replace("%s",xn).match(/\[([^\]]+)\]/);if(un){const[rn,Vn]=un[1].split("=");Vn||Zn.forEach(Ci=>{ye.removeAttribute(rn.replace(xn,Ci))}),ye.setAttribute(rn,Vn?Vn.replace(/"|'/g,""):"")}else ye.setAttribute(Ot,xn)}}},[xn,Sn,ye,Zn]),ae.useEffect(()=>{let wt;if(qe&&Me.current&&_e){const Ot=_e.createElement("style");Ot.appendChild(_e.createTextNode(Jae)),_e.head.appendChild(Ot),window.getComputedStyle(_e.body),wt=setTimeout(()=>{_e.head.removeChild(Ot)},1)}return()=>{clearTimeout(wt)}},[xn,qe,_e]),ae.useEffect(()=>(Me.current=!0,()=>{Me.current=!1}),[]);const Us=ae.useMemo(()=>({allColorSchemes:Zn,colorScheme:xn,darkColorScheme:Zi,lightColorScheme:qn,mode:vn,setColorScheme:yi,setMode:ui,systemMode:Kn}),[Zn,xn,Zi,qn,vn,yi,ui,Kn,Bi.colorSchemeSelector]);let Rn=!0;($||ft.cssVariables===!1||yt&&Je?.cssVarPrefix===ln)&&(Rn=!1);const Kt=ze.jsxs(ae.Fragment,{children:[ze.jsx(Ree,{themeId:it?a:void 0,theme:Bi,children:Ve}),Rn&&ze.jsx(see,{styles:Bi.generateStyleSheets?.()||[]})]});return yt?Kt:ze.jsx(x.Provider,{value:Us,children:Kt})}const oe=typeof b=="string"?b:b.light,le=typeof b=="string"?b:b.dark;return{CssVarsProvider:ue,useColorScheme:q,getInitColorSchemeScript:Ne=>Kae({colorSchemeStorageKey:S,defaultLightColorScheme:oe,defaultDarkColorScheme:le,modeStorageKey:_,...Ne})}}function Zae(l=""){function a(..._){if(!_.length)return"";const S=_[0];return typeof S=="string"&&!S.match(/(#|\(|\)|(-?(\d*\.)?\d+)(px|em|%|ex|ch|rem|vw|vh|vmin|vmax|cm|mm|in|pt|pc))|^(-?(\d*\.)?\d+)$|(\d+ \d+ \d+)/)?`, var(--${l?`${l}-`:""}${S}${a(..._.slice(1))})`:`, ${S}`}return(_,...S)=>`var(--${l?`${l}-`:""}${_}${a(...S)})`}const mQ=(l,a,h,_=[])=>{let S=l;a.forEach((y,b)=>{b===a.length-1?Array.isArray(S)?S[Number(y)]=h:S&&typeof S=="object"&&(S[y]=h):S&&typeof S=="object"&&(S[y]||(S[y]=_.includes(y)?[]:{}),S=S[y])})},$ae=(l,a,h)=>{function _(S,y=[],b=[]){Object.entries(S).forEach(([D,U])=>{(!h||h&&!h([...y,D]))&&U!=null&&(typeof U=="object"&&Object.keys(U).length>0?_(U,[...y,D],Array.isArray(U)?[...b,D]:b):a([...y,D],U,b))})}_(l)},ece=(l,a)=>typeof a=="number"?["lineHeight","fontWeight","opacity","zIndex"].some(_=>l.includes(_))||l[l.length-1].toLowerCase().includes("opacity")?a:`${a}px`:a;function vq(l,a){const{prefix:h,shouldSkipGeneratingVar:_}=a||{},S={},y={},b={};return $ae(l,(D,U,x)=>{if((typeof U=="string"||typeof U=="number")&&(!_||!_(D,U))){const q=`--${h?`${h}-`:""}${D.join("-")}`,J=ece(D,U);Object.assign(S,{[q]:J}),mQ(y,D,`var(${q})`,x),mQ(b,D,`var(${q}, ${J})`,x)}},D=>D[0]==="vars"),{css:S,vars:y,varsWithDefaults:b}}function tce(l,a={}){const{getSelector:h=Ne,disableCssColorScheme:_,colorSchemeSelector:S,enableContrastVars:y}=a,{colorSchemes:b={},components:D,defaultColorScheme:U="light",...x}=l,{vars:q,css:J,varsWithDefaults:ee}=vq(x,a);let ue=ee;const oe={},{[U]:le,...pe}=b;if(Object.entries(pe||{}).forEach(([Ue,ke])=>{const{vars:qe,css:Te,varsWithDefaults:he}=vq(ke,a);ue=zd(ue,he),oe[Ue]={css:Te,vars:qe}}),le){const{css:Ue,vars:ke,varsWithDefaults:qe}=vq(le,a);ue=zd(ue,qe),oe[U]={css:Ue,vars:ke}}function Ne(Ue,ke){let qe=S;if(S==="class"&&(qe=".%s"),S==="data"&&(qe="[data-%s]"),S?.startsWith("data-")&&!S.includes("%s")&&(qe=`[${S}="%s"]`),Ue){if(qe==="media")return l.defaultColorScheme===Ue?":root":{[`@media (prefers-color-scheme: ${b[Ue]?.palette?.mode||Ue})`]:{":root":ke}};if(qe)return l.defaultColorScheme===Ue?`:root, ${qe.replace("%s",String(Ue))}`:qe.replace("%s",String(Ue))}return":root"}return{vars:ue,generateThemeVars:()=>{let Ue={...q};return Object.entries(oe).forEach(([,{vars:ke}])=>{Ue=zd(Ue,ke)}),Ue},generateStyleSheets:()=>{const Ue=[],ke=l.defaultColorScheme||"light";function qe(_e,ye){Object.keys(ye).length&&Ue.push(typeof _e=="string"?{[_e]:{...ye}}:_e)}qe(h(void 0,{...J}),J);const{[ke]:Te,...he}=oe;if(Te){const{css:_e}=Te,ye=b[ke]?.palette?.mode,Ie=!_&&ye?{colorScheme:ye,..._e}:{..._e};qe(h(ke,{...Ie}),Ie)}return Object.entries(he).forEach(([_e,{css:ye}])=>{const Ie=b[_e]?.palette?.mode,$=!_&&Ie?{colorScheme:Ie,...ye}:{...ye};qe(h(_e,{...$}),$)}),y&&Ue.push({":root":{"--__l-threshold":"0.7","--__l":"clamp(0, (l / var(--__l-threshold) - 1) * -infinity, 1)","--__a":"clamp(0.87, (l / var(--__l-threshold) - 1) * -infinity, 1)"}}),Ue}}}function nce(l){return function(h){return l==="media"?`@media (prefers-color-scheme: ${h})`:l?l.startsWith("data-")&&!l.includes("%s")?`[${l}="${h}"] &`:l==="class"?`.${h} &`:l==="data"?`[data-${h}] &`:`${l.replace("%s",h)} &`:"&"}}function bo(l,a,h=void 0){const _={};for(const S in l){const y=l[S];let b="",D=!0;for(let U=0;U<y.length;U+=1){const x=y[U];x&&(b+=(D===!0?"":" ")+a(x),D=!1,h&&h[x]&&(b+=" "+h[x]))}_[S]=b}return _}const ice=cW(),rce=bae("div",{name:"MuiContainer",slot:"Root",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[a.root,a[`maxWidth${_i(String(h.maxWidth))}`],h.fixed&&a.fixed,h.disableGutters&&a.disableGutters]}}),sce=l=>Aae({props:l,name:"MuiContainer",defaultTheme:ice}),oce=(l,a)=>{const h=U=>Ro(a,U),{classes:_,fixed:S,disableGutters:y,maxWidth:b}=l,D={root:["root",b&&`maxWidth${_i(String(b))}`,S&&"fixed",y&&"disableGutters"]};return bo(D,h,_)};function ace(l={}){const{createStyledComponent:a=rce,useThemeProps:h=sce,componentName:_="MuiContainer"}=l,S=a(({theme:b,ownerState:D})=>({width:"100%",marginLeft:"auto",boxSizing:"border-box",marginRight:"auto",...!D.disableGutters&&{paddingLeft:b.spacing(2),paddingRight:b.spacing(2),[b.breakpoints.up("sm")]:{paddingLeft:b.spacing(3),paddingRight:b.spacing(3)}}}),({theme:b,ownerState:D})=>D.fixed&&Object.keys(b.breakpoints.values).reduce((U,x)=>{const q=x,J=b.breakpoints.values[q];return J!==0&&(U[b.breakpoints.up(q)]={maxWidth:`${J}${b.breakpoints.unit}`}),U},{}),({theme:b,ownerState:D})=>({...D.maxWidth==="xs"&&{[b.breakpoints.up("xs")]:{maxWidth:Math.max(b.breakpoints.values.xs,444)}},...D.maxWidth&&D.maxWidth!=="xs"&&{[b.breakpoints.up(D.maxWidth)]:{maxWidth:`${b.breakpoints.values[D.maxWidth]}${b.breakpoints.unit}`}}}));return ae.forwardRef(function(D,U){const x=h(D),{className:q,component:J="div",disableGutters:ee=!1,fixed:ue=!1,maxWidth:oe="lg",classes:le,...pe}=x,Ne={...x,component:J,disableGutters:ee,fixed:ue,maxWidth:oe},Ve=oce(Ne,_);return ze.jsx(S,{as:J,ownerState:Ne,className:Ui(Ve.root,q),ref:U,...pe})})}function yq(l,a){return ae.isValidElement(l)&&a.indexOf(l.type.muiName??l.type?._payload?.value?.muiName)!==-1}function bee(){return{text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:e3.white,default:e3.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}}}const Iee=bee();function Aee(){return{text:{primary:e3.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:e3.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}}}const Zq=Aee();function EQ(l,a,h,_){const S=_.light||_,y=_.dark||_*1.5;l[a]||(l.hasOwnProperty(h)?l[a]=l[h]:a==="light"?l.light=hW(l.main,S):a==="dark"&&(l.dark=uW(l.main,y)))}function gQ(l,a,h,_,S){const y=S.light||S,b=S.dark||S*1.5;a[h]||(a.hasOwnProperty(_)?a[h]=a[_]:h==="light"?a.light=`color-mix(in ${l}, ${a.main}, #fff ${(y*100).toFixed(0)}%)`:h==="dark"&&(a.dark=`color-mix(in ${l}, ${a.main}, #000 ${(b*100).toFixed(0)}%)`))}function cce(l="light"){return l==="dark"?{main:vk[200],light:vk[50],dark:vk[400]}:{main:vk[700],light:vk[400],dark:vk[800]}}function lce(l="light"){return l==="dark"?{main:Tk[200],light:Tk[50],dark:Tk[400]}:{main:Tk[500],light:Tk[300],dark:Tk[700]}}function dce(l="light"){return l==="dark"?{main:Sk[500],light:Sk[300],dark:Sk[700]}:{main:Sk[700],light:Sk[400],dark:Sk[800]}}function uce(l="light"){return l==="dark"?{main:yk[400],light:yk[300],dark:yk[700]}:{main:yk[700],light:yk[500],dark:yk[900]}}function hce(l="light"){return l==="dark"?{main:Rk[400],light:Rk[300],dark:Rk[700]}:{main:Rk[800],light:Rk[500],dark:Rk[900]}}function pce(l="light"){return l==="dark"?{main:Cj[400],light:Cj[300],dark:Cj[700]}:{main:"#ed6c02",light:Cj[500],dark:Cj[900]}}function fce(l){return`oklch(from ${l} var(--__l) 0 h / var(--__a))`}function rX(l){const{mode:a="light",contrastThreshold:h=3,tonalOffset:_=.2,colorSpace:S,...y}=l,b=l.primary||cce(a),D=l.secondary||lce(a),U=l.error||dce(a),x=l.info||uce(a),q=l.success||hce(a),J=l.warning||pce(a);function ee(pe){return S?fce(pe):Nae(pe,Zq.text.primary)>=h?Zq.text.primary:Iee.text.primary}const ue=({color:pe,name:Ne,mainShade:Ve=500,lightShade:Ae=300,darkShade:Ue=700})=>{if(pe={...pe},!pe.main&&pe[Ve]&&(pe.main=pe[Ve]),!pe.hasOwnProperty("main"))throw new Error(ay(11,Ne?` (${Ne})`:"",Ve));if(typeof pe.main!="string")throw new Error(ay(12,Ne?` (${Ne})`:"",JSON.stringify(pe.main)));return S?(gQ(S,pe,"light",Ae,_),gQ(S,pe,"dark",Ue,_)):(EQ(pe,"light",Ae,_),EQ(pe,"dark",Ue,_)),pe.contrastText||(pe.contrastText=ee(pe.main)),pe};let oe;return a==="light"?oe=bee():a==="dark"&&(oe=Aee()),zd({common:{...e3},mode:a,primary:ue({color:b,name:"primary"}),secondary:ue({color:D,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:ue({color:U,name:"error"}),warning:ue({color:J,name:"warning"}),info:ue({color:x,name:"info"}),success:ue({color:q,name:"success"}),grey:mse,contrastThreshold:h,getContrastText:ee,augmentColor:ue,tonalOffset:_,...oe},y)}function _ce(l){const a={};return Object.entries(l).forEach(_=>{const[S,y]=_;typeof y=="object"&&(a[S]=`${y.fontStyle?`${y.fontStyle} `:""}${y.fontVariant?`${y.fontVariant} `:""}${y.fontWeight?`${y.fontWeight} `:""}${y.fontStretch?`${y.fontStretch} `:""}${y.fontSize||""}${y.lineHeight?`/${y.lineHeight} `:""}${y.fontFamily||""}`)}),a}function mce(l,a){return{toolbar:{minHeight:56,[l.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[l.up("sm")]:{minHeight:64}},...a}}function Ece(l){return Math.round(l*1e5)/1e5}const SQ={textTransform:"uppercase"},TQ='"Roboto", "Helvetica", "Arial", sans-serif';function wee(l,a){const{fontFamily:h=TQ,fontSize:_=14,fontWeightLight:S=300,fontWeightRegular:y=400,fontWeightMedium:b=500,fontWeightBold:D=700,htmlFontSize:U=16,allVariants:x,pxToRem:q,...J}=typeof a=="function"?a(l):a,ee=_/14,ue=q||(pe=>`${pe/U*ee}rem`),oe=(pe,Ne,Ve,Ae,Ue)=>({fontFamily:h,fontWeight:pe,fontSize:ue(Ne),lineHeight:Ve,...h===TQ?{letterSpacing:`${Ece(Ae/Ne)}em`}:{},...Ue,...x}),le={h1:oe(S,96,1.167,-1.5),h2:oe(S,60,1.2,-.5),h3:oe(y,48,1.167,0),h4:oe(y,34,1.235,.25),h5:oe(y,24,1.334,0),h6:oe(b,20,1.6,.15),subtitle1:oe(y,16,1.75,.15),subtitle2:oe(b,14,1.57,.1),body1:oe(y,16,1.5,.15),body2:oe(y,14,1.43,.15),button:oe(b,14,1.75,.4,SQ),caption:oe(y,12,1.66,.4),overline:oe(y,12,2.66,1,SQ),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return zd({htmlFontSize:U,pxToRem:ue,fontFamily:h,fontSize:_,fontWeightLight:S,fontWeightRegular:y,fontWeightMedium:b,fontWeightBold:D,...le},J,{clone:!1})}const gce=.2,Sce=.14,Tce=.12;function ga(...l){return[`${l[0]}px ${l[1]}px ${l[2]}px ${l[3]}px rgba(0,0,0,${gce})`,`${l[4]}px ${l[5]}px ${l[6]}px ${l[7]}px rgba(0,0,0,${Sce})`,`${l[8]}px ${l[9]}px ${l[10]}px ${l[11]}px rgba(0,0,0,${Tce})`].join(",")}const vce=["none",ga(0,2,1,-1,0,1,1,0,0,1,3,0),ga(0,3,1,-2,0,2,2,0,0,1,5,0),ga(0,3,3,-2,0,3,4,0,0,1,8,0),ga(0,2,4,-1,0,4,5,0,0,1,10,0),ga(0,3,5,-1,0,5,8,0,0,1,14,0),ga(0,3,5,-1,0,6,10,0,0,1,18,0),ga(0,4,5,-2,0,7,10,1,0,2,16,1),ga(0,5,5,-3,0,8,10,1,0,3,14,2),ga(0,5,6,-3,0,9,12,1,0,3,16,2),ga(0,6,6,-3,0,10,14,1,0,4,18,3),ga(0,6,7,-4,0,11,15,1,0,4,20,3),ga(0,7,8,-4,0,12,17,2,0,5,22,4),ga(0,7,8,-4,0,13,19,2,0,5,24,4),ga(0,7,9,-4,0,14,21,2,0,5,26,4),ga(0,8,9,-5,0,15,22,2,0,6,28,5),ga(0,8,10,-5,0,16,24,2,0,6,30,5),ga(0,8,11,-5,0,17,26,2,0,6,32,5),ga(0,9,11,-5,0,18,28,2,0,7,34,6),ga(0,9,12,-6,0,19,29,2,0,7,36,6),ga(0,10,13,-6,0,20,31,3,0,8,38,7),ga(0,10,13,-6,0,21,33,3,0,8,40,7),ga(0,10,14,-6,0,22,35,3,0,8,42,7),ga(0,11,14,-7,0,23,36,3,0,9,44,8),ga(0,11,15,-7,0,24,38,3,0,9,46,8)],yce={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},Rce={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function vQ(l){return`${Math.round(l)}ms`}function Cce(l){if(!l)return 0;const a=l/36;return Math.min(Math.round((4+15*a**.25+a/5)*10),3e3)}function bce(l){const a={...yce,...l.easing},h={...Rce,...l.duration};return{getAutoHeightDuration:Cce,create:(S=["all"],y={})=>{const{duration:b=h.standard,easing:D=a.easeInOut,delay:U=0,...x}=y;return(Array.isArray(S)?S:[S]).map(q=>`${q} ${typeof b=="string"?b:vQ(b)} ${D} ${typeof U=="string"?U:vQ(U)}`).join(",")},...l,easing:a,duration:h}}const Ice={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500};function Ace(l){return vS(l)||typeof l>"u"||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||Array.isArray(l)}function Oee(l={}){const a={...l};function h(_){const S=Object.entries(_);for(let y=0;y<S.length;y++){const[b,D]=S[y];!Ace(D)||b.startsWith("unstable_")?delete _[b]:vS(D)&&(_[b]={...D},h(_[b]))}}return h(a),`import { unstable_createBreakpoints as createBreakpoints, createTransitions } from '@mui/material/styles';

const theme = ${JSON.stringify(a,null,2)};

theme.breakpoints = createBreakpoints(theme.breakpoints || {});
theme.transitions = createTransitions(theme.transitions || {});

export default theme;`}function yQ(l){return typeof l=="number"?`${(l*100).toFixed(0)}%`:`calc((${l}) * 100%)`}const wce=l=>{if(!Number.isNaN(+l))return+l;const a=l.match(/\d*\.?\d+/g);if(!a)return 0;let h=0;for(let _=0;_<a.length;_+=1)h+=+a[_];return h};function Oce(l){Object.assign(l,{alpha(a,h){const _=this||l;return _.colorSpace?`oklch(from ${a} l c h / ${typeof h=="string"?`calc(${h})`:h})`:_.vars?`rgba(${a.replace(/var\(--([^,\s)]+)(?:,[^)]+)?\)+/g,"var(--$1Channel)")} / ${typeof h=="string"?`calc(${h})`:h})`:SG(a,wce(h))},lighten(a,h){const _=this||l;return _.colorSpace?`color-mix(in ${_.colorSpace}, ${a}, #fff ${yQ(h)})`:hW(a,h)},darken(a,h){const _=this||l;return _.colorSpace?`color-mix(in ${_.colorSpace}, ${a}, #000 ${yQ(h)})`:uW(a,h)}})}function $q(l={},...a){const{breakpoints:h,mixins:_={},spacing:S,palette:y={},transitions:b={},typography:D={},shape:U,colorSpace:x,...q}=l;if(l.vars&&l.generateThemeVars===void 0)throw new Error(ay(20));const J=rX({...y,colorSpace:x}),ee=cW(l);let ue=zd(ee,{mixins:mce(ee.breakpoints,_),palette:J,shadows:vce.slice(),typography:wee(J,D),transitions:bce(b),zIndex:{...Ice}});return ue=zd(ue,q),ue=a.reduce((oe,le)=>zd(oe,le),ue),ue.unstable_sxConfig={...I3,...q?.unstable_sxConfig},ue.unstable_sx=function(le){return Pb({sx:le,theme:this})},ue.toRuntimeSource=Oee,Oce(ue),ue}function e7(l){let a;return l<1?a=5.11916*l**2:a=4.5*Math.log(l+1)+2,Math.round(a*10)/1e3}const Nce=[...Array(25)].map((l,a)=>{if(a===0)return"none";const h=e7(a);return`linear-gradient(rgba(255 255 255 / ${h}), rgba(255 255 255 / ${h}))`});function Nee(l){return{inputPlaceholder:l==="dark"?.5:.42,inputUnderline:l==="dark"?.7:.42,switchTrackDisabled:l==="dark"?.2:.12,switchTrack:l==="dark"?.3:.38}}function Dee(l){return l==="dark"?Nce:[]}function Dce(l){const{palette:a={mode:"light"},opacity:h,overlays:_,colorSpace:S,...y}=l,b=rX({...a,colorSpace:S});return{palette:b,opacity:{...Nee(b.mode),...h},overlays:_||Dee(b.mode),...y}}function Pce(l){return!!l[0].match(/(cssVarPrefix|colorSchemeSelector|modularCssLayers|rootSelector|typography|mixins|breakpoints|direction|transitions)/)||!!l[0].match(/sxConfig$/)||l[0]==="palette"&&!!l[1]?.match(/(mode|contrastThreshold|tonalOffset)/)}const kce=l=>[...[...Array(25)].map((a,h)=>`--${l?`${l}-`:""}overlays-${h}`),`--${l?`${l}-`:""}palette-AppBar-darkBg`,`--${l?`${l}-`:""}palette-AppBar-darkColor`],Lce=l=>(a,h)=>{const _=l.rootSelector||":root",S=l.colorSchemeSelector;let y=S;if(S==="class"&&(y=".%s"),S==="data"&&(y="[data-%s]"),S?.startsWith("data-")&&!S.includes("%s")&&(y=`[${S}="%s"]`),l.defaultColorScheme===a){if(a==="dark"){const b={};return kce(l.cssVarPrefix).forEach(D=>{b[D]=h[D],delete h[D]}),y==="media"?{[_]:h,"@media (prefers-color-scheme: dark)":{[_]:b}}:y?{[y.replace("%s",a)]:b,[`${_}, ${y.replace("%s",a)}`]:h}:{[_]:{...h,...b}}}if(y&&y!=="media")return`${_}, ${y.replace("%s",String(a))}`}else if(a){if(y==="media")return{[`@media (prefers-color-scheme: ${String(a)})`]:{[_]:h}};if(y)return y.replace("%s",String(a))}return _};function Mce(l,a){a.forEach(h=>{l[h]||(l[h]={})})}function Rt(l,a,h){!l[a]&&h&&(l[a]=h)}function Lj(l){return typeof l!="string"||!l.startsWith("hsl")?l:gee(l)}function Jv(l,a){`${a}Channel`in l||(l[`${a}Channel`]=kj(Lj(l[a])))}function Uce(l){return typeof l=="number"?`${l}px`:typeof l=="string"||typeof l=="function"||Array.isArray(l)?l:"8px"}const fS=l=>{try{return l()}catch{}},xce=(l="mui")=>Zae(l);function Rq(l,a,h,_,S){if(!h)return;h=h===!0?{}:h;const y=S==="dark"?"dark":"light";if(!_){a[S]=Dce({...h,palette:{mode:y,...h?.palette},colorSpace:l});return}const{palette:b,...D}=$q({..._,palette:{mode:y,...h?.palette},colorSpace:l});return a[S]={...h,palette:b,opacity:{...Nee(y),...h?.opacity},overlays:h?.overlays||Dee(y)},D}function Vce(l={},...a){const{colorSchemes:h={light:!0},defaultColorScheme:_,disableCssColorScheme:S=!1,cssVarPrefix:y="mui",nativeColor:b=!1,shouldSkipGeneratingVar:D=Pce,colorSchemeSelector:U=h.light&&h.dark?"media":void 0,rootSelector:x=":root",...q}=l,J=Object.keys(h)[0],ee=_||(h.light&&J!=="light"?"light":J),ue=xce(y),{[ee]:oe,light:le,dark:pe,...Ne}=h,Ve={...Ne};let Ae=oe;if((ee==="dark"&&!("dark"in h)||ee==="light"&&!("light"in h))&&(Ae=!0),!Ae)throw new Error(ay(21,ee));let Ue;b&&(Ue="oklch");const ke=Rq(Ue,Ve,Ae,q,ee);le&&!Ve.light&&Rq(Ue,Ve,le,void 0,"light"),pe&&!Ve.dark&&Rq(Ue,Ve,pe,void 0,"dark");let qe={defaultColorScheme:ee,...ke,cssVarPrefix:y,colorSchemeSelector:U,rootSelector:x,getCssVar:ue,colorSchemes:Ve,font:{..._ce(ke.typography),...ke.font},spacing:Uce(q.spacing)};Object.keys(qe.colorSchemes).forEach(Ie=>{const $=qe.colorSchemes[Ie].palette,me=ct=>{const Me=ct.split("-"),Je=Me[1],mt=Me[2];return ue(ct,$[Je][mt])};$.mode==="light"&&(Rt($.common,"background","#fff"),Rt($.common,"onBackground","#000")),$.mode==="dark"&&(Rt($.common,"background","#000"),Rt($.common,"onBackground","#fff"));function Xe(ct,Me,Je){if(Ue){let mt;return ct===x0&&(mt=`transparent ${((1-Je)*100).toFixed(0)}%`),ct===Zs&&(mt=`#000 ${(Je*100).toFixed(0)}%`),ct===$s&&(mt=`#fff ${(Je*100).toFixed(0)}%`),`color-mix(in ${Ue}, ${Me}, ${mt})`}return ct(Me,Je)}if(Mce($,["Alert","AppBar","Avatar","Button","Chip","FilledInput","LinearProgress","Skeleton","Slider","SnackbarContent","SpeedDialAction","StepConnector","StepContent","Switch","TableCell","Tooltip"]),$.mode==="light"){Rt($.Alert,"errorColor",Xe(Zs,$.error.light,.6)),Rt($.Alert,"infoColor",Xe(Zs,$.info.light,.6)),Rt($.Alert,"successColor",Xe(Zs,$.success.light,.6)),Rt($.Alert,"warningColor",Xe(Zs,$.warning.light,.6)),Rt($.Alert,"errorFilledBg",me("palette-error-main")),Rt($.Alert,"infoFilledBg",me("palette-info-main")),Rt($.Alert,"successFilledBg",me("palette-success-main")),Rt($.Alert,"warningFilledBg",me("palette-warning-main")),Rt($.Alert,"errorFilledColor",fS(()=>$.getContrastText($.error.main))),Rt($.Alert,"infoFilledColor",fS(()=>$.getContrastText($.info.main))),Rt($.Alert,"successFilledColor",fS(()=>$.getContrastText($.success.main))),Rt($.Alert,"warningFilledColor",fS(()=>$.getContrastText($.warning.main))),Rt($.Alert,"errorStandardBg",Xe($s,$.error.light,.9)),Rt($.Alert,"infoStandardBg",Xe($s,$.info.light,.9)),Rt($.Alert,"successStandardBg",Xe($s,$.success.light,.9)),Rt($.Alert,"warningStandardBg",Xe($s,$.warning.light,.9)),Rt($.Alert,"errorIconColor",me("palette-error-main")),Rt($.Alert,"infoIconColor",me("palette-info-main")),Rt($.Alert,"successIconColor",me("palette-success-main")),Rt($.Alert,"warningIconColor",me("palette-warning-main")),Rt($.AppBar,"defaultBg",me("palette-grey-100")),Rt($.Avatar,"defaultBg",me("palette-grey-400")),Rt($.Button,"inheritContainedBg",me("palette-grey-300")),Rt($.Button,"inheritContainedHoverBg",me("palette-grey-A100")),Rt($.Chip,"defaultBorder",me("palette-grey-400")),Rt($.Chip,"defaultAvatarColor",me("palette-grey-700")),Rt($.Chip,"defaultIconColor",me("palette-grey-700")),Rt($.FilledInput,"bg","rgba(0, 0, 0, 0.06)"),Rt($.FilledInput,"hoverBg","rgba(0, 0, 0, 0.09)"),Rt($.FilledInput,"disabledBg","rgba(0, 0, 0, 0.12)"),Rt($.LinearProgress,"primaryBg",Xe($s,$.primary.main,.62)),Rt($.LinearProgress,"secondaryBg",Xe($s,$.secondary.main,.62)),Rt($.LinearProgress,"errorBg",Xe($s,$.error.main,.62)),Rt($.LinearProgress,"infoBg",Xe($s,$.info.main,.62)),Rt($.LinearProgress,"successBg",Xe($s,$.success.main,.62)),Rt($.LinearProgress,"warningBg",Xe($s,$.warning.main,.62)),Rt($.Skeleton,"bg",Ue?Xe(x0,$.text.primary,.11):`rgba(${me("palette-text-primaryChannel")} / 0.11)`),Rt($.Slider,"primaryTrack",Xe($s,$.primary.main,.62)),Rt($.Slider,"secondaryTrack",Xe($s,$.secondary.main,.62)),Rt($.Slider,"errorTrack",Xe($s,$.error.main,.62)),Rt($.Slider,"infoTrack",Xe($s,$.info.main,.62)),Rt($.Slider,"successTrack",Xe($s,$.success.main,.62)),Rt($.Slider,"warningTrack",Xe($s,$.warning.main,.62));const ct=Ue?Xe(Zs,$.background.default,.6825):j6($.background.default,.8);Rt($.SnackbarContent,"bg",ct),Rt($.SnackbarContent,"color",fS(()=>Ue?Zq.text.primary:$.getContrastText(ct))),Rt($.SpeedDialAction,"fabHoverBg",j6($.background.paper,.15)),Rt($.StepConnector,"border",me("palette-grey-400")),Rt($.StepContent,"border",me("palette-grey-400")),Rt($.Switch,"defaultColor",me("palette-common-white")),Rt($.Switch,"defaultDisabledColor",me("palette-grey-100")),Rt($.Switch,"primaryDisabledColor",Xe($s,$.primary.main,.62)),Rt($.Switch,"secondaryDisabledColor",Xe($s,$.secondary.main,.62)),Rt($.Switch,"errorDisabledColor",Xe($s,$.error.main,.62)),Rt($.Switch,"infoDisabledColor",Xe($s,$.info.main,.62)),Rt($.Switch,"successDisabledColor",Xe($s,$.success.main,.62)),Rt($.Switch,"warningDisabledColor",Xe($s,$.warning.main,.62)),Rt($.TableCell,"border",Xe($s,Xe(x0,$.divider,1),.88)),Rt($.Tooltip,"bg",Xe(x0,$.grey[700],.92))}if($.mode==="dark"){Rt($.Alert,"errorColor",Xe($s,$.error.light,.6)),Rt($.Alert,"infoColor",Xe($s,$.info.light,.6)),Rt($.Alert,"successColor",Xe($s,$.success.light,.6)),Rt($.Alert,"warningColor",Xe($s,$.warning.light,.6)),Rt($.Alert,"errorFilledBg",me("palette-error-dark")),Rt($.Alert,"infoFilledBg",me("palette-info-dark")),Rt($.Alert,"successFilledBg",me("palette-success-dark")),Rt($.Alert,"warningFilledBg",me("palette-warning-dark")),Rt($.Alert,"errorFilledColor",fS(()=>$.getContrastText($.error.dark))),Rt($.Alert,"infoFilledColor",fS(()=>$.getContrastText($.info.dark))),Rt($.Alert,"successFilledColor",fS(()=>$.getContrastText($.success.dark))),Rt($.Alert,"warningFilledColor",fS(()=>$.getContrastText($.warning.dark))),Rt($.Alert,"errorStandardBg",Xe(Zs,$.error.light,.9)),Rt($.Alert,"infoStandardBg",Xe(Zs,$.info.light,.9)),Rt($.Alert,"successStandardBg",Xe(Zs,$.success.light,.9)),Rt($.Alert,"warningStandardBg",Xe(Zs,$.warning.light,.9)),Rt($.Alert,"errorIconColor",me("palette-error-main")),Rt($.Alert,"infoIconColor",me("palette-info-main")),Rt($.Alert,"successIconColor",me("palette-success-main")),Rt($.Alert,"warningIconColor",me("palette-warning-main")),Rt($.AppBar,"defaultBg",me("palette-grey-900")),Rt($.AppBar,"darkBg",me("palette-background-paper")),Rt($.AppBar,"darkColor",me("palette-text-primary")),Rt($.Avatar,"defaultBg",me("palette-grey-600")),Rt($.Button,"inheritContainedBg",me("palette-grey-800")),Rt($.Button,"inheritContainedHoverBg",me("palette-grey-700")),Rt($.Chip,"defaultBorder",me("palette-grey-700")),Rt($.Chip,"defaultAvatarColor",me("palette-grey-300")),Rt($.Chip,"defaultIconColor",me("palette-grey-300")),Rt($.FilledInput,"bg","rgba(255, 255, 255, 0.09)"),Rt($.FilledInput,"hoverBg","rgba(255, 255, 255, 0.13)"),Rt($.FilledInput,"disabledBg","rgba(255, 255, 255, 0.12)"),Rt($.LinearProgress,"primaryBg",Xe(Zs,$.primary.main,.5)),Rt($.LinearProgress,"secondaryBg",Xe(Zs,$.secondary.main,.5)),Rt($.LinearProgress,"errorBg",Xe(Zs,$.error.main,.5)),Rt($.LinearProgress,"infoBg",Xe(Zs,$.info.main,.5)),Rt($.LinearProgress,"successBg",Xe(Zs,$.success.main,.5)),Rt($.LinearProgress,"warningBg",Xe(Zs,$.warning.main,.5)),Rt($.Skeleton,"bg",Ue?Xe(x0,$.text.primary,.13):`rgba(${me("palette-text-primaryChannel")} / 0.13)`),Rt($.Slider,"primaryTrack",Xe(Zs,$.primary.main,.5)),Rt($.Slider,"secondaryTrack",Xe(Zs,$.secondary.main,.5)),Rt($.Slider,"errorTrack",Xe(Zs,$.error.main,.5)),Rt($.Slider,"infoTrack",Xe(Zs,$.info.main,.5)),Rt($.Slider,"successTrack",Xe(Zs,$.success.main,.5)),Rt($.Slider,"warningTrack",Xe(Zs,$.warning.main,.5));const ct=Ue?Xe($s,$.background.default,.985):j6($.background.default,.98);Rt($.SnackbarContent,"bg",ct),Rt($.SnackbarContent,"color",fS(()=>Ue?Iee.text.primary:$.getContrastText(ct))),Rt($.SpeedDialAction,"fabHoverBg",j6($.background.paper,.15)),Rt($.StepConnector,"border",me("palette-grey-600")),Rt($.StepContent,"border",me("palette-grey-600")),Rt($.Switch,"defaultColor",me("palette-grey-300")),Rt($.Switch,"defaultDisabledColor",me("palette-grey-600")),Rt($.Switch,"primaryDisabledColor",Xe(Zs,$.primary.main,.55)),Rt($.Switch,"secondaryDisabledColor",Xe(Zs,$.secondary.main,.55)),Rt($.Switch,"errorDisabledColor",Xe(Zs,$.error.main,.55)),Rt($.Switch,"infoDisabledColor",Xe(Zs,$.info.main,.55)),Rt($.Switch,"successDisabledColor",Xe(Zs,$.success.main,.55)),Rt($.Switch,"warningDisabledColor",Xe(Zs,$.warning.main,.55)),Rt($.TableCell,"border",Xe(Zs,Xe(x0,$.divider,1),.68)),Rt($.Tooltip,"bg",Xe(x0,$.grey[700],.92))}Jv($.background,"default"),Jv($.background,"paper"),Jv($.common,"background"),Jv($.common,"onBackground"),Jv($,"divider"),Object.keys($).forEach(ct=>{const Me=$[ct];ct!=="tonalOffset"&&Me&&typeof Me=="object"&&(Me.main&&Rt($[ct],"mainChannel",kj(Lj(Me.main))),Me.light&&Rt($[ct],"lightChannel",kj(Lj(Me.light))),Me.dark&&Rt($[ct],"darkChannel",kj(Lj(Me.dark))),Me.contrastText&&Rt($[ct],"contrastTextChannel",kj(Lj(Me.contrastText))),ct==="text"&&(Jv($[ct],"primary"),Jv($[ct],"secondary")),ct==="action"&&(Me.active&&Jv($[ct],"active"),Me.selected&&Jv($[ct],"selected")))})}),qe=a.reduce((Ie,$)=>zd(Ie,$),qe);const Te={prefix:y,disableCssColorScheme:S,shouldSkipGeneratingVar:D,getSelector:Lce(qe),enableContrastVars:b},{vars:he,generateThemeVars:_e,generateStyleSheets:ye}=tce(qe,Te);return qe.vars=he,Object.entries(qe.colorSchemes[qe.defaultColorScheme]).forEach(([Ie,$])=>{qe[Ie]=$}),qe.generateThemeVars=_e,qe.generateStyleSheets=ye,qe.generateSpacing=function(){return dee(q.spacing,Q7(this))},qe.getColorSchemeSelector=nce(U),qe.spacing=qe.generateSpacing(),qe.shouldSkipGeneratingVar=D,qe.unstable_sxConfig={...I3,...q?.unstable_sxConfig},qe.unstable_sx=function($){return Pb({sx:$,theme:this})},qe.toRuntimeSource=Oee,qe}function RQ(l,a,h){l.colorSchemes&&h&&(l.colorSchemes[a]={...h!==!0&&h,palette:rX({...h===!0?{}:h.palette,mode:a})})}function fW(l={},...a){const{palette:h,cssVariables:_=!1,colorSchemes:S=h?void 0:{light:!0},defaultColorScheme:y=h?.mode,...b}=l,D=y||"light",U=S?.[D],x={...S,...h?{[D]:{...typeof U!="boolean"&&U,palette:h}}:void 0};if(_===!1){if(!("colorSchemes"in l))return $q(l,...a);let q=h;"palette"in l||x[D]&&(x[D]!==!0?q=x[D].palette:D==="dark"&&(q={mode:"dark"}));const J=$q({...l,palette:q},...a);return J.defaultColorScheme=D,J.colorSchemes=x,J.palette.mode==="light"&&(J.colorSchemes.light={...x.light!==!0&&x.light,palette:J.palette},RQ(J,"dark",x.dark)),J.palette.mode==="dark"&&(J.colorSchemes.dark={...x.dark!==!0&&x.dark,palette:J.palette},RQ(J,"light",x.light)),J}return!h&&!("light"in x)&&D==="light"&&(x.light=!0),Vce({...b,colorSchemes:x,defaultColorScheme:D,...typeof _!="boolean"&&_},...a)}const sX=fW();function oX(){const l=lW(sX);return l[RS]||l}function _W(l){return l!=="ownerState"&&l!=="theme"&&l!=="sx"&&l!=="as"}const yE=l=>_W(l)&&l!=="classes",Gn=Eee({themeId:RS,defaultTheme:sX,rootShouldForwardProp:yE});function Fce({theme:l,...a}){const h=RS in l?l[RS]:void 0;return ze.jsx(Ree,{...a,themeId:h?RS:void 0,theme:h||l})}const G6={colorSchemeStorageKey:"mui-color-scheme",defaultLightColorScheme:"light",defaultDarkColorScheme:"dark",modeStorageKey:"mui-mode"},{CssVarsProvider:Bce}=Qae({themeId:RS,theme:()=>fW({cssVariables:!0}),colorSchemeStorageKey:G6.colorSchemeStorageKey,modeStorageKey:G6.modeStorageKey,defaultColorScheme:{light:G6.defaultLightColorScheme,dark:G6.defaultDarkColorScheme},resolveTheme:l=>{const a={...l,typography:wee(l.palette,l.typography)};return a.unstable_sx=function(_){return Pb({sx:_,theme:this})},a}}),jce=Bce;function Gce({theme:l,...a}){const h=ae.useMemo(()=>{if(typeof l=="function")return l;const _=RS in l?l[RS]:l;return"colorSchemes"in _?null:"vars"in _?l:{...l,vars:null}},[l]);return h?ze.jsx(Fce,{theme:h,...a}):ze.jsx(jce,{theme:l,...a})}function CQ(...l){return l.reduce((a,h)=>h==null?a:function(...S){a.apply(this,S),h.apply(this,S)},()=>{})}function Wce(l){return ze.jsx(uee,{...l,defaultTheme:sX,themeId:RS})}function aX(l){return function(h){return ze.jsx(Wce,{styles:typeof l=="function"?_=>l({theme:_,...h}):l})}}function Hce(){return hee}const uo=Wae;function Io(l){return Fae(l)}function Kce(l){return Ro("MuiSvgIcon",l)}Co("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);const zce=l=>{const{color:a,fontSize:h,classes:_}=l,S={root:["root",a!=="inherit"&&`color${_i(a)}`,`fontSize${_i(h)}`]};return bo(S,Kce,_)},Yce=Gn("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[a.root,h.color!=="inherit"&&a[`color${_i(h.color)}`],a[`fontSize${_i(h.fontSize)}`]]}})(uo(({theme:l})=>({userSelect:"none",width:"1em",height:"1em",display:"inline-block",flexShrink:0,transition:l.transitions?.create?.("fill",{duration:(l.vars??l).transitions?.duration?.shorter}),variants:[{props:a=>!a.hasSvgAsChild,style:{fill:"currentColor"}},{props:{fontSize:"inherit"},style:{fontSize:"inherit"}},{props:{fontSize:"small"},style:{fontSize:l.typography?.pxToRem?.(20)||"1.25rem"}},{props:{fontSize:"medium"},style:{fontSize:l.typography?.pxToRem?.(24)||"1.5rem"}},{props:{fontSize:"large"},style:{fontSize:l.typography?.pxToRem?.(35)||"2.1875rem"}},...Object.entries((l.vars??l).palette).filter(([,a])=>a&&a.main).map(([a])=>({props:{color:a},style:{color:(l.vars??l).palette?.[a]?.main}})),{props:{color:"action"},style:{color:(l.vars??l).palette?.action?.active}},{props:{color:"disabled"},style:{color:(l.vars??l).palette?.action?.disabled}},{props:{color:"inherit"},style:{color:void 0}}]}))),t7=ae.forwardRef(function(a,h){const _=Io({props:a,name:"MuiSvgIcon"}),{children:S,className:y,color:b="inherit",component:D="svg",fontSize:U="medium",htmlColor:x,inheritViewBox:q=!1,titleAccess:J,viewBox:ee="0 0 24 24",...ue}=_,oe=ae.isValidElement(S)&&S.type==="svg",le={..._,color:b,component:D,fontSize:U,instanceFontSize:a.fontSize,inheritViewBox:q,viewBox:ee,hasSvgAsChild:oe},pe={};q||(pe.viewBox=ee);const Ne=zce(le);return ze.jsxs(Yce,{as:D,className:Ui(Ne.root,y),focusable:"false",color:x,"aria-hidden":J?void 0:!0,role:J?"img":void 0,ref:h,...pe,...ue,...oe&&S.props,ownerState:le,children:[oe?S.props.children:S,J?ze.jsx("title",{children:J}):null]})});t7.muiName="SvgIcon";function qce(l,a){function h(_,S){return ze.jsx(t7,{"data-testid":void 0,ref:S,..._,children:l})}return h.muiName=t7.muiName,ae.memo(ae.forwardRef(h))}function Pee(l,a=166){let h;function _(...S){const y=()=>{l.apply(this,S)};clearTimeout(h),h=setTimeout(y,a)}return _.clear=()=>{clearTimeout(h)},_}function xu(l){return l&&l.ownerDocument||document}function ly(l){return xu(l).defaultView||window}function bQ(l,a){typeof l=="function"?l(a):l&&(l.current=a)}function n7(l){const{controlled:a,default:h,name:_,state:S="value"}=l,{current:y}=ae.useRef(a!==void 0),[b,D]=ae.useState(h),U=y?a:b,x=ae.useCallback(q=>{y||D(q)},[]);return[U,x]}function bS(l){const a=ae.useRef(l);return NS(()=>{a.current=l}),ae.useRef((...h)=>(0,a.current)(...h)).current}function Fu(...l){const a=ae.useRef(void 0),h=ae.useCallback(_=>{const S=l.map(y=>{if(y==null)return null;if(typeof y=="function"){const b=y,D=b(_);return typeof D=="function"?D:()=>{b(null)}}return y.current=_,()=>{y.current=null}});return()=>{S.forEach(y=>y?.())}},l);return ae.useMemo(()=>l.every(_=>_==null)?null:_=>{a.current&&(a.current(),a.current=void 0),_!=null&&(a.current=h(_))},l)}function Xce(l,a){const h=l.charCodeAt(2);return l[0]==="o"&&l[1]==="n"&&h>=65&&h<=90&&typeof a=="function"}function Jce(l,a){if(!l)return a;function h(b,D){const U={};return Object.keys(D).forEach(x=>{Xce(x,D[x])&&typeof b[x]=="function"&&(U[x]=(...q)=>{b[x](...q),D[x](...q)})}),U}if(typeof l=="function"||typeof a=="function")return b=>{const D=typeof a=="function"?a(b):a,U=typeof l=="function"?l({...b,...D}):l,x=Ui(b?.className,D?.className,U?.className),q=h(U,D);return{...D,...U,...q,...!!x&&{className:x},...D?.style&&U?.style&&{style:{...D.style,...U.style}},...D?.sx&&U?.sx&&{sx:[...Array.isArray(D.sx)?D.sx:[D.sx],...Array.isArray(U.sx)?U.sx:[U.sx]]}}};const _=a,S=h(l,_),y=Ui(_?.className,l?.className);return{...a,...l,...S,...!!y&&{className:y},..._?.style&&l?.style&&{style:{..._.style,...l.style}},..._?.sx&&l?.sx&&{sx:[...Array.isArray(_.sx)?_.sx:[_.sx],...Array.isArray(l.sx)?l.sx:[l.sx]]}}}function kee(l,a){if(l==null)return{};var h={};for(var _ in l)if({}.hasOwnProperty.call(l,_)){if(a.indexOf(_)!==-1)continue;h[_]=l[_]}return h}function i7(l,a){return i7=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,_){return h.__proto__=_,h},i7(l,a)}function Lee(l,a){l.prototype=Object.create(a.prototype),l.prototype.constructor=l,i7(l,a)}const IQ={disabled:!1},TG=mE.createContext(null);var Qce=function(a){return a.scrollTop},Mj="unmounted",B0="exited",j0="entering",wk="entered",r7="exiting",PS=(function(l){Lee(a,l);function a(_,S){var y;y=l.call(this,_,S)||this;var b=S,D=b&&!b.isMounting?_.enter:_.appear,U;return y.appearStatus=null,_.in?D?(U=B0,y.appearStatus=j0):U=wk:_.unmountOnExit||_.mountOnEnter?U=Mj:U=B0,y.state={status:U},y.nextCallback=null,y}a.getDerivedStateFromProps=function(S,y){var b=S.in;return b&&y.status===Mj?{status:B0}:null};var h=a.prototype;return h.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},h.componentDidUpdate=function(S){var y=null;if(S!==this.props){var b=this.state.status;this.props.in?b!==j0&&b!==wk&&(y=j0):(b===j0||b===wk)&&(y=r7)}this.updateStatus(!1,y)},h.componentWillUnmount=function(){this.cancelNextCallback()},h.getTimeouts=function(){var S=this.props.timeout,y,b,D;return y=b=D=S,S!=null&&typeof S!="number"&&(y=S.exit,b=S.enter,D=S.appear!==void 0?S.appear:b),{exit:y,enter:b,appear:D}},h.updateStatus=function(S,y){if(S===void 0&&(S=!1),y!==null)if(this.cancelNextCallback(),y===j0){if(this.props.unmountOnExit||this.props.mountOnEnter){var b=this.props.nodeRef?this.props.nodeRef.current:F6.findDOMNode(this);b&&Qce(b)}this.performEnter(S)}else this.performExit();else this.props.unmountOnExit&&this.state.status===B0&&this.setState({status:Mj})},h.performEnter=function(S){var y=this,b=this.props.enter,D=this.context?this.context.isMounting:S,U=this.props.nodeRef?[D]:[F6.findDOMNode(this),D],x=U[0],q=U[1],J=this.getTimeouts(),ee=D?J.appear:J.enter;if(!S&&!b||IQ.disabled){this.safeSetState({status:wk},function(){y.props.onEntered(x)});return}this.props.onEnter(x,q),this.safeSetState({status:j0},function(){y.props.onEntering(x,q),y.onTransitionEnd(ee,function(){y.safeSetState({status:wk},function(){y.props.onEntered(x,q)})})})},h.performExit=function(){var S=this,y=this.props.exit,b=this.getTimeouts(),D=this.props.nodeRef?void 0:F6.findDOMNode(this);if(!y||IQ.disabled){this.safeSetState({status:B0},function(){S.props.onExited(D)});return}this.props.onExit(D),this.safeSetState({status:r7},function(){S.props.onExiting(D),S.onTransitionEnd(b.exit,function(){S.safeSetState({status:B0},function(){S.props.onExited(D)})})})},h.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},h.safeSetState=function(S,y){y=this.setNextCallback(y),this.setState(S,y)},h.setNextCallback=function(S){var y=this,b=!0;return this.nextCallback=function(D){b&&(b=!1,y.nextCallback=null,S(D))},this.nextCallback.cancel=function(){b=!1},this.nextCallback},h.onTransitionEnd=function(S,y){this.setNextCallback(y);var b=this.props.nodeRef?this.props.nodeRef.current:F6.findDOMNode(this),D=S==null&&!this.props.addEndListener;if(!b||D){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var U=this.props.nodeRef?[this.nextCallback]:[b,this.nextCallback],x=U[0],q=U[1];this.props.addEndListener(x,q)}S!=null&&setTimeout(this.nextCallback,S)},h.render=function(){var S=this.state.status;if(S===Mj)return null;var y=this.props,b=y.children;y.in,y.mountOnEnter,y.unmountOnExit,y.appear,y.enter,y.exit,y.timeout,y.addEndListener,y.onEnter,y.onEntering,y.onEntered,y.onExit,y.onExiting,y.onExited,y.nodeRef;var D=kee(y,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return mE.createElement(TG.Provider,{value:null},typeof b=="function"?b(S,D):mE.cloneElement(mE.Children.only(b),D))},a})(mE.Component);PS.contextType=TG;PS.propTypes={};function Ck(){}PS.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:Ck,onEntering:Ck,onEntered:Ck,onExit:Ck,onExiting:Ck,onExited:Ck};PS.UNMOUNTED=Mj;PS.EXITED=B0;PS.ENTERING=j0;PS.ENTERED=wk;PS.EXITING=r7;function Zce(l){if(l===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return l}function cX(l,a){var h=function(y){return a&&ae.isValidElement(y)?a(y):y},_=Object.create(null);return l&&ae.Children.map(l,function(S){return S}).forEach(function(S){_[S.key]=h(S)}),_}function $ce(l,a){l=l||{},a=a||{};function h(q){return q in a?a[q]:l[q]}var _=Object.create(null),S=[];for(var y in l)y in a?S.length&&(_[y]=S,S=[]):S.push(y);var b,D={};for(var U in a){if(_[U])for(b=0;b<_[U].length;b++){var x=_[U][b];D[_[U][b]]=h(x)}D[U]=h(U)}for(b=0;b<S.length;b++)D[S[b]]=h(S[b]);return D}function q0(l,a,h){return h[a]!=null?h[a]:l.props[a]}function ele(l,a){return cX(l.children,function(h){return ae.cloneElement(h,{onExited:a.bind(null,h),in:!0,appear:q0(h,"appear",l),enter:q0(h,"enter",l),exit:q0(h,"exit",l)})})}function tle(l,a,h){var _=cX(l.children),S=$ce(a,_);return Object.keys(S).forEach(function(y){var b=S[y];if(ae.isValidElement(b)){var D=y in a,U=y in _,x=a[y],q=ae.isValidElement(x)&&!x.props.in;U&&(!D||q)?S[y]=ae.cloneElement(b,{onExited:h.bind(null,b),in:!0,exit:q0(b,"exit",l),enter:q0(b,"enter",l)}):!U&&D&&!q?S[y]=ae.cloneElement(b,{in:!1}):U&&D&&ae.isValidElement(x)&&(S[y]=ae.cloneElement(b,{onExited:h.bind(null,b),in:x.props.in,exit:q0(b,"exit",l),enter:q0(b,"enter",l)}))}}),S}var nle=Object.values||function(l){return Object.keys(l).map(function(a){return l[a]})},ile={component:"div",childFactory:function(a){return a}},lX=(function(l){Lee(a,l);function a(_,S){var y;y=l.call(this,_,S)||this;var b=y.handleExited.bind(Zce(y));return y.state={contextValue:{isMounting:!0},handleExited:b,firstRender:!0},y}var h=a.prototype;return h.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},h.componentWillUnmount=function(){this.mounted=!1},a.getDerivedStateFromProps=function(S,y){var b=y.children,D=y.handleExited,U=y.firstRender;return{children:U?ele(S,D):tle(S,b,D),firstRender:!1}},h.handleExited=function(S,y){var b=cX(this.props.children);S.key in b||(S.props.onExited&&S.props.onExited(y),this.mounted&&this.setState(function(D){var U=mG({},D.children);return delete U[S.key],{children:U}}))},h.render=function(){var S=this.props,y=S.component,b=S.childFactory,D=kee(S,["component","childFactory"]),U=this.state.contextValue,x=nle(this.state.children).map(b);return delete D.appear,delete D.enter,delete D.exit,y===null?mE.createElement(TG.Provider,{value:U},x):mE.createElement(TG.Provider,{value:U},mE.createElement(y,D,x))},a})(mE.Component);lX.propTypes={};lX.defaultProps=ile;const AQ={};function Mee(l,a){const h=ae.useRef(AQ);return h.current===AQ&&(h.current=l(a)),h}const rle=[];function sle(l){ae.useEffect(l,rle)}class dX{static create(){return new dX}currentId=null;start(a,h){this.clear(),this.currentId=setTimeout(()=>{this.currentId=null,h()},a)}clear=()=>{this.currentId!==null&&(clearTimeout(this.currentId),this.currentId=null)};disposeEffect=()=>this.clear}function Uee(){const l=Mee(dX.create).current;return sle(l.disposeEffect),l}const xee=l=>l.scrollTop;function vG(l,a){const{timeout:h,easing:_,style:S={}}=l;return{duration:S.transitionDuration??(typeof h=="number"?h:h[a.mode]||0),easing:S.transitionTimingFunction??(typeof _=="object"?_[a.mode]:_),delay:S.transitionDelay}}function ole(l){return Ro("MuiPaper",l)}Co("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);const ale=l=>{const{square:a,elevation:h,variant:_,classes:S}=l,y={root:["root",_,!a&&"rounded",_==="elevation"&&`elevation${h}`]};return bo(y,ole,S)},cle=Gn("div",{name:"MuiPaper",slot:"Root",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[a.root,a[h.variant],!h.square&&a.rounded,h.variant==="elevation"&&a[`elevation${h.elevation}`]]}})(uo(({theme:l})=>({backgroundColor:(l.vars||l).palette.background.paper,color:(l.vars||l).palette.text.primary,transition:l.transitions.create("box-shadow"),variants:[{props:({ownerState:a})=>!a.square,style:{borderRadius:l.shape.borderRadius}},{props:{variant:"outlined"},style:{border:`1px solid ${(l.vars||l).palette.divider}`}},{props:{variant:"elevation"},style:{boxShadow:"var(--Paper-shadow)",backgroundImage:"var(--Paper-overlay)"}}]}))),uX=ae.forwardRef(function(a,h){const _=Io({props:a,name:"MuiPaper"}),S=oX(),{className:y,component:b="div",elevation:D=1,square:U=!1,variant:x="elevation",...q}=_,J={..._,component:b,elevation:D,square:U,variant:x},ee=ale(J);return ze.jsx(cle,{as:b,ownerState:J,className:Ui(ee.root,y),ref:h,...q,style:{...x==="elevation"&&{"--Paper-shadow":(S.vars||S).shadows[D],...S.vars&&{"--Paper-overlay":S.vars.overlays?.[D]},...!S.vars&&S.palette.mode==="dark"&&{"--Paper-overlay":`linear-gradient(${SG("#fff",e7(D))}, ${SG("#fff",e7(D))})`}},...q.style}})});function wb(l){return typeof l=="string"}function Vee(l,a,h){return l===void 0||wb(l)?a:{...a,ownerState:{...a.ownerState,...h}}}function Fee(l,a,h){return typeof l=="function"?l(a,h):l}function Fj(l,a=[]){if(l===void 0)return{};const h={};return Object.keys(l).filter(_=>_.match(/^on[A-Z]/)&&typeof l[_]=="function"&&!a.includes(_)).forEach(_=>{h[_]=l[_]}),h}function wQ(l){if(l===void 0)return{};const a={};return Object.keys(l).filter(h=>!(h.match(/^on[A-Z]/)&&typeof l[h]=="function")).forEach(h=>{a[h]=l[h]}),a}function Bee(l){const{getSlotProps:a,additionalProps:h,externalSlotProps:_,externalForwardedProps:S,className:y}=l;if(!a){const ue=Ui(h?.className,y,S?.className,_?.className),oe={...h?.style,...S?.style,..._?.style},le={...h,...S,..._};return ue.length>0&&(le.className=ue),Object.keys(oe).length>0&&(le.style=oe),{props:le,internalRef:void 0}}const b=Fj({...S,..._}),D=wQ(_),U=wQ(S),x=a(b),q=Ui(x?.className,h?.className,y,S?.className,_?.className),J={...x?.style,...h?.style,...S?.style,..._?.style},ee={...x,...h,...U,...D};return q.length>0&&(ee.className=q),Object.keys(J).length>0&&(ee.style=J),{props:ee,internalRef:x.ref}}function Wd(l,a){const{className:h,elementType:_,ownerState:S,externalForwardedProps:y,internalForwardedProps:b,shouldForwardComponentProp:D=!1,...U}=a,{component:x,slots:q={[l]:void 0},slotProps:J={[l]:void 0},...ee}=y,ue=q[l]||_,oe=Fee(J[l],S),{props:{component:le,...pe},internalRef:Ne}=Bee({className:h,...U,externalForwardedProps:l==="root"?ee:void 0,externalSlotProps:oe}),Ve=Fu(Ne,oe?.ref,a.ref),Ae=l==="root"?le||x:le,Ue=Vee(ue,{...l==="root"&&!x&&!q[l]&&b,...l!=="root"&&!q[l]&&b,...pe,...Ae&&!D&&{as:Ae},...Ae&&D&&{component:Ae},ref:Ve},S);return[ue,Ue]}function yG(l){try{return l.matches(":focus-visible")}catch{}return!1}class RG{static create(){return new RG}static use(){const a=Mee(RG.create).current,[h,_]=ae.useState(!1);return a.shouldMount=h,a.setShouldMount=_,ae.useEffect(a.mountEffect,[h]),a}constructor(){this.ref={current:null},this.mounted=null,this.didMount=!1,this.shouldMount=!1,this.setShouldMount=null}mount(){return this.mounted||(this.mounted=dle(),this.shouldMount=!0,this.setShouldMount(this.shouldMount)),this.mounted}mountEffect=()=>{this.shouldMount&&!this.didMount&&this.ref.current!==null&&(this.didMount=!0,this.mounted.resolve())};start(...a){this.mount().then(()=>this.ref.current?.start(...a))}stop(...a){this.mount().then(()=>this.ref.current?.stop(...a))}pulsate(...a){this.mount().then(()=>this.ref.current?.pulsate(...a))}}function lle(){return RG.use()}function dle(){let l,a;const h=new Promise((_,S)=>{l=_,a=S});return h.resolve=l,h.reject=a,h}function ule(l){const{className:a,classes:h,pulsate:_=!1,rippleX:S,rippleY:y,rippleSize:b,in:D,onExited:U,timeout:x}=l,[q,J]=ae.useState(!1),ee=Ui(a,h.ripple,h.rippleVisible,_&&h.ripplePulsate),ue={width:b,height:b,top:-(b/2)+y,left:-(b/2)+S},oe=Ui(h.child,q&&h.childLeaving,_&&h.childPulsate);return!D&&!q&&J(!0),ae.useEffect(()=>{if(!D&&U!=null){const le=setTimeout(U,x);return()=>{clearTimeout(le)}}},[U,D,x]),ze.jsx("span",{className:ee,style:ue,children:ze.jsx("span",{className:oe})})}const U_=Co("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),s7=550,hle=80,ple=R3`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`,fle=R3`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`,_le=R3`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`,mle=Gn("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),Ele=Gn(ule,{name:"MuiTouchRipple",slot:"Ripple"})`
  opacity: 0;
  position: absolute;

  &.${U_.rippleVisible} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${ple};
    animation-duration: ${s7}ms;
    animation-timing-function: ${({theme:l})=>l.transitions.easing.easeInOut};
  }

  &.${U_.ripplePulsate} {
    animation-duration: ${({theme:l})=>l.transitions.duration.shorter}ms;
  }

  & .${U_.child} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${U_.childLeaving} {
    opacity: 0;
    animation-name: ${fle};
    animation-duration: ${s7}ms;
    animation-timing-function: ${({theme:l})=>l.transitions.easing.easeInOut};
  }

  & .${U_.childPulsate} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${_le};
    animation-duration: 2500ms;
    animation-timing-function: ${({theme:l})=>l.transitions.easing.easeInOut};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`,gle=ae.forwardRef(function(a,h){const _=Io({props:a,name:"MuiTouchRipple"}),{center:S=!1,classes:y={},className:b,...D}=_,[U,x]=ae.useState([]),q=ae.useRef(0),J=ae.useRef(null);ae.useEffect(()=>{J.current&&(J.current(),J.current=null)},[U]);const ee=ae.useRef(!1),ue=Uee(),oe=ae.useRef(null),le=ae.useRef(null),pe=ae.useCallback(Ue=>{const{pulsate:ke,rippleX:qe,rippleY:Te,rippleSize:he,cb:_e}=Ue;x(ye=>[...ye,ze.jsx(Ele,{classes:{ripple:Ui(y.ripple,U_.ripple),rippleVisible:Ui(y.rippleVisible,U_.rippleVisible),ripplePulsate:Ui(y.ripplePulsate,U_.ripplePulsate),child:Ui(y.child,U_.child),childLeaving:Ui(y.childLeaving,U_.childLeaving),childPulsate:Ui(y.childPulsate,U_.childPulsate)},timeout:s7,pulsate:ke,rippleX:qe,rippleY:Te,rippleSize:he},q.current)]),q.current+=1,J.current=_e},[y]),Ne=ae.useCallback((Ue={},ke={},qe=()=>{})=>{const{pulsate:Te=!1,center:he=S||ke.pulsate,fakeElement:_e=!1}=ke;if(Ue?.type==="mousedown"&&ee.current){ee.current=!1;return}Ue?.type==="touchstart"&&(ee.current=!0);const ye=_e?null:le.current,Ie=ye?ye.getBoundingClientRect():{width:0,height:0,left:0,top:0};let $,me,Xe;if(he||Ue===void 0||Ue.clientX===0&&Ue.clientY===0||!Ue.clientX&&!Ue.touches)$=Math.round(Ie.width/2),me=Math.round(Ie.height/2);else{const{clientX:ct,clientY:Me}=Ue.touches&&Ue.touches.length>0?Ue.touches[0]:Ue;$=Math.round(ct-Ie.left),me=Math.round(Me-Ie.top)}if(he)Xe=Math.sqrt((2*Ie.width**2+Ie.height**2)/3),Xe%2===0&&(Xe+=1);else{const ct=Math.max(Math.abs((ye?ye.clientWidth:0)-$),$)*2+2,Me=Math.max(Math.abs((ye?ye.clientHeight:0)-me),me)*2+2;Xe=Math.sqrt(ct**2+Me**2)}Ue?.touches?oe.current===null&&(oe.current=()=>{pe({pulsate:Te,rippleX:$,rippleY:me,rippleSize:Xe,cb:qe})},ue.start(hle,()=>{oe.current&&(oe.current(),oe.current=null)})):pe({pulsate:Te,rippleX:$,rippleY:me,rippleSize:Xe,cb:qe})},[S,pe,ue]),Ve=ae.useCallback(()=>{Ne({},{pulsate:!0})},[Ne]),Ae=ae.useCallback((Ue,ke)=>{if(ue.clear(),Ue?.type==="touchend"&&oe.current){oe.current(),oe.current=null,ue.start(0,()=>{Ae(Ue,ke)});return}oe.current=null,x(qe=>qe.length>0?qe.slice(1):qe),J.current=ke},[ue]);return ae.useImperativeHandle(h,()=>({pulsate:Ve,start:Ne,stop:Ae}),[Ve,Ne,Ae]),ze.jsx(mle,{className:Ui(U_.root,y.root,b),ref:le,...D,children:ze.jsx(lX,{component:null,exit:!0,children:U})})});function Sle(l){return Ro("MuiButtonBase",l)}const Tle=Co("MuiButtonBase",["root","disabled","focusVisible"]),vle=l=>{const{disabled:a,focusVisible:h,focusVisibleClassName:_,classes:S}=l,b=bo({root:["root",a&&"disabled",h&&"focusVisible"]},Sle,S);return h&&_&&(b.root+=` ${_}`),b},yle=Gn("button",{name:"MuiButtonBase",slot:"Root"})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${Tle.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),Rle=ae.forwardRef(function(a,h){const _=Io({props:a,name:"MuiButtonBase"}),{action:S,centerRipple:y=!1,children:b,className:D,component:U="button",disabled:x=!1,disableRipple:q=!1,disableTouchRipple:J=!1,focusRipple:ee=!1,focusVisibleClassName:ue,LinkComponent:oe="a",onBlur:le,onClick:pe,onContextMenu:Ne,onDragLeave:Ve,onFocus:Ae,onFocusVisible:Ue,onKeyDown:ke,onKeyUp:qe,onMouseDown:Te,onMouseLeave:he,onMouseUp:_e,onTouchEnd:ye,onTouchMove:Ie,onTouchStart:$,tabIndex:me=0,TouchRippleProps:Xe,touchRippleRef:ct,type:Me,...Je}=_,mt=ae.useRef(null),yt=lle(),xe=Fu(yt.ref,ct),[it,ft]=ae.useState(!1);x&&it&&ft(!1),ae.useImperativeHandle(S,()=>({focusVisible:()=>{ft(!0),mt.current.focus()}}),[]);const pt=yt.shouldMount&&!q&&!x;ae.useEffect(()=>{it&&ee&&!q&&yt.pulsate()},[q,ee,it,yt]);const xt=Qv(yt,"start",Te,J),ln=Qv(yt,"stop",Ne,J),pn=Qv(yt,"stop",Ve,J),Zn=Qv(yt,"stop",_e,J),ri=Qv(yt,"stop",Sn=>{it&&Sn.preventDefault(),he&&he(Sn)},J),si=Qv(yt,"start",$,J),En=Qv(yt,"stop",ye,J),oi=Qv(yt,"stop",Ie,J),ui=Qv(yt,"stop",Sn=>{yG(Sn.target)||ft(!1),le&&le(Sn)},!1),Kn=bS(Sn=>{mt.current||(mt.current=Sn.currentTarget),yG(Sn.target)&&(ft(!0),Ue&&Ue(Sn)),Ae&&Ae(Sn)}),qn=()=>{const Sn=mt.current;return U&&U!=="button"&&!(Sn.tagName==="A"&&Sn.href)},Zi=bS(Sn=>{ee&&!Sn.repeat&&it&&Sn.key===" "&&yt.stop(Sn,()=>{yt.start(Sn)}),Sn.target===Sn.currentTarget&&qn()&&Sn.key===" "&&Sn.preventDefault(),ke&&ke(Sn),Sn.target===Sn.currentTarget&&qn()&&Sn.key==="Enter"&&!x&&(Sn.preventDefault(),pe&&pe(Sn))}),Gi=bS(Sn=>{ee&&Sn.key===" "&&it&&!Sn.defaultPrevented&&yt.stop(Sn,()=>{yt.pulsate(Sn)}),qe&&qe(Sn),pe&&Sn.target===Sn.currentTarget&&qn()&&Sn.key===" "&&!Sn.defaultPrevented&&pe(Sn)});let yi=U;yi==="button"&&(Je.href||Je.to)&&(yi=oe);const vn={};yi==="button"?(vn.type=Me===void 0?"button":Me,vn.disabled=x):(!Je.href&&!Je.to&&(vn.role="button"),x&&(vn["aria-disabled"]=x));const xn=Fu(h,mt),ir={..._,centerRipple:y,component:U,disabled:x,disableRipple:q,disableTouchRipple:J,focusRipple:ee,tabIndex:me,focusVisible:it},Bi=vle(ir);return ze.jsxs(yle,{as:yi,className:Ui(Bi.root,D),ownerState:ir,onBlur:ui,onClick:pe,onContextMenu:ln,onFocus:Kn,onKeyDown:Zi,onKeyUp:Gi,onMouseDown:xt,onMouseLeave:ri,onMouseUp:Zn,onDragLeave:pn,onTouchEnd:En,onTouchMove:oi,onTouchStart:si,ref:xn,tabIndex:x?-1:me,type:Me,...vn,...Je,children:[b,pt?ze.jsx(gle,{ref:xe,center:y,...Xe}):null]})});function Qv(l,a,h,_=!1){return bS(S=>(h&&h(S),_||l[a](S),!0))}function Cle(l){return typeof l.main=="string"}function ble(l,a=[]){if(!Cle(l))return!1;for(const h of a)if(!l.hasOwnProperty(h)||typeof l[h]!="string")return!1;return!0}function RE(l=[]){return([,a])=>a&&ble(a,l)}function Ile(l){return Ro("MuiCircularProgress",l)}Co("MuiCircularProgress",["root","determinate","indeterminate","colorPrimary","colorSecondary","svg","circle","circleDeterminate","circleIndeterminate","circleDisableShrink"]);const vb=44,o7=R3`
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
`,a7=R3`
  0% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: 0;
  }

  50% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -15px;
  }

  100% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: -126px;
  }
`,Ale=typeof o7!="string"?q7`
        animation: ${o7} 1.4s linear infinite;
      `:null,wle=typeof a7!="string"?q7`
        animation: ${a7} 1.4s ease-in-out infinite;
      `:null,Ole=l=>{const{classes:a,variant:h,color:_,disableShrink:S}=l,y={root:["root",h,`color${_i(_)}`],svg:["svg"],circle:["circle",`circle${_i(h)}`,S&&"circleDisableShrink"]};return bo(y,Ile,a)},Nle=Gn("span",{name:"MuiCircularProgress",slot:"Root",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[a.root,a[h.variant],a[`color${_i(h.color)}`]]}})(uo(({theme:l})=>({display:"inline-block",variants:[{props:{variant:"determinate"},style:{transition:l.transitions.create("transform")}},{props:{variant:"indeterminate"},style:Ale||{animation:`${o7} 1.4s linear infinite`}},...Object.entries(l.palette).filter(RE()).map(([a])=>({props:{color:a},style:{color:(l.vars||l).palette[a].main}}))]}))),Dle=Gn("svg",{name:"MuiCircularProgress",slot:"Svg"})({display:"block"}),Ple=Gn("circle",{name:"MuiCircularProgress",slot:"Circle",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[a.circle,a[`circle${_i(h.variant)}`],h.disableShrink&&a.circleDisableShrink]}})(uo(({theme:l})=>({stroke:"currentColor",variants:[{props:{variant:"determinate"},style:{transition:l.transitions.create("stroke-dashoffset")}},{props:{variant:"indeterminate"},style:{strokeDasharray:"80px, 200px",strokeDashoffset:0}},{props:({ownerState:a})=>a.variant==="indeterminate"&&!a.disableShrink,style:wle||{animation:`${a7} 1.4s ease-in-out infinite`}}]}))),kle=ae.forwardRef(function(a,h){const _=Io({props:a,name:"MuiCircularProgress"}),{className:S,color:y="primary",disableShrink:b=!1,size:D=40,style:U,thickness:x=3.6,value:q=0,variant:J="indeterminate",...ee}=_,ue={..._,color:y,disableShrink:b,size:D,thickness:x,value:q,variant:J},oe=Ole(ue),le={},pe={},Ne={};if(J==="determinate"){const Ve=2*Math.PI*((vb-x)/2);le.strokeDasharray=Ve.toFixed(3),Ne["aria-valuenow"]=Math.round(q),le.strokeDashoffset=`${((100-q)/100*Ve).toFixed(3)}px`,pe.transform="rotate(-90deg)"}return ze.jsx(Nle,{className:Ui(oe.root,S),style:{width:D,height:D,...pe,...U},ownerState:ue,ref:h,role:"progressbar",...Ne,...ee,children:ze.jsx(Dle,{className:oe.svg,ownerState:ue,viewBox:`${vb/2} ${vb/2} ${vb} ${vb}`,children:ze.jsx(Ple,{className:oe.circle,style:le,ownerState:ue,cx:vb,cy:vb,r:(vb-x)/2,fill:"none",strokeWidth:x})})})});function Lle(l){return Ro("MuiTypography",l)}Co("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const Mle={primary:!0,secondary:!0,error:!0,info:!0,success:!0,warning:!0,textPrimary:!0,textSecondary:!0,textDisabled:!0},Ule=Hce(),xle=l=>{const{align:a,gutterBottom:h,noWrap:_,paragraph:S,variant:y,classes:b}=l,D={root:["root",y,l.align!=="inherit"&&`align${_i(a)}`,h&&"gutterBottom",_&&"noWrap",S&&"paragraph"]};return bo(D,Lle,b)},Vle=Gn("span",{name:"MuiTypography",slot:"Root",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[a.root,h.variant&&a[h.variant],h.align!=="inherit"&&a[`align${_i(h.align)}`],h.noWrap&&a.noWrap,h.gutterBottom&&a.gutterBottom,h.paragraph&&a.paragraph]}})(uo(({theme:l})=>({margin:0,variants:[{props:{variant:"inherit"},style:{font:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}},...Object.entries(l.typography).filter(([a,h])=>a!=="inherit"&&h&&typeof h=="object").map(([a,h])=>({props:{variant:a},style:h})),...Object.entries(l.palette).filter(RE()).map(([a])=>({props:{color:a},style:{color:(l.vars||l).palette[a].main}})),...Object.entries(l.palette?.text||{}).filter(([,a])=>typeof a=="string").map(([a])=>({props:{color:`text${_i(a)}`},style:{color:(l.vars||l).palette.text[a]}})),{props:({ownerState:a})=>a.align!=="inherit",style:{textAlign:"var(--Typography-textAlign)"}},{props:({ownerState:a})=>a.noWrap,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},{props:({ownerState:a})=>a.gutterBottom,style:{marginBottom:"0.35em"}},{props:({ownerState:a})=>a.paragraph,style:{marginBottom:16}}]}))),OQ={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},$v=ae.forwardRef(function(a,h){const{color:_,...S}=Io({props:a,name:"MuiTypography"}),y=!Mle[_],b=Ule({...S,...y&&{color:_}}),{align:D="inherit",className:U,component:x,gutterBottom:q=!1,noWrap:J=!1,paragraph:ee=!1,variant:ue="body1",variantMapping:oe=OQ,...le}=b,pe={...b,align:D,color:_,className:U,component:x,gutterBottom:q,noWrap:J,paragraph:ee,variant:ue,variantMapping:oe},Ne=x||(ee?"p":oe[ue]||OQ[ue])||"span",Ve=xle(pe);return ze.jsx(Vle,{as:Ne,ref:h,className:Ui(Ve.root,U),...le,ownerState:pe,style:{...D!=="inherit"&&{"--Typography-textAlign":D},...le.style}})});function Fle(l){return Ro("MuiAppBar",l)}Co("MuiAppBar",["root","positionFixed","positionAbsolute","positionSticky","positionStatic","positionRelative","colorDefault","colorPrimary","colorSecondary","colorInherit","colorTransparent","colorError","colorInfo","colorSuccess","colorWarning"]);const Ble=l=>{const{color:a,position:h,classes:_}=l,S={root:["root",`color${_i(a)}`,`position${_i(h)}`]};return bo(S,Fle,_)},NQ=(l,a)=>l?`${l?.replace(")","")}, ${a})`:a,jle=Gn(uX,{name:"MuiAppBar",slot:"Root",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[a.root,a[`position${_i(h.position)}`],a[`color${_i(h.color)}`]]}})(uo(({theme:l})=>({display:"flex",flexDirection:"column",width:"100%",boxSizing:"border-box",flexShrink:0,variants:[{props:{position:"fixed"},style:{position:"fixed",zIndex:(l.vars||l).zIndex.appBar,top:0,left:"auto",right:0,"@media print":{position:"absolute"}}},{props:{position:"absolute"},style:{position:"absolute",zIndex:(l.vars||l).zIndex.appBar,top:0,left:"auto",right:0}},{props:{position:"sticky"},style:{position:"sticky",zIndex:(l.vars||l).zIndex.appBar,top:0,left:"auto",right:0}},{props:{position:"static"},style:{position:"static"}},{props:{position:"relative"},style:{position:"relative"}},{props:{color:"inherit"},style:{"--AppBar-color":"inherit"}},{props:{color:"default"},style:{"--AppBar-background":l.vars?l.vars.palette.AppBar.defaultBg:l.palette.grey[100],"--AppBar-color":l.vars?l.vars.palette.text.primary:l.palette.getContrastText(l.palette.grey[100]),...l.applyStyles("dark",{"--AppBar-background":l.vars?l.vars.palette.AppBar.defaultBg:l.palette.grey[900],"--AppBar-color":l.vars?l.vars.palette.text.primary:l.palette.getContrastText(l.palette.grey[900])})}},...Object.entries(l.palette).filter(RE(["contrastText"])).map(([a])=>({props:{color:a},style:{"--AppBar-background":(l.vars??l).palette[a].main,"--AppBar-color":(l.vars??l).palette[a].contrastText}})),{props:a=>a.enableColorOnDark===!0&&!["inherit","transparent"].includes(a.color),style:{backgroundColor:"var(--AppBar-background)",color:"var(--AppBar-color)"}},{props:a=>a.enableColorOnDark===!1&&!["inherit","transparent"].includes(a.color),style:{backgroundColor:"var(--AppBar-background)",color:"var(--AppBar-color)",...l.applyStyles("dark",{backgroundColor:l.vars?NQ(l.vars.palette.AppBar.darkBg,"var(--AppBar-background)"):null,color:l.vars?NQ(l.vars.palette.AppBar.darkColor,"var(--AppBar-color)"):null})}},{props:{color:"transparent"},style:{"--AppBar-background":"transparent","--AppBar-color":"inherit",backgroundColor:"var(--AppBar-background)",color:"var(--AppBar-color)",...l.applyStyles("dark",{backgroundImage:"none"})}}]}))),Gle=ae.forwardRef(function(a,h){const _=Io({props:a,name:"MuiAppBar"}),{className:S,color:y="primary",enableColorOnDark:b=!1,position:D="fixed",...U}=_,x={..._,color:y,position:D,enableColorOnDark:b},q=Ble(x);return ze.jsx(jle,{square:!0,component:"header",ownerState:x,elevation:4,className:Ui(q.root,S,D==="fixed"&&"mui-fixed"),ref:h,...U})});function Zv(l){const{elementType:a,externalSlotProps:h,ownerState:_,skipResolvingSlotProps:S=!1,...y}=l,b=S?{}:Fee(h,_),{props:D,internalRef:U}=Bee({...y,externalSlotProps:b}),x=Fu(U,b?.ref,l.additionalProps?.ref);return Vee(a,{...D,ref:x},_)}function A3(l){return parseInt(ae.version,10)>=19?l?.props?.ref||null:l?.ref||null}function Wle(l){return typeof l=="function"?l():l}const Hle=ae.forwardRef(function(a,h){const{children:_,container:S,disablePortal:y=!1}=a,[b,D]=ae.useState(null),U=Fu(ae.isValidElement(_)?A3(_):null,h);if(NS(()=>{y||D(Wle(S)||document.body)},[S,y]),NS(()=>{if(b&&!y)return bQ(h,b),()=>{bQ(h,null)}},[h,b,y]),y){if(ae.isValidElement(_)){const x={ref:U};return ae.cloneElement(_,x)}return _}return b&&K$.createPortal(_,b)});function W6(l){return parseInt(l,10)||0}const Kle={shadow:{visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"}};function zle(l){for(const a in l)return!1;return!0}function DQ(l){return zle(l)||l.outerHeightStyle===0&&!l.overflowing}const Yle=ae.forwardRef(function(a,h){const{onChange:_,maxRows:S,minRows:y=1,style:b,value:D,...U}=a,{current:x}=ae.useRef(D!=null),q=ae.useRef(null),J=Fu(h,q),ee=ae.useRef(null),ue=ae.useRef(null),oe=ae.useCallback(()=>{const Ae=q.current,Ue=ue.current;if(!Ae||!Ue)return;const qe=ly(Ae).getComputedStyle(Ae);if(qe.width==="0px")return{outerHeightStyle:0,overflowing:!1};Ue.style.width=qe.width,Ue.value=Ae.value||a.placeholder||"x",Ue.value.slice(-1)===`
`&&(Ue.value+=" ");const Te=qe.boxSizing,he=W6(qe.paddingBottom)+W6(qe.paddingTop),_e=W6(qe.borderBottomWidth)+W6(qe.borderTopWidth),ye=Ue.scrollHeight;Ue.value="x";const Ie=Ue.scrollHeight;let $=ye;y&&($=Math.max(Number(y)*Ie,$)),S&&($=Math.min(Number(S)*Ie,$)),$=Math.max($,Ie);const me=$+(Te==="border-box"?he+_e:0),Xe=Math.abs($-ye)<=1;return{outerHeightStyle:me,overflowing:Xe}},[S,y,a.placeholder]),le=bS(()=>{const Ae=q.current,Ue=oe();if(!Ae||!Ue||DQ(Ue))return!1;const ke=Ue.outerHeightStyle;return ee.current!=null&&ee.current!==ke}),pe=ae.useCallback(()=>{const Ae=q.current,Ue=oe();if(!Ae||!Ue||DQ(Ue))return;const ke=Ue.outerHeightStyle;ee.current!==ke&&(ee.current=ke,Ae.style.height=`${ke}px`),Ae.style.overflow=Ue.overflowing?"hidden":""},[oe]),Ne=ae.useRef(-1);NS(()=>{const Ae=Pee(pe),Ue=q?.current;if(!Ue)return;const ke=ly(Ue);ke.addEventListener("resize",Ae);let qe;return typeof ResizeObserver<"u"&&(qe=new ResizeObserver(()=>{le()&&(qe.unobserve(Ue),cancelAnimationFrame(Ne.current),pe(),Ne.current=requestAnimationFrame(()=>{qe.observe(Ue)}))}),qe.observe(Ue)),()=>{Ae.clear(),cancelAnimationFrame(Ne.current),ke.removeEventListener("resize",Ae),qe&&qe.disconnect()}},[oe,pe,le]),NS(()=>{pe()});const Ve=Ae=>{x||pe();const Ue=Ae.target,ke=Ue.value.length,qe=Ue.value.endsWith(`
`),Te=Ue.selectionStart===ke;qe&&Te&&Ue.setSelectionRange(ke,ke),_&&_(Ae)};return ze.jsxs(ae.Fragment,{children:[ze.jsx("textarea",{value:D,onChange:Ve,ref:J,rows:y,style:b,...U}),ze.jsx("textarea",{"aria-hidden":!0,className:a.className,readOnly:!0,ref:ue,tabIndex:-1,style:{...Kle.shadow,...b,paddingTop:0,paddingBottom:0}})]})});function $k({props:l,states:a,muiFormControl:h}){return a.reduce((_,S)=>(_[S]=l[S],h&&typeof l[S]>"u"&&(_[S]=h[S]),_),{})}const hX=ae.createContext(void 0);function eL(){return ae.useContext(hX)}function PQ(l){return l!=null&&!(Array.isArray(l)&&l.length===0)}function CG(l,a=!1){return l&&(PQ(l.value)&&l.value!==""||a&&PQ(l.defaultValue)&&l.defaultValue!=="")}function qle(l){return l.startAdornment}function Xle(l){return Ro("MuiInputBase",l)}const Wk=Co("MuiInputBase",["root","formControl","focused","disabled","adornedStart","adornedEnd","error","sizeSmall","multiline","colorSecondary","fullWidth","hiddenLabel","readOnly","input","inputSizeSmall","inputMultiline","inputTypeSearch","inputAdornedStart","inputAdornedEnd","inputHiddenLabel"]);var kQ;const mW=(l,a)=>{const{ownerState:h}=l;return[a.root,h.formControl&&a.formControl,h.startAdornment&&a.adornedStart,h.endAdornment&&a.adornedEnd,h.error&&a.error,h.size==="small"&&a.sizeSmall,h.multiline&&a.multiline,h.color&&a[`color${_i(h.color)}`],h.fullWidth&&a.fullWidth,h.hiddenLabel&&a.hiddenLabel]},EW=(l,a)=>{const{ownerState:h}=l;return[a.input,h.size==="small"&&a.inputSizeSmall,h.multiline&&a.inputMultiline,h.type==="search"&&a.inputTypeSearch,h.startAdornment&&a.inputAdornedStart,h.endAdornment&&a.inputAdornedEnd,h.hiddenLabel&&a.inputHiddenLabel]},Jle=l=>{const{classes:a,color:h,disabled:_,error:S,endAdornment:y,focused:b,formControl:D,fullWidth:U,hiddenLabel:x,multiline:q,readOnly:J,size:ee,startAdornment:ue,type:oe}=l,le={root:["root",`color${_i(h)}`,_&&"disabled",S&&"error",U&&"fullWidth",b&&"focused",D&&"formControl",ee&&ee!=="medium"&&`size${_i(ee)}`,q&&"multiline",ue&&"adornedStart",y&&"adornedEnd",x&&"hiddenLabel",J&&"readOnly"],input:["input",_&&"disabled",oe==="search"&&"inputTypeSearch",q&&"inputMultiline",ee==="small"&&"inputSizeSmall",x&&"inputHiddenLabel",ue&&"inputAdornedStart",y&&"inputAdornedEnd",J&&"readOnly"]};return bo(le,Xle,a)},gW=Gn("div",{name:"MuiInputBase",slot:"Root",overridesResolver:mW})(uo(({theme:l})=>({...l.typography.body1,color:(l.vars||l).palette.text.primary,lineHeight:"1.4375em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center",[`&.${Wk.disabled}`]:{color:(l.vars||l).palette.text.disabled,cursor:"default"},variants:[{props:({ownerState:a})=>a.multiline,style:{padding:"4px 0 5px"}},{props:({ownerState:a,size:h})=>a.multiline&&h==="small",style:{paddingTop:1}},{props:({ownerState:a})=>a.fullWidth,style:{width:"100%"}}]}))),SW=Gn("input",{name:"MuiInputBase",slot:"Input",overridesResolver:EW})(uo(({theme:l})=>{const a=l.palette.mode==="light",h={color:"currentColor",...l.vars?{opacity:l.vars.opacity.inputPlaceholder}:{opacity:a?.42:.5},transition:l.transitions.create("opacity",{duration:l.transitions.duration.shorter})},_={opacity:"0 !important"},S=l.vars?{opacity:l.vars.opacity.inputPlaceholder}:{opacity:a?.42:.5};return{font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"4px 0 5px",border:0,boxSizing:"content-box",background:"none",height:"1.4375em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%","&::-webkit-input-placeholder":h,"&::-moz-placeholder":h,"&::-ms-input-placeholder":h,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{WebkitAppearance:"none"},[`label[data-shrink=false] + .${Wk.formControl} &`]:{"&::-webkit-input-placeholder":_,"&::-moz-placeholder":_,"&::-ms-input-placeholder":_,"&:focus::-webkit-input-placeholder":S,"&:focus::-moz-placeholder":S,"&:focus::-ms-input-placeholder":S},[`&.${Wk.disabled}`]:{opacity:1,WebkitTextFillColor:(l.vars||l).palette.text.disabled},variants:[{props:({ownerState:y})=>!y.disableInjectingGlobalStyles,style:{animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&:-webkit-autofill":{animationDuration:"5000s",animationName:"mui-auto-fill"}}},{props:{size:"small"},style:{paddingTop:1}},{props:({ownerState:y})=>y.multiline,style:{height:"auto",resize:"none",padding:0,paddingTop:0}},{props:{type:"search"},style:{MozAppearance:"textfield"}}]}})),LQ=aX({"@keyframes mui-auto-fill":{from:{display:"block"}},"@keyframes mui-auto-fill-cancel":{from:{display:"block"}}}),pX=ae.forwardRef(function(a,h){const _=Io({props:a,name:"MuiInputBase"}),{"aria-describedby":S,autoComplete:y,autoFocus:b,className:D,color:U,components:x={},componentsProps:q={},defaultValue:J,disabled:ee,disableInjectingGlobalStyles:ue,endAdornment:oe,error:le,fullWidth:pe=!1,id:Ne,inputComponent:Ve="input",inputProps:Ae={},inputRef:Ue,margin:ke,maxRows:qe,minRows:Te,multiline:he=!1,name:_e,onBlur:ye,onChange:Ie,onClick:$,onFocus:me,onKeyDown:Xe,onKeyUp:ct,placeholder:Me,readOnly:Je,renderSuffix:mt,rows:yt,size:xe,slotProps:it={},slots:ft={},startAdornment:pt,type:xt="text",value:ln,...pn}=_,Zn=Ae.value!=null?Ae.value:ln,{current:ri}=ae.useRef(Zn!=null),si=ae.useRef(),En=ae.useCallback(Ci=>{},[]),oi=Fu(si,Ue,Ae.ref,En),[ui,Kn]=ae.useState(!1),qn=eL(),Zi=$k({props:_,muiFormControl:qn,states:["color","disabled","error","hiddenLabel","size","required","filled"]});Zi.focused=qn?qn.focused:ui,ae.useEffect(()=>{!qn&&ee&&ui&&(Kn(!1),ye&&ye())},[qn,ee,ui,ye]);const Gi=qn&&qn.onFilled,yi=qn&&qn.onEmpty,vn=ae.useCallback(Ci=>{CG(Ci)?Gi&&Gi():yi&&yi()},[Gi,yi]);NS(()=>{ri&&vn({value:Zn})},[Zn,vn,ri]);const xn=Ci=>{me&&me(Ci),Ae.onFocus&&Ae.onFocus(Ci),qn&&qn.onFocus?qn.onFocus(Ci):Kn(!0)},ir=Ci=>{ye&&ye(Ci),Ae.onBlur&&Ae.onBlur(Ci),qn&&qn.onBlur?qn.onBlur(Ci):Kn(!1)},Bi=(Ci,...is)=>{if(!ri){const ur=Ci.target||si.current;if(ur==null)throw new Error(ay(1));vn({value:ur.value})}Ae.onChange&&Ae.onChange(Ci,...is),Ie&&Ie(Ci,...is)};ae.useEffect(()=>{vn(si.current)},[]);const Sn=Ci=>{si.current&&Ci.currentTarget===Ci.target&&si.current.focus(),$&&$(Ci)};let Us=Ve,Rn=Ae;he&&Us==="input"&&(yt?Rn={type:void 0,minRows:yt,maxRows:yt,...Rn}:Rn={type:void 0,maxRows:qe,minRows:Te,...Rn},Us=Yle);const Kt=Ci=>{vn(Ci.animationName==="mui-auto-fill-cancel"?si.current:{value:"x"})};ae.useEffect(()=>{qn&&qn.setAdornedStart(!!pt)},[qn,pt]);const wt={..._,color:Zi.color||"primary",disabled:Zi.disabled,endAdornment:oe,error:Zi.error,focused:Zi.focused,formControl:qn,fullWidth:pe,hiddenLabel:Zi.hiddenLabel,multiline:he,size:Zi.size,startAdornment:pt,type:xt},Ot=Jle(wt),un=ft.root||x.Root||gW,rn=it.root||q.root||{},Vn=ft.input||x.Input||SW;return Rn={...Rn,...it.input??q.input},ze.jsxs(ae.Fragment,{children:[!ue&&typeof LQ=="function"&&(kQ||(kQ=ze.jsx(LQ,{}))),ze.jsxs(un,{...rn,ref:h,onClick:Sn,...pn,...!wb(un)&&{ownerState:{...wt,...rn.ownerState}},className:Ui(Ot.root,rn.className,D,Je&&"MuiInputBase-readOnly"),children:[pt,ze.jsx(hX.Provider,{value:null,children:ze.jsx(Vn,{"aria-invalid":Zi.error,"aria-describedby":S,autoComplete:y,autoFocus:b,defaultValue:J,disabled:Zi.disabled,id:Ne,onAnimationStart:Kt,name:_e,placeholder:Me,readOnly:Je,required:Zi.required,rows:yt,value:Zn,onKeyDown:Xe,onKeyUp:ct,type:xt,...Rn,...!wb(Vn)&&{as:Us,ownerState:{...wt,...Rn.ownerState}},ref:oi,className:Ui(Ot.input,Rn.className,Je&&"MuiInputBase-readOnly"),onBlur:ir,onChange:Bi,onFocus:xn})}),oe,mt?mt({...Zi,startAdornment:pt}):null]})]})});function Qle(l){return Ro("MuiInput",l)}const Ij={...Wk,...Co("MuiInput",["root","underline","input"])};function Zle(l){return Ro("MuiOutlinedInput",l)}const _S={...Wk,...Co("MuiOutlinedInput",["root","notchedOutline","input"])};function $le(l){return Ro("MuiFilledInput",l)}const V0={...Wk,...Co("MuiFilledInput",["root","underline","input","adornedStart","adornedEnd","sizeSmall","multiline","hiddenLabel"])},ede=qce(ze.jsx("path",{d:"M7 10l5 5 5-5z"})),tde={entering:{opacity:1},entered:{opacity:1}},nde=ae.forwardRef(function(a,h){const _=oX(),S={enter:_.transitions.duration.enteringScreen,exit:_.transitions.duration.leavingScreen},{addEndListener:y,appear:b=!0,children:D,easing:U,in:x,onEnter:q,onEntered:J,onEntering:ee,onExit:ue,onExited:oe,onExiting:le,style:pe,timeout:Ne=S,TransitionComponent:Ve=PS,...Ae}=a,Ue=ae.useRef(null),ke=Fu(Ue,A3(D),h),qe=Xe=>ct=>{if(Xe){const Me=Ue.current;ct===void 0?Xe(Me):Xe(Me,ct)}},Te=qe(ee),he=qe((Xe,ct)=>{xee(Xe);const Me=vG({style:pe,timeout:Ne,easing:U},{mode:"enter"});Xe.style.webkitTransition=_.transitions.create("opacity",Me),Xe.style.transition=_.transitions.create("opacity",Me),q&&q(Xe,ct)}),_e=qe(J),ye=qe(le),Ie=qe(Xe=>{const ct=vG({style:pe,timeout:Ne,easing:U},{mode:"exit"});Xe.style.webkitTransition=_.transitions.create("opacity",ct),Xe.style.transition=_.transitions.create("opacity",ct),ue&&ue(Xe)}),$=qe(oe),me=Xe=>{y&&y(Ue.current,Xe)};return ze.jsx(Ve,{appear:b,in:x,nodeRef:Ue,onEnter:he,onEntered:_e,onEntering:Te,onExit:Ie,onExited:$,onExiting:ye,addEndListener:me,timeout:Ne,...Ae,children:(Xe,{ownerState:ct,...Me})=>ae.cloneElement(D,{style:{opacity:0,visibility:Xe==="exited"&&!x?"hidden":void 0,...tde[Xe],...pe,...D.props.style},ref:ke,...Me})})});function ide(l){return Ro("MuiBackdrop",l)}Co("MuiBackdrop",["root","invisible"]);const rde=l=>{const{classes:a,invisible:h}=l;return bo({root:["root",h&&"invisible"]},ide,a)},sde=Gn("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[a.root,h.invisible&&a.invisible]}})({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent",variants:[{props:{invisible:!0},style:{backgroundColor:"transparent"}}]}),ode=ae.forwardRef(function(a,h){const _=Io({props:a,name:"MuiBackdrop"}),{children:S,className:y,component:b="div",invisible:D=!1,open:U,components:x={},componentsProps:q={},slotProps:J={},slots:ee={},TransitionComponent:ue,transitionDuration:oe,...le}=_,pe={..._,component:b,invisible:D},Ne=rde(pe),Ve={transition:ue,root:x.Root,...ee},Ae={...q,...J},Ue={component:b,slots:Ve,slotProps:Ae},[ke,qe]=Wd("root",{elementType:sde,externalForwardedProps:Ue,className:Ui(Ne.root,y),ownerState:pe}),[Te,he]=Wd("transition",{elementType:nde,externalForwardedProps:Ue,ownerState:pe});return ze.jsx(Te,{in:U,timeout:oe,...le,...he,children:ze.jsx(ke,{"aria-hidden":!0,...qe,classes:Ne,ref:h,children:S})})}),ade=Co("MuiBox",["root"]),cde=fW(),mS=mae({themeId:RS,defaultTheme:cde,defaultClassName:ade.root,generateClassName:pee.generate});function lde(l){return Ro("MuiButton",l)}const F0=Co("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","colorPrimary","colorSecondary","colorSuccess","colorError","colorInfo","colorWarning","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","icon","iconSizeSmall","iconSizeMedium","iconSizeLarge","loading","loadingWrapper","loadingIconPlaceholder","loadingIndicator","loadingPositionCenter","loadingPositionStart","loadingPositionEnd"]),dde=ae.createContext({}),ude=ae.createContext(void 0),hde=l=>{const{color:a,disableElevation:h,fullWidth:_,size:S,variant:y,loading:b,loadingPosition:D,classes:U}=l,x={root:["root",b&&"loading",y,`${y}${_i(a)}`,`size${_i(S)}`,`${y}Size${_i(S)}`,`color${_i(a)}`,h&&"disableElevation",_&&"fullWidth",b&&`loadingPosition${_i(D)}`],startIcon:["icon","startIcon",`iconSize${_i(S)}`],endIcon:["icon","endIcon",`iconSize${_i(S)}`],loadingIndicator:["loadingIndicator"],loadingWrapper:["loadingWrapper"]},q=bo(x,lde,U);return{...U,...q}},jee=[{props:{size:"small"},style:{"& > *:nth-of-type(1)":{fontSize:18}}},{props:{size:"medium"},style:{"& > *:nth-of-type(1)":{fontSize:20}}},{props:{size:"large"},style:{"& > *:nth-of-type(1)":{fontSize:22}}}],pde=Gn(Rle,{shouldForwardProp:l=>yE(l)||l==="classes",name:"MuiButton",slot:"Root",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[a.root,a[h.variant],a[`${h.variant}${_i(h.color)}`],a[`size${_i(h.size)}`],a[`${h.variant}Size${_i(h.size)}`],h.color==="inherit"&&a.colorInherit,h.disableElevation&&a.disableElevation,h.fullWidth&&a.fullWidth,h.loading&&a.loading]}})(uo(({theme:l})=>{const a=l.palette.mode==="light"?l.palette.grey[300]:l.palette.grey[800],h=l.palette.mode==="light"?l.palette.grey.A100:l.palette.grey[700];return{...l.typography.button,minWidth:64,padding:"6px 16px",border:0,borderRadius:(l.vars||l).shape.borderRadius,transition:l.transitions.create(["background-color","box-shadow","border-color","color"],{duration:l.transitions.duration.short}),"&:hover":{textDecoration:"none"},[`&.${F0.disabled}`]:{color:(l.vars||l).palette.action.disabled},variants:[{props:{variant:"contained"},style:{color:"var(--variant-containedColor)",backgroundColor:"var(--variant-containedBg)",boxShadow:(l.vars||l).shadows[2],"&:hover":{boxShadow:(l.vars||l).shadows[4],"@media (hover: none)":{boxShadow:(l.vars||l).shadows[2]}},"&:active":{boxShadow:(l.vars||l).shadows[8]},[`&.${F0.focusVisible}`]:{boxShadow:(l.vars||l).shadows[6]},[`&.${F0.disabled}`]:{color:(l.vars||l).palette.action.disabled,boxShadow:(l.vars||l).shadows[0],backgroundColor:(l.vars||l).palette.action.disabledBackground}}},{props:{variant:"outlined"},style:{padding:"5px 15px",border:"1px solid currentColor",borderColor:"var(--variant-outlinedBorder, currentColor)",backgroundColor:"var(--variant-outlinedBg)",color:"var(--variant-outlinedColor)",[`&.${F0.disabled}`]:{border:`1px solid ${(l.vars||l).palette.action.disabledBackground}`}}},{props:{variant:"text"},style:{padding:"6px 8px",color:"var(--variant-textColor)",backgroundColor:"var(--variant-textBg)"}},...Object.entries(l.palette).filter(RE()).map(([_])=>({props:{color:_},style:{"--variant-textColor":(l.vars||l).palette[_].main,"--variant-outlinedColor":(l.vars||l).palette[_].main,"--variant-outlinedBorder":l.alpha((l.vars||l).palette[_].main,.5),"--variant-containedColor":(l.vars||l).palette[_].contrastText,"--variant-containedBg":(l.vars||l).palette[_].main,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":(l.vars||l).palette[_].dark,"--variant-textBg":l.alpha((l.vars||l).palette[_].main,(l.vars||l).palette.action.hoverOpacity),"--variant-outlinedBorder":(l.vars||l).palette[_].main,"--variant-outlinedBg":l.alpha((l.vars||l).palette[_].main,(l.vars||l).palette.action.hoverOpacity)}}}})),{props:{color:"inherit"},style:{color:"inherit",borderColor:"currentColor","--variant-containedBg":l.vars?l.vars.palette.Button.inheritContainedBg:a,"@media (hover: hover)":{"&:hover":{"--variant-containedBg":l.vars?l.vars.palette.Button.inheritContainedHoverBg:h,"--variant-textBg":l.alpha((l.vars||l).palette.text.primary,(l.vars||l).palette.action.hoverOpacity),"--variant-outlinedBg":l.alpha((l.vars||l).palette.text.primary,(l.vars||l).palette.action.hoverOpacity)}}}},{props:{size:"small",variant:"text"},style:{padding:"4px 5px",fontSize:l.typography.pxToRem(13)}},{props:{size:"large",variant:"text"},style:{padding:"8px 11px",fontSize:l.typography.pxToRem(15)}},{props:{size:"small",variant:"outlined"},style:{padding:"3px 9px",fontSize:l.typography.pxToRem(13)}},{props:{size:"large",variant:"outlined"},style:{padding:"7px 21px",fontSize:l.typography.pxToRem(15)}},{props:{size:"small",variant:"contained"},style:{padding:"4px 10px",fontSize:l.typography.pxToRem(13)}},{props:{size:"large",variant:"contained"},style:{padding:"8px 22px",fontSize:l.typography.pxToRem(15)}},{props:{disableElevation:!0},style:{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${F0.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${F0.disabled}`]:{boxShadow:"none"}}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{loadingPosition:"center"},style:{transition:l.transitions.create(["background-color","box-shadow","border-color"],{duration:l.transitions.duration.short}),[`&.${F0.loading}`]:{color:"transparent"}}}]}})),fde=Gn("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[a.startIcon,h.loading&&a.startIconLoadingStart,a[`iconSize${_i(h.size)}`]]}})(({theme:l})=>({display:"inherit",marginRight:8,marginLeft:-4,variants:[{props:{size:"small"},style:{marginLeft:-2}},{props:{loadingPosition:"start",loading:!0},style:{transition:l.transitions.create(["opacity"],{duration:l.transitions.duration.short}),opacity:0}},{props:{loadingPosition:"start",loading:!0,fullWidth:!0},style:{marginRight:-8}},...jee]})),_de=Gn("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[a.endIcon,h.loading&&a.endIconLoadingEnd,a[`iconSize${_i(h.size)}`]]}})(({theme:l})=>({display:"inherit",marginRight:-4,marginLeft:8,variants:[{props:{size:"small"},style:{marginRight:-2}},{props:{loadingPosition:"end",loading:!0},style:{transition:l.transitions.create(["opacity"],{duration:l.transitions.duration.short}),opacity:0}},{props:{loadingPosition:"end",loading:!0,fullWidth:!0},style:{marginLeft:-8}},...jee]})),mde=Gn("span",{name:"MuiButton",slot:"LoadingIndicator"})(({theme:l})=>({display:"none",position:"absolute",visibility:"visible",variants:[{props:{loading:!0},style:{display:"flex"}},{props:{loadingPosition:"start"},style:{left:14}},{props:{loadingPosition:"start",size:"small"},style:{left:10}},{props:{variant:"text",loadingPosition:"start"},style:{left:6}},{props:{loadingPosition:"center"},style:{left:"50%",transform:"translate(-50%)",color:(l.vars||l).palette.action.disabled}},{props:{loadingPosition:"end"},style:{right:14}},{props:{loadingPosition:"end",size:"small"},style:{right:10}},{props:{variant:"text",loadingPosition:"end"},style:{right:6}},{props:{loadingPosition:"start",fullWidth:!0},style:{position:"relative",left:-10}},{props:{loadingPosition:"end",fullWidth:!0},style:{position:"relative",right:-10}}]})),MQ=Gn("span",{name:"MuiButton",slot:"LoadingIconPlaceholder"})({display:"inline-block",width:"1em",height:"1em"}),s3=ae.forwardRef(function(a,h){const _=ae.useContext(dde),S=ae.useContext(ude),y=r3(_,a),b=Io({props:y,name:"MuiButton"}),{children:D,color:U="primary",component:x="button",className:q,disabled:J=!1,disableElevation:ee=!1,disableFocusRipple:ue=!1,endIcon:oe,focusVisibleClassName:le,fullWidth:pe=!1,id:Ne,loading:Ve=null,loadingIndicator:Ae,loadingPosition:Ue="center",size:ke="medium",startIcon:qe,type:Te,variant:he="text",..._e}=b,ye=pW(Ne),Ie=Ae??ze.jsx(kle,{"aria-labelledby":ye,color:"inherit",size:16}),$={...b,color:U,component:x,disabled:J,disableElevation:ee,disableFocusRipple:ue,fullWidth:pe,loading:Ve,loadingIndicator:Ie,loadingPosition:Ue,size:ke,type:Te,variant:he},me=hde($),Xe=(qe||Ve&&Ue==="start")&&ze.jsx(fde,{className:me.startIcon,ownerState:$,children:qe||ze.jsx(MQ,{className:me.loadingIconPlaceholder,ownerState:$})}),ct=(oe||Ve&&Ue==="end")&&ze.jsx(_de,{className:me.endIcon,ownerState:$,children:oe||ze.jsx(MQ,{className:me.loadingIconPlaceholder,ownerState:$})}),Me=S||"",Je=typeof Ve=="boolean"?ze.jsx("span",{className:me.loadingWrapper,style:{display:"contents"},children:Ve&&ze.jsx(mde,{className:me.loadingIndicator,ownerState:$,children:Ie})}):null;return ze.jsxs(pde,{ownerState:$,className:Ui(_.className,me.root,q,Me),component:x,disabled:J||Ve,focusRipple:!ue,focusVisibleClassName:Ui(me.focusVisible,le),ref:h,type:Te,id:Ve?ye:Ne,..._e,classes:me,children:[Xe,Ue!=="end"&&Je,D,Ue==="end"&&Je,ct]})}),Ede=ace({createStyledComponent:Gn("div",{name:"MuiContainer",slot:"Root",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[a.root,a[`maxWidth${_i(String(h.maxWidth))}`],h.fixed&&a.fixed,h.disableGutters&&a.disableGutters]}}),useThemeProps:l=>Io({props:l,name:"MuiContainer"})}),c7=typeof aX({})=="function",gde=(l,a)=>({WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",boxSizing:"border-box",WebkitTextSizeAdjust:"100%",...a&&!l.vars&&{colorScheme:l.palette.mode}}),Sde=l=>({color:(l.vars||l).palette.text.primary,...l.typography.body1,backgroundColor:(l.vars||l).palette.background.default,"@media print":{backgroundColor:(l.vars||l).palette.common.white}}),Gee=(l,a=!1)=>{const h={};a&&l.colorSchemes&&typeof l.getColorSchemeSelector=="function"&&Object.entries(l.colorSchemes).forEach(([y,b])=>{const D=l.getColorSchemeSelector(y);D.startsWith("@")?h[D]={":root":{colorScheme:b.palette?.mode}}:h[D.replace(/\s*&/,"")]={colorScheme:b.palette?.mode}});let _={html:gde(l,a),"*, *::before, *::after":{boxSizing:"inherit"},"strong, b":{fontWeight:l.typography.fontWeightBold},body:{margin:0,...Sde(l),"&::backdrop":{backgroundColor:(l.vars||l).palette.background.default}},...h};const S=l.components?.MuiCssBaseline?.styleOverrides;return S&&(_=[_,S]),_},aG="mui-ecs",Tde=l=>{const a=Gee(l,!1),h=Array.isArray(a)?a[0]:a;return!l.vars&&h&&(h.html[`:root:has(${aG})`]={colorScheme:l.palette.mode}),l.colorSchemes&&Object.entries(l.colorSchemes).forEach(([_,S])=>{const y=l.getColorSchemeSelector(_);y.startsWith("@")?h[y]={[`:root:not(:has(.${aG}))`]:{colorScheme:S.palette?.mode}}:h[y.replace(/\s*&/,"")]={[`&:not(:has(.${aG}))`]:{colorScheme:S.palette?.mode}}}),a},vde=aX(c7?({theme:l,enableColorScheme:a})=>Gee(l,a):({theme:l})=>Tde(l));function yde(l){const a=Io({props:l,name:"MuiCssBaseline"}),{children:h,enableColorScheme:_=!1}=a;return ze.jsxs(ae.Fragment,{children:[c7&&ze.jsx(vde,{enableColorScheme:_}),!c7&&!_&&ze.jsx("span",{className:aG,style:{display:"none"}}),h]})}function Wee(l=window){const a=l.document.documentElement.clientWidth;return l.innerWidth-a}function Rde(l){const a=xu(l);return a.body===l?ly(l).innerWidth>a.documentElement.clientWidth:l.scrollHeight>l.clientHeight}function Bj(l,a){a?l.setAttribute("aria-hidden","true"):l.removeAttribute("aria-hidden")}function UQ(l){return parseInt(ly(l).getComputedStyle(l).paddingRight,10)||0}function Cde(l){const h=["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].includes(l.tagName),_=l.tagName==="INPUT"&&l.getAttribute("type")==="hidden";return h||_}function xQ(l,a,h,_,S){const y=[a,h,..._];[].forEach.call(l.children,b=>{const D=!y.includes(b),U=!Cde(b);D&&U&&Bj(b,S)})}function Cq(l,a){let h=-1;return l.some((_,S)=>a(_)?(h=S,!0):!1),h}function bde(l,a){const h=[],_=l.container;if(!a.disableScrollLock){if(Rde(_)){const b=Wee(ly(_));h.push({value:_.style.paddingRight,property:"padding-right",el:_}),_.style.paddingRight=`${UQ(_)+b}px`;const D=xu(_).querySelectorAll(".mui-fixed");[].forEach.call(D,U=>{h.push({value:U.style.paddingRight,property:"padding-right",el:U}),U.style.paddingRight=`${UQ(U)+b}px`})}let y;if(_.parentNode instanceof DocumentFragment)y=xu(_).body;else{const b=_.parentElement,D=ly(_);y=b?.nodeName==="HTML"&&D.getComputedStyle(b).overflowY==="scroll"?b:_}h.push({value:y.style.overflow,property:"overflow",el:y},{value:y.style.overflowX,property:"overflow-x",el:y},{value:y.style.overflowY,property:"overflow-y",el:y}),y.style.overflow="hidden"}return()=>{h.forEach(({value:y,el:b,property:D})=>{y?b.style.setProperty(D,y):b.style.removeProperty(D)})}}function Ide(l){const a=[];return[].forEach.call(l.children,h=>{h.getAttribute("aria-hidden")==="true"&&a.push(h)}),a}class Ade{constructor(){this.modals=[],this.containers=[]}add(a,h){let _=this.modals.indexOf(a);if(_!==-1)return _;_=this.modals.length,this.modals.push(a),a.modalRef&&Bj(a.modalRef,!1);const S=Ide(h);xQ(h,a.mount,a.modalRef,S,!0);const y=Cq(this.containers,b=>b.container===h);return y!==-1?(this.containers[y].modals.push(a),_):(this.containers.push({modals:[a],container:h,restore:null,hiddenSiblings:S}),_)}mount(a,h){const _=Cq(this.containers,y=>y.modals.includes(a)),S=this.containers[_];S.restore||(S.restore=bde(S,h))}remove(a,h=!0){const _=this.modals.indexOf(a);if(_===-1)return _;const S=Cq(this.containers,b=>b.modals.includes(a)),y=this.containers[S];if(y.modals.splice(y.modals.indexOf(a),1),this.modals.splice(_,1),y.modals.length===0)y.restore&&y.restore(),a.modalRef&&Bj(a.modalRef,h),xQ(y.container,a.mount,a.modalRef,y.hiddenSiblings,!1),this.containers.splice(S,1);else{const b=y.modals[y.modals.length-1];b.modalRef&&Bj(b.modalRef,!1)}return _}isTopModal(a){return this.modals.length>0&&this.modals[this.modals.length-1]===a}}const wde=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function Ode(l){const a=parseInt(l.getAttribute("tabindex")||"",10);return Number.isNaN(a)?l.contentEditable==="true"||(l.nodeName==="AUDIO"||l.nodeName==="VIDEO"||l.nodeName==="DETAILS")&&l.getAttribute("tabindex")===null?0:l.tabIndex:a}function Nde(l){if(l.tagName!=="INPUT"||l.type!=="radio"||!l.name)return!1;const a=_=>l.ownerDocument.querySelector(`input[type="radio"]${_}`);let h=a(`[name="${l.name}"]:checked`);return h||(h=a(`[name="${l.name}"]`)),h!==l}function Dde(l){return!(l.disabled||l.tagName==="INPUT"&&l.type==="hidden"||Nde(l))}function Pde(l){const a=[],h=[];return Array.from(l.querySelectorAll(wde)).forEach((_,S)=>{const y=Ode(_);y===-1||!Dde(_)||(y===0?a.push(_):h.push({documentOrder:S,tabIndex:y,node:_}))}),h.sort((_,S)=>_.tabIndex===S.tabIndex?_.documentOrder-S.documentOrder:_.tabIndex-S.tabIndex).map(_=>_.node).concat(a)}function kde(){return!0}function Lde(l){const{children:a,disableAutoFocus:h=!1,disableEnforceFocus:_=!1,disableRestoreFocus:S=!1,getTabbable:y=Pde,isEnabled:b=kde,open:D}=l,U=ae.useRef(!1),x=ae.useRef(null),q=ae.useRef(null),J=ae.useRef(null),ee=ae.useRef(null),ue=ae.useRef(!1),oe=ae.useRef(null),le=Fu(A3(a),oe),pe=ae.useRef(null);ae.useEffect(()=>{!D||!oe.current||(ue.current=!h)},[h,D]),ae.useEffect(()=>{if(!D||!oe.current)return;const Ae=xu(oe.current);return oe.current.contains(Ae.activeElement)||(oe.current.hasAttribute("tabIndex")||oe.current.setAttribute("tabIndex","-1"),ue.current&&oe.current.focus()),()=>{S||(J.current&&J.current.focus&&(U.current=!0,J.current.focus()),J.current=null)}},[D]),ae.useEffect(()=>{if(!D||!oe.current)return;const Ae=xu(oe.current),Ue=Te=>{pe.current=Te,!(_||!b()||Te.key!=="Tab")&&Ae.activeElement===oe.current&&Te.shiftKey&&(U.current=!0,q.current&&q.current.focus())},ke=()=>{const Te=oe.current;if(Te===null)return;if(!Ae.hasFocus()||!b()||U.current){U.current=!1;return}if(Te.contains(Ae.activeElement)||_&&Ae.activeElement!==x.current&&Ae.activeElement!==q.current)return;if(Ae.activeElement!==ee.current)ee.current=null;else if(ee.current!==null)return;if(!ue.current)return;let he=[];if((Ae.activeElement===x.current||Ae.activeElement===q.current)&&(he=y(oe.current)),he.length>0){const _e=!!(pe.current?.shiftKey&&pe.current?.key==="Tab"),ye=he[0],Ie=he[he.length-1];typeof ye!="string"&&typeof Ie!="string"&&(_e?Ie.focus():ye.focus())}else Te.focus()};Ae.addEventListener("focusin",ke),Ae.addEventListener("keydown",Ue,!0);const qe=setInterval(()=>{Ae.activeElement&&Ae.activeElement.tagName==="BODY"&&ke()},50);return()=>{clearInterval(qe),Ae.removeEventListener("focusin",ke),Ae.removeEventListener("keydown",Ue,!0)}},[h,_,S,b,D,y]);const Ne=Ae=>{J.current===null&&(J.current=Ae.relatedTarget),ue.current=!0,ee.current=Ae.target;const Ue=a.props.onFocus;Ue&&Ue(Ae)},Ve=Ae=>{J.current===null&&(J.current=Ae.relatedTarget),ue.current=!0};return ze.jsxs(ae.Fragment,{children:[ze.jsx("div",{tabIndex:D?0:-1,onFocus:Ve,ref:x,"data-testid":"sentinelStart"}),ae.cloneElement(a,{ref:le,onFocus:Ne}),ze.jsx("div",{tabIndex:D?0:-1,onFocus:Ve,ref:q,"data-testid":"sentinelEnd"})]})}function Mde(l){return typeof l=="function"?l():l}function Ude(l){return l?l.props.hasOwnProperty("in"):!1}const VQ=()=>{},H6=new Ade;function xde(l){const{container:a,disableEscapeKeyDown:h=!1,disableScrollLock:_=!1,closeAfterTransition:S=!1,onTransitionEnter:y,onTransitionExited:b,children:D,onClose:U,open:x,rootRef:q}=l,J=ae.useRef({}),ee=ae.useRef(null),ue=ae.useRef(null),oe=Fu(ue,q),[le,pe]=ae.useState(!x),Ne=Ude(D);let Ve=!0;(l["aria-hidden"]==="false"||l["aria-hidden"]===!1)&&(Ve=!1);const Ae=()=>xu(ee.current),Ue=()=>(J.current.modalRef=ue.current,J.current.mount=ee.current,J.current),ke=()=>{H6.mount(Ue(),{disableScrollLock:_}),ue.current&&(ue.current.scrollTop=0)},qe=bS(()=>{const ct=Mde(a)||Ae().body;H6.add(Ue(),ct),ue.current&&ke()}),Te=()=>H6.isTopModal(Ue()),he=bS(ct=>{ee.current=ct,ct&&(x&&Te()?ke():ue.current&&Bj(ue.current,Ve))}),_e=ae.useCallback(()=>{H6.remove(Ue(),Ve)},[Ve]);ae.useEffect(()=>()=>{_e()},[_e]),ae.useEffect(()=>{x?qe():(!Ne||!S)&&_e()},[x,_e,Ne,S,qe]);const ye=ct=>Me=>{ct.onKeyDown?.(Me),!(Me.key!=="Escape"||Me.which===229||!Te())&&(h||(Me.stopPropagation(),U&&U(Me,"escapeKeyDown")))},Ie=ct=>Me=>{ct.onClick?.(Me),Me.target===Me.currentTarget&&U&&U(Me,"backdropClick")};return{getRootProps:(ct={})=>{const Me=Fj(l);delete Me.onTransitionEnter,delete Me.onTransitionExited;const Je={...Me,...ct};return{role:"presentation",...Je,onKeyDown:ye(Je),ref:oe}},getBackdropProps:(ct={})=>{const Me=ct;return{"aria-hidden":!0,...Me,onClick:Ie(Me),open:x}},getTransitionProps:()=>{const ct=()=>{pe(!1),y&&y()},Me=()=>{pe(!0),b&&b(),S&&_e()};return{onEnter:CQ(ct,D?.props.onEnter??VQ),onExited:CQ(Me,D?.props.onExited??VQ)}},rootRef:oe,portalRef:he,isTopModal:Te,exited:le,hasTransition:Ne}}function Vde(l){return Ro("MuiModal",l)}Co("MuiModal",["root","hidden","backdrop"]);const Fde=l=>{const{open:a,exited:h,classes:_}=l;return bo({root:["root",!a&&h&&"hidden"],backdrop:["backdrop"]},Vde,_)},Bde=Gn("div",{name:"MuiModal",slot:"Root",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[a.root,!h.open&&h.exited&&a.hidden]}})(uo(({theme:l})=>({position:"fixed",zIndex:(l.vars||l).zIndex.modal,right:0,bottom:0,top:0,left:0,variants:[{props:({ownerState:a})=>!a.open&&a.exited,style:{visibility:"hidden"}}]}))),jde=Gn(ode,{name:"MuiModal",slot:"Backdrop"})({zIndex:-1}),Gde=ae.forwardRef(function(a,h){const _=Io({name:"MuiModal",props:a}),{BackdropComponent:S=jde,BackdropProps:y,classes:b,className:D,closeAfterTransition:U=!1,children:x,container:q,component:J,components:ee={},componentsProps:ue={},disableAutoFocus:oe=!1,disableEnforceFocus:le=!1,disableEscapeKeyDown:pe=!1,disablePortal:Ne=!1,disableRestoreFocus:Ve=!1,disableScrollLock:Ae=!1,hideBackdrop:Ue=!1,keepMounted:ke=!1,onClose:qe,onTransitionEnter:Te,onTransitionExited:he,open:_e,slotProps:ye={},slots:Ie={},theme:$,...me}=_,Xe={..._,closeAfterTransition:U,disableAutoFocus:oe,disableEnforceFocus:le,disableEscapeKeyDown:pe,disablePortal:Ne,disableRestoreFocus:Ve,disableScrollLock:Ae,hideBackdrop:Ue,keepMounted:ke},{getRootProps:ct,getBackdropProps:Me,getTransitionProps:Je,portalRef:mt,isTopModal:yt,exited:xe,hasTransition:it}=xde({...Xe,rootRef:h}),ft={...Xe,exited:xe},pt=Fde(ft),xt={};if(x.props.tabIndex===void 0&&(xt.tabIndex="-1"),it){const{onEnter:En,onExited:oi}=Je();xt.onEnter=En,xt.onExited=oi}const ln={slots:{root:ee.Root,backdrop:ee.Backdrop,...Ie},slotProps:{...ue,...ye}},[pn,Zn]=Wd("root",{ref:h,elementType:Bde,externalForwardedProps:{...ln,...me,component:J},getSlotProps:ct,ownerState:ft,className:Ui(D,pt?.root,!ft.open&&ft.exited&&pt?.hidden)}),[ri,si]=Wd("backdrop",{ref:y?.ref,elementType:S,externalForwardedProps:ln,shouldForwardComponentProp:!0,additionalProps:y,getSlotProps:En=>Me({...En,onClick:oi=>{En?.onClick&&En.onClick(oi)}}),className:Ui(y?.className,pt?.backdrop),ownerState:ft});return!ke&&!_e&&(!it||xe)?null:ze.jsx(Hle,{ref:mt,container:q,disablePortal:Ne,children:ze.jsxs(pn,{...Zn,children:[!Ue&&S?ze.jsx(ri,{...si}):null,ze.jsx(Lde,{disableEnforceFocus:le,disableAutoFocus:oe,disableRestoreFocus:Ve,isEnabled:yt,open:_e,children:ae.cloneElement(x,xt)})]})})}),Wde=l=>{const{classes:a,disableUnderline:h,startAdornment:_,endAdornment:S,size:y,hiddenLabel:b,multiline:D}=l,U={root:["root",!h&&"underline",_&&"adornedStart",S&&"adornedEnd",y==="small"&&`size${_i(y)}`,b&&"hiddenLabel",D&&"multiline"],input:["input"]},x=bo(U,$le,a);return{...a,...x}},Hde=Gn(gW,{shouldForwardProp:l=>yE(l)||l==="classes",name:"MuiFilledInput",slot:"Root",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[...mW(l,a),!h.disableUnderline&&a.underline]}})(uo(({theme:l})=>{const a=l.palette.mode==="light",h=a?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",_=a?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",S=a?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)",y=a?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)";return{position:"relative",backgroundColor:l.vars?l.vars.palette.FilledInput.bg:_,borderTopLeftRadius:(l.vars||l).shape.borderRadius,borderTopRightRadius:(l.vars||l).shape.borderRadius,transition:l.transitions.create("background-color",{duration:l.transitions.duration.shorter,easing:l.transitions.easing.easeOut}),"&:hover":{backgroundColor:l.vars?l.vars.palette.FilledInput.hoverBg:S,"@media (hover: none)":{backgroundColor:l.vars?l.vars.palette.FilledInput.bg:_}},[`&.${V0.focused}`]:{backgroundColor:l.vars?l.vars.palette.FilledInput.bg:_},[`&.${V0.disabled}`]:{backgroundColor:l.vars?l.vars.palette.FilledInput.disabledBg:y},variants:[{props:({ownerState:b})=>!b.disableUnderline,style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:l.transitions.create("transform",{duration:l.transitions.duration.shorter,easing:l.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${V0.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${V0.error}`]:{"&::before, &::after":{borderBottomColor:(l.vars||l).palette.error.main}},"&::before":{borderBottom:`1px solid ${l.vars?l.alpha(l.vars.palette.common.onBackground,l.vars.opacity.inputUnderline):h}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:l.transitions.create("border-bottom-color",{duration:l.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${V0.disabled}, .${V0.error}):before`]:{borderBottom:`1px solid ${(l.vars||l).palette.text.primary}`},[`&.${V0.disabled}:before`]:{borderBottomStyle:"dotted"}}},...Object.entries(l.palette).filter(RE()).map(([b])=>({props:{disableUnderline:!1,color:b},style:{"&::after":{borderBottom:`2px solid ${(l.vars||l).palette[b]?.main}`}}})),{props:({ownerState:b})=>b.startAdornment,style:{paddingLeft:12}},{props:({ownerState:b})=>b.endAdornment,style:{paddingRight:12}},{props:({ownerState:b})=>b.multiline,style:{padding:"25px 12px 8px"}},{props:({ownerState:b,size:D})=>b.multiline&&D==="small",style:{paddingTop:21,paddingBottom:4}},{props:({ownerState:b})=>b.multiline&&b.hiddenLabel,style:{paddingTop:16,paddingBottom:17}},{props:({ownerState:b})=>b.multiline&&b.hiddenLabel&&b.size==="small",style:{paddingTop:8,paddingBottom:9}}]}})),Kde=Gn(SW,{name:"MuiFilledInput",slot:"Input",overridesResolver:EW})(uo(({theme:l})=>({paddingTop:25,paddingRight:12,paddingBottom:8,paddingLeft:12,...!l.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:l.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:l.palette.mode==="light"?null:"#fff",caretColor:l.palette.mode==="light"?null:"#fff",borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"}},...l.vars&&{"&:-webkit-autofill":{borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"},[l.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},variants:[{props:{size:"small"},style:{paddingTop:21,paddingBottom:4}},{props:({ownerState:a})=>a.hiddenLabel,style:{paddingTop:16,paddingBottom:17}},{props:({ownerState:a})=>a.startAdornment,style:{paddingLeft:0}},{props:({ownerState:a})=>a.endAdornment,style:{paddingRight:0}},{props:({ownerState:a})=>a.hiddenLabel&&a.size==="small",style:{paddingTop:8,paddingBottom:9}},{props:({ownerState:a})=>a.multiline,style:{paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0}}]}))),fX=ae.forwardRef(function(a,h){const _=Io({props:a,name:"MuiFilledInput"}),{disableUnderline:S=!1,components:y={},componentsProps:b,fullWidth:D=!1,hiddenLabel:U,inputComponent:x="input",multiline:q=!1,slotProps:J,slots:ee={},type:ue="text",...oe}=_,le={..._,disableUnderline:S,fullWidth:D,inputComponent:x,multiline:q,type:ue},pe=Wde(_),Ne={root:{ownerState:le},input:{ownerState:le}},Ve=J??b?zd(Ne,J??b):Ne,Ae=ee.root??y.Root??Hde,Ue=ee.input??y.Input??Kde;return ze.jsx(pX,{slots:{root:Ae,input:Ue},slotProps:Ve,fullWidth:D,inputComponent:x,multiline:q,ref:h,type:ue,...oe,classes:pe})});fX.muiName="Input";function zde(l){return Ro("MuiFormControl",l)}Co("MuiFormControl",["root","marginNone","marginNormal","marginDense","fullWidth","disabled"]);const Yde=l=>{const{classes:a,margin:h,fullWidth:_}=l,S={root:["root",h!=="none"&&`margin${_i(h)}`,_&&"fullWidth"]};return bo(S,zde,a)},qde=Gn("div",{name:"MuiFormControl",slot:"Root",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[a.root,a[`margin${_i(h.margin)}`],h.fullWidth&&a.fullWidth]}})({display:"inline-flex",flexDirection:"column",position:"relative",minWidth:0,padding:0,margin:0,border:0,verticalAlign:"top",variants:[{props:{margin:"normal"},style:{marginTop:16,marginBottom:8}},{props:{margin:"dense"},style:{marginTop:8,marginBottom:4}},{props:{fullWidth:!0},style:{width:"100%"}}]}),Xde=ae.forwardRef(function(a,h){const _=Io({props:a,name:"MuiFormControl"}),{children:S,className:y,color:b="primary",component:D="div",disabled:U=!1,error:x=!1,focused:q,fullWidth:J=!1,hiddenLabel:ee=!1,margin:ue="none",required:oe=!1,size:le="medium",variant:pe="outlined",...Ne}=_,Ve={..._,color:b,component:D,disabled:U,error:x,fullWidth:J,hiddenLabel:ee,margin:ue,required:oe,size:le,variant:pe},Ae=Yde(Ve),[Ue,ke]=ae.useState(()=>{let ct=!1;return S&&ae.Children.forEach(S,Me=>{if(!yq(Me,["Input","Select"]))return;const Je=yq(Me,["Select"])?Me.props.input:Me;Je&&qle(Je.props)&&(ct=!0)}),ct}),[qe,Te]=ae.useState(()=>{let ct=!1;return S&&ae.Children.forEach(S,Me=>{yq(Me,["Input","Select"])&&(CG(Me.props,!0)||CG(Me.props.inputProps,!0))&&(ct=!0)}),ct}),[he,_e]=ae.useState(!1);U&&he&&_e(!1);const ye=q!==void 0&&!U?q:he;let Ie;ae.useRef(!1);const $=ae.useCallback(()=>{Te(!0)},[]),me=ae.useCallback(()=>{Te(!1)},[]),Xe=ae.useMemo(()=>({adornedStart:Ue,setAdornedStart:ke,color:b,disabled:U,error:x,filled:qe,focused:ye,fullWidth:J,hiddenLabel:ee,size:le,onBlur:()=>{_e(!1)},onFocus:()=>{_e(!0)},onEmpty:me,onFilled:$,registerEffect:Ie,required:oe,variant:pe}),[Ue,b,U,x,qe,ye,J,ee,Ie,me,$,oe,le,pe]);return ze.jsx(hX.Provider,{value:Xe,children:ze.jsx(qde,{as:D,ownerState:Ve,className:Ui(Ae.root,y),ref:h,...Ne,children:S})})});function Jde(l){return Ro("MuiFormHelperText",l)}const FQ=Co("MuiFormHelperText",["root","error","disabled","sizeSmall","sizeMedium","contained","focused","filled","required"]);var BQ;const Qde=l=>{const{classes:a,contained:h,size:_,disabled:S,error:y,filled:b,focused:D,required:U}=l,x={root:["root",S&&"disabled",y&&"error",_&&`size${_i(_)}`,h&&"contained",D&&"focused",b&&"filled",U&&"required"]};return bo(x,Jde,a)},Zde=Gn("p",{name:"MuiFormHelperText",slot:"Root",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[a.root,h.size&&a[`size${_i(h.size)}`],h.contained&&a.contained,h.filled&&a.filled]}})(uo(({theme:l})=>({color:(l.vars||l).palette.text.secondary,...l.typography.caption,textAlign:"left",marginTop:3,marginRight:0,marginBottom:0,marginLeft:0,[`&.${FQ.disabled}`]:{color:(l.vars||l).palette.text.disabled},[`&.${FQ.error}`]:{color:(l.vars||l).palette.error.main},variants:[{props:{size:"small"},style:{marginTop:4}},{props:({ownerState:a})=>a.contained,style:{marginLeft:14,marginRight:14}}]}))),$de=ae.forwardRef(function(a,h){const _=Io({props:a,name:"MuiFormHelperText"}),{children:S,className:y,component:b="p",disabled:D,error:U,filled:x,focused:q,margin:J,required:ee,variant:ue,...oe}=_,le=eL(),pe=$k({props:_,muiFormControl:le,states:["variant","size","disabled","error","filled","focused","required"]}),Ne={..._,component:b,contained:pe.variant==="filled"||pe.variant==="outlined",variant:pe.variant,size:pe.size,disabled:pe.disabled,error:pe.error,filled:pe.filled,focused:pe.focused,required:pe.required};delete Ne.ownerState;const Ve=Qde(Ne);return ze.jsx(Zde,{as:b,className:Ui(Ve.root,y),ref:h,...oe,ownerState:Ne,children:S===" "?BQ||(BQ=ze.jsx("span",{className:"notranslate","aria-hidden":!0,children:"​"})):S})});function eue(l){return Ro("MuiFormLabel",l)}const jj=Co("MuiFormLabel",["root","colorSecondary","focused","disabled","error","filled","required","asterisk"]),tue=l=>{const{classes:a,color:h,focused:_,disabled:S,error:y,filled:b,required:D}=l,U={root:["root",`color${_i(h)}`,S&&"disabled",y&&"error",b&&"filled",_&&"focused",D&&"required"],asterisk:["asterisk",y&&"error"]};return bo(U,eue,a)},nue=Gn("label",{name:"MuiFormLabel",slot:"Root",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[a.root,h.color==="secondary"&&a.colorSecondary,h.filled&&a.filled]}})(uo(({theme:l})=>({color:(l.vars||l).palette.text.secondary,...l.typography.body1,lineHeight:"1.4375em",padding:0,position:"relative",variants:[...Object.entries(l.palette).filter(RE()).map(([a])=>({props:{color:a},style:{[`&.${jj.focused}`]:{color:(l.vars||l).palette[a].main}}})),{props:{},style:{[`&.${jj.disabled}`]:{color:(l.vars||l).palette.text.disabled},[`&.${jj.error}`]:{color:(l.vars||l).palette.error.main}}}]}))),iue=Gn("span",{name:"MuiFormLabel",slot:"Asterisk"})(uo(({theme:l})=>({[`&.${jj.error}`]:{color:(l.vars||l).palette.error.main}}))),rue=ae.forwardRef(function(a,h){const _=Io({props:a,name:"MuiFormLabel"}),{children:S,className:y,color:b,component:D="label",disabled:U,error:x,filled:q,focused:J,required:ee,...ue}=_,oe=eL(),le=$k({props:_,muiFormControl:oe,states:["color","required","focused","disabled","error","filled"]}),pe={..._,color:le.color||"primary",component:D,disabled:le.disabled,error:le.error,filled:le.filled,focused:le.focused,required:le.required},Ne=tue(pe);return ze.jsxs(nue,{as:D,ownerState:pe,className:Ui(Ne.root,y),ref:h,...ue,children:[S,le.required&&ze.jsxs(iue,{ownerState:pe,"aria-hidden":!0,className:Ne.asterisk,children:[" ","*"]})]})});function l7(l){return`scale(${l}, ${l**2})`}const sue={entering:{opacity:1,transform:l7(1)},entered:{opacity:1,transform:"none"}},bq=typeof navigator<"u"&&/^((?!chrome|android).)*(safari|mobile)/i.test(navigator.userAgent)&&/(os |version\/)15(.|_)4/i.test(navigator.userAgent),d7=ae.forwardRef(function(a,h){const{addEndListener:_,appear:S=!0,children:y,easing:b,in:D,onEnter:U,onEntered:x,onEntering:q,onExit:J,onExited:ee,onExiting:ue,style:oe,timeout:le="auto",TransitionComponent:pe=PS,...Ne}=a,Ve=Uee(),Ae=ae.useRef(),Ue=oX(),ke=ae.useRef(null),qe=Fu(ke,A3(y),h),Te=ct=>Me=>{if(ct){const Je=ke.current;Me===void 0?ct(Je):ct(Je,Me)}},he=Te(q),_e=Te((ct,Me)=>{xee(ct);const{duration:Je,delay:mt,easing:yt}=vG({style:oe,timeout:le,easing:b},{mode:"enter"});let xe;le==="auto"?(xe=Ue.transitions.getAutoHeightDuration(ct.clientHeight),Ae.current=xe):xe=Je,ct.style.transition=[Ue.transitions.create("opacity",{duration:xe,delay:mt}),Ue.transitions.create("transform",{duration:bq?xe:xe*.666,delay:mt,easing:yt})].join(","),U&&U(ct,Me)}),ye=Te(x),Ie=Te(ue),$=Te(ct=>{const{duration:Me,delay:Je,easing:mt}=vG({style:oe,timeout:le,easing:b},{mode:"exit"});let yt;le==="auto"?(yt=Ue.transitions.getAutoHeightDuration(ct.clientHeight),Ae.current=yt):yt=Me,ct.style.transition=[Ue.transitions.create("opacity",{duration:yt,delay:Je}),Ue.transitions.create("transform",{duration:bq?yt:yt*.666,delay:bq?Je:Je||yt*.333,easing:mt})].join(","),ct.style.opacity=0,ct.style.transform=l7(.75),J&&J(ct)}),me=Te(ee),Xe=ct=>{le==="auto"&&Ve.start(Ae.current||0,ct),_&&_(ke.current,ct)};return ze.jsx(pe,{appear:S,in:D,nodeRef:ke,onEnter:_e,onEntered:ye,onEntering:he,onExit:$,onExited:me,onExiting:Ie,addEndListener:Xe,timeout:le==="auto"?null:le,...Ne,children:(ct,{ownerState:Me,...Je})=>ae.cloneElement(y,{style:{opacity:0,transform:l7(.75),visibility:ct==="exited"&&!D?"hidden":void 0,...sue[ct],...oe,...y.props.style},ref:qe,...Je})})});d7&&(d7.muiSupportAuto=!0);const oue=l=>{const{classes:a,disableUnderline:h}=l,S=bo({root:["root",!h&&"underline"],input:["input"]},Qle,a);return{...a,...S}},aue=Gn(gW,{shouldForwardProp:l=>yE(l)||l==="classes",name:"MuiInput",slot:"Root",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[...mW(l,a),!h.disableUnderline&&a.underline]}})(uo(({theme:l})=>{let h=l.palette.mode==="light"?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return l.vars&&(h=l.alpha(l.vars.palette.common.onBackground,l.vars.opacity.inputUnderline)),{position:"relative",variants:[{props:({ownerState:_})=>_.formControl,style:{"label + &":{marginTop:16}}},{props:({ownerState:_})=>!_.disableUnderline,style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:l.transitions.create("transform",{duration:l.transitions.duration.shorter,easing:l.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${Ij.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${Ij.error}`]:{"&::before, &::after":{borderBottomColor:(l.vars||l).palette.error.main}},"&::before":{borderBottom:`1px solid ${h}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:l.transitions.create("border-bottom-color",{duration:l.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${Ij.disabled}, .${Ij.error}):before`]:{borderBottom:`2px solid ${(l.vars||l).palette.text.primary}`,"@media (hover: none)":{borderBottom:`1px solid ${h}`}},[`&.${Ij.disabled}:before`]:{borderBottomStyle:"dotted"}}},...Object.entries(l.palette).filter(RE()).map(([_])=>({props:{color:_,disableUnderline:!1},style:{"&::after":{borderBottom:`2px solid ${(l.vars||l).palette[_].main}`}}}))]}})),cue=Gn(SW,{name:"MuiInput",slot:"Input",overridesResolver:EW})({}),_X=ae.forwardRef(function(a,h){const _=Io({props:a,name:"MuiInput"}),{disableUnderline:S=!1,components:y={},componentsProps:b,fullWidth:D=!1,inputComponent:U="input",multiline:x=!1,slotProps:q,slots:J={},type:ee="text",...ue}=_,oe=oue(_),pe={root:{ownerState:{disableUnderline:S}}},Ne=q??b?zd(q??b,pe):pe,Ve=J.root??y.Root??aue,Ae=J.input??y.Input??cue;return ze.jsx(pX,{slots:{root:Ve,input:Ae},slotProps:Ne,fullWidth:D,inputComponent:U,multiline:x,ref:h,type:ee,...ue,classes:oe})});_X.muiName="Input";function lue(l){return Ro("MuiInputLabel",l)}Co("MuiInputLabel",["root","focused","disabled","error","required","asterisk","formControl","sizeSmall","shrink","animated","standard","filled","outlined"]);const due=l=>{const{classes:a,formControl:h,size:_,shrink:S,disableAnimation:y,variant:b,required:D}=l,U={root:["root",h&&"formControl",!y&&"animated",S&&"shrink",_&&_!=="medium"&&`size${_i(_)}`,b],asterisk:[D&&"asterisk"]},x=bo(U,lue,a);return{...a,...x}},uue=Gn(rue,{shouldForwardProp:l=>yE(l)||l==="classes",name:"MuiInputLabel",slot:"Root",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[{[`& .${jj.asterisk}`]:a.asterisk},a.root,h.formControl&&a.formControl,h.size==="small"&&a.sizeSmall,h.shrink&&a.shrink,!h.disableAnimation&&a.animated,h.focused&&a.focused,a[h.variant]]}})(uo(({theme:l})=>({display:"block",transformOrigin:"top left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",variants:[{props:({ownerState:a})=>a.formControl,style:{position:"absolute",left:0,top:0,transform:"translate(0, 20px) scale(1)"}},{props:{size:"small"},style:{transform:"translate(0, 17px) scale(1)"}},{props:({ownerState:a})=>a.shrink,style:{transform:"translate(0, -1.5px) scale(0.75)",transformOrigin:"top left",maxWidth:"133%"}},{props:({ownerState:a})=>!a.disableAnimation,style:{transition:l.transitions.create(["color","transform","max-width"],{duration:l.transitions.duration.shorter,easing:l.transitions.easing.easeOut})}},{props:{variant:"filled"},style:{zIndex:1,pointerEvents:"none",transform:"translate(12px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"}},{props:{variant:"filled",size:"small"},style:{transform:"translate(12px, 13px) scale(1)"}},{props:({variant:a,ownerState:h})=>a==="filled"&&h.shrink,style:{userSelect:"none",pointerEvents:"auto",transform:"translate(12px, 7px) scale(0.75)",maxWidth:"calc(133% - 24px)"}},{props:({variant:a,ownerState:h,size:_})=>a==="filled"&&h.shrink&&_==="small",style:{transform:"translate(12px, 4px) scale(0.75)"}},{props:{variant:"outlined"},style:{zIndex:1,pointerEvents:"none",transform:"translate(14px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"}},{props:{variant:"outlined",size:"small"},style:{transform:"translate(14px, 9px) scale(1)"}},{props:({variant:a,ownerState:h})=>a==="outlined"&&h.shrink,style:{userSelect:"none",pointerEvents:"auto",maxWidth:"calc(133% - 32px)",transform:"translate(14px, -9px) scale(0.75)"}}]}))),hue=ae.forwardRef(function(a,h){const _=Io({name:"MuiInputLabel",props:a}),{disableAnimation:S=!1,margin:y,shrink:b,variant:D,className:U,...x}=_,q=eL();let J=b;typeof J>"u"&&q&&(J=q.filled||q.focused||q.adornedStart);const ee=$k({props:_,muiFormControl:q,states:["size","variant","required","focused"]}),ue={..._,disableAnimation:S,formControl:q,shrink:J,size:ee.size,variant:ee.variant,required:ee.required,focused:ee.focused},oe=due(ue);return ze.jsx(uue,{"data-shrink":J,ref:h,className:Ui(oe.root,U),...x,ownerState:ue,classes:oe})}),pue=ae.createContext({});function fue(l){return Ro("MuiList",l)}Co("MuiList",["root","padding","dense","subheader"]);const _ue=l=>{const{classes:a,disablePadding:h,dense:_,subheader:S}=l;return bo({root:["root",!h&&"padding",_&&"dense",S&&"subheader"]},fue,a)},mue=Gn("ul",{name:"MuiList",slot:"Root",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[a.root,!h.disablePadding&&a.padding,h.dense&&a.dense,h.subheader&&a.subheader]}})({listStyle:"none",margin:0,padding:0,position:"relative",variants:[{props:({ownerState:l})=>!l.disablePadding,style:{paddingTop:8,paddingBottom:8}},{props:({ownerState:l})=>l.subheader,style:{paddingTop:0}}]}),Eue=ae.forwardRef(function(a,h){const _=Io({props:a,name:"MuiList"}),{children:S,className:y,component:b="ul",dense:D=!1,disablePadding:U=!1,subheader:x,...q}=_,J=ae.useMemo(()=>({dense:D}),[D]),ee={..._,component:b,dense:D,disablePadding:U},ue=_ue(ee);return ze.jsx(pue.Provider,{value:J,children:ze.jsxs(mue,{as:b,className:Ui(ue.root,y),ref:h,ownerState:ee,...q,children:[x,S]})})});function Iq(l,a,h){return l===a?l.firstChild:a&&a.nextElementSibling?a.nextElementSibling:h?null:l.firstChild}function jQ(l,a,h){return l===a?h?l.firstChild:l.lastChild:a&&a.previousElementSibling?a.previousElementSibling:h?null:l.lastChild}function Hee(l,a){if(a===void 0)return!0;let h=l.innerText;return h===void 0&&(h=l.textContent),h=h.trim().toLowerCase(),h.length===0?!1:a.repeating?h[0]===a.keys[0]:h.startsWith(a.keys.join(""))}function Aj(l,a,h,_,S,y){let b=!1,D=S(l,a,a?h:!1);for(;D;){if(D===l.firstChild){if(b)return!1;b=!0}const U=_?!1:D.disabled||D.getAttribute("aria-disabled")==="true";if(!D.hasAttribute("tabindex")||!Hee(D,y)||U)D=S(l,D,h);else return D.focus(),!0}return!1}const gue=ae.forwardRef(function(a,h){const{actions:_,autoFocus:S=!1,autoFocusItem:y=!1,children:b,className:D,disabledItemsFocusable:U=!1,disableListWrap:x=!1,onKeyDown:q,variant:J="selectedMenu",...ee}=a,ue=ae.useRef(null),oe=ae.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});NS(()=>{S&&ue.current.focus()},[S]),ae.useImperativeHandle(_,()=>({adjustStyleForScrollbar:(Ae,{direction:Ue})=>{const ke=!ue.current.style.width;if(Ae.clientHeight<ue.current.clientHeight&&ke){const qe=`${Wee(ly(Ae))}px`;ue.current.style[Ue==="rtl"?"paddingLeft":"paddingRight"]=qe,ue.current.style.width=`calc(100% + ${qe})`}return ue.current}}),[]);const le=Ae=>{const Ue=ue.current,ke=Ae.key;if(Ae.ctrlKey||Ae.metaKey||Ae.altKey){q&&q(Ae);return}const Te=xu(Ue).activeElement;if(ke==="ArrowDown")Ae.preventDefault(),Aj(Ue,Te,x,U,Iq);else if(ke==="ArrowUp")Ae.preventDefault(),Aj(Ue,Te,x,U,jQ);else if(ke==="Home")Ae.preventDefault(),Aj(Ue,null,x,U,Iq);else if(ke==="End")Ae.preventDefault(),Aj(Ue,null,x,U,jQ);else if(ke.length===1){const he=oe.current,_e=ke.toLowerCase(),ye=performance.now();he.keys.length>0&&(ye-he.lastTime>500?(he.keys=[],he.repeating=!0,he.previousKeyMatched=!0):he.repeating&&_e!==he.keys[0]&&(he.repeating=!1)),he.lastTime=ye,he.keys.push(_e);const Ie=Te&&!he.repeating&&Hee(Te,he);he.previousKeyMatched&&(Ie||Aj(Ue,Te,!1,U,Iq,he))?Ae.preventDefault():he.previousKeyMatched=!1}q&&q(Ae)},pe=Fu(ue,h);let Ne=-1;ae.Children.forEach(b,(Ae,Ue)=>{if(!ae.isValidElement(Ae)){Ne===Ue&&(Ne+=1,Ne>=b.length&&(Ne=-1));return}Ae.props.disabled||(J==="selectedMenu"&&Ae.props.selected||Ne===-1)&&(Ne=Ue),Ne===Ue&&(Ae.props.disabled||Ae.props.muiSkipListHighlight||Ae.type.muiSkipListHighlight)&&(Ne+=1,Ne>=b.length&&(Ne=-1))});const Ve=ae.Children.map(b,(Ae,Ue)=>{if(Ue===Ne){const ke={};return y&&(ke.autoFocus=!0),Ae.props.tabIndex===void 0&&J==="selectedMenu"&&(ke.tabIndex=0),ae.cloneElement(Ae,ke)}return Ae});return ze.jsx(Eue,{role:"menu",ref:pe,className:D,onKeyDown:le,tabIndex:S?0:-1,...ee,children:Ve})});function Sue(l){return Ro("MuiPopover",l)}Co("MuiPopover",["root","paper"]);function GQ(l,a){let h=0;return typeof a=="number"?h=a:a==="center"?h=l.height/2:a==="bottom"&&(h=l.height),h}function WQ(l,a){let h=0;return typeof a=="number"?h=a:a==="center"?h=l.width/2:a==="right"&&(h=l.width),h}function HQ(l){return[l.horizontal,l.vertical].map(a=>typeof a=="number"?`${a}px`:a).join(" ")}function K6(l){return typeof l=="function"?l():l}const Tue=l=>{const{classes:a}=l;return bo({root:["root"],paper:["paper"]},Sue,a)},vue=Gn(Gde,{name:"MuiPopover",slot:"Root"})({}),Kee=Gn(uX,{name:"MuiPopover",slot:"Paper"})({position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}),yue=ae.forwardRef(function(a,h){const _=Io({props:a,name:"MuiPopover"}),{action:S,anchorEl:y,anchorOrigin:b={vertical:"top",horizontal:"left"},anchorPosition:D,anchorReference:U="anchorEl",children:x,className:q,container:J,elevation:ee=8,marginThreshold:ue=16,open:oe,PaperProps:le={},slots:pe={},slotProps:Ne={},transformOrigin:Ve={vertical:"top",horizontal:"left"},TransitionComponent:Ae,transitionDuration:Ue="auto",TransitionProps:ke={},disableScrollLock:qe=!1,...Te}=_,he=ae.useRef(),_e={..._,anchorOrigin:b,anchorReference:U,elevation:ee,marginThreshold:ue,transformOrigin:Ve,TransitionComponent:Ae,transitionDuration:Ue,TransitionProps:ke},ye=Tue(_e),Ie=ae.useCallback(()=>{if(U==="anchorPosition")return D;const En=K6(y),ui=(En&&En.nodeType===1?En:xu(he.current).body).getBoundingClientRect();return{top:ui.top+GQ(ui,b.vertical),left:ui.left+WQ(ui,b.horizontal)}},[y,b.horizontal,b.vertical,D,U]),$=ae.useCallback(En=>({vertical:GQ(En,Ve.vertical),horizontal:WQ(En,Ve.horizontal)}),[Ve.horizontal,Ve.vertical]),me=ae.useCallback(En=>{const oi={width:En.offsetWidth,height:En.offsetHeight},ui=$(oi);if(U==="none")return{top:null,left:null,transformOrigin:HQ(ui)};const Kn=Ie();let qn=Kn.top-ui.vertical,Zi=Kn.left-ui.horizontal;const Gi=qn+oi.height,yi=Zi+oi.width,vn=ly(K6(y)),xn=vn.innerHeight-ue,ir=vn.innerWidth-ue;if(ue!==null&&qn<ue){const Bi=qn-ue;qn-=Bi,ui.vertical+=Bi}else if(ue!==null&&Gi>xn){const Bi=Gi-xn;qn-=Bi,ui.vertical+=Bi}if(ue!==null&&Zi<ue){const Bi=Zi-ue;Zi-=Bi,ui.horizontal+=Bi}else if(yi>ir){const Bi=yi-ir;Zi-=Bi,ui.horizontal+=Bi}return{top:`${Math.round(qn)}px`,left:`${Math.round(Zi)}px`,transformOrigin:HQ(ui)}},[y,U,Ie,$,ue]),[Xe,ct]=ae.useState(oe),Me=ae.useCallback(()=>{const En=he.current;if(!En)return;const oi=me(En);oi.top!==null&&En.style.setProperty("top",oi.top),oi.left!==null&&(En.style.left=oi.left),En.style.transformOrigin=oi.transformOrigin,ct(!0)},[me]);ae.useEffect(()=>(qe&&window.addEventListener("scroll",Me),()=>window.removeEventListener("scroll",Me)),[y,qe,Me]);const Je=()=>{Me()},mt=()=>{ct(!1)};ae.useEffect(()=>{oe&&Me()}),ae.useImperativeHandle(S,()=>oe?{updatePosition:()=>{Me()}}:null,[oe,Me]),ae.useEffect(()=>{if(!oe)return;const En=Pee(()=>{Me()}),oi=ly(K6(y));return oi.addEventListener("resize",En),()=>{En.clear(),oi.removeEventListener("resize",En)}},[y,oe,Me]);let yt=Ue;const xe={slots:{transition:Ae,...pe},slotProps:{transition:ke,paper:le,...Ne}},[it,ft]=Wd("transition",{elementType:d7,externalForwardedProps:xe,ownerState:_e,getSlotProps:En=>({...En,onEntering:(oi,ui)=>{En.onEntering?.(oi,ui),Je()},onExited:oi=>{En.onExited?.(oi),mt()}}),additionalProps:{appear:!0,in:oe}});Ue==="auto"&&!it.muiSupportAuto&&(yt=void 0);const pt=J||(y?xu(K6(y)).body:void 0),[xt,{slots:ln,slotProps:pn,...Zn}]=Wd("root",{ref:h,elementType:vue,externalForwardedProps:{...xe,...Te},shouldForwardComponentProp:!0,additionalProps:{slots:{backdrop:pe.backdrop},slotProps:{backdrop:Jce(typeof Ne.backdrop=="function"?Ne.backdrop(_e):Ne.backdrop,{invisible:!0})},container:pt,open:oe},ownerState:_e,className:Ui(ye.root,q)}),[ri,si]=Wd("paper",{ref:he,className:ye.paper,elementType:Kee,externalForwardedProps:xe,shouldForwardComponentProp:!0,additionalProps:{elevation:ee,style:Xe?void 0:{opacity:0}},ownerState:_e});return ze.jsx(xt,{...Zn,...!wb(xt)&&{slots:ln,slotProps:pn,disableScrollLock:qe},children:ze.jsx(it,{...ft,timeout:yt,children:ze.jsx(ri,{...si,children:x})})})});function Rue(l){return Ro("MuiMenu",l)}Co("MuiMenu",["root","paper","list"]);const Cue={vertical:"top",horizontal:"right"},bue={vertical:"top",horizontal:"left"},Iue=l=>{const{classes:a}=l;return bo({root:["root"],paper:["paper"],list:["list"]},Rue,a)},Aue=Gn(yue,{shouldForwardProp:l=>yE(l)||l==="classes",name:"MuiMenu",slot:"Root"})({}),wue=Gn(Kee,{name:"MuiMenu",slot:"Paper"})({maxHeight:"calc(100% - 96px)",WebkitOverflowScrolling:"touch"}),Oue=Gn(gue,{name:"MuiMenu",slot:"List"})({outline:0}),Nue=ae.forwardRef(function(a,h){const _=Io({props:a,name:"MuiMenu"}),{autoFocus:S=!0,children:y,className:b,disableAutoFocusItem:D=!1,MenuListProps:U={},onClose:x,open:q,PaperProps:J={},PopoverClasses:ee,transitionDuration:ue="auto",TransitionProps:{onEntering:oe,...le}={},variant:pe="selectedMenu",slots:Ne={},slotProps:Ve={},...Ae}=_,Ue=vee(),ke={..._,autoFocus:S,disableAutoFocusItem:D,MenuListProps:U,onEntering:oe,PaperProps:J,transitionDuration:ue,TransitionProps:le,variant:pe},qe=Iue(ke),Te=S&&!D&&q,he=ae.useRef(null),_e=(yt,xe)=>{he.current&&he.current.adjustStyleForScrollbar(yt,{direction:Ue?"rtl":"ltr"}),oe&&oe(yt,xe)},ye=yt=>{yt.key==="Tab"&&(yt.preventDefault(),x&&x(yt,"tabKeyDown"))};let Ie=-1;ae.Children.map(y,(yt,xe)=>{ae.isValidElement(yt)&&(yt.props.disabled||(pe==="selectedMenu"&&yt.props.selected||Ie===-1)&&(Ie=xe))});const $={slots:Ne,slotProps:{list:U,transition:le,paper:J,...Ve}},me=Zv({elementType:Ne.root,externalSlotProps:Ve.root,ownerState:ke,className:[qe.root,b]}),[Xe,ct]=Wd("paper",{className:qe.paper,elementType:wue,externalForwardedProps:$,shouldForwardComponentProp:!0,ownerState:ke}),[Me,Je]=Wd("list",{className:Ui(qe.list,U.className),elementType:Oue,shouldForwardComponentProp:!0,externalForwardedProps:$,getSlotProps:yt=>({...yt,onKeyDown:xe=>{ye(xe),yt.onKeyDown?.(xe)}}),ownerState:ke}),mt=typeof $.slotProps.transition=="function"?$.slotProps.transition(ke):$.slotProps.transition;return ze.jsx(Aue,{onClose:x,anchorOrigin:{vertical:"bottom",horizontal:Ue?"right":"left"},transformOrigin:Ue?Cue:bue,slots:{root:Ne.root,paper:Xe,backdrop:Ne.backdrop,...Ne.transition&&{transition:Ne.transition}},slotProps:{root:me,paper:ct,backdrop:typeof Ve.backdrop=="function"?Ve.backdrop(ke):Ve.backdrop,transition:{...mt,onEntering:(...yt)=>{_e(...yt),mt?.onEntering?.(...yt)}}},open:q,ref:h,transitionDuration:ue,ownerState:ke,...Ae,classes:ee,children:ze.jsx(Me,{actions:he,autoFocus:S&&(Ie===-1||D),autoFocusItem:Te,variant:pe,...Je,children:y})})});function Due(l){return Ro("MuiNativeSelect",l)}const mX=Co("MuiNativeSelect",["root","select","multiple","filled","outlined","standard","disabled","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]),Pue=l=>{const{classes:a,variant:h,disabled:_,multiple:S,open:y,error:b}=l,D={select:["select",h,_&&"disabled",S&&"multiple",b&&"error"],icon:["icon",`icon${_i(h)}`,y&&"iconOpen",_&&"disabled"]};return bo(D,Due,a)},zee=Gn("select",{name:"MuiNativeSelect"})(({theme:l})=>({MozAppearance:"none",WebkitAppearance:"none",userSelect:"none",borderRadius:0,cursor:"pointer","&:focus":{borderRadius:0},[`&.${mX.disabled}`]:{cursor:"default"},"&[multiple]":{height:"auto"},"&:not([multiple]) option, &:not([multiple]) optgroup":{backgroundColor:(l.vars||l).palette.background.paper},variants:[{props:({ownerState:a})=>a.variant!=="filled"&&a.variant!=="outlined",style:{"&&&":{paddingRight:24,minWidth:16}}},{props:{variant:"filled"},style:{"&&&":{paddingRight:32}}},{props:{variant:"outlined"},style:{borderRadius:(l.vars||l).shape.borderRadius,"&:focus":{borderRadius:(l.vars||l).shape.borderRadius},"&&&":{paddingRight:32}}}]})),kue=Gn(zee,{name:"MuiNativeSelect",slot:"Select",shouldForwardProp:yE,overridesResolver:(l,a)=>{const{ownerState:h}=l;return[a.select,a[h.variant],h.error&&a.error,{[`&.${mX.multiple}`]:a.multiple}]}})({}),Yee=Gn("svg",{name:"MuiNativeSelect"})(({theme:l})=>({position:"absolute",right:0,top:"calc(50% - .5em)",pointerEvents:"none",color:(l.vars||l).palette.action.active,[`&.${mX.disabled}`]:{color:(l.vars||l).palette.action.disabled},variants:[{props:({ownerState:a})=>a.open,style:{transform:"rotate(180deg)"}},{props:{variant:"filled"},style:{right:7}},{props:{variant:"outlined"},style:{right:7}}]})),Lue=Gn(Yee,{name:"MuiNativeSelect",slot:"Icon",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[a.icon,h.variant&&a[`icon${_i(h.variant)}`],h.open&&a.iconOpen]}})({}),Mue=ae.forwardRef(function(a,h){const{className:_,disabled:S,error:y,IconComponent:b,inputRef:D,variant:U="standard",...x}=a,q={...a,disabled:S,variant:U,error:y},J=Pue(q);return ze.jsxs(ae.Fragment,{children:[ze.jsx(kue,{ownerState:q,className:Ui(J.select,_),disabled:S,ref:D||h,...x}),a.multiple?null:ze.jsx(Lue,{as:b,ownerState:q,className:J.icon})]})});var KQ;const Uue=Gn("fieldset",{name:"MuiNotchedOutlined",shouldForwardProp:yE})({textAlign:"left",position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden",minWidth:"0%"}),xue=Gn("legend",{name:"MuiNotchedOutlined",shouldForwardProp:yE})(uo(({theme:l})=>({float:"unset",width:"auto",overflow:"hidden",variants:[{props:({ownerState:a})=>!a.withLabel,style:{padding:0,lineHeight:"11px",transition:l.transitions.create("width",{duration:150,easing:l.transitions.easing.easeOut})}},{props:({ownerState:a})=>a.withLabel,style:{display:"block",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:l.transitions.create("max-width",{duration:50,easing:l.transitions.easing.easeOut}),whiteSpace:"nowrap","& > span":{paddingLeft:5,paddingRight:5,display:"inline-block",opacity:0,visibility:"visible"}}},{props:({ownerState:a})=>a.withLabel&&a.notched,style:{maxWidth:"100%",transition:l.transitions.create("max-width",{duration:100,easing:l.transitions.easing.easeOut,delay:50})}}]})));function Vue(l){const{children:a,classes:h,className:_,label:S,notched:y,...b}=l,D=S!=null&&S!=="",U={...l,notched:y,withLabel:D};return ze.jsx(Uue,{"aria-hidden":!0,className:_,ownerState:U,...b,children:ze.jsx(xue,{ownerState:U,children:D?ze.jsx("span",{children:S}):KQ||(KQ=ze.jsx("span",{className:"notranslate","aria-hidden":!0,children:"​"}))})})}const Fue=l=>{const{classes:a}=l,_=bo({root:["root"],notchedOutline:["notchedOutline"],input:["input"]},Zle,a);return{...a,..._}},Bue=Gn(gW,{shouldForwardProp:l=>yE(l)||l==="classes",name:"MuiOutlinedInput",slot:"Root",overridesResolver:mW})(uo(({theme:l})=>{const a=l.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{position:"relative",borderRadius:(l.vars||l).shape.borderRadius,[`&:hover .${_S.notchedOutline}`]:{borderColor:(l.vars||l).palette.text.primary},"@media (hover: none)":{[`&:hover .${_S.notchedOutline}`]:{borderColor:l.vars?l.alpha(l.vars.palette.common.onBackground,.23):a}},[`&.${_S.focused} .${_S.notchedOutline}`]:{borderWidth:2},variants:[...Object.entries(l.palette).filter(RE()).map(([h])=>({props:{color:h},style:{[`&.${_S.focused} .${_S.notchedOutline}`]:{borderColor:(l.vars||l).palette[h].main}}})),{props:{},style:{[`&.${_S.error} .${_S.notchedOutline}`]:{borderColor:(l.vars||l).palette.error.main},[`&.${_S.disabled} .${_S.notchedOutline}`]:{borderColor:(l.vars||l).palette.action.disabled}}},{props:({ownerState:h})=>h.startAdornment,style:{paddingLeft:14}},{props:({ownerState:h})=>h.endAdornment,style:{paddingRight:14}},{props:({ownerState:h})=>h.multiline,style:{padding:"16.5px 14px"}},{props:({ownerState:h,size:_})=>h.multiline&&_==="small",style:{padding:"8.5px 14px"}}]}})),jue=Gn(Vue,{name:"MuiOutlinedInput",slot:"NotchedOutline"})(uo(({theme:l})=>{const a=l.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{borderColor:l.vars?l.alpha(l.vars.palette.common.onBackground,.23):a}})),Gue=Gn(SW,{name:"MuiOutlinedInput",slot:"Input",overridesResolver:EW})(uo(({theme:l})=>({padding:"16.5px 14px",...!l.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:l.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:l.palette.mode==="light"?null:"#fff",caretColor:l.palette.mode==="light"?null:"#fff",borderRadius:"inherit"}},...l.vars&&{"&:-webkit-autofill":{borderRadius:"inherit"},[l.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},variants:[{props:{size:"small"},style:{padding:"8.5px 14px"}},{props:({ownerState:a})=>a.multiline,style:{padding:0}},{props:({ownerState:a})=>a.startAdornment,style:{paddingLeft:0}},{props:({ownerState:a})=>a.endAdornment,style:{paddingRight:0}}]}))),EX=ae.forwardRef(function(a,h){const _=Io({props:a,name:"MuiOutlinedInput"}),{components:S={},fullWidth:y=!1,inputComponent:b="input",label:D,multiline:U=!1,notched:x,slots:q={},slotProps:J={},type:ee="text",...ue}=_,oe=Fue(_),le=eL(),pe=$k({props:_,muiFormControl:le,states:["color","disabled","error","focused","hiddenLabel","size","required"]}),Ne={..._,color:pe.color||"primary",disabled:pe.disabled,error:pe.error,focused:pe.focused,formControl:le,fullWidth:y,hiddenLabel:pe.hiddenLabel,multiline:U,size:pe.size,type:ee},Ve=q.root??S.Root??Bue,Ae=q.input??S.Input??Gue,[Ue,ke]=Wd("notchedOutline",{elementType:jue,className:oe.notchedOutline,shouldForwardComponentProp:!0,ownerState:Ne,externalForwardedProps:{slots:q,slotProps:J},additionalProps:{label:D!=null&&D!==""&&pe.required?ze.jsxs(ae.Fragment,{children:[D," ","*"]}):D}});return ze.jsx(pX,{slots:{root:Ve,input:Ae},slotProps:J,renderSuffix:qe=>ze.jsx(Ue,{...ke,notched:typeof x<"u"?x:!!(qe.startAdornment||qe.filled||qe.focused)}),fullWidth:y,inputComponent:b,multiline:U,ref:h,type:ee,...ue,classes:{...oe,notchedOutline:null}})});EX.muiName="Input";const Wue={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",whiteSpace:"nowrap",width:"1px"};function qee(l){return Ro("MuiSelect",l)}const wj=Co("MuiSelect",["root","select","multiple","filled","outlined","standard","disabled","focused","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]);var zQ;const Hue=Gn(zee,{name:"MuiSelect",slot:"Select",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[{[`&.${wj.select}`]:a.select},{[`&.${wj.select}`]:a[h.variant]},{[`&.${wj.error}`]:a.error},{[`&.${wj.multiple}`]:a.multiple}]}})({[`&.${wj.select}`]:{height:"auto",minHeight:"1.4375em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}}),Kue=Gn(Yee,{name:"MuiSelect",slot:"Icon",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[a.icon,h.variant&&a[`icon${_i(h.variant)}`],h.open&&a.iconOpen]}})({}),zue=Gn("input",{shouldForwardProp:l=>_W(l)&&l!=="classes",name:"MuiSelect",slot:"NativeInput"})({bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%",boxSizing:"border-box"});function YQ(l,a){return typeof a=="object"&&a!==null?l===a:String(l)===String(a)}function Yue(l){return l==null||typeof l=="string"&&!l.trim()}const que=l=>{const{classes:a,variant:h,disabled:_,multiple:S,open:y,error:b}=l,D={select:["select",h,_&&"disabled",S&&"multiple",b&&"error"],icon:["icon",`icon${_i(h)}`,y&&"iconOpen",_&&"disabled"],nativeInput:["nativeInput"]};return bo(D,qee,a)},Xue=ae.forwardRef(function(a,h){const{"aria-describedby":_,"aria-label":S,autoFocus:y,autoWidth:b,children:D,className:U,defaultOpen:x,defaultValue:q,disabled:J,displayEmpty:ee,error:ue=!1,IconComponent:oe,inputRef:le,labelId:pe,MenuProps:Ne={},multiple:Ve,name:Ae,onBlur:Ue,onChange:ke,onClose:qe,onFocus:Te,onOpen:he,open:_e,readOnly:ye,renderValue:Ie,required:$,SelectDisplayProps:me={},tabIndex:Xe,type:ct,value:Me,variant:Je="standard",...mt}=a,[yt,xe]=n7({controlled:Me,default:q,name:"Select"}),[it,ft]=n7({controlled:_e,default:x,name:"Select"}),pt=ae.useRef(null),xt=ae.useRef(null),[ln,pn]=ae.useState(null),{current:Zn}=ae.useRef(_e!=null),[ri,si]=ae.useState(),En=Fu(h,le),oi=ae.useCallback(hn=>{xt.current=hn,hn&&pn(hn)},[]),ui=ln?.parentNode;ae.useImperativeHandle(En,()=>({focus:()=>{xt.current.focus()},node:pt.current,value:yt}),[yt]),ae.useEffect(()=>{x&&it&&ln&&!Zn&&(si(b?null:ui.clientWidth),xt.current.focus())},[ln,b]),ae.useEffect(()=>{y&&xt.current.focus()},[y]),ae.useEffect(()=>{if(!pe)return;const hn=xu(xt.current).getElementById(pe);if(hn){const hr=()=>{getSelection().isCollapsed&&xt.current.focus()};return hn.addEventListener("click",hr),()=>{hn.removeEventListener("click",hr)}}},[pe]);const Kn=(hn,hr)=>{hn?he&&he(hr):qe&&qe(hr),Zn||(si(b?null:ui.clientWidth),ft(hn))},qn=hn=>{hn.button===0&&(hn.preventDefault(),xt.current.focus(),Kn(!0,hn))},Zi=hn=>{Kn(!1,hn)},Gi=ae.Children.toArray(D),yi=hn=>{const hr=Gi.find(rs=>rs.props.value===hn.target.value);hr!==void 0&&(xe(hr.props.value),ke&&ke(hn,hr))},vn=hn=>hr=>{let rs;if(hr.currentTarget.hasAttribute("tabindex")){if(Ve){rs=Array.isArray(yt)?yt.slice():[];const eo=yt.indexOf(hn.props.value);eo===-1?rs.push(hn.props.value):rs.splice(eo,1)}else rs=hn.props.value;if(hn.props.onClick&&hn.props.onClick(hr),yt!==rs&&(xe(rs),ke)){const eo=hr.nativeEvent||hr,Qc=new eo.constructor(eo.type,eo);Object.defineProperty(Qc,"target",{writable:!0,value:{value:rs,name:Ae}}),ke(Qc,hn)}Ve||Kn(!1,hr)}},xn=hn=>{ye||[" ","ArrowUp","ArrowDown","Enter"].includes(hn.key)&&(hn.preventDefault(),Kn(!0,hn))},ir=ln!==null&&it,Bi=hn=>{!ir&&Ue&&(Object.defineProperty(hn,"target",{writable:!0,value:{value:yt,name:Ae}}),Ue(hn))};delete mt["aria-invalid"];let Sn,Us;const Rn=[];let Kt=!1;(CG({value:yt})||ee)&&(Ie?Sn=Ie(yt):Kt=!0);const wt=Gi.map(hn=>{if(!ae.isValidElement(hn))return null;let hr;if(Ve){if(!Array.isArray(yt))throw new Error(ay(2));hr=yt.some(rs=>YQ(rs,hn.props.value)),hr&&Kt&&Rn.push(hn.props.children)}else hr=YQ(yt,hn.props.value),hr&&Kt&&(Us=hn.props.children);return ae.cloneElement(hn,{"aria-selected":hr?"true":"false",onClick:vn(hn),onKeyUp:rs=>{rs.key===" "&&rs.preventDefault(),hn.props.onKeyUp&&hn.props.onKeyUp(rs)},role:"option",selected:hr,value:void 0,"data-value":hn.props.value})});Kt&&(Ve?Rn.length===0?Sn=null:Sn=Rn.reduce((hn,hr,rs)=>(hn.push(hr),rs<Rn.length-1&&hn.push(", "),hn),[]):Sn=Us);let Ot=ri;!b&&Zn&&ln&&(Ot=ui.clientWidth);let un;typeof Xe<"u"?un=Xe:un=J?null:0;const rn=me.id||(Ae?`mui-component-select-${Ae}`:void 0),Vn={...a,variant:Je,value:yt,open:ir,error:ue},Ci=que(Vn),is={...Ne.PaperProps,...typeof Ne.slotProps?.paper=="function"?Ne.slotProps.paper(Vn):Ne.slotProps?.paper},ur={...Ne.MenuListProps,...typeof Ne.slotProps?.list=="function"?Ne.slotProps.list(Vn):Ne.slotProps?.list},wr=pW();return ze.jsxs(ae.Fragment,{children:[ze.jsx(Hue,{as:"div",ref:oi,tabIndex:un,role:"combobox","aria-controls":ir?wr:void 0,"aria-disabled":J?"true":void 0,"aria-expanded":ir?"true":"false","aria-haspopup":"listbox","aria-label":S,"aria-labelledby":[pe,rn].filter(Boolean).join(" ")||void 0,"aria-describedby":_,"aria-required":$?"true":void 0,"aria-invalid":ue?"true":void 0,onKeyDown:xn,onMouseDown:J||ye?null:qn,onBlur:Bi,onFocus:Te,...me,ownerState:Vn,className:Ui(me.className,Ci.select,U),id:rn,children:Yue(Sn)?zQ||(zQ=ze.jsx("span",{className:"notranslate","aria-hidden":!0,children:"​"})):Sn}),ze.jsx(zue,{"aria-invalid":ue,value:Array.isArray(yt)?yt.join(","):yt,name:Ae,ref:pt,"aria-hidden":!0,onChange:yi,tabIndex:-1,disabled:J,className:Ci.nativeInput,autoFocus:y,required:$,...mt,ownerState:Vn}),ze.jsx(Kue,{as:oe,className:Ci.icon,ownerState:Vn}),ze.jsx(Nue,{id:`menu-${Ae||""}`,anchorEl:ui,open:ir,onClose:Zi,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},...Ne,slotProps:{...Ne.slotProps,list:{"aria-labelledby":pe,role:"listbox","aria-multiselectable":Ve?"true":void 0,disableListWrap:!0,id:wr,...ur},paper:{...is,style:{minWidth:Ot,...is!=null?is.style:null}}},children:wt})]})}),Jue=l=>{const{classes:a}=l,_=bo({root:["root"]},qee,a);return{...a,..._}},gX={name:"MuiSelect",slot:"Root",shouldForwardProp:l=>yE(l)&&l!=="variant"},Que=Gn(_X,gX)(""),Zue=Gn(EX,gX)(""),$ue=Gn(fX,gX)(""),Xee=ae.forwardRef(function(a,h){const _=Io({name:"MuiSelect",props:a}),{autoWidth:S=!1,children:y,classes:b={},className:D,defaultOpen:U=!1,displayEmpty:x=!1,IconComponent:q=ede,id:J,input:ee,inputProps:ue,label:oe,labelId:le,MenuProps:pe,multiple:Ne=!1,native:Ve=!1,onClose:Ae,onOpen:Ue,open:ke,renderValue:qe,SelectDisplayProps:Te,variant:he="outlined",..._e}=_,ye=Ve?Mue:Xue,Ie=eL(),$=$k({props:_,muiFormControl:Ie,states:["variant","error"]}),me=$.variant||he,Xe={..._,variant:me,classes:b},ct=Jue(Xe),{root:Me,...Je}=ct,mt=ee||{standard:ze.jsx(Que,{ownerState:Xe}),outlined:ze.jsx(Zue,{label:oe,ownerState:Xe}),filled:ze.jsx($ue,{ownerState:Xe})}[me],yt=Fu(h,A3(mt));return ze.jsx(ae.Fragment,{children:ae.cloneElement(mt,{inputComponent:ye,inputProps:{children:y,error:$.error,IconComponent:q,variant:me,type:void 0,multiple:Ne,...Ve?{id:J}:{autoWidth:S,defaultOpen:U,displayEmpty:x,labelId:le,MenuProps:pe,onClose:Ae,onOpen:Ue,open:ke,renderValue:qe,SelectDisplayProps:{id:J,...Te}},...ue,classes:ue?zd(Je,ue.classes):Je,...ee?ee.props.inputProps:{}},...(Ne&&Ve||x)&&me==="outlined"?{notched:!0}:{},ref:yt,className:Ui(mt.props.className,D,ct.root),...!ee&&{variant:me},..._e})})});Xee.muiName="Select";function ehe(l,a,h=(_,S)=>_===S){return l.length===a.length&&l.every((_,S)=>h(_,a[S]))}const the=2;function bk(l,a,h,_,S){return h===1?Math.min(l+a,S):Math.max(l-a,_)}function Jee(l,a){return l-a}function qQ(l,a){const{index:h}=l.reduce((_,S,y)=>{const b=Math.abs(a-S);return _===null||b<_.distance||b===_.distance?{distance:b,index:y}:_},null)??{};return h}function z6(l,a){if(a.current!==void 0&&l.changedTouches){const h=l;for(let _=0;_<h.changedTouches.length;_+=1){const S=h.changedTouches[_];if(S.identifier===a.current)return{x:S.clientX,y:S.clientY}}return!1}return{x:l.clientX,y:l.clientY}}function bG(l,a,h){return(l-a)*100/(h-a)}function nhe(l,a,h){return(h-a)*l+a}function ihe(l){if(Math.abs(l)<1){const h=l.toExponential().split("e-"),_=h[0].split(".")[1];return(_?_.length:0)+parseInt(h[1],10)}const a=l.toString().split(".")[1];return a?a.length:0}function rhe(l,a,h){const _=Math.round((l-h)/a)*a+h;return Number(_.toFixed(ihe(a)))}function XQ({values:l,newValue:a,index:h}){const _=l.slice();return _[h]=a,_.sort(Jee)}function Y6({sliderRef:l,activeIndex:a,setActive:h}){const _=xu(l.current);(!l.current?.contains(_.activeElement)||Number(_?.activeElement?.getAttribute("data-index"))!==a)&&l.current?.querySelector(`[type="range"][data-index="${a}"]`).focus(),h&&h(a)}function q6(l,a){return typeof l=="number"&&typeof a=="number"?l===a:typeof l=="object"&&typeof a=="object"?ehe(l,a):!1}const she={horizontal:{offset:l=>({left:`${l}%`}),leap:l=>({width:`${l}%`})},"horizontal-reverse":{offset:l=>({right:`${l}%`}),leap:l=>({width:`${l}%`})},vertical:{offset:l=>({bottom:`${l}%`}),leap:l=>({height:`${l}%`})}},ohe=l=>l;let X6;function JQ(){return X6===void 0&&(typeof CSS<"u"&&typeof CSS.supports=="function"?X6=CSS.supports("touch-action","none"):X6=!0),X6}function ahe(l){const{"aria-labelledby":a,defaultValue:h,disabled:_=!1,disableSwap:S=!1,isRtl:y=!1,marks:b=!1,max:D=100,min:U=0,name:x,onChange:q,onChangeCommitted:J,orientation:ee="horizontal",rootRef:ue,scale:oe=ohe,step:le=1,shiftStep:pe=10,tabIndex:Ne,value:Ve}=l,Ae=ae.useRef(void 0),[Ue,ke]=ae.useState(-1),[qe,Te]=ae.useState(-1),[he,_e]=ae.useState(!1),ye=ae.useRef(0),Ie=ae.useRef(null),[$,me]=n7({controlled:Ve,default:h??U,name:"Slider"}),Xe=q&&((Kt,wt,Ot)=>{const un=Kt.nativeEvent||Kt,rn=new un.constructor(un.type,un);Object.defineProperty(rn,"target",{writable:!0,value:{value:wt,name:x}}),Ie.current=wt,q(rn,wt,Ot)}),ct=Array.isArray($);let Me=ct?$.slice().sort(Jee):[$];Me=Me.map(Kt=>Kt==null?U:Ak(Kt,U,D));const Je=b===!0&&le!==null?[...Array(Math.floor((D-U)/le)+1)].map((Kt,wt)=>({value:U+le*wt})):b||[],mt=Je.map(Kt=>Kt.value),[yt,xe]=ae.useState(-1),it=ae.useRef(null),ft=Fu(ue,it),pt=Kt=>wt=>{const Ot=Number(wt.currentTarget.getAttribute("data-index"));yG(wt.target)&&xe(Ot),Te(Ot),Kt?.onFocus?.(wt)},xt=Kt=>wt=>{yG(wt.target)||xe(-1),Te(-1),Kt?.onBlur?.(wt)},ln=(Kt,wt)=>{const Ot=Number(Kt.currentTarget.getAttribute("data-index")),un=Me[Ot],rn=mt.indexOf(un);let Vn=wt;if(Je&&le==null){const Ci=mt[mt.length-1];Vn>=Ci?Vn=Ci:Vn<=mt[0]?Vn=mt[0]:Vn=Vn<un?mt[rn-1]:mt[rn+1]}if(Vn=Ak(Vn,U,D),ct){S&&(Vn=Ak(Vn,Me[Ot-1]||-1/0,Me[Ot+1]||1/0));const Ci=Vn;Vn=XQ({values:Me,newValue:Vn,index:Ot});let is=Ot;S||(is=Vn.indexOf(Ci)),Y6({sliderRef:it,activeIndex:is})}me(Vn),xe(Ot),Xe&&!q6(Vn,$)&&Xe(Kt,Vn,Ot),J&&J(Kt,Ie.current??Vn)},pn=Kt=>wt=>{if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","PageUp","PageDown","Home","End"].includes(wt.key)){wt.preventDefault();const Ot=Number(wt.currentTarget.getAttribute("data-index")),un=Me[Ot];let rn=null;if(le!=null){const Vn=wt.shiftKey?pe:le;switch(wt.key){case"ArrowUp":rn=bk(un,Vn,1,U,D);break;case"ArrowRight":rn=bk(un,Vn,y?-1:1,U,D);break;case"ArrowDown":rn=bk(un,Vn,-1,U,D);break;case"ArrowLeft":rn=bk(un,Vn,y?1:-1,U,D);break;case"PageUp":rn=bk(un,pe,1,U,D);break;case"PageDown":rn=bk(un,pe,-1,U,D);break;case"Home":rn=U;break;case"End":rn=D;break}}else if(Je){const Vn=mt[mt.length-1],Ci=mt.indexOf(un),is=[y?"ArrowRight":"ArrowLeft","ArrowDown","PageDown","Home"],ur=[y?"ArrowLeft":"ArrowRight","ArrowUp","PageUp","End"];is.includes(wt.key)?Ci===0?rn=mt[0]:rn=mt[Ci-1]:ur.includes(wt.key)&&(Ci===mt.length-1?rn=Vn:rn=mt[Ci+1])}rn!=null&&ln(wt,rn)}Kt?.onKeyDown?.(wt)};NS(()=>{_&&it.current.contains(document.activeElement)&&document.activeElement?.blur()},[_]),_&&Ue!==-1&&ke(-1),_&&yt!==-1&&xe(-1);const Zn=Kt=>wt=>{Kt.onChange?.(wt),ln(wt,wt.target.valueAsNumber)},ri=ae.useRef(void 0);let si=ee;y&&ee==="horizontal"&&(si+="-reverse");const En=({finger:Kt,move:wt=!1})=>{const{current:Ot}=it,{width:un,height:rn,bottom:Vn,left:Ci}=Ot.getBoundingClientRect();let is;si.startsWith("vertical")?is=(Vn-Kt.y)/rn:is=(Kt.x-Ci)/un,si.includes("-reverse")&&(is=1-is);let ur;if(ur=nhe(is,U,D),le)ur=rhe(ur,le,U);else{const hn=qQ(mt,ur);ur=mt[hn]}ur=Ak(ur,U,D);let wr=0;if(ct){wt?wr=ri.current:wr=qQ(Me,ur),S&&(ur=Ak(ur,Me[wr-1]||-1/0,Me[wr+1]||1/0));const hn=ur;ur=XQ({values:Me,newValue:ur,index:wr}),S&&wt||(wr=ur.indexOf(hn),ri.current=wr)}return{newValue:ur,activeIndex:wr}},oi=bS(Kt=>{const wt=z6(Kt,Ae);if(!wt)return;if(ye.current+=1,Kt.type==="mousemove"&&Kt.buttons===0){ui(Kt);return}const{newValue:Ot,activeIndex:un}=En({finger:wt,move:!0});Y6({sliderRef:it,activeIndex:un,setActive:ke}),me(Ot),!he&&ye.current>the&&_e(!0),Xe&&!q6(Ot,$)&&Xe(Kt,Ot,un)}),ui=bS(Kt=>{const wt=z6(Kt,Ae);if(_e(!1),!wt)return;const{newValue:Ot}=En({finger:wt,move:!0});ke(-1),Kt.type==="touchend"&&Te(-1),J&&J(Kt,Ie.current??Ot),Ae.current=void 0,qn()}),Kn=bS(Kt=>{if(_)return;JQ()||Kt.preventDefault();const wt=Kt.changedTouches[0];wt!=null&&(Ae.current=wt.identifier);const Ot=z6(Kt,Ae);if(Ot!==!1){const{newValue:rn,activeIndex:Vn}=En({finger:Ot});Y6({sliderRef:it,activeIndex:Vn,setActive:ke}),me(rn),Xe&&!q6(rn,$)&&Xe(Kt,rn,Vn)}ye.current=0;const un=xu(it.current);un.addEventListener("touchmove",oi,{passive:!0}),un.addEventListener("touchend",ui,{passive:!0})}),qn=ae.useCallback(()=>{const Kt=xu(it.current);Kt.removeEventListener("mousemove",oi),Kt.removeEventListener("mouseup",ui),Kt.removeEventListener("touchmove",oi),Kt.removeEventListener("touchend",ui)},[ui,oi]);ae.useEffect(()=>{const{current:Kt}=it;return Kt.addEventListener("touchstart",Kn,{passive:JQ()}),()=>{Kt.removeEventListener("touchstart",Kn),qn()}},[qn,Kn]),ae.useEffect(()=>{_&&qn()},[_,qn]);const Zi=Kt=>wt=>{if(Kt.onMouseDown?.(wt),_||wt.defaultPrevented||wt.button!==0)return;wt.preventDefault();const Ot=z6(wt,Ae);if(Ot!==!1){const{newValue:rn,activeIndex:Vn}=En({finger:Ot});Y6({sliderRef:it,activeIndex:Vn,setActive:ke}),me(rn),Xe&&!q6(rn,$)&&Xe(wt,rn,Vn)}ye.current=0;const un=xu(it.current);un.addEventListener("mousemove",oi,{passive:!0}),un.addEventListener("mouseup",ui)},Gi=bG(ct?Me[0]:U,U,D),yi=bG(Me[Me.length-1],U,D)-Gi,vn=(Kt={})=>{const wt=Fj(Kt),Ot={onMouseDown:Zi(wt||{})},un={...wt,...Ot};return{...Kt,ref:ft,...un}},xn=Kt=>wt=>{Kt.onMouseOver?.(wt);const Ot=Number(wt.currentTarget.getAttribute("data-index"));Te(Ot)},ir=Kt=>wt=>{Kt.onMouseLeave?.(wt),Te(-1)},Bi=(Kt={})=>{const wt=Fj(Kt),Ot={onMouseOver:xn(wt||{}),onMouseLeave:ir(wt||{})};return{...Kt,...wt,...Ot}},Sn=Kt=>({pointerEvents:Ue!==-1&&Ue!==Kt?"none":void 0});let Us;return ee==="vertical"&&(Us=y?"vertical-rl":"vertical-lr"),{active:Ue,axis:si,axisProps:she,dragging:he,focusedThumbIndex:yt,getHiddenInputProps:(Kt={})=>{const wt=Fj(Kt),Ot={onChange:Zn(wt||{}),onFocus:pt(wt||{}),onBlur:xt(wt||{}),onKeyDown:pn(wt||{})},un={...wt,...Ot};return{tabIndex:Ne,"aria-labelledby":a,"aria-orientation":ee,"aria-valuemax":oe(D),"aria-valuemin":oe(U),name:x,type:"range",min:l.min,max:l.max,step:l.step===null&&l.marks?"any":l.step??void 0,disabled:_,...Kt,...un,style:{...Wue,direction:y?"rtl":"ltr",width:"100%",height:"100%",writingMode:Us}}},getRootProps:vn,getThumbProps:Bi,marks:Je,open:qe,range:ct,rootRef:ft,trackLeap:yi,trackOffset:Gi,values:Me,getThumbStyle:Sn}}const che=l=>!l||!wb(l);function lhe(l){return Ro("MuiSlider",l)}const V_=Co("MuiSlider",["root","active","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","disabled","dragging","focusVisible","mark","markActive","marked","markLabel","markLabelActive","rail","sizeSmall","thumb","thumbColorPrimary","thumbColorSecondary","thumbColorError","thumbColorSuccess","thumbColorInfo","thumbColorWarning","track","trackInverted","trackFalse","thumbSizeSmall","valueLabel","valueLabelOpen","valueLabelCircle","valueLabelLabel","vertical"]),dhe=l=>{const{open:a}=l;return{offset:Ui(a&&V_.valueLabelOpen),circle:V_.valueLabelCircle,label:V_.valueLabelLabel}};function uhe(l){const{children:a,className:h,value:_}=l,S=dhe(l);return a?ae.cloneElement(a,{className:a.props.className},ze.jsxs(ae.Fragment,{children:[a.props.children,ze.jsx("span",{className:Ui(S.offset,h),"aria-hidden":!0,children:ze.jsx("span",{className:S.circle,children:ze.jsx("span",{className:S.label,children:_})})})]})):null}function QQ(l){return l}const hhe=Gn("span",{name:"MuiSlider",slot:"Root",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[a.root,a[`color${_i(h.color)}`],h.size!=="medium"&&a[`size${_i(h.size)}`],h.marked&&a.marked,h.orientation==="vertical"&&a.vertical,h.track==="inverted"&&a.trackInverted,h.track===!1&&a.trackFalse]}})(uo(({theme:l})=>({borderRadius:12,boxSizing:"content-box",display:"inline-block",position:"relative",cursor:"pointer",touchAction:"none",WebkitTapHighlightColor:"transparent","@media print":{colorAdjust:"exact"},[`&.${V_.disabled}`]:{pointerEvents:"none",cursor:"default",color:(l.vars||l).palette.grey[400]},[`&.${V_.dragging}`]:{[`& .${V_.thumb}, & .${V_.track}`]:{transition:"none"}},variants:[...Object.entries(l.palette).filter(RE()).map(([a])=>({props:{color:a},style:{color:(l.vars||l).palette[a].main}})),{props:{orientation:"horizontal"},style:{height:4,width:"100%",padding:"13px 0","@media (pointer: coarse)":{padding:"20px 0"}}},{props:{orientation:"horizontal",size:"small"},style:{height:2}},{props:{orientation:"horizontal",marked:!0},style:{marginBottom:20}},{props:{orientation:"vertical"},style:{height:"100%",width:4,padding:"0 13px","@media (pointer: coarse)":{padding:"0 20px"}}},{props:{orientation:"vertical",size:"small"},style:{width:2}},{props:{orientation:"vertical",marked:!0},style:{marginRight:44}}]}))),phe=Gn("span",{name:"MuiSlider",slot:"Rail"})({display:"block",position:"absolute",borderRadius:"inherit",backgroundColor:"currentColor",opacity:.38,variants:[{props:{orientation:"horizontal"},style:{width:"100%",height:"inherit",top:"50%",transform:"translateY(-50%)"}},{props:{orientation:"vertical"},style:{height:"100%",width:"inherit",left:"50%",transform:"translateX(-50%)"}},{props:{track:"inverted"},style:{opacity:1}}]}),fhe=Gn("span",{name:"MuiSlider",slot:"Track"})(uo(({theme:l})=>({display:"block",position:"absolute",borderRadius:"inherit",border:"1px solid currentColor",backgroundColor:"currentColor",transition:l.transitions.create(["left","width","bottom","height"],{duration:l.transitions.duration.shortest}),variants:[{props:{size:"small"},style:{border:"none"}},{props:{orientation:"horizontal"},style:{height:"inherit",top:"50%",transform:"translateY(-50%)"}},{props:{orientation:"vertical"},style:{width:"inherit",left:"50%",transform:"translateX(-50%)"}},{props:{track:!1},style:{display:"none"}},...Object.entries(l.palette).filter(RE()).map(([a])=>({props:{color:a,track:"inverted"},style:{...l.vars?{backgroundColor:l.vars.palette.Slider[`${a}Track`],borderColor:l.vars.palette.Slider[`${a}Track`]}:{backgroundColor:l.lighten(l.palette[a].main,.62),borderColor:l.lighten(l.palette[a].main,.62),...l.applyStyles("dark",{backgroundColor:l.darken(l.palette[a].main,.5)}),...l.applyStyles("dark",{borderColor:l.darken(l.palette[a].main,.5)})}}}))]}))),_he=Gn("span",{name:"MuiSlider",slot:"Thumb",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[a.thumb,a[`thumbColor${_i(h.color)}`],h.size!=="medium"&&a[`thumbSize${_i(h.size)}`]]}})(uo(({theme:l})=>({position:"absolute",width:20,height:20,boxSizing:"border-box",borderRadius:"50%",outline:0,backgroundColor:"currentColor",display:"flex",alignItems:"center",justifyContent:"center",transition:l.transitions.create(["box-shadow","left","bottom"],{duration:l.transitions.duration.shortest}),"&::before":{position:"absolute",content:'""',borderRadius:"inherit",width:"100%",height:"100%",boxShadow:(l.vars||l).shadows[2]},"&::after":{position:"absolute",content:'""',borderRadius:"50%",width:42,height:42,top:"50%",left:"50%",transform:"translate(-50%, -50%)"},[`&.${V_.disabled}`]:{"&:hover":{boxShadow:"none"}},variants:[{props:{size:"small"},style:{width:12,height:12,"&::before":{boxShadow:"none"}}},{props:{orientation:"horizontal"},style:{top:"50%",transform:"translate(-50%, -50%)"}},{props:{orientation:"vertical"},style:{left:"50%",transform:"translate(-50%, 50%)"}},...Object.entries(l.palette).filter(RE()).map(([a])=>({props:{color:a},style:{[`&:hover, &.${V_.focusVisible}`]:{boxShadow:`0px 0px 0px 8px ${l.alpha((l.vars||l).palette[a].main,.16)}`,"@media (hover: none)":{boxShadow:"none"}},[`&.${V_.active}`]:{boxShadow:`0px 0px 0px 14px ${l.alpha((l.vars||l).palette[a].main,.16)}`}}}))]}))),mhe=Gn(uhe,{name:"MuiSlider",slot:"ValueLabel"})(uo(({theme:l})=>({zIndex:1,whiteSpace:"nowrap",...l.typography.body2,fontWeight:500,transition:l.transitions.create(["transform"],{duration:l.transitions.duration.shortest}),position:"absolute",backgroundColor:(l.vars||l).palette.grey[600],borderRadius:2,color:(l.vars||l).palette.common.white,display:"flex",alignItems:"center",justifyContent:"center",padding:"0.25rem 0.75rem",variants:[{props:{orientation:"horizontal"},style:{transform:"translateY(-100%) scale(0)",top:"-10px",transformOrigin:"bottom center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, 50%) rotate(45deg)",backgroundColor:"inherit",bottom:0,left:"50%"},[`&.${V_.valueLabelOpen}`]:{transform:"translateY(-100%) scale(1)"}}},{props:{orientation:"vertical"},style:{transform:"translateY(-50%) scale(0)",right:"30px",top:"50%",transformOrigin:"right center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, -50%) rotate(45deg)",backgroundColor:"inherit",right:-8,top:"50%"},[`&.${V_.valueLabelOpen}`]:{transform:"translateY(-50%) scale(1)"}}},{props:{size:"small"},style:{fontSize:l.typography.pxToRem(12),padding:"0.25rem 0.5rem"}},{props:{orientation:"vertical",size:"small"},style:{right:"20px"}}]}))),Ehe=Gn("span",{name:"MuiSlider",slot:"Mark",shouldForwardProp:l=>_W(l)&&l!=="markActive",overridesResolver:(l,a)=>{const{markActive:h}=l;return[a.mark,h&&a.markActive]}})(uo(({theme:l})=>({position:"absolute",width:2,height:2,borderRadius:1,backgroundColor:"currentColor",variants:[{props:{orientation:"horizontal"},style:{top:"50%",transform:"translate(-1px, -50%)"}},{props:{orientation:"vertical"},style:{left:"50%",transform:"translate(-50%, 1px)"}},{props:{markActive:!0},style:{backgroundColor:(l.vars||l).palette.background.paper,opacity:.8}}]}))),ghe=Gn("span",{name:"MuiSlider",slot:"MarkLabel",shouldForwardProp:l=>_W(l)&&l!=="markLabelActive"})(uo(({theme:l})=>({...l.typography.body2,color:(l.vars||l).palette.text.secondary,position:"absolute",whiteSpace:"nowrap",variants:[{props:{orientation:"horizontal"},style:{top:30,transform:"translateX(-50%)","@media (pointer: coarse)":{top:40}}},{props:{orientation:"vertical"},style:{left:36,transform:"translateY(50%)","@media (pointer: coarse)":{left:44}}},{props:{markLabelActive:!0},style:{color:(l.vars||l).palette.text.primary}}]}))),She=l=>{const{disabled:a,dragging:h,marked:_,orientation:S,track:y,classes:b,color:D,size:U}=l,x={root:["root",a&&"disabled",h&&"dragging",_&&"marked",S==="vertical"&&"vertical",y==="inverted"&&"trackInverted",y===!1&&"trackFalse",D&&`color${_i(D)}`,U&&`size${_i(U)}`],rail:["rail"],track:["track"],mark:["mark"],markActive:["markActive"],markLabel:["markLabel"],markLabelActive:["markLabelActive"],valueLabel:["valueLabel"],thumb:["thumb",a&&"disabled",U&&`thumbSize${_i(U)}`,D&&`thumbColor${_i(D)}`],active:["active"],disabled:["disabled"],focusVisible:["focusVisible"]};return bo(x,lhe,b)},The=({children:l})=>l,ZQ=ae.forwardRef(function(a,h){const _=Io({props:a,name:"MuiSlider"}),S=vee(),{"aria-label":y,"aria-valuetext":b,"aria-labelledby":D,component:U="span",components:x={},componentsProps:q={},color:J="primary",classes:ee,className:ue,disableSwap:oe=!1,disabled:le=!1,getAriaLabel:pe,getAriaValueText:Ne,marks:Ve=!1,max:Ae=100,min:Ue=0,name:ke,onChange:qe,onChangeCommitted:Te,orientation:he="horizontal",shiftStep:_e=10,size:ye="medium",step:Ie=1,scale:$=QQ,slotProps:me,slots:Xe,tabIndex:ct,track:Me="normal",value:Je,valueLabelDisplay:mt="off",valueLabelFormat:yt=QQ,...xe}=_,it={..._,isRtl:S,max:Ae,min:Ue,classes:ee,disabled:le,disableSwap:oe,orientation:he,marks:Ve,color:J,size:ye,step:Ie,shiftStep:_e,scale:$,track:Me,valueLabelDisplay:mt,valueLabelFormat:yt},{axisProps:ft,getRootProps:pt,getHiddenInputProps:xt,getThumbProps:ln,open:pn,active:Zn,axis:ri,focusedThumbIndex:si,range:En,dragging:oi,marks:ui,values:Kn,trackOffset:qn,trackLeap:Zi,getThumbStyle:Gi}=ahe({...it,rootRef:h});it.marked=ui.length>0&&ui.some(Xr=>Xr.label),it.dragging=oi,it.focusedThumbIndex=si;const yi=She(it),vn=Xe?.root??x.Root??hhe,xn=Xe?.rail??x.Rail??phe,ir=Xe?.track??x.Track??fhe,Bi=Xe?.thumb??x.Thumb??_he,Sn=Xe?.valueLabel??x.ValueLabel??mhe,Us=Xe?.mark??x.Mark??Ehe,Rn=Xe?.markLabel??x.MarkLabel??ghe,Kt=Xe?.input??x.Input??"input",wt=me?.root??q.root,Ot=me?.rail??q.rail,un=me?.track??q.track,rn=me?.thumb??q.thumb,Vn=me?.valueLabel??q.valueLabel,Ci=me?.mark??q.mark,is=me?.markLabel??q.markLabel,ur=me?.input??q.input,wr=Zv({elementType:vn,getSlotProps:pt,externalSlotProps:wt,externalForwardedProps:xe,additionalProps:{...che(vn)&&{as:U}},ownerState:{...it,...wt?.ownerState},className:[yi.root,ue]}),hn=Zv({elementType:xn,externalSlotProps:Ot,ownerState:it,className:yi.rail}),hr=Zv({elementType:ir,externalSlotProps:un,additionalProps:{style:{...ft[ri].offset(qn),...ft[ri].leap(Zi)}},ownerState:{...it,...un?.ownerState},className:yi.track}),rs=Zv({elementType:Bi,getSlotProps:ln,externalSlotProps:rn,ownerState:{...it,...rn?.ownerState},className:yi.thumb}),eo=Zv({elementType:Sn,externalSlotProps:Vn,ownerState:{...it,...Vn?.ownerState},className:yi.valueLabel}),Qc=Zv({elementType:Us,externalSlotProps:Ci,ownerState:it,className:yi.mark}),Rf=Zv({elementType:Rn,externalSlotProps:is,ownerState:it,className:yi.markLabel}),Yd=Zv({elementType:Kt,getSlotProps:xt,externalSlotProps:ur,ownerState:it});return ze.jsxs(vn,{...wr,children:[ze.jsx(xn,{...hn}),ze.jsx(ir,{...hr}),ui.filter(Xr=>Xr.value>=Ue&&Xr.value<=Ae).map((Xr,ho)=>{const Fo=bG(Xr.value,Ue,Ae),ju=ft[ri].offset(Fo);let Ts;return Me===!1?Ts=Kn.includes(Xr.value):Ts=Me==="normal"&&(En?Xr.value>=Kn[0]&&Xr.value<=Kn[Kn.length-1]:Xr.value<=Kn[0])||Me==="inverted"&&(En?Xr.value<=Kn[0]||Xr.value>=Kn[Kn.length-1]:Xr.value>=Kn[0]),ze.jsxs(ae.Fragment,{children:[ze.jsx(Us,{"data-index":ho,...Qc,...!wb(Us)&&{markActive:Ts},style:{...ju,...Qc.style},className:Ui(Qc.className,Ts&&yi.markActive)}),Xr.label!=null?ze.jsx(Rn,{"aria-hidden":!0,"data-index":ho,...Rf,...!wb(Rn)&&{markLabelActive:Ts},style:{...ju,...Rf.style},className:Ui(yi.markLabel,Rf.className,Ts&&yi.markLabelActive),children:Xr.label}):null]},ho)}),Kn.map((Xr,ho)=>{const Fo=bG(Xr,Ue,Ae),ju=ft[ri].offset(Fo),Ts=mt==="off"?The:Sn;return ze.jsx(Ts,{...!wb(Ts)&&{valueLabelFormat:yt,valueLabelDisplay:mt,value:typeof yt=="function"?yt($(Xr),ho):yt,index:ho,open:pn===ho||Zn===ho||mt==="on",disabled:le},...eo,children:ze.jsx(Bi,{"data-index":ho,...rs,className:Ui(yi.thumb,rs.className,Zn===ho&&yi.active,si===ho&&yi.focusVisible),style:{...ju,...Gi(ho),...rs.style},children:ze.jsx(Kt,{"data-index":ho,"aria-label":pe?pe(ho):y,"aria-valuenow":$(Xr),"aria-labelledby":D,"aria-valuetext":Ne?Ne($(Xr),ho):b,value:Kn[ho],...Yd})})},ho)})]})});function vhe(l){return Ro("MuiToolbar",l)}Co("MuiToolbar",["root","gutters","regular","dense"]);const yhe=l=>{const{classes:a,disableGutters:h,variant:_}=l;return bo({root:["root",!h&&"gutters",_]},vhe,a)},Rhe=Gn("div",{name:"MuiToolbar",slot:"Root",overridesResolver:(l,a)=>{const{ownerState:h}=l;return[a.root,!h.disableGutters&&a.gutters,a[h.variant]]}})(uo(({theme:l})=>({position:"relative",display:"flex",alignItems:"center",variants:[{props:({ownerState:a})=>!a.disableGutters,style:{paddingLeft:l.spacing(2),paddingRight:l.spacing(2),[l.breakpoints.up("sm")]:{paddingLeft:l.spacing(3),paddingRight:l.spacing(3)}}},{props:{variant:"dense"},style:{minHeight:48}},{props:{variant:"regular"},style:l.mixins.toolbar}]}))),Che=ae.forwardRef(function(a,h){const _=Io({props:a,name:"MuiToolbar"}),{className:S,component:y="div",disableGutters:b=!1,variant:D="regular",...U}=_,x={..._,component:y,disableGutters:b,variant:D},q=yhe(x);return ze.jsx(Rhe,{as:y,className:Ui(q.root,S),ref:h,ownerState:x,...U})});function bhe(l){return Ro("MuiTextField",l)}Co("MuiTextField",["root"]);const Ihe={standard:_X,filled:fX,outlined:EX},Ahe=l=>{const{classes:a}=l;return bo({root:["root"]},bhe,a)},whe=Gn(Xde,{name:"MuiTextField",slot:"Root"})({}),Ohe=ae.forwardRef(function(a,h){const _=Io({props:a,name:"MuiTextField"}),{autoComplete:S,autoFocus:y=!1,children:b,className:D,color:U="primary",defaultValue:x,disabled:q=!1,error:J=!1,FormHelperTextProps:ee,fullWidth:ue=!1,helperText:oe,id:le,InputLabelProps:pe,inputProps:Ne,InputProps:Ve,inputRef:Ae,label:Ue,maxRows:ke,minRows:qe,multiline:Te=!1,name:he,onBlur:_e,onChange:ye,onFocus:Ie,placeholder:$,required:me=!1,rows:Xe,select:ct=!1,SelectProps:Me,slots:Je={},slotProps:mt={},type:yt,value:xe,variant:it="outlined",...ft}=_,pt={..._,autoFocus:y,color:U,disabled:q,error:J,fullWidth:ue,multiline:Te,required:me,select:ct,variant:it},xt=Ahe(pt),ln=pW(le),pn=oe&&ln?`${ln}-helper-text`:void 0,Zn=Ue&&ln?`${ln}-label`:void 0,ri=Ihe[it],si={slots:Je,slotProps:{input:Ve,inputLabel:pe,htmlInput:Ne,formHelperText:ee,select:Me,...mt}},En={},oi=si.slotProps.inputLabel;it==="outlined"&&(oi&&typeof oi.shrink<"u"&&(En.notched=oi.shrink),En.label=Ue),ct&&((!Me||!Me.native)&&(En.id=void 0),En["aria-describedby"]=void 0);const[ui,Kn]=Wd("root",{elementType:whe,shouldForwardComponentProp:!0,externalForwardedProps:{...si,...ft},ownerState:pt,className:Ui(xt.root,D),ref:h,additionalProps:{disabled:q,error:J,fullWidth:ue,required:me,color:U,variant:it}}),[qn,Zi]=Wd("input",{elementType:ri,externalForwardedProps:si,additionalProps:En,ownerState:pt}),[Gi,yi]=Wd("inputLabel",{elementType:hue,externalForwardedProps:si,ownerState:pt}),[vn,xn]=Wd("htmlInput",{elementType:"input",externalForwardedProps:si,ownerState:pt}),[ir,Bi]=Wd("formHelperText",{elementType:$de,externalForwardedProps:si,ownerState:pt}),[Sn,Us]=Wd("select",{elementType:Xee,externalForwardedProps:si,ownerState:pt}),Rn=ze.jsx(qn,{"aria-describedby":pn,autoComplete:S,autoFocus:y,defaultValue:x,fullWidth:ue,multiline:Te,name:he,rows:Xe,maxRows:ke,minRows:qe,type:yt,value:xe,id:ln,inputRef:Ae,onBlur:_e,onChange:ye,onFocus:Ie,placeholder:$,inputProps:xn,slots:{input:Je.htmlInput?vn:void 0},...Zi});return ze.jsxs(ui,{...Kn,children:[Ue!=null&&Ue!==""&&ze.jsx(Gi,{htmlFor:ln,id:Zn,...yi,children:Ue}),ct?ze.jsx(Sn,{"aria-describedby":pn,id:ln,labelId:Zn,value:xe,input:Rn,...Us,children:b}):Rn,oe&&ze.jsx(ir,{id:pn,...Bi,children:oe})]})}),Nhe=[{id:"livestream1",title:"Live Jam Session",artist:"The Funky Bunch"},{id:"livestream2",title:"Acoustic Set",artist:"Sarah Sings"},{id:"livestream3",title:"DJ Mix",artist:"DJ Beatmaster"}];function Dhe(){return ze.jsxs(mS,{children:[ze.jsx($v,{variant:"h4",gutterBottom:!0,sx:{color:"#fff",fontWeight:"bold",mb:4},children:"Happening Now"}),ze.jsx(mS,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:3},children:Nhe.map(l=>ze.jsxs(uX,{sx:{p:3,borderRadius:"16px",background:"#1e1e1e",boxShadow:"0 8px 16px rgba(0,0,0,0.5)",transition:"transform 0.3s","&:hover":{transform:"translateY(-5px)"}},children:[ze.jsx($v,{variant:"h6",sx:{fontWeight:"bold",color:"#fff"},children:l.title}),ze.jsx($v,{variant:"body2",sx:{color:"#ccc",mb:2},children:l.artist}),ze.jsx(s3,{component:$j,to:`/livestream/${l.id}`,variant:"contained",sx:{background:"linear-gradient(45deg, #FE6B8B 30%, #FF8E53 90%)",boxShadow:"0 3px 5px 2px rgba(255, 105, 135, .3)",borderRadius:"20px"},children:"Join Stream"})]},l.id))})]})}const Phe=()=>{};var $Q={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qee={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xt=function(l,a){if(!l)throw tL(a)},tL=function(l){return new Error("Firebase Database ("+Qee.SDK_VERSION+") INTERNAL ASSERT FAILED: "+l)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zee=function(l){const a=[];let h=0;for(let _=0;_<l.length;_++){let S=l.charCodeAt(_);S<128?a[h++]=S:S<2048?(a[h++]=S>>6|192,a[h++]=S&63|128):(S&64512)===55296&&_+1<l.length&&(l.charCodeAt(_+1)&64512)===56320?(S=65536+((S&1023)<<10)+(l.charCodeAt(++_)&1023),a[h++]=S>>18|240,a[h++]=S>>12&63|128,a[h++]=S>>6&63|128,a[h++]=S&63|128):(a[h++]=S>>12|224,a[h++]=S>>6&63|128,a[h++]=S&63|128)}return a},khe=function(l){const a=[];let h=0,_=0;for(;h<l.length;){const S=l[h++];if(S<128)a[_++]=String.fromCharCode(S);else if(S>191&&S<224){const y=l[h++];a[_++]=String.fromCharCode((S&31)<<6|y&63)}else if(S>239&&S<365){const y=l[h++],b=l[h++],D=l[h++],U=((S&7)<<18|(y&63)<<12|(b&63)<<6|D&63)-65536;a[_++]=String.fromCharCode(55296+(U>>10)),a[_++]=String.fromCharCode(56320+(U&1023))}else{const y=l[h++],b=l[h++];a[_++]=String.fromCharCode((S&15)<<12|(y&63)<<6|b&63)}}return a.join("")},SX={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(l,a){if(!Array.isArray(l))throw Error("encodeByteArray takes an array as a parameter");this.init_();const h=a?this.byteToCharMapWebSafe_:this.byteToCharMap_,_=[];for(let S=0;S<l.length;S+=3){const y=l[S],b=S+1<l.length,D=b?l[S+1]:0,U=S+2<l.length,x=U?l[S+2]:0,q=y>>2,J=(y&3)<<4|D>>4;let ee=(D&15)<<2|x>>6,ue=x&63;U||(ue=64,b||(ee=64)),_.push(h[q],h[J],h[ee],h[ue])}return _.join("")},encodeString(l,a){return this.HAS_NATIVE_SUPPORT&&!a?btoa(l):this.encodeByteArray(Zee(l),a)},decodeString(l,a){return this.HAS_NATIVE_SUPPORT&&!a?atob(l):khe(this.decodeStringToByteArray(l,a))},decodeStringToByteArray(l,a){this.init_();const h=a?this.charToByteMapWebSafe_:this.charToByteMap_,_=[];for(let S=0;S<l.length;){const y=h[l.charAt(S++)],D=S<l.length?h[l.charAt(S)]:0;++S;const x=S<l.length?h[l.charAt(S)]:64;++S;const J=S<l.length?h[l.charAt(S)]:64;if(++S,y==null||D==null||x==null||J==null)throw new Lhe;const ee=y<<2|D>>4;if(_.push(ee),x!==64){const ue=D<<4&240|x>>2;if(_.push(ue),J!==64){const oe=x<<6&192|J;_.push(oe)}}}return _},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let l=0;l<this.ENCODED_VALS.length;l++)this.byteToCharMap_[l]=this.ENCODED_VALS.charAt(l),this.charToByteMap_[this.byteToCharMap_[l]]=l,this.byteToCharMapWebSafe_[l]=this.ENCODED_VALS_WEBSAFE.charAt(l),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[l]]=l,l>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(l)]=l,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(l)]=l)}}};class Lhe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const $ee=function(l){const a=Zee(l);return SX.encodeByteArray(a,!0)},IG=function(l){return $ee(l).replace(/\./g,"")},AG=function(l){try{return SX.decodeString(l,!0)}catch(a){console.error("base64Decode failed: ",a)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mhe(l){return ete(void 0,l)}function ete(l,a){if(!(a instanceof Object))return a;switch(a.constructor){case Date:const h=a;return new Date(h.getTime());case Object:l===void 0&&(l={});break;case Array:l=[];break;default:return a}for(const h in a)!a.hasOwnProperty(h)||!Uhe(h)||(l[h]=ete(l[h],a[h]));return l}function Uhe(l){return l!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xhe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vhe=()=>xhe().__FIREBASE_DEFAULTS__,Fhe=()=>{if(typeof process>"u"||typeof $Q>"u")return;const l=$Q.__FIREBASE_DEFAULTS__;if(l)return JSON.parse(l)},Bhe=()=>{if(typeof document>"u")return;let l;try{l=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const a=l&&AG(l[1]);return a&&JSON.parse(a)},TX=()=>{try{return Phe()||Vhe()||Fhe()||Bhe()}catch(l){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${l}`);return}},tte=l=>TX()?.emulatorHosts?.[l],nte=l=>{const a=tte(l);if(!a)return;const h=a.lastIndexOf(":");if(h<=0||h+1===a.length)throw new Error(`Invalid host ${a} with no separate hostname and port!`);const _=parseInt(a.substring(h+1),10);return a[0]==="["?[a.substring(1,h-1),_]:[a.substring(0,h),_]},ite=()=>TX()?.config,rte=l=>TX()?.[`_${l}`];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TW{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((a,h)=>{this.resolve=a,this.reject=h})}wrapCallback(a){return(h,_)=>{h?this.reject(h):this.resolve(_),typeof a=="function"&&(this.promise.catch(()=>{}),a.length===1?a(h):a(h,_))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lO(l){try{return(l.startsWith("http://")||l.startsWith("https://")?new URL(l).hostname:l).endsWith(".cloudworkstations.dev")}catch{return!1}}async function vX(l){return(await fetch(l,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ste(l,a){if(l.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const h={alg:"none",type:"JWT"},_=a||"demo-project",S=l.iat||0,y=l.sub||l.user_id;if(!y)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const b={iss:`https://securetoken.google.com/${_}`,aud:_,iat:S,exp:S+3600,auth_time:S,sub:y,user_id:y,firebase:{sign_in_provider:"custom",identities:{}},...l};return[IG(JSON.stringify(h)),IG(JSON.stringify(b)),""].join(".")}const Gj={};function jhe(){const l={prod:[],emulator:[]};for(const a of Object.keys(Gj))Gj[a]?l.emulator.push(a):l.prod.push(a);return l}function Ghe(l){let a=document.getElementById(l),h=!1;return a||(a=document.createElement("div"),a.setAttribute("id",l),h=!0),{created:h,element:a}}let eZ=!1;function yX(l,a){if(typeof window>"u"||typeof document>"u"||!lO(window.location.host)||Gj[l]===a||Gj[l]||eZ)return;Gj[l]=a;function h(ee){return`__firebase__banner__${ee}`}const _="__firebase__banner",y=jhe().prod.length>0;function b(){const ee=document.getElementById(_);ee&&ee.remove()}function D(ee){ee.style.display="flex",ee.style.background="#7faaf0",ee.style.position="fixed",ee.style.bottom="5px",ee.style.left="5px",ee.style.padding=".5em",ee.style.borderRadius="5px",ee.style.alignItems="center"}function U(ee,ue){ee.setAttribute("width","24"),ee.setAttribute("id",ue),ee.setAttribute("height","24"),ee.setAttribute("viewBox","0 0 24 24"),ee.setAttribute("fill","none"),ee.style.marginLeft="-6px"}function x(){const ee=document.createElement("span");return ee.style.cursor="pointer",ee.style.marginLeft="16px",ee.style.fontSize="24px",ee.innerHTML=" &times;",ee.onclick=()=>{eZ=!0,b()},ee}function q(ee,ue){ee.setAttribute("id",ue),ee.innerText="Learn more",ee.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",ee.setAttribute("target","__blank"),ee.style.paddingLeft="5px",ee.style.textDecoration="underline"}function J(){const ee=Ghe(_),ue=h("text"),oe=document.getElementById(ue)||document.createElement("span"),le=h("learnmore"),pe=document.getElementById(le)||document.createElement("a"),Ne=h("preprendIcon"),Ve=document.getElementById(Ne)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(ee.created){const Ae=ee.element;D(Ae),q(pe,le);const Ue=x();U(Ve,Ne),Ae.append(Ve,oe,pe,Ue),document.body.appendChild(Ae)}y?(oe.innerText="Preview backend disconnected.",Ve.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(Ve.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,oe.innerText="Preview backend running in this workspace."),oe.setAttribute("id",ue)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",J):J()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bu(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function RX(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Bu())}function Whe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Hhe(){const l=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof l=="object"&&l.id!==void 0}function ote(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Khe(){const l=Bu();return l.indexOf("MSIE ")>=0||l.indexOf("Trident/")>=0}function zhe(){return Qee.NODE_ADMIN===!0}function Yhe(){try{return typeof indexedDB=="object"}catch{return!1}}function qhe(){return new Promise((l,a)=>{try{let h=!0;const _="validate-browser-context-for-indexeddb-analytics-module",S=self.indexedDB.open(_);S.onsuccess=()=>{S.result.close(),h||self.indexedDB.deleteDatabase(_),l(!0)},S.onupgradeneeded=()=>{h=!1},S.onerror=()=>{a(S.error?.message||"")}}catch(h){a(h)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xhe="FirebaseError";class my extends Error{constructor(a,h,_){super(h),this.code=a,this.customData=_,this.name=Xhe,Object.setPrototypeOf(this,my.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,w3.prototype.create)}}class w3{constructor(a,h,_){this.service=a,this.serviceName=h,this.errors=_}create(a,...h){const _=h[0]||{},S=`${this.service}/${a}`,y=this.errors[a],b=y?Jhe(y,_):"Error",D=`${this.serviceName}: ${b} (${S}).`;return new my(S,D,_)}}function Jhe(l,a){return l.replace(Qhe,(h,_)=>{const S=a[_];return S!=null?String(S):`<${_}?>`})}const Qhe=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o3(l){return JSON.parse(l)}function wl(l){return JSON.stringify(l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ate=function(l){let a={},h={},_={},S="";try{const y=l.split(".");a=o3(AG(y[0])||""),h=o3(AG(y[1])||""),S=y[2],_=h.d||{},delete h.d}catch{}return{header:a,claims:h,data:_,signature:S}},Zhe=function(l){const a=ate(l),h=a.claims;return!!h&&typeof h=="object"&&h.hasOwnProperty("iat")},$he=function(l){const a=ate(l).claims;return typeof a=="object"&&a.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ey(l,a){return Object.prototype.hasOwnProperty.call(l,a)}function Hk(l,a){if(Object.prototype.hasOwnProperty.call(l,a))return l[a]}function u7(l){for(const a in l)if(Object.prototype.hasOwnProperty.call(l,a))return!1;return!0}function wG(l,a,h){const _={};for(const S in l)Object.prototype.hasOwnProperty.call(l,S)&&(_[S]=a.call(h,l[S],S,l));return _}function Lb(l,a){if(l===a)return!0;const h=Object.keys(l),_=Object.keys(a);for(const S of h){if(!_.includes(S))return!1;const y=l[S],b=a[S];if(tZ(y)&&tZ(b)){if(!Lb(y,b))return!1}else if(y!==b)return!1}for(const S of _)if(!h.includes(S))return!1;return!0}function tZ(l){return l!==null&&typeof l=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nL(l){const a=[];for(const[h,_]of Object.entries(l))Array.isArray(_)?_.forEach(S=>{a.push(encodeURIComponent(h)+"="+encodeURIComponent(S))}):a.push(encodeURIComponent(h)+"="+encodeURIComponent(_));return a.length?"&"+a.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class epe{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let a=1;a<this.blockSize;++a)this.pad_[a]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(a,h){h||(h=0);const _=this.W_;if(typeof a=="string")for(let J=0;J<16;J++)_[J]=a.charCodeAt(h)<<24|a.charCodeAt(h+1)<<16|a.charCodeAt(h+2)<<8|a.charCodeAt(h+3),h+=4;else for(let J=0;J<16;J++)_[J]=a[h]<<24|a[h+1]<<16|a[h+2]<<8|a[h+3],h+=4;for(let J=16;J<80;J++){const ee=_[J-3]^_[J-8]^_[J-14]^_[J-16];_[J]=(ee<<1|ee>>>31)&4294967295}let S=this.chain_[0],y=this.chain_[1],b=this.chain_[2],D=this.chain_[3],U=this.chain_[4],x,q;for(let J=0;J<80;J++){J<40?J<20?(x=D^y&(b^D),q=1518500249):(x=y^b^D,q=1859775393):J<60?(x=y&b|D&(y|b),q=2400959708):(x=y^b^D,q=3395469782);const ee=(S<<5|S>>>27)+x+U+q+_[J]&4294967295;U=D,D=b,b=(y<<30|y>>>2)&4294967295,y=S,S=ee}this.chain_[0]=this.chain_[0]+S&4294967295,this.chain_[1]=this.chain_[1]+y&4294967295,this.chain_[2]=this.chain_[2]+b&4294967295,this.chain_[3]=this.chain_[3]+D&4294967295,this.chain_[4]=this.chain_[4]+U&4294967295}update(a,h){if(a==null)return;h===void 0&&(h=a.length);const _=h-this.blockSize;let S=0;const y=this.buf_;let b=this.inbuf_;for(;S<h;){if(b===0)for(;S<=_;)this.compress_(a,S),S+=this.blockSize;if(typeof a=="string"){for(;S<h;)if(y[b]=a.charCodeAt(S),++b,++S,b===this.blockSize){this.compress_(y),b=0;break}}else for(;S<h;)if(y[b]=a[S],++b,++S,b===this.blockSize){this.compress_(y),b=0;break}}this.inbuf_=b,this.total_+=h}digest(){const a=[];let h=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let S=this.blockSize-1;S>=56;S--)this.buf_[S]=h&255,h/=256;this.compress_(this.buf_);let _=0;for(let S=0;S<5;S++)for(let y=24;y>=0;y-=8)a[_]=this.chain_[S]>>y&255,++_;return a}}function tpe(l,a){const h=new npe(l,a);return h.subscribe.bind(h)}class npe{constructor(a,h){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=h,this.task.then(()=>{a(this)}).catch(_=>{this.error(_)})}next(a){this.forEachObserver(h=>{h.next(a)})}error(a){this.forEachObserver(h=>{h.error(a)}),this.close(a)}complete(){this.forEachObserver(a=>{a.complete()}),this.close()}subscribe(a,h,_){let S;if(a===void 0&&h===void 0&&_===void 0)throw new Error("Missing Observer.");ipe(a,["next","error","complete"])?S=a:S={next:a,error:h,complete:_},S.next===void 0&&(S.next=Aq),S.error===void 0&&(S.error=Aq),S.complete===void 0&&(S.complete=Aq);const y=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?S.error(this.finalError):S.complete()}catch{}}),this.observers.push(S),y}unsubscribeOne(a){this.observers===void 0||this.observers[a]===void 0||(delete this.observers[a],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(a){if(!this.finalized)for(let h=0;h<this.observers.length;h++)this.sendOne(h,a)}sendOne(a,h){this.task.then(()=>{if(this.observers!==void 0&&this.observers[a]!==void 0)try{h(this.observers[a])}catch(_){typeof console<"u"&&console.error&&console.error(_)}})}close(a){this.finalized||(this.finalized=!0,a!==void 0&&(this.finalError=a),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ipe(l,a){if(typeof l!="object"||l===null)return!1;for(const h of a)if(h in l&&typeof l[h]=="function")return!0;return!1}function Aq(){}function CX(l,a){return`${l} failed: ${a} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rpe=function(l){const a=[];let h=0;for(let _=0;_<l.length;_++){let S=l.charCodeAt(_);if(S>=55296&&S<=56319){const y=S-55296;_++,Xt(_<l.length,"Surrogate pair missing trail surrogate.");const b=l.charCodeAt(_)-56320;S=65536+(y<<10)+b}S<128?a[h++]=S:S<2048?(a[h++]=S>>6|192,a[h++]=S&63|128):S<65536?(a[h++]=S>>12|224,a[h++]=S>>6&63|128,a[h++]=S&63|128):(a[h++]=S>>18|240,a[h++]=S>>12&63|128,a[h++]=S>>6&63|128,a[h++]=S&63|128)}return a},vW=function(l){let a=0;for(let h=0;h<l.length;h++){const _=l.charCodeAt(h);_<128?a++:_<2048?a+=2:_>=55296&&_<=56319?(a+=4,h++):a+=3}return a};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yf(l){return l&&l._delegate?l._delegate:l}class Mb{constructor(a,h,_){this.name=a,this.instanceFactory=h,this.type=_,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(a){return this.instantiationMode=a,this}setMultipleInstances(a){return this.multipleInstances=a,this}setServiceProps(a){return this.serviceProps=a,this}setInstanceCreatedCallback(a){return this.onInstanceCreated=a,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G0="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class spe{constructor(a,h){this.name=a,this.container=h,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(a){const h=this.normalizeInstanceIdentifier(a);if(!this.instancesDeferred.has(h)){const _=new TW;if(this.instancesDeferred.set(h,_),this.isInitialized(h)||this.shouldAutoInitialize())try{const S=this.getOrInitializeService({instanceIdentifier:h});S&&_.resolve(S)}catch{}}return this.instancesDeferred.get(h).promise}getImmediate(a){const h=this.normalizeInstanceIdentifier(a?.identifier),_=a?.optional??!1;if(this.isInitialized(h)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:h})}catch(S){if(_)return null;throw S}else{if(_)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(a){if(a.name!==this.name)throw Error(`Mismatching Component ${a.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=a,!!this.shouldAutoInitialize()){if(ape(a))try{this.getOrInitializeService({instanceIdentifier:G0})}catch{}for(const[h,_]of this.instancesDeferred.entries()){const S=this.normalizeInstanceIdentifier(h);try{const y=this.getOrInitializeService({instanceIdentifier:S});_.resolve(y)}catch{}}}}clearInstance(a=G0){this.instancesDeferred.delete(a),this.instancesOptions.delete(a),this.instances.delete(a)}async delete(){const a=Array.from(this.instances.values());await Promise.all([...a.filter(h=>"INTERNAL"in h).map(h=>h.INTERNAL.delete()),...a.filter(h=>"_delete"in h).map(h=>h._delete())])}isComponentSet(){return this.component!=null}isInitialized(a=G0){return this.instances.has(a)}getOptions(a=G0){return this.instancesOptions.get(a)||{}}initialize(a={}){const{options:h={}}=a,_=this.normalizeInstanceIdentifier(a.instanceIdentifier);if(this.isInitialized(_))throw Error(`${this.name}(${_}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const S=this.getOrInitializeService({instanceIdentifier:_,options:h});for(const[y,b]of this.instancesDeferred.entries()){const D=this.normalizeInstanceIdentifier(y);_===D&&b.resolve(S)}return S}onInit(a,h){const _=this.normalizeInstanceIdentifier(h),S=this.onInitCallbacks.get(_)??new Set;S.add(a),this.onInitCallbacks.set(_,S);const y=this.instances.get(_);return y&&a(y,_),()=>{S.delete(a)}}invokeOnInitCallbacks(a,h){const _=this.onInitCallbacks.get(h);if(_)for(const S of _)try{S(a,h)}catch{}}getOrInitializeService({instanceIdentifier:a,options:h={}}){let _=this.instances.get(a);if(!_&&this.component&&(_=this.component.instanceFactory(this.container,{instanceIdentifier:ope(a),options:h}),this.instances.set(a,_),this.instancesOptions.set(a,h),this.invokeOnInitCallbacks(_,a),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,a,_)}catch{}return _||null}normalizeInstanceIdentifier(a=G0){return this.component?this.component.multipleInstances?a:G0:a}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function ope(l){return l===G0?void 0:l}function ape(l){return l.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cpe{constructor(a){this.name=a,this.providers=new Map}addComponent(a){const h=this.getProvider(a.name);if(h.isComponentSet())throw new Error(`Component ${a.name} has already been registered with ${this.name}`);h.setComponent(a)}addOrOverwriteComponent(a){this.getProvider(a.name).isComponentSet()&&this.providers.delete(a.name),this.addComponent(a)}getProvider(a){if(this.providers.has(a))return this.providers.get(a);const h=new spe(a,this);return this.providers.set(a,h),h}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ls;(function(l){l[l.DEBUG=0]="DEBUG",l[l.VERBOSE=1]="VERBOSE",l[l.INFO=2]="INFO",l[l.WARN=3]="WARN",l[l.ERROR=4]="ERROR",l[l.SILENT=5]="SILENT"})(Ls||(Ls={}));const lpe={debug:Ls.DEBUG,verbose:Ls.VERBOSE,info:Ls.INFO,warn:Ls.WARN,error:Ls.ERROR,silent:Ls.SILENT},dpe=Ls.INFO,upe={[Ls.DEBUG]:"log",[Ls.VERBOSE]:"log",[Ls.INFO]:"info",[Ls.WARN]:"warn",[Ls.ERROR]:"error"},hpe=(l,a,...h)=>{if(a<l.logLevel)return;const _=new Date().toISOString(),S=upe[a];if(S)console[S](`[${_}]  ${l.name}:`,...h);else throw new Error(`Attempted to log a message with an invalid logType (value: ${a})`)};class yW{constructor(a){this.name=a,this._logLevel=dpe,this._logHandler=hpe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(a){if(!(a in Ls))throw new TypeError(`Invalid value "${a}" assigned to \`logLevel\``);this._logLevel=a}setLogLevel(a){this._logLevel=typeof a=="string"?lpe[a]:a}get logHandler(){return this._logHandler}set logHandler(a){if(typeof a!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=a}get userLogHandler(){return this._userLogHandler}set userLogHandler(a){this._userLogHandler=a}debug(...a){this._userLogHandler&&this._userLogHandler(this,Ls.DEBUG,...a),this._logHandler(this,Ls.DEBUG,...a)}log(...a){this._userLogHandler&&this._userLogHandler(this,Ls.VERBOSE,...a),this._logHandler(this,Ls.VERBOSE,...a)}info(...a){this._userLogHandler&&this._userLogHandler(this,Ls.INFO,...a),this._logHandler(this,Ls.INFO,...a)}warn(...a){this._userLogHandler&&this._userLogHandler(this,Ls.WARN,...a),this._logHandler(this,Ls.WARN,...a)}error(...a){this._userLogHandler&&this._userLogHandler(this,Ls.ERROR,...a),this._logHandler(this,Ls.ERROR,...a)}}const ppe=(l,a)=>a.some(h=>l instanceof h);let nZ,iZ;function fpe(){return nZ||(nZ=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function _pe(){return iZ||(iZ=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const cte=new WeakMap,h7=new WeakMap,lte=new WeakMap,wq=new WeakMap,bX=new WeakMap;function mpe(l){const a=new Promise((h,_)=>{const S=()=>{l.removeEventListener("success",y),l.removeEventListener("error",b)},y=()=>{h(Ob(l.result)),S()},b=()=>{_(l.error),S()};l.addEventListener("success",y),l.addEventListener("error",b)});return a.then(h=>{h instanceof IDBCursor&&cte.set(h,l)}).catch(()=>{}),bX.set(a,l),a}function Epe(l){if(h7.has(l))return;const a=new Promise((h,_)=>{const S=()=>{l.removeEventListener("complete",y),l.removeEventListener("error",b),l.removeEventListener("abort",b)},y=()=>{h(),S()},b=()=>{_(l.error||new DOMException("AbortError","AbortError")),S()};l.addEventListener("complete",y),l.addEventListener("error",b),l.addEventListener("abort",b)});h7.set(l,a)}let p7={get(l,a,h){if(l instanceof IDBTransaction){if(a==="done")return h7.get(l);if(a==="objectStoreNames")return l.objectStoreNames||lte.get(l);if(a==="store")return h.objectStoreNames[1]?void 0:h.objectStore(h.objectStoreNames[0])}return Ob(l[a])},set(l,a,h){return l[a]=h,!0},has(l,a){return l instanceof IDBTransaction&&(a==="done"||a==="store")?!0:a in l}};function gpe(l){p7=l(p7)}function Spe(l){return l===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(a,...h){const _=l.call(Oq(this),a,...h);return lte.set(_,a.sort?a.sort():[a]),Ob(_)}:_pe().includes(l)?function(...a){return l.apply(Oq(this),a),Ob(cte.get(this))}:function(...a){return Ob(l.apply(Oq(this),a))}}function Tpe(l){return typeof l=="function"?Spe(l):(l instanceof IDBTransaction&&Epe(l),ppe(l,fpe())?new Proxy(l,p7):l)}function Ob(l){if(l instanceof IDBRequest)return mpe(l);if(wq.has(l))return wq.get(l);const a=Tpe(l);return a!==l&&(wq.set(l,a),bX.set(a,l)),a}const Oq=l=>bX.get(l);function vpe(l,a,{blocked:h,upgrade:_,blocking:S,terminated:y}={}){const b=indexedDB.open(l,a),D=Ob(b);return _&&b.addEventListener("upgradeneeded",U=>{_(Ob(b.result),U.oldVersion,U.newVersion,Ob(b.transaction),U)}),h&&b.addEventListener("blocked",U=>h(U.oldVersion,U.newVersion,U)),D.then(U=>{y&&U.addEventListener("close",()=>y()),S&&U.addEventListener("versionchange",x=>S(x.oldVersion,x.newVersion,x))}).catch(()=>{}),D}const ype=["get","getKey","getAll","getAllKeys","count"],Rpe=["put","add","delete","clear"],Nq=new Map;function rZ(l,a){if(!(l instanceof IDBDatabase&&!(a in l)&&typeof a=="string"))return;if(Nq.get(a))return Nq.get(a);const h=a.replace(/FromIndex$/,""),_=a!==h,S=Rpe.includes(h);if(!(h in(_?IDBIndex:IDBObjectStore).prototype)||!(S||ype.includes(h)))return;const y=async function(b,...D){const U=this.transaction(b,S?"readwrite":"readonly");let x=U.store;return _&&(x=x.index(D.shift())),(await Promise.all([x[h](...D),S&&U.done]))[0]};return Nq.set(a,y),y}gpe(l=>({...l,get:(a,h,_)=>rZ(a,h)||l.get(a,h,_),has:(a,h)=>!!rZ(a,h)||l.has(a,h)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cpe{constructor(a){this.container=a}getPlatformInfoString(){return this.container.getProviders().map(h=>{if(bpe(h)){const _=h.getImmediate();return`${_.library}/${_.version}`}else return null}).filter(h=>h).join(" ")}}function bpe(l){return l.getComponent()?.type==="VERSION"}const f7="@firebase/app",sZ="0.14.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dy=new yW("@firebase/app"),Ipe="@firebase/app-compat",Ape="@firebase/analytics-compat",wpe="@firebase/analytics",Ope="@firebase/app-check-compat",Npe="@firebase/app-check",Dpe="@firebase/auth",Ppe="@firebase/auth-compat",kpe="@firebase/database",Lpe="@firebase/data-connect",Mpe="@firebase/database-compat",Upe="@firebase/functions",xpe="@firebase/functions-compat",Vpe="@firebase/installations",Fpe="@firebase/installations-compat",Bpe="@firebase/messaging",jpe="@firebase/messaging-compat",Gpe="@firebase/performance",Wpe="@firebase/performance-compat",Hpe="@firebase/remote-config",Kpe="@firebase/remote-config-compat",zpe="@firebase/storage",Ype="@firebase/storage-compat",qpe="@firebase/firestore",Xpe="@firebase/ai",Jpe="@firebase/firestore-compat",Qpe="firebase",Zpe="12.2.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _7="[DEFAULT]",$pe={[f7]:"fire-core",[Ipe]:"fire-core-compat",[wpe]:"fire-analytics",[Ape]:"fire-analytics-compat",[Npe]:"fire-app-check",[Ope]:"fire-app-check-compat",[Dpe]:"fire-auth",[Ppe]:"fire-auth-compat",[kpe]:"fire-rtdb",[Lpe]:"fire-data-connect",[Mpe]:"fire-rtdb-compat",[Upe]:"fire-fn",[xpe]:"fire-fn-compat",[Vpe]:"fire-iid",[Fpe]:"fire-iid-compat",[Bpe]:"fire-fcm",[jpe]:"fire-fcm-compat",[Gpe]:"fire-perf",[Wpe]:"fire-perf-compat",[Hpe]:"fire-rc",[Kpe]:"fire-rc-compat",[zpe]:"fire-gcs",[Ype]:"fire-gcs-compat",[qpe]:"fire-fst",[Jpe]:"fire-fst-compat",[Xpe]:"fire-vertex","fire-js":"fire-js",[Qpe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OG=new Map,efe=new Map,m7=new Map;function oZ(l,a){try{l.container.addComponent(a)}catch(h){dy.debug(`Component ${a.name} failed to register with FirebaseApp ${l.name}`,h)}}function tO(l){const a=l.name;if(m7.has(a))return dy.debug(`There were multiple attempts to register component ${a}.`),!1;m7.set(a,l);for(const h of OG.values())oZ(h,l);for(const h of efe.values())oZ(h,l);return!0}function RW(l,a){const h=l.container.getProvider("heartbeat").getImmediate({optional:!0});return h&&h.triggerHeartbeat(),l.container.getProvider(a)}function fE(l){return l==null?!1:l.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tfe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Nb=new w3("app","Firebase",tfe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nfe{constructor(a,h,_){this._isDeleted=!1,this._options={...a},this._config={...h},this._name=h.name,this._automaticDataCollectionEnabled=h.automaticDataCollectionEnabled,this._container=_,this.container.addComponent(new Mb("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(a){this.checkDestroyed(),this._automaticDataCollectionEnabled=a}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(a){this._isDeleted=a}checkDestroyed(){if(this.isDeleted)throw Nb.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dO=Zpe;function dte(l,a={}){let h=l;typeof a!="object"&&(a={name:a});const _={name:_7,automaticDataCollectionEnabled:!0,...a},S=_.name;if(typeof S!="string"||!S)throw Nb.create("bad-app-name",{appName:String(S)});if(h||(h=ite()),!h)throw Nb.create("no-options");const y=OG.get(S);if(y){if(Lb(h,y.options)&&Lb(_,y.config))return y;throw Nb.create("duplicate-app",{appName:S})}const b=new cpe(S);for(const U of m7.values())b.addComponent(U);const D=new nfe(h,_,b);return OG.set(S,D),D}function IX(l=_7){const a=OG.get(l);if(!a&&l===_7&&ite())return dte();if(!a)throw Nb.create("no-app",{appName:l});return a}function IS(l,a,h){let _=$pe[l]??l;h&&(_+=`-${h}`);const S=_.match(/\s|\//),y=a.match(/\s|\//);if(S||y){const b=[`Unable to register library "${_}" with version "${a}":`];S&&b.push(`library name "${_}" contains illegal characters (whitespace or "/")`),S&&y&&b.push("and"),y&&b.push(`version name "${a}" contains illegal characters (whitespace or "/")`),dy.warn(b.join(" "));return}tO(new Mb(`${_}-version`,()=>({library:_,version:a}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ife="firebase-heartbeat-database",rfe=1,a3="firebase-heartbeat-store";let Dq=null;function ute(){return Dq||(Dq=vpe(ife,rfe,{upgrade:(l,a)=>{switch(a){case 0:try{l.createObjectStore(a3)}catch(h){console.warn(h)}}}}).catch(l=>{throw Nb.create("idb-open",{originalErrorMessage:l.message})})),Dq}async function sfe(l){try{const h=(await ute()).transaction(a3),_=await h.objectStore(a3).get(hte(l));return await h.done,_}catch(a){if(a instanceof my)dy.warn(a.message);else{const h=Nb.create("idb-get",{originalErrorMessage:a?.message});dy.warn(h.message)}}}async function aZ(l,a){try{const _=(await ute()).transaction(a3,"readwrite");await _.objectStore(a3).put(a,hte(l)),await _.done}catch(h){if(h instanceof my)dy.warn(h.message);else{const _=Nb.create("idb-set",{originalErrorMessage:h?.message});dy.warn(_.message)}}}function hte(l){return`${l.name}!${l.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ofe=1024,afe=30;class cfe{constructor(a){this.container=a,this._heartbeatsCache=null;const h=this.container.getProvider("app").getImmediate();this._storage=new dfe(h),this._heartbeatsCachePromise=this._storage.read().then(_=>(this._heartbeatsCache=_,_))}async triggerHeartbeat(){try{const h=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),_=cZ();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===_||this._heartbeatsCache.heartbeats.some(S=>S.date===_))return;if(this._heartbeatsCache.heartbeats.push({date:_,agent:h}),this._heartbeatsCache.heartbeats.length>afe){const S=ufe(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(S,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(a){dy.warn(a)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const a=cZ(),{heartbeatsToSend:h,unsentEntries:_}=lfe(this._heartbeatsCache.heartbeats),S=IG(JSON.stringify({version:2,heartbeats:h}));return this._heartbeatsCache.lastSentHeartbeatDate=a,_.length>0?(this._heartbeatsCache.heartbeats=_,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),S}catch(a){return dy.warn(a),""}}}function cZ(){return new Date().toISOString().substring(0,10)}function lfe(l,a=ofe){const h=[];let _=l.slice();for(const S of l){const y=h.find(b=>b.agent===S.agent);if(y){if(y.dates.push(S.date),lZ(h)>a){y.dates.pop();break}}else if(h.push({agent:S.agent,dates:[S.date]}),lZ(h)>a){h.pop();break}_=_.slice(1)}return{heartbeatsToSend:h,unsentEntries:_}}class dfe{constructor(a){this.app=a,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Yhe()?qhe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const h=await sfe(this.app);return h?.heartbeats?h:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(a){if(await this._canUseIndexedDBPromise){const _=await this.read();return aZ(this.app,{lastSentHeartbeatDate:a.lastSentHeartbeatDate??_.lastSentHeartbeatDate,heartbeats:a.heartbeats})}else return}async add(a){if(await this._canUseIndexedDBPromise){const _=await this.read();return aZ(this.app,{lastSentHeartbeatDate:a.lastSentHeartbeatDate??_.lastSentHeartbeatDate,heartbeats:[..._.heartbeats,...a.heartbeats]})}else return}}function lZ(l){return IG(JSON.stringify({version:2,heartbeats:l})).length}function ufe(l){if(l.length===0)return-1;let a=0,h=l[0].date;for(let _=1;_<l.length;_++)l[_].date<h&&(h=l[_].date,a=_);return a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hfe(l){tO(new Mb("platform-logger",a=>new Cpe(a),"PRIVATE")),tO(new Mb("heartbeat",a=>new cfe(a),"PRIVATE")),IS(f7,sZ,l),IS(f7,sZ,"esm2020"),IS("fire-js","")}hfe("");var pfe="firebase",ffe="12.2.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */IS(pfe,ffe,"app");var dZ=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var AX;(function(){var l;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function a(Te,he){function _e(){}_e.prototype=he.prototype,Te.D=he.prototype,Te.prototype=new _e,Te.prototype.constructor=Te,Te.C=function(ye,Ie,$){for(var me=Array(arguments.length-2),Xe=2;Xe<arguments.length;Xe++)me[Xe-2]=arguments[Xe];return he.prototype[Ie].apply(ye,me)}}function h(){this.blockSize=-1}function _(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}a(_,h),_.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function S(Te,he,_e){_e||(_e=0);var ye=Array(16);if(typeof he=="string")for(var Ie=0;16>Ie;++Ie)ye[Ie]=he.charCodeAt(_e++)|he.charCodeAt(_e++)<<8|he.charCodeAt(_e++)<<16|he.charCodeAt(_e++)<<24;else for(Ie=0;16>Ie;++Ie)ye[Ie]=he[_e++]|he[_e++]<<8|he[_e++]<<16|he[_e++]<<24;he=Te.g[0],_e=Te.g[1],Ie=Te.g[2];var $=Te.g[3],me=he+($^_e&(Ie^$))+ye[0]+3614090360&4294967295;he=_e+(me<<7&4294967295|me>>>25),me=$+(Ie^he&(_e^Ie))+ye[1]+3905402710&4294967295,$=he+(me<<12&4294967295|me>>>20),me=Ie+(_e^$&(he^_e))+ye[2]+606105819&4294967295,Ie=$+(me<<17&4294967295|me>>>15),me=_e+(he^Ie&($^he))+ye[3]+3250441966&4294967295,_e=Ie+(me<<22&4294967295|me>>>10),me=he+($^_e&(Ie^$))+ye[4]+4118548399&4294967295,he=_e+(me<<7&4294967295|me>>>25),me=$+(Ie^he&(_e^Ie))+ye[5]+1200080426&4294967295,$=he+(me<<12&4294967295|me>>>20),me=Ie+(_e^$&(he^_e))+ye[6]+2821735955&4294967295,Ie=$+(me<<17&4294967295|me>>>15),me=_e+(he^Ie&($^he))+ye[7]+4249261313&4294967295,_e=Ie+(me<<22&4294967295|me>>>10),me=he+($^_e&(Ie^$))+ye[8]+1770035416&4294967295,he=_e+(me<<7&4294967295|me>>>25),me=$+(Ie^he&(_e^Ie))+ye[9]+2336552879&4294967295,$=he+(me<<12&4294967295|me>>>20),me=Ie+(_e^$&(he^_e))+ye[10]+4294925233&4294967295,Ie=$+(me<<17&4294967295|me>>>15),me=_e+(he^Ie&($^he))+ye[11]+2304563134&4294967295,_e=Ie+(me<<22&4294967295|me>>>10),me=he+($^_e&(Ie^$))+ye[12]+1804603682&4294967295,he=_e+(me<<7&4294967295|me>>>25),me=$+(Ie^he&(_e^Ie))+ye[13]+4254626195&4294967295,$=he+(me<<12&4294967295|me>>>20),me=Ie+(_e^$&(he^_e))+ye[14]+2792965006&4294967295,Ie=$+(me<<17&4294967295|me>>>15),me=_e+(he^Ie&($^he))+ye[15]+1236535329&4294967295,_e=Ie+(me<<22&4294967295|me>>>10),me=he+(Ie^$&(_e^Ie))+ye[1]+4129170786&4294967295,he=_e+(me<<5&4294967295|me>>>27),me=$+(_e^Ie&(he^_e))+ye[6]+3225465664&4294967295,$=he+(me<<9&4294967295|me>>>23),me=Ie+(he^_e&($^he))+ye[11]+643717713&4294967295,Ie=$+(me<<14&4294967295|me>>>18),me=_e+($^he&(Ie^$))+ye[0]+3921069994&4294967295,_e=Ie+(me<<20&4294967295|me>>>12),me=he+(Ie^$&(_e^Ie))+ye[5]+3593408605&4294967295,he=_e+(me<<5&4294967295|me>>>27),me=$+(_e^Ie&(he^_e))+ye[10]+38016083&4294967295,$=he+(me<<9&4294967295|me>>>23),me=Ie+(he^_e&($^he))+ye[15]+3634488961&4294967295,Ie=$+(me<<14&4294967295|me>>>18),me=_e+($^he&(Ie^$))+ye[4]+3889429448&4294967295,_e=Ie+(me<<20&4294967295|me>>>12),me=he+(Ie^$&(_e^Ie))+ye[9]+568446438&4294967295,he=_e+(me<<5&4294967295|me>>>27),me=$+(_e^Ie&(he^_e))+ye[14]+3275163606&4294967295,$=he+(me<<9&4294967295|me>>>23),me=Ie+(he^_e&($^he))+ye[3]+4107603335&4294967295,Ie=$+(me<<14&4294967295|me>>>18),me=_e+($^he&(Ie^$))+ye[8]+1163531501&4294967295,_e=Ie+(me<<20&4294967295|me>>>12),me=he+(Ie^$&(_e^Ie))+ye[13]+2850285829&4294967295,he=_e+(me<<5&4294967295|me>>>27),me=$+(_e^Ie&(he^_e))+ye[2]+4243563512&4294967295,$=he+(me<<9&4294967295|me>>>23),me=Ie+(he^_e&($^he))+ye[7]+1735328473&4294967295,Ie=$+(me<<14&4294967295|me>>>18),me=_e+($^he&(Ie^$))+ye[12]+2368359562&4294967295,_e=Ie+(me<<20&4294967295|me>>>12),me=he+(_e^Ie^$)+ye[5]+4294588738&4294967295,he=_e+(me<<4&4294967295|me>>>28),me=$+(he^_e^Ie)+ye[8]+2272392833&4294967295,$=he+(me<<11&4294967295|me>>>21),me=Ie+($^he^_e)+ye[11]+1839030562&4294967295,Ie=$+(me<<16&4294967295|me>>>16),me=_e+(Ie^$^he)+ye[14]+4259657740&4294967295,_e=Ie+(me<<23&4294967295|me>>>9),me=he+(_e^Ie^$)+ye[1]+2763975236&4294967295,he=_e+(me<<4&4294967295|me>>>28),me=$+(he^_e^Ie)+ye[4]+1272893353&4294967295,$=he+(me<<11&4294967295|me>>>21),me=Ie+($^he^_e)+ye[7]+4139469664&4294967295,Ie=$+(me<<16&4294967295|me>>>16),me=_e+(Ie^$^he)+ye[10]+3200236656&4294967295,_e=Ie+(me<<23&4294967295|me>>>9),me=he+(_e^Ie^$)+ye[13]+681279174&4294967295,he=_e+(me<<4&4294967295|me>>>28),me=$+(he^_e^Ie)+ye[0]+3936430074&4294967295,$=he+(me<<11&4294967295|me>>>21),me=Ie+($^he^_e)+ye[3]+3572445317&4294967295,Ie=$+(me<<16&4294967295|me>>>16),me=_e+(Ie^$^he)+ye[6]+76029189&4294967295,_e=Ie+(me<<23&4294967295|me>>>9),me=he+(_e^Ie^$)+ye[9]+3654602809&4294967295,he=_e+(me<<4&4294967295|me>>>28),me=$+(he^_e^Ie)+ye[12]+3873151461&4294967295,$=he+(me<<11&4294967295|me>>>21),me=Ie+($^he^_e)+ye[15]+530742520&4294967295,Ie=$+(me<<16&4294967295|me>>>16),me=_e+(Ie^$^he)+ye[2]+3299628645&4294967295,_e=Ie+(me<<23&4294967295|me>>>9),me=he+(Ie^(_e|~$))+ye[0]+4096336452&4294967295,he=_e+(me<<6&4294967295|me>>>26),me=$+(_e^(he|~Ie))+ye[7]+1126891415&4294967295,$=he+(me<<10&4294967295|me>>>22),me=Ie+(he^($|~_e))+ye[14]+2878612391&4294967295,Ie=$+(me<<15&4294967295|me>>>17),me=_e+($^(Ie|~he))+ye[5]+4237533241&4294967295,_e=Ie+(me<<21&4294967295|me>>>11),me=he+(Ie^(_e|~$))+ye[12]+1700485571&4294967295,he=_e+(me<<6&4294967295|me>>>26),me=$+(_e^(he|~Ie))+ye[3]+2399980690&4294967295,$=he+(me<<10&4294967295|me>>>22),me=Ie+(he^($|~_e))+ye[10]+4293915773&4294967295,Ie=$+(me<<15&4294967295|me>>>17),me=_e+($^(Ie|~he))+ye[1]+2240044497&4294967295,_e=Ie+(me<<21&4294967295|me>>>11),me=he+(Ie^(_e|~$))+ye[8]+1873313359&4294967295,he=_e+(me<<6&4294967295|me>>>26),me=$+(_e^(he|~Ie))+ye[15]+4264355552&4294967295,$=he+(me<<10&4294967295|me>>>22),me=Ie+(he^($|~_e))+ye[6]+2734768916&4294967295,Ie=$+(me<<15&4294967295|me>>>17),me=_e+($^(Ie|~he))+ye[13]+1309151649&4294967295,_e=Ie+(me<<21&4294967295|me>>>11),me=he+(Ie^(_e|~$))+ye[4]+4149444226&4294967295,he=_e+(me<<6&4294967295|me>>>26),me=$+(_e^(he|~Ie))+ye[11]+3174756917&4294967295,$=he+(me<<10&4294967295|me>>>22),me=Ie+(he^($|~_e))+ye[2]+718787259&4294967295,Ie=$+(me<<15&4294967295|me>>>17),me=_e+($^(Ie|~he))+ye[9]+3951481745&4294967295,Te.g[0]=Te.g[0]+he&4294967295,Te.g[1]=Te.g[1]+(Ie+(me<<21&4294967295|me>>>11))&4294967295,Te.g[2]=Te.g[2]+Ie&4294967295,Te.g[3]=Te.g[3]+$&4294967295}_.prototype.u=function(Te,he){he===void 0&&(he=Te.length);for(var _e=he-this.blockSize,ye=this.B,Ie=this.h,$=0;$<he;){if(Ie==0)for(;$<=_e;)S(this,Te,$),$+=this.blockSize;if(typeof Te=="string"){for(;$<he;)if(ye[Ie++]=Te.charCodeAt($++),Ie==this.blockSize){S(this,ye),Ie=0;break}}else for(;$<he;)if(ye[Ie++]=Te[$++],Ie==this.blockSize){S(this,ye),Ie=0;break}}this.h=Ie,this.o+=he},_.prototype.v=function(){var Te=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);Te[0]=128;for(var he=1;he<Te.length-8;++he)Te[he]=0;var _e=8*this.o;for(he=Te.length-8;he<Te.length;++he)Te[he]=_e&255,_e/=256;for(this.u(Te),Te=Array(16),he=_e=0;4>he;++he)for(var ye=0;32>ye;ye+=8)Te[_e++]=this.g[he]>>>ye&255;return Te};function y(Te,he){var _e=D;return Object.prototype.hasOwnProperty.call(_e,Te)?_e[Te]:_e[Te]=he(Te)}function b(Te,he){this.h=he;for(var _e=[],ye=!0,Ie=Te.length-1;0<=Ie;Ie--){var $=Te[Ie]|0;ye&&$==he||(_e[Ie]=$,ye=!1)}this.g=_e}var D={};function U(Te){return-128<=Te&&128>Te?y(Te,function(he){return new b([he|0],0>he?-1:0)}):new b([Te|0],0>Te?-1:0)}function x(Te){if(isNaN(Te)||!isFinite(Te))return J;if(0>Te)return pe(x(-Te));for(var he=[],_e=1,ye=0;Te>=_e;ye++)he[ye]=Te/_e|0,_e*=4294967296;return new b(he,0)}function q(Te,he){if(Te.length==0)throw Error("number format error: empty string");if(he=he||10,2>he||36<he)throw Error("radix out of range: "+he);if(Te.charAt(0)=="-")return pe(q(Te.substring(1),he));if(0<=Te.indexOf("-"))throw Error('number format error: interior "-" character');for(var _e=x(Math.pow(he,8)),ye=J,Ie=0;Ie<Te.length;Ie+=8){var $=Math.min(8,Te.length-Ie),me=parseInt(Te.substring(Ie,Ie+$),he);8>$?($=x(Math.pow(he,$)),ye=ye.j($).add(x(me))):(ye=ye.j(_e),ye=ye.add(x(me)))}return ye}var J=U(0),ee=U(1),ue=U(16777216);l=b.prototype,l.m=function(){if(le(this))return-pe(this).m();for(var Te=0,he=1,_e=0;_e<this.g.length;_e++){var ye=this.i(_e);Te+=(0<=ye?ye:4294967296+ye)*he,he*=4294967296}return Te},l.toString=function(Te){if(Te=Te||10,2>Te||36<Te)throw Error("radix out of range: "+Te);if(oe(this))return"0";if(le(this))return"-"+pe(this).toString(Te);for(var he=x(Math.pow(Te,6)),_e=this,ye="";;){var Ie=Ue(_e,he).g;_e=Ne(_e,Ie.j(he));var $=((0<_e.g.length?_e.g[0]:_e.h)>>>0).toString(Te);if(_e=Ie,oe(_e))return $+ye;for(;6>$.length;)$="0"+$;ye=$+ye}},l.i=function(Te){return 0>Te?0:Te<this.g.length?this.g[Te]:this.h};function oe(Te){if(Te.h!=0)return!1;for(var he=0;he<Te.g.length;he++)if(Te.g[he]!=0)return!1;return!0}function le(Te){return Te.h==-1}l.l=function(Te){return Te=Ne(this,Te),le(Te)?-1:oe(Te)?0:1};function pe(Te){for(var he=Te.g.length,_e=[],ye=0;ye<he;ye++)_e[ye]=~Te.g[ye];return new b(_e,~Te.h).add(ee)}l.abs=function(){return le(this)?pe(this):this},l.add=function(Te){for(var he=Math.max(this.g.length,Te.g.length),_e=[],ye=0,Ie=0;Ie<=he;Ie++){var $=ye+(this.i(Ie)&65535)+(Te.i(Ie)&65535),me=($>>>16)+(this.i(Ie)>>>16)+(Te.i(Ie)>>>16);ye=me>>>16,$&=65535,me&=65535,_e[Ie]=me<<16|$}return new b(_e,_e[_e.length-1]&-2147483648?-1:0)};function Ne(Te,he){return Te.add(pe(he))}l.j=function(Te){if(oe(this)||oe(Te))return J;if(le(this))return le(Te)?pe(this).j(pe(Te)):pe(pe(this).j(Te));if(le(Te))return pe(this.j(pe(Te)));if(0>this.l(ue)&&0>Te.l(ue))return x(this.m()*Te.m());for(var he=this.g.length+Te.g.length,_e=[],ye=0;ye<2*he;ye++)_e[ye]=0;for(ye=0;ye<this.g.length;ye++)for(var Ie=0;Ie<Te.g.length;Ie++){var $=this.i(ye)>>>16,me=this.i(ye)&65535,Xe=Te.i(Ie)>>>16,ct=Te.i(Ie)&65535;_e[2*ye+2*Ie]+=me*ct,Ve(_e,2*ye+2*Ie),_e[2*ye+2*Ie+1]+=$*ct,Ve(_e,2*ye+2*Ie+1),_e[2*ye+2*Ie+1]+=me*Xe,Ve(_e,2*ye+2*Ie+1),_e[2*ye+2*Ie+2]+=$*Xe,Ve(_e,2*ye+2*Ie+2)}for(ye=0;ye<he;ye++)_e[ye]=_e[2*ye+1]<<16|_e[2*ye];for(ye=he;ye<2*he;ye++)_e[ye]=0;return new b(_e,0)};function Ve(Te,he){for(;(Te[he]&65535)!=Te[he];)Te[he+1]+=Te[he]>>>16,Te[he]&=65535,he++}function Ae(Te,he){this.g=Te,this.h=he}function Ue(Te,he){if(oe(he))throw Error("division by zero");if(oe(Te))return new Ae(J,J);if(le(Te))return he=Ue(pe(Te),he),new Ae(pe(he.g),pe(he.h));if(le(he))return he=Ue(Te,pe(he)),new Ae(pe(he.g),he.h);if(30<Te.g.length){if(le(Te)||le(he))throw Error("slowDivide_ only works with positive integers.");for(var _e=ee,ye=he;0>=ye.l(Te);)_e=ke(_e),ye=ke(ye);var Ie=qe(_e,1),$=qe(ye,1);for(ye=qe(ye,2),_e=qe(_e,2);!oe(ye);){var me=$.add(ye);0>=me.l(Te)&&(Ie=Ie.add(_e),$=me),ye=qe(ye,1),_e=qe(_e,1)}return he=Ne(Te,Ie.j(he)),new Ae(Ie,he)}for(Ie=J;0<=Te.l(he);){for(_e=Math.max(1,Math.floor(Te.m()/he.m())),ye=Math.ceil(Math.log(_e)/Math.LN2),ye=48>=ye?1:Math.pow(2,ye-48),$=x(_e),me=$.j(he);le(me)||0<me.l(Te);)_e-=ye,$=x(_e),me=$.j(he);oe($)&&($=ee),Ie=Ie.add($),Te=Ne(Te,me)}return new Ae(Ie,Te)}l.A=function(Te){return Ue(this,Te).h},l.and=function(Te){for(var he=Math.max(this.g.length,Te.g.length),_e=[],ye=0;ye<he;ye++)_e[ye]=this.i(ye)&Te.i(ye);return new b(_e,this.h&Te.h)},l.or=function(Te){for(var he=Math.max(this.g.length,Te.g.length),_e=[],ye=0;ye<he;ye++)_e[ye]=this.i(ye)|Te.i(ye);return new b(_e,this.h|Te.h)},l.xor=function(Te){for(var he=Math.max(this.g.length,Te.g.length),_e=[],ye=0;ye<he;ye++)_e[ye]=this.i(ye)^Te.i(ye);return new b(_e,this.h^Te.h)};function ke(Te){for(var he=Te.g.length+1,_e=[],ye=0;ye<he;ye++)_e[ye]=Te.i(ye)<<1|Te.i(ye-1)>>>31;return new b(_e,Te.h)}function qe(Te,he){var _e=he>>5;he%=32;for(var ye=Te.g.length-_e,Ie=[],$=0;$<ye;$++)Ie[$]=0<he?Te.i($+_e)>>>he|Te.i($+_e+1)<<32-he:Te.i($+_e);return new b(Ie,Te.h)}_.prototype.digest=_.prototype.v,_.prototype.reset=_.prototype.s,_.prototype.update=_.prototype.u,b.prototype.add=b.prototype.add,b.prototype.multiply=b.prototype.j,b.prototype.modulo=b.prototype.A,b.prototype.compare=b.prototype.l,b.prototype.toNumber=b.prototype.m,b.prototype.toString=b.prototype.toString,b.prototype.getBits=b.prototype.i,b.fromNumber=x,b.fromString=q,AX=b}).apply(typeof dZ<"u"?dZ:typeof self<"u"?self:typeof window<"u"?window:{});var J6=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};(function(){var l,a=typeof Object.defineProperties=="function"?Object.defineProperty:function(N,X,ie){return N==Array.prototype||N==Object.prototype||(N[X]=ie.value),N};function h(N){N=[typeof globalThis=="object"&&globalThis,N,typeof window=="object"&&window,typeof self=="object"&&self,typeof J6=="object"&&J6];for(var X=0;X<N.length;++X){var ie=N[X];if(ie&&ie.Math==Math)return ie}throw Error("Cannot find global object")}var _=h(this);function S(N,X){if(X)e:{var ie=_;N=N.split(".");for(var ve=0;ve<N.length-1;ve++){var tt=N[ve];if(!(tt in ie))break e;ie=ie[tt]}N=N[N.length-1],ve=ie[N],X=X(ve),X!=ve&&X!=null&&a(ie,N,{configurable:!0,writable:!0,value:X})}}function y(N,X){N instanceof String&&(N+="");var ie=0,ve=!1,tt={next:function(){if(!ve&&ie<N.length){var lt=ie++;return{value:X(lt,N[lt]),done:!1}}return ve=!0,{done:!0,value:void 0}}};return tt[Symbol.iterator]=function(){return tt},tt}S("Array.prototype.values",function(N){return N||function(){return y(this,function(X,ie){return ie})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var b=b||{},D=this||self;function U(N){var X=typeof N;return X=X!="object"?X:N?Array.isArray(N)?"array":X:"null",X=="array"||X=="object"&&typeof N.length=="number"}function x(N){var X=typeof N;return X=="object"&&N!=null||X=="function"}function q(N,X,ie){return N.call.apply(N.bind,arguments)}function J(N,X,ie){if(!N)throw Error();if(2<arguments.length){var ve=Array.prototype.slice.call(arguments,2);return function(){var tt=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(tt,ve),N.apply(X,tt)}}return function(){return N.apply(X,arguments)}}function ee(N,X,ie){return ee=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?q:J,ee.apply(null,arguments)}function ue(N,X){var ie=Array.prototype.slice.call(arguments,1);return function(){var ve=ie.slice();return ve.push.apply(ve,arguments),N.apply(this,ve)}}function oe(N,X){function ie(){}ie.prototype=X.prototype,N.aa=X.prototype,N.prototype=new ie,N.prototype.constructor=N,N.Qb=function(ve,tt,lt){for(var Ht=Array(arguments.length-2),Jr=2;Jr<arguments.length;Jr++)Ht[Jr-2]=arguments[Jr];return X.prototype[tt].apply(ve,Ht)}}function le(N){const X=N.length;if(0<X){const ie=Array(X);for(let ve=0;ve<X;ve++)ie[ve]=N[ve];return ie}return[]}function pe(N,X){for(let ie=1;ie<arguments.length;ie++){const ve=arguments[ie];if(U(ve)){const tt=N.length||0,lt=ve.length||0;N.length=tt+lt;for(let Ht=0;Ht<lt;Ht++)N[tt+Ht]=ve[Ht]}else N.push(ve)}}class Ne{constructor(X,ie){this.i=X,this.j=ie,this.h=0,this.g=null}get(){let X;return 0<this.h?(this.h--,X=this.g,this.g=X.next,X.next=null):X=this.i(),X}}function Ve(N){return/^[\s\xa0]*$/.test(N)}function Ae(){var N=D.navigator;return N&&(N=N.userAgent)?N:""}function Ue(N){return Ue[" "](N),N}Ue[" "]=function(){};var ke=Ae().indexOf("Gecko")!=-1&&!(Ae().toLowerCase().indexOf("webkit")!=-1&&Ae().indexOf("Edge")==-1)&&!(Ae().indexOf("Trident")!=-1||Ae().indexOf("MSIE")!=-1)&&Ae().indexOf("Edge")==-1;function qe(N,X,ie){for(const ve in N)X.call(ie,N[ve],ve,N)}function Te(N,X){for(const ie in N)X.call(void 0,N[ie],ie,N)}function he(N){const X={};for(const ie in N)X[ie]=N[ie];return X}const _e="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ye(N,X){let ie,ve;for(let tt=1;tt<arguments.length;tt++){ve=arguments[tt];for(ie in ve)N[ie]=ve[ie];for(let lt=0;lt<_e.length;lt++)ie=_e[lt],Object.prototype.hasOwnProperty.call(ve,ie)&&(N[ie]=ve[ie])}}function Ie(N){var X=1;N=N.split(":");const ie=[];for(;0<X&&N.length;)ie.push(N.shift()),X--;return N.length&&ie.push(N.join(":")),ie}function $(N){D.setTimeout(()=>{throw N},0)}function me(){var N=yt;let X=null;return N.g&&(X=N.g,N.g=N.g.next,N.g||(N.h=null),X.next=null),X}class Xe{constructor(){this.h=this.g=null}add(X,ie){const ve=ct.get();ve.set(X,ie),this.h?this.h.next=ve:this.g=ve,this.h=ve}}var ct=new Ne(()=>new Me,N=>N.reset());class Me{constructor(){this.next=this.g=this.h=null}set(X,ie){this.h=X,this.g=ie,this.next=null}reset(){this.next=this.g=this.h=null}}let Je,mt=!1,yt=new Xe,xe=()=>{const N=D.Promise.resolve(void 0);Je=()=>{N.then(it)}};var it=()=>{for(var N;N=me();){try{N.h.call(N.g)}catch(ie){$(ie)}var X=ct;X.j(N),100>X.h&&(X.h++,N.next=X.g,X.g=N)}mt=!1};function ft(){this.s=this.s,this.C=this.C}ft.prototype.s=!1,ft.prototype.ma=function(){this.s||(this.s=!0,this.N())},ft.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function pt(N,X){this.type=N,this.g=this.target=X,this.defaultPrevented=!1}pt.prototype.h=function(){this.defaultPrevented=!0};var xt=(function(){if(!D.addEventListener||!Object.defineProperty)return!1;var N=!1,X=Object.defineProperty({},"passive",{get:function(){N=!0}});try{const ie=()=>{};D.addEventListener("test",ie,X),D.removeEventListener("test",ie,X)}catch{}return N})();function ln(N,X){if(pt.call(this,N?N.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,N){var ie=this.type=N.type,ve=N.changedTouches&&N.changedTouches.length?N.changedTouches[0]:null;if(this.target=N.target||N.srcElement,this.g=X,X=N.relatedTarget){if(ke){e:{try{Ue(X.nodeName);var tt=!0;break e}catch{}tt=!1}tt||(X=null)}}else ie=="mouseover"?X=N.fromElement:ie=="mouseout"&&(X=N.toElement);this.relatedTarget=X,ve?(this.clientX=ve.clientX!==void 0?ve.clientX:ve.pageX,this.clientY=ve.clientY!==void 0?ve.clientY:ve.pageY,this.screenX=ve.screenX||0,this.screenY=ve.screenY||0):(this.clientX=N.clientX!==void 0?N.clientX:N.pageX,this.clientY=N.clientY!==void 0?N.clientY:N.pageY,this.screenX=N.screenX||0,this.screenY=N.screenY||0),this.button=N.button,this.key=N.key||"",this.ctrlKey=N.ctrlKey,this.altKey=N.altKey,this.shiftKey=N.shiftKey,this.metaKey=N.metaKey,this.pointerId=N.pointerId||0,this.pointerType=typeof N.pointerType=="string"?N.pointerType:pn[N.pointerType]||"",this.state=N.state,this.i=N,N.defaultPrevented&&ln.aa.h.call(this)}}oe(ln,pt);var pn={2:"touch",3:"pen",4:"mouse"};ln.prototype.h=function(){ln.aa.h.call(this);var N=this.i;N.preventDefault?N.preventDefault():N.returnValue=!1};var Zn="closure_listenable_"+(1e6*Math.random()|0),ri=0;function si(N,X,ie,ve,tt){this.listener=N,this.proxy=null,this.src=X,this.type=ie,this.capture=!!ve,this.ha=tt,this.key=++ri,this.da=this.fa=!1}function En(N){N.da=!0,N.listener=null,N.proxy=null,N.src=null,N.ha=null}function oi(N){this.src=N,this.g={},this.h=0}oi.prototype.add=function(N,X,ie,ve,tt){var lt=N.toString();N=this.g[lt],N||(N=this.g[lt]=[],this.h++);var Ht=Kn(N,X,ve,tt);return-1<Ht?(X=N[Ht],ie||(X.fa=!1)):(X=new si(X,this.src,lt,!!ve,tt),X.fa=ie,N.push(X)),X};function ui(N,X){var ie=X.type;if(ie in N.g){var ve=N.g[ie],tt=Array.prototype.indexOf.call(ve,X,void 0),lt;(lt=0<=tt)&&Array.prototype.splice.call(ve,tt,1),lt&&(En(X),N.g[ie].length==0&&(delete N.g[ie],N.h--))}}function Kn(N,X,ie,ve){for(var tt=0;tt<N.length;++tt){var lt=N[tt];if(!lt.da&&lt.listener==X&&lt.capture==!!ie&&lt.ha==ve)return tt}return-1}var qn="closure_lm_"+(1e6*Math.random()|0),Zi={};function Gi(N,X,ie,ve,tt){if(Array.isArray(X)){for(var lt=0;lt<X.length;lt++)Gi(N,X[lt],ie,ve,tt);return null}return ie=Kt(ie),N&&N[Zn]?N.K(X,ie,x(ve)?!!ve.capture:!1,tt):yi(N,X,ie,!1,ve,tt)}function yi(N,X,ie,ve,tt,lt){if(!X)throw Error("Invalid event type");var Ht=x(tt)?!!tt.capture:!!tt,Jr=Us(N);if(Jr||(N[qn]=Jr=new oi(N)),ie=Jr.add(X,ie,ve,Ht,lt),ie.proxy)return ie;if(ve=vn(),ie.proxy=ve,ve.src=N,ve.listener=ie,N.addEventListener)xt||(tt=Ht),tt===void 0&&(tt=!1),N.addEventListener(X.toString(),ve,tt);else if(N.attachEvent)N.attachEvent(Bi(X.toString()),ve);else if(N.addListener&&N.removeListener)N.addListener(ve);else throw Error("addEventListener and attachEvent are unavailable.");return ie}function vn(){function N(ie){return X.call(N.src,N.listener,ie)}const X=Sn;return N}function xn(N,X,ie,ve,tt){if(Array.isArray(X))for(var lt=0;lt<X.length;lt++)xn(N,X[lt],ie,ve,tt);else ve=x(ve)?!!ve.capture:!!ve,ie=Kt(ie),N&&N[Zn]?(N=N.i,X=String(X).toString(),X in N.g&&(lt=N.g[X],ie=Kn(lt,ie,ve,tt),-1<ie&&(En(lt[ie]),Array.prototype.splice.call(lt,ie,1),lt.length==0&&(delete N.g[X],N.h--)))):N&&(N=Us(N))&&(X=N.g[X.toString()],N=-1,X&&(N=Kn(X,ie,ve,tt)),(ie=-1<N?X[N]:null)&&ir(ie))}function ir(N){if(typeof N!="number"&&N&&!N.da){var X=N.src;if(X&&X[Zn])ui(X.i,N);else{var ie=N.type,ve=N.proxy;X.removeEventListener?X.removeEventListener(ie,ve,N.capture):X.detachEvent?X.detachEvent(Bi(ie),ve):X.addListener&&X.removeListener&&X.removeListener(ve),(ie=Us(X))?(ui(ie,N),ie.h==0&&(ie.src=null,X[qn]=null)):En(N)}}}function Bi(N){return N in Zi?Zi[N]:Zi[N]="on"+N}function Sn(N,X){if(N.da)N=!0;else{X=new ln(X,this);var ie=N.listener,ve=N.ha||N.src;N.fa&&ir(N),N=ie.call(ve,X)}return N}function Us(N){return N=N[qn],N instanceof oi?N:null}var Rn="__closure_events_fn_"+(1e9*Math.random()>>>0);function Kt(N){return typeof N=="function"?N:(N[Rn]||(N[Rn]=function(X){return N.handleEvent(X)}),N[Rn])}function wt(){ft.call(this),this.i=new oi(this),this.M=this,this.F=null}oe(wt,ft),wt.prototype[Zn]=!0,wt.prototype.removeEventListener=function(N,X,ie,ve){xn(this,N,X,ie,ve)};function Ot(N,X){var ie,ve=N.F;if(ve)for(ie=[];ve;ve=ve.F)ie.push(ve);if(N=N.M,ve=X.type||X,typeof X=="string")X=new pt(X,N);else if(X instanceof pt)X.target=X.target||N;else{var tt=X;X=new pt(ve,N),ye(X,tt)}if(tt=!0,ie)for(var lt=ie.length-1;0<=lt;lt--){var Ht=X.g=ie[lt];tt=un(Ht,ve,!0,X)&&tt}if(Ht=X.g=N,tt=un(Ht,ve,!0,X)&&tt,tt=un(Ht,ve,!1,X)&&tt,ie)for(lt=0;lt<ie.length;lt++)Ht=X.g=ie[lt],tt=un(Ht,ve,!1,X)&&tt}wt.prototype.N=function(){if(wt.aa.N.call(this),this.i){var N=this.i,X;for(X in N.g){for(var ie=N.g[X],ve=0;ve<ie.length;ve++)En(ie[ve]);delete N.g[X],N.h--}}this.F=null},wt.prototype.K=function(N,X,ie,ve){return this.i.add(String(N),X,!1,ie,ve)},wt.prototype.L=function(N,X,ie,ve){return this.i.add(String(N),X,!0,ie,ve)};function un(N,X,ie,ve){if(X=N.i.g[String(X)],!X)return!0;X=X.concat();for(var tt=!0,lt=0;lt<X.length;++lt){var Ht=X[lt];if(Ht&&!Ht.da&&Ht.capture==ie){var Jr=Ht.listener,xs=Ht.ha||Ht.src;Ht.fa&&ui(N.i,Ht),tt=Jr.call(xs,ve)!==!1&&tt}}return tt&&!ve.defaultPrevented}function rn(N,X,ie){if(typeof N=="function")ie&&(N=ee(N,ie));else if(N&&typeof N.handleEvent=="function")N=ee(N.handleEvent,N);else throw Error("Invalid listener argument");return 2147483647<Number(X)?-1:D.setTimeout(N,X||0)}function Vn(N){N.g=rn(()=>{N.g=null,N.i&&(N.i=!1,Vn(N))},N.l);const X=N.h;N.h=null,N.m.apply(null,X)}class Ci extends ft{constructor(X,ie){super(),this.m=X,this.l=ie,this.h=null,this.i=!1,this.g=null}j(X){this.h=arguments,this.g?this.i=!0:Vn(this)}N(){super.N(),this.g&&(D.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function is(N){ft.call(this),this.h=N,this.g={}}oe(is,ft);var ur=[];function wr(N){qe(N.g,function(X,ie){this.g.hasOwnProperty(ie)&&ir(X)},N),N.g={}}is.prototype.N=function(){is.aa.N.call(this),wr(this)},is.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var hn=D.JSON.stringify,hr=D.JSON.parse,rs=class{stringify(N){return D.JSON.stringify(N,void 0)}parse(N){return D.JSON.parse(N,void 0)}};function eo(){}eo.prototype.h=null;function Qc(N){return N.h||(N.h=N.i())}function Rf(){}var Yd={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Xr(){pt.call(this,"d")}oe(Xr,pt);function ho(){pt.call(this,"c")}oe(ho,pt);var Fo={},ju=null;function Ts(){return ju=ju||new wt}Fo.La="serverreachability";function bE(N){pt.call(this,Fo.La,N)}oe(bE,pt);function Cf(N){const X=Ts();Ot(X,new bE(X))}Fo.STAT_EVENT="statevent";function gy(N,X){pt.call(this,Fo.STAT_EVENT,N),this.stat=X}oe(gy,pt);function hi(N){const X=Ts();Ot(X,new gy(X,N))}Fo.Ma="timingevent";function Sa(N,X){pt.call(this,Fo.Ma,N),this.size=X}oe(Sa,pt);function oa(N,X){if(typeof N!="function")throw Error("Fn must not be null and must be a function");return D.setTimeout(function(){N()},X)}function ka(){this.g=!0}ka.prototype.xa=function(){this.g=!1};function B_(N,X,ie,ve,tt,lt){N.info(function(){if(N.g)if(lt)for(var Ht="",Jr=lt.split("&"),xs=0;xs<Jr.length;xs++){var pr=Jr[xs].split("=");if(1<pr.length){var Vr=pr[0];pr=pr[1];var Ua=Vr.split("_");Ht=2<=Ua.length&&Ua[1]=="type"?Ht+(Vr+"="+pr+"&"):Ht+(Vr+"=redacted&")}}else Ht=null;else Ht=lt;return"XMLHTTP REQ ("+ve+") [attempt "+tt+"]: "+X+`
`+ie+`
`+Ht})}function kS(N,X,ie,ve,tt,lt,Ht){N.info(function(){return"XMLHTTP RESP ("+ve+") [ attempt "+tt+"]: "+X+`
`+ie+`
`+lt+" "+Ht})}function Gu(N,X,ie,ve){N.info(function(){return"XMLHTTP TEXT ("+X+"): "+Hh(N,ie)+(ve?" "+ve:"")})}function Sy(N,X){N.info(function(){return"TIMEOUT: "+X})}ka.prototype.info=function(){};function Hh(N,X){if(!N.g)return X;if(!X)return null;try{var ie=JSON.parse(X);if(ie){for(N=0;N<ie.length;N++)if(Array.isArray(ie[N])){var ve=ie[N];if(!(2>ve.length)){var tt=ve[1];if(Array.isArray(tt)&&!(1>tt.length)){var lt=tt[0];if(lt!="noop"&&lt!="stop"&&lt!="close")for(var Ht=1;Ht<tt.length;Ht++)tt[Ht]=""}}}}return hn(ie)}catch{return X}}var Kh={NO_ERROR:0,TIMEOUT:8},bf={},Wu;function Hu(){}oe(Hu,eo),Hu.prototype.g=function(){return new XMLHttpRequest},Hu.prototype.i=function(){return{}},Wu=new Hu;function Ja(N,X,ie,ve){this.j=N,this.i=X,this.l=ie,this.R=ve||1,this.U=new is(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new po}function po(){this.i=null,this.g="",this.h=!1}var zh={},If={};function Bo(N,X,ie){N.L=1,N.v=z_(Nl(X)),N.m=ie,N.P=!0,Yh(N,null)}function Yh(N,X){N.F=Date.now(),j_(N),N.A=Nl(N.v);var ie=N.A,ve=N.R;Array.isArray(ve)||(ve=[String(ve)]),VS(ie.i,"t",ve),N.C=0,ie=N.j.J,N.h=new po,N.g=LE(N.j,ie?X:null,!N.m),0<N.O&&(N.M=new Ci(ee(N.Y,N,N.g),N.O)),X=N.U,ie=N.g,ve=N.ca;var tt="readystatechange";Array.isArray(tt)||(tt&&(ur[0]=tt.toString()),tt=ur);for(var lt=0;lt<tt.length;lt++){var Ht=Gi(ie,tt[lt],ve||X.handleEvent,!1,X.h||X);if(!Ht)break;X.g[Ht.key]=Ht}X=N.H?he(N.H):{},N.m?(N.u||(N.u="POST"),X["Content-Type"]="application/x-www-form-urlencoded",N.g.ea(N.A,N.u,N.m,X)):(N.u="GET",N.g.ea(N.A,N.u,null,X)),Cf(),B_(N.i,N.u,N.A,N.l,N.R,N.m)}Ja.prototype.ca=function(N){N=N.target;const X=this.M;X&&ud(N)==3?X.j():this.Y(N)},Ja.prototype.Y=function(N){try{if(N==this.g)e:{const Ua=ud(this.g);var X=this.g.Ba();const ip=this.g.Z();if(!(3>Ua)&&(Ua!=3||this.g&&(this.h.h||this.g.oa()||Cy(this.g)))){this.J||Ua!=4||X==7||(X==8||0>=ip?Cf(3):Cf(2)),bi(this);var ie=this.g.Z();this.X=ie;t:if(Ty(this)){var ve=Cy(this.g);N="";var tt=ve.length,lt=ud(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Qa(this),Ku(this);var Ht="";break t}this.h.i=new D.TextDecoder}for(X=0;X<tt;X++)this.h.h=!0,N+=this.h.i.decode(ve[X],{stream:!(lt&&X==tt-1)});ve.length=0,this.h.g+=N,this.C=0,Ht=this.h.g}else Ht=this.g.oa();if(this.o=ie==200,kS(this.i,this.u,this.A,this.l,this.R,Ua,ie),this.o){if(this.T&&!this.K){t:{if(this.g){var Jr,xs=this.g;if((Jr=xs.g?xs.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ve(Jr)){var pr=Jr;break t}}pr=null}if(ie=pr)Gu(this.i,this.l,ie,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,G_(this,ie);else{this.o=!1,this.s=3,hi(12),Qa(this),Ku(this);break e}}if(this.P){ie=!0;let $c;for(;!this.J&&this.C<Ht.length;)if($c=Ao(this,Ht),$c==If){Ua==4&&(this.s=4,hi(14),ie=!1),Gu(this.i,this.l,null,"[Incomplete Response]");break}else if($c==zh){this.s=4,hi(15),Gu(this.i,this.l,Ht,"[Invalid Chunk]"),ie=!1;break}else Gu(this.i,this.l,$c,null),G_(this,$c);if(Ty(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ua!=4||Ht.length!=0||this.h.h||(this.s=1,hi(16),ie=!1),this.o=this.o&&ie,!ie)Gu(this.i,this.l,Ht,"[Invalid Chunked Response]"),Qa(this),Ku(this);else if(0<Ht.length&&!this.W){this.W=!0;var Vr=this.j;Vr.g==this&&Vr.ba&&!Vr.M&&(Vr.j.info("Great, no buffering proxy detected. Bytes received: "+Ht.length),J_(Vr),Vr.M=!0,hi(11))}}else Gu(this.i,this.l,Ht,null),G_(this,Ht);Ua==4&&Qa(this),this.o&&!this.J&&(Ua==4?wy(this.j,this):(this.o=!1,j_(this)))}else Gb(this.g),ie==400&&0<Ht.indexOf("Unknown SID")?(this.s=3,hi(12)):(this.s=0,hi(13)),Qa(this),Ku(this)}}}catch{}finally{}};function Ty(N){return N.g?N.u=="GET"&&N.L!=2&&N.j.Ca:!1}function Ao(N,X){var ie=N.C,ve=X.indexOf(`
`,ie);return ve==-1?If:(ie=Number(X.substring(ie,ve)),isNaN(ie)?zh:(ve+=1,ve+ie>X.length?If:(X=X.slice(ve,ve+ie),N.C=ve+ie,X)))}Ja.prototype.cancel=function(){this.J=!0,Qa(this)};function j_(N){N.S=Date.now()+N.I,vy(N,N.I)}function vy(N,X){if(N.B!=null)throw Error("WatchDog timer not null");N.B=oa(ee(N.ba,N),X)}function bi(N){N.B&&(D.clearTimeout(N.B),N.B=null)}Ja.prototype.ba=function(){this.B=null;const N=Date.now();0<=N-this.S?(Sy(this.i,this.A),this.L!=2&&(Cf(),hi(17)),Qa(this),this.s=2,Ku(this)):vy(this,this.S-N)};function Ku(N){N.j.G==0||N.J||wy(N.j,N)}function Qa(N){bi(N);var X=N.M;X&&typeof X.ma=="function"&&X.ma(),N.M=null,wr(N.U),N.g&&(X=N.g,N.g=null,X.abort(),X.ma())}function G_(N,X){try{var ie=N.j;if(ie.G!=0&&(ie.g==N||LS(ie.h,N))){if(!N.K&&LS(ie.h,N)&&ie.G==3){try{var ve=ie.Da.g.parse(X)}catch{ve=null}if(Array.isArray(ve)&&ve.length==3){var tt=ve;if(tt[0]==0){e:if(!ie.u){if(ie.g)if(ie.g.F+3e3<N.F)kE(ie),Xu(ie);else break e;Pl(ie),hi(18)}}else ie.za=tt[1],0<ie.za-ie.T&&37500>tt[2]&&ie.F&&ie.v==0&&!ie.C&&(ie.C=oa(ee(ie.Za,ie),6e3));if(1>=Af(ie.h)&&ie.ca){try{ie.ca()}catch{}ie.ca=void 0}}else Ta(ie,11)}else if((N.K||ie.g==N)&&kE(ie),!Ve(X))for(tt=ie.Da.g.parse(X),X=0;X<tt.length;X++){let pr=tt[X];if(ie.T=pr[0],pr=pr[1],ie.G==2)if(pr[0]=="c"){ie.K=pr[1],ie.ia=pr[2];const Vr=pr[3];Vr!=null&&(ie.la=Vr,ie.j.info("VER="+ie.la));const Ua=pr[4];Ua!=null&&(ie.Aa=Ua,ie.j.info("SVER="+ie.Aa));const ip=pr[5];ip!=null&&typeof ip=="number"&&0<ip&&(ve=1.5*ip,ie.L=ve,ie.j.info("backChannelRequestTimeoutMs_="+ve)),ve=ie;const $c=N.g;if($c){const hd=$c.g?$c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(hd){var lt=ve.h;lt.g||hd.indexOf("spdy")==-1&&hd.indexOf("quic")==-1&&hd.indexOf("h2")==-1||(lt.j=lt.l,lt.g=new Set,lt.h&&(AE(lt,lt.h),lt.h=null))}if(ve.D){const kl=$c.g?$c.g.getResponseHeader("X-HTTP-Session-Id"):null;kl&&(ve.ya=kl,hs(ve.I,ve.D,kl))}}ie.G=3,ie.l&&ie.l.ua(),ie.ba&&(ie.R=Date.now()-N.F,ie.j.info("Handshake RTT: "+ie.R+"ms")),ve=ie;var Ht=N;if(ve.qa=Zc(ve,ve.J?ve.ia:null,ve.W),Ht.K){Nc(ve.h,Ht);var Jr=Ht,xs=ve.L;xs&&(Jr.I=xs),Jr.B&&(bi(Jr),j_(Jr)),ve.g=Ht}else pc(ve);0<ie.i.length&&Ju(ie)}else pr[0]!="stop"&&pr[0]!="close"||Ta(ie,7);else ie.G==3&&(pr[0]=="stop"||pr[0]=="close"?pr[0]=="stop"?Ta(ie,7):jS(ie):pr[0]!="noop"&&ie.l&&ie.l.ta(pr),ie.v=0)}}Cf(4)}catch{}}var yy=class{constructor(N,X){this.g=N,this.map=X}};function Ol(N){this.l=N||10,D.PerformanceNavigationTiming?(N=D.performance.getEntriesByType("navigation"),N=0<N.length&&(N[0].nextHopProtocol=="hq"||N[0].nextHopProtocol=="h2")):N=!!(D.chrome&&D.chrome.loadTimes&&D.chrome.loadTimes()&&D.chrome.loadTimes().wasFetchedViaSpdy),this.j=N?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function IE(N){return N.h?!0:N.g?N.g.size>=N.j:!1}function Af(N){return N.h?1:N.g?N.g.size:0}function LS(N,X){return N.h?N.h==X:N.g?N.g.has(X):!1}function AE(N,X){N.g?N.g.add(X):N.h=X}function Nc(N,X){N.h&&N.h==X?N.h=null:N.g&&N.g.has(X)&&N.g.delete(X)}Ol.prototype.cancel=function(){if(this.i=Dc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const N of this.g.values())N.cancel();this.g.clear()}};function Dc(N){if(N.h!=null)return N.i.concat(N.h.D);if(N.g!=null&&N.g.size!==0){let X=N.i;for(const ie of N.g.values())X=X.concat(ie.D);return X}return le(N.i)}function W_(N){if(N.V&&typeof N.V=="function")return N.V();if(typeof Map<"u"&&N instanceof Map||typeof Set<"u"&&N instanceof Set)return Array.from(N.values());if(typeof N=="string")return N.split("");if(U(N)){for(var X=[],ie=N.length,ve=0;ve<ie;ve++)X.push(N[ve]);return X}X=[],ie=0;for(ve in N)X[ie++]=N[ve];return X}function wE(N){if(N.na&&typeof N.na=="function")return N.na();if(!N.V||typeof N.V!="function"){if(typeof Map<"u"&&N instanceof Map)return Array.from(N.keys());if(!(typeof Set<"u"&&N instanceof Set)){if(U(N)||typeof N=="string"){var X=[];N=N.length;for(var ie=0;ie<N;ie++)X.push(ie);return X}X=[],ie=0;for(const ve in N)X[ie++]=ve;return X}}}function Fn(N,X){if(N.forEach&&typeof N.forEach=="function")N.forEach(X,void 0);else if(U(N)||typeof N=="string")Array.prototype.forEach.call(N,X,void 0);else for(var ie=wE(N),ve=W_(N),tt=ve.length,lt=0;lt<tt;lt++)X.call(void 0,ve[lt],ie&&ie[lt],N)}var H_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function MS(N,X){if(N){N=N.split("&");for(var ie=0;ie<N.length;ie++){var ve=N[ie].indexOf("="),tt=null;if(0<=ve){var lt=N[ie].substring(0,ve);tt=N[ie].substring(ve+1)}else lt=N[ie];X(lt,tt?decodeURIComponent(tt.replace(/\+/g," ")):"")}}}function wo(N){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,N instanceof wo){this.h=N.h,K_(this,N.j),this.o=N.o,this.g=N.g,wf(this,N.s),this.l=N.l;var X=N.i,ie=new Qh;ie.i=X.i,X.g&&(ie.g=new Map(X.g),ie.h=X.h),qh(this,ie),this.m=N.m}else N&&(X=String(N).match(H_))?(this.h=!1,K_(this,X[1]||"",!0),this.o=hc(X[2]||""),this.g=hc(X[3]||"",!0),wf(this,X[4]),this.l=hc(X[5]||"",!0),qh(this,X[6]||"",!0),this.m=hc(X[7]||"")):(this.h=!1,this.i=new Qh(null,this.h))}wo.prototype.toString=function(){var N=[],X=this.j;X&&N.push(Xh(X,US,!0),":");var ie=this.g;return(ie||X=="file")&&(N.push("//"),(X=this.o)&&N.push(Xh(X,US,!0),"@"),N.push(encodeURIComponent(String(ie)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),ie=this.s,ie!=null&&N.push(":",String(ie))),(ie=this.l)&&(this.g&&ie.charAt(0)!="/"&&N.push("/"),N.push(Xh(ie,ie.charAt(0)=="/"?jb:Jh,!0))),(ie=this.i.toString())&&N.push("?",ie),(ie=this.m)&&N.push("#",Xh(ie,OE)),N.join("")};function Nl(N){return new wo(N)}function K_(N,X,ie){N.j=ie?hc(X,!0):X,N.j&&(N.j=N.j.replace(/:$/,""))}function wf(N,X){if(X){if(X=Number(X),isNaN(X)||0>X)throw Error("Bad port number "+X);N.s=X}else N.s=null}function qh(N,X,ie){X instanceof Qh?(N.i=X,Ry(N.i,N.h)):(ie||(X=Xh(X,xS)),N.i=new Qh(X,N.h))}function hs(N,X,ie){N.i.set(X,ie)}function z_(N){return hs(N,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),N}function hc(N,X){return N?X?decodeURI(N.replace(/%25/g,"%2525")):decodeURIComponent(N):""}function Xh(N,X,ie){return typeof N=="string"?(N=encodeURI(N).replace(X,Of),ie&&(N=N.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),N):null}function Of(N){return N=N.charCodeAt(0),"%"+(N>>4&15).toString(16)+(N&15).toString(16)}var US=/[#\/\?@]/g,Jh=/[#\?:]/g,jb=/[#\?]/g,xS=/[#\?@]/g,OE=/#/g;function Qh(N,X){this.h=this.g=null,this.i=N||null,this.j=!!X}function cd(N){N.g||(N.g=new Map,N.h=0,N.i&&MS(N.i,function(X,ie){N.add(decodeURIComponent(X.replace(/\+/g," ")),ie)}))}l=Qh.prototype,l.add=function(N,X){cd(this),this.i=null,N=zu(this,N);var ie=this.g.get(N);return ie||this.g.set(N,ie=[]),ie.push(X),this.h+=1,this};function Zh(N,X){cd(N),X=zu(N,X),N.g.has(X)&&(N.i=null,N.h-=N.g.get(X).length,N.g.delete(X))}function $h(N,X){return cd(N),X=zu(N,X),N.g.has(X)}l.forEach=function(N,X){cd(this),this.g.forEach(function(ie,ve){ie.forEach(function(tt){N.call(X,tt,ve,this)},this)},this)},l.na=function(){cd(this);const N=Array.from(this.g.values()),X=Array.from(this.g.keys()),ie=[];for(let ve=0;ve<X.length;ve++){const tt=N[ve];for(let lt=0;lt<tt.length;lt++)ie.push(X[ve])}return ie},l.V=function(N){cd(this);let X=[];if(typeof N=="string")$h(this,N)&&(X=X.concat(this.g.get(zu(this,N))));else{N=Array.from(this.g.values());for(let ie=0;ie<N.length;ie++)X=X.concat(N[ie])}return X},l.set=function(N,X){return cd(this),this.i=null,N=zu(this,N),$h(this,N)&&(this.h-=this.g.get(N).length),this.g.set(N,[X]),this.h+=1,this},l.get=function(N,X){return N?(N=this.V(N),0<N.length?String(N[0]):X):X};function VS(N,X,ie){Zh(N,X),0<ie.length&&(N.i=null,N.g.set(zu(N,X),le(ie)),N.h+=ie.length)}l.toString=function(){if(this.i)return this.i;if(!this.g)return"";const N=[],X=Array.from(this.g.keys());for(var ie=0;ie<X.length;ie++){var ve=X[ie];const lt=encodeURIComponent(String(ve)),Ht=this.V(ve);for(ve=0;ve<Ht.length;ve++){var tt=lt;Ht[ve]!==""&&(tt+="="+encodeURIComponent(String(Ht[ve]))),N.push(tt)}}return this.i=N.join("&")};function zu(N,X){return X=String(X),N.j&&(X=X.toLowerCase()),X}function Ry(N,X){X&&!N.j&&(cd(N),N.i=null,N.g.forEach(function(ie,ve){var tt=ve.toLowerCase();ve!=tt&&(Zh(this,ve),VS(this,tt,ie))},N)),N.j=X}function ep(N,X){const ie=new ka;if(D.Image){const ve=new Image;ve.onload=ue(ld,ie,"TestLoadImage: loaded",!0,X,ve),ve.onerror=ue(ld,ie,"TestLoadImage: error",!1,X,ve),ve.onabort=ue(ld,ie,"TestLoadImage: abort",!1,X,ve),ve.ontimeout=ue(ld,ie,"TestLoadImage: timeout",!1,X,ve),D.setTimeout(function(){ve.ontimeout&&ve.ontimeout()},1e4),ve.src=N}else X(!1)}function qd(N,X){const ie=new ka,ve=new AbortController,tt=setTimeout(()=>{ve.abort(),ld(ie,"TestPingServer: timeout",!1,X)},1e4);fetch(N,{signal:ve.signal}).then(lt=>{clearTimeout(tt),lt.ok?ld(ie,"TestPingServer: ok",!0,X):ld(ie,"TestPingServer: server error",!1,X)}).catch(()=>{clearTimeout(tt),ld(ie,"TestPingServer: error",!1,X)})}function ld(N,X,ie,ve,tt){try{tt&&(tt.onload=null,tt.onerror=null,tt.onabort=null,tt.ontimeout=null),ve(ie)}catch{}}function Y_(){this.g=new rs}function La(N,X,ie){const ve=ie||"";try{Fn(N,function(tt,lt){let Ht=tt;x(tt)&&(Ht=hn(tt)),X.push(ve+lt+"="+encodeURIComponent(Ht))})}catch(tt){throw X.push(ve+"type="+encodeURIComponent("_badmap")),tt}}function Nf(N){this.l=N.Ub||null,this.j=N.eb||!1}oe(Nf,eo),Nf.prototype.g=function(){return new tp(this.l,this.j)},Nf.prototype.i=(function(N){return function(){return N}})({});function tp(N,X){wt.call(this),this.D=N,this.o=X,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}oe(tp,wt),l=tp.prototype,l.open=function(N,X){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=N,this.A=X,this.readyState=1,dd(this)},l.send=function(N){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const X={headers:this.u,method:this.B,credentials:this.m,cache:void 0};N&&(X.body=N),(this.D||D).fetch(new Request(this.A,X)).then(this.Sa.bind(this),this.ga.bind(this))},l.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Yu(this)),this.readyState=0},l.Sa=function(N){if(this.g&&(this.l=N,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=N.headers,this.readyState=2,dd(this)),this.g&&(this.readyState=3,dd(this),this.g)))if(this.responseType==="arraybuffer")N.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof D.ReadableStream<"u"&&"body"in N){if(this.j=N.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;FS(this)}else N.text().then(this.Ra.bind(this),this.ga.bind(this))};function FS(N){N.j.read().then(N.Pa.bind(N)).catch(N.ga.bind(N))}l.Pa=function(N){if(this.g){if(this.o&&N.value)this.response.push(N.value);else if(!this.o){var X=N.value?N.value:new Uint8Array(0);(X=this.v.decode(X,{stream:!N.done}))&&(this.response=this.responseText+=X)}N.done?Yu(this):dd(this),this.readyState==3&&FS(this)}},l.Ra=function(N){this.g&&(this.response=this.responseText=N,Yu(this))},l.Qa=function(N){this.g&&(this.response=N,Yu(this))},l.ga=function(){this.g&&Yu(this)};function Yu(N){N.readyState=4,N.l=null,N.j=null,N.v=null,dd(N)}l.setRequestHeader=function(N,X){this.u.append(N,X)},l.getResponseHeader=function(N){return this.h&&this.h.get(N.toLowerCase())||""},l.getAllResponseHeaders=function(){if(!this.h)return"";const N=[],X=this.h.entries();for(var ie=X.next();!ie.done;)ie=ie.value,N.push(ie[0]+": "+ie[1]),ie=X.next();return N.join(`\r
`)};function dd(N){N.onreadystatechange&&N.onreadystatechange.call(N)}Object.defineProperty(tp.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(N){this.m=N?"include":"same-origin"}});function BS(N){let X="";return qe(N,function(ie,ve){X+=ve,X+=":",X+=ie,X+=`\r
`}),X}function Ma(N,X,ie){e:{for(ve in ie){var ve=!1;break e}ve=!0}ve||(ie=BS(ie),typeof N=="string"?ie!=null&&encodeURIComponent(String(ie)):hs(N,X,ie))}function ss(N){wt.call(this),this.headers=new Map,this.o=N||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}oe(ss,wt);var aa=/^https?$/i,os=["POST","PUT"];l=ss.prototype,l.Ha=function(N){this.J=N},l.ea=function(N,X,ie,ve){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+N);X=X?X.toUpperCase():"GET",this.D=N,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Wu.g(),this.v=this.o?Qc(this.o):Qc(Wu),this.g.onreadystatechange=ee(this.Ea,this);try{this.B=!0,this.g.open(X,String(N),!0),this.B=!1}catch(lt){NE(this,lt);return}if(N=ie||"",ie=new Map(this.headers),ve)if(Object.getPrototypeOf(ve)===Object.prototype)for(var tt in ve)ie.set(tt,ve[tt]);else if(typeof ve.keys=="function"&&typeof ve.get=="function")for(const lt of ve.keys())ie.set(lt,ve.get(lt));else throw Error("Unknown input type for opt_headers: "+String(ve));ve=Array.from(ie.keys()).find(lt=>lt.toLowerCase()=="content-type"),tt=D.FormData&&N instanceof D.FormData,!(0<=Array.prototype.indexOf.call(os,X,void 0))||ve||tt||ie.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[lt,Ht]of ie)this.g.setRequestHeader(lt,Ht);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{lr(this),this.u=!0,this.g.send(N),this.u=!1}catch(lt){NE(this,lt)}};function NE(N,X){N.h=!1,N.g&&(N.j=!0,N.g.abort(),N.j=!1),N.l=X,N.m=5,DE(N),qu(N)}function DE(N){N.A||(N.A=!0,Ot(N,"complete"),Ot(N,"error"))}l.abort=function(N){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=N||7,Ot(this,"complete"),Ot(this,"abort"),qu(this))},l.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),qu(this,!0)),ss.aa.N.call(this)},l.Ea=function(){this.s||(this.B||this.u||this.j?PE(this):this.bb())},l.bb=function(){PE(this)};function PE(N){if(N.h&&typeof b<"u"&&(!N.v[1]||ud(N)!=4||N.Z()!=2)){if(N.u&&ud(N)==4)rn(N.Ea,0,N);else if(Ot(N,"readystatechange"),ud(N)==4){N.h=!1;try{const Ht=N.Z();e:switch(Ht){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var X=!0;break e;default:X=!1}var ie;if(!(ie=X)){var ve;if(ve=Ht===0){var tt=String(N.D).match(H_)[1]||null;!tt&&D.self&&D.self.location&&(tt=D.self.location.protocol.slice(0,-1)),ve=!aa.test(tt?tt.toLowerCase():"")}ie=ve}if(ie)Ot(N,"complete"),Ot(N,"success");else{N.m=6;try{var lt=2<ud(N)?N.g.statusText:""}catch{lt=""}N.l=lt+" ["+N.Z()+"]",DE(N)}}finally{qu(N)}}}}function qu(N,X){if(N.g){lr(N);const ie=N.g,ve=N.v[0]?()=>{}:null;N.g=null,N.v=null,X||Ot(N,"ready");try{ie.onreadystatechange=ve}catch{}}}function lr(N){N.I&&(D.clearTimeout(N.I),N.I=null)}l.isActive=function(){return!!this.g};function ud(N){return N.g?N.g.readyState:0}l.Z=function(){try{return 2<ud(this)?this.g.status:-1}catch{return-1}},l.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},l.Oa=function(N){if(this.g){var X=this.g.responseText;return N&&X.indexOf(N)==0&&(X=X.substring(N.length)),hr(X)}};function Cy(N){try{if(!N.g)return null;if("response"in N.g)return N.g.response;switch(N.H){case"":case"text":return N.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in N.g)return N.g.mozResponseArrayBuffer}return null}catch{return null}}function Gb(N){const X={};N=(N.g&&2<=ud(N)&&N.g.getAllResponseHeaders()||"").split(`\r
`);for(let ve=0;ve<N.length;ve++){if(Ve(N[ve]))continue;var ie=Ie(N[ve]);const tt=ie[0];if(ie=ie[1],typeof ie!="string")continue;ie=ie.trim();const lt=X[tt]||[];X[tt]=lt,lt.push(ie)}Te(X,function(ve){return ve.join(", ")})}l.Ba=function(){return this.m},l.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Dl(N,X,ie){return ie&&ie.internalChannelParams&&ie.internalChannelParams[N]||X}function Df(N){this.Aa=0,this.i=[],this.j=new ka,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Dl("failFast",!1,N),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Dl("baseRetryDelayMs",5e3,N),this.cb=Dl("retryDelaySeedMs",1e4,N),this.Wa=Dl("forwardChannelMaxRetries",2,N),this.wa=Dl("forwardChannelRequestTimeoutMs",2e4,N),this.pa=N&&N.xmlHttpFactory||void 0,this.Xa=N&&N.Tb||void 0,this.Ca=N&&N.useFetchStreams||!1,this.L=void 0,this.J=N&&N.supportsCrossDomainXhr||!1,this.K="",this.h=new Ol(N&&N.concurrentRequestLimit),this.Da=new Y_,this.P=N&&N.fastHandshake||!1,this.O=N&&N.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=N&&N.Rb||!1,N&&N.xa&&this.j.xa(),N&&N.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&N&&N.detectBufferingProxy||!1,this.ja=void 0,N&&N.longPollingTimeout&&0<N.longPollingTimeout&&(this.ja=N.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}l=Df.prototype,l.la=8,l.G=1,l.connect=function(N,X,ie,ve){hi(0),this.W=N,this.H=X||{},ie&&ve!==void 0&&(this.H.OSID=ie,this.H.OAID=ve),this.F=this.X,this.I=Zc(this,null,this.W),Ju(this)};function jS(N){if(by(N),N.G==3){var X=N.U++,ie=Nl(N.I);if(hs(ie,"SID",N.K),hs(ie,"RID",X),hs(ie,"TYPE","terminate"),X_(N,ie),X=new Ja(N,N.j,X),X.L=2,X.v=z_(Nl(ie)),ie=!1,D.navigator&&D.navigator.sendBeacon)try{ie=D.navigator.sendBeacon(X.v.toString(),"")}catch{}!ie&&D.Image&&(new Image().src=X.v,ie=!0),ie||(X.g=LE(X.j,null),X.g.ea(X.v)),X.F=Date.now(),j_(X)}Oy(N)}function Xu(N){N.g&&(J_(N),N.g.cancel(),N.g=null)}function by(N){Xu(N),N.u&&(D.clearTimeout(N.u),N.u=null),kE(N),N.h.cancel(),N.s&&(typeof N.s=="number"&&D.clearTimeout(N.s),N.s=null)}function Ju(N){if(!IE(N.h)&&!N.s){N.s=!0;var X=N.Ga;Je||xe(),mt||(Je(),mt=!0),yt.add(X,N),N.B=0}}function q_(N,X){return Af(N.h)>=N.h.j-(N.s?1:0)?!1:N.s?(N.i=X.D.concat(N.i),!0):N.G==1||N.G==2||N.B>=(N.Va?0:N.Wa)?!1:(N.s=oa(ee(N.Ga,N,X),GS(N,N.B)),N.B++,!0)}l.Ga=function(N){if(this.s)if(this.s=null,this.G==1){if(!N){this.U=Math.floor(1e5*Math.random()),N=this.U++;const tt=new Ja(this,this.j,N);let lt=this.o;if(this.S&&(lt?(lt=he(lt),ye(lt,this.S)):lt=this.S),this.m!==null||this.O||(tt.H=lt,lt=null),this.P)e:{for(var X=0,ie=0;ie<this.i.length;ie++){t:{var ve=this.i[ie];if("__data__"in ve.map&&(ve=ve.map.__data__,typeof ve=="string")){ve=ve.length;break t}ve=void 0}if(ve===void 0)break;if(X+=ve,4096<X){X=ie;break e}if(X===4096||ie===this.i.length-1){X=ie+1;break e}}X=1e3}else X=1e3;X=Iy(this,tt,X),ie=Nl(this.I),hs(ie,"RID",N),hs(ie,"CVER",22),this.D&&hs(ie,"X-HTTP-Session-Id",this.D),X_(this,ie),lt&&(this.O?X="headers="+encodeURIComponent(String(BS(lt)))+"&"+X:this.m&&Ma(ie,this.m,lt)),AE(this.h,tt),this.Ua&&hs(ie,"TYPE","init"),this.P?(hs(ie,"$req",X),hs(ie,"SID","null"),tt.T=!0,Bo(tt,ie,null)):Bo(tt,ie,X),this.G=2}}else this.G==3&&(N?np(this,N):this.i.length==0||IE(this.h)||np(this))};function np(N,X){var ie;X?ie=X.l:ie=N.U++;const ve=Nl(N.I);hs(ve,"SID",N.K),hs(ve,"RID",ie),hs(ve,"AID",N.T),X_(N,ve),N.m&&N.o&&Ma(ve,N.m,N.o),ie=new Ja(N,N.j,ie,N.B+1),N.m===null&&(ie.H=N.o),X&&(N.i=X.D.concat(N.i)),X=Iy(N,ie,1e3),ie.I=Math.round(.5*N.wa)+Math.round(.5*N.wa*Math.random()),AE(N.h,ie),Bo(ie,ve,X)}function X_(N,X){N.H&&qe(N.H,function(ie,ve){hs(X,ve,ie)}),N.l&&Fn({},function(ie,ve){hs(X,ve,ie)})}function Iy(N,X,ie){ie=Math.min(N.i.length,ie);var ve=N.l?ee(N.l.Na,N.l,N):null;e:{var tt=N.i;let lt=-1;for(;;){const Ht=["count="+ie];lt==-1?0<ie?(lt=tt[0].g,Ht.push("ofs="+lt)):lt=0:Ht.push("ofs="+lt);let Jr=!0;for(let xs=0;xs<ie;xs++){let pr=tt[xs].g;const Vr=tt[xs].map;if(pr-=lt,0>pr)lt=Math.max(0,tt[xs].g-100),Jr=!1;else try{La(Vr,Ht,"req"+pr+"_")}catch{ve&&ve(Vr)}}if(Jr){ve=Ht.join("&");break e}}}return N=N.i.splice(0,ie),X.D=N,ve}function pc(N){if(!N.g&&!N.u){N.Y=1;var X=N.Fa;Je||xe(),mt||(Je(),mt=!0),yt.add(X,N),N.v=0}}function Pl(N){return N.g||N.u||3<=N.v?!1:(N.Y++,N.u=oa(ee(N.Fa,N),GS(N,N.v)),N.v++,!0)}l.Fa=function(){if(this.u=null,Ay(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var N=2*this.R;this.j.info("BP detection timer enabled: "+N),this.A=oa(ee(this.ab,this),N)}},l.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,hi(10),Xu(this),Ay(this))};function J_(N){N.A!=null&&(D.clearTimeout(N.A),N.A=null)}function Ay(N){N.g=new Ja(N,N.j,"rpc",N.Y),N.m===null&&(N.g.H=N.o),N.g.O=0;var X=Nl(N.qa);hs(X,"RID","rpc"),hs(X,"SID",N.K),hs(X,"AID",N.T),hs(X,"CI",N.F?"0":"1"),!N.F&&N.ja&&hs(X,"TO",N.ja),hs(X,"TYPE","xmlhttp"),X_(N,X),N.m&&N.o&&Ma(X,N.m,N.o),N.L&&(N.g.I=N.L);var ie=N.g;N=N.ia,ie.L=1,ie.v=z_(Nl(X)),ie.m=null,ie.P=!0,Yh(ie,N)}l.Za=function(){this.C!=null&&(this.C=null,Xu(this),Pl(this),hi(19))};function kE(N){N.C!=null&&(D.clearTimeout(N.C),N.C=null)}function wy(N,X){var ie=null;if(N.g==X){kE(N),J_(N),N.g=null;var ve=2}else if(LS(N.h,X))ie=X.D,Nc(N.h,X),ve=1;else return;if(N.G!=0){if(X.o)if(ve==1){ie=X.m?X.m.length:0,X=Date.now()-X.F;var tt=N.B;ve=Ts(),Ot(ve,new Sa(ve,ie)),Ju(N)}else pc(N);else if(tt=X.s,tt==3||tt==0&&0<X.X||!(ve==1&&q_(N,X)||ve==2&&Pl(N)))switch(ie&&0<ie.length&&(X=N.h,X.i=X.i.concat(ie)),tt){case 1:Ta(N,5);break;case 4:Ta(N,10);break;case 3:Ta(N,6);break;default:Ta(N,2)}}}function GS(N,X){let ie=N.Ta+Math.floor(Math.random()*N.cb);return N.isActive()||(ie*=2),ie*X}function Ta(N,X){if(N.j.info("Error code "+X),X==2){var ie=ee(N.fb,N),ve=N.Xa;const tt=!ve;ve=new wo(ve||"//www.google.com/images/cleardot.gif"),D.location&&D.location.protocol=="http"||K_(ve,"https"),z_(ve),tt?ep(ve.toString(),ie):qd(ve.toString(),ie)}else hi(2);N.G=0,N.l&&N.l.sa(X),Oy(N),by(N)}l.fb=function(N){N?(this.j.info("Successfully pinged google.com"),hi(2)):(this.j.info("Failed to ping google.com"),hi(1))};function Oy(N){if(N.G=0,N.ka=[],N.l){const X=Dc(N.h);(X.length!=0||N.i.length!=0)&&(pe(N.ka,X),pe(N.ka,N.i),N.h.i.length=0,le(N.i),N.i.length=0),N.l.ra()}}function Zc(N,X,ie){var ve=ie instanceof wo?Nl(ie):new wo(ie);if(ve.g!="")X&&(ve.g=X+"."+ve.g),wf(ve,ve.s);else{var tt=D.location;ve=tt.protocol,X=X?X+"."+tt.hostname:tt.hostname,tt=+tt.port;var lt=new wo(null);ve&&K_(lt,ve),X&&(lt.g=X),tt&&wf(lt,tt),ie&&(lt.l=ie),ve=lt}return ie=N.D,X=N.ya,ie&&X&&hs(ve,ie,X),hs(ve,"VER",N.la),X_(N,ve),ve}function LE(N,X,ie){if(X&&!N.J)throw Error("Can't create secondary domain capable XhrIo object.");return X=N.Ca&&!N.pa?new ss(new Nf({eb:ie})):new ss(N.pa),X.Ha(N.J),X}l.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ny(){}l=Ny.prototype,l.ua=function(){},l.ta=function(){},l.sa=function(){},l.ra=function(){},l.isActive=function(){return!0},l.Na=function(){};function Ut(N,X){wt.call(this),this.g=new Df(X),this.l=N,this.h=X&&X.messageUrlParams||null,N=X&&X.messageHeaders||null,X&&X.clientProtocolHeaderRequired&&(N?N["X-Client-Protocol"]="webchannel":N={"X-Client-Protocol":"webchannel"}),this.g.o=N,N=X&&X.initMessageHeaders||null,X&&X.messageContentType&&(N?N["X-WebChannel-Content-Type"]=X.messageContentType:N={"X-WebChannel-Content-Type":X.messageContentType}),X&&X.va&&(N?N["X-WebChannel-Client-Profile"]=X.va:N={"X-WebChannel-Client-Profile":X.va}),this.g.S=N,(N=X&&X.Sb)&&!Ve(N)&&(this.g.m=N),this.v=X&&X.supportsCrossDomainXhr||!1,this.u=X&&X.sendRawJson||!1,(X=X&&X.httpSessionIdParam)&&!Ve(X)&&(this.g.D=X,N=this.h,N!==null&&X in N&&(N=this.h,X in N&&delete N[X])),this.j=new Pf(this)}oe(Ut,wt),Ut.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ut.prototype.close=function(){jS(this.g)},Ut.prototype.o=function(N){var X=this.g;if(typeof N=="string"){var ie={};ie.__data__=N,N=ie}else this.u&&(ie={},ie.__data__=hn(N),N=ie);X.i.push(new yy(X.Ya++,N)),X.G==3&&Ju(X)},Ut.prototype.N=function(){this.g.l=null,delete this.j,jS(this.g),delete this.g,Ut.aa.N.call(this)};function Dy(N){Xr.call(this),N.__headers__&&(this.headers=N.__headers__,this.statusCode=N.__status__,delete N.__headers__,delete N.__status__);var X=N.__sm__;if(X){e:{for(const ie in X){N=ie;break e}N=void 0}(this.i=N)&&(N=this.i,X=X!==null&&N in X?X[N]:void 0),this.data=X}else this.data=N}oe(Dy,Xr);function Py(){ho.call(this),this.status=1}oe(Py,ho);function Pf(N){this.g=N}oe(Pf,Ny),Pf.prototype.ua=function(){Ot(this.g,"a")},Pf.prototype.ta=function(N){Ot(this.g,new Dy(N))},Pf.prototype.sa=function(N){Ot(this.g,new Py)},Pf.prototype.ra=function(){Ot(this.g,"b")},Ut.prototype.send=Ut.prototype.o,Ut.prototype.open=Ut.prototype.m,Ut.prototype.close=Ut.prototype.close,Kh.NO_ERROR=0,Kh.TIMEOUT=8,Kh.HTTP_ERROR=6,bf.COMPLETE="complete",Rf.EventType=Yd,Yd.OPEN="a",Yd.CLOSE="b",Yd.ERROR="c",Yd.MESSAGE="d",wt.prototype.listen=wt.prototype.K,ss.prototype.listenOnce=ss.prototype.L,ss.prototype.getLastError=ss.prototype.Ka,ss.prototype.getLastErrorCode=ss.prototype.Ba,ss.prototype.getStatus=ss.prototype.Z,ss.prototype.getResponseJson=ss.prototype.Oa,ss.prototype.getResponseText=ss.prototype.oa,ss.prototype.send=ss.prototype.ea,ss.prototype.setWithCredentials=ss.prototype.Ha}).apply(typeof J6<"u"?J6:typeof self<"u"?self:typeof window<"u"?window:{});const uZ="@firebase/firestore",hZ="4.9.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uu{constructor(a){this.uid=a}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(a){return a.uid===this.uid}}Uu.UNAUTHENTICATED=new Uu(null),Uu.GOOGLE_CREDENTIALS=new Uu("google-credentials-uid"),Uu.FIRST_PARTY=new Uu("first-party-uid"),Uu.MOCK_USER=new Uu("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let O3="12.2.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kk=new yW("@firebase/firestore");function EE(l,...a){if(Kk.logLevel<=Ls.DEBUG){const h=a.map(wX);Kk.debug(`Firestore (${O3}): ${l}`,...h)}}function pte(l,...a){if(Kk.logLevel<=Ls.ERROR){const h=a.map(wX);Kk.error(`Firestore (${O3}): ${l}`,...h)}}function _fe(l,...a){if(Kk.logLevel<=Ls.WARN){const h=a.map(wX);Kk.warn(`Firestore (${O3}): ${l}`,...h)}}function wX(l){if(typeof l=="string")return l;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return(function(h){return JSON.stringify(h)})(l)}catch{return l}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c3(l,a,h){let _="Unexpected state";typeof a=="string"?_=a:h=a,fte(l,_,h)}function fte(l,a,h){let _=`FIRESTORE (${O3}) INTERNAL ASSERTION FAILED: ${a} (ID: ${l.toString(16)})`;if(h!==void 0)try{_+=" CONTEXT: "+JSON.stringify(h)}catch{_+=" CONTEXT: "+h}throw pte(_),new Error(_)}function Wj(l,a,h,_){let S="Unexpected state";typeof h=="string"?S=h:_=h,l||fte(a,S,_)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ts={CANCELLED:"cancelled",INVALID_ARGUMENT:"invalid-argument",FAILED_PRECONDITION:"failed-precondition"};class ns extends my{constructor(a,h){super(a,h),this.code=a,this.message=h,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hj{constructor(){this.promise=new Promise(((a,h)=>{this.resolve=a,this.reject=h}))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _te{constructor(a,h){this.user=h,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${a}`)}}class mfe{getToken(){return Promise.resolve(null)}invalidateToken(){}start(a,h){a.enqueueRetryable((()=>h(Uu.UNAUTHENTICATED)))}shutdown(){}}class Efe{constructor(a){this.token=a,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(a,h){this.changeListener=h,a.enqueueRetryable((()=>h(this.token.user)))}shutdown(){this.changeListener=null}}class gfe{constructor(a){this.t=a,this.currentUser=Uu.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(a,h){Wj(this.o===void 0,42304);let _=this.i;const S=U=>this.i!==_?(_=this.i,h(U)):Promise.resolve();let y=new Hj;this.o=()=>{this.i++,this.currentUser=this.u(),y.resolve(),y=new Hj,a.enqueueRetryable((()=>S(this.currentUser)))};const b=()=>{const U=y;a.enqueueRetryable((async()=>{await U.promise,await S(this.currentUser)}))},D=U=>{EE("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=U,this.o&&(this.auth.addAuthTokenListener(this.o),b())};this.t.onInit((U=>D(U))),setTimeout((()=>{if(!this.auth){const U=this.t.getImmediate({optional:!0});U?D(U):(EE("FirebaseAuthCredentialsProvider","Auth not yet detected"),y.resolve(),y=new Hj)}}),0),b()}getToken(){const a=this.i,h=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(h).then((_=>this.i!==a?(EE("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):_?(Wj(typeof _.accessToken=="string",31837,{l:_}),new _te(_.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const a=this.auth&&this.auth.getUid();return Wj(a===null||typeof a=="string",2055,{h:a}),new Uu(a)}}class Sfe{constructor(a,h,_){this.P=a,this.T=h,this.I=_,this.type="FirstParty",this.user=Uu.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const a=this.R();return a&&this.A.set("Authorization",a),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Tfe{constructor(a,h,_){this.P=a,this.T=h,this.I=_}getToken(){return Promise.resolve(new Sfe(this.P,this.T,this.I))}start(a,h){a.enqueueRetryable((()=>h(Uu.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class pZ{constructor(a){this.value=a,this.type="AppCheck",this.headers=new Map,a&&a.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class vfe{constructor(a,h){this.V=h,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,fE(a)&&a.settings.appCheckToken&&(this.p=a.settings.appCheckToken)}start(a,h){Wj(this.o===void 0,3512);const _=y=>{y.error!=null&&EE("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${y.error.message}`);const b=y.token!==this.m;return this.m=y.token,EE("FirebaseAppCheckTokenProvider",`Received ${b?"new":"existing"} token.`),b?h(y.token):Promise.resolve()};this.o=y=>{a.enqueueRetryable((()=>_(y)))};const S=y=>{EE("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=y,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((y=>S(y))),setTimeout((()=>{if(!this.appCheck){const y=this.V.getImmediate({optional:!0});y?S(y):EE("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new pZ(this.p));const a=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(a).then((h=>h?(Wj(typeof h.token=="string",44558,{tokenResult:h}),this.m=h.token,new pZ(h.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yfe(l){const a=typeof self<"u"&&(self.crypto||self.msCrypto),h=new Uint8Array(l);if(a&&typeof a.getRandomValues=="function")a.getRandomValues(h);else for(let _=0;_<l;_++)h[_]=Math.floor(256*Math.random());return h}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rfe{static newId(){const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",h=62*Math.floor(4.129032258064516);let _="";for(;_.length<20;){const S=yfe(40);for(let y=0;y<S.length;++y)_.length<20&&S[y]<h&&(_+=a.charAt(S[y]%62))}return _}}function Ub(l,a){return l<a?-1:l>a?1:0}function Cfe(l,a){const h=Math.min(l.length,a.length);for(let _=0;_<h;_++){const S=l.charAt(_),y=a.charAt(_);if(S!==y)return Pq(S)===Pq(y)?Ub(S,y):Pq(S)?1:-1}return Ub(l.length,a.length)}const bfe=55296,Ife=57343;function Pq(l){const a=l.charCodeAt(0);return a>=bfe&&a<=Ife}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fZ="__name__";class ES{constructor(a,h,_){h===void 0?h=0:h>a.length&&c3(637,{offset:h,range:a.length}),_===void 0?_=a.length-h:_>a.length-h&&c3(1746,{length:_,range:a.length-h}),this.segments=a,this.offset=h,this.len=_}get length(){return this.len}isEqual(a){return ES.comparator(this,a)===0}child(a){const h=this.segments.slice(this.offset,this.limit());return a instanceof ES?a.forEach((_=>{h.push(_)})):h.push(a),this.construct(h)}limit(){return this.offset+this.length}popFirst(a){return a=a===void 0?1:a,this.construct(this.segments,this.offset+a,this.length-a)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(a){return this.segments[this.offset+a]}isEmpty(){return this.length===0}isPrefixOf(a){if(a.length<this.length)return!1;for(let h=0;h<this.length;h++)if(this.get(h)!==a.get(h))return!1;return!0}isImmediateParentOf(a){if(this.length+1!==a.length)return!1;for(let h=0;h<this.length;h++)if(this.get(h)!==a.get(h))return!1;return!0}forEach(a){for(let h=this.offset,_=this.limit();h<_;h++)a(this.segments[h])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(a,h){const _=Math.min(a.length,h.length);for(let S=0;S<_;S++){const y=ES.compareSegments(a.get(S),h.get(S));if(y!==0)return y}return Ub(a.length,h.length)}static compareSegments(a,h){const _=ES.isNumericId(a),S=ES.isNumericId(h);return _&&!S?-1:!_&&S?1:_&&S?ES.extractNumericId(a).compare(ES.extractNumericId(h)):Cfe(a,h)}static isNumericId(a){return a.startsWith("__id")&&a.endsWith("__")}static extractNumericId(a){return AX.fromString(a.substring(4,a.length-2))}}class pE extends ES{construct(a,h,_){return new pE(a,h,_)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...a){const h=[];for(const _ of a){if(_.indexOf("//")>=0)throw new ns(ts.INVALID_ARGUMENT,`Invalid segment (${_}). Paths must not contain // in them.`);h.push(..._.split("/").filter((S=>S.length>0)))}return new pE(h)}static emptyPath(){return new pE([])}}const Afe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class z0 extends ES{construct(a,h,_){return new z0(a,h,_)}static isValidIdentifier(a){return Afe.test(a)}canonicalString(){return this.toArray().map((a=>(a=a.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),z0.isValidIdentifier(a)||(a="`"+a+"`"),a))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===fZ}static keyField(){return new z0([fZ])}static fromServerFormat(a){const h=[];let _="",S=0;const y=()=>{if(_.length===0)throw new ns(ts.INVALID_ARGUMENT,`Invalid field path (${a}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);h.push(_),_=""};let b=!1;for(;S<a.length;){const D=a[S];if(D==="\\"){if(S+1===a.length)throw new ns(ts.INVALID_ARGUMENT,"Path has trailing escape character: "+a);const U=a[S+1];if(U!=="\\"&&U!=="."&&U!=="`")throw new ns(ts.INVALID_ARGUMENT,"Path has invalid escape sequence: "+a);_+=U,S+=2}else D==="`"?(b=!b,S++):D!=="."||b?(_+=D,S++):(y(),S++)}if(y(),b)throw new ns(ts.INVALID_ARGUMENT,"Unterminated ` in path: "+a);return new z0(h)}static emptyPath(){return new z0([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X0{constructor(a){this.path=a}static fromPath(a){return new X0(pE.fromString(a))}static fromName(a){return new X0(pE.fromString(a).popFirst(5))}static empty(){return new X0(pE.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(a){return this.path.length>=2&&this.path.get(this.path.length-2)===a}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(a){return a!==null&&pE.comparator(this.path,a.path)===0}toString(){return this.path.toString()}static comparator(a,h){return pE.comparator(a.path,h.path)}static isDocumentKey(a){return a.length%2==0}static fromSegments(a){return new X0(new pE(a.slice()))}}function wfe(l,a,h,_){if(a===!0&&_===!0)throw new ns(ts.INVALID_ARGUMENT,`${l} and ${h} cannot be used together.`)}function Ofe(l){return typeof l=="object"&&l!==null&&(Object.getPrototypeOf(l)===Object.prototype||Object.getPrototypeOf(l)===null)}function Nfe(l){if(l===void 0)return"undefined";if(l===null)return"null";if(typeof l=="string")return l.length>20&&(l=`${l.substring(0,20)}...`),JSON.stringify(l);if(typeof l=="number"||typeof l=="boolean")return""+l;if(typeof l=="object"){if(l instanceof Array)return"an array";{const a=(function(_){return _.constructor?_.constructor.name:null})(l);return a?`a custom ${a} object`:"an object"}}return typeof l=="function"?"a function":c3(12329,{type:typeof l})}function Dfe(l,a){if("_delegate"in l&&(l=l._delegate),!(l instanceof a)){if(a.name===l.constructor.name)throw new ns(ts.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const h=Nfe(l);throw new ns(ts.INVALID_ARGUMENT,`Expected type '${a.name}', but it was: ${h}`)}}return l}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oc(l,a){const h={typeString:l};return a&&(h.value=a),h}function N3(l,a){if(!Ofe(l))throw new ns(ts.INVALID_ARGUMENT,"JSON must be an object");let h;for(const _ in a)if(a[_]){const S=a[_].typeString,y="value"in a[_]?{value:a[_].value}:void 0;if(!(_ in l)){h=`JSON missing required field: '${_}'`;break}const b=l[_];if(S&&typeof b!==S){h=`JSON field '${_}' must be a ${S}.`;break}if(y!==void 0&&b!==y.value){h=`Expected '${_}' field to equal '${y.value}'`;break}}if(h)throw new ns(ts.INVALID_ARGUMENT,h);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _Z=-62135596800,mZ=1e6;class TS{static now(){return TS.fromMillis(Date.now())}static fromDate(a){return TS.fromMillis(a.getTime())}static fromMillis(a){const h=Math.floor(a/1e3),_=Math.floor((a-1e3*h)*mZ);return new TS(h,_)}constructor(a,h){if(this.seconds=a,this.nanoseconds=h,h<0)throw new ns(ts.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+h);if(h>=1e9)throw new ns(ts.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+h);if(a<_Z)throw new ns(ts.INVALID_ARGUMENT,"Timestamp seconds out of range: "+a);if(a>=253402300800)throw new ns(ts.INVALID_ARGUMENT,"Timestamp seconds out of range: "+a)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/mZ}_compareTo(a){return this.seconds===a.seconds?Ub(this.nanoseconds,a.nanoseconds):Ub(this.seconds,a.seconds)}isEqual(a){return a.seconds===this.seconds&&a.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:TS._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(a){if(N3(a,TS._jsonSchema))return new TS(a.seconds,a.nanoseconds)}valueOf(){const a=this.seconds-_Z;return String(a).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}TS._jsonSchemaVersion="firestore/timestamp/1.0",TS._jsonSchema={type:Oc("string",TS._jsonSchemaVersion),seconds:Oc("number"),nanoseconds:Oc("number")};function Pfe(l){return l.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kfe extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nO{constructor(a){this.binaryString=a}static fromBase64String(a){const h=(function(S){try{return atob(S)}catch(y){throw typeof DOMException<"u"&&y instanceof DOMException?new kfe("Invalid base64 string: "+y):y}})(a);return new nO(h)}static fromUint8Array(a){const h=(function(S){let y="";for(let b=0;b<S.length;++b)y+=String.fromCharCode(S[b]);return y})(a);return new nO(h)}[Symbol.iterator](){let a=0;return{next:()=>a<this.binaryString.length?{value:this.binaryString.charCodeAt(a++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(h){return btoa(h)})(this.binaryString)}toUint8Array(){return(function(h){const _=new Uint8Array(h.length);for(let S=0;S<h.length;S++)_[S]=h.charCodeAt(S);return _})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(a){return Ub(this.binaryString,a.binaryString)}isEqual(a){return this.binaryString===a.binaryString}}nO.EMPTY_BYTE_STRING=new nO("");const E7="(default)";class NG{constructor(a,h){this.projectId=a,this.database=h||E7}static empty(){return new NG("","")}get isDefaultDatabase(){return this.database===E7}isEqual(a){return a instanceof NG&&a.projectId===this.projectId&&a.database===this.database}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lfe{constructor(a,h=null,_=[],S=[],y=null,b="F",D=null,U=null){this.path=a,this.collectionGroup=h,this.explicitOrderBy=_,this.filters=S,this.limit=y,this.limitType=b,this.startAt=D,this.endAt=U,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Mfe(l){return new Lfe(l)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var EZ,es;(es=EZ||(EZ={}))[es.OK=0]="OK",es[es.CANCELLED=1]="CANCELLED",es[es.UNKNOWN=2]="UNKNOWN",es[es.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",es[es.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",es[es.NOT_FOUND=5]="NOT_FOUND",es[es.ALREADY_EXISTS=6]="ALREADY_EXISTS",es[es.PERMISSION_DENIED=7]="PERMISSION_DENIED",es[es.UNAUTHENTICATED=16]="UNAUTHENTICATED",es[es.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",es[es.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",es[es.ABORTED=10]="ABORTED",es[es.OUT_OF_RANGE=11]="OUT_OF_RANGE",es[es.UNIMPLEMENTED=12]="UNIMPLEMENTED",es[es.INTERNAL=13]="INTERNAL",es[es.UNAVAILABLE=14]="UNAVAILABLE",es[es.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new AX([4294967295,4294967295],0);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ufe=41943040;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xfe=1048576;function kq(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vfe{constructor(a,h,_=1e3,S=1.5,y=6e4){this.Mi=a,this.timerId=h,this.d_=_,this.A_=S,this.R_=y,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(a){this.cancel();const h=Math.floor(this.V_+this.y_()),_=Math.max(0,Date.now()-this.f_),S=Math.max(0,h-_);S>0&&EE("ExponentialBackoff",`Backing off for ${S} ms (base delay: ${this.V_} ms, delay with jitter: ${h} ms, last attempt: ${_} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,S,(()=>(this.f_=Date.now(),a()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OX{constructor(a,h,_,S,y){this.asyncQueue=a,this.timerId=h,this.targetTimeMs=_,this.op=S,this.removalCallback=y,this.deferred=new Hj,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((b=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(a,h,_,S,y){const b=Date.now()+_,D=new OX(a,h,b,S,y);return D.start(_),D}start(a){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),a)}skipDelay(){return this.handleDelayElapsed()}cancel(a){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ns(ts.CANCELLED,"Operation cancelled"+(a?": "+a:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((a=>this.deferred.resolve(a)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}var gZ,SZ;(SZ=gZ||(gZ={})).Ma="default",SZ.Cache="cache";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ffe(l){const a={};return l.timeoutSeconds!==void 0&&(a.timeoutSeconds=l.timeoutSeconds),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TZ=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mte="firestore.googleapis.com",vZ=!0;class yZ{constructor(a){if(a.host===void 0){if(a.ssl!==void 0)throw new ns(ts.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=mte,this.ssl=vZ}else this.host=a.host,this.ssl=a.ssl??vZ;if(this.isUsingEmulator=a.emulatorOptions!==void 0,this.credentials=a.credentials,this.ignoreUndefinedProperties=!!a.ignoreUndefinedProperties,this.localCache=a.localCache,a.cacheSizeBytes===void 0)this.cacheSizeBytes=Ufe;else{if(a.cacheSizeBytes!==-1&&a.cacheSizeBytes<xfe)throw new ns(ts.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=a.cacheSizeBytes}wfe("experimentalForceLongPolling",a.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",a.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!a.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:a.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!a.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ffe(a.experimentalLongPollingOptions??{}),(function(_){if(_.timeoutSeconds!==void 0){if(isNaN(_.timeoutSeconds))throw new ns(ts.INVALID_ARGUMENT,`invalid long polling timeout: ${_.timeoutSeconds} (must not be NaN)`);if(_.timeoutSeconds<5)throw new ns(ts.INVALID_ARGUMENT,`invalid long polling timeout: ${_.timeoutSeconds} (minimum allowed value is 5)`);if(_.timeoutSeconds>30)throw new ns(ts.INVALID_ARGUMENT,`invalid long polling timeout: ${_.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!a.useFetchStreams}isEqual(a){return this.host===a.host&&this.ssl===a.ssl&&this.credentials===a.credentials&&this.cacheSizeBytes===a.cacheSizeBytes&&this.experimentalForceLongPolling===a.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===a.experimentalAutoDetectLongPolling&&(function(_,S){return _.timeoutSeconds===S.timeoutSeconds})(this.experimentalLongPollingOptions,a.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===a.ignoreUndefinedProperties&&this.useFetchStreams===a.useFetchStreams}}class Ete{constructor(a,h,_,S){this._authCredentials=a,this._appCheckCredentials=h,this._databaseId=_,this._app=S,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new yZ({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ns(ts.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(a){if(this._settingsFrozen)throw new ns(ts.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new yZ(a),this._emulatorOptions=a.emulatorOptions||{},a.credentials!==void 0&&(this._authCredentials=(function(_){if(!_)return new mfe;switch(_.type){case"firstParty":return new Tfe(_.sessionIndex||"0",_.iamToken||null,_.authTokenFactory||null);case"provider":return _.client;default:throw new ns(ts.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(a.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(h){const _=TZ.get(h);_&&(EE("ComponentProvider","Removing Datastore"),TZ.delete(h),_.terminate())})(this),Promise.resolve()}}function Bfe(l,a,h,_={}){l=Dfe(l,Ete);const S=lO(a),y=l._getSettings(),b={...y,emulatorOptions:l._getEmulatorOptions()},D=`${a}:${h}`;S&&(vX(`https://${D}`),yX("Firestore",!0)),y.host!==mte&&y.host!==D&&_fe("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const U={...y,host:D,ssl:S,emulatorOptions:_};if(!Lb(U,b)&&(l._setSettings(U),_.mockUserToken)){let x,q;if(typeof _.mockUserToken=="string")x=_.mockUserToken,q=Uu.MOCK_USER;else{x=ste(_.mockUserToken,l._app?.options.projectId);const J=_.mockUserToken.sub||_.mockUserToken.user_id;if(!J)throw new ns(ts.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");q=new Uu(J)}l._authCredentials=new Efe(new _te(x,q))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NX{constructor(a,h,_){this.converter=h,this._query=_,this.type="query",this.firestore=a}withConverter(a){return new NX(this.firestore,a,this._query)}}class yS{constructor(a,h,_){this.converter=h,this._key=_,this.type="document",this.firestore=a}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new DX(this.firestore,this.converter,this._key.path.popLast())}withConverter(a){return new yS(this.firestore,a,this._key)}toJSON(){return{type:yS._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(a,h,_){if(N3(h,yS._jsonSchema))return new yS(a,_||null,new X0(pE.fromString(h.referencePath)))}}yS._jsonSchemaVersion="firestore/documentReference/1.0",yS._jsonSchema={type:Oc("string",yS._jsonSchemaVersion),referencePath:Oc("string")};class DX extends NX{constructor(a,h,_){super(a,h,Mfe(_)),this._path=_,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const a=this._path.popLast();return a.isEmpty()?null:new yS(this.firestore,null,new X0(a))}withConverter(a){return new DX(this.firestore,a,this._path)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RZ="AsyncQueue";class CZ{constructor(a=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Vfe(this,"async_queue_retry"),this._c=()=>{const _=kq();_&&EE(RZ,"Visibility state changed to "+_.visibilityState),this.M_.w_()},this.ac=a;const h=kq();h&&typeof h.addEventListener=="function"&&h.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(a){this.enqueue(a)}enqueueAndForgetEvenWhileRestricted(a){this.uc(),this.cc(a)}enterRestrictedMode(a){if(!this.ec){this.ec=!0,this.sc=a||!1;const h=kq();h&&typeof h.removeEventListener=="function"&&h.removeEventListener("visibilitychange",this._c)}}enqueue(a){if(this.uc(),this.ec)return new Promise((()=>{}));const h=new Hj;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(a().then(h.resolve,h.reject),h.promise))).then((()=>h.promise))}enqueueRetryable(a){this.enqueueAndForget((()=>(this.Xu.push(a),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(a){if(!Pfe(a))throw a;EE(RZ,"Operation failed with retryable error: "+a)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(a){const h=this.ac.then((()=>(this.rc=!0,a().catch((_=>{throw this.nc=_,this.rc=!1,pte("INTERNAL UNHANDLED ERROR: ",bZ(_)),_})).then((_=>(this.rc=!1,_))))));return this.ac=h,h}enqueueAfterDelay(a,h,_){this.uc(),this.oc.indexOf(a)>-1&&(h=0);const S=OX.createAndSchedule(this,a,h,_,(y=>this.hc(y)));return this.tc.push(S),S}uc(){this.nc&&c3(47125,{Pc:bZ(this.nc)})}verifyOperationInProgress(){}async Tc(){let a;do a=this.ac,await a;while(a!==this.ac)}Ic(a){for(const h of this.tc)if(h.timerId===a)return!0;return!1}Ec(a){return this.Tc().then((()=>{this.tc.sort(((h,_)=>h.targetTimeMs-_.targetTimeMs));for(const h of this.tc)if(h.skipDelay(),a!=="all"&&h.timerId===a)break;return this.Tc()}))}dc(a){this.oc.push(a)}hc(a){const h=this.tc.indexOf(a);this.tc.splice(h,1)}}function bZ(l){let a=l.message||"";return l.stack&&(a=l.stack.includes(l.message)?l.stack:l.message+`
`+l.stack),a}class jfe extends Ete{constructor(a,h,_,S){super(a,h,_,S),this.type="firestore",this._queue=new CZ,this._persistenceKey=S?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const a=this._firestoreClient.terminate();this._queue=new CZ(a),this._firestoreClient=void 0,await a}}}function Gfe(l,a){const h=typeof l=="object"?l:IX(),_=typeof l=="string"?l:E7,S=RW(h,"firestore").getImmediate({identifier:_});if(!S._initialized){const y=nte("firestore");y&&Bfe(S,...y)}return S}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ey{constructor(a){this._byteString=a}static fromBase64String(a){try{return new ey(nO.fromBase64String(a))}catch(h){throw new ns(ts.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+h)}}static fromUint8Array(a){return new ey(nO.fromUint8Array(a))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(a){return this._byteString.isEqual(a._byteString)}toJSON(){return{type:ey._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(a){if(N3(a,ey._jsonSchema))return ey.fromBase64String(a.bytes)}}ey._jsonSchemaVersion="firestore/bytes/1.0",ey._jsonSchema={type:Oc("string",ey._jsonSchemaVersion),bytes:Oc("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gte{constructor(...a){for(let h=0;h<a.length;++h)if(a[h].length===0)throw new ns(ts.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new z0(a)}isEqual(a){return this._internalPath.isEqual(a._internalPath)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z0{constructor(a,h){if(!isFinite(a)||a<-90||a>90)throw new ns(ts.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+a);if(!isFinite(h)||h<-180||h>180)throw new ns(ts.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+h);this._lat=a,this._long=h}get latitude(){return this._lat}get longitude(){return this._long}isEqual(a){return this._lat===a._lat&&this._long===a._long}_compareTo(a){return Ub(this._lat,a._lat)||Ub(this._long,a._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Z0._jsonSchemaVersion}}static fromJSON(a){if(N3(a,Z0._jsonSchema))return new Z0(a.latitude,a.longitude)}}Z0._jsonSchemaVersion="firestore/geoPoint/1.0",Z0._jsonSchema={type:Oc("string",Z0._jsonSchemaVersion),latitude:Oc("number"),longitude:Oc("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $0{constructor(a){this._values=(a||[]).map((h=>h))}toArray(){return this._values.map((a=>a))}isEqual(a){return(function(_,S){if(_.length!==S.length)return!1;for(let y=0;y<_.length;++y)if(_[y]!==S[y])return!1;return!0})(this._values,a._values)}toJSON(){return{type:$0._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(a){if(N3(a,$0._jsonSchema)){if(Array.isArray(a.vectorValues)&&a.vectorValues.every((h=>typeof h=="number")))return new $0(a.vectorValues);throw new ns(ts.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}$0._jsonSchemaVersion="firestore/vectorValue/1.0",$0._jsonSchema={type:Oc("string",$0._jsonSchemaVersion),vectorValues:Oc("object")};const Wfe=new RegExp("[~\\*/\\[\\]]");function Hfe(l,a,h){if(a.search(Wfe)>=0)throw IZ(`Invalid field path (${a}). Paths must not contain '~', '*', '/', '[', or ']'`,l);try{return new gte(...a.split("."))._internalPath}catch{throw IZ(`Invalid field path (${a}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,l)}}function IZ(l,a,h,_,S){let y=`Function ${a}() called with invalid data`;y+=". ";let b="";return new ns(ts.INVALID_ARGUMENT,y+l+b)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ste{constructor(a,h,_,S,y){this._firestore=a,this._userDataWriter=h,this._key=_,this._document=S,this._converter=y}get id(){return this._key.path.lastSegment()}get ref(){return new yS(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const a=new Kfe(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(a)}return this._userDataWriter.convertValue(this._document.data.value)}}get(a){if(this._document){const h=this._document.data.field(Tte("DocumentSnapshot.get",a));if(h!==null)return this._userDataWriter.convertValue(h)}}}class Kfe extends Ste{data(){return super.data()}}function Tte(l,a){return typeof a=="string"?Hfe(l,a):a instanceof gte?a._internalPath:a._delegate._internalPath}class Q6{constructor(a,h){this.hasPendingWrites=a,this.fromCache=h}isEqual(a){return this.hasPendingWrites===a.hasPendingWrites&&this.fromCache===a.fromCache}}class Mk extends Ste{constructor(a,h,_,S,y,b){super(a,h,_,S,b),this._firestore=a,this._firestoreImpl=a,this.metadata=y}exists(){return super.exists()}data(a={}){if(this._document){if(this._converter){const h=new cG(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(h,a)}return this._userDataWriter.convertValue(this._document.data.value,a.serverTimestamps)}}get(a,h={}){if(this._document){const _=this._document.data.field(Tte("DocumentSnapshot.get",a));if(_!==null)return this._userDataWriter.convertValue(_,h.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new ns(ts.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const a=this._document,h={};return h.type=Mk._jsonSchemaVersion,h.bundle="",h.bundleSource="DocumentSnapshot",h.bundleName=this._key.toString(),!a||!a.isValidDocument()||!a.isFoundDocument()?h:(this._userDataWriter.convertObjectMap(a.data.value.mapValue.fields,"previous"),h.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),h)}}Mk._jsonSchemaVersion="firestore/documentSnapshot/1.0",Mk._jsonSchema={type:Oc("string",Mk._jsonSchemaVersion),bundleSource:Oc("string","DocumentSnapshot"),bundleName:Oc("string"),bundle:Oc("string")};class cG extends Mk{data(a={}){return super.data(a)}}class Kj{constructor(a,h,_,S){this._firestore=a,this._userDataWriter=h,this._snapshot=S,this.metadata=new Q6(S.hasPendingWrites,S.fromCache),this.query=_}get docs(){const a=[];return this.forEach((h=>a.push(h))),a}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(a,h){this._snapshot.docs.forEach((_=>{a.call(h,new cG(this._firestore,this._userDataWriter,_.key,_,new Q6(this._snapshot.mutatedKeys.has(_.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(a={}){const h=!!a.includeMetadataChanges;if(h&&this._snapshot.excludesMetadataChanges)throw new ns(ts.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===h||(this._cachedChanges=(function(S,y){if(S._snapshot.oldDocs.isEmpty()){let b=0;return S._snapshot.docChanges.map((D=>{const U=new cG(S._firestore,S._userDataWriter,D.doc.key,D.doc,new Q6(S._snapshot.mutatedKeys.has(D.doc.key),S._snapshot.fromCache),S.query.converter);return D.doc,{type:"added",doc:U,oldIndex:-1,newIndex:b++}}))}{let b=S._snapshot.oldDocs;return S._snapshot.docChanges.filter((D=>y||D.type!==3)).map((D=>{const U=new cG(S._firestore,S._userDataWriter,D.doc.key,D.doc,new Q6(S._snapshot.mutatedKeys.has(D.doc.key),S._snapshot.fromCache),S.query.converter);let x=-1,q=-1;return D.type!==0&&(x=b.indexOf(D.doc.key),b=b.delete(D.doc.key)),D.type!==1&&(b=b.add(D.doc),q=b.indexOf(D.doc.key)),{type:zfe(D.type),doc:U,oldIndex:x,newIndex:q}}))}})(this,h),this._cachedChangesIncludeMetadataChanges=h),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new ns(ts.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const a={};a.type=Kj._jsonSchemaVersion,a.bundleSource="QuerySnapshot",a.bundleName=Rfe.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const h=[],_=[],S=[];return this.docs.forEach((y=>{y._document!==null&&(h.push(y._document),_.push(this._userDataWriter.convertObjectMap(y._document.data.value.mapValue.fields,"previous")),S.push(y.ref.path))})),a.bundle=(this._firestore,this.query._query,a.bundleName,"NOT SUPPORTED"),a}}function zfe(l){switch(l){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return c3(61501,{type:l})}}Kj._jsonSchemaVersion="firestore/querySnapshot/1.0",Kj._jsonSchema={type:Oc("string",Kj._jsonSchemaVersion),bundleSource:Oc("string","QuerySnapshot"),bundleName:Oc("string"),bundle:Oc("string")};(function(a,h=!0){(function(S){O3=S})(dO),tO(new Mb("firestore",((_,{instanceIdentifier:S,options:y})=>{const b=_.getProvider("app").getImmediate(),D=new jfe(new gfe(_.getProvider("auth-internal")),new vfe(b,_.getProvider("app-check-internal")),(function(x,q){if(!Object.prototype.hasOwnProperty.apply(x.options,["projectId"]))throw new ns(ts.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new NG(x.options.projectId,q)})(b,S),b);return y={useFetchStreams:h,...y},D._setSettings(y),D}),"PUBLIC").setMultipleInstances(!0)),IS(uZ,hZ,a),IS(uZ,hZ,"esm2020")})();var AZ={};const wZ="@firebase/database",OZ="1.1.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vte="";function Yfe(l){vte=l}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qfe{constructor(a){this.domStorage_=a,this.prefix_="firebase:"}set(a,h){h==null?this.domStorage_.removeItem(this.prefixedName_(a)):this.domStorage_.setItem(this.prefixedName_(a),wl(h))}get(a){const h=this.domStorage_.getItem(this.prefixedName_(a));return h==null?null:o3(h)}remove(a){this.domStorage_.removeItem(this.prefixedName_(a))}prefixedName_(a){return this.prefix_+a}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xfe{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(a,h){h==null?delete this.cache_[a]:this.cache_[a]=h}get(a){return Ey(this.cache_,a)?this.cache_[a]:null}remove(a){delete this.cache_[a]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yte=function(l){try{if(typeof window<"u"&&typeof window[l]<"u"){const a=window[l];return a.setItem("firebase:sentinel","cache"),a.removeItem("firebase:sentinel"),new qfe(a)}}catch{}return new Xfe},J0=yte("localStorage"),Jfe=yte("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uk=new yW("@firebase/database"),Qfe=(function(){let l=1;return function(){return l++}})(),Rte=function(l){const a=rpe(l),h=new epe;h.update(a);const _=h.digest();return SX.encodeByteArray(_)},D3=function(...l){let a="";for(let h=0;h<l.length;h++){const _=l[h];Array.isArray(_)||_&&typeof _=="object"&&typeof _.length=="number"?a+=D3.apply(null,_):typeof _=="object"?a+=wl(_):a+=_,a+=" "}return a};let zj=null,NZ=!0;const Zfe=function(l,a){Xt(!0,"Can't turn on custom loggers persistently."),Uk.logLevel=Ls.VERBOSE,zj=Uk.log.bind(Uk)},Hd=function(...l){if(NZ===!0&&(NZ=!1,zj===null&&Jfe.get("logging_enabled")===!0&&Zfe()),zj){const a=D3.apply(null,l);zj(a)}},P3=function(l){return function(...a){Hd(l,...a)}},g7=function(...l){const a="FIREBASE INTERNAL ERROR: "+D3(...l);Uk.error(a)},uy=function(...l){const a=`FIREBASE FATAL ERROR: ${D3(...l)}`;throw Uk.error(a),new Error(a)},jh=function(...l){const a="FIREBASE WARNING: "+D3(...l);Uk.warn(a)},$fe=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&jh("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Cte=function(l){return typeof l=="number"&&(l!==l||l===Number.POSITIVE_INFINITY||l===Number.NEGATIVE_INFINITY)},e_e=function(l){if(document.readyState==="complete")l();else{let a=!1;const h=function(){if(!document.body){setTimeout(h,Math.floor(10));return}a||(a=!0,l())};document.addEventListener?(document.addEventListener("DOMContentLoaded",h,!1),window.addEventListener("load",h,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&h()}),window.attachEvent("onload",h))}},zk="[MIN_NAME]",iO="[MAX_NAME]",iL=function(l,a){if(l===a)return 0;if(l===zk||a===iO)return-1;if(a===zk||l===iO)return 1;{const h=DZ(l),_=DZ(a);return h!==null?_!==null?h-_===0?l.length-a.length:h-_:-1:_!==null?1:l<a?-1:1}},t_e=function(l,a){return l===a?0:l<a?-1:1},Oj=function(l,a){if(a&&l in a)return a[l];throw new Error("Missing required key ("+l+") in object: "+wl(a))},PX=function(l){if(typeof l!="object"||l===null)return wl(l);const a=[];for(const _ in l)a.push(_);a.sort();let h="{";for(let _=0;_<a.length;_++)_!==0&&(h+=","),h+=wl(a[_]),h+=":",h+=PX(l[a[_]]);return h+="}",h},bte=function(l,a){const h=l.length;if(h<=a)return[l];const _=[];for(let S=0;S<h;S+=a)S+a>h?_.push(l.substring(S,h)):_.push(l.substring(S,S+a));return _};function Wh(l,a){for(const h in l)l.hasOwnProperty(h)&&a(h,l[h])}const Ite=function(l){Xt(!Cte(l),"Invalid JSON number");const a=11,h=52,_=(1<<a-1)-1;let S,y,b,D,U;l===0?(y=0,b=0,S=1/l===-1/0?1:0):(S=l<0,l=Math.abs(l),l>=Math.pow(2,1-_)?(D=Math.min(Math.floor(Math.log(l)/Math.LN2),_),y=D+_,b=Math.round(l*Math.pow(2,h-D)-Math.pow(2,h))):(y=0,b=Math.round(l/Math.pow(2,1-_-h))));const x=[];for(U=h;U;U-=1)x.push(b%2?1:0),b=Math.floor(b/2);for(U=a;U;U-=1)x.push(y%2?1:0),y=Math.floor(y/2);x.push(S?1:0),x.reverse();const q=x.join("");let J="";for(U=0;U<64;U+=8){let ee=parseInt(q.substr(U,8),2).toString(16);ee.length===1&&(ee="0"+ee),J=J+ee}return J.toLowerCase()},n_e=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},i_e=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function r_e(l,a){let h="Unknown Error";l==="too_big"?h="The data requested exceeds the maximum size that can be accessed with a single request.":l==="permission_denied"?h="Client doesn't have permission to access the desired data.":l==="unavailable"&&(h="The service is unavailable");const _=new Error(l+" at "+a._path.toString()+": "+h);return _.code=l.toUpperCase(),_}const s_e=new RegExp("^-?(0*)\\d{1,10}$"),o_e=-2147483648,a_e=2147483647,DZ=function(l){if(s_e.test(l)){const a=Number(l);if(a>=o_e&&a<=a_e)return a}return null},rL=function(l){try{l()}catch(a){setTimeout(()=>{const h=a.stack||"";throw jh("Exception was thrown by user callback.",h),a},Math.floor(0))}},c_e=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Yj=function(l,a){const h=setTimeout(l,a);return typeof h=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(h):typeof h=="object"&&h.unref&&h.unref(),h};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l_e{constructor(a,h){this.appCheckProvider=h,this.appName=a.name,fE(a)&&a.settings.appCheckToken&&(this.serverAppAppCheckToken=a.settings.appCheckToken),this.appCheck=h?.getImmediate({optional:!0}),this.appCheck||h?.get().then(_=>this.appCheck=_)}getToken(a){if(this.serverAppAppCheckToken){if(a)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(a):new Promise((h,_)=>{setTimeout(()=>{this.appCheck?this.getToken(a).then(h,_):h(null)},0)})}addTokenChangeListener(a){this.appCheckProvider?.get().then(h=>h.addTokenListener(a))}notifyForInvalidToken(){jh(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d_e{constructor(a,h,_){this.appName_=a,this.firebaseOptions_=h,this.authProvider_=_,this.auth_=null,this.auth_=_.getImmediate({optional:!0}),this.auth_||_.onInit(S=>this.auth_=S)}getToken(a){return this.auth_?this.auth_.getToken(a).catch(h=>h&&h.code==="auth/token-not-initialized"?(Hd("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(h)):new Promise((h,_)=>{setTimeout(()=>{this.auth_?this.getToken(a).then(h,_):h(null)},0)})}addTokenChangeListener(a){this.auth_?this.auth_.addAuthTokenListener(a):this.authProvider_.get().then(h=>h.addAuthTokenListener(a))}removeTokenChangeListener(a){this.authProvider_.get().then(h=>h.removeAuthTokenListener(a))}notifyForInvalidToken(){let a='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?a+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?a+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':a+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',jh(a)}}class lG{constructor(a){this.accessToken=a}getToken(a){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(a){a(this.accessToken)}removeTokenChangeListener(a){}notifyForInvalidToken(){}}lG.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kX="5",Ate="v",wte="s",Ote="r",Nte="f",Dte=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Pte="ls",kte="p",S7="ac",Lte="websocket",Mte="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ute{constructor(a,h,_,S,y=!1,b="",D=!1,U=!1,x=null){this.secure=h,this.namespace=_,this.webSocketOnly=S,this.nodeAdmin=y,this.persistenceKey=b,this.includeNamespaceInQueryParams=D,this.isUsingEmulator=U,this.emulatorOptions=x,this._host=a.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=J0.get("host:"+a)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(a){a!==this.internalHost&&(this.internalHost=a,this.isCacheableHost()&&J0.set("host:"+this._host,this.internalHost))}toString(){let a=this.toURLString();return this.persistenceKey&&(a+="<"+this.persistenceKey+">"),a}toURLString(){const a=this.secure?"https://":"http://",h=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${a}${this.host}/${h}`}}function u_e(l){return l.host!==l.internalHost||l.isCustomHost()||l.includeNamespaceInQueryParams}function xte(l,a,h){Xt(typeof a=="string","typeof type must == string"),Xt(typeof h=="object","typeof params must == object");let _;if(a===Lte)_=(l.secure?"wss://":"ws://")+l.internalHost+"/.ws?";else if(a===Mte)_=(l.secure?"https://":"http://")+l.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+a);u_e(l)&&(h.ns=l.namespace);const S=[];return Wh(h,(y,b)=>{S.push(y+"="+b)}),_+S.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h_e{constructor(){this.counters_={}}incrementCounter(a,h=1){Ey(this.counters_,a)||(this.counters_[a]=0),this.counters_[a]+=h}get(){return Mhe(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lq={},Mq={};function LX(l){const a=l.toString();return Lq[a]||(Lq[a]=new h_e),Lq[a]}function p_e(l,a){const h=l.toString();return Mq[h]||(Mq[h]=a()),Mq[h]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f_e{constructor(a){this.onMessage_=a,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(a,h){this.closeAfterResponse=a,this.onClose=h,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(a,h){for(this.pendingResponses[a]=h;this.pendingResponses[this.currentResponseNum];){const _=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let S=0;S<_.length;++S)_[S]&&rL(()=>{this.onMessage_(_[S])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PZ="start",__e="close",m_e="pLPCommand",E_e="pRTLPCB",Vte="id",Fte="pw",Bte="ser",g_e="cb",S_e="seg",T_e="ts",v_e="d",y_e="dframe",jte=1870,Gte=30,R_e=jte-Gte,C_e=25e3,b_e=3e4;class Dk{constructor(a,h,_,S,y,b,D){this.connId=a,this.repoInfo=h,this.applicationId=_,this.appCheckToken=S,this.authToken=y,this.transportSessionId=b,this.lastSessionId=D,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=P3(a),this.stats_=LX(h),this.urlFn=U=>(this.appCheckToken&&(U[S7]=this.appCheckToken),xte(h,Mte,U))}open(a,h){this.curSegmentNum=0,this.onDisconnect_=h,this.myPacketOrderer=new f_e(a),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(b_e)),e_e(()=>{if(this.isClosed_)return;this.scriptTagHolder=new MX((...y)=>{const[b,D,U,x,q]=y;if(this.incrementIncomingBytes_(y),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,b===PZ)this.id=D,this.password=U;else if(b===__e)D?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(D,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+b)},(...y)=>{const[b,D]=y;this.incrementIncomingBytes_(y),this.myPacketOrderer.handleResponse(b,D)},()=>{this.onClosed_()},this.urlFn);const _={};_[PZ]="t",_[Bte]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(_[g_e]=this.scriptTagHolder.uniqueCallbackIdentifier),_[Ate]=kX,this.transportSessionId&&(_[wte]=this.transportSessionId),this.lastSessionId&&(_[Pte]=this.lastSessionId),this.applicationId&&(_[kte]=this.applicationId),this.appCheckToken&&(_[S7]=this.appCheckToken),typeof location<"u"&&location.hostname&&Dte.test(location.hostname)&&(_[Ote]=Nte);const S=this.urlFn(_);this.log_("Connecting via long-poll to "+S),this.scriptTagHolder.addTag(S,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Dk.forceAllow_=!0}static forceDisallow(){Dk.forceDisallow_=!0}static isAvailable(){return Dk.forceAllow_?!0:!Dk.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!n_e()&&!i_e()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(a){const h=wl(a);this.bytesSent+=h.length,this.stats_.incrementCounter("bytes_sent",h.length);const _=$ee(h),S=bte(_,R_e);for(let y=0;y<S.length;y++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,S.length,S[y]),this.curSegmentNum++}addDisconnectPingFrame(a,h){this.myDisconnFrame=document.createElement("iframe");const _={};_[y_e]="t",_[Vte]=a,_[Fte]=h,this.myDisconnFrame.src=this.urlFn(_),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(a){const h=wl(a).length;this.bytesReceived+=h,this.stats_.incrementCounter("bytes_received",h)}}class MX{constructor(a,h,_,S){this.onDisconnect=_,this.urlFn=S,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Qfe(),window[m_e+this.uniqueCallbackIdentifier]=a,window[E_e+this.uniqueCallbackIdentifier]=h,this.myIFrame=MX.createIFrame_();let y="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(y='<script>document.domain="'+document.domain+'";<\/script>');const b="<html><body>"+y+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(b),this.myIFrame.doc.close()}catch(D){Hd("frame writing exception"),D.stack&&Hd(D.stack),Hd(D)}}}static createIFrame_(){const a=document.createElement("iframe");if(a.style.display="none",document.body){document.body.appendChild(a);try{a.contentWindow.document||Hd("No IE domain setting required")}catch{const _=document.domain;a.src="javascript:void((function(){document.open();document.domain='"+_+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return a.contentDocument?a.doc=a.contentDocument:a.contentWindow?a.doc=a.contentWindow.document:a.document&&(a.doc=a.document),a}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const a=this.onDisconnect;a&&(this.onDisconnect=null,a())}startLongPoll(a,h){for(this.myID=a,this.myPW=h,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const a={};a[Vte]=this.myID,a[Fte]=this.myPW,a[Bte]=this.currentSerial;let h=this.urlFn(a),_="",S=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Gte+_.length<=jte;){const b=this.pendingSegs.shift();_=_+"&"+S_e+S+"="+b.seg+"&"+T_e+S+"="+b.ts+"&"+v_e+S+"="+b.d,S++}return h=h+_,this.addLongPollTag_(h,this.currentSerial),!0}else return!1}enqueueSegment(a,h,_){this.pendingSegs.push({seg:a,ts:h,d:_}),this.alive&&this.newRequest_()}addLongPollTag_(a,h){this.outstandingRequests.add(h);const _=()=>{this.outstandingRequests.delete(h),this.newRequest_()},S=setTimeout(_,Math.floor(C_e)),y=()=>{clearTimeout(S),_()};this.addTag(a,y)}addTag(a,h){setTimeout(()=>{try{if(!this.sendNewPolls)return;const _=this.myIFrame.doc.createElement("script");_.type="text/javascript",_.async=!0,_.src=a,_.onload=_.onreadystatechange=function(){const S=_.readyState;(!S||S==="loaded"||S==="complete")&&(_.onload=_.onreadystatechange=null,_.parentNode&&_.parentNode.removeChild(_),h())},_.onerror=()=>{Hd("Long-poll script failed to load: "+a),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(_)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I_e=16384,A_e=45e3;let DG=null;typeof MozWebSocket<"u"?DG=MozWebSocket:typeof WebSocket<"u"&&(DG=WebSocket);class _E{constructor(a,h,_,S,y,b,D){this.connId=a,this.applicationId=_,this.appCheckToken=S,this.authToken=y,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=P3(this.connId),this.stats_=LX(h),this.connURL=_E.connectionURL_(h,b,D,S,_),this.nodeAdmin=h.nodeAdmin}static connectionURL_(a,h,_,S,y){const b={};return b[Ate]=kX,typeof location<"u"&&location.hostname&&Dte.test(location.hostname)&&(b[Ote]=Nte),h&&(b[wte]=h),_&&(b[Pte]=_),S&&(b[S7]=S),y&&(b[kte]=y),xte(a,Lte,b)}open(a,h){this.onDisconnect=h,this.onMessage=a,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,J0.set("previous_websocket_failure",!0);try{let _;zhe(),this.mySock=new DG(this.connURL,[],_)}catch(_){this.log_("Error instantiating WebSocket.");const S=_.message||_.data;S&&this.log_(S),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=_=>{this.handleIncomingFrame(_)},this.mySock.onerror=_=>{this.log_("WebSocket error.  Closing connection.");const S=_.message||_.data;S&&this.log_(S),this.onClosed_()}}start(){}static forceDisallow(){_E.forceDisallow_=!0}static isAvailable(){let a=!1;if(typeof navigator<"u"&&navigator.userAgent){const h=/Android ([0-9]{0,}\.[0-9]{0,})/,_=navigator.userAgent.match(h);_&&_.length>1&&parseFloat(_[1])<4.4&&(a=!0)}return!a&&DG!==null&&!_E.forceDisallow_}static previouslyFailed(){return J0.isInMemoryStorage||J0.get("previous_websocket_failure")===!0}markConnectionHealthy(){J0.remove("previous_websocket_failure")}appendFrame_(a){if(this.frames.push(a),this.frames.length===this.totalFrames){const h=this.frames.join("");this.frames=null;const _=o3(h);this.onMessage(_)}}handleNewFrameCount_(a){this.totalFrames=a,this.frames=[]}extractFrameCount_(a){if(Xt(this.frames===null,"We already have a frame buffer"),a.length<=6){const h=Number(a);if(!isNaN(h))return this.handleNewFrameCount_(h),null}return this.handleNewFrameCount_(1),a}handleIncomingFrame(a){if(this.mySock===null)return;const h=a.data;if(this.bytesReceived+=h.length,this.stats_.incrementCounter("bytes_received",h.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(h);else{const _=this.extractFrameCount_(h);_!==null&&this.appendFrame_(_)}}send(a){this.resetKeepAlive();const h=wl(a);this.bytesSent+=h.length,this.stats_.incrementCounter("bytes_sent",h.length);const _=bte(h,I_e);_.length>1&&this.sendString_(String(_.length));for(let S=0;S<_.length;S++)this.sendString_(_[S])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(A_e))}sendString_(a){try{this.mySock.send(a)}catch(h){this.log_("Exception thrown from WebSocket.send():",h.message||h.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}_E.responsesRequiredToBeHealthy=2;_E.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l3{static get ALL_TRANSPORTS(){return[Dk,_E]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(a){this.initTransports_(a)}initTransports_(a){const h=_E&&_E.isAvailable();let _=h&&!_E.previouslyFailed();if(a.webSocketOnly&&(h||jh("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),_=!0),_)this.transports_=[_E];else{const S=this.transports_=[];for(const y of l3.ALL_TRANSPORTS)y&&y.isAvailable()&&S.push(y);l3.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}l3.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w_e=6e4,O_e=5e3,N_e=10*1024,D_e=100*1024,Uq="t",kZ="d",P_e="s",LZ="r",k_e="e",MZ="o",UZ="a",xZ="n",VZ="p",L_e="h";class M_e{constructor(a,h,_,S,y,b,D,U,x,q){this.id=a,this.repoInfo_=h,this.applicationId_=_,this.appCheckToken_=S,this.authToken_=y,this.onMessage_=b,this.onReady_=D,this.onDisconnect_=U,this.onKill_=x,this.lastSessionId=q,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=P3("c:"+this.id+":"),this.transportManager_=new l3(h),this.log_("Connection created"),this.start_()}start_(){const a=this.transportManager_.initialTransport();this.conn_=new a(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=a.responsesRequiredToBeHealthy||0;const h=this.connReceiver_(this.conn_),_=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(h,_)},Math.floor(0));const S=a.healthyTimeout||0;S>0&&(this.healthyTimeout_=Yj(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>D_e?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>N_e?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(S)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(a){return h=>{a===this.conn_?this.onConnectionLost_(h):a===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(a){return h=>{this.state_!==2&&(a===this.rx_?this.onPrimaryMessageReceived_(h):a===this.secondaryConn_?this.onSecondaryMessageReceived_(h):this.log_("message on old connection"))}}sendRequest(a){const h={t:"d",d:a};this.sendData_(h)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(a){if(Uq in a){const h=a[Uq];h===UZ?this.upgradeIfSecondaryHealthy_():h===LZ?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):h===MZ&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(a){const h=Oj("t",a),_=Oj("d",a);if(h==="c")this.onSecondaryControl_(_);else if(h==="d")this.pendingDataMessages.push(_);else throw new Error("Unknown protocol layer: "+h)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:VZ,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:UZ,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:xZ,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(a){const h=Oj("t",a),_=Oj("d",a);h==="c"?this.onControl_(_):h==="d"&&this.onDataMessage_(_)}onDataMessage_(a){this.onPrimaryResponse_(),this.onMessage_(a)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(a){const h=Oj(Uq,a);if(kZ in a){const _=a[kZ];if(h===L_e){const S={..._};this.repoInfo_.isUsingEmulator&&(S.h=this.repoInfo_.host),this.onHandshake_(S)}else if(h===xZ){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let S=0;S<this.pendingDataMessages.length;++S)this.onDataMessage_(this.pendingDataMessages[S]);this.pendingDataMessages=[],this.tryCleanupConnection()}else h===P_e?this.onConnectionShutdown_(_):h===LZ?this.onReset_(_):h===k_e?g7("Server Error: "+_):h===MZ?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):g7("Unknown control packet command: "+h)}}onHandshake_(a){const h=a.ts,_=a.v,S=a.h;this.sessionId=a.s,this.repoInfo_.host=S,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,h),kX!==_&&jh("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const a=this.transportManager_.upgradeTransport();a&&this.startUpgrade_(a)}startUpgrade_(a){this.secondaryConn_=new a(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=a.responsesRequiredToBeHealthy||0;const h=this.connReceiver_(this.secondaryConn_),_=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(h,_),Yj(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(w_e))}onReset_(a){this.log_("Reset packet received.  New host: "+a),this.repoInfo_.host=a,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(a,h){this.log_("Realtime connection established."),this.conn_=a,this.state_=1,this.onReady_&&(this.onReady_(h,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Yj(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(O_e))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:VZ,d:{}}}))}onSecondaryConnectionLost_(){const a=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===a||this.rx_===a)&&this.close()}onConnectionLost_(a){this.conn_=null,!a&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(J0.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(a){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(a),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(a){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(a)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wte{put(a,h,_,S){}merge(a,h,_,S){}refreshAuthToken(a){}refreshAppCheckToken(a){}onDisconnectPut(a,h,_){}onDisconnectMerge(a,h,_){}onDisconnectCancel(a,h){}reportStats(a){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hte{constructor(a){this.allowedEvents_=a,this.listeners_={},Xt(Array.isArray(a)&&a.length>0,"Requires a non-empty array")}trigger(a,...h){if(Array.isArray(this.listeners_[a])){const _=[...this.listeners_[a]];for(let S=0;S<_.length;S++)_[S].callback.apply(_[S].context,h)}}on(a,h,_){this.validateEventType_(a),this.listeners_[a]=this.listeners_[a]||[],this.listeners_[a].push({callback:h,context:_});const S=this.getInitialEvent(a);S&&h.apply(_,S)}off(a,h,_){this.validateEventType_(a);const S=this.listeners_[a]||[];for(let y=0;y<S.length;y++)if(S[y].callback===h&&(!_||_===S[y].context)){S.splice(y,1);return}}validateEventType_(a){Xt(this.allowedEvents_.find(h=>h===a),"Unknown event: "+a)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PG extends Hte{static getInstance(){return new PG}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!RX()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(a){return Xt(a==="online","Unknown event type: "+a),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FZ=32,BZ=768;class yo{constructor(a,h){if(h===void 0){this.pieces_=a.split("/");let _=0;for(let S=0;S<this.pieces_.length;S++)this.pieces_[S].length>0&&(this.pieces_[_]=this.pieces_[S],_++);this.pieces_.length=_,this.pieceNum_=0}else this.pieces_=a,this.pieceNum_=h}toString(){let a="";for(let h=this.pieceNum_;h<this.pieces_.length;h++)this.pieces_[h]!==""&&(a+="/"+this.pieces_[h]);return a||"/"}}function Ms(){return new yo("")}function Ir(l){return l.pieceNum_>=l.pieces_.length?null:l.pieces_[l.pieceNum_]}function xb(l){return l.pieces_.length-l.pieceNum_}function Vo(l){let a=l.pieceNum_;return a<l.pieces_.length&&a++,new yo(l.pieces_,a)}function Kte(l){return l.pieceNum_<l.pieces_.length?l.pieces_[l.pieces_.length-1]:null}function U_e(l){let a="";for(let h=l.pieceNum_;h<l.pieces_.length;h++)l.pieces_[h]!==""&&(a+="/"+encodeURIComponent(String(l.pieces_[h])));return a||"/"}function zte(l,a=0){return l.pieces_.slice(l.pieceNum_+a)}function Yte(l){if(l.pieceNum_>=l.pieces_.length)return null;const a=[];for(let h=l.pieceNum_;h<l.pieces_.length-1;h++)a.push(l.pieces_[h]);return new yo(a,0)}function Jc(l,a){const h=[];for(let _=l.pieceNum_;_<l.pieces_.length;_++)h.push(l.pieces_[_]);if(a instanceof yo)for(let _=a.pieceNum_;_<a.pieces_.length;_++)h.push(a.pieces_[_]);else{const _=a.split("/");for(let S=0;S<_.length;S++)_[S].length>0&&h.push(_[S])}return new yo(h,0)}function xr(l){return l.pieceNum_>=l.pieces_.length}function Fh(l,a){const h=Ir(l),_=Ir(a);if(h===null)return a;if(h===_)return Fh(Vo(l),Vo(a));throw new Error("INTERNAL ERROR: innerPath ("+a+") is not within outerPath ("+l+")")}function UX(l,a){if(xb(l)!==xb(a))return!1;for(let h=l.pieceNum_,_=a.pieceNum_;h<=l.pieces_.length;h++,_++)if(l.pieces_[h]!==a.pieces_[_])return!1;return!0}function gE(l,a){let h=l.pieceNum_,_=a.pieceNum_;if(xb(l)>xb(a))return!1;for(;h<l.pieces_.length;){if(l.pieces_[h]!==a.pieces_[_])return!1;++h,++_}return!0}class x_e{constructor(a,h){this.errorPrefix_=h,this.parts_=zte(a,0),this.byteLength_=Math.max(1,this.parts_.length);for(let _=0;_<this.parts_.length;_++)this.byteLength_+=vW(this.parts_[_]);qte(this)}}function V_e(l,a){l.parts_.length>0&&(l.byteLength_+=1),l.parts_.push(a),l.byteLength_+=vW(a),qte(l)}function F_e(l){const a=l.parts_.pop();l.byteLength_-=vW(a),l.parts_.length>0&&(l.byteLength_-=1)}function qte(l){if(l.byteLength_>BZ)throw new Error(l.errorPrefix_+"has a key path longer than "+BZ+" bytes ("+l.byteLength_+").");if(l.parts_.length>FZ)throw new Error(l.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+FZ+") or object contains a cycle "+W0(l))}function W0(l){return l.parts_.length===0?"":"in property '"+l.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xX extends Hte{static getInstance(){return new xX}constructor(){super(["visible"]);let a,h;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(h="visibilitychange",a="hidden"):typeof document.mozHidden<"u"?(h="mozvisibilitychange",a="mozHidden"):typeof document.msHidden<"u"?(h="msvisibilitychange",a="msHidden"):typeof document.webkitHidden<"u"&&(h="webkitvisibilitychange",a="webkitHidden")),this.visible_=!0,h&&document.addEventListener(h,()=>{const _=!document[a];_!==this.visible_&&(this.visible_=_,this.trigger("visible",_))},!1)}getInitialEvent(a){return Xt(a==="visible","Unknown event type: "+a),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nj=1e3,B_e=300*1e3,jZ=30*1e3,j_e=1.3,G_e=3e4,W_e="server_kill",GZ=3;class sy extends Wte{constructor(a,h,_,S,y,b,D,U){if(super(),this.repoInfo_=a,this.applicationId_=h,this.onDataUpdate_=_,this.onConnectStatus_=S,this.onServerInfoUpdate_=y,this.authTokenProvider_=b,this.appCheckTokenProvider_=D,this.authOverride_=U,this.id=sy.nextPersistentConnectionId_++,this.log_=P3("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Nj,this.maxReconnectDelay_=B_e,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,U)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");xX.getInstance().on("visible",this.onVisible_,this),a.host.indexOf("fblocal")===-1&&PG.getInstance().on("online",this.onOnline_,this)}sendRequest(a,h,_){const S=++this.requestNumber_,y={r:S,a,b:h};this.log_(wl(y)),Xt(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(y),_&&(this.requestCBHash_[S]=_)}get(a){this.initConnection_();const h=new TW,S={action:"g",request:{p:a._path.toString(),q:a._queryObject},onComplete:b=>{const D=b.d;b.s==="ok"?h.resolve(D):h.reject(D)}};this.outstandingGets_.push(S),this.outstandingGetCount_++;const y=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(y),h.promise}listen(a,h,_,S){this.initConnection_();const y=a._queryIdentifier,b=a._path.toString();this.log_("Listen called for "+b+" "+y),this.listens.has(b)||this.listens.set(b,new Map),Xt(a._queryParams.isDefault()||!a._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Xt(!this.listens.get(b).has(y),"listen() called twice for same path/queryId.");const D={onComplete:S,hashFn:h,query:a,tag:_};this.listens.get(b).set(y,D),this.connected_&&this.sendListen_(D)}sendGet_(a){const h=this.outstandingGets_[a];this.sendRequest("g",h.request,_=>{delete this.outstandingGets_[a],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),h.onComplete&&h.onComplete(_)})}sendListen_(a){const h=a.query,_=h._path.toString(),S=h._queryIdentifier;this.log_("Listen on "+_+" for "+S);const y={p:_},b="q";a.tag&&(y.q=h._queryObject,y.t=a.tag),y.h=a.hashFn(),this.sendRequest(b,y,D=>{const U=D.d,x=D.s;sy.warnOnListenWarnings_(U,h),(this.listens.get(_)&&this.listens.get(_).get(S))===a&&(this.log_("listen response",D),x!=="ok"&&this.removeListen_(_,S),a.onComplete&&a.onComplete(x,U))})}static warnOnListenWarnings_(a,h){if(a&&typeof a=="object"&&Ey(a,"w")){const _=Hk(a,"w");if(Array.isArray(_)&&~_.indexOf("no_index")){const S='".indexOn": "'+h._queryParams.getIndex().toString()+'"',y=h._path.toString();jh(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${S} at ${y} to your security rules for better performance.`)}}}refreshAuthToken(a){this.authToken_=a,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(a)}reduceReconnectDelayIfAdminCredential_(a){(a&&a.length===40||$he(a))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=jZ)}refreshAppCheckToken(a){this.appCheckToken_=a,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const a=this.authToken_,h=Zhe(a)?"auth":"gauth",_={cred:a};this.authOverride_===null?_.noauth=!0:typeof this.authOverride_=="object"&&(_.authvar=this.authOverride_),this.sendRequest(h,_,S=>{const y=S.s,b=S.d||"error";this.authToken_===a&&(y==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(y,b))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},a=>{const h=a.s,_=a.d||"error";h==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(h,_)})}unlisten(a,h){const _=a._path.toString(),S=a._queryIdentifier;this.log_("Unlisten called for "+_+" "+S),Xt(a._queryParams.isDefault()||!a._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(_,S)&&this.connected_&&this.sendUnlisten_(_,S,a._queryObject,h)}sendUnlisten_(a,h,_,S){this.log_("Unlisten on "+a+" for "+h);const y={p:a},b="n";S&&(y.q=_,y.t=S),this.sendRequest(b,y)}onDisconnectPut(a,h,_){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",a,h,_):this.onDisconnectRequestQueue_.push({pathString:a,action:"o",data:h,onComplete:_})}onDisconnectMerge(a,h,_){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",a,h,_):this.onDisconnectRequestQueue_.push({pathString:a,action:"om",data:h,onComplete:_})}onDisconnectCancel(a,h){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",a,null,h):this.onDisconnectRequestQueue_.push({pathString:a,action:"oc",data:null,onComplete:h})}sendOnDisconnect_(a,h,_,S){const y={p:h,d:_};this.log_("onDisconnect "+a,y),this.sendRequest(a,y,b=>{S&&setTimeout(()=>{S(b.s,b.d)},Math.floor(0))})}put(a,h,_,S){this.putInternal("p",a,h,_,S)}merge(a,h,_,S){this.putInternal("m",a,h,_,S)}putInternal(a,h,_,S,y){this.initConnection_();const b={p:h,d:_};y!==void 0&&(b.h=y),this.outstandingPuts_.push({action:a,request:b,onComplete:S}),this.outstandingPutCount_++;const D=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(D):this.log_("Buffering put: "+h)}sendPut_(a){const h=this.outstandingPuts_[a].action,_=this.outstandingPuts_[a].request,S=this.outstandingPuts_[a].onComplete;this.outstandingPuts_[a].queued=this.connected_,this.sendRequest(h,_,y=>{this.log_(h+" response",y),delete this.outstandingPuts_[a],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),S&&S(y.s,y.d)})}reportStats(a){if(this.connected_){const h={c:a};this.log_("reportStats",h),this.sendRequest("s",h,_=>{if(_.s!=="ok"){const y=_.d;this.log_("reportStats","Error sending stats: "+y)}})}}onDataMessage_(a){if("r"in a){this.log_("from server: "+wl(a));const h=a.r,_=this.requestCBHash_[h];_&&(delete this.requestCBHash_[h],_(a.b))}else{if("error"in a)throw"A server-side error has occurred: "+a.error;"a"in a&&this.onDataPush_(a.a,a.b)}}onDataPush_(a,h){this.log_("handleServerMessage",a,h),a==="d"?this.onDataUpdate_(h.p,h.d,!1,h.t):a==="m"?this.onDataUpdate_(h.p,h.d,!0,h.t):a==="c"?this.onListenRevoked_(h.p,h.q):a==="ac"?this.onAuthRevoked_(h.s,h.d):a==="apc"?this.onAppCheckRevoked_(h.s,h.d):a==="sd"?this.onSecurityDebugPacket_(h):g7("Unrecognized action received from server: "+wl(a)+`
Are you using the latest client?`)}onReady_(a,h){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(a),this.lastSessionId=h,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(a){Xt(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(a))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(a){a&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Nj,this.realtime_||this.scheduleConnect_(0)),this.visible_=a}onOnline_(a){a?(this.log_("Browser went online."),this.reconnectDelay_=Nj,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>G_e&&(this.reconnectDelay_=Nj),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const a=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let h=Math.max(0,this.reconnectDelay_-a);h=Math.random()*h,this.log_("Trying to reconnect in "+h+"ms"),this.scheduleConnect_(h),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*j_e)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const a=this.onDataMessage_.bind(this),h=this.onReady_.bind(this),_=this.onRealtimeDisconnect_.bind(this),S=this.id+":"+sy.nextConnectionId_++,y=this.lastSessionId;let b=!1,D=null;const U=function(){D?D.close():(b=!0,_())},x=function(J){Xt(D,"sendRequest call when we're not connected not allowed."),D.sendRequest(J)};this.realtime_={close:U,sendRequest:x};const q=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[J,ee]=await Promise.all([this.authTokenProvider_.getToken(q),this.appCheckTokenProvider_.getToken(q)]);b?Hd("getToken() completed but was canceled"):(Hd("getToken() completed. Creating connection."),this.authToken_=J&&J.accessToken,this.appCheckToken_=ee&&ee.token,D=new M_e(S,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,a,h,_,ue=>{jh(ue+" ("+this.repoInfo_.toString()+")"),this.interrupt(W_e)},y))}catch(J){this.log_("Failed to get token: "+J),b||(this.repoInfo_.nodeAdmin&&jh(J),U())}}}interrupt(a){Hd("Interrupting connection for reason: "+a),this.interruptReasons_[a]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(a){Hd("Resuming connection for reason: "+a),delete this.interruptReasons_[a],u7(this.interruptReasons_)&&(this.reconnectDelay_=Nj,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(a){const h=a-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:h})}cancelSentTransactions_(){for(let a=0;a<this.outstandingPuts_.length;a++){const h=this.outstandingPuts_[a];h&&"h"in h.request&&h.queued&&(h.onComplete&&h.onComplete("disconnect"),delete this.outstandingPuts_[a],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(a,h){let _;h?_=h.map(y=>PX(y)).join("$"):_="default";const S=this.removeListen_(a,_);S&&S.onComplete&&S.onComplete("permission_denied")}removeListen_(a,h){const _=new yo(a).toString();let S;if(this.listens.has(_)){const y=this.listens.get(_);S=y.get(h),y.delete(h),y.size===0&&this.listens.delete(_)}else S=void 0;return S}onAuthRevoked_(a,h){Hd("Auth token revoked: "+a+"/"+h),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(a==="invalid_token"||a==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=GZ&&(this.reconnectDelay_=jZ,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(a,h){Hd("App check token revoked: "+a+"/"+h),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(a==="invalid_token"||a==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=GZ&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(a){this.securityDebugCallback_?this.securityDebugCallback_(a):"msg"in a&&console.log("FIREBASE: "+a.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const a of this.listens.values())for(const h of a.values())this.sendListen_(h);for(let a=0;a<this.outstandingPuts_.length;a++)this.outstandingPuts_[a]&&this.sendPut_(a);for(;this.onDisconnectRequestQueue_.length;){const a=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(a.action,a.pathString,a.data,a.onComplete)}for(let a=0;a<this.outstandingGets_.length;a++)this.outstandingGets_[a]&&this.sendGet_(a)}sendConnectStats_(){const a={};let h="js";a["sdk."+h+"."+vte.replace(/\./g,"-")]=1,RX()?a["framework.cordova"]=1:ote()&&(a["framework.reactnative"]=1),this.reportStats(a)}shouldReconnect_(){const a=PG.getInstance().currentlyOnline();return u7(this.interruptReasons_)&&a}}sy.nextPersistentConnectionId_=0;sy.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar{constructor(a,h){this.name=a,this.node=h}static Wrap(a,h){return new Ar(a,h)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CW{getCompare(){return this.compare.bind(this)}indexedValueChanged(a,h){const _=new Ar(zk,a),S=new Ar(zk,h);return this.compare(_,S)!==0}minPost(){return Ar.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Z6;class Xte extends CW{static get __EMPTY_NODE(){return Z6}static set __EMPTY_NODE(a){Z6=a}compare(a,h){return iL(a.name,h.name)}isDefinedOn(a){throw tL("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(a,h){return!1}minPost(){return Ar.MIN}maxPost(){return new Ar(iO,Z6)}makePost(a,h){return Xt(typeof a=="string","KeyIndex indexValue must always be a string."),new Ar(a,Z6)}toString(){return".key"}}const xk=new Xte;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $6{constructor(a,h,_,S,y=null){this.isReverse_=S,this.resultGenerator_=y,this.nodeStack_=[];let b=1;for(;!a.isEmpty();)if(a=a,b=h?_(a.key,h):1,S&&(b*=-1),b<0)this.isReverse_?a=a.left:a=a.right;else if(b===0){this.nodeStack_.push(a);break}else this.nodeStack_.push(a),this.isReverse_?a=a.right:a=a.left}getNext(){if(this.nodeStack_.length===0)return null;let a=this.nodeStack_.pop(),h;if(this.resultGenerator_?h=this.resultGenerator_(a.key,a.value):h={key:a.key,value:a.value},this.isReverse_)for(a=a.left;!a.isEmpty();)this.nodeStack_.push(a),a=a.right;else for(a=a.right;!a.isEmpty();)this.nodeStack_.push(a),a=a.left;return h}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const a=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(a.key,a.value):{key:a.key,value:a.value}}}class Al{constructor(a,h,_,S,y){this.key=a,this.value=h,this.color=_??Al.RED,this.left=S??Bh.EMPTY_NODE,this.right=y??Bh.EMPTY_NODE}copy(a,h,_,S,y){return new Al(a??this.key,h??this.value,_??this.color,S??this.left,y??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(a){return this.left.inorderTraversal(a)||!!a(this.key,this.value)||this.right.inorderTraversal(a)}reverseTraversal(a){return this.right.reverseTraversal(a)||a(this.key,this.value)||this.left.reverseTraversal(a)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(a,h,_){let S=this;const y=_(a,S.key);return y<0?S=S.copy(null,null,null,S.left.insert(a,h,_),null):y===0?S=S.copy(null,h,null,null,null):S=S.copy(null,null,null,null,S.right.insert(a,h,_)),S.fixUp_()}removeMin_(){if(this.left.isEmpty())return Bh.EMPTY_NODE;let a=this;return!a.left.isRed_()&&!a.left.left.isRed_()&&(a=a.moveRedLeft_()),a=a.copy(null,null,null,a.left.removeMin_(),null),a.fixUp_()}remove(a,h){let _,S;if(_=this,h(a,_.key)<0)!_.left.isEmpty()&&!_.left.isRed_()&&!_.left.left.isRed_()&&(_=_.moveRedLeft_()),_=_.copy(null,null,null,_.left.remove(a,h),null);else{if(_.left.isRed_()&&(_=_.rotateRight_()),!_.right.isEmpty()&&!_.right.isRed_()&&!_.right.left.isRed_()&&(_=_.moveRedRight_()),h(a,_.key)===0){if(_.right.isEmpty())return Bh.EMPTY_NODE;S=_.right.min_(),_=_.copy(S.key,S.value,null,null,_.right.removeMin_())}_=_.copy(null,null,null,null,_.right.remove(a,h))}return _.fixUp_()}isRed_(){return this.color}fixUp_(){let a=this;return a.right.isRed_()&&!a.left.isRed_()&&(a=a.rotateLeft_()),a.left.isRed_()&&a.left.left.isRed_()&&(a=a.rotateRight_()),a.left.isRed_()&&a.right.isRed_()&&(a=a.colorFlip_()),a}moveRedLeft_(){let a=this.colorFlip_();return a.right.left.isRed_()&&(a=a.copy(null,null,null,null,a.right.rotateRight_()),a=a.rotateLeft_(),a=a.colorFlip_()),a}moveRedRight_(){let a=this.colorFlip_();return a.left.left.isRed_()&&(a=a.rotateRight_(),a=a.colorFlip_()),a}rotateLeft_(){const a=this.copy(null,null,Al.RED,null,this.right.left);return this.right.copy(null,null,this.color,a,null)}rotateRight_(){const a=this.copy(null,null,Al.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,a)}colorFlip_(){const a=this.left.copy(null,null,!this.left.color,null,null),h=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,a,h)}checkMaxDepth_(){const a=this.check_();return Math.pow(2,a)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const a=this.left.check_();if(a!==this.right.check_())throw new Error("Black depths differ");return a+(this.isRed_()?0:1)}}Al.RED=!0;Al.BLACK=!1;class H_e{copy(a,h,_,S,y){return this}insert(a,h,_){return new Al(a,h,null)}remove(a,h){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(a){return!1}reverseTraversal(a){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Bh{constructor(a,h=Bh.EMPTY_NODE){this.comparator_=a,this.root_=h}insert(a,h){return new Bh(this.comparator_,this.root_.insert(a,h,this.comparator_).copy(null,null,Al.BLACK,null,null))}remove(a){return new Bh(this.comparator_,this.root_.remove(a,this.comparator_).copy(null,null,Al.BLACK,null,null))}get(a){let h,_=this.root_;for(;!_.isEmpty();){if(h=this.comparator_(a,_.key),h===0)return _.value;h<0?_=_.left:h>0&&(_=_.right)}return null}getPredecessorKey(a){let h,_=this.root_,S=null;for(;!_.isEmpty();)if(h=this.comparator_(a,_.key),h===0){if(_.left.isEmpty())return S?S.key:null;for(_=_.left;!_.right.isEmpty();)_=_.right;return _.key}else h<0?_=_.left:h>0&&(S=_,_=_.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(a){return this.root_.inorderTraversal(a)}reverseTraversal(a){return this.root_.reverseTraversal(a)}getIterator(a){return new $6(this.root_,null,this.comparator_,!1,a)}getIteratorFrom(a,h){return new $6(this.root_,a,this.comparator_,!1,h)}getReverseIteratorFrom(a,h){return new $6(this.root_,a,this.comparator_,!0,h)}getReverseIterator(a){return new $6(this.root_,null,this.comparator_,!0,a)}}Bh.EMPTY_NODE=new H_e;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K_e(l,a){return iL(l.name,a.name)}function VX(l,a){return iL(l,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let T7;function z_e(l){T7=l}const Jte=function(l){return typeof l=="number"?"number:"+Ite(l):"string:"+l},Qte=function(l){if(l.isLeafNode()){const a=l.val();Xt(typeof a=="string"||typeof a=="number"||typeof a=="object"&&Ey(a,".sv"),"Priority must be a string or number.")}else Xt(l===T7||l.isEmpty(),"priority of unexpected type.");Xt(l===T7||l.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let WZ;class Il{static set __childrenNodeConstructor(a){WZ=a}static get __childrenNodeConstructor(){return WZ}constructor(a,h=Il.__childrenNodeConstructor.EMPTY_NODE){this.value_=a,this.priorityNode_=h,this.lazyHash_=null,Xt(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Qte(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(a){return new Il(this.value_,a)}getImmediateChild(a){return a===".priority"?this.priorityNode_:Il.__childrenNodeConstructor.EMPTY_NODE}getChild(a){return xr(a)?this:Ir(a)===".priority"?this.priorityNode_:Il.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(a,h){return null}updateImmediateChild(a,h){return a===".priority"?this.updatePriority(h):h.isEmpty()&&a!==".priority"?this:Il.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(a,h).updatePriority(this.priorityNode_)}updateChild(a,h){const _=Ir(a);return _===null?h:h.isEmpty()&&_!==".priority"?this:(Xt(_!==".priority"||xb(a)===1,".priority must be the last token in a path"),this.updateImmediateChild(_,Il.__childrenNodeConstructor.EMPTY_NODE.updateChild(Vo(a),h)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(a,h){return!1}val(a){return a&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let a="";this.priorityNode_.isEmpty()||(a+="priority:"+Jte(this.priorityNode_.val())+":");const h=typeof this.value_;a+=h+":",h==="number"?a+=Ite(this.value_):a+=this.value_,this.lazyHash_=Rte(a)}return this.lazyHash_}getValue(){return this.value_}compareTo(a){return a===Il.__childrenNodeConstructor.EMPTY_NODE?1:a instanceof Il.__childrenNodeConstructor?-1:(Xt(a.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(a))}compareToLeafNode_(a){const h=typeof a.value_,_=typeof this.value_,S=Il.VALUE_TYPE_ORDER.indexOf(h),y=Il.VALUE_TYPE_ORDER.indexOf(_);return Xt(S>=0,"Unknown leaf type: "+h),Xt(y>=0,"Unknown leaf type: "+_),S===y?_==="object"?0:this.value_<a.value_?-1:this.value_===a.value_?0:1:y-S}withIndex(){return this}isIndexed(){return!0}equals(a){if(a===this)return!0;if(a.isLeafNode()){const h=a;return this.value_===h.value_&&this.priorityNode_.equals(h.priorityNode_)}else return!1}}Il.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Zte,$te;function Y_e(l){Zte=l}function q_e(l){$te=l}class X_e extends CW{compare(a,h){const _=a.node.getPriority(),S=h.node.getPriority(),y=_.compareTo(S);return y===0?iL(a.name,h.name):y}isDefinedOn(a){return!a.getPriority().isEmpty()}indexedValueChanged(a,h){return!a.getPriority().equals(h.getPriority())}minPost(){return Ar.MIN}maxPost(){return new Ar(iO,new Il("[PRIORITY-POST]",$te))}makePost(a,h){const _=Zte(a);return new Ar(h,new Il("[PRIORITY-POST]",_))}toString(){return".priority"}}const Xa=new X_e;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J_e=Math.log(2);class Q_e{constructor(a){const h=y=>parseInt(Math.log(y)/J_e,10),_=y=>parseInt(Array(y+1).join("1"),2);this.count=h(a+1),this.current_=this.count-1;const S=_(this.count);this.bits_=a+1&S}nextBitIsOne(){const a=!(this.bits_&1<<this.current_);return this.current_--,a}}const kG=function(l,a,h,_){l.sort(a);const S=function(U,x){const q=x-U;let J,ee;if(q===0)return null;if(q===1)return J=l[U],ee=h?h(J):J,new Al(ee,J.node,Al.BLACK,null,null);{const ue=parseInt(q/2,10)+U,oe=S(U,ue),le=S(ue+1,x);return J=l[ue],ee=h?h(J):J,new Al(ee,J.node,Al.BLACK,oe,le)}},y=function(U){let x=null,q=null,J=l.length;const ee=function(oe,le){const pe=J-oe,Ne=J;J-=oe;const Ve=S(pe+1,Ne),Ae=l[pe],Ue=h?h(Ae):Ae;ue(new Al(Ue,Ae.node,le,null,Ve))},ue=function(oe){x?(x.left=oe,x=oe):(q=oe,x=oe)};for(let oe=0;oe<U.count;++oe){const le=U.nextBitIsOne(),pe=Math.pow(2,U.count-(oe+1));le?ee(pe,Al.BLACK):(ee(pe,Al.BLACK),ee(pe,Al.RED))}return q},b=new Q_e(l.length),D=y(b);return new Bh(_||a,D)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xq;const Ik={};class ty{static get Default(){return Xt(Ik&&Xa,"ChildrenNode.ts has not been loaded"),xq=xq||new ty({".priority":Ik},{".priority":Xa}),xq}constructor(a,h){this.indexes_=a,this.indexSet_=h}get(a){const h=Hk(this.indexes_,a);if(!h)throw new Error("No index defined for "+a);return h instanceof Bh?h:null}hasIndex(a){return Ey(this.indexSet_,a.toString())}addIndex(a,h){Xt(a!==xk,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const _=[];let S=!1;const y=h.getIterator(Ar.Wrap);let b=y.getNext();for(;b;)S=S||a.isDefinedOn(b.node),_.push(b),b=y.getNext();let D;S?D=kG(_,a.getCompare()):D=Ik;const U=a.toString(),x={...this.indexSet_};x[U]=a;const q={...this.indexes_};return q[U]=D,new ty(q,x)}addToIndexes(a,h){const _=wG(this.indexes_,(S,y)=>{const b=Hk(this.indexSet_,y);if(Xt(b,"Missing index implementation for "+y),S===Ik)if(b.isDefinedOn(a.node)){const D=[],U=h.getIterator(Ar.Wrap);let x=U.getNext();for(;x;)x.name!==a.name&&D.push(x),x=U.getNext();return D.push(a),kG(D,b.getCompare())}else return Ik;else{const D=h.get(a.name);let U=S;return D&&(U=U.remove(new Ar(a.name,D))),U.insert(a,a.node)}});return new ty(_,this.indexSet_)}removeFromIndexes(a,h){const _=wG(this.indexes_,S=>{if(S===Ik)return S;{const y=h.get(a.name);return y?S.remove(new Ar(a.name,y)):S}});return new ty(_,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Dj;class Pi{static get EMPTY_NODE(){return Dj||(Dj=new Pi(new Bh(VX),null,ty.Default))}constructor(a,h,_){this.children_=a,this.priorityNode_=h,this.indexMap_=_,this.lazyHash_=null,this.priorityNode_&&Qte(this.priorityNode_),this.children_.isEmpty()&&Xt(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Dj}updatePriority(a){return this.children_.isEmpty()?this:new Pi(this.children_,a,this.indexMap_)}getImmediateChild(a){if(a===".priority")return this.getPriority();{const h=this.children_.get(a);return h===null?Dj:h}}getChild(a){const h=Ir(a);return h===null?this:this.getImmediateChild(h).getChild(Vo(a))}hasChild(a){return this.children_.get(a)!==null}updateImmediateChild(a,h){if(Xt(h,"We should always be passing snapshot nodes"),a===".priority")return this.updatePriority(h);{const _=new Ar(a,h);let S,y;h.isEmpty()?(S=this.children_.remove(a),y=this.indexMap_.removeFromIndexes(_,this.children_)):(S=this.children_.insert(a,h),y=this.indexMap_.addToIndexes(_,this.children_));const b=S.isEmpty()?Dj:this.priorityNode_;return new Pi(S,b,y)}}updateChild(a,h){const _=Ir(a);if(_===null)return h;{Xt(Ir(a)!==".priority"||xb(a)===1,".priority must be the last token in a path");const S=this.getImmediateChild(_).updateChild(Vo(a),h);return this.updateImmediateChild(_,S)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(a){if(this.isEmpty())return null;const h={};let _=0,S=0,y=!0;if(this.forEachChild(Xa,(b,D)=>{h[b]=D.val(a),_++,y&&Pi.INTEGER_REGEXP_.test(b)?S=Math.max(S,Number(b)):y=!1}),!a&&y&&S<2*_){const b=[];for(const D in h)b[D]=h[D];return b}else return a&&!this.getPriority().isEmpty()&&(h[".priority"]=this.getPriority().val()),h}hash(){if(this.lazyHash_===null){let a="";this.getPriority().isEmpty()||(a+="priority:"+Jte(this.getPriority().val())+":"),this.forEachChild(Xa,(h,_)=>{const S=_.hash();S!==""&&(a+=":"+h+":"+S)}),this.lazyHash_=a===""?"":Rte(a)}return this.lazyHash_}getPredecessorChildName(a,h,_){const S=this.resolveIndex_(_);if(S){const y=S.getPredecessorKey(new Ar(a,h));return y?y.name:null}else return this.children_.getPredecessorKey(a)}getFirstChildName(a){const h=this.resolveIndex_(a);if(h){const _=h.minKey();return _&&_.name}else return this.children_.minKey()}getFirstChild(a){const h=this.getFirstChildName(a);return h?new Ar(h,this.children_.get(h)):null}getLastChildName(a){const h=this.resolveIndex_(a);if(h){const _=h.maxKey();return _&&_.name}else return this.children_.maxKey()}getLastChild(a){const h=this.getLastChildName(a);return h?new Ar(h,this.children_.get(h)):null}forEachChild(a,h){const _=this.resolveIndex_(a);return _?_.inorderTraversal(S=>h(S.name,S.node)):this.children_.inorderTraversal(h)}getIterator(a){return this.getIteratorFrom(a.minPost(),a)}getIteratorFrom(a,h){const _=this.resolveIndex_(h);if(_)return _.getIteratorFrom(a,S=>S);{const S=this.children_.getIteratorFrom(a.name,Ar.Wrap);let y=S.peek();for(;y!=null&&h.compare(y,a)<0;)S.getNext(),y=S.peek();return S}}getReverseIterator(a){return this.getReverseIteratorFrom(a.maxPost(),a)}getReverseIteratorFrom(a,h){const _=this.resolveIndex_(h);if(_)return _.getReverseIteratorFrom(a,S=>S);{const S=this.children_.getReverseIteratorFrom(a.name,Ar.Wrap);let y=S.peek();for(;y!=null&&h.compare(y,a)>0;)S.getNext(),y=S.peek();return S}}compareTo(a){return this.isEmpty()?a.isEmpty()?0:-1:a.isLeafNode()||a.isEmpty()?1:a===k3?-1:0}withIndex(a){if(a===xk||this.indexMap_.hasIndex(a))return this;{const h=this.indexMap_.addIndex(a,this.children_);return new Pi(this.children_,this.priorityNode_,h)}}isIndexed(a){return a===xk||this.indexMap_.hasIndex(a)}equals(a){if(a===this)return!0;if(a.isLeafNode())return!1;{const h=a;if(this.getPriority().equals(h.getPriority()))if(this.children_.count()===h.children_.count()){const _=this.getIterator(Xa),S=h.getIterator(Xa);let y=_.getNext(),b=S.getNext();for(;y&&b;){if(y.name!==b.name||!y.node.equals(b.node))return!1;y=_.getNext(),b=S.getNext()}return y===null&&b===null}else return!1;else return!1}}resolveIndex_(a){return a===xk?null:this.indexMap_.get(a.toString())}}Pi.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Z_e extends Pi{constructor(){super(new Bh(VX),Pi.EMPTY_NODE,ty.Default)}compareTo(a){return a===this?0:1}equals(a){return a===this}getPriority(){return this}getImmediateChild(a){return Pi.EMPTY_NODE}isEmpty(){return!1}}const k3=new Z_e;Object.defineProperties(Ar,{MIN:{value:new Ar(zk,Pi.EMPTY_NODE)},MAX:{value:new Ar(iO,k3)}});Xte.__EMPTY_NODE=Pi.EMPTY_NODE;Il.__childrenNodeConstructor=Pi;z_e(k3);q_e(k3);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $_e=!0;function ad(l,a=null){if(l===null)return Pi.EMPTY_NODE;if(typeof l=="object"&&".priority"in l&&(a=l[".priority"]),Xt(a===null||typeof a=="string"||typeof a=="number"||typeof a=="object"&&".sv"in a,"Invalid priority type found: "+typeof a),typeof l=="object"&&".value"in l&&l[".value"]!==null&&(l=l[".value"]),typeof l!="object"||".sv"in l){const h=l;return new Il(h,ad(a))}if(!(l instanceof Array)&&$_e){const h=[];let _=!1;if(Wh(l,(b,D)=>{if(b.substring(0,1)!=="."){const U=ad(D);U.isEmpty()||(_=_||!U.getPriority().isEmpty(),h.push(new Ar(b,U)))}}),h.length===0)return Pi.EMPTY_NODE;const y=kG(h,K_e,b=>b.name,VX);if(_){const b=kG(h,Xa.getCompare());return new Pi(y,ad(a),new ty({".priority":b},{".priority":Xa}))}else return new Pi(y,ad(a),ty.Default)}else{let h=Pi.EMPTY_NODE;return Wh(l,(_,S)=>{if(Ey(l,_)&&_.substring(0,1)!=="."){const y=ad(S);(y.isLeafNode()||!y.isEmpty())&&(h=h.updateImmediateChild(_,y))}}),h.updatePriority(ad(a))}}Y_e(ad);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eme extends CW{constructor(a){super(),this.indexPath_=a,Xt(!xr(a)&&Ir(a)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(a){return a.getChild(this.indexPath_)}isDefinedOn(a){return!a.getChild(this.indexPath_).isEmpty()}compare(a,h){const _=this.extractChild(a.node),S=this.extractChild(h.node),y=_.compareTo(S);return y===0?iL(a.name,h.name):y}makePost(a,h){const _=ad(a),S=Pi.EMPTY_NODE.updateChild(this.indexPath_,_);return new Ar(h,S)}maxPost(){const a=Pi.EMPTY_NODE.updateChild(this.indexPath_,k3);return new Ar(iO,a)}toString(){return zte(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tme extends CW{compare(a,h){const _=a.node.compareTo(h.node);return _===0?iL(a.name,h.name):_}isDefinedOn(a){return!0}indexedValueChanged(a,h){return!a.equals(h)}minPost(){return Ar.MIN}maxPost(){return Ar.MAX}makePost(a,h){const _=ad(a);return new Ar(h,_)}toString(){return".value"}}const nme=new tme;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ene(l){return{type:"value",snapshotNode:l}}function Yk(l,a){return{type:"child_added",snapshotNode:a,childName:l}}function d3(l,a){return{type:"child_removed",snapshotNode:a,childName:l}}function u3(l,a,h){return{type:"child_changed",snapshotNode:a,childName:l,oldSnap:h}}function ime(l,a){return{type:"child_moved",snapshotNode:a,childName:l}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FX{constructor(a){this.index_=a}updateChild(a,h,_,S,y,b){Xt(a.isIndexed(this.index_),"A node must be indexed if only a child is updated");const D=a.getImmediateChild(h);return D.getChild(S).equals(_.getChild(S))&&D.isEmpty()===_.isEmpty()||(b!=null&&(_.isEmpty()?a.hasChild(h)?b.trackChildChange(d3(h,D)):Xt(a.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):D.isEmpty()?b.trackChildChange(Yk(h,_)):b.trackChildChange(u3(h,_,D))),a.isLeafNode()&&_.isEmpty())?a:a.updateImmediateChild(h,_).withIndex(this.index_)}updateFullNode(a,h,_){return _!=null&&(a.isLeafNode()||a.forEachChild(Xa,(S,y)=>{h.hasChild(S)||_.trackChildChange(d3(S,y))}),h.isLeafNode()||h.forEachChild(Xa,(S,y)=>{if(a.hasChild(S)){const b=a.getImmediateChild(S);b.equals(y)||_.trackChildChange(u3(S,y,b))}else _.trackChildChange(Yk(S,y))})),h.withIndex(this.index_)}updatePriority(a,h){return a.isEmpty()?Pi.EMPTY_NODE:a.updatePriority(h)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h3{constructor(a){this.indexedFilter_=new FX(a.getIndex()),this.index_=a.getIndex(),this.startPost_=h3.getStartPost_(a),this.endPost_=h3.getEndPost_(a),this.startIsInclusive_=!a.startAfterSet_,this.endIsInclusive_=!a.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(a){const h=this.startIsInclusive_?this.index_.compare(this.getStartPost(),a)<=0:this.index_.compare(this.getStartPost(),a)<0,_=this.endIsInclusive_?this.index_.compare(a,this.getEndPost())<=0:this.index_.compare(a,this.getEndPost())<0;return h&&_}updateChild(a,h,_,S,y,b){return this.matches(new Ar(h,_))||(_=Pi.EMPTY_NODE),this.indexedFilter_.updateChild(a,h,_,S,y,b)}updateFullNode(a,h,_){h.isLeafNode()&&(h=Pi.EMPTY_NODE);let S=h.withIndex(this.index_);S=S.updatePriority(Pi.EMPTY_NODE);const y=this;return h.forEachChild(Xa,(b,D)=>{y.matches(new Ar(b,D))||(S=S.updateImmediateChild(b,Pi.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(a,S,_)}updatePriority(a,h){return a}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(a){if(a.hasStart()){const h=a.getIndexStartName();return a.getIndex().makePost(a.getIndexStartValue(),h)}else return a.getIndex().minPost()}static getEndPost_(a){if(a.hasEnd()){const h=a.getIndexEndName();return a.getIndex().makePost(a.getIndexEndValue(),h)}else return a.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rme{constructor(a){this.withinDirectionalStart=h=>this.reverse_?this.withinEndPost(h):this.withinStartPost(h),this.withinDirectionalEnd=h=>this.reverse_?this.withinStartPost(h):this.withinEndPost(h),this.withinStartPost=h=>{const _=this.index_.compare(this.rangedFilter_.getStartPost(),h);return this.startIsInclusive_?_<=0:_<0},this.withinEndPost=h=>{const _=this.index_.compare(h,this.rangedFilter_.getEndPost());return this.endIsInclusive_?_<=0:_<0},this.rangedFilter_=new h3(a),this.index_=a.getIndex(),this.limit_=a.getLimit(),this.reverse_=!a.isViewFromLeft(),this.startIsInclusive_=!a.startAfterSet_,this.endIsInclusive_=!a.endBeforeSet_}updateChild(a,h,_,S,y,b){return this.rangedFilter_.matches(new Ar(h,_))||(_=Pi.EMPTY_NODE),a.getImmediateChild(h).equals(_)?a:a.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(a,h,_,S,y,b):this.fullLimitUpdateChild_(a,h,_,y,b)}updateFullNode(a,h,_){let S;if(h.isLeafNode()||h.isEmpty())S=Pi.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<h.numChildren()&&h.isIndexed(this.index_)){S=Pi.EMPTY_NODE.withIndex(this.index_);let y;this.reverse_?y=h.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):y=h.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let b=0;for(;y.hasNext()&&b<this.limit_;){const D=y.getNext();if(this.withinDirectionalStart(D))if(this.withinDirectionalEnd(D))S=S.updateImmediateChild(D.name,D.node),b++;else break;else continue}}else{S=h.withIndex(this.index_),S=S.updatePriority(Pi.EMPTY_NODE);let y;this.reverse_?y=S.getReverseIterator(this.index_):y=S.getIterator(this.index_);let b=0;for(;y.hasNext();){const D=y.getNext();b<this.limit_&&this.withinDirectionalStart(D)&&this.withinDirectionalEnd(D)?b++:S=S.updateImmediateChild(D.name,Pi.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(a,S,_)}updatePriority(a,h){return a}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(a,h,_,S,y){let b;if(this.reverse_){const J=this.index_.getCompare();b=(ee,ue)=>J(ue,ee)}else b=this.index_.getCompare();const D=a;Xt(D.numChildren()===this.limit_,"");const U=new Ar(h,_),x=this.reverse_?D.getFirstChild(this.index_):D.getLastChild(this.index_),q=this.rangedFilter_.matches(U);if(D.hasChild(h)){const J=D.getImmediateChild(h);let ee=S.getChildAfterChild(this.index_,x,this.reverse_);for(;ee!=null&&(ee.name===h||D.hasChild(ee.name));)ee=S.getChildAfterChild(this.index_,ee,this.reverse_);const ue=ee==null?1:b(ee,U);if(q&&!_.isEmpty()&&ue>=0)return y?.trackChildChange(u3(h,_,J)),D.updateImmediateChild(h,_);{y?.trackChildChange(d3(h,J));const le=D.updateImmediateChild(h,Pi.EMPTY_NODE);return ee!=null&&this.rangedFilter_.matches(ee)?(y?.trackChildChange(Yk(ee.name,ee.node)),le.updateImmediateChild(ee.name,ee.node)):le}}else return _.isEmpty()?a:q&&b(x,U)>=0?(y!=null&&(y.trackChildChange(d3(x.name,x.node)),y.trackChildChange(Yk(h,_))),D.updateImmediateChild(h,_).updateImmediateChild(x.name,Pi.EMPTY_NODE)):a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BX{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Xa}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return Xt(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return Xt(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:zk}hasEnd(){return this.endSet_}getIndexEndValue(){return Xt(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return Xt(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:iO}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return Xt(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Xa}copy(){const a=new BX;return a.limitSet_=this.limitSet_,a.limit_=this.limit_,a.startSet_=this.startSet_,a.startAfterSet_=this.startAfterSet_,a.indexStartValue_=this.indexStartValue_,a.startNameSet_=this.startNameSet_,a.indexStartName_=this.indexStartName_,a.endSet_=this.endSet_,a.endBeforeSet_=this.endBeforeSet_,a.indexEndValue_=this.indexEndValue_,a.endNameSet_=this.endNameSet_,a.indexEndName_=this.indexEndName_,a.index_=this.index_,a.viewFrom_=this.viewFrom_,a}}function sme(l){return l.loadsAllData()?new FX(l.getIndex()):l.hasLimit()?new rme(l):new h3(l)}function HZ(l){const a={};if(l.isDefault())return a;let h;if(l.index_===Xa?h="$priority":l.index_===nme?h="$value":l.index_===xk?h="$key":(Xt(l.index_ instanceof eme,"Unrecognized index type!"),h=l.index_.toString()),a.orderBy=wl(h),l.startSet_){const _=l.startAfterSet_?"startAfter":"startAt";a[_]=wl(l.indexStartValue_),l.startNameSet_&&(a[_]+=","+wl(l.indexStartName_))}if(l.endSet_){const _=l.endBeforeSet_?"endBefore":"endAt";a[_]=wl(l.indexEndValue_),l.endNameSet_&&(a[_]+=","+wl(l.indexEndName_))}return l.limitSet_&&(l.isViewFromLeft()?a.limitToFirst=l.limit_:a.limitToLast=l.limit_),a}function KZ(l){const a={};if(l.startSet_&&(a.sp=l.indexStartValue_,l.startNameSet_&&(a.sn=l.indexStartName_),a.sin=!l.startAfterSet_),l.endSet_&&(a.ep=l.indexEndValue_,l.endNameSet_&&(a.en=l.indexEndName_),a.ein=!l.endBeforeSet_),l.limitSet_){a.l=l.limit_;let h=l.viewFrom_;h===""&&(l.isViewFromLeft()?h="l":h="r"),a.vf=h}return l.index_!==Xa&&(a.i=l.index_.toString()),a}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LG extends Wte{reportStats(a){throw new Error("Method not implemented.")}static getListenId_(a,h){return h!==void 0?"tag$"+h:(Xt(a._queryParams.isDefault(),"should have a tag if it's not a default query."),a._path.toString())}constructor(a,h,_,S){super(),this.repoInfo_=a,this.onDataUpdate_=h,this.authTokenProvider_=_,this.appCheckTokenProvider_=S,this.log_=P3("p:rest:"),this.listens_={}}listen(a,h,_,S){const y=a._path.toString();this.log_("Listen called for "+y+" "+a._queryIdentifier);const b=LG.getListenId_(a,_),D={};this.listens_[b]=D;const U=HZ(a._queryParams);this.restRequest_(y+".json",U,(x,q)=>{let J=q;if(x===404&&(J=null,x=null),x===null&&this.onDataUpdate_(y,J,!1,_),Hk(this.listens_,b)===D){let ee;x?x===401?ee="permission_denied":ee="rest_error:"+x:ee="ok",S(ee,null)}})}unlisten(a,h){const _=LG.getListenId_(a,h);delete this.listens_[_]}get(a){const h=HZ(a._queryParams),_=a._path.toString(),S=new TW;return this.restRequest_(_+".json",h,(y,b)=>{let D=b;y===404&&(D=null,y=null),y===null?(this.onDataUpdate_(_,D,!1,null),S.resolve(D)):S.reject(new Error(D))}),S.promise}refreshAuthToken(a){}restRequest_(a,h={},_){return h.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([S,y])=>{S&&S.accessToken&&(h.auth=S.accessToken),y&&y.token&&(h.ac=y.token);const b=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+a+"?ns="+this.repoInfo_.namespace+nL(h);this.log_("Sending REST request for "+b);const D=new XMLHttpRequest;D.onreadystatechange=()=>{if(_&&D.readyState===4){this.log_("REST Response for "+b+" received. status:",D.status,"response:",D.responseText);let U=null;if(D.status>=200&&D.status<300){try{U=o3(D.responseText)}catch{jh("Failed to parse JSON response for "+b+": "+D.responseText)}_(null,U)}else D.status!==401&&D.status!==404&&jh("Got unsuccessful REST response for "+b+" Status: "+D.status),_(D.status);_=null}},D.open("GET",b,!0),D.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ome{constructor(){this.rootNode_=Pi.EMPTY_NODE}getNode(a){return this.rootNode_.getChild(a)}updateSnapshot(a,h){this.rootNode_=this.rootNode_.updateChild(a,h)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MG(){return{value:null,children:new Map}}function tne(l,a,h){if(xr(a))l.value=h,l.children.clear();else if(l.value!==null)l.value=l.value.updateChild(a,h);else{const _=Ir(a);l.children.has(_)||l.children.set(_,MG());const S=l.children.get(_);a=Vo(a),tne(S,a,h)}}function v7(l,a,h){l.value!==null?h(a,l.value):ame(l,(_,S)=>{const y=new yo(a.toString()+"/"+_);v7(S,y,h)})}function ame(l,a){l.children.forEach((h,_)=>{a(_,h)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cme{constructor(a){this.collection_=a,this.last_=null}get(){const a=this.collection_.get(),h={...a};return this.last_&&Wh(this.last_,(_,S)=>{h[_]=h[_]-S}),this.last_=a,h}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zZ=10*1e3,lme=30*1e3,dme=300*1e3;class ume{constructor(a,h){this.server_=h,this.statsToReport_={},this.statsListener_=new cme(a);const _=zZ+(lme-zZ)*Math.random();Yj(this.reportStats_.bind(this),Math.floor(_))}reportStats_(){const a=this.statsListener_.get(),h={};let _=!1;Wh(a,(S,y)=>{y>0&&Ey(this.statsToReport_,S)&&(h[S]=y,_=!0)}),_&&this.server_.reportStats(h),Yj(this.reportStats_.bind(this),Math.floor(Math.random()*2*dme))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var SE;(function(l){l[l.OVERWRITE=0]="OVERWRITE",l[l.MERGE=1]="MERGE",l[l.ACK_USER_WRITE=2]="ACK_USER_WRITE",l[l.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(SE||(SE={}));function nne(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function jX(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function GX(l){return{fromUser:!1,fromServer:!0,queryId:l,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UG{constructor(a,h,_){this.path=a,this.affectedTree=h,this.revert=_,this.type=SE.ACK_USER_WRITE,this.source=nne()}operationForChild(a){if(xr(this.path)){if(this.affectedTree.value!=null)return Xt(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const h=this.affectedTree.subtree(new yo(a));return new UG(Ms(),h,this.revert)}}else return Xt(Ir(this.path)===a,"operationForChild called for unrelated child."),new UG(Vo(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p3{constructor(a,h){this.source=a,this.path=h,this.type=SE.LISTEN_COMPLETE}operationForChild(a){return xr(this.path)?new p3(this.source,Ms()):new p3(this.source,Vo(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rO{constructor(a,h,_){this.source=a,this.path=h,this.snap=_,this.type=SE.OVERWRITE}operationForChild(a){return xr(this.path)?new rO(this.source,Ms(),this.snap.getImmediateChild(a)):new rO(this.source,Vo(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f3{constructor(a,h,_){this.source=a,this.path=h,this.children=_,this.type=SE.MERGE}operationForChild(a){if(xr(this.path)){const h=this.children.subtree(new yo(a));return h.isEmpty()?null:h.value?new rO(this.source,Ms(),h.value):new f3(this.source,Ms(),h)}else return Xt(Ir(this.path)===a,"Can't get a merge for a child not on the path of the operation"),new f3(this.source,Vo(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sO{constructor(a,h,_){this.node_=a,this.fullyInitialized_=h,this.filtered_=_}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(a){if(xr(a))return this.isFullyInitialized()&&!this.filtered_;const h=Ir(a);return this.isCompleteForChild(h)}isCompleteForChild(a){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(a)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hme{constructor(a){this.query_=a,this.index_=this.query_._queryParams.getIndex()}}function pme(l,a,h,_){const S=[],y=[];return a.forEach(b=>{b.type==="child_changed"&&l.index_.indexedValueChanged(b.oldSnap,b.snapshotNode)&&y.push(ime(b.childName,b.snapshotNode))}),Pj(l,S,"child_removed",a,_,h),Pj(l,S,"child_added",a,_,h),Pj(l,S,"child_moved",y,_,h),Pj(l,S,"child_changed",a,_,h),Pj(l,S,"value",a,_,h),S}function Pj(l,a,h,_,S,y){const b=_.filter(D=>D.type===h);b.sort((D,U)=>_me(l,D,U)),b.forEach(D=>{const U=fme(l,D,y);S.forEach(x=>{x.respondsTo(D.type)&&a.push(x.createEvent(U,l.query_))})})}function fme(l,a,h){return a.type==="value"||a.type==="child_removed"||(a.prevName=h.getPredecessorChildName(a.childName,a.snapshotNode,l.index_)),a}function _me(l,a,h){if(a.childName==null||h.childName==null)throw tL("Should only compare child_ events.");const _=new Ar(a.childName,a.snapshotNode),S=new Ar(h.childName,h.snapshotNode);return l.index_.compare(_,S)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bW(l,a){return{eventCache:l,serverCache:a}}function qj(l,a,h,_){return bW(new sO(a,h,_),l.serverCache)}function ine(l,a,h,_){return bW(l.eventCache,new sO(a,h,_))}function y7(l){return l.eventCache.isFullyInitialized()?l.eventCache.getNode():null}function oO(l){return l.serverCache.isFullyInitialized()?l.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Vq;const mme=()=>(Vq||(Vq=new Bh(t_e)),Vq);class sa{static fromObject(a){let h=new sa(null);return Wh(a,(_,S)=>{h=h.set(new yo(_),S)}),h}constructor(a,h=mme()){this.value=a,this.children=h}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(a,h){if(this.value!=null&&h(this.value))return{path:Ms(),value:this.value};if(xr(a))return null;{const _=Ir(a),S=this.children.get(_);if(S!==null){const y=S.findRootMostMatchingPathAndValue(Vo(a),h);return y!=null?{path:Jc(new yo(_),y.path),value:y.value}:null}else return null}}findRootMostValueAndPath(a){return this.findRootMostMatchingPathAndValue(a,()=>!0)}subtree(a){if(xr(a))return this;{const h=Ir(a),_=this.children.get(h);return _!==null?_.subtree(Vo(a)):new sa(null)}}set(a,h){if(xr(a))return new sa(h,this.children);{const _=Ir(a),y=(this.children.get(_)||new sa(null)).set(Vo(a),h),b=this.children.insert(_,y);return new sa(this.value,b)}}remove(a){if(xr(a))return this.children.isEmpty()?new sa(null):new sa(null,this.children);{const h=Ir(a),_=this.children.get(h);if(_){const S=_.remove(Vo(a));let y;return S.isEmpty()?y=this.children.remove(h):y=this.children.insert(h,S),this.value===null&&y.isEmpty()?new sa(null):new sa(this.value,y)}else return this}}get(a){if(xr(a))return this.value;{const h=Ir(a),_=this.children.get(h);return _?_.get(Vo(a)):null}}setTree(a,h){if(xr(a))return h;{const _=Ir(a),y=(this.children.get(_)||new sa(null)).setTree(Vo(a),h);let b;return y.isEmpty()?b=this.children.remove(_):b=this.children.insert(_,y),new sa(this.value,b)}}fold(a){return this.fold_(Ms(),a)}fold_(a,h){const _={};return this.children.inorderTraversal((S,y)=>{_[S]=y.fold_(Jc(a,S),h)}),h(a,this.value,_)}findOnPath(a,h){return this.findOnPath_(a,Ms(),h)}findOnPath_(a,h,_){const S=this.value?_(h,this.value):!1;if(S)return S;if(xr(a))return null;{const y=Ir(a),b=this.children.get(y);return b?b.findOnPath_(Vo(a),Jc(h,y),_):null}}foreachOnPath(a,h){return this.foreachOnPath_(a,Ms(),h)}foreachOnPath_(a,h,_){if(xr(a))return this;{this.value&&_(h,this.value);const S=Ir(a),y=this.children.get(S);return y?y.foreachOnPath_(Vo(a),Jc(h,S),_):new sa(null)}}foreach(a){this.foreach_(Ms(),a)}foreach_(a,h){this.children.inorderTraversal((_,S)=>{S.foreach_(Jc(a,_),h)}),this.value&&h(a,this.value)}foreachChild(a){this.children.inorderTraversal((h,_)=>{_.value&&a(h,_.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vE{constructor(a){this.writeTree_=a}static empty(){return new vE(new sa(null))}}function Xj(l,a,h){if(xr(a))return new vE(new sa(h));{const _=l.writeTree_.findRootMostValueAndPath(a);if(_!=null){const S=_.path;let y=_.value;const b=Fh(S,a);return y=y.updateChild(b,h),new vE(l.writeTree_.set(S,y))}else{const S=new sa(h),y=l.writeTree_.setTree(a,S);return new vE(y)}}}function YZ(l,a,h){let _=l;return Wh(h,(S,y)=>{_=Xj(_,Jc(a,S),y)}),_}function qZ(l,a){if(xr(a))return vE.empty();{const h=l.writeTree_.setTree(a,new sa(null));return new vE(h)}}function R7(l,a){return uO(l,a)!=null}function uO(l,a){const h=l.writeTree_.findRootMostValueAndPath(a);return h!=null?l.writeTree_.get(h.path).getChild(Fh(h.path,a)):null}function XZ(l){const a=[],h=l.writeTree_.value;return h!=null?h.isLeafNode()||h.forEachChild(Xa,(_,S)=>{a.push(new Ar(_,S))}):l.writeTree_.children.inorderTraversal((_,S)=>{S.value!=null&&a.push(new Ar(_,S.value))}),a}function Db(l,a){if(xr(a))return l;{const h=uO(l,a);return h!=null?new vE(new sa(h)):new vE(l.writeTree_.subtree(a))}}function C7(l){return l.writeTree_.isEmpty()}function qk(l,a){return rne(Ms(),l.writeTree_,a)}function rne(l,a,h){if(a.value!=null)return h.updateChild(l,a.value);{let _=null;return a.children.inorderTraversal((S,y)=>{S===".priority"?(Xt(y.value!==null,"Priority writes must always be leaf nodes"),_=y.value):h=rne(Jc(l,S),y,h)}),!h.getChild(l).isEmpty()&&_!==null&&(h=h.updateChild(Jc(l,".priority"),_)),h}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WX(l,a){return cne(a,l)}function Eme(l,a,h,_,S){Xt(_>l.lastWriteId,"Stacking an older write on top of newer ones"),S===void 0&&(S=!0),l.allWrites.push({path:a,snap:h,writeId:_,visible:S}),S&&(l.visibleWrites=Xj(l.visibleWrites,a,h)),l.lastWriteId=_}function gme(l,a){for(let h=0;h<l.allWrites.length;h++){const _=l.allWrites[h];if(_.writeId===a)return _}return null}function Sme(l,a){const h=l.allWrites.findIndex(D=>D.writeId===a);Xt(h>=0,"removeWrite called with nonexistent writeId.");const _=l.allWrites[h];l.allWrites.splice(h,1);let S=_.visible,y=!1,b=l.allWrites.length-1;for(;S&&b>=0;){const D=l.allWrites[b];D.visible&&(b>=h&&Tme(D,_.path)?S=!1:gE(_.path,D.path)&&(y=!0)),b--}if(S){if(y)return vme(l),!0;if(_.snap)l.visibleWrites=qZ(l.visibleWrites,_.path);else{const D=_.children;Wh(D,U=>{l.visibleWrites=qZ(l.visibleWrites,Jc(_.path,U))})}return!0}else return!1}function Tme(l,a){if(l.snap)return gE(l.path,a);for(const h in l.children)if(l.children.hasOwnProperty(h)&&gE(Jc(l.path,h),a))return!0;return!1}function vme(l){l.visibleWrites=sne(l.allWrites,yme,Ms()),l.allWrites.length>0?l.lastWriteId=l.allWrites[l.allWrites.length-1].writeId:l.lastWriteId=-1}function yme(l){return l.visible}function sne(l,a,h){let _=vE.empty();for(let S=0;S<l.length;++S){const y=l[S];if(a(y)){const b=y.path;let D;if(y.snap)gE(h,b)?(D=Fh(h,b),_=Xj(_,D,y.snap)):gE(b,h)&&(D=Fh(b,h),_=Xj(_,Ms(),y.snap.getChild(D)));else if(y.children){if(gE(h,b))D=Fh(h,b),_=YZ(_,D,y.children);else if(gE(b,h))if(D=Fh(b,h),xr(D))_=YZ(_,Ms(),y.children);else{const U=Hk(y.children,Ir(D));if(U){const x=U.getChild(Vo(D));_=Xj(_,Ms(),x)}}}else throw tL("WriteRecord should have .snap or .children")}}return _}function one(l,a,h,_,S){if(!_&&!S){const y=uO(l.visibleWrites,a);if(y!=null)return y;{const b=Db(l.visibleWrites,a);if(C7(b))return h;if(h==null&&!R7(b,Ms()))return null;{const D=h||Pi.EMPTY_NODE;return qk(b,D)}}}else{const y=Db(l.visibleWrites,a);if(!S&&C7(y))return h;if(!S&&h==null&&!R7(y,Ms()))return null;{const b=function(x){return(x.visible||S)&&(!_||!~_.indexOf(x.writeId))&&(gE(x.path,a)||gE(a,x.path))},D=sne(l.allWrites,b,a),U=h||Pi.EMPTY_NODE;return qk(D,U)}}}function Rme(l,a,h){let _=Pi.EMPTY_NODE;const S=uO(l.visibleWrites,a);if(S)return S.isLeafNode()||S.forEachChild(Xa,(y,b)=>{_=_.updateImmediateChild(y,b)}),_;if(h){const y=Db(l.visibleWrites,a);return h.forEachChild(Xa,(b,D)=>{const U=qk(Db(y,new yo(b)),D);_=_.updateImmediateChild(b,U)}),XZ(y).forEach(b=>{_=_.updateImmediateChild(b.name,b.node)}),_}else{const y=Db(l.visibleWrites,a);return XZ(y).forEach(b=>{_=_.updateImmediateChild(b.name,b.node)}),_}}function Cme(l,a,h,_,S){Xt(_||S,"Either existingEventSnap or existingServerSnap must exist");const y=Jc(a,h);if(R7(l.visibleWrites,y))return null;{const b=Db(l.visibleWrites,y);return C7(b)?S.getChild(h):qk(b,S.getChild(h))}}function bme(l,a,h,_){const S=Jc(a,h),y=uO(l.visibleWrites,S);if(y!=null)return y;if(_.isCompleteForChild(h)){const b=Db(l.visibleWrites,S);return qk(b,_.getNode().getImmediateChild(h))}else return null}function Ime(l,a){return uO(l.visibleWrites,a)}function Ame(l,a,h,_,S,y,b){let D;const U=Db(l.visibleWrites,a),x=uO(U,Ms());if(x!=null)D=x;else if(h!=null)D=qk(U,h);else return[];if(D=D.withIndex(b),!D.isEmpty()&&!D.isLeafNode()){const q=[],J=b.getCompare(),ee=y?D.getReverseIteratorFrom(_,b):D.getIteratorFrom(_,b);let ue=ee.getNext();for(;ue&&q.length<S;)J(ue,_)!==0&&q.push(ue),ue=ee.getNext();return q}else return[]}function wme(){return{visibleWrites:vE.empty(),allWrites:[],lastWriteId:-1}}function xG(l,a,h,_){return one(l.writeTree,l.treePath,a,h,_)}function HX(l,a){return Rme(l.writeTree,l.treePath,a)}function JZ(l,a,h,_){return Cme(l.writeTree,l.treePath,a,h,_)}function VG(l,a){return Ime(l.writeTree,Jc(l.treePath,a))}function Ome(l,a,h,_,S,y){return Ame(l.writeTree,l.treePath,a,h,_,S,y)}function KX(l,a,h){return bme(l.writeTree,l.treePath,a,h)}function ane(l,a){return cne(Jc(l.treePath,a),l.writeTree)}function cne(l,a){return{treePath:l,writeTree:a}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nme{constructor(){this.changeMap=new Map}trackChildChange(a){const h=a.type,_=a.childName;Xt(h==="child_added"||h==="child_changed"||h==="child_removed","Only child changes supported for tracking"),Xt(_!==".priority","Only non-priority child changes can be tracked.");const S=this.changeMap.get(_);if(S){const y=S.type;if(h==="child_added"&&y==="child_removed")this.changeMap.set(_,u3(_,a.snapshotNode,S.snapshotNode));else if(h==="child_removed"&&y==="child_added")this.changeMap.delete(_);else if(h==="child_removed"&&y==="child_changed")this.changeMap.set(_,d3(_,S.oldSnap));else if(h==="child_changed"&&y==="child_added")this.changeMap.set(_,Yk(_,a.snapshotNode));else if(h==="child_changed"&&y==="child_changed")this.changeMap.set(_,u3(_,a.snapshotNode,S.oldSnap));else throw tL("Illegal combination of changes: "+a+" occurred after "+S)}else this.changeMap.set(_,a)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dme{getCompleteChild(a){return null}getChildAfterChild(a,h,_){return null}}const lne=new Dme;class zX{constructor(a,h,_=null){this.writes_=a,this.viewCache_=h,this.optCompleteServerCache_=_}getCompleteChild(a){const h=this.viewCache_.eventCache;if(h.isCompleteForChild(a))return h.getNode().getImmediateChild(a);{const _=this.optCompleteServerCache_!=null?new sO(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return KX(this.writes_,a,_)}}getChildAfterChild(a,h,_){const S=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:oO(this.viewCache_),y=Ome(this.writes_,S,h,1,_,a);return y.length===0?null:y[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pme(l){return{filter:l}}function kme(l,a){Xt(a.eventCache.getNode().isIndexed(l.filter.getIndex()),"Event snap not indexed"),Xt(a.serverCache.getNode().isIndexed(l.filter.getIndex()),"Server snap not indexed")}function Lme(l,a,h,_,S){const y=new Nme;let b,D;if(h.type===SE.OVERWRITE){const x=h;x.source.fromUser?b=b7(l,a,x.path,x.snap,_,S,y):(Xt(x.source.fromServer,"Unknown source."),D=x.source.tagged||a.serverCache.isFiltered()&&!xr(x.path),b=FG(l,a,x.path,x.snap,_,S,D,y))}else if(h.type===SE.MERGE){const x=h;x.source.fromUser?b=Ume(l,a,x.path,x.children,_,S,y):(Xt(x.source.fromServer,"Unknown source."),D=x.source.tagged||a.serverCache.isFiltered(),b=I7(l,a,x.path,x.children,_,S,D,y))}else if(h.type===SE.ACK_USER_WRITE){const x=h;x.revert?b=Fme(l,a,x.path,_,S,y):b=xme(l,a,x.path,x.affectedTree,_,S,y)}else if(h.type===SE.LISTEN_COMPLETE)b=Vme(l,a,h.path,_,y);else throw tL("Unknown operation type: "+h.type);const U=y.getChanges();return Mme(a,b,U),{viewCache:b,changes:U}}function Mme(l,a,h){const _=a.eventCache;if(_.isFullyInitialized()){const S=_.getNode().isLeafNode()||_.getNode().isEmpty(),y=y7(l);(h.length>0||!l.eventCache.isFullyInitialized()||S&&!_.getNode().equals(y)||!_.getNode().getPriority().equals(y.getPriority()))&&h.push(ene(y7(a)))}}function dne(l,a,h,_,S,y){const b=a.eventCache;if(VG(_,h)!=null)return a;{let D,U;if(xr(h))if(Xt(a.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),a.serverCache.isFiltered()){const x=oO(a),q=x instanceof Pi?x:Pi.EMPTY_NODE,J=HX(_,q);D=l.filter.updateFullNode(a.eventCache.getNode(),J,y)}else{const x=xG(_,oO(a));D=l.filter.updateFullNode(a.eventCache.getNode(),x,y)}else{const x=Ir(h);if(x===".priority"){Xt(xb(h)===1,"Can't have a priority with additional path components");const q=b.getNode();U=a.serverCache.getNode();const J=JZ(_,h,q,U);J!=null?D=l.filter.updatePriority(q,J):D=b.getNode()}else{const q=Vo(h);let J;if(b.isCompleteForChild(x)){U=a.serverCache.getNode();const ee=JZ(_,h,b.getNode(),U);ee!=null?J=b.getNode().getImmediateChild(x).updateChild(q,ee):J=b.getNode().getImmediateChild(x)}else J=KX(_,x,a.serverCache);J!=null?D=l.filter.updateChild(b.getNode(),x,J,q,S,y):D=b.getNode()}}return qj(a,D,b.isFullyInitialized()||xr(h),l.filter.filtersNodes())}}function FG(l,a,h,_,S,y,b,D){const U=a.serverCache;let x;const q=b?l.filter:l.filter.getIndexedFilter();if(xr(h))x=q.updateFullNode(U.getNode(),_,null);else if(q.filtersNodes()&&!U.isFiltered()){const ue=U.getNode().updateChild(h,_);x=q.updateFullNode(U.getNode(),ue,null)}else{const ue=Ir(h);if(!U.isCompleteForPath(h)&&xb(h)>1)return a;const oe=Vo(h),pe=U.getNode().getImmediateChild(ue).updateChild(oe,_);ue===".priority"?x=q.updatePriority(U.getNode(),pe):x=q.updateChild(U.getNode(),ue,pe,oe,lne,null)}const J=ine(a,x,U.isFullyInitialized()||xr(h),q.filtersNodes()),ee=new zX(S,J,y);return dne(l,J,h,S,ee,D)}function b7(l,a,h,_,S,y,b){const D=a.eventCache;let U,x;const q=new zX(S,a,y);if(xr(h))x=l.filter.updateFullNode(a.eventCache.getNode(),_,b),U=qj(a,x,!0,l.filter.filtersNodes());else{const J=Ir(h);if(J===".priority")x=l.filter.updatePriority(a.eventCache.getNode(),_),U=qj(a,x,D.isFullyInitialized(),D.isFiltered());else{const ee=Vo(h),ue=D.getNode().getImmediateChild(J);let oe;if(xr(ee))oe=_;else{const le=q.getCompleteChild(J);le!=null?Kte(ee)===".priority"&&le.getChild(Yte(ee)).isEmpty()?oe=le:oe=le.updateChild(ee,_):oe=Pi.EMPTY_NODE}if(ue.equals(oe))U=a;else{const le=l.filter.updateChild(D.getNode(),J,oe,ee,q,b);U=qj(a,le,D.isFullyInitialized(),l.filter.filtersNodes())}}}return U}function QZ(l,a){return l.eventCache.isCompleteForChild(a)}function Ume(l,a,h,_,S,y,b){let D=a;return _.foreach((U,x)=>{const q=Jc(h,U);QZ(a,Ir(q))&&(D=b7(l,D,q,x,S,y,b))}),_.foreach((U,x)=>{const q=Jc(h,U);QZ(a,Ir(q))||(D=b7(l,D,q,x,S,y,b))}),D}function ZZ(l,a,h){return h.foreach((_,S)=>{a=a.updateChild(_,S)}),a}function I7(l,a,h,_,S,y,b,D){if(a.serverCache.getNode().isEmpty()&&!a.serverCache.isFullyInitialized())return a;let U=a,x;xr(h)?x=_:x=new sa(null).setTree(h,_);const q=a.serverCache.getNode();return x.children.inorderTraversal((J,ee)=>{if(q.hasChild(J)){const ue=a.serverCache.getNode().getImmediateChild(J),oe=ZZ(l,ue,ee);U=FG(l,U,new yo(J),oe,S,y,b,D)}}),x.children.inorderTraversal((J,ee)=>{const ue=!a.serverCache.isCompleteForChild(J)&&ee.value===null;if(!q.hasChild(J)&&!ue){const oe=a.serverCache.getNode().getImmediateChild(J),le=ZZ(l,oe,ee);U=FG(l,U,new yo(J),le,S,y,b,D)}}),U}function xme(l,a,h,_,S,y,b){if(VG(S,h)!=null)return a;const D=a.serverCache.isFiltered(),U=a.serverCache;if(_.value!=null){if(xr(h)&&U.isFullyInitialized()||U.isCompleteForPath(h))return FG(l,a,h,U.getNode().getChild(h),S,y,D,b);if(xr(h)){let x=new sa(null);return U.getNode().forEachChild(xk,(q,J)=>{x=x.set(new yo(q),J)}),I7(l,a,h,x,S,y,D,b)}else return a}else{let x=new sa(null);return _.foreach((q,J)=>{const ee=Jc(h,q);U.isCompleteForPath(ee)&&(x=x.set(q,U.getNode().getChild(ee)))}),I7(l,a,h,x,S,y,D,b)}}function Vme(l,a,h,_,S){const y=a.serverCache,b=ine(a,y.getNode(),y.isFullyInitialized()||xr(h),y.isFiltered());return dne(l,b,h,_,lne,S)}function Fme(l,a,h,_,S,y){let b;if(VG(_,h)!=null)return a;{const D=new zX(_,a,S),U=a.eventCache.getNode();let x;if(xr(h)||Ir(h)===".priority"){let q;if(a.serverCache.isFullyInitialized())q=xG(_,oO(a));else{const J=a.serverCache.getNode();Xt(J instanceof Pi,"serverChildren would be complete if leaf node"),q=HX(_,J)}q=q,x=l.filter.updateFullNode(U,q,y)}else{const q=Ir(h);let J=KX(_,q,a.serverCache);J==null&&a.serverCache.isCompleteForChild(q)&&(J=U.getImmediateChild(q)),J!=null?x=l.filter.updateChild(U,q,J,Vo(h),D,y):a.eventCache.getNode().hasChild(q)?x=l.filter.updateChild(U,q,Pi.EMPTY_NODE,Vo(h),D,y):x=U,x.isEmpty()&&a.serverCache.isFullyInitialized()&&(b=xG(_,oO(a)),b.isLeafNode()&&(x=l.filter.updateFullNode(x,b,y)))}return b=a.serverCache.isFullyInitialized()||VG(_,Ms())!=null,qj(a,x,b,l.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bme{constructor(a,h){this.query_=a,this.eventRegistrations_=[];const _=this.query_._queryParams,S=new FX(_.getIndex()),y=sme(_);this.processor_=Pme(y);const b=h.serverCache,D=h.eventCache,U=S.updateFullNode(Pi.EMPTY_NODE,b.getNode(),null),x=y.updateFullNode(Pi.EMPTY_NODE,D.getNode(),null),q=new sO(U,b.isFullyInitialized(),S.filtersNodes()),J=new sO(x,D.isFullyInitialized(),y.filtersNodes());this.viewCache_=bW(J,q),this.eventGenerator_=new hme(this.query_)}get query(){return this.query_}}function jme(l){return l.viewCache_.serverCache.getNode()}function Gme(l,a){const h=oO(l.viewCache_);return h&&(l.query._queryParams.loadsAllData()||!xr(a)&&!h.getImmediateChild(Ir(a)).isEmpty())?h.getChild(a):null}function $Z(l){return l.eventRegistrations_.length===0}function Wme(l,a){l.eventRegistrations_.push(a)}function e$(l,a,h){const _=[];if(h){Xt(a==null,"A cancel should cancel all event registrations.");const S=l.query._path;l.eventRegistrations_.forEach(y=>{const b=y.createCancelEvent(h,S);b&&_.push(b)})}if(a){let S=[];for(let y=0;y<l.eventRegistrations_.length;++y){const b=l.eventRegistrations_[y];if(!b.matches(a))S.push(b);else if(a.hasAnyCallback()){S=S.concat(l.eventRegistrations_.slice(y+1));break}}l.eventRegistrations_=S}else l.eventRegistrations_=[];return _}function t$(l,a,h,_){a.type===SE.MERGE&&a.source.queryId!==null&&(Xt(oO(l.viewCache_),"We should always have a full cache before handling merges"),Xt(y7(l.viewCache_),"Missing event cache, even though we have a server cache"));const S=l.viewCache_,y=Lme(l.processor_,S,a,h,_);return kme(l.processor_,y.viewCache),Xt(y.viewCache.serverCache.isFullyInitialized()||!S.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),l.viewCache_=y.viewCache,une(l,y.changes,y.viewCache.eventCache.getNode(),null)}function Hme(l,a){const h=l.viewCache_.eventCache,_=[];return h.getNode().isLeafNode()||h.getNode().forEachChild(Xa,(y,b)=>{_.push(Yk(y,b))}),h.isFullyInitialized()&&_.push(ene(h.getNode())),une(l,_,h.getNode(),a)}function une(l,a,h,_){const S=_?[_]:l.eventRegistrations_;return pme(l.eventGenerator_,a,h,S)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let BG;class Kme{constructor(){this.views=new Map}}function zme(l){Xt(!BG,"__referenceConstructor has already been defined"),BG=l}function Yme(){return Xt(BG,"Reference.ts has not been loaded"),BG}function qme(l){return l.views.size===0}function YX(l,a,h,_){const S=a.source.queryId;if(S!==null){const y=l.views.get(S);return Xt(y!=null,"SyncTree gave us an op for an invalid query."),t$(y,a,h,_)}else{let y=[];for(const b of l.views.values())y=y.concat(t$(b,a,h,_));return y}}function Xme(l,a,h,_,S){const y=a._queryIdentifier,b=l.views.get(y);if(!b){let D=xG(h,S?_:null),U=!1;D?U=!0:_ instanceof Pi?(D=HX(h,_),U=!1):(D=Pi.EMPTY_NODE,U=!1);const x=bW(new sO(D,U,!1),new sO(_,S,!1));return new Bme(a,x)}return b}function Jme(l,a,h,_,S,y){const b=Xme(l,a,_,S,y);return l.views.has(a._queryIdentifier)||l.views.set(a._queryIdentifier,b),Wme(b,h),Hme(b,h)}function Qme(l,a,h,_){const S=a._queryIdentifier,y=[];let b=[];const D=Vb(l);if(S==="default")for(const[U,x]of l.views.entries())b=b.concat(e$(x,h,_)),$Z(x)&&(l.views.delete(U),x.query._queryParams.loadsAllData()||y.push(x.query));else{const U=l.views.get(S);U&&(b=b.concat(e$(U,h,_)),$Z(U)&&(l.views.delete(S),U.query._queryParams.loadsAllData()||y.push(U.query)))}return D&&!Vb(l)&&y.push(new(Yme())(a._repo,a._path)),{removed:y,events:b}}function hne(l){const a=[];for(const h of l.views.values())h.query._queryParams.loadsAllData()||a.push(h);return a}function Vk(l,a){let h=null;for(const _ of l.views.values())h=h||Gme(_,a);return h}function pne(l,a){if(a._queryParams.loadsAllData())return IW(l);{const _=a._queryIdentifier;return l.views.get(_)}}function fne(l,a){return pne(l,a)!=null}function Vb(l){return IW(l)!=null}function IW(l){for(const a of l.views.values())if(a.query._queryParams.loadsAllData())return a;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jG;function Zme(l){Xt(!jG,"__referenceConstructor has already been defined"),jG=l}function $me(){return Xt(jG,"Reference.ts has not been loaded"),jG}let eEe=1;class n${constructor(a){this.listenProvider_=a,this.syncPointTree_=new sa(null),this.pendingWriteTree_=wme(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function _ne(l,a,h,_,S){return Eme(l.pendingWriteTree_,a,h,_,S),S?L3(l,new rO(nne(),a,h)):[]}function Q0(l,a,h=!1){const _=gme(l.pendingWriteTree_,a);if(Sme(l.pendingWriteTree_,a)){let y=new sa(null);return _.snap!=null?y=y.set(Ms(),!0):Wh(_.children,b=>{y=y.set(new yo(b),!0)}),L3(l,new UG(_.path,y,h))}else return[]}function AW(l,a,h){return L3(l,new rO(jX(),a,h))}function tEe(l,a,h){const _=sa.fromObject(h);return L3(l,new f3(jX(),a,_))}function nEe(l,a){return L3(l,new p3(jX(),a))}function iEe(l,a,h){const _=XX(l,h);if(_){const S=JX(_),y=S.path,b=S.queryId,D=Fh(y,a),U=new p3(GX(b),D);return QX(l,y,U)}else return[]}function A7(l,a,h,_,S=!1){const y=a._path,b=l.syncPointTree_.get(y);let D=[];if(b&&(a._queryIdentifier==="default"||fne(b,a))){const U=Qme(b,a,h,_);qme(b)&&(l.syncPointTree_=l.syncPointTree_.remove(y));const x=U.removed;if(D=U.events,!S){const q=x.findIndex(ee=>ee._queryParams.loadsAllData())!==-1,J=l.syncPointTree_.findOnPath(y,(ee,ue)=>Vb(ue));if(q&&!J){const ee=l.syncPointTree_.subtree(y);if(!ee.isEmpty()){const ue=oEe(ee);for(let oe=0;oe<ue.length;++oe){const le=ue[oe],pe=le.query,Ne=gne(l,le);l.listenProvider_.startListening(Jj(pe),GG(l,pe),Ne.hashFn,Ne.onComplete)}}}!J&&x.length>0&&!_&&(q?l.listenProvider_.stopListening(Jj(a),null):x.forEach(ee=>{const ue=l.queryToTagMap.get(wW(ee));l.listenProvider_.stopListening(Jj(ee),ue)}))}aEe(l,x)}return D}function rEe(l,a,h,_){const S=XX(l,_);if(S!=null){const y=JX(S),b=y.path,D=y.queryId,U=Fh(b,a),x=new rO(GX(D),U,h);return QX(l,b,x)}else return[]}function sEe(l,a,h,_){const S=XX(l,_);if(S){const y=JX(S),b=y.path,D=y.queryId,U=Fh(b,a),x=sa.fromObject(h),q=new f3(GX(D),U,x);return QX(l,b,q)}else return[]}function i$(l,a,h,_=!1){const S=a._path;let y=null,b=!1;l.syncPointTree_.foreachOnPath(S,(ee,ue)=>{const oe=Fh(ee,S);y=y||Vk(ue,oe),b=b||Vb(ue)});let D=l.syncPointTree_.get(S);D?(b=b||Vb(D),y=y||Vk(D,Ms())):(D=new Kme,l.syncPointTree_=l.syncPointTree_.set(S,D));let U;y!=null?U=!0:(U=!1,y=Pi.EMPTY_NODE,l.syncPointTree_.subtree(S).foreachChild((ue,oe)=>{const le=Vk(oe,Ms());le&&(y=y.updateImmediateChild(ue,le))}));const x=fne(D,a);if(!x&&!a._queryParams.loadsAllData()){const ee=wW(a);Xt(!l.queryToTagMap.has(ee),"View does not exist, but we have a tag");const ue=cEe();l.queryToTagMap.set(ee,ue),l.tagToQueryMap.set(ue,ee)}const q=WX(l.pendingWriteTree_,S);let J=Jme(D,a,h,q,y,U);if(!x&&!b&&!_){const ee=pne(D,a);J=J.concat(lEe(l,a,ee))}return J}function qX(l,a,h){const S=l.pendingWriteTree_,y=l.syncPointTree_.findOnPath(a,(b,D)=>{const U=Fh(b,a),x=Vk(D,U);if(x)return x});return one(S,a,y,h,!0)}function L3(l,a){return mne(a,l.syncPointTree_,null,WX(l.pendingWriteTree_,Ms()))}function mne(l,a,h,_){if(xr(l.path))return Ene(l,a,h,_);{const S=a.get(Ms());h==null&&S!=null&&(h=Vk(S,Ms()));let y=[];const b=Ir(l.path),D=l.operationForChild(b),U=a.children.get(b);if(U&&D){const x=h?h.getImmediateChild(b):null,q=ane(_,b);y=y.concat(mne(D,U,x,q))}return S&&(y=y.concat(YX(S,l,_,h))),y}}function Ene(l,a,h,_){const S=a.get(Ms());h==null&&S!=null&&(h=Vk(S,Ms()));let y=[];return a.children.inorderTraversal((b,D)=>{const U=h?h.getImmediateChild(b):null,x=ane(_,b),q=l.operationForChild(b);q&&(y=y.concat(Ene(q,D,U,x)))}),S&&(y=y.concat(YX(S,l,_,h))),y}function gne(l,a){const h=a.query,_=GG(l,h);return{hashFn:()=>(jme(a)||Pi.EMPTY_NODE).hash(),onComplete:S=>{if(S==="ok")return _?iEe(l,h._path,_):nEe(l,h._path);{const y=r_e(S,h);return A7(l,h,null,y)}}}}function GG(l,a){const h=wW(a);return l.queryToTagMap.get(h)}function wW(l){return l._path.toString()+"$"+l._queryIdentifier}function XX(l,a){return l.tagToQueryMap.get(a)}function JX(l){const a=l.indexOf("$");return Xt(a!==-1&&a<l.length-1,"Bad queryKey."),{queryId:l.substr(a+1),path:new yo(l.substr(0,a))}}function QX(l,a,h){const _=l.syncPointTree_.get(a);Xt(_,"Missing sync point for query tag that we're tracking");const S=WX(l.pendingWriteTree_,a);return YX(_,h,S,null)}function oEe(l){return l.fold((a,h,_)=>{if(h&&Vb(h))return[IW(h)];{let S=[];return h&&(S=hne(h)),Wh(_,(y,b)=>{S=S.concat(b)}),S}})}function Jj(l){return l._queryParams.loadsAllData()&&!l._queryParams.isDefault()?new($me())(l._repo,l._path):l}function aEe(l,a){for(let h=0;h<a.length;++h){const _=a[h];if(!_._queryParams.loadsAllData()){const S=wW(_),y=l.queryToTagMap.get(S);l.queryToTagMap.delete(S),l.tagToQueryMap.delete(y)}}}function cEe(){return eEe++}function lEe(l,a,h){const _=a._path,S=GG(l,a),y=gne(l,h),b=l.listenProvider_.startListening(Jj(a),S,y.hashFn,y.onComplete),D=l.syncPointTree_.subtree(_);if(S)Xt(!Vb(D.value),"If we're adding a query, it shouldn't be shadowed");else{const U=D.fold((x,q,J)=>{if(!xr(x)&&q&&Vb(q))return[IW(q).query];{let ee=[];return q&&(ee=ee.concat(hne(q).map(ue=>ue.query))),Wh(J,(ue,oe)=>{ee=ee.concat(oe)}),ee}});for(let x=0;x<U.length;++x){const q=U[x];l.listenProvider_.stopListening(Jj(q),GG(l,q))}}return b}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZX{constructor(a){this.node_=a}getImmediateChild(a){const h=this.node_.getImmediateChild(a);return new ZX(h)}node(){return this.node_}}class $X{constructor(a,h){this.syncTree_=a,this.path_=h}getImmediateChild(a){const h=Jc(this.path_,a);return new $X(this.syncTree_,h)}node(){return qX(this.syncTree_,this.path_)}}const dEe=function(l){return l=l||{},l.timestamp=l.timestamp||new Date().getTime(),l},r$=function(l,a,h){if(!l||typeof l!="object")return l;if(Xt(".sv"in l,"Unexpected leaf node or priority contents"),typeof l[".sv"]=="string")return uEe(l[".sv"],a,h);if(typeof l[".sv"]=="object")return hEe(l[".sv"],a);Xt(!1,"Unexpected server value: "+JSON.stringify(l,null,2))},uEe=function(l,a,h){switch(l){case"timestamp":return h.timestamp;default:Xt(!1,"Unexpected server value: "+l)}},hEe=function(l,a,h){l.hasOwnProperty("increment")||Xt(!1,"Unexpected server value: "+JSON.stringify(l,null,2));const _=l.increment;typeof _!="number"&&Xt(!1,"Unexpected increment value: "+_);const S=a.node();if(Xt(S!==null&&typeof S<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!S.isLeafNode())return _;const b=S.getValue();return typeof b!="number"?_:b+_},pEe=function(l,a,h,_){return eJ(a,new $X(h,l),_)},Sne=function(l,a,h){return eJ(l,new ZX(a),h)};function eJ(l,a,h){const _=l.getPriority().val(),S=r$(_,a.getImmediateChild(".priority"),h);let y;if(l.isLeafNode()){const b=l,D=r$(b.getValue(),a,h);return D!==b.getValue()||S!==b.getPriority().val()?new Il(D,ad(S)):l}else{const b=l;return y=b,S!==b.getPriority().val()&&(y=y.updatePriority(new Il(S))),b.forEachChild(Xa,(D,U)=>{const x=eJ(U,a.getImmediateChild(D),h);x!==U&&(y=y.updateImmediateChild(D,x))}),y}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tJ{constructor(a="",h=null,_={children:{},childCount:0}){this.name=a,this.parent=h,this.node=_}}function nJ(l,a){let h=a instanceof yo?a:new yo(a),_=l,S=Ir(h);for(;S!==null;){const y=Hk(_.node.children,S)||{children:{},childCount:0};_=new tJ(S,_,y),h=Vo(h),S=Ir(h)}return _}function sL(l){return l.node.value}function Tne(l,a){l.node.value=a,w7(l)}function vne(l){return l.node.childCount>0}function fEe(l){return sL(l)===void 0&&!vne(l)}function OW(l,a){Wh(l.node.children,(h,_)=>{a(new tJ(h,l,_))})}function yne(l,a,h,_){h&&a(l),OW(l,S=>{yne(S,a,!0)})}function _Ee(l,a,h){let _=l.parent;for(;_!==null;){if(a(_))return!0;_=_.parent}return!1}function M3(l){return new yo(l.parent===null?l.name:M3(l.parent)+"/"+l.name)}function w7(l){l.parent!==null&&mEe(l.parent,l.name,l)}function mEe(l,a,h){const _=fEe(h),S=Ey(l.node.children,a);_&&S?(delete l.node.children[a],l.node.childCount--,w7(l)):!_&&!S&&(l.node.children[a]=h.node,l.node.childCount++,w7(l))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EEe=/[\[\].#$\/\u0000-\u001F\u007F]/,gEe=/[\[\].#$\u0000-\u001F\u007F]/,Fq=10*1024*1024,Rne=function(l){return typeof l=="string"&&l.length!==0&&!EEe.test(l)},Cne=function(l){return typeof l=="string"&&l.length!==0&&!gEe.test(l)},SEe=function(l){return l&&(l=l.replace(/^\/*\.info(\/|$)/,"/")),Cne(l)},bne=function(l,a,h,_){_&&a===void 0||iJ(CX(l,"value"),a,h)},iJ=function(l,a,h){const _=h instanceof yo?new x_e(h,l):h;if(a===void 0)throw new Error(l+"contains undefined "+W0(_));if(typeof a=="function")throw new Error(l+"contains a function "+W0(_)+" with contents = "+a.toString());if(Cte(a))throw new Error(l+"contains "+a.toString()+" "+W0(_));if(typeof a=="string"&&a.length>Fq/3&&vW(a)>Fq)throw new Error(l+"contains a string greater than "+Fq+" utf8 bytes "+W0(_)+" ('"+a.substring(0,50)+"...')");if(a&&typeof a=="object"){let S=!1,y=!1;if(Wh(a,(b,D)=>{if(b===".value")S=!0;else if(b!==".priority"&&b!==".sv"&&(y=!0,!Rne(b)))throw new Error(l+" contains an invalid key ("+b+") "+W0(_)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);V_e(_,b),iJ(l,D,_),F_e(_)}),S&&y)throw new Error(l+' contains ".value" child '+W0(_)+" in addition to actual children.")}},Ine=function(l,a,h,_){if(!Cne(h))throw new Error(CX(l,a)+'was an invalid path = "'+h+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},TEe=function(l,a,h,_){h&&(h=h.replace(/^\/*\.info(\/|$)/,"/")),Ine(l,a,h)},Ane=function(l,a){if(Ir(a)===".info")throw new Error(l+" failed = Can't modify data under /.info/")},vEe=function(l,a){const h=a.path.toString();if(typeof a.repoInfo.host!="string"||a.repoInfo.host.length===0||!Rne(a.repoInfo.namespace)&&a.repoInfo.host.split(":")[0]!=="localhost"||h.length!==0&&!SEe(h))throw new Error(CX(l,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yEe{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function rJ(l,a){let h=null;for(let _=0;_<a.length;_++){const S=a[_],y=S.getPath();h!==null&&!UX(y,h.path)&&(l.eventLists_.push(h),h=null),h===null&&(h={events:[],path:y}),h.events.push(S)}h&&l.eventLists_.push(h)}function wne(l,a,h){rJ(l,h),One(l,_=>UX(_,a))}function hy(l,a,h){rJ(l,h),One(l,_=>gE(_,a)||gE(a,_))}function One(l,a){l.recursionDepth_++;let h=!0;for(let _=0;_<l.eventLists_.length;_++){const S=l.eventLists_[_];if(S){const y=S.path;a(y)?(REe(l.eventLists_[_]),l.eventLists_[_]=null):h=!1}}h&&(l.eventLists_=[]),l.recursionDepth_--}function REe(l){for(let a=0;a<l.events.length;a++){const h=l.events[a];if(h!==null){l.events[a]=null;const _=h.getEventRunner();zj&&Hd("event: "+h.toString()),rL(_)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CEe="repo_interrupt",bEe=25;class IEe{constructor(a,h,_,S){this.repoInfo_=a,this.forceRestClient_=h,this.authTokenProvider_=_,this.appCheckProvider_=S,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new yEe,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=MG(),this.transactionQueueTree_=new tJ,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function AEe(l,a,h){if(l.stats_=LX(l.repoInfo_),l.forceRestClient_||c_e())l.server_=new LG(l.repoInfo_,(_,S,y,b)=>{s$(l,_,S,y,b)},l.authTokenProvider_,l.appCheckProvider_),setTimeout(()=>o$(l,!0),0);else{if(typeof h<"u"&&h!==null){if(typeof h!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{wl(h)}catch(_){throw new Error("Invalid authOverride provided: "+_)}}l.persistentConnection_=new sy(l.repoInfo_,a,(_,S,y,b)=>{s$(l,_,S,y,b)},_=>{o$(l,_)},_=>{wEe(l,_)},l.authTokenProvider_,l.appCheckProvider_,h),l.server_=l.persistentConnection_}l.authTokenProvider_.addTokenChangeListener(_=>{l.server_.refreshAuthToken(_)}),l.appCheckProvider_.addTokenChangeListener(_=>{l.server_.refreshAppCheckToken(_.token)}),l.statsReporter_=p_e(l.repoInfo_,()=>new ume(l.stats_,l.server_)),l.infoData_=new ome,l.infoSyncTree_=new n$({startListening:(_,S,y,b)=>{let D=[];const U=l.infoData_.getNode(_._path);return U.isEmpty()||(D=AW(l.infoSyncTree_,_._path,U),setTimeout(()=>{b("ok")},0)),D},stopListening:()=>{}}),oJ(l,"connected",!1),l.serverSyncTree_=new n$({startListening:(_,S,y,b)=>(l.server_.listen(_,y,S,(D,U)=>{const x=b(D,U);hy(l.eventQueue_,_._path,x)}),[]),stopListening:(_,S)=>{l.server_.unlisten(_,S)}})}function Nne(l){const h=l.infoData_.getNode(new yo(".info/serverTimeOffset")).val()||0;return new Date().getTime()+h}function sJ(l){return dEe({timestamp:Nne(l)})}function s$(l,a,h,_,S){l.dataUpdateCount++;const y=new yo(a);h=l.interceptServerDataCallback_?l.interceptServerDataCallback_(a,h):h;let b=[];if(S)if(_){const U=wG(h,x=>ad(x));b=sEe(l.serverSyncTree_,y,U,S)}else{const U=ad(h);b=rEe(l.serverSyncTree_,y,U,S)}else if(_){const U=wG(h,x=>ad(x));b=tEe(l.serverSyncTree_,y,U)}else{const U=ad(h);b=AW(l.serverSyncTree_,y,U)}let D=y;b.length>0&&(D=NW(l,y)),hy(l.eventQueue_,D,b)}function o$(l,a){oJ(l,"connected",a),a===!1&&NEe(l)}function wEe(l,a){Wh(a,(h,_)=>{oJ(l,h,_)})}function oJ(l,a,h){const _=new yo("/.info/"+a),S=ad(h);l.infoData_.updateSnapshot(_,S);const y=AW(l.infoSyncTree_,_,S);hy(l.eventQueue_,_,y)}function Dne(l){return l.nextWriteId_++}function OEe(l,a,h,_,S){aJ(l,"set",{path:a.toString(),value:h,priority:_});const y=sJ(l),b=ad(h,_),D=qX(l.serverSyncTree_,a),U=Sne(b,D,y),x=Dne(l),q=_ne(l.serverSyncTree_,a,U,x,!0);rJ(l.eventQueue_,q),l.server_.put(a.toString(),b.val(!0),(ee,ue)=>{const oe=ee==="ok";oe||jh("set at "+a+" failed: "+ee);const le=Q0(l.serverSyncTree_,x,!oe);hy(l.eventQueue_,a,le),kEe(l,S,ee,ue)});const J=xne(l,a);NW(l,J),hy(l.eventQueue_,J,[])}function NEe(l){aJ(l,"onDisconnectEvents");const a=sJ(l),h=MG();v7(l.onDisconnect_,Ms(),(S,y)=>{const b=pEe(S,y,l.serverSyncTree_,a);tne(h,S,b)});let _=[];v7(h,Ms(),(S,y)=>{_=_.concat(AW(l.serverSyncTree_,S,y));const b=xne(l,S);NW(l,b)}),l.onDisconnect_=MG(),hy(l.eventQueue_,Ms(),_)}function DEe(l,a,h){let _;Ir(a._path)===".info"?_=i$(l.infoSyncTree_,a,h):_=i$(l.serverSyncTree_,a,h),wne(l.eventQueue_,a._path,_)}function Pne(l,a,h){let _;Ir(a._path)===".info"?_=A7(l.infoSyncTree_,a,h):_=A7(l.serverSyncTree_,a,h),wne(l.eventQueue_,a._path,_)}function PEe(l){l.persistentConnection_&&l.persistentConnection_.interrupt(CEe)}function aJ(l,...a){let h="";l.persistentConnection_&&(h=l.persistentConnection_.id+":"),Hd(h,...a)}function kEe(l,a,h,_){a&&rL(()=>{if(h==="ok")a(null);else{const S=(h||"error").toUpperCase();let y=S;_&&(y+=": "+_);const b=new Error(y);b.code=S,a(b)}})}function kne(l,a,h){return qX(l.serverSyncTree_,a,h)||Pi.EMPTY_NODE}function cJ(l,a=l.transactionQueueTree_){if(a||DW(l,a),sL(a)){const h=Mne(l,a);Xt(h.length>0,"Sending zero length transaction queue"),h.every(S=>S.status===0)&&LEe(l,M3(a),h)}else vne(a)&&OW(a,h=>{cJ(l,h)})}function LEe(l,a,h){const _=h.map(x=>x.currentWriteId),S=kne(l,a,_);let y=S;const b=S.hash();for(let x=0;x<h.length;x++){const q=h[x];Xt(q.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),q.status=1,q.retryCount++;const J=Fh(a,q.path);y=y.updateChild(J,q.currentOutputSnapshotRaw)}const D=y.val(!0),U=a;l.server_.put(U.toString(),D,x=>{aJ(l,"transaction put response",{path:U.toString(),status:x});let q=[];if(x==="ok"){const J=[];for(let ee=0;ee<h.length;ee++)h[ee].status=2,q=q.concat(Q0(l.serverSyncTree_,h[ee].currentWriteId)),h[ee].onComplete&&J.push(()=>h[ee].onComplete(null,!0,h[ee].currentOutputSnapshotResolved)),h[ee].unwatcher();DW(l,nJ(l.transactionQueueTree_,a)),cJ(l,l.transactionQueueTree_),hy(l.eventQueue_,a,q);for(let ee=0;ee<J.length;ee++)rL(J[ee])}else{if(x==="datastale")for(let J=0;J<h.length;J++)h[J].status===3?h[J].status=4:h[J].status=0;else{jh("transaction at "+U.toString()+" failed: "+x);for(let J=0;J<h.length;J++)h[J].status=4,h[J].abortReason=x}NW(l,a)}},b)}function NW(l,a){const h=Lne(l,a),_=M3(h),S=Mne(l,h);return MEe(l,S,_),_}function MEe(l,a,h){if(a.length===0)return;const _=[];let S=[];const b=a.filter(D=>D.status===0).map(D=>D.currentWriteId);for(let D=0;D<a.length;D++){const U=a[D],x=Fh(h,U.path);let q=!1,J;if(Xt(x!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),U.status===4)q=!0,J=U.abortReason,S=S.concat(Q0(l.serverSyncTree_,U.currentWriteId,!0));else if(U.status===0)if(U.retryCount>=bEe)q=!0,J="maxretry",S=S.concat(Q0(l.serverSyncTree_,U.currentWriteId,!0));else{const ee=kne(l,U.path,b);U.currentInputSnapshot=ee;const ue=a[D].update(ee.val());if(ue!==void 0){iJ("transaction failed: Data returned ",ue,U.path);let oe=ad(ue);typeof ue=="object"&&ue!=null&&Ey(ue,".priority")||(oe=oe.updatePriority(ee.getPriority()));const pe=U.currentWriteId,Ne=sJ(l),Ve=Sne(oe,ee,Ne);U.currentOutputSnapshotRaw=oe,U.currentOutputSnapshotResolved=Ve,U.currentWriteId=Dne(l),b.splice(b.indexOf(pe),1),S=S.concat(_ne(l.serverSyncTree_,U.path,Ve,U.currentWriteId,U.applyLocally)),S=S.concat(Q0(l.serverSyncTree_,pe,!0))}else q=!0,J="nodata",S=S.concat(Q0(l.serverSyncTree_,U.currentWriteId,!0))}hy(l.eventQueue_,h,S),S=[],q&&(a[D].status=2,(function(ee){setTimeout(ee,Math.floor(0))})(a[D].unwatcher),a[D].onComplete&&(J==="nodata"?_.push(()=>a[D].onComplete(null,!1,a[D].currentInputSnapshot)):_.push(()=>a[D].onComplete(new Error(J),!1,null))))}DW(l,l.transactionQueueTree_);for(let D=0;D<_.length;D++)rL(_[D]);cJ(l,l.transactionQueueTree_)}function Lne(l,a){let h,_=l.transactionQueueTree_;for(h=Ir(a);h!==null&&sL(_)===void 0;)_=nJ(_,h),a=Vo(a),h=Ir(a);return _}function Mne(l,a){const h=[];return Une(l,a,h),h.sort((_,S)=>_.order-S.order),h}function Une(l,a,h){const _=sL(a);if(_)for(let S=0;S<_.length;S++)h.push(_[S]);OW(a,S=>{Une(l,S,h)})}function DW(l,a){const h=sL(a);if(h){let _=0;for(let S=0;S<h.length;S++)h[S].status!==2&&(h[_]=h[S],_++);h.length=_,Tne(a,h.length>0?h:void 0)}OW(a,_=>{DW(l,_)})}function xne(l,a){const h=M3(Lne(l,a)),_=nJ(l.transactionQueueTree_,a);return _Ee(_,S=>{Bq(l,S)}),Bq(l,_),yne(_,S=>{Bq(l,S)}),h}function Bq(l,a){const h=sL(a);if(h){const _=[];let S=[],y=-1;for(let b=0;b<h.length;b++)h[b].status===3||(h[b].status===1?(Xt(y===b-1,"All SENT items should be at beginning of queue."),y=b,h[b].status=3,h[b].abortReason="set"):(Xt(h[b].status===0,"Unexpected transaction status in abort"),h[b].unwatcher(),S=S.concat(Q0(l.serverSyncTree_,h[b].currentWriteId,!0)),h[b].onComplete&&_.push(h[b].onComplete.bind(null,new Error("set"),!1,null))));y===-1?Tne(a,void 0):h.length=y+1,hy(l.eventQueue_,M3(a),S);for(let b=0;b<_.length;b++)rL(_[b])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UEe(l){let a="";const h=l.split("/");for(let _=0;_<h.length;_++)if(h[_].length>0){let S=h[_];try{S=decodeURIComponent(S.replace(/\+/g," "))}catch{}a+="/"+S}return a}function xEe(l){const a={};l.charAt(0)==="?"&&(l=l.substring(1));for(const h of l.split("&")){if(h.length===0)continue;const _=h.split("=");_.length===2?a[decodeURIComponent(_[0])]=decodeURIComponent(_[1]):jh(`Invalid query segment '${h}' in query '${l}'`)}return a}const a$=function(l,a){const h=VEe(l),_=h.namespace;h.domain==="firebase.com"&&uy(h.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!_||_==="undefined")&&h.domain!=="localhost"&&uy("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),h.secure||$fe();const S=h.scheme==="ws"||h.scheme==="wss";return{repoInfo:new Ute(h.host,h.secure,_,S,a,"",_!==h.subdomain),path:new yo(h.pathString)}},VEe=function(l){let a="",h="",_="",S="",y="",b=!0,D="https",U=443;if(typeof l=="string"){let x=l.indexOf("//");x>=0&&(D=l.substring(0,x-1),l=l.substring(x+2));let q=l.indexOf("/");q===-1&&(q=l.length);let J=l.indexOf("?");J===-1&&(J=l.length),a=l.substring(0,Math.min(q,J)),q<J&&(S=UEe(l.substring(q,J)));const ee=xEe(l.substring(Math.min(l.length,J)));x=a.indexOf(":"),x>=0?(b=D==="https"||D==="wss",U=parseInt(a.substring(x+1),10)):x=a.length;const ue=a.slice(0,x);if(ue.toLowerCase()==="localhost")h="localhost";else if(ue.split(".").length<=2)h=ue;else{const oe=a.indexOf(".");_=a.substring(0,oe).toLowerCase(),h=a.substring(oe+1),y=_}"ns"in ee&&(y=ee.ns)}return{host:a,port:U,domain:h,subdomain:_,secure:b,scheme:D,pathString:S,namespace:y}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c$="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",FEe=(function(){let l=0;const a=[];return function(h){const _=h===l;l=h;let S;const y=new Array(8);for(S=7;S>=0;S--)y[S]=c$.charAt(h%64),h=Math.floor(h/64);Xt(h===0,"Cannot push at time == 0");let b=y.join("");if(_){for(S=11;S>=0&&a[S]===63;S--)a[S]=0;a[S]++}else for(S=0;S<12;S++)a[S]=Math.floor(Math.random()*64);for(S=0;S<12;S++)b+=c$.charAt(a[S]);return Xt(b.length===20,"nextPushId: Length should be 20."),b}})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BEe{constructor(a,h,_,S){this.eventType=a,this.eventRegistration=h,this.snapshot=_,this.prevName=S}getPath(){const a=this.snapshot.ref;return this.eventType==="value"?a._path:a.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+wl(this.snapshot.exportVal())}}class jEe{constructor(a,h,_){this.eventRegistration=a,this.error=h,this.path=_}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GEe{constructor(a,h){this.snapshotCallback=a,this.cancelCallback=h}onValue(a,h){this.snapshotCallback.call(null,a,h)}onCancel(a){return Xt(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,a)}get hasCancelCallback(){return!!this.cancelCallback}matches(a){return this.snapshotCallback===a.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===a.snapshotCallback.userCallback&&this.snapshotCallback.context===a.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lJ{constructor(a,h,_,S){this._repo=a,this._path=h,this._queryParams=_,this._orderByCalled=S}get key(){return xr(this._path)?null:Kte(this._path)}get ref(){return new Fb(this._repo,this._path)}get _queryIdentifier(){const a=KZ(this._queryParams),h=PX(a);return h==="{}"?"default":h}get _queryObject(){return KZ(this._queryParams)}isEqual(a){if(a=yf(a),!(a instanceof lJ))return!1;const h=this._repo===a._repo,_=UX(this._path,a._path),S=this._queryIdentifier===a._queryIdentifier;return h&&_&&S}toJSON(){return this.toString()}toString(){return this._repo.toString()+U_e(this._path)}}class Fb extends lJ{constructor(a,h){super(a,h,new BX,!1)}get parent(){const a=Yte(this._path);return a===null?null:new Fb(this._repo,a)}get root(){let a=this;for(;a.parent!==null;)a=a.parent;return a}}class WG{constructor(a,h,_){this._node=a,this.ref=h,this._index=_}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(a){const h=new yo(a),_=_3(this.ref,a);return new WG(this._node.getChild(h),_,Xa)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(a){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(_,S)=>a(new WG(S,_3(this.ref,_),Xa)))}hasChild(a){const h=new yo(a);return!this._node.getChild(h).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function WEe(l,a){return l=yf(l),l._checkNotDeleted("ref"),a!==void 0?_3(l._root,a):l._root}function _3(l,a){return l=yf(l),Ir(l._path)===null?TEe("child","path",a):Ine("child","path",a),new Fb(l._repo,Jc(l._path,a))}function HEe(l,a){l=yf(l),Ane("push",l._path),bne("push",a,l._path,!0);const h=Nne(l._repo),_=FEe(h),S=_3(l,_),y=_3(l,_);let b;return a!=null?b=KEe(y,a).then(()=>y):b=Promise.resolve(y),S.then=b.then.bind(b),S.catch=b.then.bind(b,void 0),S}function KEe(l,a){l=yf(l),Ane("set",l._path),bne("set",a,l._path,!1);const h=new TW;return OEe(l._repo,l._path,a,null,h.wrapCallback(()=>{})),h.promise}class dJ{constructor(a){this.callbackContext=a}respondsTo(a){return a==="value"}createEvent(a,h){const _=h._queryParams.getIndex();return new BEe("value",this,new WG(a.snapshotNode,new Fb(h._repo,h._path),_))}getEventRunner(a){return a.getEventType()==="cancel"?()=>this.callbackContext.onCancel(a.error):()=>this.callbackContext.onValue(a.snapshot,null)}createCancelEvent(a,h){return this.callbackContext.hasCancelCallback?new jEe(this,a,h):null}matches(a){return a instanceof dJ?!a.callbackContext||!this.callbackContext?!0:a.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function zEe(l,a,h,_,S){const y=new GEe(h,void 0),b=new dJ(y);return DEe(l._repo,l,b),()=>Pne(l._repo,l,b)}function YEe(l,a,h,_){return zEe(l,"value",a)}function qEe(l,a,h){Pne(l._repo,l,null)}zme(Fb);Zme(Fb);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XEe="FIREBASE_DATABASE_EMULATOR_HOST",O7={};let JEe=!1;function QEe(l,a,h,_){const S=a.lastIndexOf(":"),y=a.substring(0,S),b=lO(y);l.repoInfo_=new Ute(a,b,l.repoInfo_.namespace,l.repoInfo_.webSocketOnly,l.repoInfo_.nodeAdmin,l.repoInfo_.persistenceKey,l.repoInfo_.includeNamespaceInQueryParams,!0,h),_&&(l.authTokenProvider_=_)}function ZEe(l,a,h,_,S){let y=_||l.options.databaseURL;y===void 0&&(l.options.projectId||uy("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Hd("Using default host for project ",l.options.projectId),y=`${l.options.projectId}-default-rtdb.firebaseio.com`);let b=a$(y,S),D=b.repoInfo,U;typeof process<"u"&&AZ&&(U=AZ[XEe]),U?(y=`http://${U}?ns=${D.namespace}`,b=a$(y,S),D=b.repoInfo):b.repoInfo.secure;const x=new d_e(l.name,l.options,a);vEe("Invalid Firebase Database URL",b),xr(b.path)||uy("Database URL must point to the root of a Firebase Database (not including a child path).");const q=ege(D,l,x,new l_e(l,h));return new tge(q,l)}function $Ee(l,a){const h=O7[a];(!h||h[l.key]!==l)&&uy(`Database ${a}(${l.repoInfo_}) has already been deleted.`),PEe(l),delete h[l.key]}function ege(l,a,h,_){let S=O7[a.name];S||(S={},O7[a.name]=S);let y=S[l.toURLString()];return y&&uy("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),y=new IEe(l,JEe,h,_),S[l.toURLString()]=y,y}class tge{constructor(a,h){this._repoInternal=a,this.app=h,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(AEe(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Fb(this._repo,Ms())),this._rootInternal}_delete(){return this._rootInternal!==null&&($Ee(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(a){this._rootInternal===null&&uy("Cannot call "+a+" on a deleted database.")}}function nge(l=IX(),a){const h=RW(l,"database").getImmediate({identifier:a});if(!h._instanceStarted){const _=nte("database");_&&ige(h,..._)}return h}function ige(l,a,h,_={}){l=yf(l),l._checkNotDeleted("useEmulator");const S=`${a}:${h}`,y=l._repoInternal;if(l._instanceStarted){if(S===l._repoInternal.repoInfo_.host&&Lb(_,y.repoInfo_.emulatorOptions))return;uy("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let b;if(y.repoInfo_.nodeAdmin)_.mockUserToken&&uy('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),b=new lG(lG.OWNER);else if(_.mockUserToken){const D=typeof _.mockUserToken=="string"?_.mockUserToken:ste(_.mockUserToken,l.app.options.projectId);b=new lG(D)}lO(a)&&(vX(a),yX("Database",!0)),QEe(y,S,_,b)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rge(l){Yfe(dO),tO(new Mb("database",(a,{instanceIdentifier:h})=>{const _=a.getProvider("app").getImmediate(),S=a.getProvider("auth-internal"),y=a.getProvider("app-check-internal");return ZEe(_,S,y,h)},"PUBLIC").setMultipleInstances(!0)),IS(wZ,OZ,l),IS(wZ,OZ,"esm2020")}sy.prototype.simpleListen=function(l,a){this.sendRequest("q",{p:l},a)};sy.prototype.echo=function(l,a){this.sendRequest("echo",{d:l},a)};rge();function Vne(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const sge=Vne,Fne=new w3("auth","Firebase",Vne());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HG=new yW("@firebase/auth");function oge(l,...a){HG.logLevel<=Ls.WARN&&HG.warn(`Auth (${dO}): ${l}`,...a)}function dG(l,...a){HG.logLevel<=Ls.ERROR&&HG.error(`Auth (${dO}): ${l}`,...a)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function py(l,...a){throw uJ(l,...a)}function AS(l,...a){return uJ(l,...a)}function Bne(l,a,h){const _={...sge(),[a]:h};return new w3("auth","Firebase",_).create(a,{appName:l.name})}function eO(l){return Bne(l,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function uJ(l,...a){if(typeof l!="string"){const h=a[0],_=[...a.slice(1)];return _[0]&&(_[0].appName=l.name),l._errorFactory.create(h,..._)}return Fne.create(l,...a)}function Li(l,a,...h){if(!l)throw uJ(a,...h)}function ny(l){const a="INTERNAL ASSERTION FAILED: "+l;throw dG(a),new Error(a)}function fy(l,a){l||ny(a)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N7(){return typeof self<"u"&&self.location?.href||""}function age(){return l$()==="http:"||l$()==="https:"}function l$(){return typeof self<"u"&&self.location?.protocol||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cge(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(age()||Hhe()||"connection"in navigator)?navigator.onLine:!0}function lge(){if(typeof navigator>"u")return null;const l=navigator;return l.languages&&l.languages[0]||l.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U3{constructor(a,h){this.shortDelay=a,this.longDelay=h,fy(h>a,"Short delay should be less than long delay!"),this.isMobile=RX()||ote()}get(){return cge()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hJ(l,a){fy(l.emulator,"Emulator should always be set here");const{url:h}=l.emulator;return a?`${h}${a.startsWith("/")?a.slice(1):a}`:h}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jne{static initialize(a,h,_){this.fetchImpl=a,h&&(this.headersImpl=h),_&&(this.responseImpl=_)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ny("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ny("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ny("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dge={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uge=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],hge=new U3(3e4,6e4);function pJ(l,a){return l.tenantId&&!a.tenantId?{...a,tenantId:l.tenantId}:a}async function oL(l,a,h,_,S={}){return Gne(l,S,async()=>{let y={},b={};_&&(a==="GET"?b=_:y={body:JSON.stringify(_)});const D=nL({key:l.config.apiKey,...b}).slice(1),U=await l._getAdditionalHeaders();U["Content-Type"]="application/json",l.languageCode&&(U["X-Firebase-Locale"]=l.languageCode);const x={method:a,headers:U,...y};return Whe()||(x.referrerPolicy="no-referrer"),l.emulatorConfig&&lO(l.emulatorConfig.host)&&(x.credentials="include"),jne.fetch()(await Wne(l,l.config.apiHost,h,D),x)})}async function Gne(l,a,h){l._canInitEmulator=!1;const _={...dge,...a};try{const S=new fge(l),y=await Promise.race([h(),S.promise]);S.clearNetworkTimeout();const b=await y.json();if("needConfirmation"in b)throw eG(l,"account-exists-with-different-credential",b);if(y.ok&&!("errorMessage"in b))return b;{const D=y.ok?b.errorMessage:b.error.message,[U,x]=D.split(" : ");if(U==="FEDERATED_USER_ID_ALREADY_LINKED")throw eG(l,"credential-already-in-use",b);if(U==="EMAIL_EXISTS")throw eG(l,"email-already-in-use",b);if(U==="USER_DISABLED")throw eG(l,"user-disabled",b);const q=_[U]||U.toLowerCase().replace(/[_\s]+/g,"-");if(x)throw Bne(l,q,x);py(l,q)}}catch(S){if(S instanceof my)throw S;py(l,"network-request-failed",{message:String(S)})}}async function pge(l,a,h,_,S={}){const y=await oL(l,a,h,_,S);return"mfaPendingCredential"in y&&py(l,"multi-factor-auth-required",{_serverResponse:y}),y}async function Wne(l,a,h,_){const S=`${a}${h}?${_}`,y=l,b=y.config.emulator?hJ(l.config,S):`${l.config.apiScheme}://${S}`;return uge.includes(h)&&(await y._persistenceManagerAvailable,y._getPersistenceType()==="COOKIE")?y._getPersistence()._getFinalTarget(b).toString():b}class fge{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(a){this.auth=a,this.timer=null,this.promise=new Promise((h,_)=>{this.timer=setTimeout(()=>_(AS(this.auth,"network-request-failed")),hge.get())})}}function eG(l,a,h){const _={appName:l.name};h.email&&(_.email=h.email),h.phoneNumber&&(_.phoneNumber=h.phoneNumber);const S=AS(l,a,_);return S.customData._tokenResponse=h,S}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _ge(l,a){return oL(l,"POST","/v1/accounts:delete",a)}async function KG(l,a){return oL(l,"POST","/v1/accounts:lookup",a)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qj(l){if(l)try{const a=new Date(Number(l));if(!isNaN(a.getTime()))return a.toUTCString()}catch{}}async function mge(l,a=!1){const h=yf(l),_=await h.getIdToken(a),S=fJ(_);Li(S&&S.exp&&S.auth_time&&S.iat,h.auth,"internal-error");const y=typeof S.firebase=="object"?S.firebase:void 0,b=y?.sign_in_provider;return{claims:S,token:_,authTime:Qj(jq(S.auth_time)),issuedAtTime:Qj(jq(S.iat)),expirationTime:Qj(jq(S.exp)),signInProvider:b||null,signInSecondFactor:y?.sign_in_second_factor||null}}function jq(l){return Number(l)*1e3}function fJ(l){const[a,h,_]=l.split(".");if(a===void 0||h===void 0||_===void 0)return dG("JWT malformed, contained fewer than 3 sections"),null;try{const S=AG(h);return S?JSON.parse(S):(dG("Failed to decode base64 JWT payload"),null)}catch(S){return dG("Caught error parsing JWT payload as JSON",S?.toString()),null}}function d$(l){const a=fJ(l);return Li(a,"internal-error"),Li(typeof a.exp<"u","internal-error"),Li(typeof a.iat<"u","internal-error"),Number(a.exp)-Number(a.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function m3(l,a,h=!1){if(h)return a;try{return await a}catch(_){throw _ instanceof my&&Ege(_)&&l.auth.currentUser===l&&await l.auth.signOut(),_}}function Ege({code:l}){return l==="auth/user-disabled"||l==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gge{constructor(a){this.user=a,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(a){if(a){const h=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),h}else{this.errorBackoff=3e4;const _=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,_)}}schedule(a=!1){if(!this.isRunning)return;const h=this.getInterval(a);this.timerId=setTimeout(async()=>{await this.iteration()},h)}async iteration(){try{await this.user.getIdToken(!0)}catch(a){a?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D7{constructor(a,h){this.createdAt=a,this.lastLoginAt=h,this._initializeTime()}_initializeTime(){this.lastSignInTime=Qj(this.lastLoginAt),this.creationTime=Qj(this.createdAt)}_copy(a){this.createdAt=a.createdAt,this.lastLoginAt=a.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zG(l){const a=l.auth,h=await l.getIdToken(),_=await m3(l,KG(a,{idToken:h}));Li(_?.users.length,a,"internal-error");const S=_.users[0];l._notifyReloadListener(S);const y=S.providerUserInfo?.length?Hne(S.providerUserInfo):[],b=Tge(l.providerData,y),D=l.isAnonymous,U=!(l.email&&S.passwordHash)&&!b?.length,x=D?U:!1,q={uid:S.localId,displayName:S.displayName||null,photoURL:S.photoUrl||null,email:S.email||null,emailVerified:S.emailVerified||!1,phoneNumber:S.phoneNumber||null,tenantId:S.tenantId||null,providerData:b,metadata:new D7(S.createdAt,S.lastLoginAt),isAnonymous:x};Object.assign(l,q)}async function Sge(l){const a=yf(l);await zG(a),await a.auth._persistUserIfCurrent(a),a.auth._notifyListenersIfCurrent(a)}function Tge(l,a){return[...l.filter(_=>!a.some(S=>S.providerId===_.providerId)),...a]}function Hne(l){return l.map(({providerId:a,...h})=>({providerId:a,uid:h.rawId||"",displayName:h.displayName||null,email:h.email||null,phoneNumber:h.phoneNumber||null,photoURL:h.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vge(l,a){const h=await Gne(l,{},async()=>{const _=nL({grant_type:"refresh_token",refresh_token:a}).slice(1),{tokenApiHost:S,apiKey:y}=l.config,b=await Wne(l,S,"/v1/token",`key=${y}`),D=await l._getAdditionalHeaders();D["Content-Type"]="application/x-www-form-urlencoded";const U={method:"POST",headers:D,body:_};return l.emulatorConfig&&lO(l.emulatorConfig.host)&&(U.credentials="include"),jne.fetch()(b,U)});return{accessToken:h.access_token,expiresIn:h.expires_in,refreshToken:h.refresh_token}}async function yge(l,a){return oL(l,"POST","/v2/accounts:revokeToken",pJ(l,a))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fk{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(a){Li(a.idToken,"internal-error"),Li(typeof a.idToken<"u","internal-error"),Li(typeof a.refreshToken<"u","internal-error");const h="expiresIn"in a&&typeof a.expiresIn<"u"?Number(a.expiresIn):d$(a.idToken);this.updateTokensAndExpiration(a.idToken,a.refreshToken,h)}updateFromIdToken(a){Li(a.length!==0,"internal-error");const h=d$(a);this.updateTokensAndExpiration(a,null,h)}async getToken(a,h=!1){return!h&&this.accessToken&&!this.isExpired?this.accessToken:(Li(this.refreshToken,a,"user-token-expired"),this.refreshToken?(await this.refresh(a,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(a,h){const{accessToken:_,refreshToken:S,expiresIn:y}=await vge(a,h);this.updateTokensAndExpiration(_,S,Number(y))}updateTokensAndExpiration(a,h,_){this.refreshToken=h||null,this.accessToken=a||null,this.expirationTime=Date.now()+_*1e3}static fromJSON(a,h){const{refreshToken:_,accessToken:S,expirationTime:y}=h,b=new Fk;return _&&(Li(typeof _=="string","internal-error",{appName:a}),b.refreshToken=_),S&&(Li(typeof S=="string","internal-error",{appName:a}),b.accessToken=S),y&&(Li(typeof y=="number","internal-error",{appName:a}),b.expirationTime=y),b}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(a){this.accessToken=a.accessToken,this.refreshToken=a.refreshToken,this.expirationTime=a.expirationTime}_clone(){return Object.assign(new Fk,this.toJSON())}_performRefresh(){return ny("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yb(l,a){Li(typeof l=="string"||typeof l>"u","internal-error",{appName:a})}class TE{constructor({uid:a,auth:h,stsTokenManager:_,...S}){this.providerId="firebase",this.proactiveRefresh=new gge(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=a,this.auth=h,this.stsTokenManager=_,this.accessToken=_.accessToken,this.displayName=S.displayName||null,this.email=S.email||null,this.emailVerified=S.emailVerified||!1,this.phoneNumber=S.phoneNumber||null,this.photoURL=S.photoURL||null,this.isAnonymous=S.isAnonymous||!1,this.tenantId=S.tenantId||null,this.providerData=S.providerData?[...S.providerData]:[],this.metadata=new D7(S.createdAt||void 0,S.lastLoginAt||void 0)}async getIdToken(a){const h=await m3(this,this.stsTokenManager.getToken(this.auth,a));return Li(h,this.auth,"internal-error"),this.accessToken!==h&&(this.accessToken=h,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),h}getIdTokenResult(a){return mge(this,a)}reload(){return Sge(this)}_assign(a){this!==a&&(Li(this.uid===a.uid,this.auth,"internal-error"),this.displayName=a.displayName,this.photoURL=a.photoURL,this.email=a.email,this.emailVerified=a.emailVerified,this.phoneNumber=a.phoneNumber,this.isAnonymous=a.isAnonymous,this.tenantId=a.tenantId,this.providerData=a.providerData.map(h=>({...h})),this.metadata._copy(a.metadata),this.stsTokenManager._assign(a.stsTokenManager))}_clone(a){const h=new TE({...this,auth:a,stsTokenManager:this.stsTokenManager._clone()});return h.metadata._copy(this.metadata),h}_onReload(a){Li(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=a,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(a){this.reloadListener?this.reloadListener(a):this.reloadUserInfo=a}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(a,h=!1){let _=!1;a.idToken&&a.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(a),_=!0),h&&await zG(this),await this.auth._persistUserIfCurrent(this),_&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(fE(this.auth.app))return Promise.reject(eO(this.auth));const a=await this.getIdToken();return await m3(this,_ge(this.auth,{idToken:a})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(a=>({...a})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(a,h){const _=h.displayName??void 0,S=h.email??void 0,y=h.phoneNumber??void 0,b=h.photoURL??void 0,D=h.tenantId??void 0,U=h._redirectEventId??void 0,x=h.createdAt??void 0,q=h.lastLoginAt??void 0,{uid:J,emailVerified:ee,isAnonymous:ue,providerData:oe,stsTokenManager:le}=h;Li(J&&le,a,"internal-error");const pe=Fk.fromJSON(this.name,le);Li(typeof J=="string",a,"internal-error"),yb(_,a.name),yb(S,a.name),Li(typeof ee=="boolean",a,"internal-error"),Li(typeof ue=="boolean",a,"internal-error"),yb(y,a.name),yb(b,a.name),yb(D,a.name),yb(U,a.name),yb(x,a.name),yb(q,a.name);const Ne=new TE({uid:J,auth:a,email:S,emailVerified:ee,displayName:_,isAnonymous:ue,photoURL:b,phoneNumber:y,tenantId:D,stsTokenManager:pe,createdAt:x,lastLoginAt:q});return oe&&Array.isArray(oe)&&(Ne.providerData=oe.map(Ve=>({...Ve}))),U&&(Ne._redirectEventId=U),Ne}static async _fromIdTokenResponse(a,h,_=!1){const S=new Fk;S.updateFromServerResponse(h);const y=new TE({uid:h.localId,auth:a,stsTokenManager:S,isAnonymous:_});return await zG(y),y}static async _fromGetAccountInfoResponse(a,h,_){const S=h.users[0];Li(S.localId!==void 0,"internal-error");const y=S.providerUserInfo!==void 0?Hne(S.providerUserInfo):[],b=!(S.email&&S.passwordHash)&&!y?.length,D=new Fk;D.updateFromIdToken(_);const U=new TE({uid:S.localId,auth:a,stsTokenManager:D,isAnonymous:b}),x={uid:S.localId,displayName:S.displayName||null,photoURL:S.photoUrl||null,email:S.email||null,emailVerified:S.emailVerified||!1,phoneNumber:S.phoneNumber||null,tenantId:S.tenantId||null,providerData:y,metadata:new D7(S.createdAt,S.lastLoginAt),isAnonymous:!(S.email&&S.passwordHash)&&!y?.length};return Object.assign(U,x),U}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u$=new Map;function iy(l){fy(l instanceof Function,"Expected a class definition");let a=u$.get(l);return a?(fy(a instanceof l,"Instance stored in cache mismatched with class"),a):(a=new l,u$.set(l,a),a)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kne{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(a,h){this.storage[a]=h}async _get(a){const h=this.storage[a];return h===void 0?null:h}async _remove(a){delete this.storage[a]}_addListener(a,h){}_removeListener(a,h){}}Kne.type="NONE";const h$=Kne;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uG(l,a,h){return`firebase:${l}:${a}:${h}`}class Bk{constructor(a,h,_){this.persistence=a,this.auth=h,this.userKey=_;const{config:S,name:y}=this.auth;this.fullUserKey=uG(this.userKey,S.apiKey,y),this.fullPersistenceKey=uG("persistence",S.apiKey,y),this.boundEventHandler=h._onStorageEvent.bind(h),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(a){return this.persistence._set(this.fullUserKey,a.toJSON())}async getCurrentUser(){const a=await this.persistence._get(this.fullUserKey);if(!a)return null;if(typeof a=="string"){const h=await KG(this.auth,{idToken:a}).catch(()=>{});return h?TE._fromGetAccountInfoResponse(this.auth,h,a):null}return TE._fromJSON(this.auth,a)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(a){if(this.persistence===a)return;const h=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=a,h)return this.setCurrentUser(h)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(a,h,_="authUser"){if(!h.length)return new Bk(iy(h$),a,_);const S=(await Promise.all(h.map(async x=>{if(await x._isAvailable())return x}))).filter(x=>x);let y=S[0]||iy(h$);const b=uG(_,a.config.apiKey,a.name);let D=null;for(const x of h)try{const q=await x._get(b);if(q){let J;if(typeof q=="string"){const ee=await KG(a,{idToken:q}).catch(()=>{});if(!ee)break;J=await TE._fromGetAccountInfoResponse(a,ee,q)}else J=TE._fromJSON(a,q);x!==y&&(D=J),y=x;break}}catch{}const U=S.filter(x=>x._shouldAllowMigration);return!y._shouldAllowMigration||!U.length?new Bk(y,a,_):(y=U[0],D&&await y._set(b,D.toJSON()),await Promise.all(h.map(async x=>{if(x!==y)try{await x._remove(b)}catch{}})),new Bk(y,a,_))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p$(l){const a=l.toLowerCase();if(a.includes("opera/")||a.includes("opr/")||a.includes("opios/"))return"Opera";if(Xne(a))return"IEMobile";if(a.includes("msie")||a.includes("trident/"))return"IE";if(a.includes("edge/"))return"Edge";if(zne(a))return"Firefox";if(a.includes("silk/"))return"Silk";if(Qne(a))return"Blackberry";if(Zne(a))return"Webos";if(Yne(a))return"Safari";if((a.includes("chrome/")||qne(a))&&!a.includes("edge/"))return"Chrome";if(Jne(a))return"Android";{const h=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,_=l.match(h);if(_?.length===2)return _[1]}return"Other"}function zne(l=Bu()){return/firefox\//i.test(l)}function Yne(l=Bu()){const a=l.toLowerCase();return a.includes("safari/")&&!a.includes("chrome/")&&!a.includes("crios/")&&!a.includes("android")}function qne(l=Bu()){return/crios\//i.test(l)}function Xne(l=Bu()){return/iemobile/i.test(l)}function Jne(l=Bu()){return/android/i.test(l)}function Qne(l=Bu()){return/blackberry/i.test(l)}function Zne(l=Bu()){return/webos/i.test(l)}function _J(l=Bu()){return/iphone|ipad|ipod/i.test(l)||/macintosh/i.test(l)&&/mobile/i.test(l)}function Rge(l=Bu()){return _J(l)&&!!window.navigator?.standalone}function Cge(){return Khe()&&document.documentMode===10}function $ne(l=Bu()){return _J(l)||Jne(l)||Zne(l)||Qne(l)||/windows phone/i.test(l)||Xne(l)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eie(l,a=[]){let h;switch(l){case"Browser":h=p$(Bu());break;case"Worker":h=`${p$(Bu())}-${l}`;break;default:h=l}const _=a.length?a.join(","):"FirebaseCore-web";return`${h}/JsCore/${dO}/${_}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bge{constructor(a){this.auth=a,this.queue=[]}pushCallback(a,h){const _=y=>new Promise((b,D)=>{try{const U=a(y);b(U)}catch(U){D(U)}});_.onAbort=h,this.queue.push(_);const S=this.queue.length-1;return()=>{this.queue[S]=()=>Promise.resolve()}}async runMiddleware(a){if(this.auth.currentUser===a)return;const h=[];try{for(const _ of this.queue)await _(a),_.onAbort&&h.push(_.onAbort)}catch(_){h.reverse();for(const S of h)try{S()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:_?.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ige(l,a={}){return oL(l,"GET","/v2/passwordPolicy",pJ(l,a))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Age=6;class wge{constructor(a){const h=a.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=h.minPasswordLength??Age,h.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=h.maxPasswordLength),h.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=h.containsLowercaseCharacter),h.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=h.containsUppercaseCharacter),h.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=h.containsNumericCharacter),h.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=h.containsNonAlphanumericCharacter),this.enforcementState=a.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=a.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=a.forceUpgradeOnSignin??!1,this.schemaVersion=a.schemaVersion}validatePassword(a){const h={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(a,h),this.validatePasswordCharacterOptions(a,h),h.isValid&&(h.isValid=h.meetsMinPasswordLength??!0),h.isValid&&(h.isValid=h.meetsMaxPasswordLength??!0),h.isValid&&(h.isValid=h.containsLowercaseLetter??!0),h.isValid&&(h.isValid=h.containsUppercaseLetter??!0),h.isValid&&(h.isValid=h.containsNumericCharacter??!0),h.isValid&&(h.isValid=h.containsNonAlphanumericCharacter??!0),h}validatePasswordLengthOptions(a,h){const _=this.customStrengthOptions.minPasswordLength,S=this.customStrengthOptions.maxPasswordLength;_&&(h.meetsMinPasswordLength=a.length>=_),S&&(h.meetsMaxPasswordLength=a.length<=S)}validatePasswordCharacterOptions(a,h){this.updatePasswordCharacterOptionsStatuses(h,!1,!1,!1,!1);let _;for(let S=0;S<a.length;S++)_=a.charAt(S),this.updatePasswordCharacterOptionsStatuses(h,_>="a"&&_<="z",_>="A"&&_<="Z",_>="0"&&_<="9",this.allowedNonAlphanumericCharacters.includes(_))}updatePasswordCharacterOptionsStatuses(a,h,_,S,y){this.customStrengthOptions.containsLowercaseLetter&&(a.containsLowercaseLetter||(a.containsLowercaseLetter=h)),this.customStrengthOptions.containsUppercaseLetter&&(a.containsUppercaseLetter||(a.containsUppercaseLetter=_)),this.customStrengthOptions.containsNumericCharacter&&(a.containsNumericCharacter||(a.containsNumericCharacter=S)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(a.containsNonAlphanumericCharacter||(a.containsNonAlphanumericCharacter=y))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oge{constructor(a,h,_,S){this.app=a,this.heartbeatServiceProvider=h,this.appCheckServiceProvider=_,this.config=S,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new f$(this),this.idTokenSubscription=new f$(this),this.beforeStateQueue=new bge(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Fne,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=a.name,this.clientVersion=S.sdkClientVersion,this._persistenceManagerAvailable=new Promise(y=>this._resolvePersistenceManagerAvailable=y)}_initializeWithPersistence(a,h){return h&&(this._popupRedirectResolver=iy(h)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await Bk.create(this,a),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(h),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const a=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!a)){if(this.currentUser&&a&&this.currentUser.uid===a.uid){this._currentUser._assign(a),await this.currentUser.getIdToken();return}await this._updateCurrentUser(a,!0)}}async initializeCurrentUserFromIdToken(a){try{const h=await KG(this,{idToken:a}),_=await TE._fromGetAccountInfoResponse(this,h,a);await this.directlySetCurrentUser(_)}catch(h){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",h),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(a){if(fE(this.app)){const y=this.app.settings.authIdToken;return y?new Promise(b=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(y).then(b,b))}):this.directlySetCurrentUser(null)}const h=await this.assertedPersistence.getCurrentUser();let _=h,S=!1;if(a&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const y=this.redirectUser?._redirectEventId,b=_?._redirectEventId,D=await this.tryRedirectSignIn(a);(!y||y===b)&&D?.user&&(_=D.user,S=!0)}if(!_)return this.directlySetCurrentUser(null);if(!_._redirectEventId){if(S)try{await this.beforeStateQueue.runMiddleware(_)}catch(y){_=h,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(y))}return _?this.reloadAndSetCurrentUserOrClear(_):this.directlySetCurrentUser(null)}return Li(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===_._redirectEventId?this.directlySetCurrentUser(_):this.reloadAndSetCurrentUserOrClear(_)}async tryRedirectSignIn(a){let h=null;try{h=await this._popupRedirectResolver._completeRedirectFn(this,a,!0)}catch{await this._setRedirectUser(null)}return h}async reloadAndSetCurrentUserOrClear(a){try{await zG(a)}catch(h){if(h?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(a)}useDeviceLanguage(){this.languageCode=lge()}async _delete(){this._deleted=!0}async updateCurrentUser(a){if(fE(this.app))return Promise.reject(eO(this));const h=a?yf(a):null;return h&&Li(h.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(h&&h._clone(this))}async _updateCurrentUser(a,h=!1){if(!this._deleted)return a&&Li(this.tenantId===a.tenantId,this,"tenant-id-mismatch"),h||await this.beforeStateQueue.runMiddleware(a),this.queue(async()=>{await this.directlySetCurrentUser(a),this.notifyAuthListeners()})}async signOut(){return fE(this.app)?Promise.reject(eO(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(a){return fE(this.app)?Promise.reject(eO(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(iy(a))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(a){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const h=this._getPasswordPolicyInternal();return h.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):h.validatePassword(a)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const a=await Ige(this),h=new wge(a);this.tenantId===null?this._projectPasswordPolicy=h:this._tenantPasswordPolicies[this.tenantId]=h}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(a){this._errorFactory=new w3("auth","Firebase",a())}onAuthStateChanged(a,h,_){return this.registerStateListener(this.authStateSubscription,a,h,_)}beforeAuthStateChanged(a,h){return this.beforeStateQueue.pushCallback(a,h)}onIdTokenChanged(a,h,_){return this.registerStateListener(this.idTokenSubscription,a,h,_)}authStateReady(){return new Promise((a,h)=>{if(this.currentUser)a();else{const _=this.onAuthStateChanged(()=>{_(),a()},h)}})}async revokeAccessToken(a){if(this.currentUser){const h=await this.currentUser.getIdToken(),_={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:a,idToken:h};this.tenantId!=null&&(_.tenantId=this.tenantId),await yge(this,_)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(a,h){const _=await this.getOrInitRedirectPersistenceManager(h);return a===null?_.removeCurrentUser():_.setCurrentUser(a)}async getOrInitRedirectPersistenceManager(a){if(!this.redirectPersistenceManager){const h=a&&iy(a)||this._popupRedirectResolver;Li(h,this,"argument-error"),this.redirectPersistenceManager=await Bk.create(this,[iy(h._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(a){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===a?this._currentUser:this.redirectUser?._redirectEventId===a?this.redirectUser:null}async _persistUserIfCurrent(a){if(a===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(a))}_notifyListenersIfCurrent(a){a===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const a=this.currentUser?.uid??null;this.lastNotifiedUid!==a&&(this.lastNotifiedUid=a,this.authStateSubscription.next(this.currentUser))}registerStateListener(a,h,_,S){if(this._deleted)return()=>{};const y=typeof h=="function"?h:h.next.bind(h);let b=!1;const D=this._isInitialized?Promise.resolve():this._initializationPromise;if(Li(D,this,"internal-error"),D.then(()=>{b||y(this.currentUser)}),typeof h=="function"){const U=a.addObserver(h,_,S);return()=>{b=!0,U()}}else{const U=a.addObserver(h);return()=>{b=!0,U()}}}async directlySetCurrentUser(a){this.currentUser&&this.currentUser!==a&&this._currentUser._stopProactiveRefresh(),a&&this.isProactiveRefreshEnabled&&a._startProactiveRefresh(),this.currentUser=a,a?await this.assertedPersistence.setCurrentUser(a):await this.assertedPersistence.removeCurrentUser()}queue(a){return this.operations=this.operations.then(a,a),this.operations}get assertedPersistence(){return Li(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(a){!a||this.frameworks.includes(a)||(this.frameworks.push(a),this.frameworks.sort(),this.clientVersion=eie(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const a={"X-Client-Version":this.clientVersion};this.app.options.appId&&(a["X-Firebase-gmpid"]=this.app.options.appId);const h=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();h&&(a["X-Firebase-Client"]=h);const _=await this._getAppCheckToken();return _&&(a["X-Firebase-AppCheck"]=_),a}async _getAppCheckToken(){if(fE(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const a=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return a?.error&&oge(`Error while retrieving App Check token: ${a.error}`),a?.token}}function mJ(l){return yf(l)}class f${constructor(a){this.auth=a,this.observer=null,this.addObserver=tpe(h=>this.observer=h)}get next(){return Li(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let EJ={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Nge(l){EJ=l}function Dge(l){return EJ.loadJS(l)}function Pge(){return EJ.gapiScript}function kge(l){return`__${l}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lge(l,a){const h=RW(l,"auth");if(h.isInitialized()){const S=h.getImmediate(),y=h.getOptions();if(Lb(y,a??{}))return S;py(S,"already-initialized")}return h.initialize({options:a})}function Mge(l,a){const h=a?.persistence||[],_=(Array.isArray(h)?h:[h]).map(iy);a?.errorMap&&l._updateErrorMap(a.errorMap),l._initializeWithPersistence(_,a?.popupRedirectResolver)}function Uge(l,a,h){const _=mJ(l);Li(/^https?:\/\//.test(a),_,"invalid-emulator-scheme");const S=!1,y=tie(a),{host:b,port:D}=xge(a),U=D===null?"":`:${D}`,x={url:`${y}//${b}${U}/`},q=Object.freeze({host:b,port:D,protocol:y.replace(":",""),options:Object.freeze({disableWarnings:S})});if(!_._canInitEmulator){Li(_.config.emulator&&_.emulatorConfig,_,"emulator-config-failed"),Li(Lb(x,_.config.emulator)&&Lb(q,_.emulatorConfig),_,"emulator-config-failed");return}_.config.emulator=x,_.emulatorConfig=q,_.settings.appVerificationDisabledForTesting=!0,lO(b)?(vX(`${y}//${b}${U}`),yX("Auth",!0)):Vge()}function tie(l){const a=l.indexOf(":");return a<0?"":l.substr(0,a+1)}function xge(l){const a=tie(l),h=/(\/\/)?([^?#/]+)/.exec(l.substr(a.length));if(!h)return{host:"",port:null};const _=h[2].split("@").pop()||"",S=/^(\[[^\]]+\])(:|$)/.exec(_);if(S){const y=S[1];return{host:y,port:_$(_.substr(y.length+1))}}else{const[y,b]=_.split(":");return{host:y,port:_$(b)}}}function _$(l){if(!l)return null;const a=Number(l);return isNaN(a)?null:a}function Vge(){function l(){const a=document.createElement("p"),h=a.style;a.innerText="Running in emulator mode. Do not use with production credentials.",h.position="fixed",h.width="100%",h.backgroundColor="#ffffff",h.border=".1em solid #000000",h.color="#b50000",h.bottom="0px",h.left="0px",h.margin="0px",h.zIndex="10000",h.textAlign="center",a.classList.add("firebase-emulator-warning"),document.body.appendChild(a)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",l):l())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nie{constructor(a,h){this.providerId=a,this.signInMethod=h}toJSON(){return ny("not implemented")}_getIdTokenResponse(a){return ny("not implemented")}_linkToIdToken(a,h){return ny("not implemented")}_getReauthenticationResolver(a){return ny("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jk(l,a){return pge(l,"POST","/v1/accounts:signInWithIdp",pJ(l,a))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fge="http://localhost";class aO extends nie{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(a){const h=new aO(a.providerId,a.signInMethod);return a.idToken||a.accessToken?(a.idToken&&(h.idToken=a.idToken),a.accessToken&&(h.accessToken=a.accessToken),a.nonce&&!a.pendingToken&&(h.nonce=a.nonce),a.pendingToken&&(h.pendingToken=a.pendingToken)):a.oauthToken&&a.oauthTokenSecret?(h.accessToken=a.oauthToken,h.secret=a.oauthTokenSecret):py("argument-error"),h}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(a){const h=typeof a=="string"?JSON.parse(a):a,{providerId:_,signInMethod:S,...y}=h;if(!_||!S)return null;const b=new aO(_,S);return b.idToken=y.idToken||void 0,b.accessToken=y.accessToken||void 0,b.secret=y.secret,b.nonce=y.nonce,b.pendingToken=y.pendingToken||null,b}_getIdTokenResponse(a){const h=this.buildRequest();return jk(a,h)}_linkToIdToken(a,h){const _=this.buildRequest();return _.idToken=h,jk(a,_)}_getReauthenticationResolver(a){const h=this.buildRequest();return h.autoCreate=!1,jk(a,h)}buildRequest(){const a={requestUri:Fge,returnSecureToken:!0};if(this.pendingToken)a.pendingToken=this.pendingToken;else{const h={};this.idToken&&(h.id_token=this.idToken),this.accessToken&&(h.access_token=this.accessToken),this.secret&&(h.oauth_token_secret=this.secret),h.providerId=this.providerId,this.nonce&&!this.pendingToken&&(h.nonce=this.nonce),a.postBody=nL(h)}return a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iie{constructor(a){this.providerId=a,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(a){this.defaultLanguageCode=a}setCustomParameters(a){return this.customParameters=a,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x3 extends iie{constructor(){super(...arguments),this.scopes=[]}addScope(a){return this.scopes.includes(a)||this.scopes.push(a),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rb extends x3{constructor(){super("facebook.com")}static credential(a){return aO._fromParams({providerId:Rb.PROVIDER_ID,signInMethod:Rb.FACEBOOK_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return Rb.credentialFromTaggedObject(a)}static credentialFromError(a){return Rb.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return Rb.credential(a.oauthAccessToken)}catch{return null}}}Rb.FACEBOOK_SIGN_IN_METHOD="facebook.com";Rb.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cb extends x3{constructor(){super("google.com"),this.addScope("profile")}static credential(a,h){return aO._fromParams({providerId:Cb.PROVIDER_ID,signInMethod:Cb.GOOGLE_SIGN_IN_METHOD,idToken:a,accessToken:h})}static credentialFromResult(a){return Cb.credentialFromTaggedObject(a)}static credentialFromError(a){return Cb.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthIdToken:h,oauthAccessToken:_}=a;if(!h&&!_)return null;try{return Cb.credential(h,_)}catch{return null}}}Cb.GOOGLE_SIGN_IN_METHOD="google.com";Cb.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bb extends x3{constructor(){super("github.com")}static credential(a){return aO._fromParams({providerId:bb.PROVIDER_ID,signInMethod:bb.GITHUB_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return bb.credentialFromTaggedObject(a)}static credentialFromError(a){return bb.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return bb.credential(a.oauthAccessToken)}catch{return null}}}bb.GITHUB_SIGN_IN_METHOD="github.com";bb.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ib extends x3{constructor(){super("twitter.com")}static credential(a,h){return aO._fromParams({providerId:Ib.PROVIDER_ID,signInMethod:Ib.TWITTER_SIGN_IN_METHOD,oauthToken:a,oauthTokenSecret:h})}static credentialFromResult(a){return Ib.credentialFromTaggedObject(a)}static credentialFromError(a){return Ib.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthAccessToken:h,oauthTokenSecret:_}=a;if(!h||!_)return null;try{return Ib.credential(h,_)}catch{return null}}}Ib.TWITTER_SIGN_IN_METHOD="twitter.com";Ib.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xk{constructor(a){this.user=a.user,this.providerId=a.providerId,this._tokenResponse=a._tokenResponse,this.operationType=a.operationType}static async _fromIdTokenResponse(a,h,_,S=!1){const y=await TE._fromIdTokenResponse(a,_,S),b=m$(_);return new Xk({user:y,providerId:b,_tokenResponse:_,operationType:h})}static async _forOperation(a,h,_){await a._updateTokensIfNecessary(_,!0);const S=m$(_);return new Xk({user:a,providerId:S,_tokenResponse:_,operationType:h})}}function m$(l){return l.providerId?l.providerId:"phoneNumber"in l?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YG extends my{constructor(a,h,_,S){super(h.code,h.message),this.operationType=_,this.user=S,Object.setPrototypeOf(this,YG.prototype),this.customData={appName:a.name,tenantId:a.tenantId??void 0,_serverResponse:h.customData._serverResponse,operationType:_}}static _fromErrorAndOperation(a,h,_,S){return new YG(a,h,_,S)}}function rie(l,a,h,_){return(a==="reauthenticate"?h._getReauthenticationResolver(l):h._getIdTokenResponse(l)).catch(y=>{throw y.code==="auth/multi-factor-auth-required"?YG._fromErrorAndOperation(l,y,a,_):y})}async function Bge(l,a,h=!1){const _=await m3(l,a._linkToIdToken(l.auth,await l.getIdToken()),h);return Xk._forOperation(l,"link",_)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jge(l,a,h=!1){const{auth:_}=l;if(fE(_.app))return Promise.reject(eO(_));const S="reauthenticate";try{const y=await m3(l,rie(_,S,a,l),h);Li(y.idToken,_,"internal-error");const b=fJ(y.idToken);Li(b,_,"internal-error");const{sub:D}=b;return Li(l.uid===D,_,"user-mismatch"),Xk._forOperation(l,S,y)}catch(y){throw y?.code==="auth/user-not-found"&&py(_,"user-mismatch"),y}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gge(l,a,h=!1){if(fE(l.app))return Promise.reject(eO(l));const _="signIn",S=await rie(l,_,a),y=await Xk._fromIdTokenResponse(l,_,S);return h||await l._updateCurrentUser(y.user),y}function Wge(l,a,h,_){return yf(l).onIdTokenChanged(a,h,_)}function Hge(l,a,h){return yf(l).beforeAuthStateChanged(a,h)}function Kge(l,a,h,_){return yf(l).onAuthStateChanged(a,h,_)}const qG="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sie{constructor(a,h){this.storageRetriever=a,this.type=h}_isAvailable(){try{return this.storage?(this.storage.setItem(qG,"1"),this.storage.removeItem(qG),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(a,h){return this.storage.setItem(a,JSON.stringify(h)),Promise.resolve()}_get(a){const h=this.storage.getItem(a);return Promise.resolve(h?JSON.parse(h):null)}_remove(a){return this.storage.removeItem(a),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zge=1e3,Yge=10;class oie extends sie{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(a,h)=>this.onStorageEvent(a,h),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=$ne(),this._shouldAllowMigration=!0}forAllChangedKeys(a){for(const h of Object.keys(this.listeners)){const _=this.storage.getItem(h),S=this.localCache[h];_!==S&&a(h,S,_)}}onStorageEvent(a,h=!1){if(!a.key){this.forAllChangedKeys((b,D,U)=>{this.notifyListeners(b,U)});return}const _=a.key;h?this.detachListener():this.stopPolling();const S=()=>{const b=this.storage.getItem(_);!h&&this.localCache[_]===b||this.notifyListeners(_,b)},y=this.storage.getItem(_);Cge()&&y!==a.newValue&&a.newValue!==a.oldValue?setTimeout(S,Yge):S()}notifyListeners(a,h){this.localCache[a]=h;const _=this.listeners[a];if(_)for(const S of Array.from(_))S(h&&JSON.parse(h))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((a,h,_)=>{this.onStorageEvent(new StorageEvent("storage",{key:a,oldValue:h,newValue:_}),!0)})},zge)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(a,h){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[a]||(this.listeners[a]=new Set,this.localCache[a]=this.storage.getItem(a)),this.listeners[a].add(h)}_removeListener(a,h){this.listeners[a]&&(this.listeners[a].delete(h),this.listeners[a].size===0&&delete this.listeners[a]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(a,h){await super._set(a,h),this.localCache[a]=JSON.stringify(h)}async _get(a){const h=await super._get(a);return this.localCache[a]=JSON.stringify(h),h}async _remove(a){await super._remove(a),delete this.localCache[a]}}oie.type="LOCAL";const qge=oie;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aie extends sie{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(a,h){}_removeListener(a,h){}}aie.type="SESSION";const cie=aie;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xge(l){return Promise.all(l.map(async a=>{try{return{fulfilled:!0,value:await a}}catch(h){return{fulfilled:!1,reason:h}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PW{constructor(a){this.eventTarget=a,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(a){const h=this.receivers.find(S=>S.isListeningto(a));if(h)return h;const _=new PW(a);return this.receivers.push(_),_}isListeningto(a){return this.eventTarget===a}async handleEvent(a){const h=a,{eventId:_,eventType:S,data:y}=h.data,b=this.handlersMap[S];if(!b?.size)return;h.ports[0].postMessage({status:"ack",eventId:_,eventType:S});const D=Array.from(b).map(async x=>x(h.origin,y)),U=await Xge(D);h.ports[0].postMessage({status:"done",eventId:_,eventType:S,response:U})}_subscribe(a,h){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[a]||(this.handlersMap[a]=new Set),this.handlersMap[a].add(h)}_unsubscribe(a,h){this.handlersMap[a]&&h&&this.handlersMap[a].delete(h),(!h||this.handlersMap[a].size===0)&&delete this.handlersMap[a],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}PW.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gJ(l="",a=10){let h="";for(let _=0;_<a;_++)h+=Math.floor(Math.random()*10);return l+h}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jge{constructor(a){this.target=a,this.handlers=new Set}removeMessageHandler(a){a.messageChannel&&(a.messageChannel.port1.removeEventListener("message",a.onMessage),a.messageChannel.port1.close()),this.handlers.delete(a)}async _send(a,h,_=50){const S=typeof MessageChannel<"u"?new MessageChannel:null;if(!S)throw new Error("connection_unavailable");let y,b;return new Promise((D,U)=>{const x=gJ("",20);S.port1.start();const q=setTimeout(()=>{U(new Error("unsupported_event"))},_);b={messageChannel:S,onMessage(J){const ee=J;if(ee.data.eventId===x)switch(ee.data.status){case"ack":clearTimeout(q),y=setTimeout(()=>{U(new Error("timeout"))},3e3);break;case"done":clearTimeout(y),D(ee.data.response);break;default:clearTimeout(q),clearTimeout(y),U(new Error("invalid_response"));break}}},this.handlers.add(b),S.port1.addEventListener("message",b.onMessage),this.target.postMessage({eventType:a,eventId:x,data:h},[S.port2])}).finally(()=>{b&&this.removeMessageHandler(b)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wS(){return window}function Qge(l){wS().location.href=l}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lie(){return typeof wS().WorkerGlobalScope<"u"&&typeof wS().importScripts=="function"}async function Zge(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function $ge(){return navigator?.serviceWorker?.controller||null}function eSe(){return lie()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const die="firebaseLocalStorageDb",tSe=1,XG="firebaseLocalStorage",uie="fbase_key";class V3{constructor(a){this.request=a}toPromise(){return new Promise((a,h)=>{this.request.addEventListener("success",()=>{a(this.request.result)}),this.request.addEventListener("error",()=>{h(this.request.error)})})}}function kW(l,a){return l.transaction([XG],a?"readwrite":"readonly").objectStore(XG)}function nSe(){const l=indexedDB.deleteDatabase(die);return new V3(l).toPromise()}function P7(){const l=indexedDB.open(die,tSe);return new Promise((a,h)=>{l.addEventListener("error",()=>{h(l.error)}),l.addEventListener("upgradeneeded",()=>{const _=l.result;try{_.createObjectStore(XG,{keyPath:uie})}catch(S){h(S)}}),l.addEventListener("success",async()=>{const _=l.result;_.objectStoreNames.contains(XG)?a(_):(_.close(),await nSe(),a(await P7()))})})}async function E$(l,a,h){const _=kW(l,!0).put({[uie]:a,value:h});return new V3(_).toPromise()}async function iSe(l,a){const h=kW(l,!1).get(a),_=await new V3(h).toPromise();return _===void 0?null:_.value}function g$(l,a){const h=kW(l,!0).delete(a);return new V3(h).toPromise()}const rSe=800,sSe=3;class hie{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await P7(),this.db)}async _withRetries(a){let h=0;for(;;)try{const _=await this._openDb();return await a(_)}catch(_){if(h++>sSe)throw _;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return lie()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=PW._getInstance(eSe()),this.receiver._subscribe("keyChanged",async(a,h)=>({keyProcessed:(await this._poll()).includes(h.key)})),this.receiver._subscribe("ping",async(a,h)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await Zge(),!this.activeServiceWorker)return;this.sender=new Jge(this.activeServiceWorker);const a=await this.sender._send("ping",{},800);a&&a[0]?.fulfilled&&a[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(a){if(!(!this.sender||!this.activeServiceWorker||$ge()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:a},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const a=await P7();return await E$(a,qG,"1"),await g$(a,qG),!0}catch{}return!1}async _withPendingWrite(a){this.pendingWrites++;try{await a()}finally{this.pendingWrites--}}async _set(a,h){return this._withPendingWrite(async()=>(await this._withRetries(_=>E$(_,a,h)),this.localCache[a]=h,this.notifyServiceWorker(a)))}async _get(a){const h=await this._withRetries(_=>iSe(_,a));return this.localCache[a]=h,h}async _remove(a){return this._withPendingWrite(async()=>(await this._withRetries(h=>g$(h,a)),delete this.localCache[a],this.notifyServiceWorker(a)))}async _poll(){const a=await this._withRetries(S=>{const y=kW(S,!1).getAll();return new V3(y).toPromise()});if(!a)return[];if(this.pendingWrites!==0)return[];const h=[],_=new Set;if(a.length!==0)for(const{fbase_key:S,value:y}of a)_.add(S),JSON.stringify(this.localCache[S])!==JSON.stringify(y)&&(this.notifyListeners(S,y),h.push(S));for(const S of Object.keys(this.localCache))this.localCache[S]&&!_.has(S)&&(this.notifyListeners(S,null),h.push(S));return h}notifyListeners(a,h){this.localCache[a]=h;const _=this.listeners[a];if(_)for(const S of Array.from(_))S(h)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),rSe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(a,h){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[a]||(this.listeners[a]=new Set,this._get(a)),this.listeners[a].add(h)}_removeListener(a,h){this.listeners[a]&&(this.listeners[a].delete(h),this.listeners[a].size===0&&delete this.listeners[a]),Object.keys(this.listeners).length===0&&this.stopPolling()}}hie.type="LOCAL";const oSe=hie;new U3(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aSe(l,a){return a?iy(a):(Li(l._popupRedirectResolver,l,"argument-error"),l._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SJ extends nie{constructor(a){super("custom","custom"),this.params=a}_getIdTokenResponse(a){return jk(a,this._buildIdpRequest())}_linkToIdToken(a,h){return jk(a,this._buildIdpRequest(h))}_getReauthenticationResolver(a){return jk(a,this._buildIdpRequest())}_buildIdpRequest(a){const h={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return a&&(h.idToken=a),h}}function cSe(l){return Gge(l.auth,new SJ(l),l.bypassAuthState)}function lSe(l){const{auth:a,user:h}=l;return Li(h,a,"internal-error"),jge(h,new SJ(l),l.bypassAuthState)}async function dSe(l){const{auth:a,user:h}=l;return Li(h,a,"internal-error"),Bge(h,new SJ(l),l.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pie{constructor(a,h,_,S,y=!1){this.auth=a,this.resolver=_,this.user=S,this.bypassAuthState=y,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(h)?h:[h]}execute(){return new Promise(async(a,h)=>{this.pendingPromise={resolve:a,reject:h};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(_){this.reject(_)}})}async onAuthEvent(a){const{urlResponse:h,sessionId:_,postBody:S,tenantId:y,error:b,type:D}=a;if(b){this.reject(b);return}const U={auth:this.auth,requestUri:h,sessionId:_,tenantId:y||void 0,postBody:S||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(D)(U))}catch(x){this.reject(x)}}onError(a){this.reject(a)}getIdpTask(a){switch(a){case"signInViaPopup":case"signInViaRedirect":return cSe;case"linkViaPopup":case"linkViaRedirect":return dSe;case"reauthViaPopup":case"reauthViaRedirect":return lSe;default:py(this.auth,"internal-error")}}resolve(a){fy(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(a),this.unregisterAndCleanUp()}reject(a){fy(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(a),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uSe=new U3(2e3,1e4);class Pk extends pie{constructor(a,h,_,S,y){super(a,h,S,y),this.provider=_,this.authWindow=null,this.pollId=null,Pk.currentPopupAction&&Pk.currentPopupAction.cancel(),Pk.currentPopupAction=this}async executeNotNull(){const a=await this.execute();return Li(a,this.auth,"internal-error"),a}async onExecution(){fy(this.filter.length===1,"Popup operations only handle one event");const a=gJ();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],a),this.authWindow.associatedEvent=a,this.resolver._originValidation(this.auth).catch(h=>{this.reject(h)}),this.resolver._isIframeWebStorageSupported(this.auth,h=>{h||this.reject(AS(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(AS(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Pk.currentPopupAction=null}pollUserCancellation(){const a=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(AS(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(a,uSe.get())};a()}}Pk.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hSe="pendingRedirect",hG=new Map;class pSe extends pie{constructor(a,h,_=!1){super(a,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],h,void 0,_),this.eventId=null}async execute(){let a=hG.get(this.auth._key());if(!a){try{const _=await fSe(this.resolver,this.auth)?await super.execute():null;a=()=>Promise.resolve(_)}catch(h){a=()=>Promise.reject(h)}hG.set(this.auth._key(),a)}return this.bypassAuthState||hG.set(this.auth._key(),()=>Promise.resolve(null)),a()}async onAuthEvent(a){if(a.type==="signInViaRedirect")return super.onAuthEvent(a);if(a.type==="unknown"){this.resolve(null);return}if(a.eventId){const h=await this.auth._redirectUserForId(a.eventId);if(h)return this.user=h,super.onAuthEvent(a);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function fSe(l,a){const h=ESe(a),_=mSe(l);if(!await _._isAvailable())return!1;const S=await _._get(h)==="true";return await _._remove(h),S}function _Se(l,a){hG.set(l._key(),a)}function mSe(l){return iy(l._redirectPersistence)}function ESe(l){return uG(hSe,l.config.apiKey,l.name)}async function gSe(l,a,h=!1){if(fE(l.app))return Promise.reject(eO(l));const _=mJ(l),S=aSe(_,a),b=await new pSe(_,S,h).execute();return b&&!h&&(delete b.user._redirectEventId,await _._persistUserIfCurrent(b.user),await _._setRedirectUser(null,a)),b}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SSe=600*1e3;class TSe{constructor(a){this.auth=a,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(a){this.consumers.add(a),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,a)&&(this.sendToConsumer(this.queuedRedirectEvent,a),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(a){this.consumers.delete(a)}onEvent(a){if(this.hasEventBeenHandled(a))return!1;let h=!1;return this.consumers.forEach(_=>{this.isEventForConsumer(a,_)&&(h=!0,this.sendToConsumer(a,_),this.saveEventToCache(a))}),this.hasHandledPotentialRedirect||!vSe(a)||(this.hasHandledPotentialRedirect=!0,h||(this.queuedRedirectEvent=a,h=!0)),h}sendToConsumer(a,h){if(a.error&&!fie(a)){const _=a.error.code?.split("auth/")[1]||"internal-error";h.onError(AS(this.auth,_))}else h.onAuthEvent(a)}isEventForConsumer(a,h){const _=h.eventId===null||!!a.eventId&&a.eventId===h.eventId;return h.filter.includes(a.type)&&_}hasEventBeenHandled(a){return Date.now()-this.lastProcessedEventTime>=SSe&&this.cachedEventUids.clear(),this.cachedEventUids.has(S$(a))}saveEventToCache(a){this.cachedEventUids.add(S$(a)),this.lastProcessedEventTime=Date.now()}}function S$(l){return[l.type,l.eventId,l.sessionId,l.tenantId].filter(a=>a).join("-")}function fie({type:l,error:a}){return l==="unknown"&&a?.code==="auth/no-auth-event"}function vSe(l){switch(l.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return fie(l);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ySe(l,a={}){return oL(l,"GET","/v1/projects",a)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RSe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,CSe=/^https?/;async function bSe(l){if(l.config.emulator)return;const{authorizedDomains:a}=await ySe(l);for(const h of a)try{if(ISe(h))return}catch{}py(l,"unauthorized-domain")}function ISe(l){const a=N7(),{protocol:h,hostname:_}=new URL(a);if(l.startsWith("chrome-extension://")){const b=new URL(l);return b.hostname===""&&_===""?h==="chrome-extension:"&&l.replace("chrome-extension://","")===a.replace("chrome-extension://",""):h==="chrome-extension:"&&b.hostname===_}if(!CSe.test(h))return!1;if(RSe.test(l))return _===l;const S=l.replace(/\./g,"\\.");return new RegExp("^(.+\\."+S+"|"+S+")$","i").test(_)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ASe=new U3(3e4,6e4);function T$(){const l=wS().___jsl;if(l?.H){for(const a of Object.keys(l.H))if(l.H[a].r=l.H[a].r||[],l.H[a].L=l.H[a].L||[],l.H[a].r=[...l.H[a].L],l.CP)for(let h=0;h<l.CP.length;h++)l.CP[h]=null}}function wSe(l){return new Promise((a,h)=>{function _(){T$(),gapi.load("gapi.iframes",{callback:()=>{a(gapi.iframes.getContext())},ontimeout:()=>{T$(),h(AS(l,"network-request-failed"))},timeout:ASe.get()})}if(wS().gapi?.iframes?.Iframe)a(gapi.iframes.getContext());else if(wS().gapi?.load)_();else{const S=kge("iframefcb");return wS()[S]=()=>{gapi.load?_():h(AS(l,"network-request-failed"))},Dge(`${Pge()}?onload=${S}`).catch(y=>h(y))}}).catch(a=>{throw pG=null,a})}let pG=null;function OSe(l){return pG=pG||wSe(l),pG}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NSe=new U3(5e3,15e3),DSe="__/auth/iframe",PSe="emulator/auth/iframe",kSe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},LSe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function MSe(l){const a=l.config;Li(a.authDomain,l,"auth-domain-config-required");const h=a.emulator?hJ(a,PSe):`https://${l.config.authDomain}/${DSe}`,_={apiKey:a.apiKey,appName:l.name,v:dO},S=LSe.get(l.config.apiHost);S&&(_.eid=S);const y=l._getFrameworks();return y.length&&(_.fw=y.join(",")),`${h}?${nL(_).slice(1)}`}async function USe(l){const a=await OSe(l),h=wS().gapi;return Li(h,l,"internal-error"),a.open({where:document.body,url:MSe(l),messageHandlersFilter:h.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:kSe,dontclear:!0},_=>new Promise(async(S,y)=>{await _.restyle({setHideOnLeave:!1});const b=AS(l,"network-request-failed"),D=wS().setTimeout(()=>{y(b)},NSe.get());function U(){wS().clearTimeout(D),S(_)}_.ping(U).then(U,()=>{y(b)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xSe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},VSe=500,FSe=600,BSe="_blank",jSe="http://localhost";class v${constructor(a){this.window=a,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function GSe(l,a,h,_=VSe,S=FSe){const y=Math.max((window.screen.availHeight-S)/2,0).toString(),b=Math.max((window.screen.availWidth-_)/2,0).toString();let D="";const U={...xSe,width:_.toString(),height:S.toString(),top:y,left:b},x=Bu().toLowerCase();h&&(D=qne(x)?BSe:h),zne(x)&&(a=a||jSe,U.scrollbars="yes");const q=Object.entries(U).reduce((ee,[ue,oe])=>`${ee}${ue}=${oe},`,"");if(Rge(x)&&D!=="_self")return WSe(a||"",D),new v$(null);const J=window.open(a||"",D,q);Li(J,l,"popup-blocked");try{J.focus()}catch{}return new v$(J)}function WSe(l,a){const h=document.createElement("a");h.href=l,h.target=a;const _=document.createEvent("MouseEvent");_.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),h.dispatchEvent(_)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HSe="__/auth/handler",KSe="emulator/auth/handler",zSe=encodeURIComponent("fac");async function y$(l,a,h,_,S,y){Li(l.config.authDomain,l,"auth-domain-config-required"),Li(l.config.apiKey,l,"invalid-api-key");const b={apiKey:l.config.apiKey,appName:l.name,authType:h,redirectUrl:_,v:dO,eventId:S};if(a instanceof iie){a.setDefaultLanguage(l.languageCode),b.providerId=a.providerId||"",u7(a.getCustomParameters())||(b.customParameters=JSON.stringify(a.getCustomParameters()));for(const[q,J]of Object.entries({}))b[q]=J}if(a instanceof x3){const q=a.getScopes().filter(J=>J!=="");q.length>0&&(b.scopes=q.join(","))}l.tenantId&&(b.tid=l.tenantId);const D=b;for(const q of Object.keys(D))D[q]===void 0&&delete D[q];const U=await l._getAppCheckToken(),x=U?`#${zSe}=${encodeURIComponent(U)}`:"";return`${YSe(l)}?${nL(D).slice(1)}${x}`}function YSe({config:l}){return l.emulator?hJ(l,KSe):`https://${l.authDomain}/${HSe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gq="webStorageSupport";class qSe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=cie,this._completeRedirectFn=gSe,this._overrideRedirectResult=_Se}async _openPopup(a,h,_,S){fy(this.eventManagers[a._key()]?.manager,"_initialize() not called before _openPopup()");const y=await y$(a,h,_,N7(),S);return GSe(a,y,gJ())}async _openRedirect(a,h,_,S){await this._originValidation(a);const y=await y$(a,h,_,N7(),S);return Qge(y),new Promise(()=>{})}_initialize(a){const h=a._key();if(this.eventManagers[h]){const{manager:S,promise:y}=this.eventManagers[h];return S?Promise.resolve(S):(fy(y,"If manager is not set, promise should be"),y)}const _=this.initAndGetManager(a);return this.eventManagers[h]={promise:_},_.catch(()=>{delete this.eventManagers[h]}),_}async initAndGetManager(a){const h=await USe(a),_=new TSe(a);return h.register("authEvent",S=>(Li(S?.authEvent,a,"invalid-auth-event"),{status:_.onEvent(S.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[a._key()]={manager:_},this.iframes[a._key()]=h,_}_isIframeWebStorageSupported(a,h){this.iframes[a._key()].send(Gq,{type:Gq},S=>{const y=S?.[0]?.[Gq];y!==void 0&&h(!!y),py(a,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(a){const h=a._key();return this.originValidationPromises[h]||(this.originValidationPromises[h]=bSe(a)),this.originValidationPromises[h]}get _shouldInitProactively(){return $ne()||Yne()||_J()}}const XSe=qSe;var R$="@firebase/auth",C$="1.11.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JSe{constructor(a){this.auth=a,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(a){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(a)}:null}addAuthTokenListener(a){if(this.assertAuthConfigured(),this.internalListeners.has(a))return;const h=this.auth.onIdTokenChanged(_=>{a(_?.stsTokenManager.accessToken||null)});this.internalListeners.set(a,h),this.updateProactiveRefresh()}removeAuthTokenListener(a){this.assertAuthConfigured();const h=this.internalListeners.get(a);h&&(this.internalListeners.delete(a),h(),this.updateProactiveRefresh())}assertAuthConfigured(){Li(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QSe(l){switch(l){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function ZSe(l){tO(new Mb("auth",(a,{options:h})=>{const _=a.getProvider("app").getImmediate(),S=a.getProvider("heartbeat"),y=a.getProvider("app-check-internal"),{apiKey:b,authDomain:D}=_.options;Li(b&&!b.includes(":"),"invalid-api-key",{appName:_.name});const U={apiKey:b,authDomain:D,clientPlatform:l,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:eie(l)},x=new Oge(_,S,y,U);return Mge(x,h),x},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((a,h,_)=>{a.getProvider("auth-internal").initialize()})),tO(new Mb("auth-internal",a=>{const h=mJ(a.getProvider("auth").getImmediate());return(_=>new JSe(_))(h)},"PRIVATE").setInstantiationMode("EXPLICIT")),IS(R$,C$,QSe(l)),IS(R$,C$,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $Se=300,eTe=rte("authIdTokenMaxAge")||$Se;let b$=null;const tTe=l=>async a=>{const h=a&&await a.getIdTokenResult(),_=h&&(new Date().getTime()-Date.parse(h.issuedAtTime))/1e3;if(_&&_>eTe)return;const S=h?.token;b$!==S&&(b$=S,await fetch(l,{method:S?"POST":"DELETE",headers:S?{Authorization:`Bearer ${S}`}:{}}))};function nTe(l=IX()){const a=RW(l,"auth");if(a.isInitialized())return a.getImmediate();const h=Lge(l,{popupRedirectResolver:XSe,persistence:[oSe,qge,cie]}),_=rte("authTokenSyncURL");if(_&&typeof isSecureContext=="boolean"&&isSecureContext){const y=new URL(_,location.origin);if(location.origin===y.origin){const b=tTe(y.toString());Hge(h,b,()=>b(h.currentUser)),Wge(h,D=>b(D))}}const S=tte("auth");return S&&Uge(h,`http://${S}`),h}function iTe(){return document.getElementsByTagName("head")?.[0]??document}Nge({loadJS(l){return new Promise((a,h)=>{const _=document.createElement("script");_.setAttribute("src",l),_.onload=a,_.onerror=S=>{const y=AS("internal-error");y.customData=S,h(y)},_.type="text/javascript",_.charset="UTF-8",iTe().appendChild(_)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});ZSe("Browser");const rTe={apiKey:"AIzaSyCgPvfma-_s9A7wxTzKQ-nAq6tHL2Nwj4Y",authDomain:"realtime-vocal-harmony.firebaseapp.com",projectId:"realtime-vocal-harmony",storageBucket:"realtime-vocal-harmony.appspot.com",messagingSenderId:"52980812745",appId:"1:52980812745:web:0d19f53093e28c8d6db618"},TJ=dte(rTe);Gfe(TJ);const sTe=nge(TJ),oTe=nTe(TJ);var fG={exports:{}},aTe=fG.exports,I$;function cTe(){return I$||(I$=1,(function(l,a){(function(h,_){l.exports=_()})(aTe,(function(){function h(e,t){return t.forEach((function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach((function(i){if(i!=="default"&&!(i in e)){var s=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(e,i,s.get?s:{enumerable:!0,get:function(){return n[i]}})}}))})),Object.freeze(e)}var _=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof sq<"u"?sq:typeof self<"u"?self:{};function S(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var y=function(e){try{return!!e()}catch{return!0}},b=!y((function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")})),D=b,U=Function.prototype,x=U.call,q=D&&U.bind.bind(x,x),J=D?q:function(e){return function(){return x.apply(e,arguments)}},ee=J({}.isPrototypeOf),ue=function(e){return e&&e.Math===Math&&e},oe=ue(typeof globalThis=="object"&&globalThis)||ue(typeof window=="object"&&window)||ue(typeof self=="object"&&self)||ue(typeof _=="object"&&_)||ue(typeof _=="object"&&_)||(function(){return this})()||Function("return this")(),le=b,pe=Function.prototype,Ne=pe.apply,Ve=pe.call,Ae=typeof Reflect=="object"&&Reflect.apply||(le?Ve.bind(Ne):function(){return Ve.apply(Ne,arguments)}),Ue=J,ke=Ue({}.toString),qe=Ue("".slice),Te=function(e){return qe(ke(e),8,-1)},he=Te,_e=J,ye=function(e){if(he(e)==="Function")return _e(e)},Ie=typeof document=="object"&&document.all,$=Ie===void 0&&Ie!==void 0?function(e){return typeof e=="function"||e===Ie}:function(e){return typeof e=="function"},me={},Xe=!y((function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7})),ct=b,Me=Function.prototype.call,Je=ct?Me.bind(Me):function(){return Me.apply(Me,arguments)},mt={},yt={}.propertyIsEnumerable,xe=Object.getOwnPropertyDescriptor,it=xe&&!yt.call({1:2},1);mt.f=it?function(e){var t=xe(this,e);return!!t&&t.enumerable}:yt;var ft,pt,xt=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},ln=y,pn=Te,Zn=Object,ri=J("".split),si=ln((function(){return!Zn("z").propertyIsEnumerable(0)}))?function(e){return pn(e)==="String"?ri(e,""):Zn(e)}:Zn,En=function(e){return e==null},oi=En,ui=TypeError,Kn=function(e){if(oi(e))throw new ui("Can't call method on "+e);return e},qn=si,Zi=Kn,Gi=function(e){return qn(Zi(e))},yi=$,vn=function(e){return typeof e=="object"?e!==null:yi(e)},xn={},ir=xn,Bi=oe,Sn=$,Us=function(e){return Sn(e)?e:void 0},Rn=function(e,t){return arguments.length<2?Us(ir[e])||Us(Bi[e]):ir[e]&&ir[e][t]||Bi[e]&&Bi[e][t]},Kt=oe.navigator,wt=Kt&&Kt.userAgent,Ot=wt?String(wt):"",un=oe,rn=Ot,Vn=un.process,Ci=un.Deno,is=Vn&&Vn.versions||Ci&&Ci.version,ur=is&&is.v8;ur&&(pt=(ft=ur.split("."))[0]>0&&ft[0]<4?1:+(ft[0]+ft[1])),!pt&&rn&&(!(ft=rn.match(/Edge\/(\d+)/))||ft[1]>=74)&&(ft=rn.match(/Chrome\/(\d+)/))&&(pt=+ft[1]);var wr=pt,hn=wr,hr=y,rs=oe.String,eo=!!Object.getOwnPropertySymbols&&!hr((function(){var e=Symbol("symbol detection");return!rs(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&hn&&hn<41})),Qc=eo&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Rf=Rn,Yd=$,Xr=ee,ho=Object,Fo=Qc?function(e){return typeof e=="symbol"}:function(e){var t=Rf("Symbol");return Yd(t)&&Xr(t.prototype,ho(e))},ju=String,Ts=function(e){try{return ju(e)}catch{return"Object"}},bE=$,Cf=Ts,gy=TypeError,hi=function(e){if(bE(e))return e;throw new gy(Cf(e)+" is not a function")},Sa=hi,oa=En,ka=function(e,t){var n=e[t];return oa(n)?void 0:Sa(n)},B_=Je,kS=$,Gu=vn,Sy=TypeError,Hh={exports:{}},Kh=oe,bf=Object.defineProperty,Wu=oe,Hu=function(e,t){try{bf(Kh,e,{value:t,configurable:!0,writable:!0})}catch{Kh[e]=t}return t},Ja="__core-js_shared__",po=Hh.exports=Wu[Ja]||Hu(Ja,{});(po.versions||(po.versions=[])).push({version:"3.42.0",mode:"pure",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var zh=Hh.exports,If=zh,Bo=function(e,t){return If[e]||(If[e]=t||{})},Yh=Kn,Ty=Object,Ao=function(e){return Ty(Yh(e))},j_=Ao,vy=J({}.hasOwnProperty),bi=Object.hasOwn||function(e,t){return vy(j_(e),t)},Ku=J,Qa=0,G_=Math.random(),yy=Ku(1 .toString),Ol=function(e){return"Symbol("+(e===void 0?"":e)+")_"+yy(++Qa+G_,36)},IE=Bo,Af=bi,LS=Ol,AE=eo,Nc=Qc,Dc=oe.Symbol,W_=IE("wks"),wE=Nc?Dc.for||Dc:Dc&&Dc.withoutSetter||LS,Fn=function(e){return Af(W_,e)||(W_[e]=AE&&Af(Dc,e)?Dc[e]:wE("Symbol."+e)),W_[e]},H_=Je,MS=vn,wo=Fo,Nl=ka,K_=function(e,t){var n,i;if(kS(n=e.toString)&&!Gu(i=B_(n,e))||kS(n=e.valueOf)&&!Gu(i=B_(n,e)))return i;throw new Sy("Can't convert object to primitive value")},wf=TypeError,qh=Fn("toPrimitive"),hs=function(e,t){if(!MS(e)||wo(e))return e;var n,i=Nl(e,qh);if(i){if(n=H_(i,e,t),!MS(n)||wo(n))return n;throw new wf("Can't convert object to primitive value")}return K_(e)},z_=Fo,hc=function(e){var t=hs(e,"string");return z_(t)?t:t+""},Xh=vn,Of=oe.document,US=Xh(Of)&&Xh(Of.createElement),Jh=function(e){return US?Of.createElement(e):{}},jb=Jh,xS=!Xe&&!y((function(){return Object.defineProperty(jb("div"),"a",{get:function(){return 7}}).a!==7})),OE=Xe,Qh=Je,cd=mt,Zh=xt,$h=Gi,VS=hc,zu=bi,Ry=xS,ep=Object.getOwnPropertyDescriptor;me.f=OE?ep:function(e,t){if(e=$h(e),t=VS(t),Ry)try{return ep(e,t)}catch{}if(zu(e,t))return Zh(!Qh(cd.f,e,t),e[t])};var qd=y,ld=$,Y_=/#|\.prototype\./,La=function(e,t){var n=tp[Nf(e)];return n===Yu||n!==FS&&(ld(t)?qd(t):!!t)},Nf=La.normalize=function(e){return String(e).replace(Y_,".").toLowerCase()},tp=La.data={},FS=La.NATIVE="N",Yu=La.POLYFILL="P",dd=La,BS=hi,Ma=b,ss=ye(ye.bind),aa=function(e,t){return BS(e),t===void 0?e:Ma?ss(e,t):function(){return e.apply(t,arguments)}},os={},NE=Xe&&y((function(){return Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype!==42})),DE=vn,PE=String,qu=TypeError,lr=function(e){if(DE(e))return e;throw new qu(PE(e)+" is not an object")},ud=Xe,Cy=xS,Gb=NE,Dl=lr,Df=hc,jS=TypeError,Xu=Object.defineProperty,by=Object.getOwnPropertyDescriptor,Ju="enumerable",q_="configurable",np="writable";os.f=ud?Gb?function(e,t,n){if(Dl(e),t=Df(t),Dl(n),typeof e=="function"&&t==="prototype"&&"value"in n&&np in n&&!n[np]){var i=by(e,t);i&&i[np]&&(e[t]=n.value,n={configurable:q_ in n?n[q_]:i[q_],enumerable:Ju in n?n[Ju]:i[Ju],writable:!1})}return Xu(e,t,n)}:Xu:function(e,t,n){if(Dl(e),t=Df(t),Dl(n),Cy)try{return Xu(e,t,n)}catch{}if("get"in n||"set"in n)throw new jS("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var X_=os,Iy=xt,pc=Xe?function(e,t,n){return X_.f(e,t,Iy(1,n))}:function(e,t,n){return e[t]=n,e},Pl=oe,J_=Ae,Ay=ye,kE=$,wy=me.f,GS=dd,Ta=xn,Oy=aa,Zc=pc,LE=bi,Ny=function(e){var t=function(n,i,s){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,i)}return new e(n,i,s)}return J_(e,this,arguments)};return t.prototype=e.prototype,t},Ut=function(e,t){var n,i,s,o,c,d,u,p,m,g=e.target,T=e.global,R=e.stat,I=e.proto,A=T?Pl:R?Pl[g]:Pl[g]&&Pl[g].prototype,w=T?Ta:Ta[g]||Zc(Ta,g,{})[g],k=w.prototype;for(o in t)i=!(n=GS(T?o:g+(R?".":"#")+o,e.forced))&&A&&LE(A,o),d=w[o],i&&(u=e.dontCallGetSet?(m=wy(A,o))&&m.value:A[o]),c=i&&u?u:t[o],(n||I||typeof d!=typeof c)&&(p=e.bind&&i?Oy(c,Pl):e.wrap&&i?Ny(c):I&&kE(c)?Ay(c):c,(e.sham||c&&c.sham||d&&d.sham)&&Zc(p,"sham",!0),Zc(w,o,p),I&&(LE(Ta,s=g+"Prototype")||Zc(Ta,s,{}),Zc(Ta[s],o,c),e.real&&k&&(n||!k[o])&&Zc(k,o,c)))},Dy=Math.ceil,Py=Math.floor,Pf=Math.trunc||function(e){var t=+e;return(t>0?Py:Dy)(t)},N=Pf,X=function(e){var t=+e;return t!=t||t===0?0:N(t)},ie=X,ve=Math.max,tt=Math.min,lt=function(e,t){var n=ie(e);return n<0?ve(n+t,0):tt(n,t)},Ht=X,Jr=Math.min,xs=function(e){var t=Ht(e);return t>0?Jr(t,9007199254740991):0},pr=xs,Vr=function(e){return pr(e.length)},Ua=Gi,ip=lt,$c=Vr,hd=function(e){return function(t,n,i){var s=Ua(t),o=$c(s);if(o===0)return!e&&-1;var c,d=ip(i,o);if(e&&n!=n){for(;o>d;)if((c=s[d++])!=c)return!0}else for(;o>d;d++)if((e||d in s)&&s[d]===n)return e||d||0;return!e&&-1}},kl={includes:hd(!0),indexOf:hd(!1)},cL=kl.includes;Ut({target:"Array",proto:!0,forced:y((function(){return!Array(1).includes()}))},{includes:function(e){return cL(this,e,arguments.length>1?arguments[1]:void 0)}});var ky=oe,mO=xn,to=function(e,t){var n=mO[e+"Prototype"],i=n&&n[t];if(i)return i;var s=ky[e],o=s&&s.prototype;return o&&o[t]},Wb=to("Array","includes"),Hb=vn,EO=Te,gO=Fn("match"),Ly=function(e){var t;return Hb(e)&&((t=e[gO])!==void 0?!!t:EO(e)==="RegExp")},lL=Ly,dL=TypeError,Kb={};Kb[Fn("toStringTag")]="z";var WS=String(Kb)==="[object z]",uL=WS,Ll=$,Xd=Te,SO=Fn("toStringTag"),TO=Object,vO=Xd((function(){return arguments})())==="Arguments",fc=uL?Xd:function(e){var t,n,i;return e===void 0?"Undefined":e===null?"Null":typeof(n=(function(s,o){try{return s[o]}catch{}})(t=TO(e),SO))=="string"?n:vO?Xd(t):(i=Xd(t))==="Object"&&Ll(t.callee)?"Arguments":i},zb=fc,hL=String,Fr=function(e){if(zb(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return hL(e)},Yb=Fn("match"),HS=Ut,qb=function(e){if(lL(e))throw new dL("The method doesn't accept regular expressions");return e},yO=Kn,rp=Fr,ME=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[Yb]=!1,"/./"[e](t)}catch{}}return!1},Xb=J("".indexOf);HS({target:"String",proto:!0,forced:!ME("includes")},{includes:function(e){return!!~Xb(rp(yO(this)),rp(qb(e)),arguments.length>1?arguments[1]:void 0)}});var RO=to("String","includes"),sp=ee,CO=Wb,bO=RO,UE=Array.prototype,KS=String.prototype,pL=function(e){var t=e.includes;return e===UE||sp(UE,e)&&t===UE.includes?CO:typeof e=="string"||e===KS||sp(KS,e)&&t===KS.includes?bO:t},Re=S(pL),IO=hi,AO=Ao,Jb=si,Jd=Vr,My=TypeError,el="Reduce of empty array with no initial value",pd=function(e){return function(t,n,i,s){var o=AO(t),c=Jb(o),d=Jd(o);if(IO(n),d===0&&i<2)throw new My(el);var u=e?d-1:0,p=e?-1:1;if(i<2)for(;;){if(u in c){s=c[u],u+=p;break}if(u+=p,e?u<0:d<=u)throw new My(el)}for(;e?u>=0:d>u;u+=p)u in c&&(s=n(s,c[u],u,o));return s}},xE={left:pd(!1)},Qb=y,Qu=function(e,t){var n=[][e];return!!n&&Qb((function(){n.call(null,t||function(){return 1},1)}))},fd=oe,Zb=Ot,VE=Te,kf=function(e){return Zb.slice(0,e.length)===e},Lf=kf("Bun/")?"BUN":kf("Cloudflare-Workers")?"CLOUDFLARE":kf("Deno/")?"DENO":kf("Node.js/")?"NODE":fd.Bun&&typeof Bun.version=="string"?"BUN":fd.Deno&&typeof Deno.version=="object"?"DENO":VE(fd.process)==="process"?"NODE":fd.window&&fd.document?"BROWSER":"REST",_d=Lf==="NODE",fL=xE.left;Ut({target:"Array",proto:!0,forced:!_d&&wr>79&&wr<83||!Qu("reduce")},{reduce:function(e){var t=arguments.length;return fL(this,e,t,t>1?arguments[1]:void 0)}});var Ml=to("Array","reduce"),$b=ee,op=Ml,FE=Array.prototype,Uy=function(e){var t=e.reduce;return e===FE||$b(FE,e)&&t===FE.reduce?op:t},ap=Uy,Ks=S(ap),eI=Te,tl=Array.isArray||function(e){return eI(e)==="Array"},BE=Ut,xy=tl,Vy=J([].reverse),nl=[1,2];BE({target:"Array",proto:!0,forced:String(nl)===String(nl.reverse())},{reverse:function(){return xy(this)&&(this.length=this.length),Vy(this)}});var md=to("Array","reverse"),Q_=ee,cp=md,Ul=Array.prototype,Z_=function(e){var t=e.reverse;return e===Ul||Q_(Ul,e)&&t===Ul.reverse?cp:t},Fy=Z_,zS=S(Fy),tI=Ol,Za=Bo("keys"),ps=function(e){return Za[e]||(Za[e]=tI(e))},Hr=!y((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),$_=bi,Zu=$,nI=Ao,em=Hr,By=ps("IE_PROTO"),jE=Object,YS=jE.prototype,lp=em?jE.getPrototypeOf:function(e){var t=nI(e);if($_(t,By))return t[By];var n=t.constructor;return Zu(n)&&t instanceof n?n.prototype:t instanceof jE?YS:null},wO=J,qS=hi,iI=vn,tm=function(e){return iI(e)||e===null},dp=String,Mf=TypeError,up=function(e,t,n){try{return wO(qS(Object.getOwnPropertyDescriptor(e,t)[n]))}catch{}},rI=vn,sI=Kn,XS=function(e){if(tm(e))return e;throw new Mf("Can't set "+dp(e)+" as a prototype")},jy=Object.setPrototypeOf||("__proto__"in{}?(function(){var e,t=!1,n={};try{(e=up(Object.prototype,"__proto__","set"))(n,[]),t=n instanceof Array}catch{}return function(i,s){return sI(i),XS(s),rI(i)&&(t?e(i,s):i.__proto__=s),i}})():void 0),xl={},Oo={},Uf=bi,OO=Gi,_L=kl.indexOf,mL=Oo,oI=J([].push),jo=function(e,t){var n,i=OO(e),s=0,o=[];for(n in i)!Uf(mL,n)&&Uf(i,n)&&oI(o,n);for(;t.length>s;)Uf(i,n=t[s++])&&(~_L(o,n)||oI(o,n));return o},nm=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],JS=jo,QS=nm.concat("length","prototype");xl.f=Object.getOwnPropertyNames||function(e){return JS(e,QS)};var Qd={};Qd.f=Object.getOwnPropertySymbols;var GE=Rn,WE=xl,EL=Qd,NO=lr,gL=J([].concat),DO=GE("Reflect","ownKeys")||function(e){var t=WE.f(NO(e)),n=EL.f;return n?gL(t,n(e)):t},hp=bi,aI=DO,Gy=me,PO=os,pp={},kO=jo,Wy=nm,fp=Object.keys||function(e){return kO(e,Wy)},LO=Xe,Hy=NE,MO=os,ZS=lr,UO=Gi,xO=fp;pp.f=LO&&!Hy?Object.defineProperties:function(e,t){ZS(e);for(var n,i=UO(t),s=xO(t),o=s.length,c=0;o>c;)MO.f(e,n=s[c++],i[n]);return e};var il,$S=Rn("document","documentElement"),cI=lr,xf=pp,$u=nm,eT=Oo,lI=$S,dI=Jh,_p="prototype",mp="script",Ky=ps("IE_PROTO"),HE=function(){},Vf=function(e){return"<"+mp+">"+e+"</"+mp+">"},KE=function(e){e.write(Vf("")),e.close();var t=e.parentWindow.Object;return e=null,t},Ff=function(){try{il=new ActiveXObject("htmlfile")}catch{}var e,t,n;Ff=typeof document<"u"?document.domain&&il?KE(il):(t=dI("iframe"),n="java"+mp+":",t.style.display="none",lI.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(Vf("document.F=Object")),e.close(),e.F):KE(il);for(var i=$u.length;i--;)delete Ff[_p][$u[i]];return Ff()};eT[Ky]=!0;var Zd=Object.create||function(e,t){var n;return e!==null?(HE[_p]=cI(e),n=new HE,HE[_p]=null,n[Ky]=e):n=Ff(),t===void 0?n:xf.f(n,t)},uI=vn,Bf=pc,xi=Error,fs=J("".replace),ca=String(new xi("zxcasd").stack),zE=/\n\s*at [^:]*:[^\n]*/,YE=zE.test(ca),im=xt,zy=!y((function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",im(1,7)),e.stack!==7)})),tT=pc,qE=function(e,t){if(YE&&typeof e=="string"&&!xi.prepareStackTrace)for(;t--;)e=fs(e,zE,"");return e},SL=zy,fo=Error.captureStackTrace,Vl={},hI=Vl,VO=Fn("iterator"),FO=Array.prototype,pI=function(e){return e!==void 0&&(hI.Array===e||FO[VO]===e)},fI=fc,nT=ka,_I=En,rl=Vl,la=Fn("iterator"),Ep=function(e){if(!_I(e))return nT(e,la)||nT(e,"@@iterator")||rl[fI(e)]},iT=Je,Yy=hi,mI=lr,gp=Ts,qy=Ep,EI=TypeError,rm=function(e,t){var n=arguments.length<2?qy(e):t;if(Yy(n))return mI(iT(n,e));throw new EI(gp(e)+" is not iterable")},BO=Je,Xy=lr,jO=ka,Jy=function(e,t,n){var i,s;Xy(e);try{if(!(i=jO(e,"return"))){if(t==="throw")throw n;return n}i=BO(i,e)}catch(o){s=!0,i=o}if(t==="throw")throw n;if(s)throw i;return Xy(i),n},GO=aa,WO=Je,gI=lr,HO=Ts,TL=pI,KO=Vr,Qy=ee,zO=rm,SI=Ep,Zy=Jy,YO=TypeError,jf=function(e,t){this.stopped=e,this.result=t},$y=jf.prototype,eh=function(e,t,n){var i,s,o,c,d,u,p,m=n&&n.that,g=!(!n||!n.AS_ENTRIES),T=!(!n||!n.IS_RECORD),R=!(!n||!n.IS_ITERATOR),I=!(!n||!n.INTERRUPTED),A=GO(t,m),w=function(L){return i&&Zy(i,"normal",L),new jf(!0,L)},k=function(L){return g?(gI(L),I?A(L[0],L[1],w):A(L[0],L[1])):I?A(L,w):A(L)};if(T)i=e.iterator;else if(R)i=e;else{if(!(s=SI(e)))throw new YO(HO(e)+" is not iterable");if(TL(s)){for(o=0,c=KO(e);c>o;o++)if((d=k(e[o]))&&Qy($y,d))return d;return new jf(!1)}i=zO(e,s)}for(u=T?e.next:i.next;!(p=WO(u,i)).done;){try{d=k(p.value)}catch(L){Zy(i,"throw",L)}if(typeof d=="object"&&d&&Qy($y,d))return d}return new jf(!1)},vL=Fr,qO=Ut,XE=ee,eR=lp,Gf=jy,tR=function(e,t,n){for(var i=aI(t),s=PO.f,o=Gy.f,c=0;c<i.length;c++){var d=i[c];hp(e,d)||n&&hp(n,d)||s(e,d,o(t,d))}},sm=Zd,JE=pc,QE=xt,XO=function(e,t){uI(t)&&"cause"in t&&Bf(e,"cause",t.cause)},JO=function(e,t,n,i){SL&&(fo?fo(e,t):tT(e,"stack",qE(n,i)))},QO=eh,ZO=function(e,t){return e===void 0?arguments.length<2?"":t:vL(e)},TI=Fn("toStringTag"),Wf=Error,$O=[].push,Fl=function(e,t){var n,i=XE(ZE,this);Gf?n=Gf(new Wf,i?eR(this):ZE):(n=i?this:sm(ZE),JE(n,TI,"Error")),t!==void 0&&JE(n,"message",ZO(t)),JO(n,Fl,n.stack,1),arguments.length>2&&XO(n,arguments[2]);var s=[];return QO(e,$O,{that:s}),JE(n,"errors",s),n};Gf?Gf(Fl,Wf):tR(Fl,Wf,{name:!0});var ZE=Fl.prototype=sm(Wf.prototype,{constructor:QE(1,Fl),message:QE(1,""),name:QE(1,"AggregateError")});qO({global:!0},{AggregateError:Fl});var Hf,Sp,Tp,eN=$,nR=oe.WeakMap,vI=eN(nR)&&/native code/.test(String(nR)),iR=oe,tN=vn,yL=pc,rT=bi,$E=zh,sT=ps,yI=Oo,eg="Object already initialized",tg=iR.TypeError,nN=iR.WeakMap;if(vI||$E.state){var No=$E.state||($E.state=new nN);No.get=No.get,No.has=No.has,No.set=No.set,Hf=function(e,t){if(No.has(e))throw new tg(eg);return t.facade=e,No.set(e,t),t},Sp=function(e){return No.get(e)||{}},Tp=function(e){return No.has(e)}}else{var Ed=sT("state");yI[Ed]=!0,Hf=function(e,t){if(rT(e,Ed))throw new tg(eg);return t.facade=e,yL(e,Ed,t),t},Sp=function(e){return rT(e,Ed)?e[Ed]:{}},Tp=function(e){return rT(e,Ed)}}var sl,RI,Kf,$a={set:Hf,get:Sp,has:Tp,enforce:function(e){return Tp(e)?Sp(e):Hf(e,{})},getterFor:function(e){return function(t){var n;if(!tN(t)||(n=Sp(t)).type!==e)throw new tg("Incompatible receiver, "+e+" required");return n}}},zf=Xe,oT=bi,ng=Function.prototype,iN=zf&&Object.getOwnPropertyDescriptor,rR=oT(ng,"name"),Yf={PROPER:rR&&(function(){}).name==="something",CONFIGURABLE:rR&&(!zf||zf&&iN(ng,"name").configurable)},rN=pc,Vs=function(e,t,n,i){return i&&i.enumerable?e[t]=n:rN(e,t,n),e},th=y,qf=$,sN=vn,Xf=Zd,$d=lp,va=Vs,Jf=Fn("iterator"),aT=!1;[].keys&&("next"in(Kf=[].keys())?(RI=$d($d(Kf)))!==Object.prototype&&(sl=RI):aT=!0);var CI=!sN(sl)||th((function(){var e={};return sl[Jf].call(e)!==e}));qf((sl=CI?{}:Xf(sl))[Jf])||va(sl,Jf,(function(){return this}));var sR={IteratorPrototype:sl,BUGGY_SAFARI_ITERATORS:aT},oN=fc,om=WS?{}.toString:function(){return"[object "+oN(this)+"]"},oR=WS,aN=os.f,cN=pc,lN=bi,aR=om,cR=Fn("toStringTag"),ya=function(e,t,n,i){var s=n?e:e&&e.prototype;s&&(lN(s,cR)||aN(s,cR,{configurable:!0,value:t}),i&&!oR&&cN(s,"toString",aR))},dN=sR.IteratorPrototype,uN=Zd,RL=xt,hN=ya,xa=Vl,ec=function(){return this},ig=function(e,t,n,i){var s=t+" Iterator";return e.prototype=uN(dN,{next:RL(+!i,n)}),hN(e,s,!1,!0),xa[s]=ec,e},pN=Ut,fN=Je,_N=Yf,mN=ig,lR=lp,bI=ya,dR=Vs,uR=Vl,EN=sR,II=_N.PROPER,vp=EN.BUGGY_SAFARI_ITERATORS,am=Fn("iterator"),hR="keys",yp="values",rg="entries",AI=function(){return this},pR=function(e,t,n,i,s,o,c){mN(n,t,i);var d,u,p,m=function(k){if(k===s&&A)return A;if(!vp&&k&&k in R)return R[k];switch(k){case hR:case yp:case rg:return function(){return new n(this,k)}}return function(){return new n(this)}},g=t+" Iterator",T=!1,R=e.prototype,I=R[am]||R["@@iterator"]||s&&R[s],A=!vp&&I||m(s),w=t==="Array"&&R.entries||I;if(w&&(d=lR(w.call(new e)))!==Object.prototype&&d.next&&(bI(d,g,!0,!0),uR[g]=AI),II&&s===yp&&I&&I.name!==yp&&(T=!0,A=function(){return fN(I,this)}),s)if(u={values:m(yp),keys:o?A:m(hR),entries:m(rg)},c)for(p in u)(vp||T||!(p in R))&&dR(R,p,u[p]);else pN({target:t,proto:!0,forced:vp||T},u);return c&&R[am]!==A&&dR(R,am,A,{}),uR[t]=A,u},Rp=function(e,t){return{value:e,done:t}},gN=Gi,eu=Vl,cT=$a;os.f;var CL=pR,Qf=Rp,tu="Array Iterator",SN=cT.set,fR=cT.getterFor(tu);CL(Array,"Array",(function(e,t){SN(this,{type:tu,target:gN(e),index:0,kind:t})}),(function(){var e=fR(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,Qf(void 0,!0);switch(e.kind){case"keys":return Qf(n,!1);case"values":return Qf(t[n],!1)}return Qf([n,t[n]],!1)}),"values"),eu.Arguments=eu.Array;var lT=os,as=function(e,t,n){return lT.f(e,t,n)},bL=Rn,IL=as,TN=Xe,cm=Fn("species"),Zf=ee,vN=TypeError,sg=function(e,t){if(Zf(t,e))return e;throw new vN("Incorrect invocation")},dT=$,ol=zh,yN=J(Function.toString);dT(ol.inspectSource)||(ol.inspectSource=function(e){return yN(e)});var uT=ol.inspectSource,RN=J,wI=y,hT=$,_R=fc,CN=uT,nu=function(){},_o=Rn("Reflect","construct"),lm=/^\s*(?:class|function)\b/,bN=RN(lm.exec),Va=!lm.test(nu),Cp=function(e){if(!hT(e))return!1;try{return _o(nu,[],e),!0}catch{return!1}},mR=function(e){if(!hT(e))return!1;switch(_R(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Va||!!bN(lm,CN(e))}catch{return!0}};mR.sham=!0;var nh,fr,_c,Bl,$f=!_o||wI((function(){var e;return Cp(Cp.call)||!Cp(Object)||!Cp((function(){e=!0}))||e}))?mR:Cp,IN=$f,AL=Ts,OI=TypeError,Pc=lr,iu=function(e){if(IN(e))return e;throw new OI(AL(e)+" is not a constructor")},AN=En,jl=Fn("species"),og=function(e,t){var n,i=Pc(e).constructor;return i===void 0||AN(n=Pc(i)[jl])?t:iu(n)},Do=J([].slice),dm=TypeError,da=function(e,t){if(e<t)throw new dm("Not enough arguments");return e},pT=/(?:ipad|iphone|ipod).*applewebkit/i.test(Ot),vs=oe,ih=Ae,wN=aa,e_=$,fT=bi,um=y,t_=$S,ON=Do,ER=Jh,_T=da,NN=pT,gR=_d,ag=vs.setImmediate,mT=vs.clearImmediate,wL=vs.process,Or=vs.Dispatch,Fs=vs.Function,Wi=vs.MessageChannel,_r=vs.String,Nr=0,Go={},rh="onreadystatechange";um((function(){nh=vs.location}));var sh=function(e){if(fT(Go,e)){var t=Go[e];delete Go[e],t()}},hm=function(e){return function(){sh(e)}},ru=function(e){sh(e.data)},no=function(e){vs.postMessage(_r(e),nh.protocol+"//"+nh.host)};ag&&mT||(ag=function(e){_T(arguments.length,1);var t=e_(e)?e:Fs(e),n=ON(arguments,1);return Go[++Nr]=function(){ih(t,void 0,n)},fr(Nr),Nr},mT=function(e){delete Go[e]},gR?fr=function(e){wL.nextTick(hm(e))}:Or&&Or.now?fr=function(e){Or.now(hm(e))}:Wi&&!NN?(Bl=(_c=new Wi).port2,_c.port1.onmessage=ru,fr=wN(Bl.postMessage,Bl)):vs.addEventListener&&e_(vs.postMessage)&&!vs.importScripts&&nh&&nh.protocol!=="file:"&&!um(no)?(fr=no,vs.addEventListener("message",ru,!1)):fr=rh in ER("script")?function(e){t_.appendChild(ER("script"))[rh]=function(){t_.removeChild(this),sh(e)}}:function(e){setTimeout(hm(e),0)});var al={set:ag,clear:mT},bp=oe,NI=Xe,gd=Object.getOwnPropertyDescriptor,n_=function(e){if(!NI)return bp[e];var t=gd(bp,e);return t&&t.value},pm=function(){this.head=null,this.tail=null};pm.prototype={add:function(e){var t={item:e,next:null},n=this.tail;n?n.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var io,fm,_m,i_,cg,oh=pm,tc=/ipad|iphone|ipod/i.test(Ot)&&typeof Pebble<"u",r_=/web0s(?!.*chrome)/i.test(Ot),mc=oe,lg=n_,ET=aa,mm=al.set,DN=oh,gT=pT,DI=tc,Gl=r_,dg=_d,kc=mc.MutationObserver||mc.WebKitMutationObserver,SR=mc.document,TR=mc.process,Em=mc.Promise,Sd=lg("queueMicrotask");if(!Sd){var ah=new DN,Ip=function(){var e,t;for(dg&&(e=TR.domain)&&e.exit();t=ah.get();)try{t()}catch(n){throw ah.head&&io(),n}e&&e.enter()};gT||dg||Gl||!kc||!SR?!DI&&Em&&Em.resolve?((i_=Em.resolve(void 0)).constructor=Em,cg=ET(i_.then,i_),io=function(){cg(Ip)}):dg?io=function(){TR.nextTick(Ip)}:(mm=ET(mm,mc),io=function(){mm(Ip)}):(fm=!0,_m=SR.createTextNode(""),new kc(Ip).observe(_m,{characterData:!0}),io=function(){_m.data=fm=!fm}),Sd=function(e){ah.head||io(),ah.add(e)}}var s_=Sd,Td=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},cl=oe.Promise,PN=oe,su=cl,PI=$,OL=dd,NL=uT,DL=Fn,vR=Lf,ug=wr,o_=su&&su.prototype,yR=DL("species"),RR=PI(PN.PromiseRejectionEvent),kN=OL("Promise",(function(){var e=NL(su),t=e!==String(su);if(!t&&ug===66||!o_.catch||!o_.finally)return!0;if(!ug||ug<51||!/native code/.test(e)){var n=new su((function(s){s(1)})),i=function(s){s((function(){}),(function(){}))};if((n.constructor={})[yR]=i,!(n.then((function(){}))instanceof i))return!0}return!(t||vR!=="BROWSER"&&vR!=="DENO"||RR)})),ch={CONSTRUCTOR:kN,REJECTION_EVENT:RR},ua={},CR=hi,LN=TypeError,bR=function(e){var t,n;this.promise=new e((function(i,s){if(t!==void 0||n!==void 0)throw new LN("Bad Promise constructor");t=i,n=s})),this.resolve=CR(t),this.reject=CR(n)};ua.f=function(e){return new bR(e)};var hg,IR,ys=Ut,Ap=_d,Lc=oe,lh=Je,PL=Vs,kL=ya,LL=function(e){var t=bL(e);TN&&t&&!t[cm]&&IL(t,cm,{configurable:!0,get:function(){return this}})},AR=hi,dh=$,kI=vn,wR=sg,LI=og,wp=al.set,ll=s_,ST=function(e,t){try{arguments.length===1?console.error(e):console.error(e,t)}catch{}},ML=Td,MN=oh,OR=$a,pg=cl,NR=ch,MI=ua,Op="Promise",DR=NR.CONSTRUCTOR,UN=NR.REJECTION_EVENT,TT=OR.getterFor(Op),UI=OR.set,xI=pg&&pg.prototype,Np=pg,vT=xI,gm=Lc.TypeError,yT=Lc.document,fg=Lc.process,Vi=MI.f,VI=Vi,PR=!!(yT&&yT.createEvent&&Lc.dispatchEvent),RT="unhandledrejection",kR=function(e){var t;return!(!kI(e)||!dh(t=e.then))&&t},CT=function(e,t){var n,i,s,o=t.value,c=t.state===1,d=c?e.ok:e.fail,u=e.resolve,p=e.reject,m=e.domain;try{d?(c||(t.rejection===2&&UL(t),t.rejection=1),d===!0?n=o:(m&&m.enter(),n=d(o),m&&(m.exit(),s=!0)),n===e.promise?p(new gm("Promise-chain cycle")):(i=kR(n))?lh(i,n,u,p):u(n)):p(o)}catch(g){m&&!s&&m.exit(),p(g)}},Sm=function(e,t){e.notified||(e.notified=!0,ll((function(){for(var n,i=e.reactions;n=i.get();)CT(n,e);e.notified=!1,t&&!e.rejection&&mg(e)})))},_g=function(e,t,n){var i,s;PR?((i=yT.createEvent("Event")).promise=t,i.reason=n,i.initEvent(e,!1,!0),Lc.dispatchEvent(i)):i={promise:t,reason:n},!UN&&(s=Lc["on"+e])?s(i):e===RT&&ST("Unhandled promise rejection",n)},mg=function(e){lh(wp,Lc,(function(){var t,n=e.facade,i=e.value;if(LR(e)&&(t=ML((function(){Ap?fg.emit("unhandledRejection",i,n):_g(RT,n,i)})),e.rejection=Ap||LR(e)?2:1,t.error))throw t.value}))},LR=function(e){return e.rejection!==1&&!e.parent},UL=function(e){lh(wp,Lc,(function(){var t=e.facade;Ap?fg.emit("rejectionHandled",t):_g("rejectionhandled",t,e.value)}))},ou=function(e,t,n){return function(i){e(t,i,n)}},vd=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,Sm(e,!0))},Eg=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw new gm("Promise can't be resolved itself");var i=kR(t);i?ll((function(){var s={done:!1};try{lh(i,t,ou(Eg,s,e),ou(vd,s,e))}catch(o){vd(s,o,e)}})):(e.value=t,e.state=1,Sm(e,!1))}catch(s){vd({done:!1},s,e)}}};DR&&(vT=(Np=function(e){wR(this,vT),AR(e),lh(hg,this);var t=TT(this);try{e(ou(Eg,t),ou(vd,t))}catch(n){vd(t,n)}}).prototype,(hg=function(e){UI(this,{type:Op,done:!1,notified:!1,parent:!1,reactions:new MN,rejection:!1,state:0,value:null})}).prototype=PL(vT,"then",(function(e,t){var n=TT(this),i=Vi(LI(this,Np));return n.parent=!0,i.ok=!dh(e)||e,i.fail=dh(t)&&t,i.domain=Ap?fg.domain:void 0,n.state===0?n.reactions.add(i):ll((function(){CT(i,n)})),i.promise})),IR=function(){var e=new hg,t=TT(e);this.promise=e,this.resolve=ou(Eg,t),this.reject=ou(vd,t)},MI.f=Vi=function(e){return e===Np||e===void 0?new IR(e):VI(e)}),ys({global:!0,wrap:!0,forced:DR},{Promise:Np}),kL(Np,Op,!1,!0),LL(Op);var gg=Fn("iterator"),Qr=!1;try{var FI=0,Ra={next:function(){return{done:!!FI++}},return:function(){Qr=!0}};Ra[gg]=function(){return this},Array.from(Ra,(function(){throw 2}))}catch{}var xL=cl,BI=function(e,t){try{if(!t&&!Qr)return!1}catch{return!1}var n=!1;try{var i={};i[gg]=function(){return{next:function(){return{done:n=!0}}}},e(i)}catch{}return n},Dp=ch.CONSTRUCTOR||!BI((function(e){xL.all(e).then(void 0,(function(){}))})),MR=Je,xN=hi,VN=ua,jI=Td,GI=eh;Ut({target:"Promise",stat:!0,forced:Dp},{all:function(e){var t=this,n=VN.f(t),i=n.resolve,s=n.reject,o=jI((function(){var c=xN(t.resolve),d=[],u=0,p=1;GI(e,(function(m){var g=u++,T=!1;p++,MR(c,t,m).then((function(R){T||(T=!0,d[g]=R,--p||i(d))}),s)})),--p||i(d)}));return o.error&&s(o.value),n.promise}});var VL=Ut,FN=ch.CONSTRUCTOR;cl&&cl.prototype,VL({target:"Promise",proto:!0,forced:FN,real:!0},{catch:function(e){return this.then(void 0,e)}});var FL=Je,BN=hi,BL=ua,jL=Td,a_=eh;Ut({target:"Promise",stat:!0,forced:Dp},{race:function(e){var t=this,n=BL.f(t),i=n.reject,s=jL((function(){var o=BN(t.resolve);a_(e,(function(c){FL(o,t,c).then(n.resolve,i)}))}));return s.error&&i(s.value),n.promise}});var jN=ua;Ut({target:"Promise",stat:!0,forced:ch.CONSTRUCTOR},{reject:function(e){var t=jN.f(this);return(0,t.reject)(e),t.promise}});var WI=lr,GL=vn,WL=ua,bT=function(e,t){if(WI(e),GL(t)&&t.constructor===e)return t;var n=WL.f(e);return(0,n.resolve)(t),n.promise},HL=Ut,au=cl,HI=ch.CONSTRUCTOR,GN=bT,WN=Rn("Promise"),IT=!HI;HL({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return GN(IT&&this===WN?au:this,e)}});var yd=Je,HN=hi,UR=ua,Pp=Td,KL=eh;Ut({target:"Promise",stat:!0,forced:Dp},{allSettled:function(e){var t=this,n=UR.f(t),i=n.resolve,s=n.reject,o=Pp((function(){var c=HN(t.resolve),d=[],u=0,p=1;KL(e,(function(m){var g=u++,T=!1;p++,yd(c,t,m).then((function(R){T||(T=!0,d[g]={status:"fulfilled",value:R},--p||i(d))}),(function(R){T||(T=!0,d[g]={status:"rejected",reason:R},--p||i(d))}))})),--p||i(d)}));return o.error&&s(o.value),n.promise}});var zL=Je,Sg=hi,KN=Rn,YL=ua,qL=Td,XL=eh,KI="No one promise resolved";Ut({target:"Promise",stat:!0,forced:Dp},{any:function(e){var t=this,n=KN("AggregateError"),i=YL.f(t),s=i.resolve,o=i.reject,c=qL((function(){var d=Sg(t.resolve),u=[],p=0,m=1,g=!1;XL(e,(function(T){var R=p++,I=!1;m++,zL(d,t,T).then((function(A){I||g||(g=!0,s(A))}),(function(A){I||g||(I=!0,u[R]=A,--m||o(new n(u,KI)))}))})),--m||o(new n(u,KI))}));return c.error&&o(c.value),i.promise}});var JL=Ut,QL=Ae,ZL=Do,zN=ua,Tg=hi,Tm=Td,vg=oe.Promise,zI=!1;JL({target:"Promise",stat:!0,forced:!vg||!vg.try||Tm((function(){vg.try((function(e){zI=e===8}),8)})).error||!zI},{try:function(e){var t=arguments.length>1?ZL(arguments,1):[],n=zN.f(this),i=Tm((function(){return QL(Tg(e),void 0,t)}));return(i.error?n.reject:n.resolve)(i.value),n.promise}});var yg=ua;Ut({target:"Promise",stat:!0},{withResolvers:function(){var e=yg.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var AT=Ut,Rg=cl,xR=y,YI=Rn,qI=$,VR=og,FR=bT,YN=Rg&&Rg.prototype;AT({target:"Promise",proto:!0,real:!0,forced:!!Rg&&xR((function(){YN.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=VR(this,YI("Promise")),n=qI(e);return this.then(n?function(i){return FR(t,e()).then((function(){return i}))}:e,n?function(i){return FR(t,e()).then((function(){throw i}))}:e)}});var wT=J,qN=X,OT=Fr,$L=Kn,e1=wT("".charAt),XI=wT("".charCodeAt),BR=wT("".slice),Cg=function(e){return function(t,n){var i,s,o=OT($L(t)),c=qN(n),d=o.length;return c<0||c>=d?e?"":void 0:(i=XI(o,c))<55296||i>56319||c+1===d||(s=XI(o,c+1))<56320||s>57343?e?e1(o,c):i:e?BR(o,c,c+2):s-56320+(i-55296<<10)+65536}},vm={codeAt:Cg(!1),charAt:Cg(!0)},t1=vm.charAt,NT=Fr,JI=$a,XN=pR,jR=Rp,GR="String Iterator",JN=JI.set,QI=JI.getterFor(GR);XN(String,"String",(function(e){JN(this,{type:GR,string:NT(e),index:0})}),(function(){var e,t=QI(this),n=t.string,i=t.index;return i>=n.length?jR(void 0,!0):(e=t1(n,i),t.index+=e.length,jR(e,!1))}));var QN=xn.Promise,WR={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},n1=oe,i1=ya,DT=Vl;for(var ym in WR)i1(n1[ym],ym),DT[ym]=DT.Array;var bg=QN,De=S(bg),ZN=to("Array","values"),ZI=fc,c_=bi,l_=ee,d_=ZN,kp=Array.prototype,PT={DOMTokenList:!0,NodeList:!0},u_=function(e){var t=e.values;return e===kp||l_(kp,e)&&t===kp.values||c_(PT,ZI(e))?d_:t},cs=S(u_),HR=Ts,kT=TypeError,$I=Do,$N=Math.floor,h_=function(e,t){var n=e.length;if(n<8)for(var i,s,o=1;o<n;){for(s=o,i=e[o];s&&t(e[s-1],i)>0;)e[s]=e[--s];s!==o++&&(e[s]=i)}else for(var c=$N(n/2),d=h_($I(e,0,c),t),u=h_($I(e,c),t),p=d.length,m=u.length,g=0,T=0;g<p||T<m;)e[g+T]=g<p&&T<m?t(d[g],u[T])<=0?d[g++]:u[T++]:g<p?d[g++]:u[T++];return e},KR=h_,eA=Ot.match(/firefox\/(\d+)/i),zR=!!eA&&+eA[1],YR=/MSIE|Trident/.test(Ot),qR=Ot.match(/AppleWebKit\/(\d+)\./),LT=!!qR&&+qR[1],tA=Ut,Ig=J,eD=hi,r1=Ao,Ag=Vr,f=function(e,t){if(!delete e[t])throw new kT("Cannot delete property "+HR(t)+" of "+HR(e))},E=Fr,v=y,C=KR,P=Qu,B=zR,ce=YR,Ee=wr,Fe=LT,Ze=[],Et=Ig(Ze.sort),Nt=Ig(Ze.push),ot=v((function(){Ze.sort(void 0)})),at=v((function(){Ze.sort(null)})),Si=P("sort"),Xn=!v((function(){if(Ee)return Ee<70;if(!(B&&B>3)){if(ce)return!0;if(Fe)return Fe<603;var e,t,n,i,s="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)Ze.push({k:t+i,v:n})}for(Ze.sort((function(o,c){return c.v-o.v})),i=0;i<Ze.length;i++)t=Ze[i].k.charAt(0),s.charAt(s.length-1)!==t&&(s+=t);return s!=="DGBEFHACIJK"}}));tA({target:"Array",proto:!0,forced:ot||!at||!Si||!Xn},{sort:function(e){e!==void 0&&eD(e);var t=r1(this);if(Xn)return e===void 0?Et(t):Et(t,e);var n,i,s=[],o=Ag(t);for(i=0;i<o;i++)i in t&&Nt(s,t[i]);for(C(s,(function(c){return function(d,u){return u===void 0?-1:d===void 0?1:c!==void 0?+c(d,u)||0:E(d)>E(u)?1:-1}})(e)),n=Ag(s),i=0;i<n;)t[i]=s[i++];for(;i<o;)f(t,i++);return t}});var _s=to("Array","sort"),Qe=ee,Ke=_s,et=Array.prototype,bt=function(e){var t=e.sort;return e===et||Qe(et,e)&&t===et.sort?Ke:t},Zt=S(bt),qi=Ut,Bn=J,pi=lt,Fa=RangeError,mr=String.fromCharCode,uh=String.fromCodePoint,s1=Bn([].join);qi({target:"String",stat:!0,forced:!!uh&&uh.length!==1},{fromCodePoint:function(e){for(var t,n=[],i=arguments.length,s=0;i>s;){if(t=+arguments[s++],pi(t,1114111)!==t)throw new Fa(t+" is not a valid code point");n[s]=t<65536?mr(t):mr(55296+((t-=65536)>>10),t%1024+56320)}return s1(n,"")}});var xW=y,VW=Fn("iterator"),MT=!xW((function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,n=new URLSearchParams("a=1&a=2&b=3"),i="";return e.pathname="c%20d",t.forEach((function(s,o){t.delete("b"),i+=o+s})),n.delete("a",2),n.delete("b",void 0),!e.toJSON||!n.has("a",1)||n.has("a",2)||!n.has("a",void 0)||n.has("b")||!t.size&&!0||!t.sort||e.href!=="https://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[VW]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://тест").host!=="xn--e1aybc"||new URL("https://a#б").hash!=="#%D0%B1"||i!=="a1c3"||new URL("https://x",void 0).host!=="x"})),FW=Vs,nA=Ut,o1=oe,iA=n_,BW=Rn,UT=Je,Ca=J,Rm=Xe,a1=MT,c1=Vs,jW=as,GW=function(e,t,n){for(var i in t)n&&n.unsafe&&e[i]?e[i]=t[i]:FW(e,i,t[i],n);return e},WW=ya,HW=ig,rA=$a,l1=sg,sA=$,KW=bi,zW=aa,YW=fc,qW=lr,d1=vn,Rs=Fr,XW=Zd,u1=xt,h1=rm,JW=Ep,xT=Rp,Lp=da,QW=KR,ZW=Fn("iterator"),Mp="URLSearchParams",p1=Mp+"Iterator",f1=rA.set,Wo=rA.getterFor(Mp),$W=rA.getterFor(p1),_1=iA("fetch"),VT=iA("Request"),Cm=iA("Headers"),oA=VT&&VT.prototype,m1=Cm&&Cm.prototype,eH=o1.TypeError,tH=o1.encodeURIComponent,nH=String.fromCharCode,iH=BW("String","fromCodePoint"),rH=parseInt,FT=Ca("".charAt),E1=Ca([].join),Wl=Ca([].push),g1=Ca("".replace),sH=Ca([].shift),S1=Ca([].splice),T1=Ca("".split),v1=Ca("".slice),oH=Ca(/./.exec),aH=/\+/g,cH=/^[0-9a-f]+$/i,y1=function(e,t){var n=v1(e,t,t+2);return oH(cH,n)?rH(n,16):NaN},lH=function(e){for(var t=0,n=128;n>0&&(e&n)!=0;n>>=1)t++;return t},dH=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},R1=function(e){for(var t=(e=g1(e,aH," ")).length,n="",i=0;i<t;){var s=FT(e,i);if(s==="%"){if(FT(e,i+1)==="%"||i+3>t){n+="%",i++;continue}var o=y1(e,i+1);if(o!=o){n+=s,i++;continue}i+=2;var c=lH(o);if(c===0)s=nH(o);else{if(c===1||c>4){n+="�",i++;continue}for(var d=[o],u=1;u<c&&!(++i+3>t||FT(e,i)!=="%");){var p=y1(e,i+1);if(p!=p){i+=3;break}if(p>191||p<128)break;Wl(d,p),i+=2,u++}if(d.length!==c){n+="�";continue}var m=dH(d);m===null?n+="�":s=iH(m)}}n+=s,i++}return n},uH=/[!'()~]|%20/g,hH={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},pH=function(e){return hH[e]},C1=function(e){return g1(tH(e),uH,pH)},aA=HW((function(e,t){f1(this,{type:p1,target:Wo(e).entries,index:0,kind:t})}),Mp,(function(){var e=$W(this),t=e.target,n=e.index++;if(!t||n>=t.length)return e.target=null,xT(void 0,!0);var i=t[n];switch(e.kind){case"keys":return xT(i.key,!1);case"values":return xT(i.value,!1)}return xT([i.key,i.value],!1)}),!0),b1=function(e){this.entries=[],this.url=null,e!==void 0&&(d1(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?FT(e,0)==="?"?v1(e,1):e:Rs(e)))};b1.prototype={type:Mp,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,n,i,s,o,c,d,u=this.entries,p=JW(e);if(p)for(n=(t=h1(e,p)).next;!(i=UT(n,t)).done;){if(o=(s=h1(qW(i.value))).next,(c=UT(o,s)).done||(d=UT(o,s)).done||!UT(o,s).done)throw new eH("Expected sequence with length 2");Wl(u,{key:Rs(c.value),value:Rs(d.value)})}else for(var m in e)KW(e,m)&&Wl(u,{key:m,value:Rs(e[m])})},parseQuery:function(e){if(e)for(var t,n,i=this.entries,s=T1(e,"&"),o=0;o<s.length;)(t=s[o++]).length&&(n=T1(t,"="),Wl(i,{key:R1(sH(n)),value:R1(E1(n,"="))}))},serialize:function(){for(var e,t=this.entries,n=[],i=0;i<t.length;)e=t[i++],Wl(n,C1(e.key)+"="+C1(e.value));return E1(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var BT=function(){l1(this,Up);var e=f1(this,new b1(arguments.length>0?arguments[0]:void 0));Rm||(this.size=e.entries.length)},Up=BT.prototype;if(GW(Up,{append:function(e,t){var n=Wo(this);Lp(arguments.length,2),Wl(n.entries,{key:Rs(e),value:Rs(t)}),Rm||this.length++,n.updateURL()},delete:function(e){for(var t=Wo(this),n=Lp(arguments.length,1),i=t.entries,s=Rs(e),o=n<2?void 0:arguments[1],c=o===void 0?o:Rs(o),d=0;d<i.length;){var u=i[d];if(u.key!==s||c!==void 0&&u.value!==c)d++;else if(S1(i,d,1),c!==void 0)break}Rm||(this.size=i.length),t.updateURL()},get:function(e){var t=Wo(this).entries;Lp(arguments.length,1);for(var n=Rs(e),i=0;i<t.length;i++)if(t[i].key===n)return t[i].value;return null},getAll:function(e){var t=Wo(this).entries;Lp(arguments.length,1);for(var n=Rs(e),i=[],s=0;s<t.length;s++)t[s].key===n&&Wl(i,t[s].value);return i},has:function(e){for(var t=Wo(this).entries,n=Lp(arguments.length,1),i=Rs(e),s=n<2?void 0:arguments[1],o=s===void 0?s:Rs(s),c=0;c<t.length;){var d=t[c++];if(d.key===i&&(o===void 0||d.value===o))return!0}return!1},set:function(e,t){var n=Wo(this);Lp(arguments.length,1);for(var i,s=n.entries,o=!1,c=Rs(e),d=Rs(t),u=0;u<s.length;u++)(i=s[u]).key===c&&(o?S1(s,u--,1):(o=!0,i.value=d));o||Wl(s,{key:c,value:d}),Rm||(this.size=s.length),n.updateURL()},sort:function(){var e=Wo(this);QW(e.entries,(function(t,n){return t.key>n.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,n=Wo(this).entries,i=zW(e,arguments.length>1?arguments[1]:void 0),s=0;s<n.length;)i((t=n[s++]).value,t.key,this)},keys:function(){return new aA(this,"keys")},values:function(){return new aA(this,"values")},entries:function(){return new aA(this,"entries")}},{enumerable:!0}),c1(Up,ZW,Up.entries,{}),c1(Up,"toString",(function(){return Wo(this).serialize()}),{enumerable:!0}),Rm&&jW(Up,"size",{get:function(){return Wo(this).entries.length},configurable:!0,enumerable:!0}),WW(BT,Mp),nA({global:!0,forced:!a1},{URLSearchParams:BT}),!a1&&sA(Cm)){var fH=Ca(m1.has),_H=Ca(m1.set),I1=function(e){if(d1(e)){var t,n=e.body;if(YW(n)===Mp)return t=e.headers?new Cm(e.headers):new Cm,fH(t,"content-type")||_H(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),XW(e,{body:u1(0,Rs(n)),headers:u1(0,t)})}return e};if(sA(_1)&&nA({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return _1(e,arguments.length>1?I1(arguments[1]):{})}}),sA(VT)){var cA=function(e){return l1(this,oA),new VT(e,arguments.length>1?I1(arguments[1]):{})};oA.constructor=cA,cA.prototype=oA,nA({global:!0,dontCallGetSet:!0,forced:!0},{Request:cA})}}var Ho,mH={URLSearchParams:BT,getState:Wo},EH=xn.URLSearchParams,A1=Xe,gH=J,SH=Je,TH=y,lA=fp,vH=Qd,yH=mt,RH=Ao,CH=si,xp=Object.assign,w1=Object.defineProperty,bH=gH([].concat),IH=!xp||TH((function(){if(A1&&xp({b:1},xp(w1({},"a",{enumerable:!0,get:function(){w1(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},n=Symbol("assign detection"),i="abcdefghijklmnopqrst";return e[n]=7,i.split("").forEach((function(s){t[s]=s})),xp({},e)[n]!==7||lA(xp({},t)).join("")!==i}))?function(e,t){for(var n=RH(e),i=arguments.length,s=1,o=vH.f,c=yH.f;i>s;)for(var d,u=CH(arguments[s++]),p=o?bH(lA(u),o(u)):lA(u),m=p.length,g=0;m>g;)d=p[g++],A1&&!SH(c,u,d)||(n[d]=u[d]);return n}:xp,AH=lr,wH=Jy,OH=Xe,NH=os,DH=xt,dA=function(e,t,n){OH?NH.f(e,t,DH(0,n)):e[t]=n},PH=aa,kH=Je,LH=Ao,MH=function(e,t,n,i){try{return i?t(AH(n)[0],n[1]):t(n)}catch(s){wH(e,"throw",s)}},UH=pI,xH=$f,VH=Vr,O1=dA,FH=rm,BH=Ep,N1=Array,cu=J,uA=2147483647,jH=/[^\0-\u007E]/,D1=/[.\u3002\uFF0E\uFF61]/g,P1="Overflow: input needs wider integers to process",k1=RangeError,GH=cu(D1.exec),Vp=Math.floor,hA=String.fromCharCode,L1=cu("".charCodeAt),M1=cu([].join),Hl=cu([].push),WH=cu("".replace),HH=cu("".split),KH=cu("".toLowerCase),U1=function(e){return e+22+75*(e<26)},zH=function(e,t,n){var i=0;for(e=n?Vp(e/700):e>>1,e+=Vp(e/t);e>455;)e=Vp(e/35),i+=36;return Vp(i+36*e/(e+38))},YH=function(e){var t=[];e=(function(k){for(var L=[],j=0,K=k.length;j<K;){var W=L1(k,j++);if(W>=55296&&W<=56319&&j<K){var Y=L1(k,j++);(64512&Y)==56320?Hl(L,((1023&W)<<10)+(1023&Y)+65536):(Hl(L,W),j--)}else Hl(L,W)}return L})(e);var n,i,s=e.length,o=128,c=0,d=72;for(n=0;n<e.length;n++)(i=e[n])<128&&Hl(t,hA(i));var u=t.length,p=u;for(u&&Hl(t,"-");p<s;){var m=uA;for(n=0;n<e.length;n++)(i=e[n])>=o&&i<m&&(m=i);var g=p+1;if(m-o>Vp((uA-c)/g))throw new k1(P1);for(c+=(m-o)*g,o=m,n=0;n<e.length;n++){if((i=e[n])<o&&++c>uA)throw new k1(P1);if(i===o){for(var T=c,R=36;;){var I=R<=d?1:R>=d+26?26:R-d;if(T<I)break;var A=T-I,w=36-I;Hl(t,hA(U1(I+A%w))),T=Vp(A/w),R+=36}Hl(t,hA(U1(T))),d=zH(c,g,p===u),c=0,p++}}c++,o++}return M1(t,"")},qH=Ut,pA=Xe,XH=MT,fA=oe,x1=aa,Ko=J,jT=Vs,zo=as,JH=sg,_A=bi,mA=IH,Fp=function(e){var t=LH(e),n=xH(this),i=arguments.length,s=i>1?arguments[1]:void 0,o=s!==void 0;o&&(s=PH(s,i>2?arguments[2]:void 0));var c,d,u,p,m,g,T=BH(t),R=0;if(!T||this===N1&&UH(T))for(c=VH(t),d=n?new this(c):N1(c);c>R;R++)g=o?s(t[R],R):t[R],O1(d,R,g);else for(d=n?new this:[],m=(p=FH(t,T)).next;!(u=kH(m,p)).done;R++)g=o?MH(p,s,[u.value,R],!0):u.value,O1(d,R,g);return d.length=R,d},ba=Do,QH=vm.codeAt,ZH=function(e){var t,n,i=[],s=HH(WH(KH(e),D1,"."),".");for(t=0;t<s.length;t++)n=s[t],Hl(i,GH(jH,n)?"xn--"+YH(n):n);return M1(i,".")},Mc=Fr,$H=ya,e8=da,V1=mH,F1=$a,t8=F1.set,GT=F1.getterFor("URL"),n8=V1.URLSearchParams,i8=V1.getState,bm=fA.URL,EA=fA.TypeError,WT=fA.parseInt,r8=Math.floor,B1=Math.pow,Yo=Ko("".charAt),Ia=Ko(/./.exec),Im=Ko([].join),s8=Ko(1 .toString),o8=Ko([].pop),Bp=Ko([].push),gA=Ko("".replace),a8=Ko([].shift),c8=Ko("".split),Am=Ko("".slice),HT=Ko("".toLowerCase),l8=Ko([].unshift),SA="Invalid scheme",jp="Invalid host",j1="Invalid port",G1=/[a-z]/i,d8=/[\d+-.a-z]/i,TA=/\d/,u8=/^0x/i,h8=/^[0-7]+$/,p8=/^\d+$/,W1=/^[\da-f]+$/i,f8=/[\0\t\n\r #%/:<>?@[\\\]^|]/,_8=/[\0\t\n\r #/:<>?@[\\\]^|]/,m8=/^[\u0000-\u0020]+/,E8=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,g8=/[\t\n\r]/g,wm=function(e){var t,n,i,s;if(typeof e=="number"){for(t=[],n=0;n<4;n++)l8(t,e%256),e=r8(e/256);return Im(t,".")}if(typeof e=="object"){for(t="",i=(function(o){for(var c=null,d=1,u=null,p=0,m=0;m<8;m++)o[m]!==0?(p>d&&(c=u,d=p),u=null,p=0):(u===null&&(u=m),++p);return p>d?u:c})(e),n=0;n<8;n++)s&&e[n]===0||(s&&(s=!1),i===n?(t+=n?":":"::",s=!0):(t+=s8(e[n],16),n<7&&(t+=":")));return"["+t+"]"}return e},KT={},H1=mA({},KT,{" ":1,'"':1,"<":1,">":1,"`":1}),K1=mA({},H1,{"#":1,"?":1,"{":1,"}":1}),vA=mA({},K1,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Kl=function(e,t){var n=QH(e,0);return n>32&&n<127&&!_A(t,e)?e:encodeURIComponent(e)},zT={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Om=function(e,t){var n;return e.length===2&&Ia(G1,Yo(e,0))&&((n=Yo(e,1))===":"||!t&&n==="|")},z1=function(e){var t;return e.length>1&&Om(Am(e,0,2))&&(e.length===2||(t=Yo(e,2))==="/"||t==="\\"||t==="?"||t==="#")},S8=function(e){return e==="."||HT(e)==="%2e"},yA={},Y1={},RA={},q1={},X1={},CA={},J1={},Q1={},YT={},qT={},bA={},IA={},AA={},wA={},Z1={},OA={},Gp={},nc={},$1={},lu={},Uc={},NA=function(e,t,n){var i,s,o,c=Mc(e);if(t){if(s=this.parse(c))throw new EA(s);this.searchParams=null}else{if(n!==void 0&&(i=new NA(n,!0)),s=this.parse(c,null,i))throw new EA(s);(o=i8(new n8)).bindURL(this),this.searchParams=o}};NA.prototype={type:"URL",parse:function(e,t,n){var i,s,o,c,d,u=this,p=t||yA,m=0,g="",T=!1,R=!1,I=!1;for(e=Mc(e),t||(u.scheme="",u.username="",u.password="",u.host=null,u.port=null,u.path=[],u.query=null,u.fragment=null,u.cannotBeABaseURL=!1,e=gA(e,m8,""),e=gA(e,E8,"$1")),e=gA(e,g8,""),i=Fp(e);m<=i.length;){switch(s=i[m],p){case yA:if(!s||!Ia(G1,s)){if(t)return SA;p=RA;continue}g+=HT(s),p=Y1;break;case Y1:if(s&&(Ia(d8,s)||s==="+"||s==="-"||s==="."))g+=HT(s);else{if(s!==":"){if(t)return SA;g="",p=RA,m=0;continue}if(t&&(u.isSpecial()!==_A(zT,g)||g==="file"&&(u.includesCredentials()||u.port!==null)||u.scheme==="file"&&!u.host))return;if(u.scheme=g,t)return void(u.isSpecial()&&zT[u.scheme]===u.port&&(u.port=null));g="",u.scheme==="file"?p=wA:u.isSpecial()&&n&&n.scheme===u.scheme?p=q1:u.isSpecial()?p=Q1:i[m+1]==="/"?(p=X1,m++):(u.cannotBeABaseURL=!0,Bp(u.path,""),p=$1)}break;case RA:if(!n||n.cannotBeABaseURL&&s!=="#")return SA;if(n.cannotBeABaseURL&&s==="#"){u.scheme=n.scheme,u.path=ba(n.path),u.query=n.query,u.fragment="",u.cannotBeABaseURL=!0,p=Uc;break}p=n.scheme==="file"?wA:CA;continue;case q1:if(s!=="/"||i[m+1]!=="/"){p=CA;continue}p=YT,m++;break;case X1:if(s==="/"){p=qT;break}p=nc;continue;case CA:if(u.scheme=n.scheme,s===Ho)u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=ba(n.path),u.query=n.query;else if(s==="/"||s==="\\"&&u.isSpecial())p=J1;else if(s==="?")u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=ba(n.path),u.query="",p=lu;else{if(s!=="#"){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=ba(n.path),u.path.length--,p=nc;continue}u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=ba(n.path),u.query=n.query,u.fragment="",p=Uc}break;case J1:if(!u.isSpecial()||s!=="/"&&s!=="\\"){if(s!=="/"){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,p=nc;continue}p=qT}else p=YT;break;case Q1:if(p=YT,s!=="/"||Yo(g,m+1)!=="/")continue;m++;break;case YT:if(s!=="/"&&s!=="\\"){p=qT;continue}break;case qT:if(s==="@"){T&&(g="%40"+g),T=!0,o=Fp(g);for(var A=0;A<o.length;A++){var w=o[A];if(w!==":"||I){var k=Kl(w,vA);I?u.password+=k:u.username+=k}else I=!0}g=""}else if(s===Ho||s==="/"||s==="?"||s==="#"||s==="\\"&&u.isSpecial()){if(T&&g==="")return"Invalid authority";m-=Fp(g).length+1,g="",p=bA}else g+=s;break;case bA:case IA:if(t&&u.scheme==="file"){p=OA;continue}if(s!==":"||R){if(s===Ho||s==="/"||s==="?"||s==="#"||s==="\\"&&u.isSpecial()){if(u.isSpecial()&&g==="")return jp;if(t&&g===""&&(u.includesCredentials()||u.port!==null))return;if(c=u.parseHost(g))return c;if(g="",p=Gp,t)return;continue}s==="["?R=!0:s==="]"&&(R=!1),g+=s}else{if(g==="")return jp;if(c=u.parseHost(g))return c;if(g="",p=AA,t===IA)return}break;case AA:if(!Ia(TA,s)){if(s===Ho||s==="/"||s==="?"||s==="#"||s==="\\"&&u.isSpecial()||t){if(g!==""){var L=WT(g,10);if(L>65535)return j1;u.port=u.isSpecial()&&L===zT[u.scheme]?null:L,g=""}if(t)return;p=Gp;continue}return j1}g+=s;break;case wA:if(u.scheme="file",s==="/"||s==="\\")p=Z1;else{if(!n||n.scheme!=="file"){p=nc;continue}switch(s){case Ho:u.host=n.host,u.path=ba(n.path),u.query=n.query;break;case"?":u.host=n.host,u.path=ba(n.path),u.query="",p=lu;break;case"#":u.host=n.host,u.path=ba(n.path),u.query=n.query,u.fragment="",p=Uc;break;default:z1(Im(ba(i,m),""))||(u.host=n.host,u.path=ba(n.path),u.shortenPath()),p=nc;continue}}break;case Z1:if(s==="/"||s==="\\"){p=OA;break}n&&n.scheme==="file"&&!z1(Im(ba(i,m),""))&&(Om(n.path[0],!0)?Bp(u.path,n.path[0]):u.host=n.host),p=nc;continue;case OA:if(s===Ho||s==="/"||s==="\\"||s==="?"||s==="#"){if(!t&&Om(g))p=nc;else if(g===""){if(u.host="",t)return;p=Gp}else{if(c=u.parseHost(g))return c;if(u.host==="localhost"&&(u.host=""),t)return;g="",p=Gp}continue}g+=s;break;case Gp:if(u.isSpecial()){if(p=nc,s!=="/"&&s!=="\\")continue}else if(t||s!=="?")if(t||s!=="#"){if(s!==Ho&&(p=nc,s!=="/"))continue}else u.fragment="",p=Uc;else u.query="",p=lu;break;case nc:if(s===Ho||s==="/"||s==="\\"&&u.isSpecial()||!t&&(s==="?"||s==="#")){if((d=HT(d=g))===".."||d==="%2e."||d===".%2e"||d==="%2e%2e"?(u.shortenPath(),s==="/"||s==="\\"&&u.isSpecial()||Bp(u.path,"")):S8(g)?s==="/"||s==="\\"&&u.isSpecial()||Bp(u.path,""):(u.scheme==="file"&&!u.path.length&&Om(g)&&(u.host&&(u.host=""),g=Yo(g,0)+":"),Bp(u.path,g)),g="",u.scheme==="file"&&(s===Ho||s==="?"||s==="#"))for(;u.path.length>1&&u.path[0]==="";)a8(u.path);s==="?"?(u.query="",p=lu):s==="#"&&(u.fragment="",p=Uc)}else g+=Kl(s,K1);break;case $1:s==="?"?(u.query="",p=lu):s==="#"?(u.fragment="",p=Uc):s!==Ho&&(u.path[0]+=Kl(s,KT));break;case lu:t||s!=="#"?s!==Ho&&(s==="'"&&u.isSpecial()?u.query+="%27":u.query+=s==="#"?"%23":Kl(s,KT)):(u.fragment="",p=Uc);break;case Uc:s!==Ho&&(u.fragment+=Kl(s,H1))}m++}},parseHost:function(e){var t,n,i;if(Yo(e,0)==="["){if(Yo(e,e.length-1)!=="]"||(t=(function(s){var o,c,d,u,p,m,g,T=[0,0,0,0,0,0,0,0],R=0,I=null,A=0,w=function(){return Yo(s,A)};if(w()===":"){if(Yo(s,1)!==":")return;A+=2,I=++R}for(;w();){if(R===8)return;if(w()!==":"){for(o=c=0;c<4&&Ia(W1,w());)o=16*o+WT(w(),16),A++,c++;if(w()==="."){if(c===0||(A-=c,R>6))return;for(d=0;w();){if(u=null,d>0){if(!(w()==="."&&d<4))return;A++}if(!Ia(TA,w()))return;for(;Ia(TA,w());){if(p=WT(w(),10),u===null)u=p;else{if(u===0)return;u=10*u+p}if(u>255)return;A++}T[R]=256*T[R]+u,++d!=2&&d!==4||R++}if(d!==4)return;break}if(w()===":"){if(A++,!w())return}else if(w())return;T[R++]=o}else{if(I!==null)return;A++,I=++R}}if(I!==null)for(m=R-I,R=7;R!==0&&m>0;)g=T[R],T[R--]=T[I+m-1],T[I+--m]=g;else if(R!==8)return;return T})(Am(e,1,-1)),!t))return jp;this.host=t}else if(this.isSpecial()){if(e=ZH(e),Ia(f8,e)||(t=(function(s){var o,c,d,u,p,m,g,T=c8(s,".");if(T.length&&T[T.length-1]===""&&T.length--,(o=T.length)>4)return s;for(c=[],d=0;d<o;d++){if((u=T[d])==="")return s;if(p=10,u.length>1&&Yo(u,0)==="0"&&(p=Ia(u8,u)?16:8,u=Am(u,p===8?1:2)),u==="")m=0;else{if(!Ia(p===10?p8:p===8?h8:W1,u))return s;m=WT(u,p)}Bp(c,m)}for(d=0;d<o;d++)if(m=c[d],d===o-1){if(m>=B1(256,5-o))return null}else if(m>255)return null;for(g=o8(c),d=0;d<c.length;d++)g+=c[d]*B1(256,3-d);return g})(e),t===null))return jp;this.host=t}else{if(Ia(_8,e))return jp;for(t="",n=Fp(e),i=0;i<n.length;i++)t+=Kl(n[i],KT);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return _A(zT,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme==="file"&&t===1&&Om(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,n=e.username,i=e.password,s=e.host,o=e.port,c=e.path,d=e.query,u=e.fragment,p=t+":";return s!==null?(p+="//",e.includesCredentials()&&(p+=n+(i?":"+i:"")+"@"),p+=wm(s),o!==null&&(p+=":"+o)):t==="file"&&(p+="//"),p+=e.cannotBeABaseURL?c[0]:c.length?"/"+Im(c,"/"):"",d!==null&&(p+="?"+d),u!==null&&(p+="#"+u),p},setHref:function(e){var t=this.parse(e);if(t)throw new EA(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e==="blob")try{return new Wp(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+wm(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Mc(e)+":",yA)},getUsername:function(){return this.username},setUsername:function(e){var t=Fp(Mc(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<t.length;n++)this.username+=Kl(t[n],vA)}},getPassword:function(){return this.password},setPassword:function(e){var t=Fp(Mc(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<t.length;n++)this.password+=Kl(t[n],vA)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?wm(e):wm(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,bA)},getHostname:function(){var e=this.host;return e===null?"":wm(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,IA)},getPort:function(){var e=this.port;return e===null?"":Mc(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Mc(e))===""?this.port=null:this.parse(e,AA))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+Im(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Gp))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Mc(e))===""?this.query=null:(Yo(e,0)==="?"&&(e=Am(e,1)),this.query="",this.parse(e,lu)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Mc(e))!==""?(Yo(e,0)==="#"&&(e=Am(e,1)),this.fragment="",this.parse(e,Uc)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Wp=function(e){var t=JH(this,Cs),n=e8(arguments.length,1)>1?arguments[1]:void 0,i=t8(t,new NA(e,!1,n));pA||(t.href=i.serialize(),t.origin=i.getOrigin(),t.protocol=i.getProtocol(),t.username=i.getUsername(),t.password=i.getPassword(),t.host=i.getHost(),t.hostname=i.getHostname(),t.port=i.getPort(),t.pathname=i.getPathname(),t.search=i.getSearch(),t.searchParams=i.getSearchParams(),t.hash=i.getHash())},Cs=Wp.prototype,qo=function(e,t){return{get:function(){return GT(this)[e]()},set:t&&function(n){return GT(this)[t](n)},configurable:!0,enumerable:!0}};if(pA&&(zo(Cs,"href",qo("serialize","setHref")),zo(Cs,"origin",qo("getOrigin")),zo(Cs,"protocol",qo("getProtocol","setProtocol")),zo(Cs,"username",qo("getUsername","setUsername")),zo(Cs,"password",qo("getPassword","setPassword")),zo(Cs,"host",qo("getHost","setHost")),zo(Cs,"hostname",qo("getHostname","setHostname")),zo(Cs,"port",qo("getPort","setPort")),zo(Cs,"pathname",qo("getPathname","setPathname")),zo(Cs,"search",qo("getSearch","setSearch")),zo(Cs,"searchParams",qo("getSearchParams")),zo(Cs,"hash",qo("getHash","setHash"))),jT(Cs,"toJSON",(function(){return GT(this).serialize()}),{enumerable:!0}),jT(Cs,"toString",(function(){return GT(this).serialize()}),{enumerable:!0}),bm){var eM=bm.createObjectURL,tM=bm.revokeObjectURL;eM&&jT(Wp,"createObjectURL",x1(eM,bm)),tM&&jT(Wp,"revokeObjectURL",x1(tM,bm))}$H(Wp,"URL"),qH({global:!0,forced:!XH,sham:!pA},{URL:Wp});var T8=Ut,nM=y,v8=da,iM=Fr,y8=MT,DA=Rn("URL"),R8=y8&&nM((function(){DA.canParse()})),C8=nM((function(){return DA.canParse.length!==1}));T8({target:"URL",stat:!0,forced:!R8||C8},{canParse:function(e){var t=v8(arguments.length,1),n=iM(e),i=t<2||arguments[1]===void 0?void 0:iM(arguments[1]);try{return!!new DA(n,i)}catch{return!1}}});var b8=Ut,I8=da,rM=Fr,A8=MT,w8=Rn("URL");b8({target:"URL",stat:!0,forced:!A8},{parse:function(e){var t=I8(arguments.length,1),n=rM(e),i=t<2||arguments[1]===void 0?void 0:rM(arguments[1]);try{return new w8(n,i)}catch{return null}}});var XT=S(xn.URL);let sM=!0,oM=!0;function JT(e,t,n){const i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}function du(e,t,n){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,s=i.addEventListener;i.addEventListener=function(c,d){if(c!==t)return s.apply(this,arguments);const u=p=>{const m=n(p);m&&(d.handleEvent?d.handleEvent(m):d(m))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(d,u),s.apply(this,[c,u])};const o=i.removeEventListener;i.removeEventListener=function(c,d){if(c!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(d))return o.apply(this,arguments);const u=this._eventMap[t].get(d);return this._eventMap[t].delete(d),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[c,u])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(c){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),c&&this.addEventListener(t,this["_on"+t]=c)},enumerable:!0,configurable:!0})}function O8(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(sM=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function N8(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(oM=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function aM(){if(typeof window=="object"){if(sM)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function PA(e,t){oM&&console.warn(e+" is deprecated, please use "+t+" instead.")}function cM(e){return Object.prototype.toString.call(e)==="[object Object]"}function lM(e){var t;return cM(e)?Ks(t=Object.keys(e)).call(t,(function(n,i){const s=cM(e[i]),o=s?lM(e[i]):e[i],c=s&&!Object.keys(o).length;return o===void 0||c?n:Object.assign(n,{[i]:o})}),{}):e}function kA(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((i=>{i.endsWith("Id")?kA(e,e.get(t[i]),n):i.endsWith("Ids")&&t[i].forEach((s=>{kA(e,e.get(s),n)}))})))}function dM(e,t,n){const i=n?"outbound-rtp":"inbound-rtp",s=new Map;if(t===null)return s;const o=[];return e.forEach((c=>{c.type==="track"&&c.trackIdentifier===t.id&&o.push(c)})),o.forEach((c=>{e.forEach((d=>{d.type===i&&d.trackId===c.id&&kA(e,d,s)}))})),s}const uM=aM;function hM(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const i=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;const d={};return Object.keys(c).forEach((u=>{if(u==="require"||u==="advanced"||u==="mediaSource")return;const p=typeof c[u]=="object"?c[u]:{ideal:c[u]};p.exact!==void 0&&typeof p.exact=="number"&&(p.min=p.max=p.exact);const m=function(g,T){return g?g+T.charAt(0).toUpperCase()+T.slice(1):T==="deviceId"?"sourceId":T};if(p.ideal!==void 0){d.optional=d.optional||[];let g={};typeof p.ideal=="number"?(g[m("min",u)]=p.ideal,d.optional.push(g),g={},g[m("max",u)]=p.ideal,d.optional.push(g)):(g[m("",u)]=p.ideal,d.optional.push(g))}p.exact!==void 0&&typeof p.exact!="number"?(d.mandatory=d.mandatory||{},d.mandatory[m("",u)]=p.exact):["min","max"].forEach((g=>{p[g]!==void 0&&(d.mandatory=d.mandatory||{},d.mandatory[m(g,u)]=p[g])}))})),c.advanced&&(d.optional=(d.optional||[]).concat(c.advanced)),d},s=function(c,d){if(t.version>=61)return d(c);if((c=JSON.parse(JSON.stringify(c)))&&typeof c.audio=="object"){const u=function(p,m,g){m in p&&!(g in p)&&(p[g]=p[m],delete p[m])};u((c=JSON.parse(JSON.stringify(c))).audio,"autoGainControl","googAutoGainControl"),u(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=i(c.audio)}if(c&&typeof c.video=="object"){let u=c.video.facingMode;u=u&&(typeof u=="object"?u:{ideal:u});const p=t.version<66;if(u&&(u.exact==="user"||u.exact==="environment"||u.ideal==="user"||u.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||p)){let m;if(delete c.video.facingMode,u.exact==="environment"||u.ideal==="environment"?m=["back","rear"]:u.exact!=="user"&&u.ideal!=="user"||(m=["front"]),m)return n.mediaDevices.enumerateDevices().then((g=>{g=g.filter((R=>R.kind==="videoinput"));let T=g.find((R=>m.some((I=>{var A;return Re(A=R.label.toLowerCase()).call(A,I)}))));return!T&&g.length&&Re(m).call(m,"back")&&(T=g[g.length-1]),T&&(c.video.deviceId=u.exact?{exact:T.deviceId}:{ideal:T.deviceId}),c.video=i(c.video),uM("chrome: "+JSON.stringify(c)),d(c)}))}c.video=i(c.video)}return uM("chrome: "+JSON.stringify(c)),d(c)},o=function(c){return t.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(c,d,u){s(c,(p=>{n.webkitGetUserMedia(p,d,(m=>{u&&u(o(m))}))}))}).bind(n),n.mediaDevices.getUserMedia){const c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(d){return s(d,(u=>c(u).then((p=>{if(u.audio&&!p.getAudioTracks().length||u.video&&!p.getVideoTracks().length)throw p.getTracks().forEach((m=>{m.stop()})),new DOMException("","NotFoundError");return p}),(p=>De.reject(o(p))))))}}}function pM(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function fM(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",(i=>{let s;s=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((c=>c.track&&c.track.id===i.track.id)):{track:i.track};const o=new Event("track");o.track=i.track,o.receiver=s,o.transceiver={receiver:s},o.streams=[n.stream],this.dispatchEvent(o)})),n.stream.getTracks().forEach((i=>{let s;s=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((c=>c.track&&c.track.id===i.id)):{track:i};const o=new Event("track");o.track=i,o.receiver=s,o.transceiver={receiver:s},o.streams=[n.stream],this.dispatchEvent(o)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else du(e,"track",(t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t)))}function _M(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(s,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=s.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:s}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(c,d){let u=s.apply(this,arguments);return u||(u=t(this,c),this._senders.push(u)),u};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(c){o.apply(this,arguments);const d=this._senders.indexOf(c);d!==-1&&this._senders.splice(d,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(s){this._senders=this._senders||[],n.apply(this,[s]),s.getTracks().forEach((o=>{this._senders.push(t(this,o))}))};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(s){this._senders=this._senders||[],i.apply(this,[s]),s.getTracks().forEach((o=>{const c=this._senders.find((d=>d.track===o));c&&this._senders.splice(this._senders.indexOf(c),1)}))}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach((i=>i._pc=this)),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function mM(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,i,s]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const o=function(d){const u={};return d.result().forEach((p=>{const m={id:p.id,timestamp:p.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[p.type]||p.type};p.names().forEach((g=>{m[g]=p.stat(g)})),u[m.id]=m})),u},c=function(d){return new Map(Object.keys(d).map((u=>[u,d[u]])))};if(arguments.length>=2){const d=function(u){i(c(o(u)))};return t.apply(this,[d,n])}return new De(((d,u)=>{t.apply(this,[function(p){d(c(o(p)))},u])})).then(i,s)}}function EM(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const s=n.apply(this,[]);return s.forEach((o=>o._pc=this)),s});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const s=i.apply(this,arguments);return s._pc=this,s}),e.RTCRtpSender.prototype.getStats=function(){const s=this;return this._pc.getStats().then((o=>dM(o,s.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=n.apply(this,[]);return i.forEach((s=>s._pc=this)),i}),du(e,"track",(i=>(i.receiver._pc=i.srcElement,i))),e.RTCRtpReceiver.prototype.getStats=function(){const i=this;return this._pc.getStats().then((s=>dM(s,i.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let i,s,o;return this.getSenders().forEach((c=>{c.track===n&&(i?o=!0:i=c)})),this.getReceivers().forEach((c=>(c.track===n&&(s?o=!0:s=c),c.track===n))),o||i&&s?De.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():s?s.getStats():De.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function gM(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((o=>this._shimmedLocalStreams[o][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,c){if(!c)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const d=t.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(d)===-1&&this._shimmedLocalStreams[c.id].push(d):this._shimmedLocalStreams[c.id]=[c,d],d};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach((u=>{if(this.getSenders().find((m=>m.track===u)))throw new DOMException("Track already exists.","InvalidAccessError")}));const c=this.getSenders();n.apply(this,arguments);const d=this.getSenders().filter((u=>c.indexOf(u)===-1));this._shimmedLocalStreams[o.id]=[o].concat(d)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach((c=>{const d=this._shimmedLocalStreams[c].indexOf(o);d!==-1&&this._shimmedLocalStreams[c].splice(d,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]})),s.apply(this,arguments)}}function SM(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return gM(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const u=n.apply(this);return this._reverseStreams=this._reverseStreams||{},u.map((p=>this._reverseStreams[p.id]))};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},u.getTracks().forEach((p=>{if(this.getSenders().find((g=>g.track===p)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[u.id]){const p=new e.MediaStream(u.getTracks());this._streams[u.id]=p,this._reverseStreams[p.id]=u,u=p}i.apply(this,[u])};const s=e.RTCPeerConnection.prototype.removeStream;function o(u,p){let m=p.sdp;return Object.keys(u._reverseStreams||[]).forEach((g=>{const T=u._reverseStreams[g],R=u._streams[T.id];m=m.replace(new RegExp(R.id,"g"),T.id)})),new RTCSessionDescription({type:p.type,sdp:m})}e.RTCPeerConnection.prototype.removeStream=function(u){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[u.id]||u]),delete this._reverseStreams[this._streams[u.id]?this._streams[u.id].id:u.id],delete this._streams[u.id]},e.RTCPeerConnection.prototype.addTrack=function(u,p){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const m=[].slice.call(arguments,1);if(m.length!==1||!m[0].getTracks().find((R=>R===u)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((R=>R.track===u)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const T=this._streams[p.id];if(T)T.addTrack(u),De.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const R=new e.MediaStream([u]);this._streams[p.id]=R,this._reverseStreams[R.id]=p,this.addStream(R)}return this.getSenders().find((R=>R.track===u))},["createOffer","createAnswer"].forEach((function(u){const p=e.RTCPeerConnection.prototype[u],m={[u](){const g=arguments;return arguments.length&&typeof arguments[0]=="function"?p.apply(this,[T=>{const R=o(this,T);g[0].apply(null,[R])},T=>{g[1]&&g[1].apply(null,T)},arguments[2]]):p.apply(this,arguments).then((T=>o(this,T)))}};e.RTCPeerConnection.prototype[u]=m[u]}));const c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(function(u,p){let m=p.sdp;return Object.keys(u._reverseStreams||[]).forEach((g=>{const T=u._reverseStreams[g],R=u._streams[T.id];m=m.replace(new RegExp(T.id,"g"),R.id)})),new RTCSessionDescription({type:p.type,sdp:m})})(this,arguments[0]),c.apply(this,arguments)):c.apply(this,arguments)};const d=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const u=d.get.apply(this);return u.type===""?u:o(this,u)}}),e.RTCPeerConnection.prototype.removeTrack=function(u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!u._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(u._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let p;this._streams=this._streams||{},Object.keys(this._streams).forEach((m=>{this._streams[m].getTracks().find((g=>u.track===g))&&(p=this._streams[m])})),p&&(p.getTracks().length===1?this.removeStream(this._reverseStreams[p.id]):p.removeTrack(u.track),this.dispatchEvent(new Event("negotiationneeded")))}}function LA(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(n){const i=e.RTCPeerConnection.prototype[n],s={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=s[n]}))}function TM(e,t){du(e,"negotiationneeded",(n=>{const i=n.target;if(!(t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")||i.signalingState==="stable")return n}))}var vM=Object.freeze({__proto__:null,fixNegotiationNeeded:TM,shimAddTrackRemoveTrack:SM,shimAddTrackRemoveTrackWithNative:gM,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((i=>{const s=n.video&&n.video.width,o=n.video&&n.video.height,c=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:i,maxFrameRate:c||3}},s&&(n.video.mandatory.maxWidth=s),o&&(n.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:_M,shimGetStats:mM,shimGetUserMedia:hM,shimMediaStream:pM,shimOnTrack:fM,shimPeerConnection:LA,shimSenderReceiverGetStats:EM});function yM(e,t){const n=e&&e.navigator,i=e&&e.MediaStreamTrack;if(n.getUserMedia=function(s,o,c){PA("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(s).then(o,c)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const s=function(c,d,u){d in c&&!(u in c)&&(c[u]=c[d],delete c[d])},o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(c){return typeof c=="object"&&typeof c.audio=="object"&&(c=JSON.parse(JSON.stringify(c)),s(c.audio,"autoGainControl","mozAutoGainControl"),s(c.audio,"noiseSuppression","mozNoiseSuppression")),o(c)},i&&i.prototype.getSettings){const c=i.prototype.getSettings;i.prototype.getSettings=function(){const d=c.apply(this,arguments);return s(d,"mozAutoGainControl","autoGainControl"),s(d,"mozNoiseSuppression","noiseSuppression"),d}}if(i&&i.prototype.applyConstraints){const c=i.prototype.applyConstraints;i.prototype.applyConstraints=function(d){return this.kind==="audio"&&typeof d=="object"&&(d=JSON.parse(JSON.stringify(d)),s(d,"autoGainControl","mozAutoGainControl"),s(d,"noiseSuppression","mozNoiseSuppression")),c.apply(this,[d])}}}}function RM(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function MA(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(s){const o=e.RTCPeerConnection.prototype[s],c={[s](){return arguments[0]=new(s==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[s]=c[s]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[s,o,c]=arguments;return i.apply(this,[s||null]).then((d=>{if(t.version<53&&!o)try{d.forEach((u=>{u.type=n[u.type]||u.type}))}catch(u){if(u.name!=="TypeError")throw u;d.forEach(((p,m)=>{d.set(m,Object.assign({},p,{type:n[p.type]||p.type}))}))}return d})).then(o,c)}}function CM(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach((s=>s._pc=this)),i});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const i=n.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):De.resolve(new Map)}}function bM(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach((i=>i._pc=this)),n}),du(e,"track",(n=>(n.receiver._pc=n.srcElement,n))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function IM(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){PA("removeStream","removeTrack"),this.getSenders().forEach((n=>{var i;n.track&&Re(i=t.getTracks()).call(i,n.track)&&this.removeTrack(n)}))})}function AM(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function wM(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const i=n.length>0;i&&n.forEach((o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const s=t.apply(this,arguments);if(i){const{sender:o}=s,c=o.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=n,o.sendEncodings=n,this.setParametersPromises.push(o.setParameters(c).then((()=>{delete o.sendEncodings})).catch((()=>{delete o.sendEncodings}))))}return s})}function OM(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function NM(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?De.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function DM(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?De.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var PM=Object.freeze({__proto__:null,shimAddTransceiver:wM,shimCreateAnswer:DM,shimCreateOffer:NM,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const i=new DOMException("getDisplayMedia without video constraints is undefined");return i.name="NotFoundError",i.code=8,De.reject(i)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:OM,shimGetUserMedia:yM,shimOnTrack:RM,shimPeerConnection:MA,shimRTCDataChannel:AM,shimReceiverGetStats:bM,shimRemoveStream:IM,shimSenderGetStats:CM});function kM(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){var i;this._localStreams||(this._localStreams=[]),Re(i=this._localStreams).call(i,n)||this._localStreams.push(n),n.getAudioTracks().forEach((s=>t.call(this,s,n))),n.getVideoTracks().forEach((s=>t.call(this,s,n)))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return s&&s.forEach((c=>{var d;this._localStreams?Re(d=this._localStreams).call(d,c)||this._localStreams.push(c):this._localStreams=[c]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const i=t.getTracks();this.getSenders().forEach((s=>{Re(i).call(i,s.track)&&this.removeTrack(s)}))})}}function LM(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach((s=>{var o;if(this._remoteStreams||(this._remoteStreams=[]),Re(o=this._remoteStreams).call(o,s))return;this._remoteStreams.push(s);const c=new Event("addstream");c.stream=s,this.dispatchEvent(c)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(i){i.streams.forEach((s=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(s)>=0)return;n._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,n.dispatchEvent(o)}))}),t.apply(n,arguments)}}}function MM(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,s=t.setLocalDescription,o=t.setRemoteDescription,c=t.addIceCandidate;t.createOffer=function(u,p){const m=arguments.length>=2?arguments[2]:arguments[0],g=n.apply(this,[m]);return p?(g.then(u,p),De.resolve()):g},t.createAnswer=function(u,p){const m=arguments.length>=2?arguments[2]:arguments[0],g=i.apply(this,[m]);return p?(g.then(u,p),De.resolve()):g};let d=function(u,p,m){const g=s.apply(this,[u]);return m?(g.then(p,m),De.resolve()):g};t.setLocalDescription=d,d=function(u,p,m){const g=o.apply(this,[u]);return m?(g.then(p,m),De.resolve()):g},t.setRemoteDescription=d,d=function(u,p,m){const g=c.apply(this,[u]);return m?(g.then(p,m),De.resolve()):g},t.addIceCandidate=d}function UM(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,i=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=s=>i(xM(s))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,i,s){t.mediaDevices.getUserMedia(n).then(i,s)}).bind(t))}function xM(e){return e&&e.video!==void 0?Object.assign({},e,{video:lM(e.video)}):e}function VM(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,i){if(n&&n.iceServers){const s=[];for(let o=0;o<n.iceServers.length;o++){let c=n.iceServers[o];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(PA("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,s.push(c)):s.push(n.iceServers[o])}n.iceServers=s}return new t(n,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function FM(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function BM(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const i=this.getTransceivers().find((o=>o.receiver.track.kind==="audio"));n.offerToReceiveAudio===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveAudio!==!0||i||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const s=this.getTransceivers().find((o=>o.receiver.track.kind==="video"));n.offerToReceiveVideo===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):n.offerToReceiveVideo!==!0||s||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function jM(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var GM=Object.freeze({__proto__:null,shimAudioContext:jM,shimCallbacksAPI:MM,shimConstraints:xM,shimCreateOfferLegacy:BM,shimGetUserMedia:UM,shimLocalStreamsAPI:kM,shimRTCIceServerUrls:VM,shimRemoteStreamsAPI:LM,shimTrackEventTransceiver:FM}),WM=`	
\v\f\r                　\u2028\u2029\uFEFF`,D8=Kn,P8=Fr,UA=WM,HM=J("".replace),k8=RegExp("^["+UA+"]+"),L8=RegExp("(^|[^"+UA+"])["+UA+"]+$"),M8=function(e){return function(t){var n=P8(D8(t));return 1&e&&(n=HM(n,k8,"")),2&e&&(n=HM(n,L8,"$1")),n}},U8={trim:M8(3)},x8=Yf.PROPER,V8=y,KM=WM,F8=U8.trim;Ut({target:"String",proto:!0,forced:(function(e){return V8((function(){return!!KM[e]()||"​᠎"[e]()!=="​᠎"||x8&&KM[e].name!==e}))})("trim")},{trim:function(){return F8(this)}});var B8=to("String","trim"),j8=ee,G8=B8,xA=String.prototype,W8=function(e){var t=e.trim;return typeof e=="string"||e===xA||j8(xA,e)&&t===xA.trim?G8:t},dr=S(W8),zM={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return n.trim().split(`
`).map((i=>i.trim()))},t.splitSections=function(n){return n.split(`
m=`).map(((i,s)=>(s>0?"m="+i:i).trim()+`\r
`))},t.getDescription=function(n){const i=t.splitSections(n);return i&&i[0]},t.getMediaSections=function(n){const i=t.splitSections(n);return i.shift(),i},t.matchPrefix=function(n,i){return t.splitLines(n).filter((s=>s.indexOf(i)===0))},t.parseCandidate=function(n){let i;i=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const s={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let o=8;o<i.length;o+=2)switch(i[o]){case"raddr":s.relatedAddress=i[o+1];break;case"rport":s.relatedPort=parseInt(i[o+1],10);break;case"tcptype":s.tcpType=i[o+1];break;case"ufrag":s.ufrag=i[o+1],s.usernameFragment=i[o+1];break;default:s[i[o]]===void 0&&(s[i[o]]=i[o+1])}return s},t.writeCandidate=function(n){const i=[];i.push(n.foundation);const s=n.component;s==="rtp"?i.push(1):s==="rtcp"?i.push(2):i.push(s),i.push(n.protocol.toUpperCase()),i.push(n.priority),i.push(n.address||n.ip),i.push(n.port);const o=n.type;return i.push("typ"),i.push(o),o!=="host"&&n.relatedAddress&&n.relatedPort&&(i.push("raddr"),i.push(n.relatedAddress),i.push("rport"),i.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(i.push("ufrag"),i.push(n.usernameFragment||n.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(n){return n.substring(14).split(" ")},t.parseRtpMap=function(n){let i=n.substring(9).split(" ");const s={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),s.name=i[0],s.clockRate=parseInt(i[1],10),s.channels=i.length===3?parseInt(i[2],10):1,s.numChannels=s.channels,s},t.writeRtpMap=function(n){let i=n.payloadType;n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType);const s=n.channels||n.numChannels||1;return"a=rtpmap:"+i+" "+n.name+"/"+n.clockRate+(s!==1?"/"+s:"")+`\r
`},t.parseExtmap=function(n){const i=n.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},t.parseFmtp=function(n){const i={};let s;const o=n.substring(n.indexOf(" ")+1).split(";");for(let c=0;c<o.length;c++)s=o[c].trim().split("="),i[s[0].trim()]=s[1];return i},t.writeFmtp=function(n){let i="",s=n.payloadType;if(n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const o=[];Object.keys(n.parameters).forEach((c=>{n.parameters[c]!==void 0?o.push(c+"="+n.parameters[c]):o.push(c)})),i+="a=fmtp:"+s+" "+o.join(";")+`\r
`}return i},t.parseRtcpFb=function(n){const i=n.substring(n.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(n){let i="",s=n.payloadType;return n.preferredPayloadType!==void 0&&(s=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach((o=>{i+="a=rtcp-fb:"+s+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`})),i},t.parseSsrcMedia=function(n){const i=n.indexOf(" "),s={ssrc:parseInt(n.substring(7,i),10)},o=n.indexOf(":",i);return o>-1?(s.attribute=n.substring(i+1,o),s.value=n.substring(o+1)):s.attribute=n.substring(i+1),s},t.parseSsrcGroup=function(n){const i=n.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map((s=>parseInt(s,10)))}},t.getMid=function(n){const i=t.matchPrefix(n,"a=mid:")[0];if(i)return i.substring(6)},t.parseFingerprint=function(n){const i=n.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(n,i){return{role:"auto",fingerprints:t.matchPrefix(n+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,i){let s="a=setup:"+i+`\r
`;return n.fingerprints.forEach((o=>{s+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`})),s},t.parseCryptoLine=function(n){const i=n.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const i=n.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,i){return t.matchPrefix(n+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,i){const s=t.matchPrefix(n+i,"a=ice-ufrag:")[0],o=t.matchPrefix(n+i,"a=ice-pwd:")[0];return s&&o?{usernameFragment:s.substring(12),password:o.substring(10)}:null},t.writeIceParameters=function(n){let i="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(i+=`a=ice-lite\r
`),i},t.parseRtpParameters=function(n){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=t.splitLines(n)[0].split(" ");i.profile=s[2];for(let c=3;c<s.length;c++){const d=s[c],u=t.matchPrefix(n,"a=rtpmap:"+d+" ")[0];if(u){const p=t.parseRtpMap(u),m=t.matchPrefix(n,"a=fmtp:"+d+" ");switch(p.parameters=m.length?t.parseFmtp(m[0]):{},p.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+d+" ").map(t.parseRtcpFb),i.codecs.push(p),p.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(p.name.toUpperCase())}}}t.matchPrefix(n,"a=extmap:").forEach((c=>{i.headerExtensions.push(t.parseExtmap(c))}));const o=t.matchPrefix(n,"a=rtcp-fb:* ").map(t.parseRtcpFb);return i.codecs.forEach((c=>{o.forEach((d=>{c.rtcpFeedback.find((u=>u.type===d.type&&u.parameter===d.parameter))||c.rtcpFeedback.push(d)}))})),i},t.writeRtpDescription=function(n,i){let s="";s+="m="+n+" ",s+=i.codecs.length>0?"9":"0",s+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",s+=i.codecs.map((c=>c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType)).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach((c=>{s+=t.writeRtpMap(c),s+=t.writeFmtp(c),s+=t.writeRtcpFb(c)}));let o=0;return i.codecs.forEach((c=>{c.maxptime>o&&(o=c.maxptime)})),o>0&&(s+="a=maxptime:"+o+`\r
`),i.headerExtensions&&i.headerExtensions.forEach((c=>{s+=t.writeExtmap(c)})),s},t.parseRtpEncodingParameters=function(n){const i=[],s=t.parseRtpParameters(n),o=s.fecMechanisms.indexOf("RED")!==-1,c=s.fecMechanisms.indexOf("ULPFEC")!==-1,d=t.matchPrefix(n,"a=ssrc:").map((T=>t.parseSsrcMedia(T))).filter((T=>T.attribute==="cname")),u=d.length>0&&d[0].ssrc;let p;const m=t.matchPrefix(n,"a=ssrc-group:FID").map((T=>T.substring(17).split(" ").map((R=>parseInt(R,10)))));m.length>0&&m[0].length>1&&m[0][0]===u&&(p=m[0][1]),s.codecs.forEach((T=>{if(T.name.toUpperCase()==="RTX"&&T.parameters.apt){let R={ssrc:u,codecPayloadType:parseInt(T.parameters.apt,10)};u&&p&&(R.rtx={ssrc:p}),i.push(R),o&&(R=JSON.parse(JSON.stringify(R)),R.fec={ssrc:u,mechanism:c?"red+ulpfec":"red"},i.push(R))}})),i.length===0&&u&&i.push({ssrc:u});let g=t.matchPrefix(n,"b=");return g.length&&(g=g[0].indexOf("b=TIAS:")===0?parseInt(g[0].substring(7),10):g[0].indexOf("b=AS:")===0?1e3*parseInt(g[0].substring(5),10)*.95-16e3:void 0,i.forEach((T=>{T.maxBitrate=g}))),i},t.parseRtcpParameters=function(n){const i={},s=t.matchPrefix(n,"a=ssrc:").map((d=>t.parseSsrcMedia(d))).filter((d=>d.attribute==="cname"))[0];s&&(i.cname=s.value,i.ssrc=s.ssrc);const o=t.matchPrefix(n,"a=rtcp-rsize");i.reducedSize=o.length>0,i.compound=o.length===0;const c=t.matchPrefix(n,"a=rtcp-mux");return i.mux=c.length>0,i},t.writeRtcpParameters=function(n){let i="";return n.reducedSize&&(i+=`a=rtcp-rsize\r
`),n.mux&&(i+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(i+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),i},t.parseMsid=function(n){let i;const s=t.matchPrefix(n,"a=msid:");if(s.length===1)return i=s[0].substring(7).split(" "),{stream:i[0],track:i[1]};const o=t.matchPrefix(n,"a=ssrc:").map((c=>t.parseSsrcMedia(c))).filter((c=>c.attribute==="msid"));return o.length>0?(i=o[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},t.parseSctpDescription=function(n){const i=t.parseMLine(n),s=t.matchPrefix(n,"a=max-message-size:");let o;s.length>0&&(o=parseInt(s[0].substring(19),10)),isNaN(o)&&(o=65536);const c=t.matchPrefix(n,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substring(12),10),protocol:i.fmt,maxMessageSize:o};const d=t.matchPrefix(n,"a=sctpmap:");if(d.length>0){const u=d[0].substring(10).split(" ");return{port:parseInt(u[0],10),protocol:u[1],maxMessageSize:o}}},t.writeSctpDescription=function(n,i){let s=[];return s=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&s.push("a=max-message-size:"+i.maxMessageSize+`\r
`),s.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(n,i,s){let o;const c=i!==void 0?i:2;return o=n||t.generateSessionId(),`v=0\r
o=`+(s||"thisisadapterortc")+" "+o+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,i){const s=t.splitLines(n);for(let o=0;o<s.length;o++)switch(s[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[o].substring(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substring(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const i=t.splitLines(n)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(n){const i=t.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const i=t.splitLines(n);for(let s=0;s<i.length;s++)if(i[s].length<2||i[s].charAt(1)!=="=")return!1;return!0},e.exports=t})(zM);var YM=zM.exports,Hp=S(YM),H8=h({__proto__:null,default:Hp},[YM]);function QT(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const i=new t(n),s=Hp.parseCandidate(n.candidate),o=Object.assign(i,s);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,du(e,"icecandidate",(n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n)))}function VA(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||du(e,"icecandidate",(t=>{if(t.candidate){const n=Hp.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t}))}function ZT(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(d){if(!d||!d.sdp)return!1;const u=Hp.splitSections(d.sdp);return u.shift(),u.some((p=>{const m=Hp.parseMLine(p);return m&&m.kind==="application"&&m.protocol.indexOf("SCTP")!==-1}))},i=function(d){const u=d.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(u===null||u.length<2)return-1;const p=parseInt(u[1],10);return p!=p?-1:p},s=function(d){let u=65536;return t.browser==="firefox"&&(u=t.version<57?d===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),u},o=function(d,u){let p=65536;t.browser==="firefox"&&t.version===57&&(p=65535);const m=Hp.matchPrefix(d.sdp,"a=max-message-size:");return m.length>0?p=parseInt(m[0].substr(19),10):t.browser==="firefox"&&u!==-1&&(p=2147483637),p},c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:d}=this.getConfiguration();d==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const d=i(arguments[0]),u=s(d),p=o(arguments[0],d);let m;m=u===0&&p===0?Number.POSITIVE_INFINITY:u===0||p===0?Math.max(u,p):Math.min(u,p);const g={};Object.defineProperty(g,"maxMessageSize",{get:()=>m}),this._sctp=g}return c.apply(this,arguments)}}function $T(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(i,s){const o=i.send;i.send=function(){const c=arguments[0],d=c.length||c.size||c.byteLength;if(i.readyState==="open"&&s.sctp&&d>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return o.apply(i,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const i=n.apply(this,arguments);return t(i,this),i},du(e,"datachannel",(i=>(t(i.channel,i.target),i)))}function FA(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((n=>{const i=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const o=s.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const c=new Event("connectionstatechange",s);o.dispatchEvent(c)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}}))}function BA(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(i){if(i&&i.sdp&&i.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const s=i.sdp.split(`
`).filter((o=>dr(o).call(o)!=="a=extmap-allow-mixed")).join(`
`);e.RTCSessionDescription&&i instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:i.type,sdp:s}):i.sdp=s}return n.apply(this,arguments)}}function ev(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?De.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),De.resolve())})}function tv(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let i=arguments[0]||{};if(typeof i!="object"||i.type&&i.sdp)return n.apply(this,arguments);if(i={type:i.type,sdp:i.sdp},!i.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":i.type="offer";break;default:i.type="answer"}return i.sdp||i.type!=="offer"&&i.type!=="answer"?n.apply(this,[i]):(i.type==="offer"?this.createOffer:this.createAnswer).apply(this).then((s=>n.apply(this,[s])))})}var K8=Object.freeze({__proto__:null,removeExtmapAllowMixed:BA,shimAddIceCandidateNullOrEmpty:ev,shimConnectionState:FA,shimMaxMessageSize:ZT,shimParameterlessSetLocalDescription:tv,shimRTCIceCandidate:QT,shimRTCIceCandidateRelayProtocol:VA,shimSendThrowTypeError:$T});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=aM,i=(function(o){const c={browser:null,version:null};if(o===void 0||!o.navigator)return c.browser="Not a browser.",c;const{navigator:d}=o;if(d.mozGetUserMedia)c.browser="firefox",c.version=JT(d.userAgent,/Firefox\/(\d+)\./,1);else if(d.webkitGetUserMedia||o.isSecureContext===!1&&o.webkitRTCPeerConnection)c.browser="chrome",c.version=JT(d.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!o.RTCPeerConnection||!d.userAgent.match(/AppleWebKit\/(\d+)\./))return c.browser="Not a supported browser.",c;c.browser="safari",c.version=JT(d.userAgent,/AppleWebKit\/(\d+)\./,1),c.supportsUnifiedPlan=o.RTCRtpTransceiver&&"currentDirection"in o.RTCRtpTransceiver.prototype}return c})(e),s={browserDetails:i,commonShim:K8,extractVersion:JT,disableLog:O8,disableWarnings:N8,sdp:H8};switch(i.browser){case"chrome":if(!vM||!LA||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),s;if(i.version===null)return n("Chrome shim can not determine version, not shimming."),s;n("adapter.js shimming chrome."),s.browserShim=vM,ev(e,i),tv(e),hM(e,i),pM(e),LA(e,i),fM(e),SM(e,i),_M(e),mM(e),EM(e),TM(e,i),QT(e),VA(e),FA(e),ZT(e,i),$T(e),BA(e,i);break;case"firefox":if(!PM||!MA||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),s;n("adapter.js shimming firefox."),s.browserShim=PM,ev(e,i),tv(e),yM(e,i),MA(e,i),RM(e),IM(e),CM(e),bM(e),AM(e),wM(e),OM(e),NM(e),DM(e),QT(e),FA(e),ZT(e,i),$T(e);break;case"safari":if(!GM||!t.shimSafari)return n("Safari shim is not included in this adapter release."),s;n("adapter.js shimming safari."),s.browserShim=GM,ev(e,i),tv(e),VM(e),BM(e),MM(e),kM(e),LM(e),FM(e),UM(e),jM(e),QT(e),VA(e),ZT(e,i),$T(e),BA(e,i);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var jA=oe;Ut({global:!0,forced:jA.globalThis!==jA},{globalThis:jA});var qM=S(oe),GA={exports:{}};(function(e,t){(function(n,i){var s="function",o="undefined",c="object",d="string",u="major",p="model",m="name",g="type",T="vendor",R="version",I="architecture",A="console",w="mobile",k="tablet",L="smarttv",j="wearable",K="embedded",W="Amazon",Y="Apple",se="ASUS",de="BlackBerry",ge="Browser",je="Chrome",_t="Firefox",ht="Google",Ct="Huawei",Ft="LG",mn="Microsoft",We="Motorola",Se="Opera",we="Samsung",be="Sharp",M="Sony",O="Xiaomi",G="Zebra",ne="Facebook",Be="Chromium OS",Lt="Mac OS",yn=" Browser",tr=function(ii){for(var bn={},di=0;di<ii.length;di++)bn[ii[di].toUpperCase()]=ii[di];return bn},xo=function(ii,bn){return typeof ii===d&&Rl(bn).indexOf(Rl(ii))!==-1},Rl=function(ii){return ii.toLowerCase()},Sf=function(ii,bn){if(typeof ii===d)return ii=ii.replace(/^\s\s*/,""),typeof bn===o?ii:ii.substring(0,500)},xh=function(ii,bn){for(var di,co,Qi,cr,Dn,wn,Xc=0;Xc<bn.length&&!Dn;){var bl=bn[Xc],pS=bn[Xc+1];for(di=co=0;di<bl.length&&!Dn&&bl[di];)if(Dn=bl[di++].exec(ii))for(Qi=0;Qi<pS.length;Qi++)wn=Dn[++co],typeof(cr=pS[Qi])===c&&cr.length>0?cr.length===2?typeof cr[1]==s?this[cr[0]]=cr[1].call(this,wn):this[cr[0]]=cr[1]:cr.length===3?typeof cr[1]!==s||cr[1].exec&&cr[1].test?this[cr[0]]=wn?wn.replace(cr[1],cr[2]):i:this[cr[0]]=wn?cr[1].call(this,wn,cr[2]):i:cr.length===4&&(this[cr[0]]=wn?cr[3].call(this,wn.replace(cr[1],cr[2])):i):this[cr]=wn||i;Xc+=2}},hE=function(ii,bn){for(var di in bn)if(typeof bn[di]===c&&bn[di].length>0){for(var co=0;co<bn[di].length;co++)if(xo(bn[di][co],ii))return di==="?"?i:di}else if(xo(bn[di],ii))return di==="?"?i:di;return bn.hasOwnProperty("*")?bn["*"]:ii},Xv={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Cl={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[R,[m,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[R,[m,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[m,R],[/opios[\/ ]+([\w\.]+)/i],[R,[m,Se+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[R,[m,Se+" GX"]],[/\bopr\/([\w\.]+)/i],[R,[m,Se]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[R,[m,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[R,[m,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[m,R],[/quark(?:pc)?\/([-\w\.]+)/i],[R,[m,"Quark"]],[/\bddg\/([\w\.]+)/i],[R,[m,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[R,[m,"UC"+ge]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[R,[m,"WeChat"]],[/konqueror\/([\w\.]+)/i],[R,[m,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[R,[m,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[R,[m,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[R,[m,"Smart Lenovo "+ge]],[/(avast|avg)\/([\w\.]+)/i],[[m,/(.+)/,"$1 Secure "+ge],R],[/\bfocus\/([\w\.]+)/i],[R,[m,_t+" Focus"]],[/\bopt\/([\w\.]+)/i],[R,[m,Se+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[R,[m,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[R,[m,"Dolphin"]],[/coast\/([\w\.]+)/i],[R,[m,Se+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[R,[m,"MIUI"+yn]],[/fxios\/([\w\.-]+)/i],[R,[m,_t]],[/\bqihoobrowser\/?([\w\.]*)/i],[R,[m,"360"]],[/\b(qq)\/([\w\.]+)/i],[[m,/(.+)/,"$1Browser"],R],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[m,/(.+)/,"$1"+yn],R],[/samsungbrowser\/([\w\.]+)/i],[R,[m,we+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[R,[m,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[m,"Sogou Mobile"],R],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[m,R],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[m],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[R,m],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[m,ne],R],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[m,R],[/\bgsa\/([\w\.]+) .*safari\//i],[R,[m,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[R,[m,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[R,[m,je+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[m,je+" WebView"],R],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[R,[m,"Android "+ge]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[m,R],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[R,[m,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[R,m],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[m,[R,hE,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[m,R],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[m,"Netscape"],R],[/(wolvic|librewolf)\/([\w\.]+)/i],[m,R],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[R,[m,_t+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[m,[R,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[m,[R,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[I,"amd64"]],[/(ia32(?=;))/i],[[I,Rl]],[/((?:i[346]|x)86)[;\)]/i],[[I,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[I,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[I,"armhf"]],[/windows (ce|mobile); ppc;/i],[[I,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[I,/ower/,"",Rl]],[/(sun4\w)[;\)]/i],[[I,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[I,Rl]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[p,[T,we],[g,k]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[p,[T,we],[g,w]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[p,[T,Y],[g,w]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[p,[T,Y],[g,k]],[/(macintosh);/i],[p,[T,Y]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[p,[T,be],[g,w]],[/(?:honor)([-\w ]+)[;\)]/i],[p,[T,"Honor"],[g,w]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[p,[T,Ct],[g,k]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[p,[T,Ct],[g,w]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[p,/_/g," "],[T,O],[g,w]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[p,/_/g," "],[T,O],[g,k]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[p,[T,"OPPO"],[g,w]],[/\b(opd2\d{3}a?) bui/i],[p,[T,"OPPO"],[g,k]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[p,[T,"Vivo"],[g,w]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[p,[T,"Realme"],[g,w]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[p,[T,We],[g,w]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[p,[T,We],[g,k]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[p,[T,Ft],[g,k]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[p,[T,Ft],[g,w]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[p,[T,"Lenovo"],[g,k]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[p,/_/g," "],[T,"Nokia"],[g,w]],[/(pixel c)\b/i],[p,[T,ht],[g,k]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[p,[T,ht],[g,w]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[p,[T,M],[g,w]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[p,"Xperia Tablet"],[T,M],[g,k]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[p,[T,"OnePlus"],[g,w]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[p,[T,W],[g,k]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[p,/(.+)/g,"Fire Phone $1"],[T,W],[g,w]],[/(playbook);[-\w\),; ]+(rim)/i],[p,T,[g,k]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[p,[T,de],[g,w]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[p,[T,se],[g,k]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[p,[T,se],[g,w]],[/(nexus 9)/i],[p,[T,"HTC"],[g,k]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[T,[p,/_/g," "],[g,w]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[p,[T,"TCL"],[g,k]],[/(itel) ((\w+))/i],[[T,Rl],p,[g,hE,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[p,[T,"Acer"],[g,k]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[p,[T,"Meizu"],[g,w]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[p,[T,"Ulefone"],[g,w]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[p,[T,"Energizer"],[g,w]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[p,[T,"Cat"],[g,w]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[p,[T,"Smartfren"],[g,w]],[/droid.+; (a(?:015|06[35]|142p?))/i],[p,[T,"Nothing"],[g,w]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[T,p,[g,w]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[T,p,[g,k]],[/(surface duo)/i],[p,[T,mn],[g,k]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[p,[T,"Fairphone"],[g,w]],[/(u304aa)/i],[p,[T,"AT&T"],[g,w]],[/\bsie-(\w*)/i],[p,[T,"Siemens"],[g,w]],[/\b(rct\w+) b/i],[p,[T,"RCA"],[g,k]],[/\b(venue[\d ]{2,7}) b/i],[p,[T,"Dell"],[g,k]],[/\b(q(?:mv|ta)\w+) b/i],[p,[T,"Verizon"],[g,k]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[p,[T,"Barnes & Noble"],[g,k]],[/\b(tm\d{3}\w+) b/i],[p,[T,"NuVision"],[g,k]],[/\b(k88) b/i],[p,[T,"ZTE"],[g,k]],[/\b(nx\d{3}j) b/i],[p,[T,"ZTE"],[g,w]],[/\b(gen\d{3}) b.+49h/i],[p,[T,"Swiss"],[g,w]],[/\b(zur\d{3}) b/i],[p,[T,"Swiss"],[g,k]],[/\b((zeki)?tb.*\b) b/i],[p,[T,"Zeki"],[g,k]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[T,"Dragon Touch"],p,[g,k]],[/\b(ns-?\w{0,9}) b/i],[p,[T,"Insignia"],[g,k]],[/\b((nxa|next)-?\w{0,9}) b/i],[p,[T,"NextBook"],[g,k]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[T,"Voice"],p,[g,w]],[/\b(lvtel\-)?(v1[12]) b/i],[[T,"LvTel"],p,[g,w]],[/\b(ph-1) /i],[p,[T,"Essential"],[g,w]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[p,[T,"Envizen"],[g,k]],[/\b(trio[-\w\. ]+) b/i],[p,[T,"MachSpeed"],[g,k]],[/\btu_(1491) b/i],[p,[T,"Rotor"],[g,k]],[/(shield[\w ]+) b/i],[p,[T,"Nvidia"],[g,k]],[/(sprint) (\w+)/i],[T,p,[g,w]],[/(kin\.[onetw]{3})/i],[[p,/\./g," "],[T,mn],[g,w]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[p,[T,G],[g,k]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[p,[T,G],[g,w]],[/smart-tv.+(samsung)/i],[T,[g,L]],[/hbbtv.+maple;(\d+)/i],[[p,/^/,"SmartTV"],[T,we],[g,L]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[T,Ft],[g,L]],[/(apple) ?tv/i],[T,[p,Y+" TV"],[g,L]],[/crkey/i],[[p,je+"cast"],[T,ht],[g,L]],[/droid.+aft(\w+)( bui|\))/i],[p,[T,W],[g,L]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[p,[T,be],[g,L]],[/(bravia[\w ]+)( bui|\))/i],[p,[T,M],[g,L]],[/(mitv-\w{5}) bui/i],[p,[T,O],[g,L]],[/Hbbtv.*(technisat) (.*);/i],[T,p,[g,L]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[T,Sf],[p,Sf],[g,L]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[g,L]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[T,p,[g,A]],[/droid.+; (shield) bui/i],[p,[T,"Nvidia"],[g,A]],[/(playstation [345portablevi]+)/i],[p,[T,M],[g,A]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[p,[T,mn],[g,A]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[p,[T,we],[g,j]],[/((pebble))app/i],[T,p,[g,j]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[p,[T,Y],[g,j]],[/droid.+; (glass) \d/i],[p,[T,ht],[g,j]],[/droid.+; (wt63?0{2,3})\)/i],[p,[T,G],[g,j]],[/droid.+; (glass) \d/i],[p,[T,ht],[g,j]],[/(pico) (4|neo3(?: link|pro)?)/i],[T,p,[g,j]],[/; (quest( \d| pro)?)/i],[p,[T,ne],[g,j]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[T,[g,K]],[/(aeobc)\b/i],[p,[T,W],[g,K]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[p,[g,w]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[p,[g,k]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[g,k]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[g,w]],[/(android[-\w\. ]{0,9});.+buil/i],[p,[T,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[R,[m,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[m,R],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[R,[m,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[m,R],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[R,m]],os:[[/microsoft (windows) (vista|xp)/i],[m,R],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[m,[R,hE,Xv]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[R,hE,Xv],[m,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[R,/_/g,"."],[m,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[m,Lt],[R,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[R,m],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[m,R],[/\(bb(10);/i],[R,[m,de]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[R,[m,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[R,[m,_t+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[R,[m,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[R,[m,"watchOS"]],[/crkey\/([\d\.]+)/i],[R,[m,je+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[m,Be],R],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[m,R],[/(sunos) ?([\w\.\d]*)/i],[[m,"Solaris"],R],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[m,R]]},Da=function(ii,bn){if(typeof ii===c&&(bn=ii,ii=i),!(this instanceof Da))return new Da(ii,bn).getResult();var di=typeof n!==o&&n.navigator?n.navigator:i,co=ii||(di&&di.userAgent?di.userAgent:""),Qi=di&&di.userAgentData?di.userAgentData:i,cr=bn?(function(wn,Xc){var bl={};for(var pS in wn)Xc[pS]&&Xc[pS].length%2==0?bl[pS]=Xc[pS].concat(wn[pS]):bl[pS]=wn[pS];return bl})(Cl,bn):Cl,Dn=di&&di.userAgent==co;return this.getBrowser=function(){var wn={};return wn[m]=i,wn[R]=i,xh.call(wn,co,cr.browser),wn[u]=(function(Xc){return typeof Xc===d?Xc.replace(/[^\d\.]/g,"").split(".")[0]:i})(wn[R]),Dn&&di&&di.brave&&typeof di.brave.isBrave==s&&(wn[m]="Brave"),wn},this.getCPU=function(){var wn={};return wn[I]=i,xh.call(wn,co,cr.cpu),wn},this.getDevice=function(){var wn={};return wn[T]=i,wn[p]=i,wn[g]=i,xh.call(wn,co,cr.device),Dn&&!wn[g]&&Qi&&Qi.mobile&&(wn[g]=w),Dn&&wn[p]=="Macintosh"&&di&&typeof di.standalone!==o&&di.maxTouchPoints&&di.maxTouchPoints>2&&(wn[p]="iPad",wn[g]=k),wn},this.getEngine=function(){var wn={};return wn[m]=i,wn[R]=i,xh.call(wn,co,cr.engine),wn},this.getOS=function(){var wn={};return wn[m]=i,wn[R]=i,xh.call(wn,co,cr.os),Dn&&!wn[m]&&Qi&&Qi.platform&&Qi.platform!="Unknown"&&(wn[m]=Qi.platform.replace(/chrome os/i,Be).replace(/macos/i,Lt)),wn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return co},this.setUA=function(wn){return co=typeof wn===d&&wn.length>500?Sf(wn,500):wn,this},this.setUA(co),this};Da.VERSION="0.7.40",Da.BROWSER=tr([m,R,u]),Da.CPU=tr([I]),Da.DEVICE=tr([p,T,g,A,w,L,k,j,K]),Da.ENGINE=Da.OS=tr([m,R]),e.exports&&(t=e.exports=Da),t.UAParser=Da;var Vh=typeof n!==o&&(n.jQuery||n.Zepto);if(Vh&&!Vh.ua){var us=new Da;Vh.ua=us.getResult(),Vh.ua.get=function(){return us.getUA()},Vh.ua.set=function(ii){us.setUA(ii);var bn=us.getResult();for(var di in bn)Vh.ua[di]=bn[di]}}})(typeof window=="object"?window:_)})(GA,GA.exports);var z8=S(GA.exports),XM=al.clear;Ut({global:!0,bind:!0,forced:oe.clearImmediate!==XM},{clearImmediate:XM});var JM=oe,Y8=Ae,q8=$,X8=Lf,J8=Ot,Q8=Do,Z8=da,$8=JM.Function,eK=/MSIE .\./.test(J8)||X8==="BUN"&&(function(){var e=JM.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")})(),tK=Ut,QM=oe,ZM=al.set,nK=function(e,t){var n=1;return eK?function(i,s){var o=Z8(arguments.length,1)>n,c=q8(i)?i:$8(i),d=o?Q8(arguments,n):[],u=o?function(){Y8(c,this,d)}:c;return e(u)}:e},$M=QM.setImmediate?nK(ZM):ZM;tK({global:!0,bind:!0,forced:QM.setImmediate!==$M},{setImmediate:$M});var e2=S(xn.setImmediate),iK=oe,rK=s_,sK=hi,oK=da,aK=Xe;Ut({global:!0,dontCallGetSet:!0,forced:y((function(){return aK&&Object.getOwnPropertyDescriptor(iK,"queueMicrotask").value.length!==1}))},{queueMicrotask:function(e){oK(arguments.length,1),rK(sK(e))}});var t2=S(xn.queueMicrotask);function n2(e,t){return function(){return e.apply(t,arguments)}}const{toString:cK}=Object.prototype,{getPrototypeOf:WA}=Object,{iterator:nv,toStringTag:i2}=Symbol,iv=(HA=Object.create(null),e=>{const t=cK.call(e);return HA[t]||(HA[t]=t.slice(8,-1).toLowerCase())});var HA;const Aa=e=>(e=e.toLowerCase(),t=>iv(t)===e),rv=e=>t=>typeof t===e,{isArray:Kp}=Array,Nm=rv("undefined"),r2=Aa("ArrayBuffer"),lK=rv("string"),zs=rv("function"),s2=rv("number"),sv=e=>e!==null&&typeof e=="object",ov=e=>{if(iv(e)!=="object")return!1;const t=WA(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||i2 in e||nv in e)},dK=Aa("Date"),uK=Aa("File"),hK=Aa("Blob"),pK=Aa("FileList"),fK=Aa("URLSearchParams"),[_K,mK,EK,gK]=["ReadableStream","Request","Response","Headers"].map(Aa);function Dm(e,t){let n,i,{allOwnKeys:s=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Kp(e))for(n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else{const o=s?Object.getOwnPropertyNames(e):Object.keys(e),c=o.length;let d;for(n=0;n<c;n++)d=o[n],t.call(null,e[d],d,e)}}function o2(e,t){t=t.toLowerCase();const n=Object.keys(e);let i,s=n.length;for(;s-- >0;)if(i=n[s],t===i.toLowerCase())return i;return null}const uu=qM!==void 0?qM:typeof self<"u"?self:typeof window<"u"?window:sq,a2=e=>!Nm(e)&&e!==uu,SK=(KA=typeof Uint8Array<"u"&&WA(Uint8Array),e=>KA&&e instanceof KA);var KA;const TK=Aa("HTMLFormElement"),c2=(e=>{let{hasOwnProperty:t}=e;return(n,i)=>t.call(n,i)})(Object.prototype),vK=Aa("RegExp"),l2=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),i={};Dm(n,((s,o)=>{let c;(c=t(s,o,e))!==!1&&(i[o]=c||s)})),Object.defineProperties(e,i)},yK=Aa("AsyncFunction"),d2=(u2=typeof e2=="function",h2=zs(uu.postMessage),u2?e2:h2?(zA="axios@".concat(Math.random()),av=[],uu.addEventListener("message",(e=>{let{source:t,data:n}=e;t===uu&&n===zA&&av.length&&av.shift()()}),!1),e=>{av.push(e),uu.postMessage(zA,"*")}):e=>setTimeout(e));var u2,h2,zA,av;const RK=t2!==void 0?t2.bind(uu):typeof process<"u"&&process.nextTick||d2;var Oe={isArray:Kp,isArrayBuffer:r2,isBuffer:function(e){return e!==null&&!Nm(e)&&e.constructor!==null&&!Nm(e.constructor)&&zs(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||zs(e.append)&&((t=iv(e))==="formdata"||t==="object"&&zs(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&r2(e.buffer),t},isString:lK,isNumber:s2,isBoolean:e=>e===!0||e===!1,isObject:sv,isPlainObject:ov,isReadableStream:_K,isRequest:mK,isResponse:EK,isHeaders:gK,isUndefined:Nm,isDate:dK,isFile:uK,isBlob:hK,isRegExp:vK,isFunction:zs,isStream:e=>sv(e)&&zs(e.pipe),isURLSearchParams:fK,isTypedArray:SK,isFileList:pK,forEach:Dm,merge:function e(){const{caseless:t}=a2(this)&&this||{},n={},i=(s,o)=>{const c=t&&o2(n,o)||o;ov(n[c])&&ov(s)?n[c]=e(n[c],s):ov(s)?n[c]=e({},s):Kp(s)?n[c]=s.slice():n[c]=s};for(let s=0,o=arguments.length;s<o;s++)arguments[s]&&Dm(arguments[s],i);return n},extend:function(e,t,n){let{allOwnKeys:i}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Dm(t,((s,o)=>{n&&zs(s)?e[o]=n2(s,n):e[o]=s}),{allOwnKeys:i}),e},trim:e=>dr(e)?dr(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,n,i)=>{e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,i)=>{let s,o,c;const d={};if(t=t||{},e==null)return t;do{for(s=Object.getOwnPropertyNames(e),o=s.length;o-- >0;)c=s[o],i&&!i(c,e,t)||d[c]||(t[c]=e[c],d[c]=!0);e=n!==!1&&WA(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:iv,kindOfTest:Aa,endsWith:(e,t,n)=>{e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;const i=e.indexOf(t,n);return i!==-1&&i===n},toArray:e=>{if(!e)return null;if(Kp(e))return e;let t=e.length;if(!s2(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[nv]).call(e);let i;for(;(i=n.next())&&!i.done;){const s=i.value;t.call(e,s[0],s[1])}},matchAll:(e,t)=>{let n;const i=[];for(;(n=e.exec(t))!==null;)i.push(n);return i},isHTMLForm:TK,hasOwnProperty:c2,hasOwnProp:c2,reduceDescriptors:l2,freezeMethods:e=>{l2(e,((t,n)=>{if(zs(e)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=e[n];zs(i)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},i=s=>{s.forEach((o=>{n[o]=!0}))};return Kp(e)?i(e):i(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(t,n,i){return n.toUpperCase()+i})),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:o2,global:uu,isContextDefined:a2,isSpecCompliantForm:function(e){return!!(e&&zs(e.append)&&e[i2]==="FormData"&&e[nv])},toJSONObject:e=>{const t=new Array(10),n=(i,s)=>{if(sv(i)){if(t.indexOf(i)>=0)return;if(!("toJSON"in i)){t[s]=i;const o=Kp(i)?[]:{};return Dm(i,((c,d)=>{const u=n(c,s+1);!Nm(u)&&(o[d]=u)})),t[s]=void 0,o}}return i};return n(e,0)},isAsyncFn:yK,isThenable:e=>e&&(sv(e)||zs(e))&&zs(e.then)&&zs(e.catch),setImmediate:d2,asap:RK,isIterable:e=>e!=null&&zs(e[nv])};function Jt(e,t,n,i,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),i&&(this.request=i),s&&(this.response=s,this.status=s.status?s.status:null)}Oe.inherits(Jt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Oe.toJSONObject(this.config),code:this.code,status:this.status}}});const p2=Jt.prototype,f2={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{f2[e]={value:e}})),Object.defineProperties(Jt,f2),Object.defineProperty(p2,"isAxiosError",{value:!0}),Jt.from=(e,t,n,i,s,o)=>{const c=Object.create(p2);return Oe.toFlatObject(e,c,(function(d){return d!==Error.prototype}),(d=>d!=="isAxiosError")),Jt.call(c,e.message,t,n,i,s),c.cause=e,c.name=e.name,o&&Object.assign(c,o),c};function YA(e){return Oe.isPlainObject(e)||Oe.isArray(e)}function _2(e){return Oe.endsWith(e,"[]")?e.slice(0,-2):e}function m2(e,t,n){return e?e.concat(t).map((function(i,s){return i=_2(i),!n&&s?"["+i+"]":i})).join(n?".":""):t}const CK=Oe.toFlatObject(Oe,{},null,(function(e){return/^is[A-Z]/.test(e)}));function cv(e,t,n){if(!Oe.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const i=(n=Oe.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(T,R){return!Oe.isUndefined(R[T])}))).metaTokens,s=n.visitor||p,o=n.dots,c=n.indexes,d=(n.Blob||typeof Blob<"u"&&Blob)&&Oe.isSpecCompliantForm(t);if(!Oe.isFunction(s))throw new TypeError("visitor must be a function");function u(T){if(T===null)return"";if(Oe.isDate(T))return T.toISOString();if(!d&&Oe.isBlob(T))throw new Jt("Blob is not supported. Use a Buffer instead.");return Oe.isArrayBuffer(T)||Oe.isTypedArray(T)?d&&typeof Blob=="function"?new Blob([T]):Buffer.from(T):T}function p(T,R,I){let A=T;if(T&&!I&&typeof T=="object"){if(Oe.endsWith(R,"{}"))R=i?R:R.slice(0,-2),T=JSON.stringify(T);else if(Oe.isArray(T)&&(function(w){return Oe.isArray(w)&&!w.some(YA)})(T)||(Oe.isFileList(T)||Oe.endsWith(R,"[]"))&&(A=Oe.toArray(T)))return R=_2(R),A.forEach((function(w,k){!Oe.isUndefined(w)&&w!==null&&t.append(c===!0?m2([R],k,o):c===null?R:R+"[]",u(w))})),!1}return!!YA(T)||(t.append(m2(I,R,o),u(T)),!1)}const m=[],g=Object.assign(CK,{defaultVisitor:p,convertValue:u,isVisitable:YA});if(!Oe.isObject(e))throw new TypeError("data must be an object");return(function T(R,I){if(!Oe.isUndefined(R)){if(m.indexOf(R)!==-1)throw Error("Circular reference detected in "+I.join("."));m.push(R),Oe.forEach(R,(function(A,w){(!(Oe.isUndefined(A)||A===null)&&s.call(t,A,Oe.isString(w)?dr(w).call(w):w,I,g))===!0&&T(A,I?I.concat(w):[w])})),m.pop()}})(e),t}function E2(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(n){return t[n]}))}function qA(e,t){this._pairs=[],e&&cv(e,this,t)}const g2=qA.prototype;function bK(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function S2(e,t,n){if(!t)return e;const i=n&&n.encode||bK;Oe.isFunction(n)&&(n={serialize:n});const s=n&&n.serialize;let o;if(o=s?s(t,n):Oe.isURLSearchParams(t)?t.toString():new qA(t,n).toString(i),o){const c=e.indexOf("#");c!==-1&&(e=e.slice(0,c)),e+=(e.indexOf("?")===-1?"?":"&")+o}return e}g2.append=function(e,t){this._pairs.push([e,t])},g2.toString=function(e){const t=e?function(n){return e.call(this,n,E2)}:E2;return this._pairs.map((function(n){return t(n[0])+"="+t(n[1])}),"").join("&")};var T2=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Oe.forEach(this.handlers,(function(t){t!==null&&e(t)}))}},v2={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},y2={exports:{}},IK=Ut,AK=Xe,R2=os.f;IK({target:"Object",stat:!0,forced:Object.defineProperty!==R2,sham:!AK},{defineProperty:R2});var C2=xn.Object,wK=y2.exports=function(e,t,n){return C2.defineProperty(e,t,n)};C2.defineProperty.sham&&(wK.sham=!0);var b2=S(y2.exports),OK=TypeError,I2=tl,NK=$f,DK=vn,PK=Fn("species"),A2=Array,kK=function(e){var t;return I2(e)&&(t=e.constructor,(NK(t)&&(t===A2||I2(t.prototype))||DK(t)&&(t=t[PK])===null)&&(t=void 0)),t===void 0?A2:t},w2=function(e,t){return new(kK(e))(t===0?0:t)},LK=y,MK=wr,UK=Fn("species"),O2=function(e){return MK>=51||!LK((function(){var t=[];return(t.constructor={})[UK]=function(){return{foo:1}},t[e](Boolean).foo!==1}))},xK=Ut,VK=y,FK=tl,BK=vn,jK=Ao,GK=Vr,N2=function(e){if(e>9007199254740991)throw OK("Maximum allowed index exceeded");return e},D2=dA,WK=w2,HK=O2,KK=wr,P2=Fn("isConcatSpreadable"),zK=KK>=51||!VK((function(){var e=[];return e[P2]=!1,e.concat()[0]!==e})),YK=function(e){if(!BK(e))return!1;var t=e[P2];return t!==void 0?!!t:FK(e)};xK({target:"Array",proto:!0,forced:!zK||!HK("concat")},{concat:function(e){var t,n,i,s,o,c=jK(this),d=WK(c,0),u=0;for(t=-1,i=arguments.length;t<i;t++)if(YK(o=t===-1?c:arguments[t]))for(s=GK(o),N2(u+s),n=0;n<s;n++,u++)n in o&&D2(d,u,o[n]);else N2(u+1),D2(d,u++,o);return d.length=u,d}});var k2={},qK=Te,XK=Gi,L2=xl.f,JK=Do,M2=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];k2.f=function(e){return M2&&qK(e)==="Window"?(function(t){try{return L2(t)}catch{return JK(M2)}})(e):L2(XK(e))};var zp={},QK=Fn;zp.f=QK;var U2=xn,ZK=bi,$K=zp,e9=os.f,ki=function(e){var t=U2.Symbol||(U2.Symbol={});ZK(t,e)||e9(t,e,{value:$K.f(e)})},t9=Je,n9=Rn,i9=Fn,r9=Vs,x2=function(){var e=n9("Symbol"),t=e&&e.prototype,n=t&&t.valueOf,i=i9("toPrimitive");t&&!t[i]&&r9(t,i,(function(s){return t9(n,this)}),{})},s9=aa,o9=si,a9=Ao,c9=Vr,l9=w2,F3=J([].push),B3=function(e){var t=e===1,n=e===2,i=e===3,s=e===4,o=e===6,c=e===7,d=e===5||o;return function(u,p,m,g){for(var T,R,I=a9(u),A=o9(I),w=c9(A),k=s9(p,m),L=0,j=g||l9,K=t?j(u,w):n||c?j(u,0):void 0;w>L;L++)if((d||L in A)&&(R=k(T=A[L],L,I),e))if(t)K[L]=R;else if(R)switch(e){case 3:return!0;case 5:return T;case 6:return L;case 2:F3(K,T)}else switch(e){case 4:return!1;case 7:F3(K,T)}return o?-1:i||s?s:K}},XA={forEach:B3(0)},wg=Ut,lv=oe,V2=Je,XR=J,Yp=Xe,JR=eo,Ec=y,gc=bi,F2=ee,QR=lr,ZR=Gi,B2=hc,j2=Fr,Og=xt,dv=Zd,j3=fp,G3=xl,W3=k2,H3=Qd,G2=me,K3=os,z3=pp,W2=mt,Y3=Vs,H2=as,tD=Bo,K2=Oo,q3=Ol,d9=Fn,u9=zp,h9=ki,p9=x2,X3=ya,JA=$a,xc=XA.forEach,Vc=ps("hidden"),Ng="Symbol",QA="prototype",J3=JA.set,hh=JA.getterFor(Ng),Fc=Object[QA],p_=lv.Symbol,nD=p_&&p_[QA],f9=lv.RangeError,z2=lv.TypeError,iD=lv.QObject,Dg=G2.f,Pg=K3.f,Q3=W3.f,Z3=W2.f,f_=XR([].push),hu=tD("symbols"),ZA=tD("op-symbols"),Y2=tD("wks"),rD=!iD||!iD[QA]||!iD[QA].findChild,sD=function(e,t,n){var i=Dg(Fc,t);i&&delete Fc[t],Pg(e,t,n),i&&e!==Fc&&Pg(Fc,t,i)},$A=Yp&&Ec((function(){return dv(Pg({},"a",{get:function(){return Pg(this,"a",{value:7}).a}})).a!==7}))?sD:Pg,$R=function(e,t){var n=hu[e]=dv(nD);return J3(n,{type:Ng,tag:e,description:t}),Yp||(n.description=t),n},eC=function(e,t,n){e===Fc&&eC(ZA,t,n),QR(e);var i=B2(t);return QR(n),gc(hu,i)?(n.enumerable?(gc(e,Vc)&&e[Vc][i]&&(e[Vc][i]=!1),n=dv(n,{enumerable:Og(0,!1)})):(gc(e,Vc)||Pg(e,Vc,Og(1,dv(null))),e[Vc][i]=!0),$A(e,i,n)):Pg(e,i,n)},oD=function(e,t){QR(e);var n=ZR(t),i=j3(n).concat(Q2(n));return xc(i,(function(s){Yp&&!V2(q2,n,s)||eC(e,s,n[s])})),e},q2=function(e){var t=B2(e),n=V2(Z3,this,t);return!(this===Fc&&gc(hu,t)&&!gc(ZA,t))&&(!(n||!gc(this,t)||!gc(hu,t)||gc(this,Vc)&&this[Vc][t])||n)},X2=function(e,t){var n=ZR(e),i=B2(t);if(n!==Fc||!gc(hu,i)||gc(ZA,i)){var s=Dg(n,i);return!s||!gc(hu,i)||gc(n,Vc)&&n[Vc][i]||(s.enumerable=!0),s}},J2=function(e){var t=Q3(ZR(e)),n=[];return xc(t,(function(i){gc(hu,i)||gc(K2,i)||f_(n,i)})),n},Q2=function(e){var t=e===Fc,n=Q3(t?ZA:ZR(e)),i=[];return xc(n,(function(s){!gc(hu,s)||t&&!gc(Fc,s)||f_(i,hu[s])})),i};JR||(p_=function(){if(F2(nD,this))throw new z2("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?j2(arguments[0]):void 0,t=q3(e),n=function(i){var s=this===void 0?lv:this;s===Fc&&V2(n,ZA,i),gc(s,Vc)&&gc(s[Vc],t)&&(s[Vc][t]=!1);var o=Og(1,i);try{$A(s,t,o)}catch(c){if(!(c instanceof f9))throw c;sD(s,t,o)}};return Yp&&rD&&$A(Fc,t,{configurable:!0,set:n}),$R(t,e)},Y3(nD=p_[QA],"toString",(function(){return hh(this).tag})),Y3(p_,"withoutSetter",(function(e){return $R(q3(e),e)})),W2.f=q2,K3.f=eC,z3.f=oD,G2.f=X2,G3.f=W3.f=J2,H3.f=Q2,u9.f=function(e){return $R(d9(e),e)},Yp&&H2(nD,"description",{configurable:!0,get:function(){return hh(this).description}})),wg({global:!0,wrap:!0,forced:!JR,sham:!JR},{Symbol:p_}),xc(j3(Y2),(function(e){h9(e)})),wg({target:Ng,stat:!0,forced:!JR},{useSetter:function(){rD=!0},useSimple:function(){rD=!1}}),wg({target:"Object",stat:!0,forced:!JR,sham:!Yp},{create:function(e,t){return t===void 0?dv(e):oD(dv(e),t)},defineProperty:eC,defineProperties:oD,getOwnPropertyDescriptor:X2}),wg({target:"Object",stat:!0,forced:!JR},{getOwnPropertyNames:J2}),p9(),X3(p_,Ng),K2[Vc]=!0;var $3=eo&&!!Symbol.for&&!!Symbol.keyFor,_9=Ut,m9=Rn,E9=bi,e5=Fr,t5=Bo,Z2=$3,$2=t5("string-to-symbol-registry"),g9=t5("symbol-to-string-registry");_9({target:"Symbol",stat:!0,forced:!Z2},{for:function(e){var t=e5(e);if(E9($2,t))return $2[t];var n=m9("Symbol")(t);return $2[t]=n,g9[n]=t,n}});var S9=Ut,T9=bi,v9=Fo,y9=Ts,n5=$3,eU=Bo("symbol-to-string-registry");S9({target:"Symbol",stat:!0,forced:!n5},{keyFor:function(e){if(!v9(e))throw new TypeError(y9(e)+" is not a symbol");if(T9(eU,e))return eU[e]}});var i5=tl,r5=$,s5=Te,o5=Fr,a5=J([].push),c5=Ut,tU=Rn,l5=Ae,ew=Je,tC=J,nU=y,iU=$,rU=Fo,d5=Do,R9=function(e){if(r5(e))return e;if(i5(e)){for(var t=e.length,n=[],i=0;i<t;i++){var s=e[i];typeof s=="string"?a5(n,s):typeof s!="number"&&s5(s)!=="Number"&&s5(s)!=="String"||a5(n,o5(s))}var o=n.length,c=!0;return function(d,u){if(c)return c=!1,u;if(i5(this))return u;for(var p=0;p<o;p++)if(n[p]===d)return u}}},C9=eo,kg=String,qp=tU("JSON","stringify"),tw=tC(/./.exec),u5=tC("".charAt),b9=tC("".charCodeAt),I9=tC("".replace),A9=tC(1 .toString),h5=/[\uD800-\uDFFF]/g,sU=/^[\uD800-\uDBFF]$/,oU=/^[\uDC00-\uDFFF]$/,aU=!C9||nU((function(){var e=tU("Symbol")("stringify detection");return qp([e])!=="[null]"||qp({a:e})!=="{}"||qp(Object(e))!=="{}"})),p5=nU((function(){return qp("\uDF06\uD834")!=='"\\udf06\\ud834"'||qp("\uDEAD")!=='"\\udead"'})),w9=function(e,t){var n=d5(arguments),i=R9(t);if(iU(i)||e!==void 0&&!rU(e))return n[1]=function(s,o){if(iU(i)&&(o=ew(i,this,kg(s),o)),!rU(o))return o},l5(qp,null,n)},f5=function(e,t,n){var i=u5(n,t-1),s=u5(n,t+1);return tw(sU,e)&&!tw(oU,s)||tw(oU,e)&&!tw(sU,i)?"\\u"+A9(b9(e,0),16):e};qp&&c5({target:"JSON",stat:!0,forced:aU||p5},{stringify:function(e,t,n){var i=d5(arguments),s=l5(aU?w9:qp,null,i);return p5&&typeof s=="string"?I9(s,h5,f5):s}});var _5=Qd,O9=Ao;Ut({target:"Object",stat:!0,forced:!eo||y((function(){_5.f(1)}))},{getOwnPropertySymbols:function(e){var t=_5.f;return t?t(O9(e)):[]}}),ki("asyncIterator"),ki("hasInstance"),ki("isConcatSpreadable"),ki("iterator"),ki("match"),ki("matchAll"),ki("replace"),ki("search"),ki("species"),ki("split");var N9=x2;ki("toPrimitive"),N9();var D9=Rn,P9=ya;ki("toStringTag"),P9(D9("Symbol"),"Symbol"),ki("unscopables"),ya(oe.JSON,"JSON",!0);var k9=xn.Symbol,L9=Fn,m5=os.f,cU=L9("metadata"),E5=Function.prototype;E5[cU]===void 0&&m5(E5,cU,{value:null}),ki("asyncDispose"),ki("dispose"),ki("metadata");var M9=k9,lU=J,dU=Rn("Symbol"),U9=dU.keyFor,g5=lU(dU.prototype.valueOf),S5=dU.isRegisteredSymbol||function(e){try{return U9(g5(e))!==void 0}catch{return!1}};Ut({target:"Symbol",stat:!0},{isRegisteredSymbol:S5});for(var T5=Bo,v5=Rn,x9=J,V9=Fo,aD=Fn,nw=v5("Symbol"),uU=nw.isWellKnownSymbol,y5=v5("Object","getOwnPropertyNames"),R5=x9(nw.prototype.valueOf),cD=T5("wks"),lD=0,C5=y5(nw),b5=C5.length;lD<b5;lD++)try{var hU=C5[lD];V9(nw[hU])&&aD(hU)}catch{}var uv=function(e){if(uU&&uU(e))return!0;try{for(var t=R5(e),n=0,i=y5(cD),s=i.length;n<s;n++)if(cD[i[n]]==t)return!0}catch{}return!1};Ut({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:uv}),ki("customMatcher"),ki("observable"),Ut({target:"Symbol",stat:!0},{isRegistered:S5}),Ut({target:"Symbol",stat:!0,forced:!0},{isWellKnown:uv}),ki("matcher"),ki("metadataKey"),ki("patternMatch"),ki("replaceAll");var hv=S(M9),nC=S(zp.f("iterator"));function iw(e){return iw=typeof hv=="function"&&typeof nC=="symbol"?function(t){return typeof t}:function(t){return t&&typeof hv=="function"&&t.constructor===hv&&t!==hv.prototype?"symbol":typeof t},iw(e)}var F9=S(zp.f("toPrimitive"));function Z(e){var t=(function(n,i){if(iw(n)!="object"||!n)return n;var s=n[F9];if(s!==void 0){var o=s.call(n,i);if(iw(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(n)})(e,"string");return iw(t)=="symbol"?t:t+""}function Q(e,t,n){return(t=Z(t))in e?b2(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var I5=S(EH),pU={isBrowser:!0,classes:{URLSearchParams:I5!==void 0?I5:qA,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const rw=typeof window<"u"&&typeof document<"u",fU=typeof navigator=="object"&&navigator||void 0,B9=rw&&(!fU||["ReactNative","NativeScript","NS"].indexOf(fU.product)<0),j9=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",A5=rw&&window.location.href||"http://localhost";function _U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function Bc(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?_U(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_U(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}var dl=Bc(Bc({},Object.freeze({__proto__:null,hasBrowserEnv:rw,hasStandardBrowserEnv:B9,hasStandardBrowserWebWorkerEnv:j9,navigator:fU,origin:A5})),pU),G9=lr,W9=Je,H9=bi,K9=ee,w5=function(){var e=G9(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},mU=RegExp.prototype,O5=function(e){var t=e.flags;return t!==void 0||"flags"in mU||H9(e,"flags")||!K9(mU,e)?t:W9(w5,e)},N5=vm.charAt,D5=Je,z9=lr,Y9=$,q9=Te,X9=/./.exec,J9=TypeError,P5=Ut,EU=Je,k5=ye,dD=ig,sw=Rp,gU=Kn,iC=xs,ow=Fr,Q9=lr,Z9=vn,$9=Te,L5=Ly,M5=O5,ez=ka,tz=y,nz=og,iz=function(e,t,n){return t+(n?N5(e,t).length:1)},U5=function(e,t){var n=e.exec;if(Y9(n)){var i=D5(n,e,t);return i!==null&&z9(i),i}if(q9(e)==="RegExp")return D5(X9,e,t);throw new J9("RegExp#exec called on incompatible receiver")},x5=$a,V5=Fn("matchAll"),SU="RegExp String",F5=SU+" Iterator",rz=x5.set,sz=x5.getterFor(F5),TU=TypeError,rC=k5("".indexOf),sC=k5("".matchAll),vU=!!sC&&!tz((function(){sC("a",/./)})),B5=dD((function(e,t,n,i){rz(this,{type:F5,regexp:e,string:t,global:n,unicode:i,done:!1})}),SU,(function(){var e=sz(this);if(e.done)return sw(void 0,!0);var t=e.regexp,n=e.string,i=U5(t,n);return i===null?(e.done=!0,sw(void 0,!0)):e.global?(ow(i[0])===""&&(t.lastIndex=iz(n,iC(t.lastIndex),e.unicode)),sw(i,!1)):(e.done=!0,sw(i,!1))})),j5=function(e){var t,n,i,s=Q9(this),o=ow(e),c=nz(s,RegExp),d=ow(M5(s));return t=new c(c===RegExp?s.source:s,d),n=!!~rC(d,"g"),i=!!~rC(d,"u"),t.lastIndex=iC(s.lastIndex),new B5(t,o,n,i)};P5({target:"String",proto:!0,forced:vU},{matchAll:function(e){var t,n,i,s,o=gU(this);if(Z9(e)){if(L5(e)&&(t=ow(gU(M5(e))),!~rC(t,"g")))throw new TU("`.matchAll` does not allow non-global regexes");if(vU)return sC(o,e);if((i=ez(e,V5))===void 0&&$9(e)==="RegExp"&&(i=j5),i)return EU(i,e,o)}else if(vU)return sC(o,e);return n=ow(o),s=new RegExp(e,"g"),EU(j5,s,n)}});var oz=to("String","matchAll"),az=ee,yU=oz,RU=String.prototype,cz=function(e){var t=e.matchAll;return typeof e=="string"||e===RU||az(RU,e)&&t===RU.matchAll?yU:t},G5=S(cz);function uD(e){function t(n,i,s,o){let c=n[o++];if(c==="__proto__")return!0;const d=Number.isFinite(+c),u=o>=n.length;return c=!c&&Oe.isArray(s)?s.length:c,u?(Oe.hasOwnProp(s,c)?s[c]=[s[c],i]:s[c]=i,!d):(s[c]&&Oe.isObject(s[c])||(s[c]=[]),t(n,i,s[c],o)&&Oe.isArray(s[c])&&(s[c]=(function(p){const m={},g=Object.keys(p);let T;const R=g.length;let I;for(T=0;T<R;T++)I=g[T],m[I]=p[I];return m})(s[c])),!d)}if(Oe.isFormData(e)&&Oe.isFunction(e.entries)){const n={};return Oe.forEachEntry(e,((i,s)=>{t((function(o){return G5(Oe).call(Oe,/\w+|\[(\w*)]/g,o).map((c=>c[0]==="[]"?"":c[1]||c[0]))})(i),s,n,0)})),n}return null}const aw={transitional:v2,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",i=n.indexOf("application/json")>-1,s=Oe.isObject(e);if(s&&Oe.isHTMLForm(e)&&(e=new FormData(e)),Oe.isFormData(e))return i?JSON.stringify(uD(e)):e;if(Oe.isArrayBuffer(e)||Oe.isBuffer(e)||Oe.isStream(e)||Oe.isFile(e)||Oe.isBlob(e)||Oe.isReadableStream(e))return e;if(Oe.isArrayBufferView(e))return e.buffer;if(Oe.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return(function(c,d){return cv(c,new dl.classes.URLSearchParams,Object.assign({visitor:function(u,p,m,g){return dl.isNode&&Oe.isBuffer(u)?(this.append(p,u.toString("base64")),!1):g.defaultVisitor.apply(this,arguments)}},d))})(e,this.formSerializer).toString();if((o=Oe.isFileList(e))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return cv(o?{"files[]":e}:e,c&&new c,this.formSerializer)}}return s||i?(t.setContentType("application/json",!1),(function(c,d,u){if(Oe.isString(c))try{return(d||JSON.parse)(c),dr(Oe).call(Oe,c)}catch(p){if(p.name!=="SyntaxError")throw p}return(u||JSON.stringify)(c)})(e)):e}],transformResponse:[function(e){const t=this.transitional||aw.transitional,n=t&&t.forcedJSONParsing,i=this.responseType==="json";if(Oe.isResponse(e)||Oe.isReadableStream(e))return e;if(e&&Oe.isString(e)&&(n&&!this.responseType||i)){const s=!(t&&t.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(o){if(s)throw o.name==="SyntaxError"?Jt.from(o,Jt.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:dl.classes.FormData,Blob:dl.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Oe.forEach(["delete","get","head","post","put","patch"],(e=>{aw.headers[e]={}}));var CU=aw;const W5=Oe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),oC=Symbol("internals");function Lg(e){var t;return e&&dr(t=String(e)).call(t).toLowerCase()}function aC(e){return e===!1||e==null?e:Oe.isArray(e)?e.map(aC):String(e)}function cC(e,t,n,i,s){return Oe.isFunction(i)?i.call(this,t,n):(s&&(t=n),Oe.isString(t)?Oe.isString(i)?t.indexOf(i)!==-1:Oe.isRegExp(i)?i.test(t):void 0:void 0)}class Rd{constructor(t){t&&this.set(t)}set(t,n,i){const s=this;function o(u,p,m){const g=Lg(p);if(!g)throw new Error("header name must be a non-empty string");const T=Oe.findKey(s,g);(!T||s[T]===void 0||m===!0||m===void 0&&s[T]!==!1)&&(s[T||p]=aC(u))}const c=(u,p)=>Oe.forEach(u,((m,g)=>o(m,g,p)));if(Oe.isPlainObject(t)||t instanceof this.constructor)c(t,n);else if(Oe.isString(t)&&(t=dr(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(dr(d=t).call(d)))c((u=>{const p={};let m,g,T;return u&&u.split(`
`).forEach((function(R){var I,A;T=R.indexOf(":"),m=dr(I=R.substring(0,T)).call(I).toLowerCase(),g=dr(A=R.substring(T+1)).call(A),!m||p[m]&&W5[m]||(m==="set-cookie"?p[m]?p[m].push(g):p[m]=[g]:p[m]=p[m]?p[m]+", "+g:g)})),p})(t),n);else if(Oe.isObject(t)&&Oe.isIterable(t)){let u,p,m={};for(const g of t){if(!Oe.isArray(g))throw TypeError("Object iterator must return a key-value pair");m[p=g[0]]=(u=m[p])?Oe.isArray(u)?[...u,g[1]]:[u,g[1]]:g[1]}c(m,n)}else t!=null&&o(n,t,i);var d;return this}get(t,n){if(t=Lg(t)){const i=Oe.findKey(this,t);if(i){const s=this[i];if(!n)return s;if(n===!0)return(function(o){const c=Object.create(null),d=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let u;for(;u=d.exec(o);)c[u[1]]=u[2];return c})(s);if(Oe.isFunction(n))return n.call(this,s,i);if(Oe.isRegExp(n))return n.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,n){if(t=Lg(t)){const i=Oe.findKey(this,t);return!(!i||this[i]===void 0||n&&!cC(0,this[i],i,n))}return!1}delete(t,n){const i=this;let s=!1;function o(c){if(c=Lg(c)){const d=Oe.findKey(i,c);!d||n&&!cC(0,i[d],d,n)||(delete i[d],s=!0)}}return Oe.isArray(t)?t.forEach(o):o(t),s}clear(t){const n=Object.keys(this);let i=n.length,s=!1;for(;i--;){const o=n[i];t&&!cC(0,this[o],o,t,!0)||(delete this[o],s=!0)}return s}normalize(t){const n=this,i={};return Oe.forEach(this,((s,o)=>{var c;const d=Oe.findKey(i,o);if(d)return n[d]=aC(s),void delete n[o];const u=t?(function(p){return dr(p).call(p).toLowerCase().replace(/([a-z\d])(\w*)/g,((m,g,T)=>g.toUpperCase()+T))})(o):dr(c=String(o)).call(c);u!==o&&delete n[o],n[u]=aC(s),i[u]=!0})),this}concat(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return this.constructor.concat(this,...n)}toJSON(t){const n=Object.create(null);return Oe.forEach(this,((i,s)=>{i!=null&&i!==!1&&(n[s]=t&&Oe.isArray(i)?i.join(", "):i)})),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((t=>{let[n,i]=t;return n+": "+i})).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){const n=new this(t);for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];return s.forEach((c=>n.set(c))),n}static accessor(t){const n=(this[oC]=this[oC]={accessors:{}}).accessors,i=this.prototype;function s(o){const c=Lg(o);n[c]||((function(d,u){const p=Oe.toCamelCase(" "+u);["get","set","has"].forEach((m=>{Object.defineProperty(d,m+p,{value:function(g,T,R){return this[m].call(this,u,g,T,R)},configurable:!0})}))})(i,o),n[c]=!0)}return Oe.isArray(t)?t.forEach(s):s(t),this}}Rd.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Oe.reduceDescriptors(Rd.prototype,((e,t)=>{let{value:n}=e,i=t[0].toUpperCase()+t.slice(1);return{get:()=>n,set(s){this[i]=s}}})),Oe.freezeMethods(Rd);var pu=Rd;function hD(e,t){const n=this||CU,i=t||n,s=pu.from(i.headers);let o=i.data;return Oe.forEach(e,(function(c){o=c.call(n,o,s.normalize(),t?t.status:void 0)})),s.normalize(),o}function pv(e){return!(!e||!e.__CANCEL__)}function fv(e,t,n){Jt.call(this,e??"canceled",Jt.ERR_CANCELED,t,n),this.name="CanceledError"}function cw(e,t,n){const i=n.config.validateStatus;n.status&&i&&!i(n.status)?t(new Jt("Request failed with status code "+n.status,[Jt.ERR_BAD_REQUEST,Jt.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}Oe.inherits(fv,Jt,{__CANCEL__:!0});const lw=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=0;const s=(function(o,c){o=o||10;const d=new Array(o),u=new Array(o);let p,m=0,g=0;return c=c!==void 0?c:1e3,function(T){const R=Date.now(),I=u[g];p||(p=R),d[m]=T,u[m]=R;let A=g,w=0;for(;A!==m;)w+=d[A++],A%=o;if(m=(m+1)%o,m===g&&(g=(g+1)%o),R-p<c)return;const k=I&&R-I;return k?Math.round(1e3*w/k):void 0}})(50,250);return(function(o,c){let d,u,p=0,m=1e3/c;const g=function(T){p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),d=null,u&&(clearTimeout(u),u=null),o.apply(null,T)};return[function(){const T=Date.now(),R=T-p;for(var I=arguments.length,A=new Array(I),w=0;w<I;w++)A[w]=arguments[w];R>=m?g(A,T):(d=A,u||(u=setTimeout((()=>{u=null,g(d)}),m-R)))},()=>d&&g(d)]})((o=>{const c=o.loaded,d=o.lengthComputable?o.total:void 0,u=c-i,p=s(u);i=c,e({loaded:c,total:d,progress:d?c/d:void 0,bytes:u,rate:p||void 0,estimated:p&&d&&c<=d?(d-c)/p:void 0,event:o,lengthComputable:d!=null,[t?"download":"upload"]:!0})}),n)},bU=(e,t)=>{const n=e!=null;return[i=>t[0]({lengthComputable:n,total:e,loaded:i}),t[1]]},H5=e=>function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Oe.asap((()=>e(...n)))};var lz=dl.hasStandardBrowserEnv?((e,t)=>n=>(n=new XT(n,dl.origin),e.protocol===n.protocol&&e.host===n.host&&(t||e.port===n.port)))(new XT(dl.origin),dl.navigator&&/(msie|trident)/i.test(dl.navigator.userAgent)):()=>!0,K5=dl.hasStandardBrowserEnv?{write(e,t,n,i,s,o){const c=[e+"="+encodeURIComponent(t)];Oe.isNumber(n)&&c.push("expires="+new Date(n).toGMTString()),Oe.isString(i)&&c.push("path="+i),Oe.isString(s)&&c.push("domain="+s),o===!0&&c.push("secure"),document.cookie=c.join("; ")},read(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function IU(e,t,n){let i=!(function(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)})(t);return e&&(i||n==0)?(function(s,o){return o?s.replace(/\/?\/$/,"")+"/"+o.replace(/^\/+/,""):s})(e,t):t}function AU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}const Mg=e=>e instanceof pu?(function(t){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?AU(Object(i),!0).forEach((function(s){Q(t,s,i[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):AU(Object(i)).forEach((function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))}))}return t})({},e):e;function Ug(e,t){t=t||{};const n={};function i(p,m,g,T){return Oe.isPlainObject(p)&&Oe.isPlainObject(m)?Oe.merge.call({caseless:T},p,m):Oe.isPlainObject(m)?Oe.merge({},m):Oe.isArray(m)?m.slice():m}function s(p,m,g,T){return Oe.isUndefined(m)?Oe.isUndefined(p)?void 0:i(void 0,p,0,T):i(p,m,0,T)}function o(p,m){if(!Oe.isUndefined(m))return i(void 0,m)}function c(p,m){return Oe.isUndefined(m)?Oe.isUndefined(p)?void 0:i(void 0,p):i(void 0,m)}function d(p,m,g){return g in t?i(p,m):g in e?i(void 0,p):void 0}const u={url:o,method:o,data:o,baseURL:c,transformRequest:c,transformResponse:c,paramsSerializer:c,timeout:c,timeoutMessage:c,withCredentials:c,withXSRFToken:c,adapter:c,responseType:c,xsrfCookieName:c,xsrfHeaderName:c,onUploadProgress:c,onDownloadProgress:c,decompress:c,maxContentLength:c,maxBodyLength:c,beforeRedirect:c,transport:c,httpAgent:c,httpsAgent:c,cancelToken:c,socketPath:c,responseEncoding:c,validateStatus:d,headers:(p,m,g)=>s(Mg(p),Mg(m),0,!0)};return Oe.forEach(Object.keys(Object.assign({},e,t)),(function(p){const m=u[p]||s,g=m(e[p],t[p],p);Oe.isUndefined(g)&&m!==d||(n[p]=g)})),n}var z5=e=>{const t=Ug({},e);let n,{data:i,withXSRFToken:s,xsrfHeaderName:o,xsrfCookieName:c,headers:d,auth:u}=t;if(t.headers=d=pu.from(d),t.url=S2(IU(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),u&&d.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):""))),Oe.isFormData(i)){if(dl.hasStandardBrowserEnv||dl.hasStandardBrowserWebWorkerEnv)d.setContentType(void 0);else if((n=d.getContentType())!==!1){const[p,...m]=n?n.split(";").map((g=>dr(g).call(g))).filter(Boolean):[];d.setContentType([p||"multipart/form-data",...m].join("; "))}}if(dl.hasStandardBrowserEnv&&(s&&Oe.isFunction(s)&&(s=s(t)),s||s!==!1&&lz(t.url))){const p=o&&c&&K5.read(c);p&&d.set(o,p)}return t},dz=typeof XMLHttpRequest<"u"&&function(e){return new De((function(t,n){const i=z5(e);let s=i.data;const o=pu.from(i.headers).normalize();let c,d,u,p,m,{responseType:g,onUploadProgress:T,onDownloadProgress:R}=i;function I(){p&&p(),m&&m(),i.cancelToken&&i.cancelToken.unsubscribe(c),i.signal&&i.signal.removeEventListener("abort",c)}let A=new XMLHttpRequest;function w(){if(!A)return;const L=pu.from("getAllResponseHeaders"in A&&A.getAllResponseHeaders());cw((function(j){t(j),I()}),(function(j){n(j),I()}),{data:g&&g!=="text"&&g!=="json"?A.response:A.responseText,status:A.status,statusText:A.statusText,headers:L,config:e,request:A}),A=null}A.open(i.method.toUpperCase(),i.url,!0),A.timeout=i.timeout,"onloadend"in A?A.onloadend=w:A.onreadystatechange=function(){A&&A.readyState===4&&(A.status!==0||A.responseURL&&A.responseURL.indexOf("file:")===0)&&setTimeout(w)},A.onabort=function(){A&&(n(new Jt("Request aborted",Jt.ECONNABORTED,e,A)),A=null)},A.onerror=function(){n(new Jt("Network Error",Jt.ERR_NETWORK,e,A)),A=null},A.ontimeout=function(){let L=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const j=i.transitional||v2;i.timeoutErrorMessage&&(L=i.timeoutErrorMessage),n(new Jt(L,j.clarifyTimeoutError?Jt.ETIMEDOUT:Jt.ECONNABORTED,e,A)),A=null},s===void 0&&o.setContentType(null),"setRequestHeader"in A&&Oe.forEach(o.toJSON(),(function(L,j){A.setRequestHeader(j,L)})),Oe.isUndefined(i.withCredentials)||(A.withCredentials=!!i.withCredentials),g&&g!=="json"&&(A.responseType=i.responseType),R&&([u,m]=lw(R,!0),A.addEventListener("progress",u)),T&&A.upload&&([d,p]=lw(T),A.upload.addEventListener("progress",d),A.upload.addEventListener("loadend",p)),(i.cancelToken||i.signal)&&(c=L=>{A&&(n(!L||L.type?new fv(null,e,A):L),A.abort(),A=null)},i.cancelToken&&i.cancelToken.subscribe(c),i.signal&&(i.signal.aborted?c():i.signal.addEventListener("abort",c)));const k=(function(L){const j=/^([-+\w]{1,25})(:?\/\/|:)/.exec(L);return j&&j[1]||""})(i.url);k&&dl.protocols.indexOf(k)===-1?n(new Jt("Unsupported protocol "+k+":",Jt.ERR_BAD_REQUEST,e)):A.send(s||null)}))},wU=(e,t)=>{const{length:n}=e=e?e.filter(Boolean):[];if(t||n){let i,s=new AbortController;const o=function(p){if(!i){i=!0,d();const m=p instanceof Error?p:this.reason;s.abort(m instanceof Jt?m:new fv(m instanceof Error?m.message:m))}};let c=t&&setTimeout((()=>{c=null,o(new Jt("timeout ".concat(t," of ms exceeded"),Jt.ETIMEDOUT))}),t);const d=()=>{e&&(c&&clearTimeout(c),c=null,e.forEach((p=>{p.unsubscribe?p.unsubscribe(o):p.removeEventListener("abort",o)})),e=null)};e.forEach((p=>p.addEventListener("abort",o)));const{signal:u}=s;return u.unsubscribe=()=>Oe.asap(d),u}},pD=S(bg),Y5=zp.f("asyncIterator"),OU=S(Y5);function zl(e,t){this.v=e,this.k=t}function jc(e){return function(){return new zn(e.apply(this,arguments))}}function zn(e){var t,n;function i(o,c){try{var d=e[o](c),u=d.value,p=u instanceof zl;pD.resolve(p?u.v:u).then((function(m){if(p){var g=o==="return"?"return":"next";if(!u.k||m.done)return i(g,m);m=e[g](m).value}s(d.done?"return":"normal",m)}),(function(m){i("throw",m)}))}catch(m){s("throw",m)}}function s(o,c){switch(o){case"return":t.resolve({value:c,done:!0});break;case"throw":t.reject(c);break;default:t.resolve({value:c,done:!1})}(t=t.next)?i(t.key,t.arg):n=null}this._invoke=function(o,c){return new pD((function(d,u){var p={key:o,arg:c,resolve:d,reject:u,next:null};n?n=n.next=p:(t=n=p,i(o,c))}))},typeof e.return!="function"&&(this.return=void 0)}function Jn(e){return new zl(e,0)}function lC(e){var t={},n=!1;function i(s,o){return n=!0,o=new pD((function(c){c(e[s](o))})),{done:!1,value:new zl(o,1)}}return t[hv!==void 0&&nC||"@@iterator"]=function(){return this},t.next=function(s){return n?(n=!1,s):i("next",s)},typeof e.throw=="function"&&(t.throw=function(s){if(n)throw n=!1,s;return i("throw",s)}),typeof e.return=="function"&&(t.return=function(s){return n?(n=!1,s):i("return",s)}),t}zn.prototype[typeof hv=="function"&&OU||"@@asyncIterator"]=function(){return this},zn.prototype.next=function(e){return this._invoke("next",e)},zn.prototype.throw=function(e){return this._invoke("throw",e)},zn.prototype.return=function(e){return this._invoke("return",e)};var dw=S(Y5);function dC(e){var t,n,i,s=2;for(typeof Symbol<"u"&&(n=dw,i=Symbol.iterator);s--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new fD(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function fD(e){function t(n){if(Object(n)!==n)return De.reject(new TypeError(n+" is not an object."));var i=n.done;return De.resolve(n.value).then((function(s){return{value:s,done:i}}))}return fD=function(n){this.s=n,this.n=n.next},fD.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?De.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?De.reject(n):t(i.apply(this.s,arguments))}},new fD(e)}const uz=function*(e,t){let n=e.byteLength;if(!t||n<t)return void(yield e);let i,s=0;for(;s<n;)i=s+t,yield e.slice(s,i),s=i},hz=(function(){var e=jc((function*(t,n){var i,s=!1,o=!1;try{for(var c,d=dC(q5(t));s=!(c=yield Jn(d.next())).done;s=!1){const u=c.value;yield*lC(dC(uz(u,n)))}}catch(u){o=!0,i=u}finally{try{s&&d.return!=null&&(yield Jn(d.return()))}finally{if(o)throw i}}}));return function(t,n){return e.apply(this,arguments)}})(),q5=(function(){var e=jc((function*(t){if(t[dw])return void(yield*lC(dC(t)));const n=t.getReader();try{for(;;){const{done:i,value:s}=yield Jn(n.read());if(i)break;yield s}}finally{yield Jn(n.cancel())}}));return function(t){return e.apply(this,arguments)}})(),NU=(e,t,n,i)=>{const s=hz(e,t);let o,c=0,d=u=>{o||(o=!0,i&&i(u))};return new ReadableStream({async pull(u){try{const{done:p,value:m}=await s.next();if(p)return d(),void u.close();let g=m.byteLength;if(n){let T=c+=g;n(T)}u.enqueue(new Uint8Array(m))}catch(p){throw d(p),p}},cancel:u=>(d(u),s.return())},{highWaterMark:2})};function DU(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function uw(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?DU(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):DU(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}const hw=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",X5=hw&&typeof ReadableStream=="function",J5=hw&&(typeof TextEncoder=="function"?(PU=new TextEncoder,e=>PU.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var PU;const Q5=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return!!e(...n)}catch{return!1}},kU=X5&&Q5((()=>{let e=!1;const t=new Request(dl.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t})),uC=X5&&Q5((()=>Oe.isReadableStream(new Response("").body))),pw={stream:uC&&(e=>e.body)};var Z5;hw&&(Z5=new Response,["text","arrayBuffer","blob","formData","stream"].forEach((e=>{!pw[e]&&(pw[e]=Oe.isFunction(Z5[e])?t=>t[e]():(t,n)=>{throw new Jt("Response type '".concat(e,"' is not supported"),Jt.ERR_NOT_SUPPORT,n)})})));const pz=async(e,t)=>{const n=Oe.toFiniteNumber(e.getContentLength());return n??(async i=>i==null?0:Oe.isBlob(i)?i.size:Oe.isSpecCompliantForm(i)?(await new Request(dl.origin,{method:"POST",body:i}).arrayBuffer()).byteLength:Oe.isArrayBufferView(i)||Oe.isArrayBuffer(i)?i.byteLength:(Oe.isURLSearchParams(i)&&(i+=""),Oe.isString(i)?(await J5(i)).byteLength:void 0))(t)};var LU=hw&&(async e=>{let{url:t,method:n,data:i,signal:s,cancelToken:o,timeout:c,onDownloadProgress:d,onUploadProgress:u,responseType:p,headers:m,withCredentials:g="same-origin",fetchOptions:T}=z5(e);p=p?(p+"").toLowerCase():"text";let R,I=wU([s,o&&o.toAbortSignal()],c);const A=I&&I.unsubscribe&&(()=>{I.unsubscribe()});let w;try{if(u&&kU&&n!=="get"&&n!=="head"&&(w=await pz(m,i))!==0){let W,Y=new Request(t,{method:"POST",body:i,duplex:"half"});if(Oe.isFormData(i)&&(W=Y.headers.get("content-type"))&&m.setContentType(W),Y.body){const[se,de]=bU(w,lw(H5(u)));i=NU(Y.body,65536,se,de)}}Oe.isString(g)||(g=g?"include":"omit");const k="credentials"in Request.prototype;R=new Request(t,uw(uw({},T),{},{signal:I,method:n.toUpperCase(),headers:m.normalize().toJSON(),body:i,duplex:"half",credentials:k?g:void 0}));let L=await fetch(R);const j=uC&&(p==="stream"||p==="response");if(uC&&(d||j&&A)){const W={};["status","statusText","headers"].forEach((ge=>{W[ge]=L[ge]}));const Y=Oe.toFiniteNumber(L.headers.get("content-length")),[se,de]=d&&bU(Y,lw(H5(d),!0))||[];L=new Response(NU(L.body,65536,se,(()=>{de&&de(),A&&A()})),W)}p=p||"text";let K=await pw[Oe.findKey(pw,p)||"text"](L,e);return!j&&A&&A(),await new De(((W,Y)=>{cw(W,Y,{data:K,headers:pu.from(L.headers),status:L.status,statusText:L.statusText,config:e,request:R})}))}catch(k){throw A&&A(),k&&k.name==="TypeError"&&/Load failed|fetch/i.test(k.message)?Object.assign(new Jt("Network Error",Jt.ERR_NETWORK,e,R),{cause:k.cause||k}):Jt.from(k,k&&k.code,e,R)}});const _D={http:null,xhr:dz,fetch:LU};Oe.forEach(_D,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}}));const $5=e=>"- ".concat(e),e4=e=>Oe.isFunction(e)||e===null||e===!1;var mD={getAdapter:e=>{e=Oe.isArray(e)?e:[e];const{length:t}=e;let n,i;const s={};for(let o=0;o<t;o++){let c;if(n=e[o],i=n,!e4(n)&&(i=_D[(c=String(n)).toLowerCase()],i===void 0))throw new Jt("Unknown adapter '".concat(c,"'"));if(i)break;s[c||"#"+o]=i}if(!i){const o=Object.entries(s).map((c=>{let[d,u]=c;return"adapter ".concat(d," ")+(u===!1?"is not supported by the environment":"is not available in the build")}));throw new Jt("There is no suitable adapter to dispatch the request "+(t?o.length>1?`since :
`+o.map($5).join(`
`):" "+$5(o[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return i},adapters:_D};function ED(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new fv(null,e)}function MU(e){return ED(e),e.headers=pu.from(e.headers),e.data=hD.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),mD.getAdapter(e.adapter||CU.adapter)(e).then((function(t){return ED(e),t.data=hD.call(e,e.transformResponse,t),t.headers=pu.from(t.headers),t}),(function(t){return pv(t)||(ED(e),t&&t.response&&(t.response.data=hD.call(e,e.transformResponse,t.response),t.response.headers=pu.from(t.response.headers))),De.reject(t)}))}const fw="1.9.0",_w={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{_w[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const mw={};_w.transitional=function(e,t,n){function i(s,o){return"[Axios v"+fw+"] Transitional option '"+s+"'"+o+(n?". "+n:"")}return(s,o,c)=>{if(e===!1)throw new Jt(i(o," has been removed"+(t?" in "+t:"")),Jt.ERR_DEPRECATED);return t&&!mw[o]&&(mw[o]=!0,console.warn(i(o," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(s,o,c)}},_w.spelling=function(e){return(t,n)=>(console.warn("".concat(n," is likely a misspelling of ").concat(e)),!0)};var fu={assertOptions:function(e,t,n){if(typeof e!="object")throw new Jt("options must be an object",Jt.ERR_BAD_OPTION_VALUE);const i=Object.keys(e);let s=i.length;for(;s-- >0;){const o=i[s],c=t[o];if(c){const d=e[o],u=d===void 0||c(d,o,e);if(u!==!0)throw new Jt("option "+o+" must be "+u,Jt.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new Jt("Unknown option "+o,Jt.ERR_BAD_OPTION)}},validators:_w};const _u=fu.validators;let _v=class{constructor(e){this.defaults=e||{},this.interceptors={request:new T2,response:new T2}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let i={};Error.captureStackTrace?Error.captureStackTrace(i):i=new Error;const s=i.stack?i.stack.replace(/^.+\n/,""):"";try{n.stack?s&&!String(n.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+s):n.stack=s}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=Ug(this.defaults,t);const{transitional:n,paramsSerializer:i,headers:s}=t;n!==void 0&&fu.assertOptions(n,{silentJSONParsing:_u.transitional(_u.boolean),forcedJSONParsing:_u.transitional(_u.boolean),clarifyTimeoutError:_u.transitional(_u.boolean)},!1),i!=null&&(Oe.isFunction(i)?t.paramsSerializer={serialize:i}:fu.assertOptions(i,{encode:_u.function,serialize:_u.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),fu.assertOptions(t,{baseUrl:_u.spelling("baseURL"),withXsrfToken:_u.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=s&&Oe.merge(s.common,s[t.method]);s&&Oe.forEach(["delete","get","head","post","put","patch","common"],(R=>{delete s[R]})),t.headers=pu.concat(o,s);const c=[];let d=!0;this.interceptors.request.forEach((function(R){typeof R.runWhen=="function"&&R.runWhen(t)===!1||(d=d&&R.synchronous,c.unshift(R.fulfilled,R.rejected))}));const u=[];let p;this.interceptors.response.forEach((function(R){u.push(R.fulfilled,R.rejected)}));let m,g=0;if(!d){const R=[MU.bind(this),void 0];for(R.unshift.apply(R,c),R.push.apply(R,u),m=R.length,p=De.resolve(t);g<m;)p=p.then(R[g++],R[g++]);return p}m=c.length;let T=t;for(g=0;g<m;){const R=c[g++],I=c[g++];try{T=R(T)}catch(A){I.call(this,A);break}}try{p=MU.call(this,T)}catch(R){return De.reject(R)}for(g=0,m=u.length;g<m;)p=p.then(u[g++],u[g++]);return p}getUri(e){return S2(IU((e=Ug(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};Oe.forEach(["delete","get","head","options"],(function(e){_v.prototype[e]=function(t,n){return this.request(Ug(n||{},{method:e,url:t,data:(n||{}).data}))}})),Oe.forEach(["post","put","patch"],(function(e){function t(n){return function(i,s,o){return this.request(Ug(o||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:s}))}}_v.prototype[e]=t(),_v.prototype[e+"Form"]=t(!0)}));var hC=_v;class UU{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let n;this.promise=new De((function(s){n=s}));const i=this;this.promise.then((s=>{if(!i._listeners)return;let o=i._listeners.length;for(;o-- >0;)i._listeners[o](s);i._listeners=null})),this.promise.then=s=>{let o;const c=new De((d=>{i.subscribe(d),o=d})).then(s);return c.cancel=function(){i.unsubscribe(o)},c},t((function(s,o,c){i.reason||(i.reason=new fv(s,o,c),n(i.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const n=this._listeners.indexOf(t);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const t=new AbortController,n=i=>{t.abort(i)};return this.subscribe(n),t.signal.unsubscribe=()=>this.unsubscribe(n),t.signal}static source(){let t;return{token:new UU((function(i){t=i})),cancel:t}}}var xU=UU;const VU={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(VU).forEach((e=>{let[t,n]=e;VU[n]=t}));var Ba=VU;const Er=(function e(t){const n=new hC(t),i=n2(hC.prototype.request,n);return Oe.extend(i,hC.prototype,n,{allOwnKeys:!0}),Oe.extend(i,n,null,{allOwnKeys:!0}),i.create=function(s){return e(Ug(t,s))},i})(CU);Er.Axios=hC,Er.CanceledError=fv,Er.CancelToken=xU,Er.isCancel=pv,Er.VERSION=fw,Er.toFormData=cv,Er.AxiosError=Jt,Er.Cancel=Er.CanceledError,Er.all=function(e){return De.all(e)},Er.spread=function(e){return function(t){return e.apply(null,t)}},Er.isAxiosError=function(e){return Oe.isObject(e)&&e.isAxiosError===!0},Er.mergeConfig=Ug,Er.AxiosHeaders=pu,Er.formToJSON=e=>uD(Oe.isHTMLForm(e)?new FormData(e):e),Er.getAdapter=mD.getAdapter,Er.HttpStatusCode=Ba,Er.default=Er;var Gc=Er;const Ew=()=>{};function xg(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Ew};return e.promise=new De(((t,n)=>{e.resolve=i=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(i),e.value=i)},e.reject=i=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,n(i))}})),e}const mv=new Map,mu=new Map,Br=new Map;let sn=(function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e})({}),mi=(function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e})({});const ph=new z8;let Eu=ph.getResult(),Qn=null;function $n(e){if(!Qn){Eu=ph.getResult();const t=(function(d){if(d.engine.name==="Blink"&&d.browser.name!=="WeChat")return mi.CHROME;switch(d.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return mi.CHROME;case"Safari":case"Mobile Safari":return mi.SAFARI;case"Edge":return mi.EDGE;case"Firefox":return mi.FIREFOX;case"QQ":case"QQBrowser":return mi.QQ;case"Opera":return mi.OPERA;case"WeChat":return mi.WECHAT;default:return d.browser.name||""}})(Eu),n=gw(Eu),i=(function(d){return d.os.name==="Windows"?d.os.version?d.os.name+" "+d.os.version:d.os.name:d.os.name||""})(Eu),s=Eu.os.version,o=gw(Eu,!1),c=Eu.device.type;if(!(t&&n&&i&&s))return{name:t,version:n,os:i,osVersion:s,browserVersion:o,deviceType:c};Qn={name:t,version:n,os:i,osVersion:s,browserVersion:o,deviceType:c}}return Qn}function gw(e){let t,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",n?t.split(".")[0]:t}function Sw(){return $n().os}function Tw(){const e=$n();return"".concat(e.os," ").concat(e.osVersion)}function fh(){const e=$n();return!!(Eu.engine.name==="WebKit"&&e.os===sn.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==mi.SAFARI||mo()&&e.name!==mi.SAFARI)}function ms(){return $n().name===mi.CHROME}function Xo(){return $n().name===mi.SAFARI}function FU(){const e=$n();if(e.name!==mi.SAFARI||!e.browserVersion)return!1;const t=e.browserVersion.split(".");return Number(t[0])>15||Number(t[0])===15&&Number(t[1])>=4}function jr(){return $n().name===mi.EDGE}function fi(){return $n().name===mi.FIREFOX}function mo(){return $n().os===sn.IOS}function Ev(e){const t=$n();return!(t.name!==mi.CHROME||!t.osVersion)&&Number(t.version)>=e}function gD(e){const t=$n();return!(t.name!==mi.CHROME||!t.osVersion)&&Number(t.version)<e}function vw(e,t,n){const i=$n();return!(i.name!==e||!i.osVersion)&&(n?Number(i.version)>=t&&Number(i.version)<=n:Number(i.version)===t)}function yw(e){const t=$n();return!(t.name!==mi.EDGE||!t.osVersion)&&Number(t.version)>=e}function SD(e){const t=$n();return!(t.name!==mi.FIREFOX||!t.osVersion)&&Number(t.version)>=e}function BU(e){const t=$n();return!(t.name!==mi.SAFARI||!t.osVersion)&&Number(t.version)>=e}function jU(e,t,n){const i=$n();if(i.os!==sn.IOS||!i.osVersion)return!1;const s=i.osVersion.split(".");return n?t&&Number(s[0])===e&&Number(s[1])>t||Number(s[0])>e:t?Number(s[0])===e&&Number(s[1])>=t||Number(s[0])>e:Number(s[0])>=e}function TD(e,t,n){const i=$n();if(i.os!==sn.IOS||!i.osVersion)return!1;const s=i.osVersion.split(".");return t&&Number(s[0])===e&&Number(s[1])<t||Number(s[0])<e}function Rw(e,t,n){const i=$n();if(i.name!==mi.SAFARI||!i.osVersion||!i.browserVersion)return!1;const s=i.browserVersion.split(".");return n?t&&Number(s[0])===e&&Number(s[1])<t||Number(s[0])<e:t?Number(s[0])===e&&Number(s[1])<=t||Number(s[0])<e:Number(s[0])<=e}function vD(e){const t=$n();return!(t.name!==mi.OPERA||!t.osVersion)&&Number(t.version)>=e}function gv(){const e=$n();if(e.os!==sn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function Vg(){const e=$n();if(e.os!==sn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function yD(){const e=$n();if(e.os!==sn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function gu(){const e=$n();if(e.os!==sn.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function Su(){return Xo()&&navigator.maxTouchPoints>0}function GU(){return $n().name===mi.WECHAT}function RD(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function Xp(){const e=Sw();return(function(){const{deviceType:t}=$n();return t==="mobile"||t==="tablet"})()||e===sn.ANDROID||e===sn.IOS||e===sn.HARMONY_OS}function _h(){const e=$n();return e.name!==mi.EDGE&&e.name!==mi.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Fg(){return Sw()===sn.ANDROID}function Qt(){const e=$n();return Fg()&&(e.name===mi.CHROME||e.name===mi.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function nn(e,t,n){return(t=(function(i){var s=(function(o,c){if(typeof o!="object"||!o)return o;var d=o[Symbol.toPrimitive];if(d!==void 0){var u=d.call(o,"string");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)})(i);return typeof s=="symbol"?s:s+""})(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function nt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function z(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?nt(Object(n),!0).forEach((function(i){nn(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nt(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}let H=(function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e})({}),Ge=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),nn(this,"code",void 0),nn(this,"message",void 0),nn(this,"data",void 0),nn(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function gr(e,t){if(typeof e!="boolean")throw new Ge(H.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function Tn(e,t,n){if(!Re(n).call(n,e))throw new Ge(H.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function Mi(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<n||e>i||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!(function(s){return typeof s=="number"&&s%1==0})(e))throw new Ge(H.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function Eo(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new Ge(H.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&Mi(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&Mi(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&Mi(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&Mi(e.ideal,"".concat(t,".ideal"),1,1/0)}else Mi(e,t,1,1/0)}function ls(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,s=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new Ge(H.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!pC(e,n,i,s))throw new Ge(H.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(s?" ASCII characters only.":""))}function Hi(e,t){if(!Array.isArray(e))throw new Ge(H.INVALID_PARAMS,"".concat(t," should be an array"))}function Gr(e){return e==null}function pC(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,i=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!i||(function(s){if(typeof s!="string")return!1;for(let o=0;o<s.length;o+=1){const c=s.charCodeAt(o);if(c<0||c>255)return!1}return!0})(e))}var Sv=(function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e})(Sv||{}),CD=(function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e})(CD||{});const bD=new class{constructor(){nn(this,"_clientSize",null),nn(this,"getClientWidth",(()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)),nn(this,"getClientHeight",(()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight)),nn(this,"getStyle",(e=>window.getComputedStyle(e,null))),nn(this,"checkCssVisibleProperty",(e=>{var t;let n=!0;const i=this.getStyle(e),{display:s,visibility:o,opacity:c,filter:d}=i;return(s==="none"||Re(t=["hidden","collapse"]).call(t,o)||Number(c)<.1)&&(n=!1),!!n&&(d&&d.split(" ").filter((u=>{var p;const m=u.split("(")[0];return Re(p=["brightness","blur","opacity"]).call(p,m)})).map((u=>{const[p,m]=u.split(/\(|\)/);return[p,Number(m.match(/^[0-9\.]+/))]})).forEach((u=>{const[p,m]=u;switch(p){case"brightness":(m<.1||m>3)&&(n=!1);break;case"blur":m>3&&(n=!1);break;case"opacity":m<.1&&(n=!1)}})),n)})),nn(this,"checkPropertyUpToAllParentNodes",((e,t)=>{let n=!0,i=!0;const s=c=>t(c);let o=e;for(;o&&i;)s(o)||(n=!1,i=!1),o=o.parentElement,o||(i=!1);return n})),nn(this,"checkActualCssVisibleIncludeInherit",(e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty))),nn(this,"getSizeAboutClient",(e=>{const{width:t,height:n,left:i,right:s,top:o,bottom:c}=e.getBoundingClientRect(),d=this.getClientWidth(),u=this.getClientHeight();return{width:t,height:n,left:i,right:s,top:o,bottom:c,clientWidth:d,clientHeight:u,clientMin:Math.min(d,u)}})),nn(this,"checkActualSize",(()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)})),nn(this,"elementFromPoint",((e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null)),nn(this,"checkCoverForAPoint",((e,t,n)=>{const i=this.elementFromPoint(e,t);return i!==null&&i!==n})),nn(this,"getPointPositionList",(()=>{const{width:e,height:t,left:n,top:i}=this._clientSize,s=e/6,o=t/6,c=[],d=10**6;for(let u=0;u<5;u++)for(let p=0;p<5;p++){const m=(n*d+(u===0?.1:u===4?(s*u*d-1e5)/d:s*u)*d)/d,g=(i*d+(p===0?.1:p===4?(o*p*d-1e5)/d:o*p)*d)/d;c.push({x:m,y:g})}return[...c]})),nn(this,"checkElementCover",(e=>this.getPointPositionList().map((t=>this.checkCoverForAPoint(t.x,t.y,e))).filter((t=>!!t)).length>6)),nn(this,"checkSizeIsVisible",((e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10))),nn(this,"checkSizeOfPartInClient",(()=>{const{left:e,right:t,top:n,bottom:i,clientHeight:s,clientWidth:o,clientMin:c}=this._clientSize;let d,u,p,m;if(e<0)d=0;else{if(!(e<o))return!1;d=e}if(t<0)return!1;if(u=t<o?t:o,n<0)p=0;else{if(!(n<s))return!1;p=n}if(i<0)return!1;m=i<s?i:s;const g=u-d,T=m-p;return this.checkSizeIsVisible(g,T,c)})),nn(this,"returnHiddenResult",(e=>(this._clientSize=null,{visible:!1,reason:e}))),nn(this,"checkOneElementVisible",(e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Sv.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(Sv.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Sv.SIZE)}}return this.returnHiddenResult(Sv.STYLE)}return this.returnHiddenResult(CD.UNMOUNTED)}return this.returnHiddenResult(CD.INVALID_HTML_ELEMENT)})),nn(this,"checkElementIsMountedOnDom",(e=>this.checkPropertyUpToAllParentNodes(e,(t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))))}};function ID(e){return new TextEncoder().encode(e)}const AD=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},Sr=async e=>(function(t,n){let i="";return new Uint8Array(t).forEach((s=>{i+=s.toString(n).padStart(2,"0")})),i})(await crypto.subtle.digest("SHA-256",ID(e)),16);class rr{constructor(){nn(this,"_events",{}),nn(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map((n=>n.listener)):[]}on(t,n){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!1})}once(t,n){this._events[t]||(this._events[t]=[]);const i=this._events[t];this._indexOfListener(i,n)===-1&&i.push({listener:n,once:!0})}off(t,n){if(!this._events[t])return;const i=this._events[t],s=this._indexOfListener(i,n);s!==-1&&i.splice(s,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const n=this._events[t].map((c=>c));for(var i=arguments.length,s=new Array(i>1?i-1:0),o=1;o<i;o++)s[o-1]=arguments[o];for(let c=0;c<n.length;c+=1){const d=n[c];d.once&&this.off(t,d.listener),d.listener.apply(this,s||[])}}safeEmit(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];[...this._events[t]||[]].forEach((o=>{o.once&&this.off(t,o.listener);try{o.listener.apply(this,i)}catch(c){console.error("safeEmit event:".concat(t," error ").concat(c?.toString()))}}))}_indexOfListener(t,n){let i=t.length;for(;i--;)if(t[i].listener===n)return i;return-1}}let fC=null;function Zr(){if(fC)return fC;if(window.electron)return fC=window.electron;if(!window.require)return null;try{return fC=window.require("electron"),fC}catch{return null}}let Cn=(function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e})({}),Tr=(function(e){return e.TRACER="tracer",e})({});function t4(e){return Mi(e.timeout,"config.timeout",0,1e5),Mi(e.timeoutFactor,"config.timeoutFactor",0,100,!1),Mi(e.maxRetryCount,"config.maxRetryConfig",0,1/0),Mi(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let Di=(function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e})({}),Ti=(function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e})({});function _C(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach((t=>{if(!t.urls)throw Error()}))}catch{return!1}return!0}function wD(e){return ls(e.turnServerURL,"turnServerURL"),ls(e.username,"username"),ls(e.password,"password"),e.udpport&&Mi(e.udpport,"udpport",1,99999,!0),e.forceturn&&gr(e.forceturn,"forceturn"),e.security&&gr(e.security,"security"),e.tcpport&&Mi(e.tcpport,"tcpport",1,99999,!0),!0}function jn(e){return e.level!==void 0&&Tn(e.level,"level",[1,2,3]),e.delay!==void 0&&Mi(e.delay,"delay",0,3e3,!0),!0}let $t=(function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e})({}),vr=(function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e})({}),ja=(function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e})({}),Ys=(function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e})({});function On(e,t){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];return e.getListeners(t).length===0?De.reject(new Ge(H.UNEXPECTED_ERROR,"can not emit promise")):new De(((o,c)=>{e.emit(t,...i,o,c)}))}function ei(e,t){if(e.getListeners(t).length===0)return De.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];return On(e,t,...i)}function Sc(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];return Kr(e,t,...i)}function Kr(e,t){let n=null,i=null;for(var s=arguments.length,o=new Array(s>2?s-2:0),c=2;c<s;c++)o[c-2]=arguments[c];if(e.emit(t,...o,(d=>{n=d}),(d=>{i=d})),i!==null)throw i;if(n===null)throw new Ge(H.UNEXPECTED_ERROR,"handler is not sync");return n}const $r=new class extends rr{set networkState(e){this.emit(Ys.NETWORK_STATE_CHANGE,e,this._networkState),e===ja.ONLINE?this.emit(Ys.ONLINE):e===ja.OFFLINE&&(this.onlineWaiter=new De((t=>{this.once(Ys.ONLINE,(()=>{this.onlineWaiter=void 0,t(ja.ONLINE)}))})),this.emit(Ys.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===ja.ONLINE}constructor(){super(),nn(this,"_moduleName","network-indicator"),nn(this,"_networkState",ja.ONLINE),nn(this,"onlineWaiter",void 0),window.addEventListener("online",(()=>{this.networkState=ja.ONLINE})),window.addEventListener("offline",(()=>{this.networkState=ja.OFFLINE}))}};function Pm(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function km(e){const t=[];return e.forEach((n=>{t.indexOf(n)===-1&&t.push(n)})),t}function sr(e){De!==void 0?De.resolve().then(e):setTimeout(e,0)}function Ki(e){return JSON.parse(JSON.stringify(e))}function Bg(e){try{return Ki(e)}catch{return e}}const Lm={};function Cd(e,t){Lm[t]||(Lm[t]=!0,e())}function bd(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let i=0;i<t.length;i+=1)n[i]=t.charCodeAt(i);return n}function Mm(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function WU(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(e);if(n.length>t)n=n.slice(0,t);else if(n.length<t){const i=new Uint8Array(t);i.set(n),n=i}return n}function Jp(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=Ks(t).call(t,((c,d)=>c+d.length),0),s=new Uint8Array(new ArrayBuffer(i));let o=0;return t.forEach((c=>{s.set(c,o),o+=c.length})),s}function Qp(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function n4(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach((n=>{t+=typeof n=="string"?Qp(n):n.size})),t+138}function Jo(e){const t=new Ge(H.TIMEOUT,"timeout");return new De(((n,i)=>{window.setTimeout((()=>i(t)),e)}))}function In(e){return new De((t=>{window.setTimeout(t,e)}))}function Oi(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+Oi(e-n.length,"")}function __(){return Oi(32,"").toUpperCase()}const Cw=()=>{},HU=new class{constructor(){nn(this,"fnMap",new Map)}throttleByKey(e,t,n,i){for(var s=arguments.length,o=new Array(s>4?s-4:0),c=4;c<s;c++)o[c-4]=arguments[c];if(this.fnMap.has(t)){const d=this.fnMap.get(t);if(d.threshold!==n){d.fn(...d.args),clearTimeout(d.timer);const u=window.setTimeout((()=>{const p=this.fnMap.get(t);p&&p.fn(...p.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:u,args:o,skipFn:i})}else d.skipFn&&d.skipFn(...d.args),this.fnMap.set(t,z(z({},d),{},{fn:e,args:o,skipFn:i}))}else{const d=window.setTimeout((()=>{const u=this.fnMap.get(t);u&&u.fn(...u.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:d,args:o,skipFn:i})}}},KU=HU.throttleByKey.bind(HU);function OD(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function ND(e,t){if(!OD(e)||!OD(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){const n=[...e];for(let i=0;i<t.length;i++)n[i]=ND(e[i],t[i]);return n}{const n=z({},e);for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(Object.prototype.hasOwnProperty.call(e,i)?n[i]=ND(e[i],t[i]):n[i]=t[i]);return n}}function Tv(e,t){let n=[0];if(n=new Array(t).fill(0),e===0)return n;let i=0;for(;e>0&&(n[i]=255&e,e>>=8,i++,i!==t););return n}function jg(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function DD(e){return Ks(e).call(e,((t,n)=>t+n),0)}function i4(e){const t="0123456789abcdef";function n(j){let K,W="";for(K=0;K<=3;K++)W+=t.charAt(j>>8*K+4&15)+t.charAt(j>>8*K&15);return W}function i(j,K){const W=(65535&j)+(65535&K);return(j>>16)+(K>>16)+(W>>16)<<16|65535&W}function s(j,K,W,Y,se,de){return i((function(ge,je){return ge<<je|ge>>>32-je})(i(i(K,j),i(Y,de)),se),W)}function o(j,K,W,Y,se,de,ge){return s(K&W|~K&Y,j,K,se,de,ge)}function c(j,K,W,Y,se,de,ge){return s(K&Y|W&~Y,j,K,se,de,ge)}function d(j,K,W,Y,se,de,ge){return s(K^W^Y,j,K,se,de,ge)}function u(j,K,W,Y,se,de,ge){return s(W^(K|~Y),j,K,se,de,ge)}const p=(function(j){let K;const W=1+(j.length+8>>6),Y=new Array(16*W);for(K=0;K<16*W;K++)Y[K]=0;for(K=0;K<j.length;K++)Y[K>>2]|=j.charCodeAt(K)<<K%4*8;return Y[K>>2]|=128<<K%4*8,Y[16*W-2]=8*j.length,Y})(e);let m,g,T,R,I,A=1732584193,w=-271733879,k=-1732584194,L=271733878;for(m=0;m<p.length;m+=16)g=A,T=w,R=k,I=L,A=o(A,w,k,L,p[m+0],7,-680876936),L=o(L,A,w,k,p[m+1],12,-389564586),k=o(k,L,A,w,p[m+2],17,606105819),w=o(w,k,L,A,p[m+3],22,-1044525330),A=o(A,w,k,L,p[m+4],7,-176418897),L=o(L,A,w,k,p[m+5],12,1200080426),k=o(k,L,A,w,p[m+6],17,-1473231341),w=o(w,k,L,A,p[m+7],22,-45705983),A=o(A,w,k,L,p[m+8],7,1770035416),L=o(L,A,w,k,p[m+9],12,-1958414417),k=o(k,L,A,w,p[m+10],17,-42063),w=o(w,k,L,A,p[m+11],22,-1990404162),A=o(A,w,k,L,p[m+12],7,1804603682),L=o(L,A,w,k,p[m+13],12,-40341101),k=o(k,L,A,w,p[m+14],17,-1502002290),w=o(w,k,L,A,p[m+15],22,1236535329),A=c(A,w,k,L,p[m+1],5,-165796510),L=c(L,A,w,k,p[m+6],9,-1069501632),k=c(k,L,A,w,p[m+11],14,643717713),w=c(w,k,L,A,p[m+0],20,-373897302),A=c(A,w,k,L,p[m+5],5,-701558691),L=c(L,A,w,k,p[m+10],9,38016083),k=c(k,L,A,w,p[m+15],14,-660478335),w=c(w,k,L,A,p[m+4],20,-405537848),A=c(A,w,k,L,p[m+9],5,568446438),L=c(L,A,w,k,p[m+14],9,-1019803690),k=c(k,L,A,w,p[m+3],14,-187363961),w=c(w,k,L,A,p[m+8],20,1163531501),A=c(A,w,k,L,p[m+13],5,-1444681467),L=c(L,A,w,k,p[m+2],9,-51403784),k=c(k,L,A,w,p[m+7],14,1735328473),w=c(w,k,L,A,p[m+12],20,-1926607734),A=d(A,w,k,L,p[m+5],4,-378558),L=d(L,A,w,k,p[m+8],11,-2022574463),k=d(k,L,A,w,p[m+11],16,1839030562),w=d(w,k,L,A,p[m+14],23,-35309556),A=d(A,w,k,L,p[m+1],4,-1530992060),L=d(L,A,w,k,p[m+4],11,1272893353),k=d(k,L,A,w,p[m+7],16,-155497632),w=d(w,k,L,A,p[m+10],23,-1094730640),A=d(A,w,k,L,p[m+13],4,681279174),L=d(L,A,w,k,p[m+0],11,-358537222),k=d(k,L,A,w,p[m+3],16,-722521979),w=d(w,k,L,A,p[m+6],23,76029189),A=d(A,w,k,L,p[m+9],4,-640364487),L=d(L,A,w,k,p[m+12],11,-421815835),k=d(k,L,A,w,p[m+15],16,530742520),w=d(w,k,L,A,p[m+2],23,-995338651),A=u(A,w,k,L,p[m+0],6,-198630844),L=u(L,A,w,k,p[m+7],10,1126891415),k=u(k,L,A,w,p[m+14],15,-1416354905),w=u(w,k,L,A,p[m+5],21,-57434055),A=u(A,w,k,L,p[m+12],6,1700485571),L=u(L,A,w,k,p[m+3],10,-1894986606),k=u(k,L,A,w,p[m+10],15,-1051523),w=u(w,k,L,A,p[m+1],21,-2054922799),A=u(A,w,k,L,p[m+8],6,1873313359),L=u(L,A,w,k,p[m+15],10,-30611744),k=u(k,L,A,w,p[m+6],15,-1560198380),w=u(w,k,L,A,p[m+13],21,1309151649),A=u(A,w,k,L,p[m+4],6,-145523070),L=u(L,A,w,k,p[m+11],10,-1120210379),k=u(k,L,A,w,p[m+2],15,718787259),w=u(w,k,L,A,p[m+9],21,-343485551),A=i(A,g),w=i(w,T),k=i(k,R),L=i(L,I);return n(A)+n(w)+n(k)+n(L)}let r4=1,ha=console,ro=class{static setLogger(e){ha=e}constructor(e,t){nn(this,"id",void 0),nn(this,"lockingPromise",De.resolve()),nn(this,"locks",0),nn(this,"name",""),nn(this,"lockId",void 0),this.lockId=r4++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){const n=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),i=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");ha.debug("".concat(n," ").concat(i))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);const n=new De((s=>{t=()=>{this.locks-=1,this.logger("unlocked",e),s()}})),i=this.lockingPromise.then((()=>t));return this.lockingPromise=this.lockingPromise.then((()=>n)),i}};function zr(e,t){return function(n,i,s){const o=s.value;if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return s.value=async function(){const c=this[t];if(!c)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const d=await c.lock("From ".concat(e,".").concat(i));try{for(var u=arguments.length,p=new Array(u),m=0;m<u;m++)p[m]=arguments[m];return await o.apply(this,p)}finally{d()}},s}}const Es={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Tu(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Id(e,t,n,i){const s=Object.assign({},Es,i);let o=s.timeout;const c=async()=>{await(function(p){return new De((m=>{window.setTimeout(m,p)}))})(o),o*=s.timeoutFactor,o=Math.min(s.maxRetryTimeout,o)};let d=!1;const u=new De((async(p,m)=>{t=t||(()=>!1),n=n||(()=>!0);for(let g=0;g<s.maxRetryCount;g+=1){if(d)return m(new Ge(H.OPERATION_ABORTED));try{const T=await e();if(!t(T,g)||g+1===s.maxRetryCount)return p(T);await c()}catch(T){if(!n(T,g)||g+1===s.maxRetryCount)return m(T);await c()}}}));return u.cancel=()=>d=!0,u}let bw,Iw=class{constructor(e){nn(this,"input",[]),nn(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:Ks(e=this.input).call(e,((t,n)=>t+n))/this.input.length}},mC=0,Aw=0;function zU(e,t,n,i){return new De(((s,o)=>{t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),mC+=Qp(t.data)):n&&(t.data.size?mC+=t.data.size:t.data instanceof FormData?mC+=n4(t.data):mC+=Qp(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Gc.request(t).then((c=>{typeof c.data=="string"?Aw+=Qp(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?Aw+=c.data.byteLength:Aw+=Qp(JSON.stringify(c.data)),s(c.data)})).catch((c=>{Gc.isCancel(c)?o(new Ge(H.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?o(new Ge(H.NETWORK_TIMEOUT,c.message)):c.response?o(new Ge(H.NETWORK_RESPONSE_ERROR,c.response.status)):o(new Ge(H.NETWORK_ERROR,c.message))}))}))}async function s4(e,t){const n=new Blob([t.data],{type:"buffer"});return await zU(e,z(z({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const vu=()=>window.isSecureContext!==void 0;function yu(e){if(Array.isArray(e))return e.map((n=>n));if(!PD(e))return e;const t={};for(const n in e){const i=e[n];PD(i)||Array.isArray(i)?t[n]=yu(i):t[n]=i}return t}function PD(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let mh=class{constructor(e){nn(this,"input",[]),nn(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const Ad={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},EC={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Ad,remoteCandidate:Ad},updateInterval:0},YU={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},qU={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},XU={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},kD={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let JU=class{constructor(e,t){nn(this,"onFirstVideoReceived",void 0),nn(this,"onFirstVideoDecoded",void 0),nn(this,"onFirstAudioReceived",void 0),nn(this,"onFirstVideoDecodedTimeout",void 0),nn(this,"onFirstAudioDecoded",void 0),nn(this,"onSelectedLocalCandidateChanged",void 0),nn(this,"onSelectedRemoteCandidateChanged",void 0),nn(this,"videoIsReady",!1),nn(this,"videoIsReady2",{}),nn(this,"pc",void 0),nn(this,"options",void 0),nn(this,"intervalTimer",void 0),nn(this,"stats",yu(EC)),nn(this,"isFirstVideoReceived",{}),nn(this,"isFirstVideoDecoded",{}),nn(this,"isFirstAudioReceived",{}),nn(this,"isFirstAudioDecoded",{}),nn(this,"isFirstVideoDecodedTimeout",{}),nn(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval((async()=>{this.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new De((e=>{e({local:z({},Ad),remote:z({},Ad)})}))}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,s=0,o=0,c=0;for(const d of n)e[d].forEach(((u,p)=>{if(!this.lossRateWindowStats[t-1][d][p]||!this.lossRateWindowStats[0][d][p])return;const m=this.lossRateWindowStats[t-1][d][p].packets-this.lossRateWindowStats[0][d][p].packets,g=this.lossRateWindowStats[t-1][d][p].packetsLost-this.lossRateWindowStats[0][d][p].packetsLost;d==="videoSend"||d==="audioSend"?(i+=m,o+=g):(s+=m,c+=g),Number.isNaN(m)||Number.isNaN(m)?u.packetLostRate=0:u.packetLostRate=m<=0||g<=0?0:g/(m+g)}));e.sendPacketLossRate=i<=0||o<=0?0:o/(i+o),e.recvPacketLossRate=s<=0||c<=0?0:c/(s+c)}},ww=class extends JU{constructor(){super(...arguments),nn(this,"_stats",EC),nn(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=yu(EC);const n=t.filter((s=>s.type==="ssrc"));this.processSSRCStats(n);const i=t.find((s=>s.type==="VideoBwe"));i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach((t=>{var n;const i=Re(n=t.id).call(n,"send");switch("".concat(t.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const s=yu(qU);s.codec=t.googCodecName,s.adaptionChangeReason="none",t.googCpuLimitedResolution&&(s.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(s.adaptionChangeReason="bandwidth"),s.avgEncodeMs=Number(t.googAvgEncodeMs),s.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},s.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},s.firsCount=Number(t.googFirReceived),s.nacksCount=Number(t.googNacksReceived),s.plisCount=Number(t.googPlisReceived),s.frameCount=Number(t.framesEncoded),s.bytes=Number(t.bytesSent),s.packets=Number(t.packetsSent),s.packetsLost=Number(t.packetsLost),s.ssrc=Number(t.ssrc),s.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(s),this._stats.rtt=s.rttMs;break}case"video_recv":{const s=yu(YU),o=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(s.codec=t.googCodecName,s.targetDelayMs=Number(t.googTargetDelayMs),s.renderDelayMs=Number(t.googRenderDelayMs),s.currentDelayMs=Number(t.googCurrentDelayMs),s.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),s.decodeMs=Number(t.googDecodeMs),s.maxDecodeMs=Number(t.googMaxDecodeMs),s.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},s.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},s.decodeFrameRate=Number(t.googFrameRateDecoded),s.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},s.jitterBufferMs=Number(t.googJitterBufferMs),s.firsCount=Number(t.googFirsSent),s.nacksCount=Number(t.googNacksSent),s.plisCount=Number(t.googPlisSent),s.framesDecodeCount=Number(t.framesDecoded),s.bytes=Number(t.bytesReceived),s.packets=Number(t.packetsReceived),s.packetsLost=Number(t.packetsLost),s.ssrc=Number(t.ssrc),s.packets>0&&!this.isFirstVideoReceived[s.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(s.ssrc),this.isFirstVideoReceived[s.ssrc]=!0),s.framesDecodeCount>0&&!this.isFirstVideoDecoded[s.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(s.ssrc,s.decodedFrame.width,s.decodedFrame.height),this.isFirstVideoDecoded[s.ssrc]=!0),o){const c=o.stats,d=Date.now()-o.lts;s.framesDecodeFreezeTime=c.framesDecodeFreezeTime,s.framesDecodeInterval=c.framesDecodeInterval,s.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[s.ssrc]?(o.lts=Date.now(),s.framesDecodeInterval=d,s.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?s.framesDecodeFreezeTime+=s.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):s.framesDecodeCount<o.stats.framesDecodeCount&&(s.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(s.ssrc,{stats:z({},s),lts:Date.now()}),this._stats.videoRecv.push(s);break}case"audio_recv":{const s=yu(kD);s.codec=t.googCodecName,s.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,s.decodingCNG=Number(t.googDecodingCNG),s.decodingCTN=Number(t.googDecodingCTN),s.decodingCTSG=Number(t.googDecodingCTSG),s.decodingNormal=Number(t.googDecodingNormal),s.decodingPLC=Number(t.googDecodingPLC),s.decodingPLCCNG=Number(t.googDecodingPLCCNG),s.expandRate=Number(t.googExpandRate),s.accelerateRate=Number(t.googAccelerateRate),s.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),s.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),s.speechExpandRate=Number(t.googSpeechExpandRate),s.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),s.jitterBufferMs=Number(t.googJitterBufferMs),s.jitterMs=Number(t.googJitterReceived),s.bytes=Number(t.bytesReceived),s.packets=Number(t.packetsReceived),s.packetsLost=Number(t.packetsLost),s.ssrc=Number(t.ssrc),s.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),s.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),s.receivedFrames>0&&!this.isFirstAudioReceived[s.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(s.ssrc),this.isFirstAudioReceived[s.ssrc]=!0),s.decodingNormal>0&&!this.isFirstAudioDecoded[s.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(s.ssrc),this.isFirstAudioDecoded[s.ssrc]=!0),this._stats.audioRecv.push(s);break}case"audio_send":{const s=yu(XU);s.codec=t.googCodecName,s.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,s.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),s.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),s.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),s.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),s.bytes=Number(t.bytesSent),s.packets=Number(t.packetsSent),s.packetsLost=Number(t.packetsLost),s.ssrc=Number(t.ssrc),s.rttMs=Number(t.googRtt||0),this._stats.rtt=s.rttMs,this._stats.audioSend.push(s);break}}}))}_getStats(){return new De(((e,t)=>{this.pc.getStats(e,t)}))}statsResponsesToObjects(e){const t=[];return e.result().forEach((n=>{const i={id:n.id,timestamp:n.timestamp.valueOf().toString(),type:n.type};n.names().forEach((s=>{i[s]=n.stat(s)})),t.push(i)})),t}},Gg=(function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e})({}),gC=(function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e})({}),ul=(function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e})({}),ic=(function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e})({});var m_=(function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e})(m_||{});function SC(e,t,n,i){let s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:m_.kNone;if(!t)return;const o=Number(t[n]);if(typeof o!="number")return;const c=Number(t[i]);if(typeof c!="number")return;if(!e)return c?o/c*s:void 0;const d=Number(e[n]);if(typeof d!="number")return;const u=Number(e[i]);if(typeof u!="number")return;const p=c-u;return p?(o-d)/p*s:void 0}let o4=class extends JU{constructor(){super(...arguments),nn(this,"_stats",EC),nn(this,"report",void 0),nn(this,"lastDecodeVideoReceiverStats",new Map),nn(this,"lastVideoFramesRecv",new Map),nn(this,"lastVideoFramesSent",new Map),nn(this,"lastVideoFramesDecode",new Map),nn(this,"lastVideoFramesOutput",new Map),nn(this,"lastVideoJBDelay",new Map),nn(this,"lastAudioJBDelay",new Map),nn(this,"mediaBytesSent",new Map),nn(this,"mediaBytesRetransmit",new Map),nn(this,"mediaBytesTargetEncode",new Map),nn(this,"lastDecodeAudioReceiverStats",new Map),nn(this,"lastAudioConcealment",new Map),nn(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=yu(EC),this.report.forEach((e=>{switch(e.type){case ic.OUTBOUND:case ic.INBOUND:{const t=e.mediaType||e.kind,n=!t&&"frameWidth"in e,i=!t&&!("frameWidth"in e);e.type===ic.OUTBOUND?t==="audio"||i?this.processAudioOutboundStats(e):(t==="video"||n)&&this.processVideoOutboundStats(e):e.type===ic.INBOUND&&(t==="audio"||i?this.processAudioInboundStats(e):(t==="video"||n)&&this.processVideoInboundStats(e));break}case ic.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case ic.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}})),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:z({},Ad),remote:z({},Ad)};return e.forEach((n=>{let i;if(n.type===ic.TRANSPORT&&(i=e.get(n.selectedCandidatePairId)),n.type===ic.CANDIDATE_PAIR&&n.selected&&(i=n),i){const s=(o,c)=>{o.type=c.type,o.id=c.id,c.address&&(o.address=c.address),c.candidateType&&(o.candidateType=c.candidateType),c.port&&(o.port=c.port),c.priority&&(o.priority=c.priority),c.protocol&&(o.protocol=c.protocol),c.relayProtocol&&(o.relayProtocol=c.relayProtocol)};if(i.localCandidateId){const o=e.get(i.localCandidateId);o&&s(t.local,o)}if(i.remoteCandidateId){const o=e.get(i.remoteCandidateId);o&&s(t.remote,o)}}})),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.audioSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===ic.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===ic.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===ic.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(z({},t),z({},this.stats.selectedCandidatePair.localCandidate)),e.type===ic.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(z({},t),z({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find((i=>i.ssrc===e.ssrc));t||(t=yu(kD),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const n=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=SC(n,t,"totalProcessingDelay","jitterBufferEmittedCount",m_.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),this.calculateAudioFreeze(t,n,e),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,z({},t))}calculateAudioFreeze(e,t,n){const i=this.lastAudioConcealment.get(e.ssrc);if(t!=null&&i!=null){const s=i.lts,o=n.timestamp,c=o-s;if(c<=0)return;const d=e.concealedSamples-t.concealedSamples-0,u=i.nonSilent+d,p=e.totalSamplesReceived-t.totalSamplesReceived;if(p<=0)return;const m=80*p/c,g=200*p/c,T=c/p;let R=0;e.freezeSamples80=t.freezeSamples80,e.freezeMs80=t.freezeMs80,u>m&&(i.plc80>0?(e.freezeSamples80+=d,e.freezeMs80+=Math.round(d*T)):(e.freezeSamples80+=u,e.freezeMs80+=Math.round(u*T)),R=i.plc80+1);let I=0;e.freezeSamples200=t.freezeSamples200,e.freezeMs200=t.freezeMs200,u>g&&(i.plc200>0?(e.freezeSamples200+=d,e.freezeMs200+=Math.round(d*T)):(e.freezeSamples200+=u,e.freezeMs200+=Math.round(u*T)),I=i.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:d,lts:o,plc80:R,plc200:I})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:n.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let t=this._stats.videoRecv.find((c=>c.ssrc===e.ssrc));t||(t=yu(YU),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),i=this.lastVideoFramesDecode.get(t.ssrc),s=this.lastVideoFramesOutput.get(t.ssrc),o=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const c=t.decodedFrame?t.decodedFrame.width:0,d=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,c,d),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const c=n.stats,d=o-n.lts;t.framesDecodeFreezeTime=c.framesDecodeFreezeTime,t.framesDecodeInterval=c.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&d>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>c.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=d,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<c.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=SC(n?.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=SC(n?.stats,t,"totalProcessingDelay","framesDecodeCount",m_.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=SC(n?.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",m_.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=SC(n?.stats,t,"totalInterFrameDelay","framesDecodeCount",m_.kMillisecondsFromSeconds),i&&o-i.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-i.count)/((o-i.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:t.decodeFrameRate})):i?t.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:0}),t.framesDroppedCount&&e.framesReceived&&(s&&o-s.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-s.count)/((o-s.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:Math.max(t.outputFrameRate,0)})):s?t.outputFrameRate=s.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:z({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find((i=>i.ssrc===e.ssrc));t||(t=yu(qU),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const i=new mh(10);i.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,i)}if(e.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(e.ssrc);if(i)i.add(e.retransmittedBytesSent);else{const s=new mh(10);s.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,s)}}if(e.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(e.ssrc);if(i)i.add(e.totalEncodedBytesTarget);else{const s=new mh(10);s.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,s)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,t.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const i=this.lastEncoderMs.get(e.ssrc);if(!i||i.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const s=e.framesEncoded-i.lastFrameCount,o=e.totalEncodeTime-i.lastEncoderTime;t.avgEncodeMs=1e3*o/s}}if(e.framesEncoded&&e.qpSum){const i=this.lastEncoderMs.get(e.ssrc);!i||i.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-i.lastQpSum)/(e.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const i=this.findRemoteStatsId(e.ssrc,ic.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find((n=>n.ssrc===e.ssrc));if(t||(t=yu(XU),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,ic.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const i=Array.from(cs(n=this.report).call(n)).find((s=>s.type===t&&s.ssrc===e));return i?i.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var i,s,o,c;const d=t?this.report.get(t):void 0,u=(i=d?.framesSent)!==null&&i!==void 0?i:e.framesSent;if(typeof u!="number")return;let p=(s=d?.frameWidth)!==null&&s!==void 0?s:e.frameWidth,m=(o=d?.frameHeight)!==null&&o!==void 0?o:e.frameHeight,g=(c=d?.framesPerSecond)!==null&&c!==void 0?c:e.framesPerSecond;if(typeof p=="number"&&typeof m=="number"||(p=0,m=0),g==null){const T=Date.now(),R=this.lastVideoFramesSent.get(n.ssrc);R&&T-R.lts>=800?(g=Math.round((u-R.count)/((T-R.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:u,lts:T,rate:g})):R?g=R.rate:this.lastVideoFramesSent.set(n.ssrc,{count:u,lts:T,rate:0})}n.sentFrame={width:p,height:m,frameRate:Math.max(0,g)}}processVideoTrackReceiverStats(e,t,n){var i,s,o,c,d;const u=t?this.report.get(t):void 0,p=(i=u?.framesReceived)!==null&&i!==void 0?i:e.framesReceived,m=(s=u?.frameWidth)!==null&&s!==void 0?s:e.frameWidth,g=(o=u?.frameHeight)!==null&&o!==void 0?o:e.frameHeight,T=(c=u?.jitterBufferDelay)!==null&&c!==void 0?c:e.jitterBufferDelay,R=(d=u?.jitterBufferEmittedCount)!==null&&d!==void 0?d:e.jitterBufferEmittedCount;if(typeof p=="number"){const I=this.lastVideoFramesRecv.get(n.ssrc),A=Date.now();n.framesReceivedCount=p;let w=0;I&&A-I.lts>=800?(w=Math.round((p-I.count)/((A-I.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:p,lts:A,rate:w})):I?w=I.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:p,lts:A,rate:0}),n.receivedFrame={width:m||0,height:g||0,frameRate:w||0},n.decodedFrame={width:m||0,height:g||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:m||0,height:g||0,frameRate:n.outputFrameRate||n.decodeFrameRate||0}}if(T&&R){const I=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let A=I.jitterBufferMs;const w=R-I.jitterBufferEmittedCount;w>0&&(A=1e3*(T-I.jitterBufferDelay)/w),n.jitterBufferMs=A,n.currentDelayMs=Math.round(A),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:T,jitterBufferEmittedCount:R,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(e,t,n){var i,s,o,c;const d=t?this.report.get(t):void 0,u=(i=(s=d?.echoReturnLoss)!==null&&s!==void 0?s:e.echoReturnLoss)!==null&&i!==void 0?i:0,p=(o=(c=d?.echoReturnLossEnhancement)!==null&&c!==void 0?c:e.echoReturnLossEnhancement)!==null&&o!==void 0?o:0;n.aecReturnLoss=u,n.aecReturnLossEnhancement=p}processAudioTrackReceiverStats(e,t,n){var i,s,o,c,d,u,p,m,g;const T=t?this.report.get(t):void 0,R=(i=T?.removedSamplesForAcceleration)!==null&&i!==void 0?i:e.removedSamplesForAcceleration,I=(s=T?.totalSamplesReceived)!==null&&s!==void 0?s:e.totalSamplesReceived,A=(o=T?.jitterBufferDelay)!==null&&o!==void 0?o:e.jitterBufferDelay,w=(c=T?.jitterBufferEmittedCount)!==null&&c!==void 0?c:e.jitterBufferEmittedCount,k=(d=T?.audioLevel)!==null&&d!==void 0?d:e?.audioLevel,L=(u=T?.totalSamplesDuration)!==null&&u!==void 0?u:e?.totalSamplesDuration,j=(p=T?.concealedSamples)!==null&&p!==void 0?p:e.concealedSamples,K=(m=T?.silentConcealedSamples)!==null&&m!==void 0?m:e.silentConcealedSamples,W=(g=T?.concealmentEvents)!==null&&g!==void 0?g:e.concealmentEvents;if(typeof I=="number"&&(n.totalSamplesReceived=I),typeof K=="number"&&(n.silentConcealedSamples=K),typeof W=="number"&&(n.concealmentEvents=W),typeof j=="number"&&(n.concealedSamples=j),R&&I&&(n.accelerateRate=R/I),A&&w){const se=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let de=se.jitterBufferMs;const ge=w-se.jitterBufferEmittedCount;ge>0&&(de=1e3*(A-se.jitterBufferDelay)/ge),n.jitterBufferMs=Math.round(de),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:A,jitterBufferEmittedCount:w,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=k;let Y=1920;L&&I&&(Y=I/L/50,n.receivedFrames=Math.round(I/Y)),j&&(n.droppedFrames=Math.round(j/Y))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime),n.jitter&&(t.jitterMs=1e3*n.jitter),n.timestamp&&(t.timestamp=n.timestamp))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach((s=>{e+=s.diffMean()})),this.mediaBytesRetransmit.forEach((s=>{t=t===null?s.diffMean():t+s.diffMean()})),this.mediaBytesTargetEncode.forEach((s=>{n=n===null?s.diffMean():n+s.diffMean()}));const i=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),n!==null&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}},QU=class extends JU{updateStats(){return De.resolve()}};function LD(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const o=(function(){const c=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return c&&c[0]?Number(c[0].split("/")[1]):null})();return o?o<76?new ww(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:s}):new o4(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:s}):(function(c){if(!window.RTCStatsReport)return!1;const d=c.getStats();return!!(d instanceof De||(function(u){return!!u&&(typeof u=="object"||typeof u=="function")&&typeof u.then=="function"})(d))})(e)?new o4(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:s}):new QU(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:s})}const MD="websdk_ng_install_id";function Yl(){try{if(re("INSTALL_ID"))return re("INSTALL_ID");let e=window.localStorage.getItem(MD);return e||(e=__(),window.localStorage.setItem(MD,e)),te("INSTALL_ID",e),e}catch{return}}const ql=(function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){const n=t[1],i=t[2];return"".concat(n,".").concat(i)}return"4.0.0.999"})("4.24.0"),Um=(function(){try{return JSON.parse("true")===!0}catch{return!0}})();let Bs=(function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e})({});const go=(function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),s=[];for(let d=0;d<6;d++)s.push("1");const o=s.join(""),c={};return c[e]=i,c[t]=o,Object.assign(c,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})})();window.DEFAULT_TURN_CONFIG=go;const TC={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},Ow={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},Nw="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",or={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},en=z(z(z(z({},or),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:Ow,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},TC),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function te(e,t,n){var i,s,o;Re(i=Object.keys(en)).call(i,e)&&(!n&&Re(s=Object.keys(zt)).call(s,e)||(en[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||t!==!0||(en.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&t&&(o=!!t,en.USE_NEW_NETWORK_CONFIG=o,o&&(en.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],en.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],en.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],en.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],en.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",en.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",en.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(en.ENABLE_INSTANT_VIDEO=!0,en.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(en.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(en.NEW_TURN_MODE||(en.NEW_TURN_MODE=4))))}function re(e){return en[e]}Um||(en.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],en.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],en.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],en.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],en.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],en.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],en.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",en.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",en.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",en.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",en.AREAS=["NORTH_AMERICA","OVERSEA"]);let Eh=(function(e){return e[e.REALTIME=1]="REALTIME",e})({});const zt={};var tn=(function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e})(tn||{});let vC=(function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e})({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const a4=128,c4=96,vv=1e3,yC=10;let l4=0;var Wc=(()=>{var e={8:(i,s,o)=>{o.r(s),o.d(s,{Parser:()=>ge,Printer:()=>Ft,parse:()=>we,print:()=>be});const c=`
`,d="".concat("\r").concat(c),u=" ";let p;function m(M){return M>="0"&&M<="9"}function g(M){return M>="!"&&M<="~"}function T(M){return g(M)||M>=""&&M<="ÿ"}function R(M){return M==="!"||M>="#"&&M<="'"||M>="*"&&M<="+"||M>="-"&&M<="."||M>="0"&&M<="9"||M>="A"&&M<="Z"||M>="^"&&M<="~"}function I(M){return M>="1"&&M<="9"}function A(M){return M>="A"&&M<="Z"||M>="a"&&M<="z"}function w(M){return M==="d"||M==="h"||M==="m"||M==="s"}function k(M){return M>""&&M<"	"||M>"\v"&&M<"\f"||M>""&&M<"ÿ"}function L(M){return A(M)||m(M)||M==="+"||M==="/"}function j(M){return m(M)||A(M)||M==="+"||M==="/"||M==="-"||M==="_"}function K(M){return A(M)||m(M)||M==="+"||M==="/"}function W(M,O){var G=Object.keys(M);if(Object.getOwnPropertySymbols){var ne=Object.getOwnPropertySymbols(M);O&&(ne=ne.filter((function(Be){return Object.getOwnPropertyDescriptor(M,Be).enumerable}))),G.push.apply(G,ne)}return G}function Y(M){for(var O=1;O<arguments.length;O++){var G=arguments[O]!=null?arguments[O]:{};O%2?W(Object(G),!0).forEach((function(ne){se(M,ne,G[ne])})):Object.getOwnPropertyDescriptors?Object.defineProperties(M,Object.getOwnPropertyDescriptors(G)):W(Object(G)).forEach((function(ne){Object.defineProperty(M,ne,Object.getOwnPropertyDescriptor(G,ne))}))}return M}function se(M,O,G){return O in M?Object.defineProperty(M,O,{value:G,enumerable:!0,configurable:!0,writable:!0}):M[O]=G,M}(function(M){M.VERSION="v",M.ORIGIN="o",M.SESSION_NAME="s",M.INFORMATION="i",M.URI="u",M.EMAIL="e",M.PHONE="p",M.CONNECTION="c",M.BANDWIDTH="b",M.TIME="t",M.REPEAT="r",M.ZONE_ADJUSTMENTS="z",M.KEY="k",M.ATTRIBUTE="a",M.MEDIA="m"})(p||(p={}));class de{consumeText(O,G){let ne=G;for(;ne<O.length;){const Be=O[ne];if(Be==="\0"||Be==="\r"||Be===c)break;ne+=1}if(ne-G==0)throw new Error("Invalid text, at ".concat(O));return ne}consumeUnicastAddress(O,G,ne){return this.consumeTill(O,G,u)}consumeOneOrMore(O,G,ne){let Be=G;for(;ne(O[Be]);)Be++;if(Be-G==0)throw new Error("Invalid rule at ".concat(G,"."));return Be}consumeSpace(O,G){if(O[G]===u)return G+1;throw new Error("Invalid space at ".concat(G,"."))}consumeIP4Address(O,G){let ne=G;for(let Be=0;Be<4;Be++)if(ne=this.consumeDecimalUChar(O,ne),Be!==3){if(O[ne]!==".")throw new Error("Invalid IP4 address.");ne++}return ne}consumeDecimalUChar(O,G){let ne=G;for(let Lt=0;Lt<3&&m(O[ne]);Lt++,ne++);if(ne-G==0)throw new Error("Invalid decimal uchar.");const Be=parseInt(O.slice(G,ne));if(Be>=0&&Be<=255)return ne;throw new Error("Invalid decimal uchar")}consumeIP6Address(O,G){let ne=this.consumeHexpart(O,G);return O[ne]===":"&&(ne+=1,ne=this.consumeIP4Address(O,ne)),ne}consumeHexpart(O,G){let ne=G;if(O[ne]===":"&&O[ne+1]===":"){ne+=2;try{ne=this.consumeHexseq(O,ne)}catch{}return ne}if(ne=this.consumeHexseq(O,ne),O[ne]===":"&&O[ne+1]===":"){ne+=2;try{ne=this.consumeHexseq(O,ne)}catch{}return ne}return ne}consumeHexseq(O,G){let ne=G;for(;ne=this.consumeHex4(O,ne),O[ne]===":"&&O[ne+1]!==":";)ne+=1;return ne}consumeHex4(O,G){let ne=0;for(;ne<4;ne++)if(!((Be=O[G+ne])>="0"&&Be<="9"||Be>="a"&&Be<="f"||Be>="A"&&Be<="F")){if(ne===0)throw new Error("Invalid hex 4");break}var Be;return G+ne}consumeFQDN(O,G){let ne=G;for(;m(O[ne])||A(O[ne])||O[ne]==="-"||O[ne]===".";)ne+=1;if(ne-G<4)throw new Error("Invalid FQDN");return ne}consumeExtnAddr(O,G){return this.consumeOneOrMore(O,G,T)}consumeMulticastAddress(O,G,ne){switch(ne){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(O,G);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(O,G);default:try{return this.consumeFQDN(O,G)}catch{return this.consumeExtnAddr(O,G)}}}consumeIP6MulticastAddress(O,G){const ne=this.consumeHexpart(O,G);return O[ne]==="/"?this.consumeInteger(O,ne+1):ne}consumeIP4MulticastAddress(O,G){let ne=G+3;const Be=O.slice(G,ne),Lt=parseInt(Be);if(Lt<224||Lt>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let yn=0;yn<3;yn++){if(O[ne]!==".")throw new Error("Invalid IP4 multicast address.");ne+=1,ne=this.consumeDecimalUChar(O,ne)}return O[ne]==="/"&&(ne+=1),ne=this.consumeTTL(O,ne),O[ne]==="/"&&(ne=this.consumeInteger(O,ne)),ne}consumeInteger(O,G){if(!I(O[G]))throw new Error("Invalid integer.");for(G+=1;m(O[G]);)G+=1;return G}consumeTTL(O,G){if(O[G]==="0")return G+1;if(!I(O[G]))throw new Error("Invalid TTL.");G+=1;for(let ne=0;ne<2&&m(O[G]);ne++)G+=1;return G}consumeToken(O,G){return this.consumeOneOrMore(O,G,R)}consumeTime(O,G){let ne=G;if(O[ne]==="0")return ne+1;for(I(O[ne])&&(ne+=1);m(O[ne]);)ne++;if(ne-G<10)throw new Error("Invalid time");return ne}consumeAddress(O,G){return this.consumeTill(O,G,u)}consumeTypedTime(O,G){let ne=G;return ne=this.consumeOneOrMore(O,ne,m),w(O[ne])?ne+1:ne}consumeRepeatInterval(O,G){if(!I(O[G]))throw new Error("Invalid repeat interval");for(G+=1;m(O[G]);)G+=1;return w(O[G])&&(G+=1),G}consumePort(O,G){return this.consumeOneOrMore(O,G,m)}consume(O,G,ne){for(let Be=0;Be<ne.length;Be++){if(G+Be>=O.length)throw new Error("consume exceeding value length");if(O[G+Be]!==ne[Be])throw new Error("consume ".concat(ne," failed at ").concat(Be))}return G+ne.length}consumeTill(O,G,ne){let Be=G;for(;Be<O.length&&(typeof ne!="string"||O[Be]!==ne)&&(typeof ne!="function"||!ne(O[Be]));)Be++;return Be}}class ge extends de{constructor(){super(),se(this,"records",[]),se(this,"currentLine",0)}parse(O){const G=this.probeEOL(O);this.records=O.split(G).filter((Vh=>!!dr(Vh).call(Vh))).map(this.parseLine),this.currentLine=0;const ne=this.parseVersion(),Be=this.parseOrigin(),Lt=this.parseSessionName(),yn=this.parseInformation(),tr=this.parseUri(),xo=this.parseEmail(),Rl=this.parsePhone(),Sf=this.parseConnection(),xh=this.parseBandWidth(),hE=this.parseTimeFields(),Xv=this.parseKey(),Cl=this.parseSessionAttribute(),Da=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ne,origin:Be,sessionName:Lt,information:yn,uri:tr,emails:xo,phones:Rl,connection:Sf,bandwidths:xh,timeFields:hE,key:Xv,attributes:Cl,mediaDescriptions:Da}}getCurrentRecord(){const O=this.records[this.currentLine];if(!O)throw new Error("Record doesn't exit.");return O}probeEOL(O){for(let G=0;G<O.length;G++)if(O[G]===c)return O[G-1]==="\r"?d:c;throw new Error("Invalid newline character.")}parseLine(O,G){if(O.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const ne=O[0];if(O[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ne,value:O.slice(2),line:G,cur:0}}parseSessionAttribute(){const O=new _t;for(;this.currentLine<this.records.length;){const G=this.getCurrentRecord();if(G.type!==p.ATTRIBUTE)break;const ne={attField:this.extractOneOrMore(G,(Be=>R(Be)&&Be!==":")),_cur:0};G.value[G.cur]===":"&&(G.cur+=1,ne.attValue=this.extractOneOrMore(G,k)),O.parse(ne),this.currentLine++}return O.digest()}parseMediaAttributes(O){const G=new ht(O);for(;this.currentLine<this.records.length;){const ne=this.getCurrentRecord();if(ne.type!==p.ATTRIBUTE)break;const Be={attField:this.extractOneOrMore(ne,(Lt=>R(Lt)&&Lt!==":")),_cur:0};ne.value[ne.cur]===":"&&(ne.cur+=1,Be.attValue=this.extractOneOrMore(ne,k)),G.parse(Be),this.currentLine++}return G.digest()}parseKey(){const O=this.getCurrentRecord();if(O.type===p.KEY){if(O.value==="prompt"||O.value==="clear:"||O.value==="base64:"||O.value==="uri:")return O.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const O=this.getCurrentRecord();if(O.type===p.ZONE_ADJUSTMENTS){const G=[];for(;;)try{const ne=this.extract(O,this.consumeTime);this.consumeSpaceForRecord(O);let Be=!1;O.value[O.cur]==="-"&&(Be=!0,O.cur+=1);const Lt=this.extract(O,this.consumeTypedTime);G.push({time:ne,typedTime:Lt,back:Be})}catch{break}if(G.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,G}return[]}parseRepeat(){const O=[];for(;;){const G=this.getCurrentRecord();if(G.type!==p.REPEAT)break;{const ne=this.extract(G,this.consumeRepeatInterval),Be=this.parseTypedTime(G);O.push({repeatInterval:ne,typedTimes:Be}),this.currentLine++}}return O}parseTypedTime(O){const G=[];for(;;)try{this.consumeSpaceForRecord(O),G.push(this.extract(O,this.consumeTypedTime))}catch{break}if(G.length===0)throw new Error("Invalid typed time.");return G}parseTime(){const O=this.getCurrentRecord(),G=this.extract(O,this.consumeTime);this.consumeSpaceForRecord(O);const ne=this.extract(O,this.consumeTime);return this.currentLine++,{startTime:G,stopTime:ne}}parseBandWidth(){const O=[];for(;this.currentLine<this.records.length;){const G=this.getCurrentRecord();if(G.type!==p.BANDWIDTH)break;{const ne=this.extractOneOrMore(G,R);if(G.value[G.cur]!==":")throw new Error("Invalid bandwidth field.");G.cur++;const Be=this.extractOneOrMore(G,m);O.push({bwtype:ne,bandwidth:Be}),this.currentLine++}}return O}parseVersion(){const O=this.getCurrentRecord();if(O.type!==p.VERSION)throw new Error("first sdp record must be version");const G=O.value.slice(0,this.consumeOneOrMore(O.value,0,m));if(G.length!==O.value.length)throw new Error('invalid proto version, "v='.concat(O.value,'"'));return this.currentLine++,G}parseOrigin(){const O=this.getCurrentRecord();if(O.type!==p.ORIGIN)throw new Error("second line of sdp must be origin");const G=this.extractOneOrMore(O,T);this.consumeSpaceForRecord(O);const ne=this.extractOneOrMore(O,m);this.consumeSpaceForRecord(O);const Be=this.extractOneOrMore(O,m);this.consumeSpaceForRecord(O);const Lt=this.extractOneOrMore(O,R);this.consumeSpaceForRecord(O);const yn=this.extractOneOrMore(O,R);this.consumeSpaceForRecord(O);const tr=this.extract(O,this.consumeUnicastAddress);return this.currentLine++,{username:G,sessId:ne,sessVersion:Be,nettype:Lt,addrtype:yn,unicastAddress:tr}}parseSessionName(){const O=this.getCurrentRecord();if(O.type===p.SESSION_NAME){const G=this.extract(O,this.consumeText);return this.currentLine++,G}}parseInformation(){const O=this.getCurrentRecord();if(O.type!==p.INFORMATION)return;const G=this.extract(O,this.consumeText);return this.currentLine++,G}parseUri(){const O=this.getCurrentRecord();if(O.type===p.URI)return this.currentLine++,O.value}parseEmail(){const O=[];for(;;){const G=this.getCurrentRecord();if(G.type!==p.EMAIL)break;O.push(G.value),this.currentLine++}return O}parsePhone(){const O=[];for(;;){const G=this.getCurrentRecord();if(G.type!==p.PHONE)break;O.push(G.value),this.currentLine++}return O}parseConnection(){const O=this.getCurrentRecord();if(O.type===p.CONNECTION){const G=this.extractOneOrMore(O,R);this.consumeSpaceForRecord(O);const ne=this.extractOneOrMore(O,R);this.consumeSpaceForRecord(O);const Be=this.extract(O,this.consumeAddress);return this.currentLine++,{nettype:G,addrtype:ne,address:Be}}}parseMedia(){const O=this.getCurrentRecord(),G=this.extract(O,this.consumeToken);this.consumeSpaceForRecord(O);let ne=this.extract(O,this.consumePort);O.value[O.cur]==="/"&&(O.cur+=1,ne+=this.extract(O,this.consumeInteger)),this.consumeSpaceForRecord(O);const Be=[];for(Be.push(this.extract(O,this.consumeToken));O.value[O.cur]==="/";)O.cur+=1,Be.push(this.extract(O,this.consumeToken));if(Be.length===0)throw new Error("Invalid proto");const Lt=this.parseFmt(O);return this.currentLine++,{mediaType:G,port:ne,protos:Be,fmts:Lt}}parseTimeFields(){const O=[];for(;this.getCurrentRecord().type===p.TIME;){const G=this.parseTime(),ne=this.parseRepeat(),Be=this.parseZone();O.push({time:G,repeats:ne,zones:Be})}return O}parseMediaDescription(){const O=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===p.MEDIA;){const G=this.parseMedia(),ne=this.parseInformation(),Be=this.parseConnections(),Lt=this.parseBandWidth(),yn=this.parseKey(),tr=this.parseMediaAttributes(G);O.push({media:G,information:ne,connections:Be,bandwidths:Lt,key:yn,attributes:tr})}return O}parseConnections(){const O=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===p.CONNECTION;)O.push(this.parseConnection());return O}parseFmt(O){const G=[];for(;;)try{this.consumeSpaceForRecord(O),G.push(this.extract(O,this.consumeToken))}catch{break}if(G.length===0)throw new Error("Invalid fmts");return G}extract(O,G){for(var ne=arguments.length,Be=new Array(ne>2?ne-2:0),Lt=2;Lt<ne;Lt++)Be[Lt-2]=arguments[Lt];const yn=G.call(this,O.value,O.cur,...Be),tr=O.value.slice(O.cur,yn);return O.cur=yn,tr}extractOneOrMore(O,G){const ne=this.consumeOneOrMore(O.value,O.cur,G),Be=O.value.slice(O.cur,ne);return O.cur=ne,Be}consumeSpaceForRecord(O){if(O.value[O.cur]!==u)throw new Error("Invalid space at ".concat(O.cur,"."));O.cur+=1}}class je extends de{constructor(){super(...arguments),se(this,"attributes",void 0),se(this,"digested",!1)}extractOneOrMore(O,G,ne){const Be=this.consumeOneOrMore(O.attValue,O._cur,G),Lt=O.attValue.slice(O._cur,Be),[yn,tr]=ne||[];if(typeof yn=="number"&&Lt.length<yn)throw new Error("error in length, should be more or equal than ".concat(yn," characters."));if(typeof tr=="number"&&Lt.length>tr)throw new Error("error in length, should be less or equal than ".concat(tr," characters."));return O._cur=Be,Lt}consumeAttributeSpace(O){if(O.attValue[O._cur]!==u)throw new Error("Invalid space at ".concat(O._cur,"."));O._cur+=1}extract(O,G){if(!O.attValue)throw new Error("Nothing to extract from attValue.");for(var ne=arguments.length,Be=new Array(ne>2?ne-2:0),Lt=2;Lt<ne;Lt++)Be[Lt-2]=arguments[Lt];const yn=G.call(this,O.attValue,O._cur,...Be),tr=O.attValue.slice(O._cur,yn);return O._cur=yn,tr}atEnd(O){if(!O.attValue)throw new Error;return O._cur>=O.attValue.length}peekChar(O){if(!O.attValue)throw new Error;return O.attValue[O._cur]}peek(O,G){if(!O.attValue)throw new Error;for(let ne=0;ne<G.length;ne++)if(G[ne]!==O.attValue[O._cur+ne])return!1;return!0}parseIceUfrag(O){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(O,L,[4,256])}parseIcePwd(O){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(O,L,[22,256])}parseIceOptions(O){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const G=[];for(;!this.atEnd(O);){G.push(this.extractOneOrMore(O,L));try{this.consumeAttributeSpace(O)}catch(ne){if(this.atEnd(O))break;throw ne}}this.attributes.iceOptions=G}parseFingerprint(O){const G=this.extract(O,this.consumeToken);this.consumeAttributeSpace(O);const ne=this.extract(O,this.consumeTill);this.attributes.fingerprints.push({hashFunction:G,fingerprint:ne})}parseExtmap(O){const G=this.extractOneOrMore(O,m);let ne;this.peekChar(O)==="/"&&(this.extract(O,this.consume,"/"),ne=this.extract(O,this.consumeToken)),this.consumeAttributeSpace(O);const Be=this.extract(O,this.consumeTill,u),Lt=Y(Y({entry:parseInt(G,10)},ne&&{direction:ne}),{},{extensionName:Be});this.peekChar(O)===u&&(this.consumeAttributeSpace(O),Lt.extensionAttributes=this.extract(O,this.consumeTill)),this.attributes.extmaps.push(Lt)}parseSetup(O){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const G=this.extract(O,this.consumeTill);if(G!=="active"&&G!=="passive"&&G!=="actpass"&&G!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=G}}class _t extends je{constructor(){super(...arguments),se(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(O){if(this.digested)throw new Error("already digested");try{switch(O.attField){case"group":this.parseGroup(O);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(O);break;case"ice-pwd":this.parseIcePwd(O);break;case"ice-options":this.parseIceOptions(O);break;case"fingerprint":this.parseFingerprint(O);break;case"setup":this.parseSetup(O);break;case"tls-id":this.parseTlsId(O);break;case"identity":this.parseIdentity(O);break;case"extmap":this.parseExtmap(O);break;case"msid-semantic":this.parseMsidSemantic(O);break;default:O.ignored=!0,this.attributes.unrecognized.push(O)}}catch(G){throw console.error("parsing session attribute ".concat(O.attField,' error, "a=').concat(O.attField,":").concat(O.attValue,'"')),G}if(!O.ignored&&O.attValue&&!this.atEnd(O))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(O){const G=this.extract(O,this.consumeToken),ne=[];for(;!this.atEnd(O)&&this.peekChar(O)===u;)this.consumeAttributeSpace(O),ne.push(this.extract(O,this.consumeToken));this.attributes.groups.push({semantic:G,identificationTag:ne})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(O){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(O,j)}parseIdentity(O){const G=this.extractOneOrMore(O,K),ne=[];for(;!this.atEnd(O)&&this.peekChar(O)===u;){this.consumeAttributeSpace(O);const Be=this.extract(O,this.consumeToken);this.extract(O,this.consume,"=");const Lt=this.extractOneOrMore(O,(yn=>yn!==u&&k(yn)));ne.push({name:Be,value:Lt})}this.attributes.identities.push({assertionValue:G,extensions:ne})}parseMsidSemantic(O){this.peekChar(O)===u&&this.consumeAttributeSpace(O);const G={semantic:this.extract(O,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(O)}catch{break}if(this.peekChar(O)==="*"){this.extract(O,this.consume,"*"),G.applyForAll=!0;break}{const ne=this.extract(O,this.consumeTill,u);G.identifierList.push(ne)}}this.attributes.msidSemantic=G}}class ht extends je{constructor(O){super(),se(this,"attributes",void 0),O.protos.indexOf("RTP")!==-1||O.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(O){if(this.digested)throw new Error("already digested");try{switch(O.attField){case"extmap":this.parseExtmap(O);break;case"setup":this.parseSetup(O);break;case"ice-ufrag":this.parseIceUfrag(O);break;case"ice-pwd":this.parseIcePwd(O);break;case"ice-options":this.parseIceOptions(O);break;case"candidate":this.parseCandidate(O);break;case"remote-candidate":this.parseRemoteCandidate(O);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(O);break;case"rtpmap":this.parseRtpmap(O);break;case"ptime":this.parsePtime(O);break;case"maxptime":this.parseMaxPtime(O);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(O);break;case"ssrc":this.parseSSRC(O);break;case"fmtp":this.parseFmtp(O);break;case"rtcp-fb":this.parseRtcpFb(O);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(O);break;case"mid":this.parseMid(O);break;case"msid":this.parseMsid(O);break;case"imageattr":this.parseImageAttr(O);break;case"rid":this.parseRid(O);break;case"simulcast":this.parseSimulcast(O);break;case"sctp-port":this.parseSctpPort(O);break;case"max-message-size":this.parseMaxMessageSize(O);break;case"ssrc-group":this.parseSSRCGroup(O);break;default:O.ignored=!0,this.attributes.unrecognized.push(O)}}catch(G){throw console.error("parsing media attribute ".concat(O.attField,' error, "a=').concat(O.attField,":").concat(O.attValue,'"')),G}if(!O.ignored&&O.attValue&&!this.atEnd(O))throw new Error("attribute parsing error")}parseCandidate(O){const G=this.extractOneOrMore(O,L,[1,32]);this.consumeAttributeSpace(O);const ne=this.extractOneOrMore(O,m,[1,5]);this.consumeAttributeSpace(O);const Be=this.extract(O,this.consumeToken);this.consumeAttributeSpace(O);const Lt=this.extractOneOrMore(O,m,[1,10]);this.consumeAttributeSpace(O);const yn=this.extract(O,this.consumeAddress);this.consumeAttributeSpace(O);const tr=this.extract(O,this.consumePort);this.consumeAttributeSpace(O),this.extract(O,this.consume,"typ"),this.consumeAttributeSpace(O);const xo={foundation:G,componentId:ne,transport:Be,priority:Lt,connectionAddress:yn,port:tr,type:this.extract(O,this.consumeToken),extension:{}};for(this.peek(O," raddr")&&(this.extract(O,this.consume," raddr"),this.consumeAttributeSpace(O),xo.relAddr=this.extract(O,this.consumeAddress)),this.peek(O," rport")&&(this.extract(O,this.consume," rport"),this.consumeAttributeSpace(O),xo.relPort=this.extract(O,this.consumePort));this.peekChar(O)===u;){this.consumeAttributeSpace(O);const Rl=this.extract(O,this.consumeToken);this.consumeAttributeSpace(O),xo.extension[Rl]=this.extractOneOrMore(O,g)}this.attributes.candidates.push(xo)}parseRemoteCandidate(O){const G=[];for(;;){const ne=this.extractOneOrMore(O,m,[1,5]);this.consumeAttributeSpace(O);const Be=this.extract(O,this.consumeAddress);this.consumeAttributeSpace(O);const Lt=this.extract(O,this.consumePort);G.push({componentId:ne,connectionAddress:Be,port:Lt});try{this.consumeAttributeSpace(O)}catch{break}}this.attributes.remoteCandidatesList.push(G)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(O){const G=this.extract(O,this.consumeToken);this.consumeAttributeSpace(O);const ne=this.extract(O,this.consumeTill,"/");this.extract(O,this.consume,"/");const Be={encodingName:ne,clockRate:this.extractOneOrMore(O,m)};this.atEnd(O)||this.peekChar(O)!=="/"||(this.extract(O,this.consume,"/"),Be.encodingParameters=parseInt(this.extract(O,this.consumeTill),10));const Lt=this.attributes.payloads.find((yn=>yn.payloadType===parseInt(G,10)));Lt?Lt.rtpMap=Be:this.attributes.payloads.push({payloadType:parseInt(G,10),rtpMap:Be,rtcpFeedbacks:[]})}parsePtime(O){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(O,this.consumeTill)}parseMaxPtime(O){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(O,this.consumeTill)}parseDirection(O){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=O.attField}parseSSRC(O){const G=this.extractOneOrMore(O,m);this.consumeAttributeSpace(O);const ne=this.extract(O,this.consumeTill,":");let Be;this.peekChar(O)===":"&&(this.extract(O,this.consume,":"),Be=this.extract(O,this.consumeTill));const Lt=this.attributes.ssrcs.find((yn=>yn.ssrcId===parseInt(G,10)));Lt?Lt.attributes[ne]=Be:this.attributes.ssrcs.push({ssrcId:parseInt(G,10),attributes:{[ne]:Be}})}parseFmtp(O){const G=this.extract(O,this.consumeTill,u);this.consumeAttributeSpace(O);const ne=this.extract(O,this.consumeTill),Be={};ne.split(";").forEach((yn=>{let[tr,xo]=yn.split("=");tr=dr(tr).call(tr);const Rl=typeof xo=="string"?dr(xo).call(xo):null;typeof tr=="string"&&tr.length>0&&(Be[tr]=Rl)}));const Lt=this.attributes.payloads.find((yn=>yn.payloadType===parseInt(G,10)));Lt?Lt.fmtp={parameters:Be}:this.attributes.payloads.push({payloadType:parseInt(G,10),rtcpFeedbacks:[],fmtp:{parameters:Be}})}parseFmtParameters(O){const G={},ne=this.extract(O,this.consumeTill,"=");O._cur++;const Be=this.extract(O,this.consumeTill,";");for(G[ne]=Be;O.attValue[O._cur]===";";){const Lt=this.extract(O,this.consumeTill,"=");O._cur++;const yn=this.extract(O,this.consumeTill,";");G[Lt]=yn}return G}parseRtcpFb(O){let G="";G=this.peekChar(O)==="*"?this.extract(O,this.consume,"*"):this.extract(O,this.consumeTill,u),this.consumeAttributeSpace(O);const ne=this.extract(O,this.consumeTill,u);let Be;if(ne==="trr-int")Be={type:ne,interval:this.extract(O,this.consumeTill)};else{const Lt={type:ne};this.peekChar(O)===u&&(this.consumeAttributeSpace(O),Lt.parameter=this.extract(O,this.consumeToken),this.peekChar(O)===u&&(Lt.additional=this.extract(O,this.consumeTill))),Be=Lt}if(G==="*")this.attributes.rtcpFeedbackWildcards.push(Be);else{const Lt=this.attributes.payloads.find((yn=>yn.payloadType===parseInt(G,10)));Lt?Lt.rtcpFeedbacks.push(Be):this.attributes.payloads.push({payloadType:parseInt(G,10),rtcpFeedbacks:[Be]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(O){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const G={port:this.extract(O,this.consumePort)};this.peekChar(O)===u&&(this.consumeAttributeSpace(O),G.netType=this.extractOneOrMore(O,R),this.consumeAttributeSpace(O),G.addressType=this.extractOneOrMore(O,R),this.consumeAttributeSpace(O),G.address=this.extract(O,this.consumeAddress)),this.attributes.rtcp=G}parseMsid(O){const G={id:this.extractOneOrMore(O,R,[1,64])};this.peekChar(O)===u&&(this.consumeAttributeSpace(O),G.appdata=this.extractOneOrMore(O,R,[1,64])),this.attributes.msids.push(G)}parseImageAttr(O){this.attributes.imageattr.push(O.attValue)}parseRid(O){const G=this.extractOneOrMore(O,(Be=>A(Be)||m(Be)||Be==="_"||Be==="-"));this.consumeAttributeSpace(O);const ne={id:G,direction:this.extract(O,this.consumeToken),params:[]};if(this.peekChar(O)===u){if(this.consumeAttributeSpace(O),this.peek(O,"pt=")){this.extract(O,this.consume,"pt=");const Be=[];for(;;){const Lt=this.extract(O,this.consumeToken);Be.push(Lt);try{this.extract(O,this.consume,",")}catch{break}}ne.payloads=Be,this.peekChar(O)===u&&this.extract(O,this.consume,u)}for(;;){const Be=this.extract(O,this.consumeToken);switch(Be){case"depend":{const Lt={type:Be,rids:this.extract(O,this.consume,"=").split(",")};ne.params.push(Lt);break}default:{const Lt={type:Be};this.peekChar(O)==="="&&(this.extract(O,this.consume,"="),Lt.val=this.extract(O,this.consumeTill,";")),ne.params.push(Lt)}}try{this.extract(O,this.consume,";")}catch{break}}}this.attributes.rids.push(ne)}parseSimulcast(O){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=O.attValue,this.extract(O,this.consumeTill)}parseSctpPort(O){this.attributes.sctpPort=this.extractOneOrMore(O,m,[1,5])}parseMaxMessageSize(O){this.attributes.maxMessageSize=this.extractOneOrMore(O,m,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(O){this.attributes.mid=this.extract(O,this.consumeToken)}parseSSRCGroup(O){const G=this.extract(O,this.consumeToken),ne=[];for(;;)try{this.consumeAttributeSpace(O);const Be=this.extract(O,this.consumeInteger);ne.push(parseInt(Be,10))}catch{break}this.attributes.ssrcGroups.push({semantic:G,ssrcIds:ne})}}function Ct(M,O,G){return O in M?Object.defineProperty(M,O,{value:G,enumerable:!0,configurable:!0,writable:!0}):M[O]=G,M}class Ft{constructor(){Ct(this,"eol",d)}print(O,G){let ne="";return G&&(this.eol=G),ne+=this.printVersion(O.version),ne+=this.printOrigin(O.origin),ne+=this.printSessionName(O.sessionName),ne+=this.printInformation(O.information),ne+=this.printUri(O.uri),ne+=this.printEmail(O.emails),ne+=this.printPhone(O.phones),ne+=this.printConnection(O.connection),ne+=this.printBandwidth(O.bandwidths),ne+=this.printTimeFields(O.timeFields),ne+=this.printKey(O.key),ne+=this.printSessionAttributes(O.attributes),ne+=this.printMediaDescription(O.mediaDescriptions),ne}printVersion(O){return"v=".concat(O).concat(this.eol)}printOrigin(O){return"o=".concat(O.username," ").concat(O.sessId," ").concat(O.sessVersion," ").concat(O.nettype," ").concat(O.addrtype," ").concat(O.unicastAddress).concat(this.eol)}printSessionName(O){return O?"s=".concat(O).concat(this.eol):""}printInformation(O){return O?"i=".concat(O).concat(this.eol):""}printUri(O){return O?"u=".concat(O).concat(this.eol):""}printEmail(O){let G="";for(const ne of O)G+="e=".concat(ne).concat(this.eol);return G}printPhone(O){let G="";for(const ne of O)G+="e=".concat(ne).concat(this.eol);return G}printConnection(O){return O?"c=".concat(O.nettype," ").concat(O.addrtype," ").concat(O.address).concat(this.eol):""}printBandwidth(O){let G="";for(const ne of O)G+="b=".concat(ne.bwtype,":").concat(ne.bandwidth).concat(this.eol);return G}printTimeFields(O){let G="";for(const ne of O){G+="t=".concat(ne.time.startTime," ").concat(ne.time.startTime).concat(this.eol);for(const Be of ne.repeats)G+="r=".concat(Be.repeatInterval," ").concat(Be.typedTimes.join(" ")).concat(this.eol);ne.zoneAdjustments&&(G+="z=",G+="z=".concat(ne.zoneAdjustments.map((Be=>"".concat(Be.time," ").concat(Be.back?"-":""," ").concat(Be.typedTime))).join(" ")).concat(this.eol),G+=this.eol)}return G}printKey(O){return O?"k=".concat(O).concat(this.eol):""}printAttributes(O){let G="";for(const ne of O)G+="a=".concat(ne.attField).concat(ne.attValue?":".concat(ne.attValue):"").concat(this.eol);return G}printMediaDescription(O){let G="";for(const ne of O)G+=this.printMedia(ne.media),G+=this.printInformation(ne.information),G+=this.printConnections(ne.connections),G+=this.printBandwidth(ne.bandwidths),G+=this.printKey(ne.key),G+=this.printMediaAttributes(ne);return G}printConnections(O){let G="";for(const ne of O)G+=this.printConnection(ne);return G}printMedia(O){return"m=".concat(O.mediaType," ").concat(O.port," ").concat(O.protos.join("/")," ").concat(O.fmts.join(" ")).concat(this.eol)}printSessionAttributes(O){return new We(this.eol).print(O)}printMediaAttributes(O){return new Se(this.eol).print(O)}}class mn{constructor(O){Ct(this,"eol",void 0),this.eol=O}printIceUfrag(O){return O===void 0?"":"a=ice-ufrag:".concat(O).concat(this.eol)}printIcePwd(O){return O===void 0?"":"a=ice-pwd:".concat(O).concat(this.eol)}printIceOptions(O){return O===void 0?"":"a=ice-options:".concat(O.join(u)).concat(this.eol)}printFingerprints(O){return O.length>0?O.map((G=>"a=fingerprint:".concat(G.hashFunction).concat(u).concat(G.fingerprint))).join(this.eol)+this.eol:""}printExtmap(O){return O.map((G=>"a=extmap:".concat(G.entry).concat(G.direction?"/".concat(G.direction):"").concat(u).concat(G.extensionName).concat(G.extensionAttributes?"".concat(u).concat(G.extensionAttributes):"").concat(this.eol))).join("")}printSetup(O){return O===void 0?"":"a=setup:".concat(O).concat(this.eol)}printUnrecognized(O){return O.map((G=>"a=".concat(G.attField).concat(G.attValue?":".concat(G.attValue):"").concat(this.eol))).join("")}}class We extends mn{print(O){let G="";return G+=this.printGroups(O.groups),G+=this.printMsidSemantic(O.msidSemantic),G+=this.printIceLite(O.iceLite),G+=this.printIceUfrag(O.iceUfrag),G+=this.printIcePwd(O.icePwd),G+=this.printIceOptions(O.iceOptions),G+=this.printFingerprints(O.fingerprints),G+=this.printSetup(O.setup),G+=this.printTlsId(O.tlsId),G+=this.printIdentity(O.identities),G+=this.printExtmap(O.extmaps),G+=this.printUnrecognized(O.unrecognized),G}printGroups(O){let G="";return O.length>0&&(G+=O.map((ne=>"a=group:".concat(ne.semantic).concat(ne.identificationTag.map((Be=>"".concat(u).concat(Be))).join("")).concat(this.eol))).join("")),G}printIceLite(O){return O===void 0?"":"a=ice-lite"+this.eol}printTlsId(O){return O?"a=tls-id:".concat(O).concat(this.eol):""}printIdentity(O){return O.length===0?"":O.map((G=>"a=identity:".concat(G.assertionValue).concat(G.extensions.map((ne=>"".concat(u).concat(ne.name).concat(ne.value?"=".concat(ne.value):"")))))).join(this.eol)+this.eol}printMsidSemantic(O){if(!O)return"";let G="a=msid-semantic:".concat(O.semantic);return O.applyForAll?G+="".concat(u,"*"):O.identifierList.length>0&&(G+=O.identifierList.map((ne=>"".concat(u).concat(ne)))),G+this.eol}}class Se extends mn{print(O){const G=O.attributes;let ne="";return ne+=this.printRTCP(G.rtcp),ne+=this.printIceUfrag(G.iceUfrag),ne+=this.printIcePwd(G.icePwd),ne+=this.printIceOptions(G.iceOptions),ne+=this.printCandidates(G.candidates),ne+=this.printRemoteCandidatesList(G.remoteCandidatesList),ne+=this.printEndOfCandidates(G.endOfCandidates),ne+=this.printFingerprints(G.fingerprints),ne+=this.printSetup(G.setup),ne+=this.printMid(G.mid),ne+=this.printExtmap(G.extmaps),ne+=this.printRTPRelated(G),ne+=this.printPtime(G.ptime),ne+=this.printMaxPtime(G.maxPtime),ne+=this.printDirection(G.direction),ne+=this.printSSRCGroups(G.ssrcGroups),ne+=this.printSSRC(G.ssrcs),ne+=this.printRTCPMux(G.rtcpMux),ne+=this.printRTCPMuxOnly(G.rtcpMuxOnly),ne+=this.printRTCPRsize(G.rtcpRsize),ne+=this.printMSId(G.msids),ne+=this.printImageattr(G.imageattr),ne+=this.printRid(G.rids),ne+=this.printSimulcast(G.simulcast),ne+=this.printSCTPPort(G.sctpPort),ne+=this.printMaxMessageSize(G.maxMessageSize),ne+=this.printUnrecognized(G.unrecognized),ne}printCandidates(O){return O.map((G=>"a=candidate:".concat(G.foundation).concat(u).concat(G.componentId).concat(u).concat(G.transport).concat(u).concat(G.priority).concat(u).concat(G.connectionAddress).concat(u).concat(G.port).concat(u,"typ").concat(u).concat(G.type).concat(G.relAddr?"".concat(u,"raddr").concat(u).concat(G.relAddr):"").concat(G.relPort?"".concat(u,"rport").concat(u).concat(G.relPort):"").concat(Object.keys(G.extension).map((ne=>"".concat(u).concat(ne).concat(u).concat(G.extension[ne]))).join("")).concat(this.eol))).join("")}printRemoteCandidatesList(O){return O.map((G=>"a=remote-candidates:".concat(G.join(u)).concat(this.eol))).join("")}printEndOfCandidates(O){return O===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(O){if(!O.payloads)return"";const G=O.payloads;let ne="";ne+=O.rtcpFeedbackWildcards.map((Be=>this.printRTCPFeedback("*",Be))).join("");for(const Be of G)ne+=this.printRtpMap(Be.payloadType,Be.rtpMap),ne+=this.printFmtp(Be.payloadType,Be.fmtp),ne+=Be.rtcpFeedbacks.map((Lt=>this.printRTCPFeedback(Be.payloadType,Lt))).join("");return ne}printFmtp(O,G){if(!G)return"";const ne=Object.keys(G.parameters);return ne.length===1&&G.parameters[ne[0]]===null?"a=fmtp:".concat(O).concat(u).concat(ne[0]).concat(this.eol):"a=fmtp:".concat(O).concat(u).concat(Object.keys(G.parameters).map((Be=>"".concat(Be,"=").concat(G.parameters[Be]))).join(";")).concat(this.eol)}printRtpMap(O,G){return G?"a=rtpmap:".concat(O).concat(u).concat(G.encodingName,"/").concat(G.clockRate).concat(G.encodingParameters?"/".concat(G.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(O,G){let ne="a=rtcp-fb:".concat(O).concat(u),Be=G;return Be.type==="trr-int"?ne+="ttr-int".concat(u).concat(Be.interval):(ne+="".concat(Be.type),Be.parameter&&(ne+="".concat(u).concat(Be.parameter),Be.additional&&(ne+="".concat(u).concat(Be.additional)))),ne+this.eol}printPtime(O){return O===void 0?"":"a=ptime:".concat(O).concat(this.eol)}printMaxPtime(O){return O===void 0?"":"a=maxptime:".concat(O).concat(this.eol)}printDirection(O){return O===void 0?"":"a=".concat(O).concat(this.eol)}printSSRC(O){return O.map((G=>Object.keys(G.attributes).map((ne=>"a=ssrc:".concat(G.ssrcId.toString(10)).concat(u).concat(ne).concat(G.attributes[ne]?":".concat(G.attributes[ne]):"").concat(this.eol))).join(""))).join("")}printRTCPMux(O){return O===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(O){return O===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(O){return O===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(O){if(O===void 0)return"";let G="a=rtcp:".concat(O.port);return O.netType&&(G+="".concat(u).concat(O.netType)),O.addressType&&(G+="".concat(u).concat(O.addressType)),O.address&&(G+="".concat(u).concat(O.address)),G+this.eol}printMSId(O){return O.map((G=>"a=msid:".concat(G.id).concat(G.appdata?"".concat(u).concat(G.appdata):"").concat(this.eol))).join("")}printImageattr(O){return O.map((G=>"a=imageattr:".concat(G).concat(this.eol))).join("")}printRid(O){return O.map((G=>{let ne="a=rid:".concat(G.id).concat(u).concat(G.direction);return G.payloads&&(ne+="".concat(u,"pt=").concat(G.payloads.join(","))),G.params.length>0&&(ne+="".concat(u).concat(G.params.map((Be=>Be.type==="depend"?"depend=".concat(Be.rids.join(",")):"".concat(Be.type,"=").concat(Be.val))).join(";"))),ne+this.eol})).join("")}printSimulcast(O){return O===void 0?"":"a=simulcast:".concat(O).concat(this.eol)}printSCTPPort(O){return O===void 0?"":"a=sctp-port:".concat(O).concat(this.eol)}printMaxMessageSize(O){return O===void 0?"":"a=max-message-size:".concat(O).concat(this.eol)}printMid(O){return O===void 0?"":"a=mid:".concat(O).concat(this.eol)}printSSRCGroups(O){return O.map((G=>"a=ssrc-group:".concat(G.semantic).concat(G.ssrcIds.map((ne=>"".concat(u).concat(ne.toString(10)))).join("")).concat(this.eol))).join("")}}function we(M){return new ge().parse(M)}function be(M,O){return new Ft().print(M,O)}}},t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={exports:{}};return e[i](s,s.exports,n),s.exports}return n.d=(i,s)=>{for(var o in s)n.o(s,o)&&!n.o(i,o)&&Object.defineProperty(i,o,{enumerable:!0,get:s[o]})},n.o=(i,s)=>Object.prototype.hasOwnProperty.call(i,s),n.r=i=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},n(8)})();function Qo(e){return Wc.parse(e)}function Wg(e,t){return Wc.print(e,t)}var fz=to("Array","keys"),_z=fc,mz=bi,Ez=ee,ZU=fz,$U=Array.prototype,gz={DOMTokenList:!0,NodeList:!0},hl=function(e){var t=e.keys;return e===$U||Ez($U,e)&&t===$U.keys||mz(gz,_z(e))?ZU:t},Ii=S(hl);function Wr(e,t,n){return(t=(function(i){var s=(function(o,c){if(typeof o!="object"||!o)return o;var d=o[Symbol.toPrimitive];if(d!==void 0){var u=d.call(o,"string");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)})(i);return typeof s=="symbol"?s:s+""})(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function fn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function _n(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?fn(Object(n),!0).forEach((function(i){Wr(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fn(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}const d4=new class extends rr{constructor(){super(...arguments),Wr(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class ex{constructor(t){Wr(this,"logger",void 0),Wr(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function UD(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function wd(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?t?.[0]+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const pl={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Hg=Date.now(),V=e=>{for(const t in pl)if(Object.prototype.hasOwnProperty.call(pl,t)&&pl[t]===e)return t;return"DEFAULT"},F=new class{constructor(){Wr(this,"proxyServerURL",void 0),Wr(this,"logLevel",pl.DEBUG),Wr(this,"uploadState","collecting"),Wr(this,"uploadLogWaitingList",[]),Wr(this,"uploadLogUploadingList",[]),Wr(this,"uploadErrorCount",0),Wr(this,"currentLogID",0),Wr(this,"url",void 0),Wr(this,"extLog",((e,t)=>{this.appendLogToWaitingList(e,...t)}))}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[pl.DEBUG].concat(t);this.log.apply(this,i)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[pl.INFO].concat(t);this.log.apply(this,i)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[pl.WARNING].concat(t);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[pl.ERROR].concat(t);this.log.apply(this,i)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=[pl.DEBUG].concat(t);this.uploadLog.apply(this,i)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){te("UPLOAD_LOG",!0)}disableLogUpload(){te("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new ex(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-Hg<100)return void setTimeout((()=>{this.log(...t)}),Date.now()-Hg);const i=Math.max(0,Math.min(4,t[0]));if(t[0]=UD()+" Agora-SDK [".concat(V(i),"]:"),this.appendLogToWaitingList(i,...t),i<this.logLevel)return;const s=UD()+" %cAgora-SDK [".concat(V(i),"]:");let o=[];if(!re("USE_NEW_LOG"))switch(i){case pl.DEBUG:o=[s,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,o);break;case pl.INFO:o=[s,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,o);break;case pl.WARNING:o=[s,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,o);break;case pl.ERROR:o=[s,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,o)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-Hg<100)return void setTimeout((()=>{this.uploadLog(...t)}),Date.now()-Hg);const i=Math.max(0,Math.min(4,t[0]));t[0]=UD()+" Agora-SDK [".concat(V(i),"]:"),this.appendLogToWaitingList(i,...t)}appendLogToWaitingList(e){if(!re("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=wd()+" Agora-SDK [".concat(V(e),"]:"):n[0]=wd()+" Agora-SDK [".concat(V(e),"]:");let s="";n.forEach((o=>{typeof o=="object"&&(o=JSON.stringify(o)),s+="".concat(o," ")})),this.uploadLogWaitingList.push({payload_str:s,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:ql,process_id:re("PROCESS_ID"),payload:JSON.stringify(e)};return Id((async()=>{const n=await Gc.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(re("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(re("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const i=new Error("unexpected upload log response");throw i.response=n,i}}),(()=>(this.uploadLogUploadingList=[],!1)),(n=>{const i={status:-1,message:n.message,errorRange:e.map((s=>s.log_item_id))};return n.response?(i.status=n.response.status,i.data=n.response.data,i.headers=n.response.headers):n.request&&(i.status=n.request.status),d4.reportLogUploadError(i),!0}),{timeout:re("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:re("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,re("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then((()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout((()=>this.uploadLogInterval()),re("UPLOAD_LOG_INTERVAL"))})).catch((e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout((()=>this.uploadLogInterval()),re("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout((()=>this.uploadLogInterval()),re("UPLOAD_LOG_RETRY_INTERVAL_V1"))})))}};var u4;function Sz(e){return ls(e.reportId,"params.reportId",0,100,!1),ls(e.category,"params.category",0,100,!1),ls(e.event,"params.event",0,100,!1),ls(e.label,"params.label",0,100,!1),Mi(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(u4={}).FREE="free",u4.UPLOADING="uploading",(function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"})({});const so={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Nn=(function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e})({}),yr=(function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e})({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let Gt=(function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e})({});function Ye(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,i){const s=i.value;if(typeof s=="function"){const o=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);i.value=function(){for(var c,d=arguments.length,u=new Array(d),p=0;p<d;p++)u[p]=arguments[p];let m=u;if(e.argsMap)try{m=e.argsMap(this,...u)}catch(T){F.warning(T),m=[]}try{JSON.stringify(m)}catch{F.warning("arguments for method ".concat(o,".").concat(String(n)," not serializable for apiInvoke.")),m=[]}const g=(e.report||fe).reportApiInvoke(this._sessionId||null,{id:this._clientId||((c=this.store)===null||c===void 0?void 0:c.clientId)||this._ID,name:"".concat(o,".").concat(String(n)),options:m,tag:Tr.TRACER,reportResult:e.reportResult},e.throttleTime);try{const T=s.apply(this,u);return T instanceof De?T.then((R=>(g.onSuccess(e.reportResult&&R),R))).catch((R=>{throw g.onError(R),R})):(g.onSuccess(e.reportResult&&T),T)}catch(T){throw g.onError(T),T}}}return i}}const fe=new class{constructor(){Wr(this,"baseInfoMap",new Map),Wr(this,"proxyServer",void 0),Wr(this,"eventUploadTimer",void 0),Wr(this,"setSessionIdTimer",void 0),Wr(this,"url",void 0),Wr(this,"sids",new Set),Wr(this,"backupUrl",void 0),Wr(this,"_appId",void 0),Wr(this,"_aid",0),Wr(this,"keyEventUploadPendingItems",[]),Wr(this,"normalEventUploadPendingItems",[]),Wr(this,"apiInvokeUploadPendingItems",[]),Wr(this,"apiInvokeCount",0),Wr(this,"apiInvokeLoggedCount",0),Wr(this,"ltsList",[]),Wr(this,"lastSendNormalEventTime",Date.now()),Wr(this,"customReportCounterTimer",void 0),Wr(this,"customReportCount",0),Wr(this,"extApiInvoke",(async e=>{for(const t of e){const n=_n(_n({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Tr.TRACER});this.sendApiInvoke(n)}})),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),re("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),re("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,(t=>{let[n,i]=t;return n+i})),16)||0}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const i=Date.now();this.apiInvokeCount+=1;const s=this.apiInvokeCount,o=!!re("SHOW_REPORT_INVOKER_LOG"),c=!!re("SHOW_REPORT_USER_INVOKER_LOG"),d=o||c&&t.id;d&&(this.apiInvokeLoggedCount+=1);const u=this.apiInvokeLoggedCount;function p(R,I){if(d){let A="[apiInvoke-".concat(u,"]");if(t.id&&(A+="[".concat(t.id,"]")),t.name&&(A+="[".concat(t.name,"]"),t.name===Cn.JOIN))return F.info("".concat(A," ").concat(R));F.info("".concat(A," ").concat(R),R==="start"?t.options:I||"")}}const m=()=>({tag:t.tag,invokeId:s,sid:e,name:t.name,apiInvokeTime:i,options:t.options,states:t.states||null});p("start");let g=!1;In(t.timeout).then((()=>{g||(this.sendApiInvoke(_n(_n({},m()),{},{error:H.API_INVOKE_TIMEOUT,success:!1})),p("timeout"))}));const T=new Ge(H.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:R=>{const I=()=>{if(g)throw T;return g=!0,this.sendApiInvoke(_n(_n({},m()),{},{success:!0},t.reportResult&&{result:R})),p("onSuccess"),R};return n?KU(I,t.name+"Success",n,(()=>g=!0)):I()},onError:R=>{const I=()=>{if(g)throw R;g=!0,this.sendApiInvoke(_n(_n({},m()),{},{success:!1,error:R})),p("onFailure",R.toString())};return n?KU(I,t.name+"Error",n,(()=>g=!0)):I()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),i=this.createBaseInfo(e,n);i.cname=t.cname;const s=Object.assign({},{willUploadConsoleLog:re("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Um?"global":"oversea",areas:re("AREAS")&&re("AREAS").join(",")},t.extend),{stringUid:o,channelProfile:c,channelMode:d,isABTestSuccess:u,lsid:p,clientRole:m}=t,g=Date.now(),T=_n(_n({},i),{},{eventType:Nn.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:Nw,lts:g,elapse:g-n,extend:JSON.stringify(s),mode:t.mode,process:re("PROCESS_ID"),appType:re("APP_TYPE"),success:!0,version:ql,stringUid:o,channelProfile:c,channelMode:d,isABTestSuccess:u,lsid:p,clientType:Re(R=window.navigator.userAgent).call(R,"AgoraWebView")?42:20,clientRole:m,serviceId:re("PROCESS_ID"),extensionID:re("PLUGIN_INFO").join(",")||""});var R;this.send({type:yr.SESSION,data:T},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=_n(_n({},i),{},{role:t.role,eventType:Nn.JOIN_CHOOSE_SERVER,lts:s,eventElapse:t.elapse||s-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:s-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0,resourceTimingInfo:t.resourceTimingInfo||void 0});this.send({type:yr.JOIN_CHOOSE_SERVER,data:o},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=_n(_n({},i),{},{eventType:Nn.REQ_USER_ACCOUNT,lts:s,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||s-n.startTime,eventElapse:s-t.lts,extend:JSON.stringify(t.extend)});this.send({type:yr.REQ_USER_ACCOUNT,data:o},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info;t.vid&&(i.vid=t.vid),i.uid=t.uid,i.cid=t.cid;const s=Date.now(),{firstSuccess:o,addr:c,isProxy:d}=t,u=s-n.startTime,p=_n(_n({},i),{},{eventType:Nn.JOIN_GATEWAY,lts:s,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:u,eventElapse:s-t.lts,firstSuccess:o,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:Yl(),isABTestSuccess:t.isABTestSuccess?1:0}),m=p.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=s),o)this.send({type:yr.JOIN_GATEWAY,data:p},!0);else{let g;if(c)if(d){const R=c.match(/h=(\d{1,3}-){3}\d{1,3}/g),I=c.match(/p=[0-9]{1,6}/g);g={isSuccess:m,gatewayIp:R&&R.length?R[0].split("=")[1].replace(/-/g,"."):"",port:I&&I.length?I[0].split("=")[1]:"",isProxy:d?1:0}}else{const R=c.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),I=c.match(/(:|p=)[0-9]{1,6}/g);g={isSuccess:m,gatewayIp:R&&R.length?R[0].split("//")[1].replace(/-/g,"."):"",port:I&&I.length?I[0].split(/:|p=/g)[1]:"",isProxy:d?1:0}}else g={isSuccess:m,gatewayIp:"",port:"",isProxy:d?1:0};delete p.success,delete p.eventType,delete p.firstSuccess,p.vid=Number(p.vid);const T=Object.assign({},p,g,{eventType:Nn.REJOIN_GATEWAY});this.send({type:yr.RE_JOIN_GATEWAY,data:T},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=Date.now(),s=_n(_n({},n.info),{},{lts:i,timeout:t,elapse:i-n.startTime});this.send({type:yr.JOIN_CHANNEL_TIMEOUT,data:s},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=_n(_n({},i),{},{eventType:Nn.PUBLISH,lts:s,eventElapse:t.eventElapse,elapse:s-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:yr.PUBLISH,data:o},!0)}subscribe(e,t,n){const i=this.baseInfoMap.get(e);if(!i)return;const s=i.info,o=Date.now(),c=_n(_n({},s),{},{eventType:Nn.SUBSCRIBE,lts:o,eventElapse:t.eventElapse,elapse:o-i.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?c.peerSuid=t.peerid:c.peer=t.peerid,this.send({type:yr.SUBSCRIBE,data:c},!0)}wsCompressorInit(e){var t;const n=[...Ii(t=this.baseInfoMap).call(t)],i=n.length?n[0]:"UnableToGetSid",s=this.baseInfoMap.get(i);if(!s)return;const o=s.info,c=Date.now(),d=_n(_n({},o),{},{eventType:Nn.WS_COMPRESSOR_INIT,lts:c,eventElapse:e.eventElapse,elapse:c-s.startTime,status:e.status?1:2});this.send({type:yr.WS_COMPRESSOR_INIT,data:d},!0)}firstXLAPeerFirstVideoFrame(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=t.peerPubStatusMs-(n.lastJoinSuccessTime||s),c=_n(_n({},i),{},{elapse:s-n.startTime,eventType:Nn.XLA_PEER_FIRST_VIDEO_FRAME,lts:s,peer:t.peer,width:t.width,height:t.height,ssrc:t.ssrc,p2pid:t.p2pid,peerPublishDuration:t.peerPublishDuration,joinChannelSuccessElapse:o,peerPubStatusMs:t.peerPubStatusMs-t.joinChannelStart,availablePublish:t.peerPublishDuration>o?1:0,preloadStart:Math.max(t.preloadStart-t.joinChannelStart,0),preloadEnd:Math.max(t.preloadEnd-t.joinChannelStart,0),encrypt:Math.max(t.apStart-t.joinChannelStart,0),ap:Math.max(t.apEnd-t.joinChannelStart,0),sua:Math.max(t.suaEnd-t.joinChannelStart,0),beforeConnect:Math.max(t.beforeConnect-t.joinChannelStart,0),peerRecevier:Math.max(t.peerReceiver-t.joinChannelStart,0),ice:Math.max(t.ice-t.joinChannelStart,0),pc:Math.max(t.pc-t.joinChannelStart,0),signalConnected:Math.max(t.signalConnected-t.joinChannelStart,0),joinReq:Math.max(t.joinReq-t.joinChannelStart,0),joinRes:Math.max(t.joinRes-t.joinChannelStart,0),userJoinNotify:Math.max(t.userJoinNotify-t.joinChannelStart,0),videoSsrcNotify:Math.max(t.videoAddNotify-t.joinChannelStart,0),subscribeDelayMs:Math.max(t.subscribeStart-t.videoAddNotify,0),subscribeStart:Math.max(t.subscribeStart-t.joinChannelStart,0),subscribeEnd:Math.max(t.subscribeEnd-t.joinChannelStart,0),firstReceived:Math.max(t.firstReceived-t.joinChannelStart,0),firstDecoded:Math.max(t.firstDecoded-t.joinChannelStart,0),firstPreRender:Math.max(t.firstPreRender-t.joinChannelStart,0),firstRender:Math.max(t.firstRender-t.joinChannelStart,0),playDelayMs:Math.max(t.playStart-t.subscribeEnd,0),playStart:Math.max(t.playStart-t.joinChannelStart,0),playEnd:Math.max(t.playEnd-t.joinChannelStart,0),isPreSub:t.isPreSub?1:0,isPrePc:t.isPrePc?1:0,isPreInstantVideo:t.isPreInstantVideo?1:0});this.send({type:yr.XLA_PEER_FIRST_VIDEO_FRAME,data:c},!0)}firstRemoteVideoDecode(e,t,n,i){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),d=_n(_n(_n({},o),i),{},{elapse:c-s.startTime,eventType:t,lts:c,firstDecodeFrame:Math.max((i.firstFrame||c)-s.startTime,0),apEnd:Math.max(i.apEnd-s.startTime,0),apStart:Math.max(i.apStart-s.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-s.startTime,0),joinGwStart:Math.max(i.joinGwStart-s.startTime,0),pcEnd:Math.max(i.pcEnd-s.startTime,0),pcStart:Math.max(i.pcStart-s.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-s.startTime,0),subscriberStart:Math.max(i.subscriberStart-s.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-s.startTime,0)});this.send({type:n,data:d},!0)}firstRemoteFrame(e,t,n,i){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),d=_n(_n(_n({},o),i),{},{elapse:c-s.startTime,eventType:t,lts:c});this.send({type:n,data:d},!0)}abTest(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=_n(_n(_n({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:s-n.startTime,eventType:Nn.AB_TEST,lts:s});this.send({type:yr.AB_TEST,data:o},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=_n(_n(_n({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),elapse:s-n.startTime,eventType:Nn.PC_STATS,lts:s,preallocation:t.preallocation?1:0});this.send({type:yr.PC_STATS,data:o},!0)}updateRemoteRTPCapabilities(e,t){if(e){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=_n(_n(_n({},i),t),{},{vid:i.vid===void 0?0:Number(i.vid),eventType:Nn.UPDATE_REMOTE_RTPCAPABILITIES,lts:s});this.send({type:yr.UPDATE_REMOTE_RTPCAPABILITIES,data:o},!0)}}onGatewayStream(e,t,n,i){const s=this.baseInfoMap.get(e);if(!s)return;const o=s.info,c=Date.now(),d=_n(_n(_n({},o),i),{},{eventType:t,lts:c});this.send({type:n,data:d},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=_n(_n({},i),{},{eventType:Nn.STREAM_SWITCH,lts:s,isDual:t.isdual,elapse:s-n.startTime,success:t.succ});this.send({type:yr.STREAM_SWITCH,data:o},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=_n(_n({},i),{},{eventType:Nn.REQUEST_PROXY_APPCENTER,lts:s,eventElapse:s-t.lts,elapse:s-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:yr.REQUEST_PROXY_APPCENTER,data:o},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=_n(_n({},i),{},{eventType:Nn.REQUEST_PROXY_WORKER_MANAGER,lts:s,eventElapse:s-t.lts,elapse:s-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:yr.REQUEST_PROXY_WORKER_MANAGER,data:o},!0)}setProxyServer(e){this.proxyServer=e,e?F.debug("reportProxyServerurl: ".concat(e)):F.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=_n(_n({},i),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:s,elapse:s-n.startTime,joinChannelSuccessElapse:s-(n.lastJoinSuccessTime||s),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:yr.PEER_PUBLISH_STATUS,data:o},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now();(function(o,c,d){const u=o[c];if(!u||typeof u!="string")return[o];o[c]="";const p=Qp(JSON.stringify(o));let m=0;const g=[];let T=0;for(let R=0;R<u.length;R++)T+=u.charCodeAt(R)<=127?1:3,T<=d-p||(g[g.length]=z(z({},o),{},{[c]:u.substring(m,R)}),m=R,T=u.charCodeAt(R)<=127?1:3);return m!==u.length-1&&(g[g.length]=z(z({},o),{},{[c]:u.substring(m)})),g})(_n(_n(_n({},i),t),{},{elapse:s-n.startTime,lts:s,productType:"WebRTC"}),"payload",1300).forEach((o=>this.send({type:yr.WORKER_EVENT,data:o},!0)))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=_n(_n(_n({},i),t),{},{elapse:s-n.startTime,lts:s});this.send({type:yr.AP_WORKER_EVENT,data:o},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=_n(_n(_n({},i),t),{},{elapse:s-n.startTime,lts:s,extend:t.extend||void 0});this.send({type:yr.JOIN_WEB_PROXY_AP,data:o},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const i=n.info,s=Date.now(),o=_n(_n(_n({},i),t),{},{elapse:s-n.startTime,lts:s});this.send({type:yr.WEBSOCKET_QUIT,data:o},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>re("CUSTOM_REPORT_LIMIT"))throw new Ge(H.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval((()=>{this.customReportCount=0}),5e3));const n=Date.now(),i=t.map((s=>({type:yr.USER_ANALYTICS,data:_n(_n({sid:e},s),{},{lts:n})})));try{re("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(s){throw F.error("send custom report message failed",s.toString()),new Ge(H.CUSTOM_REPORT_SEND_FAILED,s.message)}}sendApiInvoke(e){const t=re("NOT_REPORT_EVENT");if(e.tag&&Re(t)&&Re(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:i,uid:s,cid:o}=n.info;let c;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Ge){const{code:u,message:p}=e.error;c=u||p||e.error.toString()}else c=e.error.toString();const d={invokeId:e.invokeId,sid:e.sid,cname:i,cid:o,uid:s,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?c:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:yr.API_INVOKE,data:d},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const t=Array.from(this.sids).find((n=>n!==null));t&&e.forEach((n=>{n&&(n.sid=t,this.sendApiInvoke(Object.assign({},n)))})),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>re("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],i=[];for(;e.length;){const o=e.shift();n.length<20?n.push(o):i.push(o)}e.push(...i);for(const o of[...n]){var s;this.ltsList.indexOf(o.data.lts)!==-1?(o.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(o.data.lts)):(this.ltsList.push(o.data.lts),Zt(s=this.ltsList).call(s,((c,d)=>c-d)))}return t||(this.lastSendNormalEventTime=Date.now()),re("ENABLE_EVENT_REPORT")&&n.length&&(re("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((o=>c=>{re("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(o):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(o),this.normalEventUploadPendingItems.length>re("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-re("NORMAL_EVENT_QUEUE_CAPACITY")),F.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){$r.networkState===ja.OFFLINE&&await De.race([$r.onlineWaiter,In(2*Es.maxRetryTimeout)]);const t=s=>{let o=new Uint8Array;return s.forEach((c=>{const d=ID(JSON.stringify(c.data)),u=new ArrayBuffer(5),p=(g=>{let T=0;return Object.entries(yr).forEach((R=>{let[I,A]=R;A===g.type&&(T=Gt[I])})),T})(c),m=new DataView(u);m.setUint16(0,d.byteLength,!0),m.setUint8(2,255&p),m.setUint8(3,p>>>8&255),m.setUint8(4,p>>>16&255),o=AD(o,new Uint8Array(u)),o=AD(o,d)})),o},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(re("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let s=0;s<2;s+=1){s===1&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(re("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await zU(i,{timeout:1e4,data:t(e),headers:_n(_n({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(o){if(s===1)throw o;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=(d=>{const u=d&&d.data.sid&&this.baseInfoMap.get(d.data.sid);return u&&u.info.vid&&+u.info.vid||0})(e[0]),i=n?void 0:this._aid,s={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map((d=>JSON.stringify(d))),vid:n,aid:i};$r.networkState===ja.OFFLINE&&await De.race([$r.onlineWaiter,In(2*Es.maxRetryTimeout)]);const o=t?"/events/proto-raws":"/events/messages";let c=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("EVENT_REPORT_DOMAIN"),"&p=").concat(re("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(re("EVENT_REPORT_DOMAIN"),":").concat(re("STATS_COLLECTOR_PORT")).concat(o));for(let d=0;d<2;d+=1){d===1&&(c=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(re("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(re("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(re("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(re("STATS_COLLECTOR_PORT")).concat(o)));try{t?await s4(c,{timeout:1e4,data:s}):await zU(c,{timeout:1e4,data:s})}catch(u){if(d===1)throw u;continue}return}}createBaseInfo(e,t){const n=Object.assign({},so);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),i=n[n.length-1];i&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:i,tag:Tr.TRACER}).onSuccess()}};d4.on("REPORT_LOG_UPLOAD",(e=>{e.networkState=$r.networkState,fe.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Tr.TRACER}).onSuccess("logUploadError")}));class Pe extends Ge{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Wr(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,F)}throw(){super.throw(F)}}const on={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function ai(){return on}function Dw(){return"setSinkId"in HTMLAudioElement.prototype&&(!re("RESTRICTION_SET_PLAYBACK_DEVICE")||(ms()||jr())&&!Xp())}function RC(){return!on.supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&_h()}function xD(e){return!(fi()||gD(87)||RC()||!re("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||re("FORCE_DISABLE_AUTO_SUB")))}function Po(e){return!!re("ENABLE_INSTANT_VIDEO")||!(e==null||!e.autoSubscribe||re("FORCE_DISABLE_AUTO_SUB"))}let js=(function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e})({});function Wn(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function An(e,t,n,i,s){return{width:e,height:t,frameRate:n,bitrateMin:i,bitrateMax:s}}function Od(e,t,n,i,s){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:i,bitrateMax:s}}function tx(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}const Tz={"90p":An(160,90),"90p_1":An(160,90),"120p":An(160,120,15,30,65),"120p_1":An(160,120,15,30,65),"120p_3":An(120,120,15,30,50),"120p_4":An(212,120),"180p":An(320,180,15,30,140),"180p_1":An(320,180,15,30,140),"180p_3":An(180,180,15,30,100),"180p_4":An(240,180,15,30,120),"240p":An(320,240,15,40,200),"240p_1":An(320,240,15,40,200),"240p_3":An(240,240,15,40,140),"240p_4":An(424,240,15,40,220),"360p":An(640,360,15,80,400),"360p_1":An(640,360,15,80,400),"360p_3":An(360,360,15,80,260),"360p_4":An(640,360,30,80,600),"360p_6":An(360,360,30,80,400),"360p_7":An(480,360,15,80,320),"360p_8":An(480,360,30,80,490),"360p_9":An(640,360,15,80,800),"360p_10":An(640,360,24,80,800),"360p_11":An(640,360,24,80,1e3),"480p":An(640,480,15,100,500),"480p_1":An(640,480,15,100,500),"480p_2":An(640,480,30,100,1e3),"480p_3":An(480,480,15,100,400),"480p_4":An(640,480,30,100,750),"480p_6":An(480,480,30,100,600),"480p_8":An(848,480,15,100,610),"480p_9":An(848,480,30,100,930),"480p_10":An(640,480,10,100,400),"720p":An(1280,720,15,120,1130),"720p_auto":An(1280,720,30,900,3e3),"720p_1":An(1280,720,15,120,1130),"720p_2":An(1280,720,30,120,2e3),"720p_3":An(1280,720,30,120,1710),"720p_5":An(960,720,15,120,910),"720p_6":An(960,720,30,120,1380),"1080p":An(1920,1080,15,120,2080),"1080p_1":An(1920,1080,15,120,2080),"1080p_2":An(1920,1080,30,120,3e3),"1080p_3":An(1920,1080,30,120,3150),"1080p_5":An(1920,1080,60,120,4780),"1440p":An(2560,1440,30,120,4850),"1440p_1":An(2560,1440,30,120,4850),"1440p_2":An(2560,1440,60,120,7350),"4k":An(3840,2160,30,120,8910),"4k_1":An(3840,2160,30,120,8910),"4k_3":An(3840,2160,60,120,13500)},vz={"480p":Od(640,480,5),"480p_1":Od(640,480,5),"480p_2":Od(640,480,30),"480p_3":Od(640,480,15),"720p":Od(1280,720,5),"720p_auto":An(1280,720,30,900,3e3),"720p_1":Od(1280,720,5),"720p_2":Od(1280,720,30),"720p_3":Od(1280,720,15),"1080p":Od(1920,1080,5),"1080p_1":Od(1920,1080,5),"1080p_2":Od(1920,1080,30),"1080p_3":Od(1920,1080,15)},gh={"1SL1TL":tx(1,1),"3SL3TL":tx(3,3),"2SL3TL":tx(2,3)};function Nd(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},Tz[e]):e}function CC(e){return typeof e=="string"?Object.assign({},vz[e]):e}function VD(e){return typeof e=="string"?Object.assign({},gh[e]):e}const FD={speech_low_quality:Wn(16e3,!1),speech_standard:Wn(32e3,!1,18),music_standard:Wn(48e3,!1),standard_stereo:Wn(48e3,!0,56),high_quality:Wn(48e3,!1,128),high_quality_stereo:Wn(48e3,!0,192)};function xm(e){return typeof e=="string"?Object.assign({},FD[e]):e}const yv=[];function It(e){return Tn(e,"mediaSource",["screen","window","application"]),!0}let rt=(function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e})({}),Ni=(function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e})({}),bC=(function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e})({}),yz=(function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e})({}),Rv=(function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e})({}),Sh=(function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e})({}),Tc=(function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e})({}),vc=(function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e})({}),rc=(function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e})({}),fl=(function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e})({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const Pw={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},BD={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},h4={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},p4={uplinkNetworkQuality:0,downlinkNetworkQuality:0},sc={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let ds=(function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e})({}),yc=(function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e})({}),Zp=(function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e})({}),qs=(function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e})({}),gs=(function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e})({}),Th=(function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e})({});const IC={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let Hn=(function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e})({});function Ce(e,t,n,i,s){var o,c,d={};return Object.keys(i).forEach((function(u){d[u]=i[u]})),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=Ks(o=zS(c=n.slice()).call(c)).call(o,(function(u,p){return p(e,t,u)||u}),d),s&&d.initializer!==void 0&&(d.value=d.initializer?d.initializer.call(s):void 0,d.initializer=void 0),d.initializer===void 0?(Object.defineProperty(e,t,d),null):d}function Le(e,t,n){return(t=(function(i){var s=(function(o,c){if(typeof o!="object"||!o)return o;var d=o[Symbol.toPrimitive];if(d!==void 0){var u=d.call(o,"string");if(typeof u!="object")return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)})(i);return typeof s=="symbol"?s:s+""})(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Xi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function Ji(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Xi(Object(n),!0).forEach((function(i){Le(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xi(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}class Cv extends rr{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(Sh.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,n){super(),Le(this,"trackMediaType",void 0),Le(this,"_ID",void 0),Le(this,"_rtpTransceiver",void 0),Le(this,"_lowRtpTransceiver",void 0),Le(this,"_hints",[]),Le(this,"_isClosed",!1),Le(this,"_originMediaStreamTrack",void 0),Le(this,"mediaStreamTrack",void 0),Le(this,"_external",{}),this._ID=n||Oi(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,(function(i){Re(yv).call(yv,i)||yv.push(i)})(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Cd((()=>{var n;fe.reportApiInvoke(null,{name:Cn.GET_MEDIA_STREAM_TRACK,options:[],tag:Tr.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")}),this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===bC.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,(function(t){const n=yv.indexOf(t);n!==-1&&yv.splice(n,1)})(this),this.emit(Tc.CLOSED),this.removeAllListeners(Sh.SEI_RECEIVED)}_updateRtpTransceiver(t,n){if(n===bC.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Sh.TRANSCEIVER_UPDATED,t,n)}}class bv extends Cv{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,n){super(t,n),Le(this,"_enabled",!0),Le(this,"_muted",!1),Le(this,"_isExternalTrack",!1),Le(this,"_isClosed",!1),Le(this,"_enabledMutex",void 0),Le(this,"processor",void 0),Le(this,"_processorContext",void 0),Le(this,"_handleTrackEnded",(()=>{this.onTrackEnded()})),this._enabledMutex=new ro("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,F.debug("[".concat(this.getTrackId(),"] close")),this.emit(rt.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=i,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ei(this,rt.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){F.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Tc.TRACK_ENDED)}stateCheck(t,n){if(F.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),gr(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new Ge(H.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",F);if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new Ge(H.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",F)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():De.resolve([])}}const Xl=window.AudioContext||window.webkitAudioContext;let Yn=null;const Ai=new class extends rr{constructor(){super(...arguments),Le(this,"prevState",void 0),Le(this,"curState",void 0),Le(this,"currentTime",void 0),Le(this,"currentTimeStuckAt",void 0),Le(this,"interruptDetectorTrack",void 0),Le(this,"onLocalAudioTrackMute",(()=>{F.info("ios15-interruption-start"),this.emit(js.IOS_15_16_INTERRUPTION_START)})),Le(this,"onLocalAudioTrackUnmute",(async()=>{F.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?F.info("ios15-interruption-end-canceled"):(Yn&&await Yn.suspend(),this.emit(js.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){F.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){F.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function vh(){if(!Yn){if((function(){if(!Xl)return void F.error("your browser is not support web audio");F.info("create audio context");const e=Ji({},re("WEBAUDIO_INIT_OPTIONS"));F.debug("audio context init option:",JSON.stringify(e)),Yn=new Xl(e),Ai.curState=Yn.state,Yn.onstatechange=()=>{Ai.prevState=Ai.curState,Ai.curState=Yn?Yn.state:void 0;const{prevState:t,curState:n}=Ai,i=n==="running",s=n==="interrupted",o=t==="running",c=t==="suspended",d=t==="interrupted",u=$n().osVersion;(mo()||Su())&&o&&s&&(F.info("ios".concat(u,"-interruption-start")),Ai.emit(js.IOS_INTERRUPTION_START)),(mo()||Su())&&(c||d)&&i&&(F.info("ios".concat(u,"-interruption-end")),Ai.emit(js.IOS_INTERRUPTION_END)),t!==n&&Ai.emit(js.STATE_CHANGE,n,t)},setInterval((()=>{var t;const n=(t=Yn)===null||t===void 0?void 0:t.currentTime;Ai.currentTime!==n?(Ai.currentTimeStuckAt&&(F.debug("AudioContext current time resume at ".concat(n)),Ai.currentTimeStuckAt=void 0),Ai.currentTime=n):(n!==Ai.currentTimeStuckAt&&(fe.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:Tr.TRACER}).onSuccess(),F.warning("AudioContext current time stuck at ".concat(n))),Ai.currentTimeStuckAt=n)}),5e3),(async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let i,s=!1,o=!1,c=!1;function d(A){t.state==="running"?u(!1):mo()||Su()?t.state==="suspended"&&(u(!0),A&&t.resume().then(p,p)):t.state!=="closed"&&(u(!0),A&&t.resume().then(p,p))}function u(A){if(s!==A){s=A;for(let w=0,k=n;w<k.length;w+=1){const L=k[w];A?window.addEventListener(L,m,{capture:!0,passive:!0}):window.removeEventListener(L,m,{capture:!0,passive:!0})}}}function p(){d(!1)}function m(){d(!0)}function g(A){if(!c)if(i.paused)if(A){let w;T(!1),c=!0;try{w=i.play(),w?w.then(R,R):(i.addEventListener("playing",R),i.addEventListener("abort",R),i.addEventListener("error",R))}catch{R()}}else T(!0);else T(!1)}function T(A){if(o!==A){o=A;for(let w=0,k=n;w<k.length;w++){const L=k[w];A?window.addEventListener(L,I,{capture:!0,passive:!0}):window.removeEventListener(L,I,{capture:!0,passive:!0})}}}function R(){i.removeEventListener("playing",R),i.removeEventListener("abort",R),i.removeEventListener("error",R),c=!1,g(!1)}function I(){g(!0)}if(mo()){const A=t.createMediaStreamDestination(),w=document.createElement("div");w.innerHTML="<audio x-webkit-airplay='deny'></audio>",i=w.children.item(0),i.controls=!1,i.disableRemotePlayback=!0,i.preload="auto",i.srcObject=A.stream,g(!0)}Ai.on(js.STATE_CHANGE,(function(){d(!0)})),d(!1)})(Yn)})(),!Yn)throw new Ge(H.NOT_SUPPORTED,"can not create audio context");return Yn}return Yn}function Vm(e){if((function(){if(kw!==null)return kw;const i=vh(),s=i.createBufferSource(),o=i.createGain(),c=i.createGain();s.connect(o),s.connect(c),s.disconnect(o);let d=!1;try{s.disconnect(o)}catch{d=!0}return s.disconnect(),kw=d,d})())return;const t=e.connect,n=e.disconnect;e.connect=(i,s,o)=>{var c;return e._inputNodes||(e._inputNodes=[]),Re(c=e._inputNodes).call(c,i)||(i instanceof AudioNode?(e._inputNodes.push(i),t.call(e,i,s,o)):t.call(e,i,s)),e},e.disconnect=(i,s,o)=>{n.call(e),i?Pm(e._inputNodes,i):e._inputNodes=[];for(const c of e._inputNodes)t.call(e,c)}}let kw=null;function jD(e,t){let n=!1;const i=1/t;if(re("DISABLE_WEBAUDIO")){const s=window.setInterval((()=>{n?window.clearInterval(s):e(performance.now()/1e3)}),1e3*i)}else{const s=vh();let o=s.createGain();o.gain.value=0,o.connect(s.destination);const c=()=>{if(n)return void(o=null);const d=s.createOscillator();d.onended=c,d.connect(o),d.start(0),d.stop(s.currentTime+i),e(s.currentTime)};c()}return()=>{n=!0}}class nx{constructor(){Le(this,"context",void 0),Le(this,"analyserNode",void 0),Le(this,"sourceNode",void 0),this.context=vh(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||mo()||Su()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const i=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(i);for(let s=0;s<t.length;++s)t[s]=i[s]/128-1}const n=Ks(t).call(t,((i,s)=>i+s*s),0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{F.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class ix extends rr{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var i;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Le(this,"outputNode",void 0),Le(this,"outputTrack",void 0),Le(this,"isPlayed",!1),Le(this,"sourceNode",void 0),Le(this,"context",void 0),Le(this,"audioBufferNode",void 0),Le(this,"destNode",void 0),Le(this,"audioOutputLevel",0),Le(this,"volumeLevelAnalyser",void 0),Le(this,"_processedNode",void 0),Le(this,"playNode",void 0),Le(this,"isDestroyed",!1),Le(this,"onNoAudioInput",void 0),Le(this,"isNoAudioInput",!1),Le(this,"_noAudioInputCount",0),this.context=vh(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Vm(this.outputNode),this.volumeLevelAnalyser=new nx}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(fl.ON_AUDIO_BUFFER,(function(i){for(let s=0;s<i.outputBuffer.numberOfChannels;s+=1){const o=i.outputBuffer.getChannelData(s);for(let c=0;c<o.length;c+=1)o[c]=0}return i.inputBuffer})(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!ai().webAudioMediaStreamDest)throw new Ge(H.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&sr((()=>{Ai.emit("autoplay-failed")})),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;mo()||Su()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let i;n.getFloatTimeDomainData?(i=new Float32Array(n.fftSize),n.getFloatTimeDomainData(i)):(i=new Uint8Array(n.fftSize),n.getByteTimeDomainData(i));let s=!1;for(let o=0;o<i.length;o++)i[o]!==0&&(s=!0);return s?(this.isNoAudioInput=!1,!0):(await In(200),await this.checkHasAudioInput(t?t+1:1)&&s)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class rx extends ix{get isFreeze(){return!1}constructor(t,n,i){var s;if(super(),Le(this,"sourceNode",void 0),Le(this,"track",void 0),Le(this,"clonedTrack",void 0),Le(this,"audioElement",void 0),Le(this,"isCurrentTrackCloned",!1),Le(this,"isRemoteTrack",!1),Le(this,"originVolumeLevelAnalyser",void 0),Le(this,"rebuildWebAudio",(async()=>{if(F.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void F.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then((()=>F.info("resume success"))),F.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const d=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?d.stop():this.isCurrentTrackCloned=!0;const u=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(u),Vm(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const p=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(p,this.context.currentTime),Vm(this.outputNode),this.emit(fl.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=u,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()})),t.kind!=="audio")throw new Ge(H.UNEXPECTED_ERROR);this.track=t;const o=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(o),Vm(this.sourceNode),i){const d=i.clone();d.enabled=!0,this.clonedTrack=d,F.debug("create an unmuted track ".concat(d.id," from the original track ").concat(i.id," to get the volume"));const u=this.context.createMediaStreamSource(new MediaStream([d]));Vm(u),this.originVolumeLevelAnalyser=new nx,this.originVolumeLevelAnalyser.updateSource(u)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=o;const c=$n();n&&c.os===sn.IOS&&Number((s=c.osVersion)===null||s===void 0?void 0:s.split(".")[0])<15&&(Ai.on(js.STATE_CHANGE,(()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()})),this.checkHasAudioInput().then((d=>{d||document.body.addEventListener("click",this.rebuildWebAudio,!0)})))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),Vm(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(fl.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Ai.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),F.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const i=this.context.createMediaStreamSource(new MediaStream([n]));Vm(i),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(i)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function f4(e,t,n){const i=(o,c)=>o?typeof o!="number"?o.max||o.exact||o.ideal||o.min||c:o:c,s={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:i(t.height,1080),maxWidth:i(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(s.video.mandatory.maxFrameRate=t.frameRate.max,s.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(s.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(s)}async function _4(e,t){const n=await GD(e.mediaSource),{sourceId:i,audio:s}=await(function(o){let c=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new De(((d,u)=>{const p=document.createElement("div");p.innerText="share screen",p.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const m=document.createElement("div");m.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const g=document.createElement("div");g.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",g.setAttribute("style","height: 12%;");const T=document.createElement("div");T.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const R=document.createElement("div");R.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const I=document.createElement("button");I.innerHTML="cancel",I.setAttribute("style","width: 85px;"),I.onclick=()=>{document.body.removeChild(k);const L=new Error("NotAllowedError");L.name="NotAllowedError",u(L)};let A=c;const w=document.createElement("div");if(c){const L=document.createElement("input");L.setAttribute("type","checkbox");const j=document.createElement("span");L.setAttribute("style","margin-right: 6px;"),j.innerText="Share audio",L.checked=A,L.onchange=()=>{A=L.checked},w.appendChild(L),w.appendChild(j)}R.appendChild(w),R.appendChild(I),m.appendChild(g),m.appendChild(T),m.appendChild(R);const k=document.createElement("div");k.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),k.appendChild(p),k.appendChild(m),document.body.appendChild(k),o.map((L=>{if(L.id){const j=document.createElement("div");j.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let K=L.thumbnail;try{const{width:W}=K.getSize();W>1920&&(K=K.resize({width:1920}))}catch(W){throw W&&W.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),W}j.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+K.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+L.name.replace(/[\u00A0-\u9999<>\&]/g,(function(W){return"&#"+W.charCodeAt(0)+";"}))+"</span>",j.onclick=()=>{document.body.removeChild(k),d({sourceId:L.id,audio:A})},T.appendChild(j)}}))}))})(n,t);return await f4(i,e,s)}async function GD(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=Zr();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new Ge(H.ELECTRON_IS_NULL);let i=null;try{var s;i=((s=n.desktopCapturer)===null||s===void 0?void 0:s.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{i=null}i&&i.then||(i=new De(((o,c)=>{n.desktopCapturer.getSources({types:t},((d,u)=>{d?c(d):o(u)}))})));try{return await i}catch(o){throw new Ge(H.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,o.toString())}}const WD=new ro("safari");let sx=!1,Jl=!1;async function Dd(e,t){let n=0,i=null;for(;n<2;)try{i=await HD(e,t,n>0);break}catch(s){if(s instanceof Ge)throw F.error("[".concat(t,"] ").concat(s.toString())),s;const o=Fm(s.name||s.code||s,s.message);if(o.code===H.MEDIA_OPTION_INVALID){F.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await In(500);continue}throw F.error("[".concat(t,"] ").concat(o.toString())),o}if(!i)throw new Ge(H.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function HD(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Ge(H.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const i=ai(),s=new MediaStream;if(e.audioSource&&s.addTrack(e.audioSource),e.videoSource&&s.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return F.debug("Using Video Source/ Audio Source"),s;if(e.screen)if(Zr())e.screen.sourceId?oc(s,await f4(e.screen.sourceId,e.screen,!!e.screenAudio)):oc(s,await _4(e.screen,!!e.screenAudio));else if(ms()&&e.screen.extensionId&&e.screen.mandatory){if(!i.getStreamFromExtension)throw new Ge(H.NOT_SUPPORTED,"This browser does not support screen sharing");F.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const T=await(c=e.screen.extensionId,d=t,new De(((R,I)=>{try{chrome.runtime.sendMessage(c,{getStream:!0},(A=>{if(!A||!A.streamId)return F.error("[".concat(d,"] No response from Chrome Plugin. Plugin not installed properly"),A),void I(new Ge(H.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));R(A.streamId)}))}catch(A){F.error("[".concat(d,"] AgoraRTC screensharing plugin is not accessible(").concat(c,")"),A.toString()),I(new Ge(H.CHROME_PLUGIN_NOT_INSTALL))}})));e.screen.mandatory.chromeMediaSourceId=T,oc(s,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(i.getDisplayMedia){var o;e.screen.mediaSource&&It(e.screen.mediaSource);const T={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(o=e.screen.displaySurface)!==null&&o!==void 0?o:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:R,surfaceSwitching:I,systemAudio:A,preferCurrentTab:w}=e.screen,k={selfBrowserSurface:R,surfaceSwitching:I,systemAudio:A,preferCurrentTab:w};!R&&delete k.selfBrowserSurface,!I&&delete k.surfaceSwitching,!A&&delete k.systemAudio,!w&&delete k.preferCurrentTab,F.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:T,audio:e.screenAudio,controls:k})),oc(s,await navigator.mediaDevices.getDisplayMedia(Ji({video:T,audio:e.screenAudio},k)))}else{if(!fi())throw F.error("[".concat(t,"] This browser does not support screenSharing")),new Ge(H.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&It(e.screen.mediaSource);const T={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};F.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(T))),oc(s,await navigator.mediaDevices.getUserMedia(T))}}var c,d;if(!e.video&&!e.audio)return s;let u={video:e.video,audio:e.audio},p=re("MEDIA_DEVICE_CONSTRAINTS");if(p)try{typeof p=="string"&&(p=JSON.parse(p)),u=ND(u,p)}catch{}F.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(u)),$n();let m,g=null;(Xo()||mo()||fh())&&(g=await WD.lock());try{m=await navigator.mediaDevices.getUserMedia(u)}catch(T){throw g&&g(),T}return u.audio&&(sx=!0),u.video&&(Jl=!0),oc(s,m),g&&g(),s}function Fm(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Ge(H.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new Ge(H.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new Ge(H.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new Ge(H.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Ge(H.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new Ge(H.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return F.error("getUserMedia unexpected error",e),new Ge(H.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function oc(e,t){const n=e.getVideoTracks()[0],i=e.getAudioTracks()[0],s=t.getVideoTracks()[0],o=t.getAudioTracks()[0];o&&(i&&e.removeTrack(i),e.addTrack(o)),s&&(n&&e.removeTrack(n),e.addTrack(s))}const _l=new class extends rr{get state(){return this._state}set state(e){e!==this._state&&(this.emit(qs.STATE_CHANGE,e),this._state=e)}constructor(){super(),Le(this,"_state",Zp.IDLE),Le(this,"isAccessMicrophonePermission",!1),Le(this,"isAccessCameraPermission",!1),Le(this,"lastAccessMicrophonePermission",!1),Le(this,"lastAccessCameraPermission",!1),Le(this,"checkdeviceMatched",!1),Le(this,"deviceInfoMap",new Map),this.init().then((()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval((()=>{(re("ENUMERATE_DEVICES_INTERVAL")||(Fg()||Sw()===sn.HARMONY_OS)&&_h())&&this.updateDevicesInfo()}),re("ENUMERATE_DEVICES_INTERVAL_TIME"))})).catch((e=>F.error(e.toString())))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Ge(H.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),s=this.checkMediaDeviceInfoIsOk(i);let o=!this.isAccessMicrophonePermission&&e,c=!this.isAccessCameraPermission&&t;s.audio&&(o=!1),s.video&&(c=!1);let d=null,u=null,p=null;if(!n&&(o||c)){if(WD.isLocked&&(F.debug("[device manager] wait GUM lock"),(await WD.lock())(),F.debug("[device manager] GUM unlock")),sx&&(o=!1,this.isAccessMicrophonePermission=!0),Jl&&(c=!1,this.isAccessCameraPermission=!0),F.debug("[device manager] check media device permissions",e,t,o,c),o&&c){try{p=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(m){const g=Fm(m.name||m.code||m,m.message);if(g.code===H.PERMISSION_DENIED)throw g;F.warning("getUserMedia failed in getDevices",g)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(o){try{d=await navigator.mediaDevices.getUserMedia({audio:e})}catch(m){const g=Fm(m.name||m.code||m,m.message);if(g.code===H.PERMISSION_DENIED)throw g;F.warning("getUserMedia failed in getDevices",g)}this.isAccessMicrophonePermission=!0}else if(c){try{u=await navigator.mediaDevices.getUserMedia({video:t})}catch(m){const g=Fm(m.name||m.code||m,m.message);if(g.code===H.PERMISSION_DENIED)throw g;F.warning("getUserMedia failed in getDevices",g)}this.isAccessCameraPermission=!0}F.debug("[device manager] mic permission",e,"cam permission",t)}try{const m=await navigator.mediaDevices.enumerateDevices();return d&&d.getTracks().forEach((g=>g.stop())),u&&u.getTracks().forEach((g=>g.stop())),p&&p.getTracks().forEach((g=>g.stop())),d=null,u=null,p=null,m}catch(m){return d&&d.getTracks().forEach((g=>g.stop())),u&&u.getTracks().forEach((g=>g.stop())),p&&p.getTracks().forEach((g=>g.stop())),d=null,u=null,p=null,new Ge(H.ENUMERATE_DEVICES_FAILED,m.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((t=>t.kind==="audioinput"))}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter((t=>t.kind==="videoinput"))}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((t=>t.kind==="audiooutput"))}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach((n=>{n.device.label===e&&(t=n.device.deviceId)})),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find((n=>n.deviceId===e));if(!t)throw new Ge(H.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Zp.INITING;try{await this.updateDevicesInfo(),this.state=Zp.INITEND}catch(e){throw F.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Zp.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Ge(H.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const s=e.find((c=>c.kind==="audioinput"&&c.deviceId==="default")),o=e.find((c=>c.kind==="audiooutput"&&c.deviceId==="default"));s&&o?o.groupId===s.groupId?F.debug("[device-check] default input ".concat(s.label," and output ").concat(o.label," is the same group")):F.debug("[device-check] default input ".concat(s.label," and output ").concat(o.label," is not the same group")):F.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(e);if(e.forEach((s=>{if(!s.deviceId)return;const o=this.deviceInfoMap.get("".concat(s.kind,"_").concat(s.deviceId));if((o?o.state:"INACTIVE")!=="ACTIVE"){const c={initAt:t,updateAt:t,device:s,state:"ACTIVE"};this.deviceInfoMap.set("".concat(s.kind,"_").concat(s.deviceId),c),n.push(c)}o&&(o.updateAt=t)})),this.deviceInfoMap.forEach(((s,o)=>{s.state==="ACTIVE"&&s.updateAt!==t&&(s.state="INACTIVE",n.push(s))})),this.state!==Zp.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach((s=>{switch(s.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(qs.RECORDING_DEVICE_CHANGED,s);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(qs.CAMERA_DEVICE_CHANGED,s);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(qs.PLAYOUT_DEVICE_CHANGED,s)}})),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter((s=>s.kind==="audioinput")),n=e.filter((s=>s.kind==="videoinput")),i={audio:!1,video:!1};for(const s of t)if(s.label&&s.deviceId){i.audio=!0;break}for(const s of n)if(s.label&&s.deviceId){i.video=!0;break}return i}};let ml=!1;const Ql=new class extends rr{constructor(){super(...arguments),Le(this,"onAutoplayFailed",void 0),Le(this,"onAudioAutoplayFailed",void 0)}};function ox(){if($n(),!ml){const e=t=>{t.preventDefault(),ml=!1,Qt()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};ml=!0,Qt()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),F.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Ql.onAutoplayFailed?Ql.onAutoplayFailed():Ql.onAudioAutoplayFailed?F.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):F.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Ql.emit("autoplay-failed")}}function m4(e,t,n,i){if(!e)return;const s=fe.getBaseInfoBySessionId(e);if(!s)return;const o=s.info,c=Date.now(),d=Ji(Ji({},o),{},{vid:o.vid===void 0?0:Number(o.vid),lts:c,elapse:c-s.startTime,cbRegistered:Ql.onAutoplayFailed||Ql.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:i,extend:void 0});fe.send({type:yr.AUTOPLAY_FAILED,data:d},!0)}const Hc=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],wi=new class{constructor(){Le(this,"onAutoplayFailed",void 0),Le(this,"elementMap",new Map),Le(this,"elementStateMap",new Map),Le(this,"elementsNeedToResume",[]),Le(this,"sinkIdMap",new Map),Le(this,"autoResumeAfterInterruption",(e=>{Array.from(this.elementMap.entries()).forEach((t=>{let[n,i]=t;const s=this.elementStateMap.get(n),o=i.srcObject.getAudioTracks()[0],c=o&&o.readyState;if(F.debug("resume after interrupted, ele: ".concat(s," audio: ").concat(c," ").concat(e)),c==="live"){if(e)return i.pause(),void i.play();if(Ai.curState==="running")return Vg()?(i.pause(),void i.play()):void(s&&s==="paused"&&i.play())}}))})),Le(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{Array.from(this.elementMap.entries()).forEach((e=>{let[t,n]=e;const i=n.srcObject.getAudioTracks()[0];i&&i.readyState==="live"&&(F.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())}))})),this.autoResumeAudioElement(),Ai.on(js.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ai.on(js.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Ai.on(js.STATE_CHANGE,(()=>{mo()&&Ai.prevState==="suspended"&&Ai.curState==="running"&&this.autoResumeAfterInterruption()}))}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(i){throw new Ge(H.PERMISSION_DENIED,"can not set sink id: "+i.toString())}}play(e,t,n,i){if(this.elementMap.has(t))return;const s=document.createElement("audio");s.autoplay=!0,s.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,s),this.elementMap.set(t,s),this.elementStateMap.set(t,gs.INIT),this.setVolume(t,n);const o=this.sinkIdMap.get(t);if(o)try{s.setSinkId(o).catch((d=>{F.warning("[".concat(t,"] set sink id failed"),d.toString())}))}catch(d){F.warning("[".concat(t,"] set sink id failed"),d.toString())}const c=s.play();c&&c.then&&c.catch((d=>{i&&m4(i,"audio",d.message,t),F.warning("audio element play warning",d.toString()),this.elementMap.has(t)&&d.name==="NotAllowedError"&&(F.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(s),sr((()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),ox()})))}))}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){Hc.forEach((n=>{t.addEventListener(n,(i=>{const s=this.elementStateMap.get(e),o=i.type==="pause"?"paused":i.type;if(F.debug("[".concat(e,"] audio-element-status change ").concat(s," => ").concat(o)),i.type==="error"){const c=t?.error;c&&F.error("[".concat(e,"] media error, code: ").concat(c.code,", message: ").concat(c.message))}this.elementStateMap.set(e,o)}))}))}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach((t=>{t.play().then((n=>{F.debug("Auto resume audio element success")})).catch((n=>{F.warning("Auto resume audio element failed!",n)}))})),this.elementsNeedToResume=[]};new De((t=>{document.body?t():window.addEventListener("load",(()=>t()))})).then((()=>{Qt()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))}))}};function Yr(){return function(e,t,n){const i=n.value;return typeof i=="function"&&(n.value=function(){this._isClosed&&new Ge(H.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",F);for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];const d=i.apply(this,o);return d instanceof De?new De(((u,p)=>{d.then(u).catch(p)})):d}),n}}class ax extends rr{constructor(t){super(),Le(this,"name","VideoProcessorDestination"),Le(this,"ID","0"),Le(this,"_source",void 0),Le(this,"videoContext",void 0),Le(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Ge(H.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Ge(H.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(ds.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(ds.ON_TRACK,void 0)}}class cx extends rr{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),Le(this,"constraintsMap",new Map),Le(this,"statsRegistry",[]),Le(this,"usageRegistry",[]),Le(this,"trackId",void 0),Le(this,"direction",void 0),Le(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await On(this,yc.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var i;return F.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),ei(this,yc.REQUEST_UPDATE_CONSTRAINTS,Array.from(cs(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return F.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),ei(this,yc.REQUEST_UPDATE_CONSTRAINTS,Array.from(cs(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find((s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===n))||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex((s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===n));i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:s,cb:o}of this.statsRegistry)try{const c=o();t.push({processorID:n,processorName:i,type:s,stats:c})}catch(c){F.error(new Ge(H.UNEXPECTED_ERROR,c.message))}return t}registerUsage(t,n){this.usageRegistry.find((i=>i.processorID===t.ID&&i.processorName===t.name))||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex((i=>i.processorID===t.ID&&i.processorName===t.name));n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof De&&(i=await i),t.push(Ji(Ji({},i),{},{direction:this.direction}))}catch(i){F.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class lx extends rr{constructor(t){super(),Le(this,"name","AudioProcessorDestination"),Le(this,"ID","0"),Le(this,"inputTrack",void 0),Le(this,"inputNode",void 0),Le(this,"audioProcessorContext",void 0),Le(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Ge(H.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Ge(H.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(ds.ON_TRACK,void 0),this.emit(ds.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(ds.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(ds.ON_NODE,this.inputNode))}}class KD extends rr{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,i){super(),Le(this,"constraintsMap",new Map),Le(this,"statsRegistry",[]),Le(this,"audioContext",void 0),Le(this,"trackId",void 0),Le(this,"direction",void 0),Le(this,"usageRegistry",[]),Le(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=i}async getConstraints(){return On(this,yc.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var i;return F.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),ei(this,yc.REQUEST_UPDATE_CONSTRAINTS,Array.from(cs(i=this.constraintsMap).call(i)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),ei(this,yc.REQUEST_UPDATE_CONSTRAINTS,Array.from(cs(n=this.constraintsMap).call(n)))}registerStats(t,n,i){this.statsRegistry.find((s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===n))||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:i})}unregisterStats(t,n){const i=this.statsRegistry.findIndex((s=>s.processorID===t.ID&&s.processorName===t.name&&s.type===n));i!==-1&&this.statsRegistry.splice(i,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:i,type:s,cb:o}of this.statsRegistry)try{const c=o();t.push({processorID:n,processorName:i,type:s,stats:c})}catch(c){F.error(new Ge(H.UNEXPECTED_ERROR,c.message))}return t}registerUsage(t,n){this.usageRegistry.find((i=>i.processorID===t.ID&&i.processorName===t.name))||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex((i=>i.processorID===t.ID&&i.processorName===t.name));n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let i=n();i instanceof De&&(i=await i),t.push(Ji(Ji({},i),{},{direction:this.direction}))}catch(i){F.error("gather extension usage error",i)}return t}getDirection(){return this.direction}}class dx extends rr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Le(this,"context",void 0),Le(this,"processSourceNode",void 0),Le(this,"outputTrack",void 0),Le(this,"processedNode",void 0),Le(this,"clonedTrack",void 0),Le(this,"outputNode",void 0),this.outputNode=new E4}setVolume(){}createOutputTrack(){throw new Ge(H.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class E4{disconnect(){}connect(){}}function Lw(e){return new De(((t,n)=>{let i=!1;const s=document.createElement("video");s.setAttribute("autoplay",""),s.setAttribute("muted",""),s.muted=!0,s.autoplay=!0,s.setAttribute("playsinline",""),s.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(s);const o=mo()?"canplay":"playing";s.addEventListener(o,(()=>{const c=s.videoWidth,d=s.videoHeight;!c&&fi()||(i=!0,s.srcObject=null,s.remove(),t([c,d]))})),s.srcObject=new MediaStream([e]),s.play().catch(Cw),setTimeout((()=>{i||(s.srcObject=null,s.remove(),t([s.videoWidth,s.videoHeight]))}),4e3)}))}function Mw(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=Nd(e.encoderConfig);return n.width!=null&&(t.width=n.width),n.height!=null&&(t.height=n.height),!RD()&&n.frameRate&&(t.frameRate=n.frameRate),jr()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),fi()&&(t.frameRate={ideal:30,max:30}),t}function ux(e){const t={};return RD()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,ms()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function g4(e){const t=ux(e);if(e.encoderConfig){const n=xm(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),Fg()&&(t.sampleRate=void 0),t}const S4=e=>{const t=e._encoderConfig;if(!t)return;const{frameRate:n,width:i,height:s}=e.getMediaStreamTrackSettings();let{frameRate:o=n,width:c=i,height:d=s}=t;if(!o||!c||!d)return;c=jg(c),d=jg(d),o=jg(o);const{max:u,min:p}=(function(R,I,A){const w=200*Math.pow(A/15,.6)*Math.pow(R*I/640/360,.75);return{min:Math.floor(w),max:Math.floor(4*w)}})(c,d,o),{bitrateMax:m,bitrateMin:g}=t||{};m||F.debug("calculate bitrate: [w: ".concat(c,", h: ").concat(d,", fps: ").concat(o,"] => [brMax: ").concat(m,", brMin: ").concat(g,"]"));const{maxFramerate:T}=re("ENCODER_CONFIG_LIMIT");return T&&typeof T=="number"&&(o=Math.min(o,T)),{frameRate:o,bitrateMax:m||u,bitrateMin:g||p,scaleResolutionDownBy:1,scale:0}},zD=async(e,t,n)=>await(async(i,s,o)=>{const c=(function(p){const m=[];for(let g=0;g<p.length;g+=2)m.push(parseInt(p.slice(g,g+2),16));return Uint8Array.from(m)})(i4(""+s+o)).slice(0,16),d=c.slice(0,12),u=await window.crypto.subtle.importKey("raw",c,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:d},u,i))})(e.buffer,t,n),YD=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new De(((n,i)=>{t.toBlob((async s=>{if(t.remove(),s){const o=await hx(s);n({buffer:o,width:t.width,height:t.height})}else i(new Ge(H.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,1)}))},hx=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};var px,fx,_x,mx,Ex,gx,Sx,Tx,vx,yx,Rx,Cx,bx,Ix,Ax,wx,Ox,Dr,Pr,Nx,Dx,Px,kx,Lx,$p,ef,Mx,Ux,xx,Vx,Fx,Bx,jx,Gx,Wx,Hx,Kx,zx,Zo,ci;let Rr=(px=Ye({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),fx=Ye({argsMap:(e,t)=>[e.getTrackId(),t]}),_x=Yr(),mx=zr("LocalAudioTrack","_enabledMutex"),Ex=Ye({argsMap:(e,t)=>[e.getTrackId(),t]}),gx=Yr(),Sx=zr("LocalAudioTrack","_enabledMutex"),Tx=Ye({argsMap:(e,t)=>[e.getTrackId(),t]}),vx=Yr(),yx=Yr(),Rx=Yr(),Cx=Ye({argsMap:e=>[e.getTrackId()]}),bx=Yr(),Ix=Ye({argsMap:e=>[e.getTrackId()]}),Ax=Yr(),wx=Ye({argsMap:e=>[e.getTrackId()]}),Ox=Ye({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Dr=Ye({argsMap:e=>[e.getTrackId()]}),Ce((Pr=class extends bv{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?wi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,i){super(e,n),Le(this,"trackMediaType",rc.AUDIO),Le(this,"_encoderConfig",void 0),Le(this,"_trackSource",void 0),Le(this,"metadata",[]),Le(this,"_enabled",!0),Le(this,"_volume",100),Le(this,"_useAudioElement",!0),Le(this,"_bypassWebAudio",!1),Le(this,"processor",void 0),Le(this,"_processorContext",void 0),Le(this,"_processorDestination",void 0),Le(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!i,this._trackSource=new dx,re("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),re("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),Xo()&&!Yn?setTimeout((()=>this.initWebAudio())):this.initWebAudio()}setVolume(e){Mi(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&wi.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void F.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,ei(this,rt.NEED_REPLACE_TRACK,this).then((()=>{F.debug("[".concat(this.getTrackId(),"] replace web audio track success"))})).catch((n=>{F.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)})))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!Dw())throw new Ge(H.NOT_SUPPORTED,"your browser does not support setting the audio output device");await wi.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(F.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await ei(this,rt.NEED_ENABLE_TRACK,this),F.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(i){throw n||(this._enabled=!1),F.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await ei(this,rt.NEED_DISABLE_TRACK,this)}catch(i){throw n||(this._enabled=!0),F.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,F.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await ei(this,rt.NEED_MUTE_TRACK,this):await ei(this,rt.NEED_UNMUTE_TRACK,this))}getStats(){return Cd((()=>{F.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")}),"localAudioTrackGetStatsWarning"),Sc(this,rt.GET_STATS)||Ji({},Pw)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(fl.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(fl.ON_AUDIO_BUFFER),this._source.on(fl.ON_AUDIO_BUFFER,(n=>e(n)))}play(){F.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(F.debug("[".concat(this.getTrackId(),"] start audio playback in element")),wi.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){F.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?wi.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];F.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&wi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ei(this,rt.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return De.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Ge(H.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Ge(H.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(ds.ON_TRACK,(async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await ei(this,rt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ei(this,rt.NEED_REPLACE_TRACK,this))})),e.on(ds.ON_NODE,(t=>{this._source.processedNode=t}))}unbindProcessorDestinationEvents(e){e.removeAllListeners(ds.ON_TRACK),e.removeAllListeners(ds.ON_NODE)}bindProcessorContextEvents(e){e.on(yc.REQUEST_CONSTRAINTS,(async t=>{t(this._originMediaStreamTrack.getSettings())}))}unbindProcessorContextEvents(e){e.removeAllListeners(yc.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof dx&&(this._trackSource=new rx(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new KD(this._source.context,this.getTrackId(),"local"),t=new lx(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(fl.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})})),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(wi.stop(this.getTrackId()),this._source.play()),ei(this,rt.NEED_REPLACE_MIXING_TRACK,this).then((()=>{F.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))})).catch((n=>{F.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)}))),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[px],Object.getOwnPropertyDescriptor(Pr.prototype,"setVolume"),Pr.prototype),Ce(Pr.prototype,"setPlaybackDevice",[fx,_x],Object.getOwnPropertyDescriptor(Pr.prototype,"setPlaybackDevice"),Pr.prototype),Ce(Pr.prototype,"setEnabled",[mx,Ex,gx],Object.getOwnPropertyDescriptor(Pr.prototype,"setEnabled"),Pr.prototype),Ce(Pr.prototype,"setMuted",[Sx,Tx,vx],Object.getOwnPropertyDescriptor(Pr.prototype,"setMuted"),Pr.prototype),Ce(Pr.prototype,"getStats",[yx],Object.getOwnPropertyDescriptor(Pr.prototype,"getStats"),Pr.prototype),Ce(Pr.prototype,"setAudioFrameCallback",[Rx],Object.getOwnPropertyDescriptor(Pr.prototype,"setAudioFrameCallback"),Pr.prototype),Ce(Pr.prototype,"play",[Cx,bx],Object.getOwnPropertyDescriptor(Pr.prototype,"play"),Pr.prototype),Ce(Pr.prototype,"stop",[Ix,Ax],Object.getOwnPropertyDescriptor(Pr.prototype,"stop"),Pr.prototype),Ce(Pr.prototype,"close",[wx],Object.getOwnPropertyDescriptor(Pr.prototype,"close"),Pr.prototype),Ce(Pr.prototype,"pipe",[Ox],Object.getOwnPropertyDescriptor(Pr.prototype,"pipe"),Pr.prototype),Ce(Pr.prototype,"unpipe",[Dr],Object.getOwnPropertyDescriptor(Pr.prototype,"unpipe"),Pr.prototype),Pr),Uw=(Nx=Ye({argsMap:(e,t)=>[e.getTrackId(),t]}),Dx=Yr(),Px=zr("MicrophoneAudioTrack","_enabledMutex"),kx=Ye({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),Lx=Yr(),$p=Ye({argsMap:e=>[e.getTrackId()]}),Ce((ef=class extends Rr{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,i){super(e,t.encoderConfig?xm(t.encoderConfig):{},i,re("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Le(this,"_config",void 0),Le(this,"_deviceName","default"),Le(this,"_constraints",void 0),Le(this,"_originalConstraints",void 0),Le(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(Vg()||yD())&&Ai.bindInterruptDetectorTrack(this)}async setDevice(e){if(F.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await _l.getDeviceById(e),n={};n.audio=Ji({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let i=null;try{i=await Dd(n,this.getTrackId())}catch(s){throw F.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),i=await Dd({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw F.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await _l.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw F.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}F.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return F.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(F.info("[".concat(this.getTrackId(),"] start setEnabled"),e),re("AUTO_RESET_AUDIO_ROUTE")&&(mo()||Su())){const c=navigator.audioSession;c&&(e||(c.type="playback"),c.type="auto")}if(!e){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(i=this._source.clonedTrack)===null||i===void 0||i.stop(),n||(this._enabled=!1);try{await ei(this,rt.NEED_DISABLE_TRACK,this)}catch(c){throw F.error("[".concat(this.getTrackId(),"] setEnabled false failed"),c.toString()),c}return}const s=Ji({},this._constraints),o=_l.searchDeviceIdByName(this._deviceName);o&&!s.deviceId&&(s.deviceId=o);try{n||(this._enabled=!0);const c=await Dd({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(c.getAudioTracks()[0],!1),await ei(this,rt.NEED_ENABLE_TRACK,this)}catch(c){throw n||(this._enabled=!1),F.error("[".concat(this.getTrackId(),"] setEnabled true failed"),c.toString()),c}F.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Vg()||yD())&&Ai.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((mo()||Su())&&this._enabled&&!this._isClosed&&Ai.duringInterruption){const e=async()=>{Ai.off(js.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(F.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Ai.on(js.IOS_INTERRUPTION_END,e)}else F.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Tc.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=_l.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const i=await Dd({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(yc.REQUEST_UPDATE_CONSTRAINTS,(async(t,n,i)=>{try{const s=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(s),n()}catch(s){i(s)}}))}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(yc.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[Nx,Dx],Object.getOwnPropertyDescriptor(ef.prototype,"setDevice"),ef.prototype),Ce(ef.prototype,"setEnabled",[Px,kx,Lx],Object.getOwnPropertyDescriptor(ef.prototype,"setEnabled"),ef.prototype),Ce(ef.prototype,"close",[$p],Object.getOwnPropertyDescriptor(ef.prototype,"close"),ef.prototype),ef),Xs=(Mx=Ye({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),Ux=Yr(),xx=Ye({argsMap:e=>[e.getTrackId()]}),Vx=Yr(),Fx=Ye({argsMap:e=>[e.getTrackId()]}),Bx=Yr(),jx=Ye({argsMap:e=>[e.getTrackId()]}),Gx=Yr(),Wx=Ye({argsMap:e=>[e.getTrackId()]}),Hx=Yr(),Kx=Ye({argsMap:e=>[e.getTrackId()]}),zx=Ye({argsMap:e=>[e.getTrackId()]}),Zo=Yr(),Ce((ci=class extends Rr{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,i){super(t.createOutputTrack(),n,i),Le(this,"source",void 0),Le(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(fl.AUDIO_SOURCE_STATE_CHANGE,(s=>{this.safeEmit(Tc.SOURCE_STATE_CHANGE,s)}));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){Mi(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[Mx,Ux],Object.getOwnPropertyDescriptor(ci.prototype,"startProcessAudioBuffer"),ci.prototype),Ce(ci.prototype,"pauseProcessAudioBuffer",[xx,Vx],Object.getOwnPropertyDescriptor(ci.prototype,"pauseProcessAudioBuffer"),ci.prototype),Ce(ci.prototype,"seekAudioBuffer",[Fx,Bx],Object.getOwnPropertyDescriptor(ci.prototype,"seekAudioBuffer"),ci.prototype),Ce(ci.prototype,"resumeProcessAudioBuffer",[jx,Gx],Object.getOwnPropertyDescriptor(ci.prototype,"resumeProcessAudioBuffer"),ci.prototype),Ce(ci.prototype,"stopProcessAudioBuffer",[Wx,Hx],Object.getOwnPropertyDescriptor(ci.prototype,"stopProcessAudioBuffer"),ci.prototype),Ce(ci.prototype,"close",[Kx],Object.getOwnPropertyDescriptor(ci.prototype,"close"),ci.prototype),Ce(ci.prototype,"setAudioBufferPlaybackSpeed",[zx,Zo],Object.getOwnPropertyDescriptor(ci.prototype,"setAudioBufferPlaybackSpeed"),ci.prototype),ci);class Js extends Rr{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=vh().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,Oi(8,"track-mix-")),Le(this,"trackList",void 0),Le(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(F.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):F.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){F.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}Pm(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach((n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))})),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach((n=>{n instanceof Js?n.emit(Sh.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)})))}}class T4 extends ix{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(fl.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Le(this,"audioBuffer",void 0),Le(this,"sourceNode",void 0),Le(this,"startPlayTime",0),Le(this,"startPlayOffset",0),Le(this,"pausePlayTime",0),Le(this,"options",void 0),Le(this,"currentLoopCount",0),Le(this,"currentPlaybackSpeed",100),Le(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):F.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const Yx=new Map;function qD(e,t){if(e.length===0||t.length===0)return 1/0;const n=DD(e),i=DD(t);return Math.floor(i/n)}class XD{get rendFrameRate(){const t=Math.max(1,qD(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/t)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:gs.DESTROYED}set videoElementStatus(t){t!==this._videoElementStatus&&(F.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var n;t!==this._videoState&&(this._videoState=t,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(t){Le(this,"trackId",void 0),Le(this,"config",void 0),Le(this,"onFirstVideoFrameDecoded",void 0),Le(this,"onFirstVideoFrameRender",void 0),Le(this,"onVideoStateChanged",void 0),Le(this,"freezeTimeCounterList",[]),Le(this,"renderFreezeAccTime",0),Le(this,"renderFreezeAccTime2",0),Le(this,"isKeepLastFrame",!1),Le(this,"isDestroyed",!1),Le(this,"timeUpdatedCount",0),Le(this,"freezeTime",0),Le(this,"playbackTime",0),Le(this,"lastTimeUpdatedTime",0),Le(this,"autoplayFailed",!1),Le(this,"videoTrack",void 0),Le(this,"videoElement",void 0),Le(this,"cacheVideoElement",void 0),Le(this,"internal",!1),Le(this,"_render_interframe_delays",[]),Le(this,"_render_interframe_delays_sizes",[]),Le(this,"_videoState",Th.VideoStateStopped),Le(this,"videoElementCheckInterval",void 0),Le(this,"videoElementFreezeTimeout",void 0),Le(this,"_videoElementStatus",gs.NONE),Le(this,"_isInPage",!0),Le(this,"isGettingVideoDimensions",!1),Le(this,"startGetVideoDimensions",(()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return F.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()})),Le(this,"autoResumeAfterInterruption",(()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Ai.curState==="running"&&(F.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Tw())),gu()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),Le(this,"handleVideoEvents",(n=>{switch(n.type){case"play":case"playing":n.type==="play"&&F.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=gs.PLAYING;break;case"loadeddata":if(this.videoState=Th.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=gs.CANPLAY;break;case"stalled":this.videoElementStatus=gs.STALLED;break;case"suspend":this.videoElementStatus=gs.SUSPEND;break;case"pause":this.videoElementStatus=gs.PAUSED,mo()||Su()||Xo()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(F.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=gs.WAITING;break;case"abort":this.videoElementStatus=gs.ABORT;break;case"ended":this.videoElementStatus=gs.ENDED;break;case"emptied":this.videoElementStatus=gs.EMPTIED;break;case"error":{const i=this.videoElement.error;i&&(this.videoElementStatus=gs.ERROR,F.error("[".concat(this.trackId,"] media error: ").concat(i.message," (").concat(i.code,")")));break}case"timeupdate":{const i=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=i);const s=i-this.lastTimeUpdatedTime,o=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=i,nf.lastVisibleTime<nf.lastHiddenTime||o<nf.lastHiddenTime||o<nf.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(s>re("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=s),this.playbackTime+=s;this.playbackTime>=6e3;){this.playbackTime-=6e3;const c=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(c),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}})),Le(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(F.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Tw())),gu()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Ai.on(js.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ai.on(js.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch((s=>{t&&m4(t,"video",s.message,this.trackId),s.name==="NotAllowedError"?(F.warning("detected video element autoplay failed",s),this.autoplayFailed=!0,this.handleAutoPlayFailed()):F.warning("[".concat(this.trackId,"] play warning: "),s)}));const i=$n();if((i.name==="Safari"&&Number(i.version)===15||Vg())&&n&&n.then){const s=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(s).catch(s)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return F.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height);return t.remove(),i}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const s=i.getContext("2d");return s?(s.drawImage(this.videoElement,0,0,i.width,i.height),new De(((o,c)=>{i.toBlob((async d=>{if(i.remove(),d){const u=await hx(d);o({buffer:u,width:i.width,height:i.height})}else c(new Ge(H.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),t,n<0?.1:n>1?1:n)}))):await YD(t)}destroy(){this.isDestroyed=!0,Ai.off(js.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ai.off(js.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=Th.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=gs.INIT,!this.videoElementCheckInterval&&(JD.forEach((o=>{this.videoElement.addEventListener(o,this.handleVideoEvents)})),this.videoElementCheckInterval=window.setInterval((()=>{this._isInPage=(function(o){return o!==document.body&&document.body.contains(o)})(this.videoElement)}),1e3),re("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let o;const c=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",c),this.videoElementFreezeTimeout=window.setTimeout(d,re("VIDEO_FREEZE_DURATION")))},d=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===Th.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=Th.VideoStateFrozen:document.addEventListener("visibilitychange",c))},u=(p,m)=>{if(this.videoElementStatus===gs.PLAYING){if(o){const R=m.presentationTime-o.presentationTime,I=m.presentedFrames-o.presentedFrames;this._render_interframe_delays_sizes.push(I),this._render_interframe_delays.push(R);const A=DD(this._render_interframe_delays_sizes),w=A-this._render_interframe_delays_sizes[0];if(A>30&&w>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===Th.VideoStateStarting&&(this.videoState=Th.VideoStateDecoding),this.videoState===Th.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(d,re("VIDEO_FREEZE_DURATION"))),R<re("VIDEO_FREEZE_DURATION")&&this.videoState===Th.VideoStateFrozen&&(this.videoState=Th.VideoStateDecoding),R>re("VIDEO_FREEZE_DURATION")&&nf.lastVisibleTime>=nf.lastHiddenTime&&o.timestamp>nf.lastVisibleTime&&o.timestamp>nf.lastHiddenTime){const k=Math.min(66,qD(this._render_interframe_delays_sizes,this._render_interframe_delays)),L=Math.max(0,R-(I-1)*k);this.renderFreezeAccTime2+=L>k?L:0,this.renderFreezeAccTime+=R}}o=Ji(Ji({},m),{},{timestamp:p})}else this.isSkipCalcRenderFreezeTime()&&(o=Ji(Ji({},m),{},{timestamp:p}));var g,T;re("ENABLE_VIDEO_FRAME_CALLBACK")&&((g=(T=this.videoElement).requestVideoFrameCallback)===null||g===void 0||g.call(T,u))};(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(n,u)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Fg()&&!re("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const i=$n();i.name==="Safari"&&Number(i.version)===15||Vg()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,fi()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,fi()&&this.videoElement.load());const s=this.videoElement.play();s!==void 0&&s.catch((o=>{F.debug("[".concat(this.trackId,"] playback interrupted"),o.toString())}))}resetVideoElement(){JD.forEach((t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)})),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=gs.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===gs.DESTROYED||this.internal}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then((()=>{F.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))})).catch((i=>{F.error(i)})),this.autoplayFailed=!1,Qt()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Qt()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),ox()}}const JD=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class QD extends XD{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(t),Le(this,"container",void 0),Le(this,"slot",void 0),this.slot=t.element,this.internal=n,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;var i;!this.internal||this.slot?(n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()):(this.slot=n,n&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(i=this.slot)===null||i===void 0||i.appendChild(this.container)):this.createElements())}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,i):await YD(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var t;this.container.remove(),(t=this.slot)===null||t===void 0||t.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var t;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",re("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(t=this.slot)===null||t===void 0||t.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var qx,Xx,Jx,Qx,Zx,$x,eV,tV,nV,iV,rV,sV,oV,aV,cV,lV,dV,uV,hV,pV,fV,_V,mV,EV,gV,SV,TV,Pn,kn,vV,yV,RV,CV,bV,IV,AV,Zl,Ei;let zi=(qx=Ye({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),Xx=Yr(),Jx=Ye({argsMap:e=>[e.getTrackId()]}),Qx=zr("LocalVideoTrack","_enabledMutex"),Zx=Ye({argsMap:(e,t)=>[e.getTrackId(),t]}),$x=Yr(),eV=zr("LocalVideoTrack","_enabledMutex"),tV=Ye({argsMap:(e,t)=>[e.getTrackId(),t]}),nV=Yr(),iV=Ye({argsMap:(e,t)=>[e.getTrackId(),t,e._saveEncodeBitrateRatio]}),rV=Yr(),sV=Ye({argsMap:(e,t)=>[e.getTrackId(),t]}),oV=Yr(),aV=Yr(),cV=Ye({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),lV=Yr(),dV=Yr(),uV=Yr(),hV=Ye({argsMap:e=>[e.getTrackId()]}),pV=Yr(),fV=Yr(),_V=Yr(),mV=Yr(),EV=Yr(),gV=Ye({argsMap:(e,t)=>[e.getTrackId(),t.name]}),SV=Ye({argsMap:e=>[e.getTrackId()]}),TV=Ye({argsMap:e=>[e.getTrackId()]}),Pn=Ye({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),kn=class _ie extends bv{get videoHeight(){if(Xo()){const{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(Xo()){const{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==gs.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,i,s,o,c){if(super(t,o),Le(this,"trackMediaType",rc.VIDEO),Le(this,"_player",void 0),Le(this,"isUseScaleResolutionDownBy",!1),Le(this,"_videoVisibleTimer",null),Le(this,"_previousVideoVisibleStatus",void 0),Le(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),Le(this,"_encoderConfig",void 0),Le(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Le(this,"_optimizationMode",void 0),Le(this,"_saveEncodeBitrateRatio",1),Le(this,"_videoHeight",void 0),Le(this,"_videoWidth",void 0),Le(this,"_forceBitrateLimit",void 0),Le(this,"_enabled",!0),Le(this,"_processorDestination",void 0),Le(this,"_processorContext",void 0),Xo()){const{width:d,height:u}=t.getSettings();this._videoWidth=d,this._videoHeight=u}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=i,this._optimizationMode=s,this._hints=c||[],n&&this._hints.indexOf(Ni.CUSTOM_TRACK)!==-1?this._encoderConfig=Ki(n):this._encoderConfig=n,this._hints.indexOf(Ni.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(vw(mi.CHROME,115)&&Sw().indexOf("Windows")!==-1){const d=(function(u,p){if("VideoFrame"in window&&"TransformStream"in window&&ai().supportWebRTCInsertableStream){const m=new MediaStreamTrackProcessor(u),g=new MediaStreamTrackGenerator({kind:"video"});let T,R,I=Date.now();const A=()=>{w&&(clearInterval(w),w=void 0),T&&(T.close(),T=void 0),u.stop(),R=void 0,g.removeEventListener("ended",A)};let w=window.setInterval((()=>{if(R&&T&&Date.now()-I>1e3)try{g.readyState==="live"?R.enqueue(T.clone()):A()}catch{A()}}),1e3);const k=new TransformStream({transform:(L,j)=>{g.readyState==="live"?(R=j,I=Date.now(),T===void 0?(T=L,j.enqueue(L.clone())):(j.enqueue(T),T=L)):L.close()}});return g.addEventListener("ended",A),m.readable.pipeThrough(k).pipeTo(g.writable),g}})(t);d&&(F.info("local screen video track begin to inject frame"),this._mediaStreamTrack=d)}n&&this._hints.indexOf(Ni.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new cx(this.getTrackId(),"local"),this._processorDestination=new ax(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const s=document.getElementById(t);s?t=s:(F.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}F.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const i=Ji(Ji(Ji({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(i):(t instanceof HTMLVideoElement?this._player=new XD(i):this._player=new QD(i),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const s=this.getVideoElementVisibleStatus();this.safeEmit(Tc.VIDEO_ELEMENT_VISIBLE_STATUS,s)}catch{}}),re("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,F.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(F.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await ei(this,rt.NEED_DISABLE_TRACK,this)}catch(i){throw F.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}return n||(this._enabled=!1),void F.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await ei(this,rt.NEED_ENABLE_TRACK,this)}catch(i){throw F.error("[".concat(this.getTrackId(),"] setEnabled to true error"),i.toString()),i}F.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,F.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await ei(this,rt.NEED_MUTE_TRACK,this):await ei(this,rt.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*t),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*t),F.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(t)),this._saveEncodeBitrateRatio=1;try{await ei(this,rt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(F)}}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new Ge(H.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=Nd(t),re("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const i=Mw({encoderConfig:t});(Xo()||mo()||Su())&&(i.deviceId=void 0),F.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(s){const o=new Ge(H.UNEXPECTED_ERROR,s.toString());throw F.error("[".concat(this.getTrackId(),"] applyConstraints error"),o.toString()),o}}this._encoderConfig=t,this._hints.indexOf(Ni.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ei(this,rt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(F)}}getStats(){return Cd((()=>{F.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")}),"localVideoTrackGetStatsWarning"),Sc(this,rt.GET_STATS)||Ji({},BD)}async setBeautyEffect(t){F.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await YD(t)}async findClosestProfile(){const{width:t,height:n,frameRate:i}=this.getMediaStreamTrackSettings(),{width:s,height:o,frameRate:c}=this._encoderConfig||{},d=jg(this._videoWidth||t||s||0),u=jg(this._videoHeight||n||o||0),p=(function(m,g,T){if(!Array.isArray(re("VIDEO_ENCODER_CONFIG_LIST"))||re("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const R=Math.min(m,g);return!(R>=480)&&Ji(Ji({},re("VIDEO_ENCODER_CONFIG_LIST").find((I=>I.height>R))),{},{frameRate:T})})(d,u,jg(i||c||15));if(p)return F.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(d,"x").concat(u," => ").concat(JSON.stringify(p))),this.setEncoderConfiguration(p)}async setBitrateLimit(t){F.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void F.error(H.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await ei(this,rt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(i){throw this._optimizationMode=n,F.error("[".concat(this.getTrackId(),"] set optimization mode failed"),i.toString()),i}F.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return F.error(H.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,F.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){Lw(this._originMediaStreamTrack).then((t=>{let[n,i]=t;this._videoHeight=i,this._videoWidth=n})).catch(Cw)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new Ge(H.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");F.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=Nd(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(Ni.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ei(this,rt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(F)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:i}=this.getMediaStreamTrackSettings();if(!t||!n||!i)return;const{bitrateMax:s,bitrateMin:o}=this._encoderConfig;if(o==null||s==null){const{max:c,min:d}=(function(u,p,m,g,T){const R=re("BITRATE_ADAPTER_TYPE");if(R==="DEFAULT_BITRATE")return{min:g,max:T};if(T===void 0){const I=Math.floor(200*Math.pow(m/15,.6)*Math.pow(u*p/640/360,.75));T=R==="STANDARD_BITRATE"?4*I:2*I,g=g??I}else g=g??Math.floor(T/10);return{min:g,max:T}})(t,n,i,o,s);if(this._encoderConfig.bitrateMin=d,this._encoderConfig.bitrateMax=c,re("VIDEO_STANDARD_BITRATE_VERSION")&&o==null&&s==null){const[u,p]=(function(m,g,T){const R=4*Math.floor(2e5*Math.pow(T/15,.6)*Math.pow(m*g/230400,.75)),I=m*g,A=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),w=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let k=cs(A).call(A).next().value,L=1;if(A.has(I))k=A.get(I);else{var j;const je=Zt(j=Array.from(A.entries())).call(j,((ht,Ct)=>{let[Ft]=ht,[mn]=Ct;return Ft-mn})),_t=je.find((ht=>{let[Ct]=ht;return Ct>I}));if(_t){const ht=je.indexOf(_t);if(ht>0){const Ct=je[ht-1],Ft=(I-Ct[0])/(_t[0]-Ct[0]);k=Ct[1]+Ft*(_t[1]-Ct[1])}else k=_t[1]}else k=je[je.length-1][1]}if(w.has(I))L=w.get(I);else{var K;const je=Zt(K=Array.from(w.entries())).call(K,((ht,Ct)=>{let[Ft]=ht,[mn]=Ct;return Ft-mn})),_t=je.find((ht=>{let[Ct]=ht;return Ct>I}));if(_t){const ht=je.indexOf(_t);if(ht>0){const Ct=je[ht-1],Ft=(I-Ct[0])/(_t[0]-Ct[0]);L=Ct[1]+Ft*(_t[1]-Ct[1])}else L=_t[1]}else L=je[je.length-1][1]}const W=re("VIDEO_NEW_BITRATE_RATIO");W&&W>0&&(k=W/100);const Y=Math.floor(R*k),se=Math.floor(65e4*Math.pow(m*g/230400,.5)*Math.pow(T/15,.69));let de=Y;const ge=re("VIDEO_STANDARD_BITRATE_VERSION");return ge&&ge>0&&(ge===1?de=R:ge===2?de=Y:ge===3&&(de=se)),[Math.floor(de/1e3),L]})(t,n,i);this._encoderConfig.bitrateMax=u,this._encoderConfig.bitrateMin=d?Math.min(d,u):u,this._saveEncodeBitrateRatio=p,F.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else F.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(i,"] => [brMax: ").concat(c,", brMin: ").concat(d,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var t,n;const i=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),s={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:i?.parentElement},{element:o,slot:c}=s;if(this.isPlaying&&o instanceof HTMLVideoElement&&c instanceof HTMLElement){const d=bD.checkOneElementVisible(o),u=Object.assign({},d);if(u.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=u.visible;const p=fe.reportApiInvoke(null,{tag:Tr.TRACER,name:Cn.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});u.visible?p.onSuccess("Video is visible"):p.onSuccess("Invisible because of ".concat(u.reason))}return u}return}catch(i){throw new Ge(H.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new Ge(H.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=Ji(Ji({},i),Nd(t))),i=Bg(i);const s=Oi(8,"track-video-cloned-"),o=new _ie(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,i,Bg(this._scalabilityMode),this._optimizationMode,s,Bg(this._hints));return t&&i&&o.setEncoderConfiguration(i),F.debug("clone video track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(n)),o}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new Ge(H.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new Ge(H.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Cd((()=>{fe.reportApiInvoke(null,{name:Cn.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Tr.TRACER}).onSuccess("")}),this._mediaStreamTrack.id||this.getTrackId()),!re("ENABLE_VIDEO_SEI")||!re("ENABLE_ENCODED_TRANSFORM"))return void F.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new Ge(H.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void F.warning("Video track is not published, SEI can not be send");const i=n.sender.getParameters();if(i.codecs.length===0)return;const s=i.codecs[0].mimeType.toLocaleLowerCase();s==="video/h264"||s==="video/h265"?this.safeEmit("sei-to-send",t):F.warning("SEI is not supported by ".concat(s))}bindProcessorDestinationEvents(){this.processorDestination.on(ds.ON_TRACK,(async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await ei(this,rt.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await ei(this,rt.NEED_REPLACE_TRACK,this))}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ds.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(yc.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(yc.REQUEST_CONSTRAINTS)}},Ce(kn.prototype,"play",[qx,Xx],Object.getOwnPropertyDescriptor(kn.prototype,"play"),kn.prototype),Ce(kn.prototype,"stop",[Jx],Object.getOwnPropertyDescriptor(kn.prototype,"stop"),kn.prototype),Ce(kn.prototype,"setEnabled",[Qx,Zx,$x],Object.getOwnPropertyDescriptor(kn.prototype,"setEnabled"),kn.prototype),Ce(kn.prototype,"setMuted",[eV,tV,nV],Object.getOwnPropertyDescriptor(kn.prototype,"setMuted"),kn.prototype),Ce(kn.prototype,"setSaveEncodeBitrateRatio",[iV,rV],Object.getOwnPropertyDescriptor(kn.prototype,"setSaveEncodeBitrateRatio"),kn.prototype),Ce(kn.prototype,"setEncoderConfiguration",[sV,oV],Object.getOwnPropertyDescriptor(kn.prototype,"setEncoderConfiguration"),kn.prototype),Ce(kn.prototype,"getStats",[aV],Object.getOwnPropertyDescriptor(kn.prototype,"getStats"),kn.prototype),Ce(kn.prototype,"setBeautyEffect",[cV,lV],Object.getOwnPropertyDescriptor(kn.prototype,"setBeautyEffect"),kn.prototype),Ce(kn.prototype,"getCurrentFrameData",[dV],Object.getOwnPropertyDescriptor(kn.prototype,"getCurrentFrameData"),kn.prototype),Ce(kn.prototype,"getCurrentFrameImage",[uV],Object.getOwnPropertyDescriptor(kn.prototype,"getCurrentFrameImage"),kn.prototype),Ce(kn.prototype,"findClosestProfile",[hV,pV],Object.getOwnPropertyDescriptor(kn.prototype,"findClosestProfile"),kn.prototype),Ce(kn.prototype,"setBitrateLimit",[fV],Object.getOwnPropertyDescriptor(kn.prototype,"setBitrateLimit"),kn.prototype),Ce(kn.prototype,"setOptimizationMode",[_V],Object.getOwnPropertyDescriptor(kn.prototype,"setOptimizationMode"),kn.prototype),Ce(kn.prototype,"setScalabiltyMode",[mV],Object.getOwnPropertyDescriptor(kn.prototype,"setScalabiltyMode"),kn.prototype),Ce(kn.prototype,"updateMediaStreamTrackResolution",[EV],Object.getOwnPropertyDescriptor(kn.prototype,"updateMediaStreamTrackResolution"),kn.prototype),Ce(kn.prototype,"pipe",[gV],Object.getOwnPropertyDescriptor(kn.prototype,"pipe"),kn.prototype),Ce(kn.prototype,"unpipe",[SV],Object.getOwnPropertyDescriptor(kn.prototype,"unpipe"),kn.prototype),Ce(kn.prototype,"close",[TV],Object.getOwnPropertyDescriptor(kn.prototype,"close"),kn.prototype),Ce(kn.prototype,"replaceTrack",[Pn],Object.getOwnPropertyDescriptor(kn.prototype,"replaceTrack"),kn.prototype),kn),AC=(vV=Ye({argsMap:(e,t)=>[e.getTrackId(),t]}),yV=Yr(),RV=zr("CameraVideoTrack","_enabledMutex"),CV=Ye({argsMap:(e,t)=>[e.getTrackId(),t]}),bV=Yr(),IV=Ye({argsMap:(e,t)=>[e.getTrackId(),t]}),AV=Yr(),Zl=Ye({argsMap:e=>[e.getTrackId()]}),Ei=class mie extends zi{get __className__(){return"CameraVideoTrack"}constructor(t,n,i,s,o,c){super(t,Nd(n.encoderConfig),s,o,c),Le(this,"_config",void 0),Le(this,"_originalConstraints",void 0),Le(this,"_constraints",void 0),Le(this,"_enabled",!0),Le(this,"_deviceName","default"),Le(this,"tryResumeVideoForIOS15_16WeChat",(async()=>{(Vg()||yD())&&!(function(){const d=$n();if(d.os!==sn.IOS||!d.osVersion)return!1;const u=d.osVersion.split(".");return Number(u[0])===15&&Number(u[1])>=2})()&&GU()&&this._enabled&&!this._isClosed&&(F.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())})),this._config=n,this._originalConstraints=i,this._constraints=i,this._deviceName=t.label,this._encoderConfig=Nd(this._config.encoderConfig),Ai.on(js.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Ai.on(js.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(F.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const n=await _l.getDeviceById(t),i={};i.video=Ji({},this._constraints),i.video.deviceId={exact:t},i.video.facingMode=void 0,this._originMediaStreamTrack.stop();let s=null;try{s=await Dd(i,this.getTrackId())}catch(o){throw F.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),s=await Dd({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw F.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await _l.getDeviceById(t);this._deviceName=n.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(n){throw F.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}F.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){F.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const n={video:Ji(Ji({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let i=null;try{i=await Dd(n,this.getTrackId())}catch(s){throw F.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),s.toString()),i=await Dd({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=Ji({},n.video),F.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(F.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const i=await Dd({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1)}await ei(this,rt.NEED_ENABLE_TRACK,this)}catch(i){throw F.error("[".concat(this.getTrackId(),"] setEnabled true error"),i.toString()),i}this.updateMediaStreamTrackResolution(),F.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await ei(this,rt.NEED_DISABLE_TRACK,this)}catch(i){throw F.error("[".concat(this.getTrackId(),"] setEnabled to false error"),i.toString()),i}F.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,n){if(!this._enabled)throw new Ge(H.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=Nd(t),re("USE_STANDARD_BITRATE_DEFAULT")&&(delete t.bitrateMax,delete t.bitrateMin),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);const i=Ki(this._config);i.encoderConfig=t;const s=Mw(i);(Xo()||mo()||Su())&&(s.deviceId=void 0),F.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(s));try{await this._originMediaStreamTrack.applyConstraints(s),this.updateMediaStreamTrackResolution()}catch(o){const c=new Ge(H.UNEXPECTED_ERROR,o.toString());throw F.error("[".concat(this.getTrackId(),"] applyConstraints error"),c.toString()),c}this._config=i,this._constraints=s,this._originalConstraints=s,this._encoderConfig=t,this._hints.indexOf(Ni.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await ei(this,rt.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(F)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((mo()||Su())&&this._enabled&&!this._isClosed&&Ai.duringInterruption){const t=async()=>{Ai.off(js.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(F.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Ai.on(js.IOS_INTERRUPTION_END,t)}else F.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Tc.TRACK_ENDED)}async renewMediaStreamTrack(t){const n=t||this._constraints,i=_l.searchDeviceIdByName(this._deviceName);if(i&&!n.deviceId&&(n.deviceId={exact:i}),this._enabled){const s=await Dd({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(s.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Ai.off(js.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Ai.off(js.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],i=this._encoderConfig;t&&(i=Ji(Ji({},i),Nd(t))),i=Bg(i);const s=Oi(8,"track-cam-cloned-"),o=new mie(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,Bg(Ji(Ji({},this._config),{},{encoderConfig:i})),Bg(this._constraints),Bg(this._scalabilityMode),this._optimizationMode,s);return t&&i&&o.setEncoderConfiguration(i),F.debug("clone track from ".concat(this.getTrackId()," to ").concat(s,", clone ").concat(n)),o}bindProcessorContextEvents(){this.processorContext.on(yc.REQUEST_UPDATE_CONSTRAINTS,(async(t,n,i)=>{try{const s=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(s),n()}catch(s){i(s)}})),this.processorContext.on(yc.REQUEST_CONSTRAINTS,(async t=>{t(this._originMediaStreamTrack.getSettings())}))}},Ce(Ei.prototype,"setDevice",[vV,yV],Object.getOwnPropertyDescriptor(Ei.prototype,"setDevice"),Ei.prototype),Ce(Ei.prototype,"setEnabled",[RV,CV,bV],Object.getOwnPropertyDescriptor(Ei.prototype,"setEnabled"),Ei.prototype),Ce(Ei.prototype,"setEncoderConfiguration",[IV,AV],Object.getOwnPropertyDescriptor(Ei.prototype,"setEncoderConfiguration"),Ei.prototype),Ce(Ei.prototype,"close",[Zl],Object.getOwnPropertyDescriptor(Ei.prototype,"close"),Ei.prototype),Ei);function ZD(e,t,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=Ji(Ji({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?F.debug("[".concat(e,"] set content hint to"),n.optimizationMode):F.debug("[".concat(e,"] set content hint failed")))):F.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var wV,OV,NV,Pd,kd,DV,PV,kV,LV,MV,Ga,Wa;class Iv extends Cv{getUserId(){return this._userId}constructor(t,n,i,s){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(s.clientId,"_").concat(Oi(5,""))),Le(this,"_userId",void 0),Le(this,"_uintId",void 0),Le(this,"_isDestroyed",!1),Le(this,"store",void 0),Le(this,"processor",void 0),Le(this,"processorContext",void 0),this._userId=n,this._uintId=i,this.store=s}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,F.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let tf=(wV=Ye({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),OV=Ye({argsMap:e=>[e.getTrackId()]}),NV=Ye({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Pd=Ye({argsMap:e=>[e.getTrackId()]}),Ce((kd=class extends Iv{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==gs.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,i,s){super(e,t,n,i),Le(this,"_videoVisibleTimer",null),Le(this,"_previousVideoVisibleStatus",void 0),Le(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),Le(this,"trackMediaType",rc.VIDEO),Le(this,"_videoWidth",void 0),Le(this,"_videoHeight",void 0),Le(this,"_player",void 0),Le(this,"_prePlayer",void 0),Le(this,"processorDestination",void 0),Le(this,"processorContext",void 0),this._prePlayer=s,this.updateMediaStreamTrackResolution(),this.processorContext=new cx(this.getTrackId(),"remote"),this.processorDestination=new ax(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Cd((()=>{F.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")}),"remoteVideoTrackGetStatsWarning"),Sc(this,rt.GET_STATS)||Ji({},sc)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(vc.PLAY_START),typeof e=="string"){const i=document.getElementById(e);i?e=i:(F.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}F.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=Ji(Ji({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(n);else{let i=!1,s=!1;e instanceof HTMLVideoElement?(this._player=new XD(n),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,s=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,i=this._player.videoState>0,this._player.updateConfig(n)):this._player=new QD(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(vc.FIRST_FRAME_DECODED),s&&this.safeEmit(vc.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=o=>{this.safeEmit(vc.VIDEO_STATE_CHANGED,o)},i&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(vc.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}}),re("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(vc.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,F.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Lw(this._originMediaStreamTrack).then((e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t})).catch(Cw)}_updatePlayerSource(){F.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),i={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n?.parentElement},{element:s,slot:o}=i;if(this.isPlaying&&s instanceof HTMLVideoElement&&o instanceof HTMLElement){const c=bD.checkOneElementVisible(s),d=Object.assign({},c);if(d.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=d.visible;const u=fe.reportApiInvoke(null,{tag:Tr.TRACER,name:Cn.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});d.visible?u.onSuccess("Video is visible"):u.onSuccess("Invisible because of ".concat(d.reason))}return d}return}catch(n){throw new Ge(H.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Ge(H.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ds.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ds.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Sh.SEI_RECEIVED,e)}}).prototype,"play",[wV],Object.getOwnPropertyDescriptor(kd.prototype,"play"),kd.prototype),Ce(kd.prototype,"stop",[OV],Object.getOwnPropertyDescriptor(kd.prototype,"stop"),kd.prototype),Ce(kd.prototype,"pipe",[NV],Object.getOwnPropertyDescriptor(kd.prototype,"pipe"),kd.prototype),Ce(kd.prototype,"unpipe",[Pd],Object.getOwnPropertyDescriptor(kd.prototype,"unpipe"),kd.prototype),kd),$l=(DV=Ye({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),PV=Ye({argsMap:(e,t)=>[e.getTrackId(),t]}),kV=Ye({argsMap:e=>[e.getTrackId()]}),LV=Ye({argsMap:e=>[e.getTrackId()]}),MV=Ye({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Ga=Ye({argsMap:e=>[e.getTrackId()]}),Ce((Wa=class extends Iv{get isPlaying(){return this._useAudioElement?wi.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,i){super(e,t,n,i),Le(this,"trackMediaType",rc.AUDIO),Le(this,"_source",void 0),Le(this,"_useAudioElement",!0),Le(this,"_volume",100),Le(this,"processorContext",void 0),Le(this,"processorDestination",void 0),Le(this,"_played",!1),Le(this,"_bypassWebAudio",!1),re("DISABLE_WEBAUDIO")?(this._source=new dx,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new rx(e,!0),re("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(fl.RECEIVE_TRACK_BUFFER,(()=>{this.safeEmit(vc.FIRST_FRAME_DECODED)})),this.processorContext=new KD(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new lx(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(fl.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})}))}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(fl.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(fl.ON_AUDIO_BUFFER),this._source.on(fl.ON_AUDIO_BUFFER,(n=>e(n)))}setVolume(e){this._volume=e,this._useAudioElement?wi.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!Dw())throw new Ge(H.NOT_SUPPORTED,"your browser does not support setting the audio output device");await wi.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Cd((()=>{F.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")}),"remoteAudioTrackGetStatsWarning"),Sc(this,rt.GET_STATS)||Ji({},h4)}play(){F.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(F.debug("[".concat(this.getTrackId(),"] use audio element to play")),wi.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){F.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?wi.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];F.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&wi.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Ge(H.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Ge(H.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Ge(H.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(ds.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})),this.processorDestination.on(ds.ON_NODE,(e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(ds.ON_TRACK),this.processorDestination.removeAllListeners(ds.ON_NODE)}}).prototype,"setVolume",[DV],Object.getOwnPropertyDescriptor(Wa.prototype,"setVolume"),Wa.prototype),Ce(Wa.prototype,"setPlaybackDevice",[PV],Object.getOwnPropertyDescriptor(Wa.prototype,"setPlaybackDevice"),Wa.prototype),Ce(Wa.prototype,"play",[kV],Object.getOwnPropertyDescriptor(Wa.prototype,"play"),Wa.prototype),Ce(Wa.prototype,"stop",[LV],Object.getOwnPropertyDescriptor(Wa.prototype,"stop"),Wa.prototype),Ce(Wa.prototype,"pipe",[MV],Object.getOwnPropertyDescriptor(Wa.prototype,"pipe"),Wa.prototype),Ce(Wa.prototype,"unpipe",[Ga],Object.getOwnPropertyDescriptor(Wa.prototype,"unpipe"),Wa.prototype),Wa);const nf=new class extends rr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Le(this,"_lastHiddenTime",0),Le(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",(()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),F.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)}))}};class v4 extends rr{constructor(t,n){super(),Le(this,"trackMediaType",rc.DATA),Le(this,"_version",1),Le(this,"_type",3),Le(this,"_config",void 0),Le(this,"_originDataChannel",void 0),Le(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Le(this,"_dataStreamPacketHandler",{serialize:i=>i,deserialize:i=>i}),Le(this,"_datachannelEventMap",new Map),this._config=t,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return re("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,n;return(t=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new De(((t,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();const i=setTimeout((()=>{var s;n(new Ge(H.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((s=this._originDataChannel)===null||s===void 0?void 0:s.id)))}),1e4);this._originDataChannel.onopen=()=>{clearTimeout(i),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(i),new Ge(H.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new Ge(H.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))}))}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[Hn.OPEN,Hn.CLOSE,Hn.ERROR].forEach((n=>{const i=()=>{this.emit(n)};this._datachannelEventMap.set(n,i),t.addEventListener(n,i)}))}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach((n=>{let[i,s]=n;t.removeEventListener(i,s)})),this._datachannelEventMap.clear()}}class Rz extends v4{constructor(t){super(t),Le(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const i=n.data.slice(0,this._dataStreamPacketHeader.byteLength),s=new DataView(i).getUint8(3);if(s!==this.id)return void(re("SHOW_DATASTREAM2_LOG")&&F.debug("invalid datachannel id: ".concat(s," !== ").concat(this.id)));let o=n.data.slice(this._dataStreamPacketHeader.byteLength);o=this._dataStreamPacketHandler.deserialize(o),this.emit(Hn.MESSAGE,o)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class $D extends v4{send(t){if(this._originDataChannel){let n=t;n=this._dataStreamPacketHandler.serialize(t);const i=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);i.set(new Uint8Array(this._dataStreamPacketHeader),0),i.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(i.buffer)}}}function xw(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout((()=>XT.revokeObjectURL(e)),0),new Worker(XT.createObjectURL(e))}const eP=71,Vw=1,Fw=2,tP=1,Bm=2;var E_=(function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e})(E_||{});function wC(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=e.getUint8(0);if(n!==eP)return;const i=e.getUint16(1),s=Vw+Fw+i,o=new Uint8Array(e.byteLength-s);o.set(new Uint8Array(e.buffer,s,e.byteLength-s));const c={m:n,tlvLen:i,tlv:[],frame:o};let d=Vw+Fw;for(;d<s;){const u=e.getUint8(d),p=e.getUint16(d+tP),m=tP+Bm;if(u===E_.AUDIO_LEVEL){let g=e.getUint8(d+m);for(let T=1;T<p;T++)g=g<<8|e.getUint8(d+m+T);c.tlv.push({tag:u,length:p,value:t?127^g>>1:127&g})}else if(u===E_.METADATA||u===E_.AUDIO_64_BIT_PTS){const g=new Uint8Array(p);for(let T=0;T<p;T++)g[T]=e.getUint8(d+m+T);c.tlv.push({tag:u,length:p,value:g})}d+=m+p}return c}const Av=new Map,g_=127,jm=1e-10,OC=139/13,NC=new Map;function nP(e,t,n){const i="".concat(e,"-").concat(t,"-").concat(n);let s=0;return NC.has(i)?s=NC.get(i):(s=Math.log((function(c,d){const u=c-d;d<u&&(d=u);let p=1;for(let m=c,g=1;m>d;m--,g++)p=p*m/g;return p})(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(n)+n*e,NC.set(i,s)),s<jm&&(s=jm),s}function y4(e,t,n){const i=t.length,s=e.length/i;let o=!1;for(let c=0,d=0;c<i;c++){let u=0;for(let p=d+s;d<p;d++)e[d]>n&&u++;t[c]!==u&&(t[c]=u,o=!0)}return o}window.cache=NC;let R4=0;class C4{constructor(t){Le(this,"id",void 0),Le(this,"immediates",[]),Le(this,"lastNonSilence",-1),Le(this,"immediateSpeechActivityScore",jm),Le(this,"lastLevelChangedTime",Date.now()),Le(this,"levels",[]),Le(this,"longs",[]),Le(this,"longSpeechActivityScore",jm),Le(this,"mediums",[]),Le(this,"mediumSpeechActivityScore",jm),Le(this,"minLevel",0),Le(this,"nextMinLevel",0),Le(this,"nextMinLevelWindowLength",0),Le(this,"energyScore",0),this.id=t||"".concat(R4++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const t=this.immediates,n=this.levels,i=this.minLevel+OC;let s=!1;for(let o=0;o<t.length;++o){let c=n[o];c<i&&(c=0);const d=Math.floor(c/OC);t[o]!==d&&(t[o]=d,s=!0)}return s}computeLongs(){return y4(this.mediums,this.longs,4)}computeMediums(){return y4(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=nP(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=nP(this.longs[0],10,47),this.longSpeechActivityScore>jm&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=nP(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(zS(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,n){if(this.lastLevelChangedTime<=n){this.lastLevelChangedTime=n;let i=t;return t<0&&(i=0),t>g_&&(i=g_),this.levels.unshift(i),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(i),i>=this.minLevel+OC?i:i/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let n=Math.sqrt(this.minLevel*this.nextMinLevel);n<0?n=0:n>g_&&(n=g_),this.minLevel=n,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class UV{constructor(t){Le(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{const n=this.algorithm.runInDecisionMaker(this);n<=0?t=!0:setTimeout(this.execute.bind(this),n)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class xV{constructor(t,n,i){Le(this,"isDominant",void 0),Le(this,"energyRanking",void 0),Le(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=n,this.energyScore=i}}class DC extends rr{constructor(t){super(),Le(this,"dominantId",null),Le(this,"lastDecisionTime",0),Le(this,"lastLevelChangedTime",0),Le(this,"lastLevelIdleTime",0),Le(this,"relativeSpeechActivities",[]),Le(this,"speakers",new Map),Le(this,"enableSilence",!1),Le(this,"timeoutToSilenceInterval",0),Le(this,"decisionMaker",null),Le(this,"loudest",[]),Le(this,"numLoudestToTrack",3),Le(this,"energyExpireTimeMs",250),Le(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,n!=null&&(this.energyExpireTimeMs=n),i!=null&&(this.energyAlphaPct=i),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some((n=>n.id===t))}levelChanged(t,n){const i=Date.now(),s=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<i&&(this.lastLevelChangedTime=i,this.maybeStartDecisionMaker());const o=s.levelChanged(n,i);return this.updateLoudestList(s,o,i)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach((n=>{this.speakers.has(n.id)||this.speakers.set(n.id,n)}))}removeSpeakers(t){t.forEach((n=>{this.speakers.delete(n.id)}))}getOrCreateSpeaker(t){let n=this.speakers.get(t);return n||(n=new C4(t),this.speakers.set(t,n),this.maybeStartDecisionMaker()),n}updateLoudestList(t,n,i){const s=t.id===this.dominantId;if(n<0){let u=0;for(;u<this.loudest.length&&this.loudest[u]!==t;)++u;return new xV(s,u,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*n+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new xV(s,0,t.energyScore);const o=i-this.energyExpireTimeMs;let c=0;for(;c<this.loudest.length;){const u=this.loudest[c];if(u.getLastLevelChangedTime()<o&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(c,1);else if(u.id!==t.id)++c;else if(this.loudest.splice(c,1),this.loudest.length<this.numLoudestToTrack)break}let d=0;for(;d<this.loudest.length&&!(this.loudest[d].energyScore<t.energyScore);)++d;return d<this.numLoudestToTrack&&(this.loudest.splice(d,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new xV(s,d,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new UV(this),this.decisionMaker.execute())}makeDecision(t){let n=null,i=null;const s=this.speakers.size;let o=null;if(s===0)o=null;else if(s===1){var c;const d=cs(c=this.speakers).call(c).next().value;this.enableSilence&&d&&(o=d.id,d.evaluateSpeechActivityScores(t),t-d.lastNonSilence>this.timeoutToSilenceInterval&&(o=null))}else{let d=this.dominantId==null?null:this.speakers.get(this.dominantId);if(d==null){const m=this.speakers.entries().next();m.value&&(o=m.value[0],d=m.value[1])}else o=d.id;d?.evaluateSpeechActivityScores(t);const u=this.relativeSpeechActivities;let p=2;for(const m of this.speakers.entries()){const[g,T]=m;if(T===d)continue;T.evaluateSpeechActivityScores(t);for(let w=0;w<u.length;++w){const k=d==null?jm:d.getSpeechActivityScore(w);u[w]=Math.log(T.getSpeechActivityScore(w)/k)}const R=u[0],I=u[1],A=u[2];R>3&&I>2&&A>0&&I>p&&(p=I,o=g)}this.enableSilence&&d!=null&&o===d.id&&t-d.lastNonSilence>this.timeoutToSilenceInterval&&(o=null)}o==null&&!this.enableSilence||o===this.dominantId||(n=this.dominantId,this.dominantId=o,i=this.dominantId),i==null&&!this.enableSilence||i===n||this.emit("ActiveSpeakerChanged",i)}_runInDecisionMaker(){const t=Date.now(),n=300-(t-this.lastLevelIdleTime);let i=0;n<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):i=n;let s=300-(t-this.lastDecisionTime);return s<=0&&(this.lastDecisionTime=t,this.makeDecision(t),s=300-(Date.now()-t)),s>0&&i>s&&(i=s),i}timeoutIdleLevels(t){const n=[];for(const s of cs(i=this.speakers).call(i)){var i;const o=t-s.getLastLevelChangedTime();36e5<o&&(this.dominantId==null||s.id!==this.dominantId)?n.push(s.id):300<o&&s.levelTimedOut()}n.forEach((s=>this.speakers.delete(s)))}}const El=new Map;let Ld=null,Bw=null;const Kg=3;let Kc=[];const Md=new Map,iP=new Map;class rP{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,n){Le(this,"id",void 0),Le(this,"track",void 0),Le(this,"score",0),Le(this,"active",!0),Le(this,"muted",!1),Le(this,"timer",0),Le(this,"actives",0),Le(this,"inactives",0),this.id=t,this.track=n,this.setActive(Md.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const t=this.active;this.active=this.activeRate>=.8;const{actives:n,inactives:i}=(function(){const s=[],o=[];return Array.from(cs(Md).call(Md)).forEach((c=>{c.active?s.push(c):o.push(c)})),{actives:s,inactives:o}})();if(n.length>3){let s;n.forEach((o=>{(!s||s.score>o.score)&&(s=o)})),s&&s.setActive(!1)}if(n.length<3&&i.length>0){let s;i.forEach((o=>{(!s||s.score<o.score)&&o.id!==this.id&&(s=o)})),s&&t&&!this.active&&(s.samples>40&&s.activeRate-this.activeRate>.4?s.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const t=(function(n){let i;return Array.from(cs(Md).call(Md)).forEach((s=>{!s.active||s.id===n||s.samples<40||(!i||s.score<i.score)&&(i=s)})),i})(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const t=(function(n){let i;return Array.from(cs(Md).call(Md)).forEach((s=>{s.active||s.id===n||s.samples<40||(!i||s.score>i.score)&&(i=s)})),i})(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout((()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()}),1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let jw;function Gw(e){const t=Md.get(e);t&&(Md.delete(e),t.clearTimer())}const sP=new Map,VV=new Map,Ww="video/h264",oP="video/h265";function FV(e,t,n){let i=new Uint8Array(e,t,n),s=[],o=0;for(;s.length<n;)o+3<n&&i[o]===0&&i[o+1]===0&&i[o+2]===3&&(i[o+3]===0||i[o+3]===1||i[o+3]===2||i[o+3]===3)?(s.push(i[o],i[o+1],i[o+3]),o+=4):(s.push(i[o]),o++);return new Uint8Array(s)}function BV(e){const t=e.length;let n=[],i=0;for(;i<t;)i+2<t&&e[i]===0&&e[i+1]===0&&(e[i+2]===0||e[i+2]===1||e[i+2]===2||e[i+2]===3)?(n.push(e[i],e[i+1],3,e[i+2]),i+=3):(n.push(e[i]),i++);return new Uint8Array(n)}function Hw(e){if(e.length<5)return"";let t=-1;for(let s=0;s<e.length-3;s++){if(e[s]===0&&e[s+1]===0&&e[s+2]===1){t=s;break}if(s<e.length-4&&e[s]===0&&e[s+1]===0&&e[s+2]===0&&e[s+3]===1){t=s;break}}if(t===-1)return"";const n=t+(e[t+2]===0?4:3);if(n>=e.length)return"";const i=e[n];return 128&i?"":(i>>1&63)>=32||n+1<e.length&&(248&e[n+1])==0?oP:(31&i)<=31?Ww:""}const zg=new Map,Kw=new Map;(function(){const e=$n();on.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),on.getStreamFromExtension=e.name===mi.CHROME&&Number(e.version)>34,on.supportUnifiedPlan=(function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n})(),on.supportMinBitrate=e.name===mi.CHROME||e.name===mi.EDGE,on.supportSetRtpSenderParameters=(function(){const t=$n();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!_h()||!(!Xo()&&!fh())||t.name===mi.FIREFOX&&Number(t.version)>=64)})(),e.name===mi.SAFARI&&(Number(e.version)>=14?on.supportDualStream=!0:on.supportDualStream=!1),on.webAudioMediaStreamDest=(function(){const t=$n();return!(t.name===mi.SAFARI&&Number(t.version)<12)})(),on.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",on.supportWebGL=typeof WebGLRenderingContext<"u",on.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,_h()||(on.webAudioWithAEC=!0),on.supportShareAudio=(function(){const t=$n();return(t.os===sn.WIN_10||t.os===sn.WIN_81||t.os===sn.WIN_7||t.os===sn.LINUX||t.os===sn.MAC_OS||t.os===sn.CHROMIUM_OS)&&t.name===mi.CHROME&&Number(t.version)>=74})(),on.supportDataChannel=!!(Ev(76)||SD(68)||BU(14)),on.supportPCSetConfiguration=(function(){const t=window.RTCPeerConnection;return!fi()&&!!t&&t.prototype.setConfiguration instanceof Function})(),on.supportWebRTCEncodedTransform=Ev(87)||FU()||SD(117),on.supportWebRTCInsertableStream=(function(){const t=$n();return(t.name===mi.CHROME||t.name===mi.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window})(),on.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,on.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,sr((()=>{on.supportDualStreamEncoding=(function(){const t=$n();return!!re("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&re("CHROME_DUAL_STREAM_USE_ENCODING"))})(),F.debug("browser ua: ",navigator.userAgent),F.info("browser info: ",e),F.info("browser compatibility: ",on)}))})();const b4=["CHINA","GLOBAL"],Yg=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],yh=[],Rh=[];function Gm(e,t){return!!t&&yh.some((n=>n.uid===e&&n.channelName===t))}function jV(){return Rh.length>0}var I4=XA.forEach,A4=Qu("forEach")?[].forEach:function(e){return I4(this,e,arguments.length>1?arguments[1]:void 0)};Ut({target:"Array",proto:!0,forced:[].forEach!==A4},{forEach:A4});var Cz=to("Array","forEach"),bz=fc,Iz=bi,Az=ee,GV=Cz,WV=Array.prototype,wz={DOMTokenList:!0,NodeList:!0},Oz=function(e){var t=e.forEach;return e===WV||Az(WV,e)&&t===WV.forEach||Iz(wz,bz(e))?GV:t},Nz=S(Oz),w4=Ao,O4=fp;Ut({target:"Object",stat:!0,forced:y((function(){O4(1)}))},{keys:function(e){return O4(w4(e))}});var Dz=S(xn.Object.keys),Pz=S(ap),kz=S(Fy),N4=Ut,D4=tl,Lz=$f,P4=vn,k4=lt,Mz=Vr,Uz=Gi,xz=dA,Vz=Fn,Fz=Do,Bz=O2("slice"),HV=Vz("species"),KV=Array,jz=Math.max;N4({target:"Array",proto:!0,forced:!Bz},{slice:function(e,t){var n,i,s,o=Uz(this),c=Mz(o),d=k4(e,c),u=k4(t===void 0?c:t,c);if(D4(o)&&(n=o.constructor,(Lz(n)&&(n===KV||D4(n.prototype))||P4(n)&&(n=n[HV])===null)&&(n=void 0),n===KV||n===void 0))return Fz(o,d,u);for(i=new(n===void 0?KV:n)(jz(u-d,0)),s=0;d<u;d++,s++)d in o&&xz(i,s,o[d]);return i.length=s,i}});var Gz=to("Array","slice"),Wz=ee,zV=Gz,YV=Array.prototype,Hz=function(e){var t=e.slice;return e===YV||Wz(YV,e)&&t===YV.slice?zV:t},Dt=S(Hz);function At(e,t,n,i,s){var o,c,d,u={};return Nz(o=Dz(i)).call(o,(function(p){u[p]=i[p]})),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=Pz(c=kz(d=Dt(n).call(n)).call(d)).call(c,(function(p,m){return m(e,t,p)||p}),u),s&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(s):void 0,u.initializer=void 0),u.initializer===void 0?(b2(e,t,u),null):u}let PC=(function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e})({}),Ud=(function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e})({}),bs=(function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e})({}),Mt=(function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e})({}),gt=(function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e})({}),Pt=(function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e})({}),st=(function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e})({}),Yt=(function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e})({}),Ln=(function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e})({}),an=(function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e})({}),Wt=(function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e})({}),cn=(function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e})({});function wv(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw F.error("Invalid Channel Name ".concat(e)),new Pe(H.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Ch(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||pC(e,1,255)))throw new Pe(H.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&F.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Wm=(function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e})({});const qV={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},zw={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function XV(e,t){ls(e.url,"".concat(t,".url"),1,1e3,!1),Gr(e.x)||Mi(e.x,"".concat(t,".x"),0,1e4),Gr(e.y)||Mi(e.y,"".concat(t,".y"),0,1e4),Gr(e.width)||Mi(e.width,"".concat(t,".width"),0,1e4),Gr(e.height)||Mi(e.height,"".concat(t,".height"),0,1e4),Gr(e.zOrder)||Mi(e.zOrder,"".concat(t,".zOrder"),0,255),Gr(e.alpha)||Mi(e.alpha,"".concat(t,".alpha"),0,1,!1)}const qg={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let S_=(function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e})({}),Is=(function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e})({}),Gs=(function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e})({});function ac(e){if(!e.channelName)throw new Pe(H.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new Pe(H.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&ls(e.token,"info.token",1,2047),Ch(e.uid),wv(e.channelName),!0}let oo=(function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e})({}),ko=(function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e})({}),wa=(function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e})({}),vi=(function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e})({}),gn=(function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e})({}),Qs=(function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e})({}),Ws=(function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e})({}),dn=(function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e})({}),Ri=(function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e})({});const pa=[Ri.AFRICA,Ri.ASIA,Ri.CHINA,Ri.EUROPE,Ri.GLOBAL,Ri.INDIA,Ri.JAPAN,Ri.NORTH_AMERICA,Ri.OCEANIA,Ri.OVERSEA,Ri.SOUTH_AMERICA];let Lo=(function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e})({});const Xg={CHINA:{},ASIA:{CODE:Lo.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Lo.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Lo.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Lo.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Lo.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Lo.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Lo.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Lo.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Lo.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Lo.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Lo.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Lo.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Lo.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};Um&&(Xg.CHINA={CODE:Lo.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let kC=(function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e})({});function JV(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class QV extends rr{constructor(t,n){super(),Q(this,"onICEConnectionStateChange",void 0),Q(this,"onConnectionStateChange",void 0),Q(this,"onDTLSTransportStateChange",void 0),Q(this,"onDTLSTransportError",void 0),Q(this,"onICETransportStateChange",void 0),Q(this,"onFirstAudioReceived",void 0),Q(this,"onFirstVideoReceived",void 0),Q(this,"onFirstAudioDecoded",void 0),Q(this,"onFirstVideoDecoded",void 0),Q(this,"onFirstVideoRender",void 0),Q(this,"onFirstVideoDecodedTimeout",void 0),Q(this,"onSelectedLocalCandidateChanged",void 0),Q(this,"onSelectedRemoteCandidateChanged",void 0),Q(this,"onICECandidateError",void 0),Q(this,"getLocalVideoStats",void 0)}}class vt extends QV{constructor(t,n){super(t,n),Q(this,"establishPromise",void 0)}}let dt=(function(e){return e.VIDEO="video",e.AUDIO="audio",e})({}),As=(function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e})({}),T_=(function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e})({});const $e=["disconnected","failed"];let He=(function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e})({}),ut=(function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e})({}),kt=(function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e})({}),$o=(function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e})({}),kr=(function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e})({}),So=(function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e})({}),rf=(function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e})({}),fa=(function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e})({}),ea=(function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e})({}),gl=(function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e})({}),Lr=(function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e})({}),Mr=(function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e})({}),Ru=(function(e){return e.ABORT="abort",e})({}),Jg=(function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e})({}),Kz=(function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e})({});const LC={[PC.ACCESS_POINT]:{[Mt.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Mt.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Mt.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Mt.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Mt.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Mt.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Mt.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Mt.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[Mt.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Mt.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Mt.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Mt.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Mt.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Mt.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Mt.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Mt.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Mt.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Mt.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[PC.UNILBS]:{[bs.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[bs.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[bs.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[bs.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[bs.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[bs.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[bs.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[bs.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[bs.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[bs.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[bs.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[bs.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[PC.STRING_UID_ALLOCATOR]:{[Ud.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Ud.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Ud.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function MC(e){const t=LC[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===PC.ACCESS_POINT){const i=e%1e4;if(i.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(i.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const Yw={[gt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[gt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[gt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[gt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[gt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[gt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[gt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[gt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[gt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[gt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[gt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[gt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[gt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[gt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[gt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[gt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[gt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[gt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[gt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[gt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[gt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[gt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[gt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[gt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[gt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[gt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[gt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[gt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[gt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[gt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[gt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[gt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[gt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[gt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[gt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[gt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[gt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[gt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[gt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[gt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[gt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[gt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[gt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[gt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[gt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[gt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[gt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[gt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[gt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[gt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[gt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[gt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[gt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[gt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[gt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[gt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[gt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[gt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[gt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[gt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[gt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[gt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[gt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[gt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function UC(e){return Yw[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function aP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function qw(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?aP(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aP(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}function ZV(e,t){if(typeof e=="string")return e;const{proxy:n,host:i,port:s}=e;if(t){const o=re("JOIN_GATEWAY_FALLBACK_PORT")||443;return o===443?"wss://".concat(i,"/ws/?p=").concat(Number(s)+150):"wss://".concat(i,":").concat(o,"/ws/?p=").concat(Number(s)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(i,"&p=").concat(s):"wss://".concat(i,":").concat(s)}const zz=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,Yz=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,qz=/wss:\/\/(.+):([0-9]+)\/?/,Xz=/wss:\/\/(.[^\/]+)\/?/;let Jz=0;class L4{constructor(t,n){Q(this,"id",0),Q(this,"store",void 0),Q(this,"recordIndex",void 0),Q(this,"websockets",[]),Q(this,"try443PortDuration",2e3),Q(this,"forceCloseWSDuration",5e3),Q(this,"try443PortTimeout",null),Q(this,"forceCloseTimeout",null),Q(this,"isTry443PortFailed",!1),Q(this,"isNormalPortFailed",!1),Q(this,"useDoubleDomain",!1),Q(this,"useProxy",!1),Q(this,"startTime",Date.now()),this.id=++Jz,this.try443PortDuration=re("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach((t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()})),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;const n=Date.now()-this.startTime;for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];F.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...s)}createWebSocket(t,n,i){this.logger("createWebSocket:",t,{isTry443Port:n,hasTimeoutDetection:i});const s=re("GATEWAY_DOMAINS"),o=Date.now(),c=[],d=s.find((T=>{var R;return Re(R=t.host).call(R,T)}));d||(this.useDoubleDomain=!1);const u=[];if(this.useDoubleDomain)s.forEach((T=>{u.push(ZV(qw(qw({},t),{},{host:t.host.replace(d,T)}),n))}));else{const T=qw({},t);if(n&&d){const R=s.find((I=>I!==d));R&&(T.host=T.host.replace(d,R))}u.push(ZV(T,n))}try{u.forEach((T=>{const R=new WebSocket(T);R.binaryType="arraybuffer",c.push(R),this.logger("ws is connecting:",R.url)}))}catch(T){if(this.logger("ws create failed"),c.forEach((R=>R.close())),c.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,n,i);if(!n&&Number(t.port)!==443)return this.createWebSocket(t,!0,i);throw new Pe(H.WS_ERR,"init websocket failed! Error: ".concat(T.toString()))}const p=xg();this.store&&this.store.recordJoinChannelService({urls:c.map((T=>T.url)),service:"gateway"},this.recordIndex),c.forEach((T=>{T.onopen=()=>{this.logger("onopen: ws ".concat(T.url," open cost ").concat(Date.now()-o,"ms")),this.websockets.forEach((R=>{R!==T&&(R.onopen=null,R.onclose=null,R.onmessage=null,R.close(),this.logger("close backup websocket: ".concat(R.url)))})),this.websockets.length=0,p.resolve(T)},T.onclose=R=>{this.logger("onclose: ws ".concat(T.url," closed cost ").concat(Date.now()-o,"ms state: ").concat(T.readyState));const I=c.every((A=>A.readyState===WebSocket.CLOSED||A.readyState===WebSocket.CLOSING));this.logger("".concat(n?"443":"47xx"," websocket closed, all failed: ").concat(I)),I&&(n||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(R.reason)),p.reject({code:R.code,reason:Ws.A_ROUND_WS_FAILED})):!n&&I&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),g()),n?this.isTry443PortFailed=I:this.isNormalPortFailed=I},T.onmessage=R=>this.logger("".concat(T.url," onmessage: ").concat(R.data))})),this.websockets.push(...c);const m=()=>{this.websockets.forEach((T=>T.readyState!==WebSocket.OPEN&&T.close()))},g=()=>{if(p.isResolved)return m();$n().os===sn.MAC_OS&&fi()&&m(),this.createWebSocket(t,!0,!0).then((T=>{p.resolve(T)})).catch((T=>{this.isNormalPortFailed&&p.reject(T),this.logger("try 443 port to create ws failed")})),this.forceCloseTimeout=window.setTimeout((()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",p.isResolved),this.forceCloseTimeout=null,m()}),this.forceCloseWSDuration)};return i||(()=>{if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout((()=>{this.forceCloseTimeout=null,m()}),this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout((()=>{this.logger("2s timeout, isWebsocket created: ",p.isResolved),this.try443PortTimeout=null,g()}),this.try443PortDuration)})(),p.promise}chooseBestWebsocket(t,n,i,s){return this.useDoubleDomain=!!n,typeof t=="string"&&(t=(function(o){let c,d,u;return[,c,d,u]=o.match(zz)||[],c||([,d,u]=o.match(Yz)||[]),d&&u||([,d,u]=o.match(qz)||[]),d&&u||([,d]=o.match(Xz)||[]),d||F.warning("un-destructible url: ",o),{proxy:c,host:d,port:u||"443"}})(t)),this.recordIndex=s,this.useProxy=!!t.proxy,i&&this.useProxy&&(F.warn("cannot use 443 only when use proxy"),i=!1),this.createWebSocket(t,!!i,!1).finally((()=>this.clearTimeout()))}}function $V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}class cP extends rr{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var n;Re(n=["tryNext","recover"]).call(n,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(cn.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(cn.CONNECTED):this._state==="closed"?this.emit(cn.CLOSED):this._state==="failed"&&this.emit(cn.FAILED))}resetReconnectCount(t){F.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2],s=arguments.length>3&&arguments[3]!==void 0&&arguments[3],o=arguments.length>4&&arguments[4]!==void 0&&arguments[4],c=arguments.length>5?arguments[5]:void 0;super(),Q(this,"_websocketUrl",null),Q(this,"connectionID",0),Q(this,"currentURLIndex",0),Q(this,"urls",[]),Q(this,"_reconnectMode","tryNext"),Q(this,"reconnectReason",void 0),Q(this,"_initMutex",void 0),Q(this,"name",void 0),Q(this,"_state","closed"),Q(this,"reconnectInterrupter",void 0),Q(this,"websocket",void 0),Q(this,"retryConfig",void 0),Q(this,"reconnectCount",0),Q(this,"forceCloseTimeout",5e3),Q(this,"onlineReconnectListener",void 0),Q(this,"useCompress",void 0),Q(this,"tryDoubleDomain",!1),Q(this,"use443PortOnly",!1),Q(this,"wsInflateLength",0),Q(this,"wsDeflateLength",0),Q(this,"closeEstablishingWs",(()=>{})),Q(this,"store",void 0),Q(this,"joinGatewayRecordIndex",void 0),this.store=c,this.name=t,this.retryConfig=(function(g){for(var T=1;T<arguments.length;T++){var R=arguments[T]!=null?arguments[T]:{};T%2?$V(Object(R),!0).forEach((function(I){Q(g,I,R[I])})):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(R)):$V(Object(R)).forEach((function(I){Object.defineProperty(g,I,Object.getOwnPropertyDescriptor(R,I))}))}return g})({},n),this.useCompress=i,this.tryDoubleDomain=s,this.use443PortOnly=o,this._initMutex=new ro("websocket",c?c.clientId:void 0);const{timeout:d,timeoutFactor:u}=n,p=Math.max(300,Math.floor(3*d/5)),m=Math.max(1.2,Math.floor(8*u)/10);ja.ONLINE&&(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m),$r.on(Ys.NETWORK_STATE_CHANGE,((g,T)=>{g!==T&&(this.resetReconnectCount("network state change: ".concat(T," -> ").concat(g)),g===ja.ONLINE?(this.retryConfig.timeout=p,this.retryConfig.timeoutFactor=m):(this.retryConfig.timeout=d,this.retryConfig.timeoutFactor=u))}))}getConnection(){return this.websocket||void 0}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=n,this.urls=t,this.state="connecting";try{var s;const o=xg(),c=this.urls[this.currentURLIndex];(s=this.store)===null||s===void 0||s.beforeConnect(),(function(d){return!(RC()||re("USE_NEW_TOKEN")||!re("ENABLE_PREALLOC_PC")&&(d==null||!d.autoSubscribe||re("FORCE_DISABLE_AUTO_SUB")))})(this.store)&&this.emit(rf.PRE_CONNECT_PC),this.createWebSocketConnection(c).then(o.resolve).catch(o.reject),this.once(cn.CLOSED,(()=>{o.reject(new Ge(H.WS_DISCONNECT))})),this.once(cn.CONNECTED,o.resolve),await o.promise}catch{}finally{i()}}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const i=this.websocket;n?setTimeout((()=>i.close()),500):i.close(),this.websocket=void 0,this._websocketUrl=null}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void F.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),F.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const i=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),i&&i.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Ge(H.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(i){throw new Ge(H.WS_ERR,"send websocket message error"+i.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var n;const i=xg();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const s=m=>{var g;(g=this.store)===null||g===void 0||g.signalChannelOpen(),F.debug("[".concat(this.name,"] websocket opened:"),m),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),i.resolve()},o=async m=>{var g;if(F.debug("[".concat(this.name,"] websocket close ").concat((g=this.websocket)===null||g===void 0?void 0:g.url,", code: ").concat(m.code,", reason: ").concat(m.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)i.reject(new Ge(H.WS_DISCONNECT,"websocket close: ".concat(m.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=m.reason,this.state="reconnecting");const T=Sc(this,cn.WILL_RECONNECT,this.reconnectMode,m.reason)||this.reconnectMode,R=await this.reconnectWithAction(T);if(this.state==="closed")return void F.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!R)return i.reject(new Ge(H.WS_DISCONNECT,"websocket reconnect failed: ".concat(m.code))),this.close(!0);i.resolve()}},c=m=>{this.emit(cn.ON_MESSAGE,m)},d=m=>{F.warn("[".concat(this.connectionID,"] ws open error ").concat(m))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),re("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=re("GATEWAY_WSS_ADDRESS")),F.debug("[".concat(this.name,"] start connect, url:"),t);const u=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var p;this._websocketUrl=ZV(t);const m=await this.chooseBestWebsocketConnection(t);this.websocket=m,s&&s(this.websocket.url),this.websocket.onclose=o,this.websocket.onmessage=c,this.websocket.onerror=d,(p=this.store)===null||p===void 0||p.recordJoinChannelService({endTs:Date.now(),status:"success"},u),this.joinGatewayRecordIndex=u}catch(m){const g=this.state==="closed",T=m instanceof Ge,R=T&&m.code===H.WS_ABORT,I=T&&m.code===H.WS_ERR,A=T?m.message:m&&(m.reason||m.toString());F.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(A)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:R?"aborted":"error",errors:[m]},u),g||I?(i.reject(g?new Ge(H.WS_DISCONNECT,"websocket is closed: ".concat(A)):new Ge(H.WS_ERR,"init websocket failed: ".concat(A))),I&&F.error("[".concat(this.name,"] init websocket failed: ").concat(A))):o&&o(m)}return i.promise}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;F.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||$r.isOnline||!$r.onlineWaiter||(this.onlineReconnectListener=$r.onlineWaiter.then((()=>{this.onlineReconnectListener=void 0})));let i=!0;if(this.reconnectInterrupter=()=>i=!1,n){const c=Tu(this.reconnectCount,this.retryConfig);F.debug("[".concat(this.name,"] wait ").concat(c,"ms to reconnect websocket, mode: ").concat(t)),await De.race([In(c),this.onlineReconnectListener||new De((()=>{}))])}if(this._state==="closed"||!i)return!1;this.reconnectCount+=1;const s=async(c,d)=>{this.emit(cn.RECONNECT_CREATE_CONNECTION,d),await this.createWebSocketConnection(c)};try{if(t==="retry")await s(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);F.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await s(this.urls[this.currentURLIndex],t)}else t==="recover"&&(F.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await On(this,cn.REQUEST_NEW_URLS),this.currentURLIndex=0,await s(this.urls[this.currentURLIndex],t))}catch(c){var o;F.error("[".concat(this.name,"] reconnect failed ").concat(c&&c.toString()));const d=c==null||(o=c.data)===null||o===void 0?void 0:o.desc;return Array.isArray(d)&&Re(d).call(d,"dynamic key expired")?(this.emit(cn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,n)}return!0}}class Ov extends cP{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){const i=xg(),s=(function(c,d){return new L4(c,d)})(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{F.debug("[choose-best-ws] close establishing websockets"),s.closeAllWebsockets(),i.reject(new Ge(H.WS_ABORT,"choose best websocket aborted"))};const o=re("GATEWAY_DOMAINS");return F.debug("[choose-best-ws] currentDomain: ",t,", domains: ",o,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),s.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,n).then(i.resolve).catch(i.reject),i.promise.finally((()=>{this.closeEstablishingWs=void 0}))}}class Xw extends cP{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,n){return new De(((i,s)=>{let o=!1;const c=[];this.closeEstablishingWs=()=>{F.debug("[choose-best-ws] close establishing websockets"),c.forEach((I=>{I.onclose=null,I.onopen=null,I.onmessage=null,I.close()})),s(new Ge(H.WS_ABORT,"choose best websocket aborted"))};const d=re("GATEWAY_DOMAINS");let u;const p=t.indexOf("?h="),m=d.find((I=>p!==-1?Re(t).call(t,I,p):Re(t).call(t,I)));F.debug("[choose-best-ws] currentDomain: ",m,", domains: ",d);let g=!this.tryDoubleDomain||!m;if(!g&&m){var T;const I=Date.now();try{d.forEach((A=>{const w=p===-1?t.replace(m,A):t.substr(0,p)+t.substr(p).replace(m,A),k=new WebSocket(w);k.binaryType="arraybuffer",c.push(k),F.debug("[choose-best-ws] ws is connecting:",k.url)}))}catch{for(F.debug("[choose-best-ws] ws create failed, fallback to single url"),c.forEach((w=>w.close()));c.length;)c.pop();g=!0}(T=this.store)===null||T===void 0||T.recordJoinChannelService({urls:c.map((A=>A.url)),service:"gateway"},n),c.forEach((A=>{A.onopen=()=>{if(o)return;const w=Date.now()-I;F.debug("[choose-best-ws] ws open cost ".concat(w,"ms")),c.filter((k=>k!==A)).forEach((k=>{F.debug("[choose-best-ws]close backup websocket: ".concat(k.url)),k.close()})),o=!0,i(A)},A.onclose=w=>{u=w,!o&&(c.find((k=>!(k.readyState===WebSocket.CLOSED||k.readyState===WebSocket.CLOSING)))||(F.debug("[choose-best-ws] all websocket is closed"),o=!0,s(u)))},A.onmessage=w=>{F.debug("[choose-best-ws]".concat(A.url," onmessage: ").concat(w.data))}})),In(this.forceCloseTimeout).then((()=>{c.forEach((A=>{A.readyState!==WebSocket.OPEN&&A.close()}))}))}if(g){var R;let I;F.debug("[choose-best-ws] use single url: ",t),(R=this.store)===null||R===void 0||R.recordJoinChannelService({urls:[t],service:"gateway"},n);try{I=new WebSocket(t),c.push(I),I.binaryType="arraybuffer"}catch(A){const w=new Ge(H.WS_ERR,"init websocket failed! Error: ".concat(A.toString()));return F.error("[".concat(this.name,"]").concat(w)),void s(w)}I.onopen=()=>{i(I)},I.onclose=A=>{s(A)},I.onmessage=A=>{F.debug("[choose-best-ws]".concat(I.url," onmessage: ").concat(A.data))},In(this.forceCloseTimeout).then((()=>{I&&I.readyState!==WebSocket.OPEN&&I.close()}))}})).then((i=>(this.closeEstablishingWs=void 0,i))).catch((i=>{throw this.closeEstablishingWs=void 0,i}))}}class Qz extends rr{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Pt.CONNECTED?this.emit(st.WS_CONNECTED):t===Pt.RECONNECTING?this.emit(st.WS_RECONNECTING,this._websocketReconnectReason):t===Pt.CLOSED&&this.emit(st.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),Q(this,"_disconnectedReason",void 0),Q(this,"_websocketReconnectReason",void 0),Q(this,"_connectionState",Pt.CLOSED),Q(this,"reconnectToken",void 0),Q(this,"websocket",void 0),Q(this,"openConnectionTime",void 0),Q(this,"clientId",void 0),Q(this,"lastMsgTime",Date.now()),Q(this,"uploadCache",[]),Q(this,"uploadCacheInterval",void 0),Q(this,"rttRolling",new Iw(5)),Q(this,"pingpongTimer",void 0),Q(this,"wsInflateDataTimer",void 0),Q(this,"pingpongTimeoutCount",0),Q(this,"ortc",void 0),Q(this,"joinResponse",void 0),Q(this,"multiIpOption",void 0),Q(this,"initError",void 0),Q(this,"spec",void 0),Q(this,"store",void 0),Q(this,"onWebsocketMessage",(i=>{if(i.data instanceof ArrayBuffer)return void this.emit(st.ON_BINARY_DATA,i.data);const s=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const o="res-@".concat(s._id);this.emit(o,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")){if(this.emit(s._type,s._message),s._type===an.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===an.ON_USER_BANNED)switch(s._message.error_code){case 14:this.close(Ti.UID_BANNED);break;case 15:this.close(Ti.IP_BANNED);break;case 16:this.close(Ti.CHANNEL_BANNED)}if(s._type===an.ON_USER_LICENSE_BANNED)switch(s._message.error_code){case gt.ERR_LICENSE_MISSING:this.close(Ti.LICENSE_MISSING);break;case gt.ERR_LICENSE_EXPIRED:this.close(Ti.LICENSE_EXPIRED);break;case gt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ti.LICENSE_MINUTES_EXCEEDED);break;case gt.ERR_LICENSE_PERIOD_INVALID:this.close(Ti.LICENSE_PERIOD_INVALID);break;case gt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ti.LICENSE_MULTIPLE_SDK_SERVICE);break;case gt.ERR_LICENSE_ILLEGAL:this.close(Ti.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new Ov("gateway-".concat(this.clientId),this.spec.retryConfig,!0,re("JOIN_GATEWAY_USE_DUAL_DOMAIN"),re("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===Pt.CONNECTED&&this.reconnect("retry",vr.OFFLINE)}))}async request(t,n,i,s){const o=Oi(6,""),c={_id:o,_type:t,_message:n},d=this.websocket.connectionID,u=()=>new De(((I,A)=>{if(this.connectionState===Pt.CONNECTED)return I();const w=()=>{this.off(st.WS_CLOSED,k),I()},k=()=>{this.off(st.WS_CONNECTED,w),A(new Pe(H.WS_ABORT))};this.once(st.WS_CONNECTED,w),this.once(st.WS_CLOSED,k),t!==Yt.PUBLISH&&t!==Yt.PUBLISH_DATASTREAM&&t!==Yt.SUBSCRIBE&&t!==Yt.SUBSCRIBE_DATASTREAM&&t!==Yt.UNSUBSCRIBE&&t!==Yt.UNSUBSCRIBE_DATASTREAM&&t!==Yt.UNPUBLISH&&t!==Yt.UNPUBLISH_DATASTREAM&&t!==Yt.CONTROL&&t!==Yt.RESTART_ICE||this.once(st.DISCONNECT_P2P,(()=>{A(new Pe(H.DISCONNECT_P2P))})),t!==Yt.PUBLISH&&t!==Yt.RESTART_ICE||this.once(st.ABORT_P2P_EXECUTION,(()=>{A(new Pe(H.DISCONNECT_P2P))}))}));if(this.connectionState!==Pt.CONNECTING&&this.connectionState!==Pt.RECONNECTING||t===Yt.JOIN||t===Yt.REJOIN||await u(),this.websocket.sendMessage(c,!0),s)return;const p=new De(((I,A)=>{let w=!1;const k=(j,K)=>{w=!0,I({isSuccess:j==="success",message:K||{}}),this.off(st.WS_CLOSED,L),this.off(st.WS_RECONNECTING,L),this.emit(st.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(o),k);const L=()=>{A(new Pe(H.WS_ABORT,"type: ".concat(t))),this.off(st.WS_CLOSED,L),this.off(st.WS_RECONNECTING,L),this.off("res-@".concat(o),k)};this.once(st.WS_CLOSED,L),this.once(st.WS_RECONNECTING,L),In(re("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==d||w||(F.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(st.REQUEST_TIMEOUT,t,n))}))}));let m=null;try{m=await p}catch(I){if(this.connectionState===Pt.CLOSED||t===Yt.LEAVE)throw new Pe(H.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?I.throw():t===Yt.JOIN||t===Yt.REJOIN?null:(await u(),await this.request(t,n))}if(m.isSuccess)return m.message;const g=Number(m.message.error_code||m.message.code),T=UC(g),R=new Pe(H.UNEXPECTED_RESPONSE,"".concat(T.desc,": ").concat(m.message.error_str),{code:g,data:m.message,desc:T.desc});return T.action==="success"?m.message:(F.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(g,", message: ").concat(T.desc,", action: ").concat(T.action)),g===gt.ERR_TOO_MANY_BROADCASTERS?((t===Yt.JOIN||t===Yt.REJOIN)&&(this.initError=R,this.close()),R.throw()):T.action==="failed"?R.throw():T.action==="quit"?(this.initError=R,this.close(),R.throw()):(g===gt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,F.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",vr.MULTI_IP)):this.reconnect(T.action,vr.SERVER_ERROR),t===Yt.JOIN||t===Yt.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new De((i=>{const s=o=>{(!n||n(o))&&(this.off(t,s),i(o))};this.on(t,s)}))}uploadWRTCStats(t){if(!this.store.sessionId)return void F.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Ln.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const o=re("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>o&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==Pt.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)}),re("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new De(((n,i)=>{this.once(st.WS_CONNECTED,(()=>n(this.joinResponse))),this.once(st.WS_CLOSED,(s=>i(this.initError||new Pe(H.WS_ABORT,s)))),this.connectionState=Pt.CONNECTING,this.websocket.init(t).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval((()=>{this.handleWsInflateData()}),2e4)}))}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Ti.LEAVE,this.connectionState=Pt.CLOSED,F.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(st.ABORT_P2P_EXECUTION),this.store.signalConnected();const t=await On(this,st.REQUEST_JOIN_INFO);this.store.joinReq();const n=await this.request(Yt.JOIN,t);if(this.ortc=t?.ortc,this.store.joinRep(),!n)return this.emit(st.REPORT_JOIN_GATEWAY,Ws.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(st.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Pt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Pe(H.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Kr(this,st.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(Yt.REJOIN,t);return!!n&&(this.connectionState=Pt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach((i=>{this.emit(an.ON_USER_ONLINE,{uid:i.uid}),i.audio&&this.emit(an.ON_ADD_AUDIO_STREAM,{uid:i.uid,uint_id:i.uint_id,audio:!0,ssrcId:i.audio_ssrc}),i.video&&this.emit(an.ON_ADD_VIDEO_STREAM,{uid:i.uid,uint_id:i.uint_id,video:!0,ssrcId:i.video_ssrc}),i.audio_mute?this.emit(an.MUTE_AUDIO,{uid:i.uid}):this.emit(an.UNMUTE_AUDIO,{uid:i.uid}),i.video_mute?this.emit(an.MUTE_VIDEO,{uid:i.uid}):this.emit(an.UNMUTE_VIDEO,{uid:i.uid}),i.audio_enable_local?this.emit(an.ENABLE_LOCAL_AUDIO,{uid:i.uid}):this.emit(an.DISABLE_LOCAL_AUDIO,{uid:i.uid}),i.video_enable_local?this.emit(an.ENABLE_LOCAL_VIDEO,{uid:i.uid}):this.emit(an.DISABLE_LOCAL_VIDEO,{uid:i.uid}),i.audio||i.video||this.emit(an.ON_REMOVE_STREAM,{uid:i.uid,uint_id:i.uint_id})})),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){if(!this.ortc)return!1;const n={downgrade_codec:t,ortc:this.ortc};return!!await this.request(Yt.DOWNGRADE_CODEC,n)}handleNotification(t){F.debug("[".concat(this.clientId,"] receive notification: "),t);const n=UC(t.code);if(t.code===28&&"detail"in t&&(F.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(st.RECOVER_NOTIFICATION,t.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ti.UID_BANNED),void this.close()):void this.reconnect(n.action,vr.SERVER_ERROR);F.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=re("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(F.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>re("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",vr.TIMEOUT):this.request(Yt.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),re("REPORT_STATS")&&this.send(Yt.PING_BACK,{pingpongElapse:i})})).catch((i=>{}))}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(Ln.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(cn.RECONNECT_CREATE_CONNECTION,(t=>{this.emit(st.WS_RECONNECT_CREATE_CONNECTION,t)})),this.websocket.on(cn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(cn.CLOSED,(()=>{this.connectionState=Pt.CLOSED})),this.websocket.on(cn.FAILED,(()=>{this._disconnectedReason=Ti.NETWORK_ERROR,this.connectionState=Pt.CLOSED})),this.websocket.on(cn.RECONNECTING,(t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Pt.CONNECTED?this.connectionState=Pt.RECONNECTING:this.connectionState=Pt.CONNECTING})),this.websocket.on(cn.WILL_RECONNECT,((t,n,i)=>{const s=Kr(this,st.IS_P2P_DISCONNECTED),o=s||t!=="retry";s&&t==="retry"&&(F.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",n=Ws.P2P_DISCONNECTED),o&&(F.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(st.REPORT_JOIN_GATEWAY,n||Ws.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(st.DISCONNECT_P2P)),i(t)})),this.websocket.on(cn.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((t=>{F.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",vr.SERVER_ERROR)})):this.join().catch((t=>{if(this.emit(st.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof Pe){if(t.code===H.UNEXPECTED_RESPONSE&&t.data.code===gt.ERR_NO_AUTHORIZED)return this.initError=new Pe(H.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Ti.TOKEN_EXPIRE);F.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",vr.SERVER_ERROR):(this.initError=t,this.close())}}))})),this.websocket.on(cn.REQUEST_NEW_URLS,((t,n)=>{On(this,st.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)})),this.websocket.on(cn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(an.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})),this.websocket.on(rf.PRE_CONNECT_PC,(()=>{this.emit(st.PRE_CONNECT_PC)}))}}let ws=(function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e})({}),Ss=(function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e})({});function Jw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function sf(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Jw(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Jw(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}function of(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(re("TURN_DOMAIN")):(F.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function xC(e){try{const t=re("GATEWAY_DOMAINS").concat(re("TURN_DOMAIN")).find((n=>Re(e).call(e,n)));return t?e.split(".".concat(t))[0].replace(/-/g,"."):e}catch{return F.debug("serverUrlToIp error, fallback to url",e),e}}function zc(e,t){e.addresses||(e.addresses=[]);const n=(function(d,u){if(re("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return d.map((g=>{let{ip:T,port:R}=g;return{address:"".concat(T,":").concat(R)}}));const p=re("GATEWAY_DOMAINS");let m=p[1]&&Re(u).call(u,p[1])?1:0;return d.map((g=>{let{domain_prefix:T,port:R,ip:I}=g;if(T)return{address:"".concat(T,".").concat(p[m++%p.length],":").concat(R)};const A=/^[\.\:\d]+$/.test(I),w=A?"".concat(I.replace(/[^\d]/g,"-"),".").concat(p[m++%p.length],":").concat(R):"".concat(I,":").concat(R);return A||F.debug("Cannot recognized as ip address: ".concat(I,", use as host3")),{ip:I,port:R,address:w}}))})(e.addresses,t),i=Array.isArray(e.detail)&&e.detail[18];if(i&&typeof i=="string"){const d=i.split(";");for(let u=0;u<d.length;u++){var s;const p=dr(s=d[u]).call(s);n[u]&&p&&(n[u].ip6=p)}}const o=e.detail&&e.detail.candidate;let c;if(o){const[d,u]=o.split(":");d&&u&&(c={port:Number(u),ip:d,address:"".concat(d,":").concat(u)})}return{gatewayAddrs:n,apGatewayAddress:c,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function Sl(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function eF(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(Sl(t.width),"x").concat(Sl(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function VC(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function FC(e,t){let n,i,s;switch(t){case Ss.CHOOSE_SERVER:i=4096,s="choose server";break;case Ss.CLOUD_PROXY:i=1048576,s="proxy";break;case Ss.CLOUD_PROXY_5:i=4194304,s="proxy5";break;case Ss.CLOUD_PROXY_FALLBACK:i=4194310,s="proxy fallback";break;default:throw new Pe(H.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach((o=>{o.buffer&&o.buffer.flag===i&&(n={code:o.buffer.code,addresses:(o.buffer.edges_services||[]).map((c=>sf(sf({},c),{},{ticket:o.buffer.cert}))),server_ts:e.enter_ts,uid:o.buffer.uid,cid:o.buffer.cid,cname:o.buffer.cname,detail:sf(sf({},o.buffer.detail),e.detail),flag:o.buffer.flag,opid:e.opid,cert:o.buffer.cert})})),!n)throw new Pe(H.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(s," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return n}async function lP(e,t){return await De.all(e.addresses.map((async n=>({address:of(n.ip),tcpport:n.port,udpport:n.port,username:t&&re("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():go.username,password:t&&re("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await Sr(t.toString()):go.password}))))}function v_(e,t){const n=t.getMediaStreamTrack(!0).getSettings(),i=t.videoHeight||n.height,s=t.videoWidth||n.width;return i&&s?Math.max(Math.min(i,s)/Math.min(Sl(e.height),Sl(e.width)),1):(F.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function xd(e){let{candidateType:t,relayProtocol:n,type:i,address:s,port:o,protocol:c}=e;const d={candidateType:t,relayProtocol:n,protocol:c};if(i!=="local-candidate"){const u=s.split(".");u.length>=4&&(u[1]="*",u[2]="*"),d.address=u.join("."),d.port=o}return d}function y_(e){const t=e.split(":"),n=e.split(/[-.]/),i=Re(e).call(e,"-")?"-":".";let s=e;return t.length>1?n.length>1?(n[1]="**",s=n[0]+i+"**:"+t[t.length-1]):s=t.length>2?t[0]+i+"**:"+t[t.length-1]:"**:"+t[t.length-1]:n.length>1&&(s=n[0]+i+"**"),s}function Qw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:re("SVC_MODE");if(re("ENABLE_SVC"))return(function(t){return t in gC})(e)?e:gC.L1T3}const Zw={[dt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[dt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function Hm(e,t,n){t.forEach((i=>{var s;const o=Zw[e].find((d=>{var u;let{key:p}=d;return Re(u=i.extensionName).call(u,p)}));if(!o)return;const c=n.find((d=>{let{extensionName:u}=d;return Re(u).call(u,o.key)}));c&&Re(s=c.extensionName).call(s,"gdpr_forbidden")&&(i.extensionName=c.extensionName)}))}function Nv(e,t){t.forEach((n=>{var i;const s=Zw[e].find((o=>{var c;let{key:d}=o;return Re(c=n.extensionName).call(c,d)}));Re(i=n.extensionName).call(i,"gdpr_forbidden")&&s&&(n.extensionName=s.extensionName)}))}function $w(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Re(e).call(e,"abs-send-time")}function e0(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Re(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function tF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function BC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?tF(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tF(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}function bh(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:s,filterVideoFec:o,filterAudioFec:c,filterAudioCodec:d,filterVideoCodec:u,unsupportedVideoUplinkCodec:p,unsupportedVideoDownlinkCodec:m}=t,{useXR:g}=n;let T=[],R=[],I=[],A=[],w=!1,k=!1;if(Qo(e).mediaDescriptions.forEach((j=>{i&&i!==j.attributes.direction||(j.media.mediaType!=="video"||w||(R=j.attributes.payloads,A=j.attributes.extmaps,w=!0),j.media.mediaType!=="audio"||k||(T=j.attributes.payloads,I=j.attributes.extmaps,k=!0))})),!A||R.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!I||T.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(R.forEach((j=>{var K;(K=j.rtpMap)!==null&&K!==void 0&&K.clockRate&&(j.rtpMap.clockRate=parseInt(j.rtpMap.clockRate)),g&&j.rtcpFeedbacks.push({type:"rrtr"})})),T.forEach((j=>{var K;(K=j.rtpMap)!==null&&K!==void 0&&K.clockRate&&(j.rtpMap.clockRate=parseInt(j.rtpMap.clockRate)),g&&j.rtcpFeedbacks.push({type:"rrtr"})})),s&&(T=T.filter((j=>{var K;return((K=j.rtpMap)===null||K===void 0?void 0:K.encodingName.toLowerCase())!=="rtx"})),R=R.filter((j=>{var K;return((K=j.rtpMap)===null||K===void 0?void 0:K.encodingName.toLowerCase())!=="rtx"}))),o){const j=R.filter((Y=>{var se;return/(red)|(ulpfec)|(flexfec)/i.test(((se=Y.rtpMap)===null||se===void 0?void 0:se.encodingName)||"")})),K=td(j,R).map((Y=>Y.payloadType)),W=[...j.map((Y=>Y.payloadType)),...K];R=R.filter((Y=>!Re(W).call(W,Y.payloadType)))}if(c&&(T=T.filter((j=>{var K;return!/(red)|(ulpfec)|(flexfec)/i.test(((K=j.rtpMap)===null||K===void 0?void 0:K.encodingName)||"")}))),d&&d?.length>0&&(T=T.filter((j=>{var K;return Re(d).call(d,((K=j.rtpMap)===null||K===void 0?void 0:K.encodingName.toLowerCase())||"")}))),u&&u?.length>0){const j=R.filter((K=>{var W;return Re(u).call(u,((W=K.rtpMap)===null||W===void 0?void 0:W.encodingName.toLowerCase())||"")}));R=j.concat(s?[]:td(j,R))}const L=re("UNSUPPORTED_VIDEO_CODEC");if(L&&L.length>0){const j=R.filter((Y=>Y.rtpMap&&Re(L).call(L,Y.rtpMap.encodingName.toLowerCase()))),K=td(j,R),W=j.concat(K).map((Y=>Y.payloadType));R=R.filter((Y=>!Re(W).call(W,Y.payloadType))),F.debug("unsupportedVideoCodec: ".concat(L,", toBeRemoved: ").concat(W))}if(p&&p.length>0&&i==="sendonly"){const j=R.filter((Y=>Y.rtpMap&&Re(p).call(p,Y.rtpMap.encodingName.toLowerCase()))),K=td(j,R),W=j.concat(K).map((Y=>Y.payloadType));R=R.filter((Y=>!Re(W).call(W,Y.payloadType))),F.debug("unsupportedVideoUplinkCodec: ".concat(p,", toBeRemoved: ").concat(W))}if(m&&m.length>0&&i==="recvonly"){const j=R.filter((Y=>Y.rtpMap&&Re(m).call(m,Y.rtpMap.encodingName.toLowerCase()))),K=td(j,R),W=j.concat(K).map((Y=>Y.payloadType));R=R.filter((Y=>!Re(W).call(W,Y.payloadType))),F.debug("unsupportedVideoDownlinkCodec: ".concat(m,", toBeRemoved: ").concat(W))}return{audioCodecs:T,videoCodecs:R,audioExtensions:I,videoExtensions:A}}function Km(e){const t=Qo(e);let n,i;for(const s of t.mediaDescriptions){if(!n){const o=s.attributes.iceUfrag,c=s.attributes.icePwd;if(!o||!c)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:o,icePwd:c}}if(!i){const o=s.attributes.fingerprints;o.length>0&&(i={fingerprints:o})}}if(!i&&t.attributes.fingerprints.length>0&&(i={fingerprints:t.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function nF(e,t){const n=[],i=e.attributes.ssrcGroups.filter((c=>c.semantic==="FID")),s=e.attributes.ssrcGroups.find((c=>c.semantic==="SIM")),o=e.attributes.ssrcs;if(s)s.ssrcIds.forEach((c=>{var d;const u=(d=i.find((p=>p.ssrcIds[0]===c)))===null||d===void 0?void 0:d.ssrcIds[1];n.push({ssrcId:c,rtx:t?u:void 0})}));else if(i.length>0){const c=i[0].ssrcIds[0],d=i[0].ssrcIds[1];n.push({ssrcId:c,rtx:t?d:void 0})}else{if(o.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:o[0].ssrcId})}return n}function iF(e,t,n){const{cname:i}=e;let s=[];t&&(s=jC(t)),s.length===0&&(s=e.iceParameters.candidates.map((m=>({foundation:m.foundation,componentId:"1",transport:m.protocol,priority:m.priority.toString(),connectionAddress:m.ip,port:m.port.toString(),type:m.type,extension:{}}))),F.debug("Using candidates from gateway."));const o={fingerprints:e.dtlsParameters.fingerprints.map((m=>({hashFunction:m.algorithm,fingerprint:m.fingerprint})))},c={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let d;switch(e.dtlsParameters.role){case"server":d="passive";break;case"client":d="active";break;case"auto":d="actpass"}const u=zm(e.rtpCapabilities),p=[];return Array.isArray(n)&&n.length>0&&n.forEach((m=>{p.push({kind:dt.VIDEO,ssrcMsg:[{ssrcId:m.v,rtx:m.v_rtx}],mslabel:"".concat(m.v,"_").concat(m.a)},{kind:dt.AUDIO,ssrcMsg:[{ssrcId:m.a}],mslabel:"".concat(m.v,"_").concat(m.a)})})),{dtlsParameters:o,iceParameters:c,candidates:s,rtpCapabilities:u,setup:d,cname:i,preSSRCs:p}}function jC(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],F.debug("Using remote candidate from AP ".concat(y_(e.ip),":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),F.debug("Using IPV6 remote candidate from AP ".concat(y_(e.ip6),":").concat(e.port)))),t}function R_(e,t,n){const i=[],s=[];return e.forEach((o=>{let{ssrcId:c,rtx:d}=o;const u=Oi(8,"track-"),p={ssrcId:c,attributes:BC({label:u,mslabel:n=n||Oi(10,""),msid:"".concat(n," ").concat(u)},t&&{cname:t})};if(i.push(p),d!==void 0){const m={ssrcId:d,attributes:BC({label:u,mslabel:n,msid:"".concat(n," ").concat(u)},t&&{cname:t})};i.push(m),s.push({semantic:"FID",ssrcIds:[c,d]})}})),e.length>1&&s.push({semantic:"SIM",ssrcIds:e.map((o=>{let{ssrcId:c}=o;return c}))}),{ssrcs:i,ssrcGroups:s}}function Qg(e,t){t instanceof Rr&&e.attributes.payloads.forEach((n=>{var i;const s=(i=n.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase();if(!s||["opus","pcmu","pcma","g722"].indexOf(s)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),s==="opus"&&typeof re("OPUS_PTIME")=="number"?n.fmtp.parameters.ptime=re("OPUS_PTIME"):n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const o=t._encoderConfig;o&&(s!=="pcmu"&&s!=="pcma"&&s!=="g722"&&(o.bitrate&&!fi()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*o.bitrate))),o.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(o.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(o.sampleRate)),o.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1")),t instanceof Uw&&s==="opus"&&t._config.DTX&&(n.fmtp.parameters.usedtx="1"))}))}function t0(e){const t=e.attributes.unrecognized.findIndex((n=>n.attField==="x-google-flag"&&n.attValue==="conference"));t!==-1&&e.attributes.unrecognized.splice(t,1)}function dP(e,t){var n;if(!(t instanceof zi&&t._encoderConfig&&t._hints.indexOf(Ni.SCREEN_TRACK)===-1))return;const i=t._encoderConfig;ai().supportMinBitrate&&i.bitrateMin&&e.attributes.payloads.forEach((s=>{var o,c;Re(o=["h264","h265","vp8","vp9","av1"]).call(o,((c=s.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))})),ai().supportMinBitrate&&!Re(n=t._hints).call(n,Ni.LOW_STREAM)&&i.bitrateMax&&e.attributes.payloads.forEach((s=>{var o,c;Re(o=["h264","h265","vp8","vp9","av1"]).call(o,((c=s.rtpMap)===null||c===void 0?void 0:c.encodingName.toLowerCase())||"")&&(s.fmtp||(s.fmtp={parameters:{}}),s.fmtp.parameters["x-google-start-bitrate"]="".concat(re("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))}))}function n0(e){if(e.media.mediaType!=="video")return;const t=$n();if(t.name!==mi.SAFARI&&t.os!==sn.IOS)return;const n=e.attributes.extmaps.findIndex((i=>/video-orientation/g.test(i.extensionName)));n!==-1&&e.attributes.extmaps.splice(n,1)}function i0(e,t,n){if(!t)return;let i,s;if(e.media.mediaType==="video"?(i=n.videoExtensions,s=n.videoCodecs):(i=n.audioExtensions,s=n.audioCodecs),t.twcc===!0){const o=i.find((c=>e0(c.extensionName)));if(o){const c=o.extensionName;e.attributes.extmaps.find((u=>e0(u.extensionName)))||e.attributes.extmaps.push({entry:o.entry,extensionName:c}),(function(u,p){return p.filter((m=>!!u.find((g=>g.payloadType===m.payloadType&&!!g.rtcpFeedbacks.find((T=>T.type==="transport-cc"))))))})(s,e.attributes.payloads).forEach((u=>{u.rtcpFeedbacks.find((p=>p.type==="transport-cc"))||u.rtcpFeedbacks.push({type:"transport-cc"})}))}}else if(t.twcc===!1){const o=e.attributes.extmaps.findIndex((c=>e0(c.extensionName)));o!==-1&&e.attributes.extmaps.splice(o,1),e.attributes.payloads.forEach((c=>{const d=c.rtcpFeedbacks.findIndex((u=>u.type==="transport-cc"));d!==-1&&c.rtcpFeedbacks.splice(d,1)}))}if(t.remb===!0){const o=i.find((c=>$w(c.extensionName)));if(o){const c=o.extensionName;e.attributes.extmaps.find((u=>u.extensionName===c))||e.attributes.extmaps.push({entry:o.entry,extensionName:c}),(function(u,p){return p.filter((m=>!!u.find((g=>g.payloadType===m.payloadType&&!!g.rtcpFeedbacks.find((T=>T.type==="goog-remb"))))))})(s,e.attributes.payloads).forEach((u=>{u.rtcpFeedbacks.find((p=>p.type==="goog-remb"))||u.rtcpFeedbacks.push({type:"goog-remb"})}))}}else if(t.remb===!1){const o=e.attributes.extmaps.findIndex((c=>$w(c.extensionName)));o!==-1&&e.attributes.extmaps.splice(o,1),e.attributes.payloads.forEach((c=>{const d=c.rtcpFeedbacks.findIndex((u=>u.type==="goog-remb"));d!==-1&&c.rtcpFeedbacks.splice(d,1)}))}}function rF(e,t,n){if(fi()||e.media.mediaType!=="video"||!(t instanceof zi)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!re("SIMULCAST")||n==="vp9"&&re("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;const i=n==="vp8"?2:t._scalabilityMode.numSpatialLayers,s=e.attributes.ssrcs[0],o=e.attributes.ssrcGroups.find((d=>d.semantic==="FID"&&d.ssrcIds[0]===s.ssrcId)),c={semantic:"SIM",ssrcIds:[s.ssrcId]};for(let d=1;d<i;d++)e.attributes.ssrcs.push({ssrcId:s.ssrcId+d,attributes:Ki(s.attributes)}),c.ssrcIds.push(s.ssrcId+d),o&&(e.attributes.ssrcs.push({ssrcId:o.ssrcIds[1]+d,attributes:Ki(s.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[s.ssrcId+d,o.ssrcIds[1]+d]}));e.attributes.ssrcGroups.unshift(c)}async function sF(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const i=(await n.createOffer()).sdp,{send:s,recv:o,sendrecv:c}=(function(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;const m=bh(p,d,u,"sendonly"),g=bh(p,d,u,"recvonly"),T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},R={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ed(m,g,"videoExtensions",T,R,I),ed(m,g,"videoCodecs",T,R,I),ed(m,g,"audioExtensions",T,R,I),ed(m,g,"audioCodecs",T,R,I),re("RAISE_H264_BASELINE_PRIORITY")){const A=[],w=[];if(I.videoCodecs.forEach(((k,L)=>{var j;if(((j=k.rtpMap)===null||j===void 0?void 0:j.encodingName.toLocaleLowerCase())==="h264"){var K,W;const Y=I.videoCodecs[L+1],se=Y&&lF(k,Y),de=(K=k.fmtp)===null||K===void 0?void 0:K.parameters["profile-level-id"],ge=(W=k.fmtp)===null||W===void 0?void 0:W.parameters["packetization-mode"];!de||de!==re("FIRST_H264_PROFILE_LEVEL_ID")||re("FIRST_PACKETIZATION_MODE")&&ge!==re("FIRST_PACKETIZATION_MODE")?se?w.push([k,Y]):w.push([k]):se?A.push([k,Y]):A.push([k])}})),A.length>0&&w.length>0){F.debug("raising H264 baseline profile priority"),I.videoCodecs.forEach(((L,j)=>{var K;if(((K=L.rtpMap)===null||K===void 0?void 0:K.encodingName.toLocaleLowerCase())==="h264"){const W=lF(L,I.videoCodecs[j+1]),Y=A.shift()||w.shift()||[];Y.length>0&&(W?I.videoCodecs.splice(j,2,...Y):I.videoCodecs.splice(j,1,...Y))}}));const k=R.videoCodecs.filter((L=>{var j,K;return((j=L.rtpMap)===null||j===void 0?void 0:j.encodingName.toLocaleLowerCase())==="h264"&&((K=L.fmtp)===null||K===void 0?void 0:K.parameters["profile-level-id"])!==re("FIRST_H264_PROFILE_LEVEL_ID")}));if(k.length>0){const L=td(k,R.videoCodecs).map((K=>K.payloadType)),j=[...k.map((K=>K.payloadType)),...L];R.videoCodecs=R.videoCodecs.filter((K=>!Re(j).call(j,K.payloadType)))}re("FILTER_SEND_H264_BASELINE")&&(T.videoCodecs=T.videoCodecs.filter((L=>{var j,K;return!(((j=L.rtpMap)===null||j===void 0?void 0:j.encodingName.toLocaleLowerCase())==="h264"&&((K=L.fmtp)===null||K===void 0?void 0:K.parameters["profile-level-id"])!==re("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:T,recv:R,sendrecv:I}}return{send:T,recv:R,sendrecv:I}})(e,t,i);try{n.close()}catch{}return{send:s,recv:o,sendrecv:c}}function Cu(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=bh(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ed(e,t,"videoExtensions",n,i,s),ed(e,t,"videoCodecs",n,i,s),ed(e,t,"audioExtensions",n,i,s),ed(e,t,"audioCodecs",n,i,s),re("RAISE_H264_BASELINE_PRIORITY")){const o=s.videoCodecs.findIndex((c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]==="42001f"));if(o!==-1){const c=s.videoCodecs.findIndex((d=>d.rtpMap&&d.rtpMap.encodingName.toLocaleLowerCase()==="h264"));if(c<o){F.debug("raising H264 baseline profile priority");const d=s.videoCodecs[o];s.videoCodecs.splice(o,1),s.videoCodecs.splice(c,0,d)}c!==-1&&(i.videoCodecs=i.videoCodecs.filter((d=>!(d.rtpMap&&d.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&d.fmtp&&d.fmtp.parameters["profile-level-id"]!=="42001f"))))}}return{send:n,recv:i,sendrecv:s}}function ed(e,t,n,i,s,o){if(n==="videoExtensions"||n==="audioExtensions"){const c=[];return e[n].forEach((d=>{t[n].some(((u,p)=>{if(d.entry===u.entry&&d.extensionName===u.extensionName)return c.push(p),!0}))?o[n].push(d):i[n].push(d)})),void t[n].forEach(((d,u)=>{c.indexOf(u)===-1&&s[n].push(d)}))}if(n==="videoCodecs"||n==="audioCodecs"){const c=[];return e[n].forEach((d=>{t[n].some(((u,p)=>{if(d.payloadType===u.payloadType&&JSON.stringify(d)===JSON.stringify(u))return c.push(p),!0}))?o[n].push(d):i[n].push(d)})),void t[n].forEach(((d,u)=>{c.indexOf(u)===-1&&s[n].push(d)}))}}function zm(e){const{send:t,recv:n,sendrecv:i}=e;if(!i){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let s,o;return t?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...t.audioCodecs,...i.audioCodecs],s.videoCodecs=[...t.videoCodecs,...i.videoCodecs],s.audioExtensions=[...t.audioExtensions,...i.audioExtensions],s.videoExtensions=[...t.videoExtensions,...i.videoExtensions]):s=i,n?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...n.audioCodecs,...i.audioCodecs],o.videoCodecs=[...n.videoCodecs,...i.videoCodecs],o.audioExtensions=[...n.audioExtensions,...i.audioExtensions],o.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):o=i,{send:s,recv:o}}function C_(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter((t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"})).forEach((t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"}))}function Ih(e,t,n,i){let s=[];if(e===dt.VIDEO){if(re("H264_PROFILE_LEVEL_ID")&&i==="h264"&&(s=t.videoCodecs.filter((o=>{var c;return Re(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,i)&&o&&o.fmtp&&o.fmtp.parameters["profile-level-id"]===re("H264_PROFILE_LEVEL_ID")}))),!Array.isArray(s)||s.length===0){let o=[];const c=[],d=[],u=[];if(n.videoCodecs.forEach((p=>{const m=p.rtpMap&&p.rtpMap.encodingName.toLowerCase()||"";Re(m).call(m,i)?o.push(p):Re(m).call(m,"vp9")?c.push(p):Re(m).call(m,"vp8")?d.push(p):Re(m).call(m,"h264")&&u.push(p)})),o.length===0){let p="";c.length!==0?(o=c,p="vp9"):d.length!==0?(o=d,p="vp8"):u.length!==0&&(o=u,p="h264"),F.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(p))}o.length!==0&&(s=t.videoCodecs.filter((p=>o.some((m=>m.payloadType===p.payloadType)))))}if(s.length===0&&(F.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),s=t.videoCodecs),re("USE_PUB_RTX")||re("USE_SUB_RTX")){const o=td(s,t.videoCodecs);s=[...s,...o]}}else{s=t.audioCodecs.filter((c=>{var d;return Re(d=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(d,i)}));const o=t.audioCodecs.filter((c=>{var d;return Re(d=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(d,"red")}));s.length===0&&(F.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),s=t.audioCodecs.filter((c=>{var d;return Re(d=c.rtpMap&&c.rtpMap.encodingName.toLowerCase()||"").call(d,"opus")}))),re("ENABLE_AUDIO_RED")&&o.length!==0&&(s=[...o,...s])}return s}function td(e,t){const n=e.map((i=>i.payloadType.toString()));return t.filter((i=>i.rtpMap&&i.rtpMap.encodingName==="rtx"&&i.fmtp&&i.fmtp.parameters.apt&&Re(n).call(n,i.fmtp&&i.fmtp.parameters.apt)))}async function Ym(e,t,n){const i=t.toString(),s=aF(i,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:i});const o=await e.createAnswer();if(!o.sdp)throw new Error("cannot get answer sdp");let c=o.sdp;c=oF(c,n||{}),s?.(c||""),await e.setLocalDescription({type:"answer",sdp:c})}function oF(e,t,n){const i=Qo(e),{useXR:s}=t;return i.mediaDescriptions.forEach((o=>{var c;o.attributes.mid&&(Array.isArray(n)&&!Re(n).call(n,o.attributes.mid)||(o.media.mediaType==="audio"&&C_(o),s&&Re(c=["audio","video"]).call(c,o.media.mediaType)&&o.attributes.payloads.forEach((d=>{d.rtcpFeedbacks.findIndex((u=>u.type==="rrtr"))===-1&&d.rtcpFeedbacks.push({type:"rrtr"})}))))})),Wg(i)}function aF(e,t,n,i){if(re("SDP_LOGGING"))return F.upload("exchanging ".concat(n," ").concat(t," SDP during P2PConnection.").concat(i,`
`),e),t==="offer"?s=>{aF(s,"answer",n==="local"?"remote":"local",i)}:void 0}function cF(e){const t=re("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some((n=>Re(e).call(e,n)))}function lF(e,t){try{var n;return((n=e.fmtp)===null||n===void 0?void 0:n.parameters.apt)===t.payloadType.toString()}catch{return!1}}function nd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function Vd(e,t){return typeof re(e)===t?re(e):void 0}function M4(){try{const e=re("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:(function(t){for(var n=1;n<arguments.length;n++){var i=arguments[n]!=null?arguments[n]:{};n%2?nd(Object(i),!0).forEach((function(s){Q(t,s,i[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):nd(Object(i)).forEach((function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))}))}return t})({},e)}catch(e){return F.debug("handle gateway attributes failed: ",e),{}}}const qm={};function Tl(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&F.debug("install service ".concat(e.name)),qm[e.name]=e}function b_(e){const t=qm[e];if(!t)throw new Ge(H.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function r0(e,t){return b_("DataStream").create(e,t)}function s0(){return b_("InterceptFrame").create()}function Oa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function _a(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Oa(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oa(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}const dF=new Map;class uP extends rr{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Qs.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(Qs.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){F.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){var i,s,o;super(),Q(this,"store",void 0),Q(this,"joinInfo",void 0),Q(this,"key",void 0),Q(this,"ntpOffset",0),Q(this,"signal",void 0),Q(this,"role",void 0),Q(this,"isPreallocation",void 0),Q(this,"isPreSub",void 0),Q(this,"inChannelInfo",{joinAt:null,duration:0}),Q(this,"spec",void 0),Q(this,"_state","DISCONNECTED"),Q(this,"_statsCollector",void 0),Q(this,"_disconnectedReason",void 0),Q(this,"isSignalRecover",!1),Q(this,"hasChangeBGPAddress",!1),Q(this,"trafficStatsInterval",void 0),Q(this,"networkQualityInterval",void 0),Q(this,"_joinGatewayStartTime",0),Q(this,"_signalTimeout",!1),Q(this,"_clientRoleOptions",void 0),Q(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useP2P?(i={spec:_a(_a({},n),{},{retryConfig:n.websocketRetryConfig}),store:t},(s=(o=b_("P2PChannel")).createSubmodule)===null||s===void 0?void 0:s.call(o,i)):new Qz(_a(_a({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(t,n,i){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const s=Date.now();let o=dF.get(t.cname);if(o||(o=new Map,dF.set(t.cname,o)),this._isProactiveJoin=!0,o.has(t.uid)){const p=new Pe(H.UID_CONFLICT);throw fe.joinGateway(t.sid,{lts:s,succ:!1,ec:p.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),p}o.set(t.uid,!0),this.joinInfo=t,this.key=n;let c=0;this.joinGatewayStartTime=s;const d=t.proxyServer;try{F.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(c));const p=t.gatewayAddrs.map((m=>{let{address:g}=m;const[T,R]=g.split(":"),I={host:T,port:R};return t.proxyServer&&(I.proxy=t.proxyServer),I}));c=(await this.signal.init(p)).uid,F.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(c," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(p){var u;throw F.error("[".concat(this.store.clientId,"] User join failed"),p.toString()),fe.joinGateway(t.sid,{lts:s,succ:!1,ec:((u=p.data)===null||u===void 0?void 0:u.desc)||p.code,errorMsg:p.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,isProxy:!!d,signalChannel:"0",preload:t.preload}),o.delete(t.uid),this.signal.close(),p}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),F.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval((()=>{this.updateTrafficStats().catch((p=>{F.warning("[".concat(this.store.clientId,"] get traffic stats error"),p.toString())}))}),3e3),this.networkQualityInterval=window.setInterval((()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Qs.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Qs.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Qs.NETWORK_QUALITY,{uplinkNetworkQuality:VC(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:VC(this._statsCollector.trafficStats.B_dnq)}):this.emit(Qs.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})}),2e3),this.store.joinGatewayEnd(),c}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==Ti.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==Pt.CONNECTED||await(function(i,s){return s===1/0?i:De.race([i,Jo(s)])})(this.signal.request(Yt.LEAVE,void 0,!0),3e3)}catch(i){F.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),i)}this.signal.close(n),n!==Ti.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(H.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const s={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:re("PUB_EXTEND"),twcc:!!re("PUBLISH_TWCC"),rtx:!!re("USE_PUB_RTX")};try{return(await this.signal.request(Yt.PUBLISH,s,!0))._message}catch(o){if(i&&o.data&&o.data.code===gt.ERR_PUBLISH_REQUEST_INVALID)return F.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),o.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw o}}async publishDataChannel(t,n,i){var s;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(H.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const o={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(s=n.maxRetransmits)!==null&&s!==void 0?s:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(Yt.PUBLISH_DATASTREAM,o,!0)}catch(c){if(i&&c.data&&c.data.code===gt.ERR_PUBLISH_REQUEST_INVALID)return F.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),c.toString()),await this.tryUnpubDataChannelBeforeRepub(t,n),this.publishDataChannel(t,n,!1);throw c}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(H.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Yt.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(i){F.warning("[".concat(this.store.clientId,"] unpublish warning: "),i)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(H.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await De.all(t.map((n=>this.signal.request(Yt.UNPUBLISH_DATASTREAM,{channel_id:n},!0))))}catch(n){F.warning("unpublish datachannels warning: ",n)}}async presubscribe(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(H.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const s={stream_id:t,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!re("SUBSCRIBE_TWCC"),rtx:!!re("USE_SUB_RTX")||void 0,extend:re("SUB_EXTEND"),svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return await this.signal.request(Yt.PRE_SUBSCRIBE,s,!0)}catch(o){if(i&&o.data&&o.data.code===gt.ERR_SUBSCRIBE_REQUEST_INVALID)return F.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),o.toString()),this.presubscribe(t,n,!1);throw o}}async subscribe(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(H.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const s={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!re("SUBSCRIBE_TWCC"),rtx:!!re("USE_SUB_RTX"),extend:re("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return(await this.signal.request(Yt.SUBSCRIBE,s,!0))._message}catch(o){if(i&&o.data&&o.data.code===gt.ERR_SUBSCRIBE_REQUEST_INVALID)return F.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),o.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw o}}async subscribeDataChannel(t,n,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(H.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const s={uid:t,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(Yt.SUBSCRIBE_DATASTREAM,s,!0)}catch(o){if(i&&o.data&&o.data.code===gt.ERR_SUBSCRIBE_REQUEST_INVALID)return F.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),o.toString()),await this.tryUnsubDataChannelBeforeResub(t,n),await this.subscribeDataChannel(t,n,!1);throw o}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(H.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const i={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!re("USE_SUB_RTX"),twcc:!!re("SUBSCRIBE_TWCC"),svc:Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0};try{return await this.signal.request(Yt.SUBSCRIBE_STREAMS,i,!0)}catch(s){if(n&&s.data&&s.data.code===gt.ERR_SUBSCRIBE_REQUEST_INVALID)return F.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),s.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw s}}async setVideoProfile(t){const n=(function(i){if(!(i.bitrateMax&&i.bitrateMin&&i.frameRate&&i.height&&i.width))return;let s=i.frameRate,o=i.width,c=i.height,d=!0;return typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(d=!1)),typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,o||(d=!1)),typeof c!="number"&&(c=c.exact||c.ideal||c.max||c.min||0,s||(d=!1)),d?{stream_type:0,width:o,height:c,fps:s,start_bps:1e3*i.bitrateMax,min_bps:1e3*i.bitrateMin,target_bps:1e3*i.bitrateMax}:void 0})(t);if(n)return this.signal.request(Yt.SET_VIDEO_PROFILE,n);F.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(Yt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(i){F.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),i)}}async unsubscribeDataChannel(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Pe(H.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await De.all(t.map((i=>this.signal.request(Yt.UNSUBSCRIBE_DATASTREAM,{stream_id:i,uid:n},!0))))}catch(i){F.warning("unsubscribeDataChannel warning: ",i)}}async massUnsubscribe(t){try{await this.signal.request(Yt.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){F.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:i,rtpCapabilities:s}=t;return{gatewayEstablishParams:await this.signal.request(Yt.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:s}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Yt.GATEWAY_INFO)}async renewToken(t){await this.signal.request(Yt.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,n){n&&(this._clientRoleOptions=Object.assign({},n)),re("CLIENT_ROLE_OPTIONS")&&(F.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(re("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},re("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),re("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},re("CLIENT_ROLE_OPTIONS")),F.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(re("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let i,s=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(i=this._clientRoleOptions.delay,s=1):s=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:s=0;const o=Object.assign({},n);delete o.delay,delete o.level,await this.signal.request(Yt.SET_CLIENT_ROLE,_a(_a({role:t,level:s,delay:i},o),{},{client_ts:Date.now()})),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(Yt.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(Yt.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(Yt.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(Yt.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(t){await this.signal.request(Yt.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,n,i){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,n,i)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),_a({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Yt.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=dF.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=(function(n){let i;return i=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),i?{username:go.username,password:go.password,turnServerURL:i[2],tcpport:parseInt(i[3])+30,udpport:parseInt(i[3])+30,forceturn:!1}:null})((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(_a(_a({},go),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(Yt.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach((n=>{const i=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find((s=>s.peer_uid===n.peer_uid));i&&i.B_st!==n.B_st&&sr((()=>{this.emit(Qs.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)}))})),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){var n,i;if(!this.joinInfo||!this.key)throw new Pe(H.UNEXPECTED_ERROR,"can not generate join message, no join info");const s=Object.assign({},this.joinInfo.apResponse);let o=re("REPORT_APP_SCENARIO");if(typeof o!="string")try{o=JSON.stringify(o)}catch{o=void 0}var c;o&&o.length>128&&(o=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Qs.UPDATE_GATEWAY_CONFIG),c=this.store.clientId,Re(Rh).call(Rh,c)||Rh.push(c);const d=xD(this.store),u=!((n=this.isPreallocation)===null||n===void 0||!n.call(this)),p=Po(this.store),m=M4(),g=Ev(87)||FU()||SD(117),T=((function(){const I=$n();if(I.name!==mi.SAFARI||!I.browserVersion)return!1;const A=I.browserVersion.split(".");return Number(A[0])>18||Number(A[0])===18&&Number(A[1])>=4})()||jU(18,4,!1))&&Rw(18,6,!0)&&this.spec.codec==="h264"&&re("ENABLE_ABSSENDTIME_AS_SENTTS"),R=_a({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:ql,browser:navigator.userAgent,process_id:re("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:s,extend:re("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:o,attributes:{userAttributes:_a(_a({enableEncodedTransform:(!!re("ENABLE_AUDIO_METADATA")||!!re("ENABLE_AUDIO_PTS"))&&g||!!re("ENABLE_AUDIO_TOPN")&&vw(mi.CHROME,87,116)||void 0,enableAudioMetadata:!!re("ENABLE_AUDIO_METADATA")&&g,enableAudioPts:!!re("ENABLE_AUDIO_PTS")&&g,topnSmoothLevel:re("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:re("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:re("TOPN_SWITCH_HOLD_MS"),topnAudioGain:re("TOPN_AUDIO_GAIN"),enablePublishedUserList:re("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:re("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Vd("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Vd("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Vd("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:re("USE_PUB_RTX")===!0||re("USE_SUB_RTX")===!0||void 0,disableFEC:re("DISABLE_FEC"),enableNTPReport:!!re("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:p,enableFulllinkAvSync:!!re("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Vd("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!re("FORCE_ENABLE_AUT_CC")||!RC()&&(!!re("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!re("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Vd("USE_XR","boolean"),enableLossbasedBwe:Vd("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!re("FORCE_ENABLE_AUT_CC")||!RC()&&(!!re("ENABLE_AUT_CC")||void 0),enableCCFallback:Vd("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:u,preSubNum:d?Vd("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Vd("PUBLISH_TWCC","boolean"),enableSubTWCC:Vd("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Vd("USE_PUB_RTX","boolean"),enableSubRTX:Vd("USE_SUB_RTX","boolean"),enableSubSVC:re("ENABLE_SVC")?re("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(re("SVC"))&&re("SVC").length!==0?re("SVC"):void 0,enableSvcExtended:re("ENABLE_SVC")&&Array.isArray(re("SVC_EXTENDED"))&&re("SVC_EXTENDED").length!==0?re("SVC_EXTENDED"):void 0},m),{},{audioDuplicate:Vd("ENABLE_AUDIO_RED","boolean")?(i=Vd("AUDIO_DUPLICATE_NUM","number"))!==null&&i!==void 0?i:2:void 0,senttsUsesAbsSendTime:!!T||void 0})},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(R.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(R.aes_mode=this.joinInfo.aesmode,re("ENCRYPT_AES")?(R.aes_secret=this.joinInfo.aespassword,R.aes_encrypt=!0):R.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(R.aes_salt=this.joinInfo.aessalt)),s.addresses[this.signal.websocket.currentURLIndex]&&(R.ap_response.ticket=s.addresses[this.signal.websocket.currentURLIndex].ticket,delete s.addresses),this.joinInfo.defaultVideoStream!==void 0&&(R.default_video_stream=this.joinInfo.defaultVideoStream),R}getRejoinMessage(){if(!this.joinInfo)throw new Pe(H.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(st.WS_RECONNECT_CREATE_CONNECTION,(t=>{this.joinGatewayStartTime=Date.now()})),this.signal.on(st.WS_RECONNECTING,(t=>{this.joinInfo&&fe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||vr.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",fe.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())})),this.signal.on(st.WS_CLOSED,(t=>{let n;switch(t){case Ti.LEAVE:n=vr.LEAVE;break;case Ti.UID_BANNED:case Ti.IP_BANNED:case Ti.CHANNEL_BANNED:case Ti.SERVER_ERROR:n=vr.SERVER_ERROR;break;case Ti.FALLBACK:n=vr.FALLBACK;break;case Ti.LICENSE_MISSING:case Ti.LICENSE_EXPIRED:case Ti.LICENSE_MINUTES_EXCEEDED:case Ti.LICENSE_PERIOD_INVALID:case Ti.LICENSE_MULTIPLE_SDK_SERVICE:case Ti.LICENSE_ILLEGAL:case Ti.TOKEN_EXPIRE:n=t;break;default:n=vr.NETWORK_ERROR}F.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+vr.NETWORK_ERROR)),this.joinInfo&&fe.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Ti.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==Ti.FALLBACK&&(this.state="DISCONNECTED"),this.reset()})),this.signal.on(st.WS_CONNECTED,(()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const t=re("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(F.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(fe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void F.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));te("EVENT_REPORT_DOMAIN",t[1]),te("EVENT_REPORT_BACKUP_DOMAIN",t[1]),te("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}})),this.signal.on(an.ON_UPLINK_STATS,(t=>{this._statsCollector.updateUplinkStats(t)})),this.signal.on(st.REQUEST_RECOVER,((t,n,i)=>{if(!this.joinInfo)return i(new Pe(H.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,On(this,Qs.REQUEST_NEW_GATEWAY_LIST).then(n).catch(i)})),this.signal.on(st.REQUEST_JOIN_INFO,(async(t,n,i)=>{var s,o,c;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const d=Ki((s=this.joinInfo)===null||s===void 0?void 0:s.turnServer);if(re("NEW_TURN_MODE")&&d&&((o=this.joinInfo)===null||o===void 0?void 0:o.cloudProxyServer)==="disabled"){var u;let T=d.servers.map((A=>"turnServerURL"in A&&re("USE_TURN_IP")?_a(_a({},A),{},{turnServerURL:xC(A.turnServerURL)}):A)),R=(u=d.serversFromGateway)===null||u===void 0?void 0:u.map((A=>re("USE_TURN_IP")?_a(_a({},A),{},{turnServerURL:xC(A.turnServerURL)}):A));const I=this.signal.currentURLIndex;T.length>0&&(T=[T[I%T.length]],d.servers=T),Array.isArray(R)&&R.length>0&&(R=[R[0]],d.serversFromGateway=R),F.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(I))}const{iceParameters:p,dtlsParameters:m,rtpCapabilities:g}=await On(this,Qs.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:d,cloudProxyServer:(c=this.joinInfo)===null||c===void 0?void 0:c.cloudProxyServer});try{t(this.getJoinMessage({ortc:{iceParameters:p,dtlsParameters:m,rtpCapabilities:g,version:"2"}}))}catch(T){n(T)}})),this.signal.on(st.REQUEST_REJOIN_INFO,(t=>{t(this.getRejoinMessage())})),this.signal.on(st.REPORT_JOIN_GATEWAY,((t,n)=>{if(!this.joinInfo)return;let i,s="";var o;t instanceof Pe?(i=((o=t.data)===null||o===void 0?void 0:o.desc)||t.code,s=t.message):i=t,fe.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,errorMsg:s,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})})),this.signal.on(st.IS_P2P_DISCONNECTED,(t=>{t(Kr(this,Qs.IS_P2P_DISCONNECTED))})),this.signal.on(st.DISCONNECT_P2P,(()=>{this.emit(Qs.DISCONNECT_P2P)})),this.signal.on(st.REQUEST_SUCCESS,(()=>{this._signalTimeout=!1})),this.signal.on(st.REQUEST_TIMEOUT,(()=>{this._signalTimeout=!0})),this.signal.on(st.JOIN_RESPONSE,(t=>{const n=this.getCurrentGatewayAddress();this.emit(Qs.JOIN_RESPONSE,t,n)})),this.signal.on(st.PRE_CONNECT_PC,(async()=>{if(this.joinInfo){var t,n;this.updateTurnConfigFromSignal();const s=this.getCurrentGatewayAddress(),o=Ki((t=this.joinInfo)===null||t===void 0?void 0:t.turnServer);if(re("NEW_TURN_MODE")&&o&&((n=this.joinInfo)===null||n===void 0?void 0:n.cloudProxyServer)==="disabled"){var i;let d=o.servers.map((m=>"turnServerURL"in m&&re("USE_TURN_IP")?_a(_a({},m),{},{turnServerURL:xC(m.turnServerURL)}):m)),u=(i=o.serversFromGateway)===null||i===void 0?void 0:i.map((m=>re("USE_TURN_IP")?_a(_a({},m),{},{turnServerURL:xC(m.turnServerURL)}):m));const p=this.signal.currentURLIndex;d.length>0&&(d=[d[p%d.length]],o.servers=d),Array.isArray(u)&&u.length>0&&(u=[u[0]],o.serversFromGateway=u),F.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(p,",in pre pc"))}const c=re("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(s&&c){const d=jC(s);this.emit(Qs.PRE_CONNECT_PC,{candidates:d,fingerprint:c,turnServer:o})}}})),this.signal.on(st.RECOVER_NOTIFICATION,(t=>{this.joinInfo&&typeof re("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(re("AP_REQUEST_DETAIL"),";").concat(t))}))}async tryUnsubBeforeResub(t,n){try{await this.signal.request(Yt.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(i){throw F.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),i),i}}async tryUnsubDataChannelBeforeResub(t,n){try{await this.signal.request(Yt.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(i){throw F.warning("unsubscribe datachannel warning",i),i}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(Yt.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(i){throw F.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),i),i}}async tryUnpubDataChannelBeforeRepub(t,n){try{await this.signal.request(Yt.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(i){throw F.warning("unpublish datastream warning: ",i),i}}async tryMassUnsubBeforeResub(t){const n={users:t.map((i=>({stream_id:i.stream_id,stream_type:i.stream_type})))};try{await this.signal.request(Yt.UNSUBSCRIBE_STREAMS,n,!0)}catch(i){throw F.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),i),i}}async muteLocal(t,n){const i={action:t.find((s=>s.stream_type===gn.Audio))?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Yt.CONTROL,i,!0,!0)}catch(s){throw F.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),s),s}}async unmuteLocal(t,n){const i={action:t.find((s=>s.stream_type===gn.Audio))?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(Yt.CONTROL,i,!0,!0)}catch(s){throw F.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),s),s}}async muteRemote(t,n){const i={action:t===dt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Yt.CONTROL,i,!0,!0)}catch(s){throw F.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),s),s}}async unmuteRemote(t,n){const i={action:t===dt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(Yt.CONTROL,i,!0,!0)}catch(s){throw F.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),s),s}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(Yt.RESTART_ICE,n,!0)}catch(i){throw F.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),i),i}}reconnect(t,n){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,n||vr.P2P_FAILED)}getCurrentGatewayAddress(){var t,n;if(!re("GATEWAY_WSS_ADDRESS"))return re("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(F.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(Yt.SET_PARAMETER,{enablePublishAudioFilter:t})}downgradeCodec(t){this.signal.downgradeCodec(t)}}let GC=0,bu=0;function id(e,t,n,i){return new De(((s,o)=>{t.timeout=t.timeout||re("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),GC+=Qp(t.data)):n&&(t.data.size?GC+=t.data.size:t.data instanceof FormData?GC+=n4(t.data):GC+=Qp(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Gc.request(t).then((c=>{typeof c.data=="string"?bu+=Qp(c.data):c.data instanceof ArrayBuffer||c.data instanceof Uint8Array?bu+=c.data.byteLength:bu+=Qp(JSON.stringify(c.data)),i&&s({data:c.data,headers:c.headers}),s(c.data)})).catch((c=>{Gc.isCancel(c)?o(new Pe(H.OPERATION_ABORTED,"cancel token canceled")):c.code==="ECONNABORTED"?o(new Pe(H.NETWORK_TIMEOUT,c.message)):c.response?o(new Pe(H.NETWORK_RESPONSE_ERROR,c.response.status)):o(new Pe(H.NETWORK_ERROR,c.message))}))}))}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(Se){var we=0;return function(){return we<Se.length?{done:!1,value:Se[we++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(Se,we,be){return Se==Array.prototype||Se==Object.prototype||(Se[we]=be.value),Se},i,s=(function(Se){Se=[typeof globalThis=="object"&&globalThis,Se,typeof window=="object"&&window,typeof self=="object"&&self,typeof _=="object"&&_];for(var we=0;we<Se.length;++we){var be=Se[we];if(be&&be.Math==Math)return be}throw Error("Cannot find global object")})(this);function o(Se,we){if(we)e:{var be=s;Se=Se.split(".");for(var M=0;M<Se.length-1;M++){var O=Se[M];if(!(O in be))break e;be=be[O]}(we=we(M=be[Se=Se[Se.length-1]]))!=M&&we!=null&&n(be,Se,{configurable:!0,writable:!0,value:we})}}function c(Se){return(Se={next:Se})[Symbol.iterator]=function(){return this},Se}function d(Se){var we=typeof Symbol<"u"&&Symbol.iterator&&Se[Symbol.iterator];return we?we.call(Se):{next:t(Se)}}if(o("Symbol",(function(Se){function we(O,G){this.A=O,n(this,"description",{configurable:!0,writable:!0,value:G})}if(Se)return Se;we.prototype.toString=function(){return this.A};var be="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",M=0;return function O(G){if(this instanceof O)throw new TypeError("Symbol is not a constructor");return new we(be+(G||"")+"_"+M++,G)}})),o("Symbol.iterator",(function(Se){if(Se)return Se;Se=Symbol("Symbol.iterator");for(var we="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),be=0;be<we.length;be++){var M=s[we[be]];typeof M=="function"&&typeof M.prototype[Se]!="function"&&n(M.prototype,Se,{configurable:!0,writable:!0,value:function(){return c(t(this))}})}return Se})),typeof Object.setPrototypeOf=="function")i=Object.setPrototypeOf;else{var u;e:{var p={};try{p.__proto__={a:!0},u=p.a;break e}catch{}u=!1}i=u?function(Se,we){if(Se.__proto__=we,Se.__proto__!==we)throw new TypeError(Se+" is not extensible");return Se}:null}var m=i;function g(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function T(Se){if(Se.m)throw new TypeError("Generator is already running");Se.m=!0}function R(Se,we){return Se.h=3,{value:we}}function I(Se){this.g=new g,this.G=Se}function A(Se,we,be,M){try{var O=we.call(Se.g.j,be);if(!(O instanceof Object))throw new TypeError("Iterator result "+O+" is not an object");if(!O.done)return Se.g.m=!1,O;var G=O.value}catch(ne){return Se.g.j=null,Se.g.s(ne),w(Se)}return Se.g.j=null,M.call(Se.g,G),w(Se)}function w(Se){for(;Se.g.h;)try{var we=Se.G(Se.g);if(we)return Se.g.m=!1,{value:we.value,done:!1}}catch(be){Se.g.v=void 0,Se.g.s(be)}if(Se.g.m=!1,Se.g.l){if(we=Se.g.l,Se.g.l=null,we.F)throw we.D;return{value:we.return,done:!0}}return{value:void 0,done:!0}}function k(Se){this.next=function(we){return Se.o(we)},this.throw=function(we){return Se.s(we)},this.return=function(we){return(function(be,M){T(be.g);var O=be.g.j;return O?A(be,"return"in O?O.return:function(G){return{value:G,done:!0}},M,be.g.return):(be.g.return(M),w(be))})(Se,we)},this[Symbol.iterator]=function(){return this}}function L(Se,we){return we=new k(new I(we)),m&&Se.prototype&&m(we,Se.prototype),we}if(g.prototype.o=function(Se){this.v=Se},g.prototype.s=function(Se){this.l={D:Se,F:!0},this.h=this.C||this.u},g.prototype.return=function(Se){this.l={return:Se},this.h=this.u},I.prototype.o=function(Se){return T(this.g),this.g.j?A(this,this.g.j.next,Se,this.g.o):(this.g.o(Se),w(this))},I.prototype.s=function(Se){return T(this.g),this.g.j?A(this,this.g.j.throw,Se,this.g.o):(this.g.s(Se),w(this))},o("Array.prototype.entries",(function(Se){return Se||function(){return(function(we,be){we instanceof String&&(we+="");var M=0,O=!1,G={next:function(){if(!O&&M<we.length){var ne=M++;return{value:be(ne,we[ne]),done:!1}}return O=!0,{done:!0,value:void 0}}};return G[Symbol.iterator]=function(){return G},G})(this,(function(we,be){return[we,be]}))}})),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var j=function(Se,we){for(var be=0;be<Se.length;be++)we(Se[be])},K=function(Se){return Se.replace(/\r?\n|\r/g,`\r
`)},W=function(Se,we,be){return we instanceof Blob?(be=be!==void 0?be+"":typeof we.name=="string"?we.name:"blob",we.name===be&&Object.prototype.toString.call(we)!=="[object Blob]"||(we=new File([we],be)),[String(Se),we]):[String(Se),String(we)]},Y=function(Se,we){if(Se.length<we)throw new TypeError(we+" argument required, but only "+Se.length+" present.")},se=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,de=se.FormData,ge=se.XMLHttpRequest&&se.XMLHttpRequest.prototype.send,je=se.Request&&se.fetch,_t=se.navigator&&se.navigator.sendBeacon,ht=se.Element&&se.Element.prototype,Ct=se.Symbol&&Symbol.toStringTag;Ct&&(Blob.prototype[Ct]||(Blob.prototype[Ct]="Blob"),"File"in se&&!File.prototype[Ct]&&(File.prototype[Ct]="File"));try{new File([],"")}catch{se.File=function(we,be,M){return we=new Blob(we,M||{}),Object.defineProperties(we,{name:{value:be},lastModified:{value:+(M&&M.lastModified!==void 0?new Date(M.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Ct&&Object.defineProperty(we,Ct,{value:"File"}),we}}var Ft=function(Se){return Se.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},mn=function(Se){this.i=[];var we=this;Se&&j(Se.elements,(function(be){if(be.name&&!be.disabled&&be.type!=="submit"&&be.type!=="button"&&!be.matches("form fieldset[disabled] *"))if(be.type==="file"){var M=be.files&&be.files.length?be.files:[new File([],"",{type:"application/octet-stream"})];j(M,(function(O){we.append(be.name,O)}))}else be.type==="select-multiple"||be.type==="select-one"?j(be.options,(function(O){!O.disabled&&O.selected&&we.append(be.name,O.value)})):be.type==="checkbox"||be.type==="radio"?be.checked&&we.append(be.name,be.value):(M=be.type==="textarea"?K(be.value):be.value,we.append(be.name,M))}))};if((e=mn.prototype).append=function(Se,we,be){Y(arguments,2),this.i.push(W(Se,we,be))},e.delete=function(Se){Y(arguments,1);var we=[];Se=String(Se),j(this.i,(function(be){be[0]!==Se&&we.push(be)})),this.i=we},e.entries=function Se(){var we,be=this;return L(Se,(function(M){if(M.h==1&&(we=0),M.h!=3)return we<be.i.length?M=R(M,be.i[we]):(M.h=0,M=void 0),M;we++,M.h=2}))},e.forEach=function(Se,we){Y(arguments,1);for(var be=d(this),M=be.next();!M.done;M=be.next()){var O=d(M.value);M=O.next().value,O=O.next().value,Se.call(we,O,M,this)}},e.get=function(Se){Y(arguments,1);var we=this.i;Se=String(Se);for(var be=0;be<we.length;be++)if(we[be][0]===Se)return we[be][1];return null},e.getAll=function(Se){Y(arguments,1);var we=[];return Se=String(Se),j(this.i,(function(be){be[0]===Se&&we.push(be[1])})),we},e.has=function(Se){Y(arguments,1),Se=String(Se);for(var we=0;we<this.i.length;we++)if(this.i[we][0]===Se)return!0;return!1},e.keys=function Se(){var we,be,M,O,G=this;return L(Se,(function(ne){if(ne.h==1&&(we=d(G),be=we.next()),ne.h!=3)return be.done?void(ne.h=0):(M=be.value,O=d(M),R(ne,O.next().value));be=we.next(),ne.h=2}))},e.set=function(Se,we,be){Y(arguments,2),Se=String(Se);var M=[],O=W(Se,we,be),G=!0;j(this.i,(function(ne){ne[0]===Se?G&&(G=!M.push(O)):M.push(ne)})),G&&M.push(O),this.i=M},e.values=function Se(){var we,be,M,O,G=this;return L(Se,(function(ne){if(ne.h==1&&(we=d(G),be=we.next()),ne.h!=3)return be.done?void(ne.h=0):(M=be.value,(O=d(M)).next(),R(ne,O.next().value));be=we.next(),ne.h=2}))},mn.prototype._asNative=function(){for(var Se=new de,we=d(this),be=we.next();!be.done;be=we.next()){var M=d(be.value);be=M.next().value,M=M.next().value,Se.append(be,M)}return Se},mn.prototype._blob=function(){var Se="----formdata-polyfill-"+Math.random(),we=[],be="--"+Se+`\r
Content-Disposition: form-data; name="`;return this.forEach((function(M,O){return typeof M=="string"?we.push(be+Ft(K(O))+`"\r
\r
`+K(M)+`\r
`):we.push(be+Ft(K(O))+'"; filename="'+Ft(M.name)+`"\r
Content-Type: `+(M.type||"application/octet-stream")+`\r
\r
`,M,`\r
`)})),we.push("--"+Se+"--"),new Blob(we,{type:"multipart/form-data; boundary="+Se})},mn.prototype[Symbol.iterator]=function(){return this.entries()},mn.prototype.toString=function(){return"[object FormData]"},ht&&!ht.matches&&(ht.matches=ht.matchesSelector||ht.mozMatchesSelector||ht.msMatchesSelector||ht.oMatchesSelector||ht.webkitMatchesSelector||function(Se){for(var we=(Se=(this.document||this.ownerDocument).querySelectorAll(Se)).length;0<=--we&&Se.item(we)!==this;);return-1<we}),Ct&&(mn.prototype[Ct]="FormData"),ge){var We=se.XMLHttpRequest.prototype.setRequestHeader;se.XMLHttpRequest.prototype.setRequestHeader=function(Se,we){We.call(this,Se,we),Se.toLowerCase()==="content-type"&&(this.B=!0)},se.XMLHttpRequest.prototype.send=function(Se){Se instanceof mn?(Se=Se._blob(),this.B||this.setRequestHeader("Content-Type",Se.type),ge.call(this,Se)):ge.call(this,Se)}}je&&(se.fetch=function(Se,we){return we&&we.body&&we.body instanceof mn&&(we.body=we.body._blob()),je.call(this,Se,we)}),_t&&(se.navigator.sendBeacon=function(Se,we){return we instanceof mn&&(we=we._asNative()),_t.call(this,Se,we)}),se.FormData=mn}})();const WC=()=>{const e=re("AREAS");return e.length===0&&e.push(Ri.GLOBAL),Ks(e).call(e,((t,n,i)=>{const s=U4(n);return s?i===0?s:"".concat(t,",").concat(s):t}),"")},U4=e=>e===Ri.OVERSEA?"".concat(Lo.ASIA,",").concat(Lo.EUROPE,",").concat(Lo.AFRICA,",").concat(Lo.NORTH_AMERICA,",").concat(Lo.SOUTH_AMERICA,",").concat(Lo.OCEANIA):Lo[e],hP=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map((n=>{const i=Xg[n],s=Object.keys(i);s&&s.map((o=>{o!=="CODE"&&(t[o]=t[o].concat(i[o]))}))})),t},Dv={GLOBAL:{ASIA:[Ri.CHINA,Ri.JAPAN,Ri.INDIA,Ri.KOREA,Ri.HKMC],EUROPE:[],NORTH_AMERICA:[Ri.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},HC=Object.keys(Dv[Ri.GLOBAL]),uF=[Ri.CHINA,Ri.NORTH_AMERICA,Ri.EUROPE,Ri.ASIA,Ri.JAPAN,Ri.INDIA,Ri.OCEANIA,Ri.SOUTH_AMERICA,Ri.AFRICA,Ri.KOREA,Ri.HKMC,Ri.US],x4=function(e,t){let n=[];if(Re(e).call(e,Ri.GLOBAL)){const o=[Ri.GLOBAL,Ri.OVERSEA],c=Object.keys(Xg);if(t===Ri.GLOBAL)throw new Pe(H.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Ri.CHINA)n=[Ri.OVERSEA];else if(s=t,Re(HC).call(HC,s)){const d=(i=t,Dv[Ri.GLOBAL][i]||[]),u=[...o,t,...d];n=c.filter((p=>!Re(u).call(u,p)))}else if((function(d){let u=!1;return HC.forEach((p=>{var m;Re(m=Dv[Ri.GLOBAL][p]).call(m,d)&&(u=!0)})),u})(t)){const d=(function(p){let m;return HC.forEach((g=>{var T;Re(T=Dv[Ri.GLOBAL][g]).call(T,p)&&(m=g)})),m})(t),u=[...o,d,t];n=c.filter((p=>!Re(u).call(u,p)))}else n=e;n=(function(d){const u=[];return uF.forEach((p=>{Re(d).call(d,p)&&u.push(p)})),u.concat(d.filter((p=>!Re(uF).call(uF,p))))})(n)}else n=e;var i,s;return n};function pP(e){var t,n;if(!e&&Re(t=re("AREAS")).call(t,Ri.EXTENSIONS))return F.debug("update area from ap : reset"),void fP(b4,!0);if(!Re(n=re("AREAS")).call(n,Ri.GLOBAL)||!e)return;let i=Xg.EXTENSIONS;i&&(i={CODE:U4(Ri.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},F.debug("update area from ap success: ".concat(e,",config is "),i),te("AREAS",[Ri.EXTENSIONS],!0),Object.keys(i).map((s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?te(s,i[s][0]):te(s,i[s])})))}function fP(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=fe.reportApiInvoke(null,{name:Cn.SET_AREA,options:e,tag:Tr.TRACER});try{let i=[];if(typeof e=="string"&&(i=[e]),Array.isArray(e)&&(e.forEach((o=>{if(!Re(pa).call(pa,o))throw new Pe(H.INVALID_PARAMS,"invalid area code")})),i=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:o,excludedArea:c}=e;if(!o)throw new Pe(H.INVALID_PARAMS,"area code is needed");let d=o;typeof o=="string"&&(d=[o]),i=c?x4(d,c):d}if(!t){if(zt.AREAS){const o=new Pe(H.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(o),void F.warning("setArea is prohibited because of config-distribute")}if(Re(i).call(i,Ri.GLOBAL)&&re("AREAS")===Ri.EXTENSIONS){const o=new Pe(H.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(o),void F.warning("setArea is prohibited because of ap extensions")}}te("AREAS",i,t);const s=hP(i);Object.keys(s).map((o=>{o==="LOG_UPLOAD_SERVER"||o==="EVENT_REPORT_DOMAIN"||o==="EVENT_REPORT_BACKUP_DOMAIN"||o==="PROXY_SERVER_TYPE3"?te(o,s[o][0]):te(o,s[o])})),F.debug("set area success:",i.join(","))}catch(i){throw n.onError(i),i}n.onSuccess()}function af(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function Ah(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?af(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):af(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}let hF=1;function pF(e,t,n,i,s){hF+=1;const o={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:hF,requestId:hF,version:ql,cname:n.cname},c={service_name:t,json_body:JSON.stringify(o)};let d,u,p=e[0];return Id((async()=>{d=Date.now();const m=await id(p,{data:c,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(u=Date.now()-d,m.code!==0){const R=new Pe(H.UNEXPECTED_RESPONSE,"live streaming ap error, code"+m.code,{retry:!0,responseTime:u});throw F.error(R.toString()),R}const g=JSON.parse(m.json_body);if(g.code!==200){const R=new Pe(H.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(g.code,", reason: ").concat(g.reason),{code:g.code,responseTime:u});throw F.error(R.toString()),R}if(!g.servers||g.servers.length===0){const R=new Pe(H.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:g.code,responseTime:u});throw F.error(R.toString()),R}const T=(function(R,I){return{addressList:R.servers.map((A=>"wss://".concat(A.address.replace(/\./g,"-"),".").concat(re("WORKER_DOMAIN"),":").concat(A.wss,"?serviceName=").concat(encodeURIComponent(I)))),workerToken:R.workerToken,vid:R.vid}})(g,t);return re("LIVE_STREAMING_ADDRESS")&&(T.addressList=re("LIVE_STREAMING_ADDRESS")instanceof Array?re("LIVE_STREAMING_ADDRESS"):[re("LIVE_STREAMING_ADDRESS")]),Ah(Ah({},T),{},{responseTime:u})}),((m,g)=>(fe.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(m.addressList),firstSuccess:g===0,responseTime:u,serverIp:e[g%e.length]}),!1)),((m,g)=>(fe.apworkerEvent(n.sid,{success:!1,sc:m.data&&m.data.code||200,serviceName:t,responseTime:u,serverIp:e[g%e.length]}),!!(m.code!==H.OPERATION_ABORTED&&m.code!==H.UNEXPECTED_RESPONSE||m.data&&m.data.retry)&&(p=e[(g+1)%e.length],!0))),s)}let _P=1;function fF(e,t,n,i){let{url:s,areaCode:o}=e;const{clientId:c,sid:d}=t,u=Date.now();let p;const m=t.role,[g,T]=gF(t,o,[Ss.CHOOSE_SERVER]);let R=$r.networkState;return Id((async()=>{R&&$r.networkState===ja.OFFLINE&&$r.onlineWaiter&&await De.race([$r.onlineWaiter,In(i&&i.maxRetryTimeout||Es.maxRetryTimeout)]),R=$r.networkState;const{data:I,headers:A}=await id(s,{data:g,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);p=A.http3==="1"?1:-1,fe.reportResourceTiming(s,d),mP(I,s,t,u,[Ss.CHOOSE_SERVER],p);const w=FC(I,Ss.CHOOSE_SERVER);return mF(w),zc(w,s)}),(I=>(I&&fe.joinChooseServer(d,{role:m,lts:u,succ:!0,csAddr:s,opid:T,serverList:I.gatewayAddrs.map((A=>A.address)),ec:null,cid:I.cid.toString(),uid:I.uid.toString(),csIp:I.csIp,unilbsServerIds:[Ss.CHOOSE_SERVER].toString(),isHttp3:p,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:I.res.detail&&I.res.detail[38]}),!1)),(I=>I.code!==H.OPERATION_ABORTED&&(I.code===H.CAN_NOT_GET_GATEWAY_SERVER?I.data.retry:(fe.joinChooseServer(d,{role:m,lts:u,succ:!1,csAddr:s,serverList:null,opid:T,ec:I.code,csIp:I.data&&I.data.csIp,unilbsServerIds:[Ss.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:R}),isHttp3:p,corssRegionTagReq:t.apRequestDetail}),F.warning("[".concat(c||"sid-".concat(d.slice(0,6)),"] Choose server network error, retry"),I),!0))),i)}function _F(e,t,n,i){let s,{url:o,areaCode:c,serviceIds:d}=e;const u=Date.now(),p=t.role,[m,g]=gF(t,c,d);let T;return Id((async()=>{T&&$r.networkState===ja.OFFLINE&&$r.onlineWaiter&&await De.race([$r.onlineWaiter,In(i&&i.maxRetryTimeout||Es.maxRetryTimeout)]),T=$r.networkState;const{data:R,headers:I}=await id(o,{data:m,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);s=I.http3==="1"?1:-1,fe.reportResourceTiming(o,t.sid),mP(R,o,t,u,d,s);const A=FC(R,Ss.CHOOSE_SERVER),w=FC(R,t.cloudProxyServer==="proxy5"?Ss.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Ss.CLOUD_PROXY:Ss.CLOUD_PROXY_FALLBACK),k=performance.getEntriesByName(o),L=k[k.length-1];let j;return L&&(j={name:L.name,protocol:"nextHopProtocol"in L?L.nextHopProtocol:"",dnscost:"domainLookupEnd"in L&&"domainLookupStart"in L&&typeof L.domainLookupEnd=="number"&&typeof L.domainLookupStart=="number"?L.domainLookupEnd-L.domainLookupStart:-1,tcpTlsCost:"connectEnd"in L&&"connectStart"in L&&typeof L.connectEnd=="number"&&typeof L.connectStart=="number"?L.connectEnd-L.connectStart:-1,reqCost:"requestStart"in L&&typeof L.requestStart=="number"&&"responseEnd"in L&&typeof L.responseEnd=="number"?L.responseEnd-L.requestStart:-1,handleCost:"leave_ts"in R&&"enter_ts"in R&&typeof R.leave_ts=="number"&&typeof R.enter_ts=="number"?R.leave_ts-R.enter_ts:-1}),mF(A),{gatewayInfo:zc(A,o),proxyInfo:w,url:o,resourceTimingInfo:j}}),(R=>(R.gatewayInfo&&fe.joinChooseServer(t.sid,{role:p,lts:u,succ:!0,csAddr:o,serverList:R.gatewayInfo.gatewayAddrs.map((I=>I.address)),ec:null,opid:g,cid:R.gatewayInfo.cid.toString(),uid:R.gatewayInfo.uid.toString(),csIp:R.gatewayInfo.csIp,unilbsServerIds:d.toString(),isHttp3:s,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:R.gatewayInfo.res.detail&&R.gatewayInfo.res.detail[38],resourceTimingInfo:R.resourceTimingInfo?JSON.stringify(R.resourceTimingInfo):void 0}),R.proxyInfo&&fe.joinWebProxyAP(t.sid,{lts:u,sucess:1,apServerAddr:o,turnServerAddrList:R.proxyInfo.addresses.map((I=>I.ip)).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:d.toString()}),!1)),(R=>R.code!==H.OPERATION_ABORTED&&(R.code===H.CAN_NOT_GET_GATEWAY_SERVER?R.data.retry:(fe.joinWebProxyAP(t.sid,{lts:u,sucess:0,apServerAddr:o,turnServerAddrList:null,errorCode:R.code,eventType:t.cloudProxyServer,unilbsServerIds:d.toString(),extend:JSON.stringify({networkState:T})}),F.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),R),!0))),i)}const mP=(e,t,n,i,s,o)=>{const{sid:c,clientId:d,cloudProxyServer:u}=n,p=[],m=g=>{g.flag===4096?fe.joinChooseServer(c,{role:n.role,lts:i,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:g.error.message,csIp:g.error.data&&g.error.data.csIp,unilbsServerIds:s.toString(),isHttp3:o,corssRegionTagReq:n.apRequestDetail}):g.flag!==1048576&&g.flag!==4194304&&g.flag!==4194310||fe.joinWebProxyAP(c,{lts:i,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:g.error.code,eventType:u,unilbsServerIds:s.toString()})};if(e.response_body.forEach((g=>{const T=g.buffer.code;if(g.uri===23&&T===0&&!g.buffer.edges_services)if(g.buffer.flag===4194310)F.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),g.buffer.edges_services=[];else{const R={error:new Pe(H.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:g.buffer.flag};p.push(R),m(R)}if(T!==0){const R=MC(T),I={error:new Pe(H.CAN_NOT_GET_GATEWAY_SERVER,R.desc,{desc:R.desc,retry:R.retry,csIp:e.detail[502]}),flag:g.buffer.flag};g.buffer.flag===4194310?F.warning(I.error.toString()):p.push(I),m(I)}})),p.length)throw F.warning("[".concat(d||"sid-".concat(c.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(p.map((g=>"flag: ".concat(g.flag,", message: ").concat(g.error.message,", retry: ").concat(g.error.data.retry))).join(" | "))),new Pe(H.CAN_NOT_GET_GATEWAY_SERVER,p.map((g=>"flag: ".concat(g.flag,", message: ").concat(g.error.message))).join(" | "),{retry:!!p.find((g=>g.error.data.retry)),csIp:e.detail[502],desc:[...new Set(p.map((g=>{var T;return g==null||(T=g.error)===null||T===void 0||(T=T.data)===null||T===void 0?void 0:T.desc})).filter((g=>!!g)))]})},mF=e=>{var t,n,i,s;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new Pe(H.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(re("AP_AREA")&&((i=e.detail)!==null&&i!==void 0&&i[23]&&typeof((s=e.detail)===null||s===void 0?void 0:s[23])=="string"?pP(e.detail[23].toLowerCase()):pP()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const c=e.detail[19],d=c?.split(";");for(let u=0;u<d.length;u++){var o;const p=dr(o=d[u]).call(o);e.addresses[u]&&d&&(e.addresses[u].fingerprint=p)}}if(re("GATEWAY_ADDRESS")&&re("GATEWAY_ADDRESS").length>0){F.debug("assign gateway address to",re("GATEWAY_ADDRESS"));const c=re("GATEWAY_ADDRESS").map((d=>{var u,p;const m=(u=(p=e.addresses.find((g=>g.ip===d.ip&&g.port===d.port)))===null||p===void 0?void 0:p.fingerprint)!==null&&u!==void 0?u:"";return{ip:d.ip,port:d.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:m}}));e.addresses=c}},EF=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const i=MC(n.buffer.code);throw new Pe(H.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(i.desc),{retry:i.retry})}return n.buffer.ticket}throw F.debug("update ticket request received ap response without response body:",t),new Pe(H.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},gF=(e,t,n)=>{const i=Math.floor(Math.random()*1e12),s=e.role==="host"?"1":e.role==="audience"?"2":void 0,o={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:Ah(Ah(Ah({6:e.stringUid,11:t,12:re("USE_NEW_TOKEN")?"1":void 0},s?{17:s}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:n,uid:e.uid||0}}]};o.request_bodies.forEach((d=>{e.multiIP&&e.multiIP.gateway_ip&&(d.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))}));const c=new FormData;return c.append("request",JSON.stringify(o)),[c,i]},KC=(e,t)=>{const n=Math.floor(Math.random()*1e12),i={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map((o=>({ip:o.ip,port:o.port})))}}]},s=new FormData;return s.append("request",JSON.stringify(i)),[s,n]};let cf=0;function I_(e){return De.all(e.map((t=>t.then((n=>{throw n}),(n=>n))))).then((t=>{throw t}),(t=>t))}const zC=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:i,allFailedhandler:s,promisesCollector:o}=e,c=0;const d=t;let u,p=0;const m=async()=>{const g=(()=>{const T=c*d,R=T+d;return n.slice(T,R).map(i)})();o&&o.push(...g);try{u=await I_(g)}catch(T){if(p+=d,c++,!(p>=n.length))return void await m();s(T)}g.forEach((T=>T.cancel()))};return await m(),u},V4=async e=>{let{referenceList:t,asyncMapHandler:n,closeFn:i}=e;const s=t.length;let o=0;const c=async()=>{const d=n(t.shift());try{return await d}catch(u){if(o++,o>=s||i!=null&&i(u))throw u;return c()}};return c()};async function SF(){if(typeof VideoDecoder>"u")return!0;let e;const t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],i=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],s=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],o=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],c=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new De(((u,p)=>{let m;(async function(){e&&e.state!=="closed"||await(async function(){e=new VideoDecoder({output:T=>{T.close(),clearTimeout(m),u(!0)},error:T=>{clearTimeout(m),u(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})})();const g=[t,n,i,s,o,c];for(let T=0;T<g.length;T++){const R=new EncodedVideoChunk({type:T==0?"key":"delta",timestamp:33333*T,duration:33333,data:new Uint8Array(g[T])});try{await e.decode(R)}catch{return void u(!1)}}})(),m=setTimeout((()=>{u(!1)}),5e3)}))}async function EP(e,t,n,i){return{gatewayInfo:await(async function(o,c,d,u){let p=null;const m=[],g=async()=>{const R=re("WEBCS_DOMAIN").slice(0,re("AJAX_REQUEST_CONCURRENT")).map((w=>({url:o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(w+"/api/v2/transpond/webrtc?v=2"):"https://".concat(w,"/api/v2/transpond/webrtc?v=2"),areaCode:WC()}))),I=u.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map((w=>w.url))}),A=await zC({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:w=>(F.debug("[".concat(o.clientId,"] Connect to choose_server:"),w.url),fF(w,o,c,d)),allFailedhandler:w=>{throw u.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},I),w[0]},promisesCollector:m});return u.recordJoinChannelService({endTs:Date.now(),status:"success"},I),A},T=async()=>{if(await In(1e3),p!==null)return p;const R=re("WEBCS_DOMAIN_BACKUP_LIST").map((w=>({url:o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(w+"/api/v2/transpond/webrtc?v=2"):"https://".concat(w,"/api/v2/transpond/webrtc?v=2"),areaCode:WC()}))),I=u.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map((w=>w.url))}),A=await zC({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:w=>(F.debug("[".concat(o.clientId,"] Connect to backup choose_server:"),w.url),fF(w,o,c,d)),allFailedhandler:w=>{throw u.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},I),w[0]},promisesCollector:m});return u.recordJoinChannelService({endTs:Date.now(),status:"success"},I),A};try{return p=await I_([g(),T()]),m.length&&m.forEach((R=>R.cancel&&typeof R.cancel=="function"&&R.cancel())),p}catch(R){throw R[0]}})(e,t,n,i)}}async function TF(e,t,n,i,s){const o=e.cloudProxyServer;if(o==="disabled"){if(e.useLocalAccessPoint)return await EP(e,t,n,s);if(re("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:T,proxyInfo:R}=await j4(e,t,n,s);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:T};const I=R.map((A=>({turnServerURL:A.address,tcpport:A.tcpport||go.tcpport,udpport:A.udpport||go.udpport,username:A.username||go.username,password:A.password||go.password,forceturn:!1,security:!0})));if(s.useP2P){var c;const A=(c=e.uid)!==null&&c!==void 0?c:T.uid,w="glb:".concat(A.toString()),k=await Sr(w),L=R.map((j=>({turnServerURL:j.address,tcpport:j.tcpport||go.tcpport,udpport:j.udpport||go.udpport,username:w,password:k,forceturn:!1,security:!0})));I.push(...L)}return e.turnServer={mode:"manual",servers:I},{gatewayInfo:T}}return await EP(e,t,n,s)}const{proxyInfo:d,gatewayInfo:u}=await j4(e,t,n,s),p={gatewayInfo:u},m=d.map((T=>({turnServerURL:T.address,tcpport:o==="proxy3"?void 0:T.tcpport?T.tcpport:go.tcpport,udpport:o==="proxy4"?void 0:T.udpport?T.udpport:go.udpport,username:T.username||go.username,password:T.password||go.password,forceturn:o!=="proxy4",security:o==="proxy5"})));if(s.useP2P){var g;const T=(g=e.uid)!==null&&g!==void 0?g:u.uid,R="glb:".concat(T.toString()),I=await Sr(R),A=d.map((w=>({turnServerURL:w.address,tcpport:o==="proxy3"?void 0:w.tcpport||go.tcpport,udpport:o==="proxy4"?void 0:w.udpport||go.udpport,username:R,password:I,forceturn:o!=="proxy4",security:o==="proxy5"})));m.push(...A)}return e.turnServer={mode:"manual",servers:m},F.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(o)),p}async function F4(e,t,n,i,s){const o=re("ACCOUNT_REGISTER").slice(0,re("AJAX_REQUEST_CONCURRENT"));let c=[];c=t.proxyServer?o.map((u=>"https://".concat(t.proxyServer,"/ap/?url=").concat(u+"/api/v1"))):o.map((u=>"https://".concat(u,"/api/v1")));const d=s?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:c});try{const u=await(async function(p,m,g,T,R){const I=Date.now(),A={sid:g.sid,opid:10,appid:g.appId,string_uid:m};let w=p[0];const k=await Id((()=>id(w+"".concat(w.indexOf("?")===-1?"?":"&","action=stringuid"),{data:A,cancelToken:T,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}})),((L,j)=>{if(L.code===0){if(L.uid<=0||L.uid>=Math.pow(2,32))throw F.error("Invalid Uint Uid ".concat(m," => ").concat(L.uid),L),fe.reqUserAccount(A.sid,{lts:I,success:!1,serverAddr:w,stringUid:A.string_uid,uid:L.uid,errorCode:H.INVALID_UINT_UID_FROM_STRING_UID,extend:A}),new Pe(H.INVALID_UINT_UID_FROM_STRING_UID);return fe.reqUserAccount(A.sid,{lts:I,success:!0,serverAddr:w,stringUid:A.string_uid,uid:L.uid,errorCode:null,extend:A}),!1}const K=MC(L.code);return K.retry&&(w=p[(j+1)%p.length]),fe.reqUserAccount(A.sid,{lts:I,success:!1,serverAddr:w,stringUid:A.string_uid,uid:L.uid,errorCode:K.desc,extend:A}),K.retry}),((L,j)=>L.code!==H.OPERATION_ABORTED&&(fe.reqUserAccount(A.sid,{lts:I,success:!1,serverAddr:w,stringUid:A.string_uid,uid:null,errorCode:L.code,extend:A}),w=p[(j+1)%p.length],!0)),R);if(k.code!==0){const L=MC(k.code);throw new Pe(H.UNEXPECTED_RESPONSE,L.desc)}return k})(c,e,t,n,i);return s?.recordJoinChannelService({status:"success",endTs:Date.now()},d),u.uid}catch(u){throw s?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[u]},d),u}}async function Zz(e,t,n){const i=re("ACCOUNT_REGISTER");let s=[];s=t.proxyServer?i.map((o=>"https://".concat(t.proxyServer,"/ap/?url=").concat(o+"/api/v1"))):i.map((o=>"https://".concat(o,"/api/v1")));try{return await V4({referenceList:s,asyncMapHandler:c=>(async function(d,u,p,m){const g=Date.now(),T={sid:p.sid,opid:10,appid:p.appId,string_uid:u};try{const R=await id(d+"".concat(d.indexOf("?")===-1?"?":"&","action=stringuid"),{data:T,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(R.code!==0){const I=MC(R.code);throw new Pe(H.UNEXPECTED_RESPONSE,"preload sua error:".concat(I.desc),I)}if(R.uid<=0||R.uid>=Math.pow(2,32))throw new Pe(H.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:g,url:d,req:T,uid:R.uid,elapse:Date.now()-g}}catch(R){throw R}})(c,e,t,n),closeFn:c=>c.code===H.OPERATION_ABORTED||c.code===H.UNEXPECTED_RESPONSE&&!c.data.retry})}catch(o){throw o}}async function B4(e,t,n){const i=re("CDS_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map((u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1"):"https://".concat(u,"/api/v1?action=config"))),s=i.map((u=>(function(p,m,g,T){const R=$n(),I={flag:64,cipher_method:0,features:Ah(Ah(Ah(Ah(Ah({install_id:Yl(),device:R.name,system:R.os,system_general:navigator.userAgent,vendor:m.appId,version:ql,cname:m.cname,session_id:m.sid,proxyServer:m.proxyServer,sdk_type:ws.WEB_RTC,browser_name:R.name,browser_version:R.version,user_agent:navigator.userAgent,channel_name:m.cname},m.stringUid&&{string_uid:m.stringUid}),m.uid&&{uid:m.uid+""}),R.os&&{os_name:R.os}),R.osVersion&&{os_version:R.osVersion}),{},{detail:""})};return Id((()=>id(p,{data:I,timeout:1e3,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}})),void 0,(A=>A.code!==H.OPERATION_ABORTED),T)})(u,e,t,n)));let o=null,c=null,d={};try{o=await I_(s)}catch(u){if(u.code===H.OPERATION_ABORTED)throw u;c=u}if(s.forEach((u=>u.cancel())),fe.reportApiInvoke(e.sid,{name:Cn.REQUEST_CONFIG_DISTRIBUTE,options:{error:c,res:o}}).onSuccess(),o&&o.test_tags)try{d=(function(u){if(!u.test_tags)return{};const p=u.test_tags,m=Object.keys(p),g={};return m.forEach((T=>{var R;const I=dr(R=T.slice(4)).call(R),A=JSON.parse(p[T]),w=A[1];g[I]={tag:A[0]||"",value:w}})),g})(o)}catch{}return d}async function vF(e,t){const n=re("WEBCS_DOMAIN").concat(re("WEBCS_DOMAIN_BACKUP_LIST")).map((i=>({url:"https://".concat(i,"/api/v2/transpond/webrtc?v=2"),areaCode:WC(),serviceIds:[Ss.CHOOSE_SERVER,Ss.CLOUD_PROXY_FALLBACK]})));try{return await V4({referenceList:n,asyncMapHandler:s=>(async function(o,c,d){let u,{url:p,areaCode:m,serviceIds:g}=o;const T=Date.now(),[R,I]=gF(c,m,g);let A=$r.networkState;try{A&&$r.networkState===ja.OFFLINE&&$r.onlineWaiter&&await De.race([$r.onlineWaiter,In(Es.maxRetryTimeout)]),A=$r.networkState;const{data:w,headers:k}=await id(p,{data:R,cancelToken:d,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u=k.http3==="1"?1:-1,(W=>{const Y=[];if(W.response_body.forEach((se=>{const de=se.buffer.code;if(se.uri===23&&de===0&&!se.buffer.edges_services)if(se.buffer.flag===4194310)se.buffer.edges_services=[];else{const ge={error:new Pe(H.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:W.detail[502]}),flag:se.buffer.flag};Y.push(ge)}if(de!==0){const ge=MC(de),je={error:new Pe(H.CAN_NOT_GET_GATEWAY_SERVER,ge.desc,{desc:ge.desc,retry:ge.retry,csIp:W.detail[502]}),flag:se.buffer.flag};se.buffer.flag===4194310?F.warning(je.error.toString()):Y.push(je)}})),Y.length)throw new Pe(H.CAN_NOT_GET_GATEWAY_SERVER,Y.map((se=>"flag: ".concat(se.flag,", message: ").concat(se.error.message))).join(" | "),{retry:!!Y.find((se=>se.error.data.retry)),csIp:W.detail[502],desc:[...new Set(Y.map((se=>{var de;return se==null||(de=se.error)===null||de===void 0||(de=de.data)===null||de===void 0?void 0:de.desc})).filter((se=>!!se)))]})})(w);const j=FC(w,Ss.CHOOSE_SERVER),K=FC(w,Ss.CLOUD_PROXY_FALLBACK);return mF(j),{gatewayInfo:zc(j,p),proxyInfo:K,opid:I,requestTime:T,url:p,isHttp3:u,elapse:Date.now()-T}}catch(w){throw w}})(s,e,t),closeFn:s=>s.code===H.OPERATION_ABORTED||s.code===H.CAN_NOT_GET_GATEWAY_SERVER&&!s.data.retry})}catch(i){throw i}}async function j4(e,t,n,i){const s=re("PROXY_SERVER_TYPE3"),o=(R,I,A)=>{let w=A||s;return Array.isArray(w)&&(w=I%2==0&&s[1]||s[0]),"https://".concat(w,"/ap/?url=").concat(R)};let c=null;const d=[],u=async()=>{const R=re("WEBCS_DOMAIN").slice(0,re("AJAX_REQUEST_CONCURRENT")).map(((w,k)=>{let L;return L=e.cloudProxyServer==="disabled"&&e.proxyServer?o("".concat(w,"/api/v2/transpond/webrtc?v=2"),k,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(w,"/api/v2/transpond/webrtc?v=2"):o("".concat(w,"/api/v2/transpond/webrtc?v=2"),k),{url:L,areaCode:WC(),serviceIds:[Ss.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Ss.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Ss.CLOUD_PROXY:Ss.CLOUD_PROXY_FALLBACK]}})),I=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map((w=>w.url))}),A=await zC({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:w=>(F.debug("[".concat(e.clientId,"] Connect to choose_server:"),w.url),_F(w,e,t,n)),allFailedhandler:w=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},I),w[0]},promisesCollector:d});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},I),A},p=async()=>{if(await In(1e3),c!==null)return c;const R=re("WEBCS_DOMAIN_BACKUP_LIST").map(((w,k)=>{let L;return L=e.cloudProxyServer==="disabled"&&e.proxyServer?o("".concat(w,"/api/v2/transpond/webrtc?v=2"),k,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(w,"/api/v2/transpond/webrtc?v=2"):o("".concat(w,"/api/v2/transpond/webrtc?v=2"),k),{url:L,areaCode:WC(),serviceIds:[Ss.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Ss.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Ss.CLOUD_PROXY:Ss.CLOUD_PROXY_FALLBACK]}})),I=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map((w=>w.url))}),A=await zC({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:w=>(F.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),w.url),_F(w,e,t,n)),allFailedhandler:w=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},I),w[0]},promisesCollector:d});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},I),A};let m,g,T;try{({gatewayInfo:m,proxyInfo:g,url:T}=await I_([u(),p()]))}catch(R){throw R[0]}if(d.length&&d.forEach((R=>R.cancel&&typeof R.cancel=="function"&&R.cancel())),!m||!g)throw new Pe(H.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=T,e.cloudProxyServer!=="disabled"&&Array.isArray(s)&&T){const R=/^https?:\/\/(.+?)(\/.*)?$/.exec(T)[1];Re(s).call(s,R)&&(e.proxyServer=R,F.setProxyServer(R),fe.setProxyServer(R))}return c={gatewayInfo:m,proxyInfo:await lP(g,m.uid)},c}async function $z(e,t,n){const i=re("UAP_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map((o=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(o+"/api/v1?action=uap"):"https://".concat(o,"/api/v1?action=uap"))),s=i.map((o=>(function(c,d,u,p){const m={command:"convergeAllocateEdge",sid:d.sid,appId:d.appId,token:d.token,ts:Date.now(),version:ql,cname:d.cname,uid:d.uid.toString(),requestId:_P,seq:_P};_P+=1;const g={service_name:"tele_channel",json_body:JSON.stringify(m)};return Id((async()=>{const T=await id(c,{data:g,cancelToken:u,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(T.code!==0){const I=new Pe(H.UNEXPECTED_RESPONSE,"cross channel ap error, code"+T.code,{retry:!0});throw F.error(I.toString()),I}const R=JSON.parse(T.json_body);if(R.code!==200){const I=new Pe(H.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(R.code,", reason: ").concat(R.reason));throw F.error(I.toString()),I}if(!R.servers||R.servers.length===0){const I=new Pe(H.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw F.error(I.toString()),I}return{vid:R.vid,workerToken:R.workerToken,addressList:(re("CHANNEL_MEDIA_RELAY_SERVERS")||R.servers).map((I=>"wss://".concat(I.address.replace(/\./g,"-"),".").concat(re("WORKER_DOMAIN"),":").concat(I.wss)))}}),void 0,(T=>!!(T.code!==H.OPERATION_ABORTED&&T.code!==H.UNEXPECTED_RESPONSE||T.data&&T.data.retry)),p)})(o,e,t,n)));try{const o=await I_(s);return s.forEach((c=>c.cancel())),o}catch(o){throw o[0]}}async function G4(e,t,n){let i=null;const s=[],o=async c=>{const d=re(c?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map((u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v2/transpond/webrtc?v=2"):"https://".concat(u,"/api/v2/transpond/webrtc?v=2")));return c&&(await In(1e3),i!==null)?i:await zC({fragementLength:re("FRAGEMENT_LENGTH"),referenceList:d,asyncMapHandler:u=>(F.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(c?"backup":""," choose_server:"),u),(function(p,m,g,T){const[R]=KC(m,[Ss.CHOOSE_SERVER]);let I=$r.networkState;return Id((async()=>{I&&$r.networkState===ja.OFFLINE&&$r.onlineWaiter&&await De.race([$r.onlineWaiter,In(T&&T.maxRetryTimeout||Es.maxRetryTimeout)]),I=$r.networkState;const A=await id(p,{data:R,cancelToken:g,headers:{"Content-Type":"multipart/form-data;"}},!0);return EF(A,p)}),(()=>!1),(A=>A.code!==H.OPERATION_ABORTED&&(A.code===H.UPDATE_TICKET_FAILED?A.data.retry:(F.warning("[".concat(m.clientId,"] update ticket network error, retry"),A),!0))),T)})(u,e,t,n)),allFailedhandler:u=>{throw u[0]},promisesCollector:s})};try{return i=await I_([o(!1),o(!0)]),s.length&&s.forEach((c=>c.cancel&&typeof c.cancel=="function"&&c.cancel())),i}catch(c){throw c[0]}}function gP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function yF(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?gP(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gP(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}class eY extends rr{get isSuccess(){return!!this.configs}constructor(t,n){super(),Q(this,"configs",void 0),Q(this,"store",void 0),Q(this,"joinInfo",void 0),Q(this,"cancelToken",void 0),Q(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),Q(this,"interval",void 0),Q(this,"mutex",void 0),Q(this,"mutableParamsRead",!1),Q(this,"configCache",{}),Q(this,"limit_bitrate",void 0),this.mutex=new ro("config-distribute",t),this.store=n}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),re("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval((()=>{this.updateConfigDistribute()}),re("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,fe.reportApiInvoke(null,{options:void 0,name:Cn.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Tr.TRACER}).onSuccess(JSON.stringify(zt))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void F.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await B4(this.joinInfo,this.cancelToken,this.retryConfig),F.debug("[config-distribute] get config distribute",JSON.stringify(t));const i=(function(s){var o;const c=Zt(o=Object.keys(s).filter((p=>/^webrtc_ng_global_parameter/.test(p)))).call(o);for(let p=0;p<c.length;p++)for(let m=c.length-1;m>p;m--){const g=c[m],T=s[g].value;if(typeof T.__priority=="number"){const R=T.__priority,I=c[m-1],A=s[I].value;if(typeof A.__priority=="number"){if(!(R>A.__priority))continue;{const w=g;c[m]=c[m-1],c[m-1]=w}}else{const w=g;c[m]=c[m-1],c[m-1]=w}}}const d=Date.now();let u={};return c.forEach((p=>{const m=s[p].value.__expires;m&&m<=d||(u[p]=s[p])})),u})(t);this.cacheGlobalParameterConfig(i),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=i}catch(i){const s=new Pe(H.NETWORK_RESPONSE_ERROR,i);F.warning("[config-distribute] ".concat(s.toString()))}finally{n()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){JV(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(kC.UPDATE_BITRATE_LIMIT,t):this.emit(kC.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&yF({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{const n={},i=Object.keys(t),s=[];i.forEach((o=>{const c=t[o].value;n[o]=c;const d=c.__id;if(d&&this.configCache[o]&&this.configCache[o].__id===d)return;const u=c.__type,p=t[o].value,m=t[o].tag;let g=0;u?u===Eh.REALTIME&&(g=1):Object.keys(p).some((T=>Object.prototype.hasOwnProperty.call(or,T)||!jV()&&Object.prototype.hasOwnProperty.call(TC,T)?(g=1,!0):void 0)),s.push({tag:m,isApplied:g,feature:o,params:JSON.stringify(c)})})),s.forEach((o=>{let{tag:c,feature:d,params:u,isApplied:p}=o;this.store.sessionId&&fe.abTest(this.store.sessionId,{intSucc:1,isApplied:p,tag:c,feature:d,params:u,cid:this.store.cid,uid:this.store.intUid})})),this.configCache=n}catch(n){F.debug("handleABTestConfigDistribute error",n)}}cacheGlobalParameterConfig(t){const n=(function(s){const o={};return Object.keys(s).forEach((c=>{const d=s[c].value,u=d.__expires,p=d.__type;Object.keys(d).forEach((m=>{m==="__id"||m==="__type"||m==="__priority"||m==="__expires"||Object.prototype.hasOwnProperty.call(o,m)||(o[m]=yF(yF({value:d[m]},u&&{expires:u}),p&&{type:p}))}))})),o})(t);try{var i;const s=(i=n.LIMIT_BITRATE)===null||i===void 0?void 0:i.value;delete n.LIMIT_BITRATE,s&&JV(s)&&this.handleBitrateLimit(s),this.limit_bitrate=s,this.handleGlobalParameterConfig(n),this.handleABTestConfigDistribute(t),(function(d){try{const u=Date.now();Object.keys(d).forEach((p=>{const{value:m,type:g,expires:T}=d[p];T&&T<=u||((g===Eh.REALTIME||Object.prototype.hasOwnProperty.call(or,p))&&(zt[p]=m,en[p]=m,F.debug("Update realtime parameters from config distribute",p,m)),g||jV()||!Object.prototype.hasOwnProperty.call(TC,p)||(zt[p]=m,en[p]=m,F.debug("Update gateway parameters from config distribute",p,m)))}))}catch(u){F.error("Error update config immediately: ".concat(d),u.message)}})(n);const o=JSON.stringify(n),c=window.btoa(o);window.localStorage.setItem("websdk_ng_global_parameter",c),F.debug("Caching global parameters ".concat(o))}catch(s){F.error("Error caching global parameters:",s.message)}}handleGlobalParameterConfig(t){try{const n=Date.now();Object.keys(t).forEach((i=>{if(i==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(en,i)){const{value:s,expires:o}=t[i];if(o&&o<=n)return;(function(c,d){try{return typeof c=="object"&&typeof d=="object"&&JSON.stringify(c)===JSON.stringify(d)}catch{return!1}})(en[i],s)||(zt[i]=s,en[i]=s,this.emit(kC.UPDATE_CLIENT_ROLE_OPTIONS,s),F.debug("Updating client role options: ".concat(JSON.stringify(s))))}}))}catch(n){F.error("Error handling global parameter config:",n.message)}}}class RF extends rr{constructor(){super(...arguments),Q(this,"resultStorage",new Map)}setLocalAudioStats(t,n,i){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(i,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(i,n))}setLocalVideoStats(t,n,i){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(i,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(i,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(i)),!n.muted&&this.record("VIDEO_ENCODE_FAILED",t,this.checResolutionSent(i))}setRemoteAudioStats(t,n){const i=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",i,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const i=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",i,this.checkVideoDecode(n))}record(t,n,i){if(re("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const s=this.resultStorage.get(t);if(!s)return;s.result.push(i);const o=t==="VIDEO_ENCODE_FAILED"?re("ENCODE_EXCEPTION_TIMES"):5;if(s.result.length>=o){var c;const d=Re(c=s.result).call(c,!0);s.isPrevNormal&&!d&&this.emit("exception",ta[t],t,n),!s.isPrevNormal&&d&&this.emit("exception",ta[t]+2e3,t+"_RECOVER",n),s.isPrevNormal=d,s.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof Js&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let i=null;n._encoderConfig&&n._encoderConfig.frameRate&&(i=Sl(n._encoderConfig.frameRate));const s=t.captureFrameRate;return!i||!s||!(i>10&&s<5||i<10&&i>=5&&s<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checResolutionSent(t){var n;return!(!t.codecType||Re(n=re("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(n,t.codecType.toLocaleLowerCase()))||!t.captureFrameRate||t.sendFrameRate!==0||t.sendResolutionWidth!==0||t.sendResolutionHeight!==0}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof Js&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const ta={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},ma=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const i=n[n.length-1];return Math.round(performance.now()-i.startTime)}return 0}};function Zg(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function lf(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Zg(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Zg(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}class YC{constructor(t){Q(this,"store",void 0),Q(this,"onStatsException",void 0),Q(this,"onUploadPublishDuration",void 0),Q(this,"onStatsChanged",void 0),Q(this,"onVideoCodecChanged",void 0),Q(this,"localStats",new Map),Q(this,"remoteStats",new Map),Q(this,"updateStatsInterval",void 0),Q(this,"trafficStats",void 0),Q(this,"trafficStatsPeerList",[]),Q(this,"uplinkStats",void 0),Q(this,"exceptionMonitor",void 0),Q(this,"p2pChannel",void 0),Q(this,"scalabilityMode",gC.L1T1),Q(this,"updateStats",(()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))})),this.store=t,this.exceptionMonitor=new RF,this.exceptionMonitor.on("exception",((n,i,s)=>{this.onStatsException&&this.onStatsException(n,i,s)}))}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(He.LocalAudioTrack)||lf({},Pw)}getLocalVideoTrackStats(){return this.localStats.get(He.LocalVideoTrack)||lf({},BD)}getRemoteAudioTrackStats(t){const n=(o,c)=>{if(!this.trafficStats)return c;const d=this.trafficStats.peer_delay.find((u=>u.peer_uid===o));return d&&(c.publishDuration=d.B_ppad+(Date.now()-this.trafficStats.timestamp)),c},i={};if(t){var s;const o=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.audioStats;o&&(i[t]=n(t,o))}else Array.from(this.remoteStats.entries()).forEach((o=>{let[c,{audioStats:d}]=o;d&&(i[c]=n(c,d))}));return i}getRemoteNetworkQualityStats(t){const n={};if(t){var i;const s=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.networkStats;s&&(n[t]=s)}else Array.from(this.remoteStats.entries()).forEach((s=>{let[o,{networkStats:c}]=s;c&&(n[o]=c)}));return n}getRemoteVideoTrackStats(t){const n=(o,c)=>{if(!this.trafficStats)return c;const d=this.trafficStats.peer_delay.find((u=>u.peer_uid===o));return d&&(c.publishDuration=d.B_ppvd+(Date.now()-this.trafficStats.timestamp)),c},i={};if(t){var s;const o=(s=this.remoteStats.get(t))===null||s===void 0?void 0:s.videoStats;o&&(i[t]=n(t,o))}else Array.from(this.remoteStats.entries()).forEach((o=>{let[c,{videoStats:d}]=o;d&&(i[c]=n(c,d))}));return i}getRTCStats(){let t=0,n=0,i=0,s=0;const o=this.localStats.get(He.LocalAudioTrack);o&&(t+=o.sendBytes,n+=o.sendBitrate);const c=this.localStats.get(He.LocalVideoTrack);c&&(t+=c.sendBytes,n+=c.sendBitrate);const d=this.localStats.get(He.LocalVideoLowTrack);d&&(t+=d.sendBytes,n+=d.sendBitrate),this.remoteStats.forEach((p=>{let{audioStats:m,videoStats:g}=p;m&&(i+=m.receiveBytes,s+=m.receiveBitrate),g&&(i+=g.receiveBytes,s+=g.receiveBitrate)}));let u=1;return this.trafficStats&&(u+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:u,SendBitrate:n,SendBytes:t,RecvBytes:i,RecvBitrate:s,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter((n=>n.B_ppad!==void 0||n.B_ppvd!==void 0)),t.peer_delay.filter((n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1)).forEach((n=>{var i;const s=(i=this.p2pChannel)===null||i===void 0?void 0:i.getRemoteMedia(n.peer_uid),o=s!=null&&s.videoSSRC?ma.measureFromSubscribeStart(this.store.clientId,s.videoSSRC):0,c=s!=null&&s.audioSSRC?ma.measureFromSubscribeStart(this.store.clientId,s.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,o>c?o:c),this.trafficStatsPeerList.push(n.peer_uid))})),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&F.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,i){if(!t)return!1;const s=!!i&&n.framesDecodeFreezeTime>i.framesDecodeFreezeTime,o=!i||n.framesDecodeCount>i.framesDecodeCount;return s||!o}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach((n=>{let[i,s]=n;switch(i){case He.LocalVideoTrack:case He.LocalVideoLowTrack:{const d=s,u=lf({},BD),p=t.getStats(),m=t.getLocalMedia(i);if(p){const g=p.videoSend.find((T=>T.ssrc===m?.ssrcs[0].ssrcId));if(g){const T=t.getLocalVideoSize(),R=t.getEncoderConfig(He.LocalVideoTrack);var o;(g.codec==="H264"||g.codec==="H265"||g.codec==="VP8"||g.codec==="VP9"||g.codec==="AV1X"||g.codec==="AV1")&&(u.codecType=g.codec,d?.codecType!==g.codec&&((o=this.onVideoCodecChanged)===null||o===void 0||o.call(this,g.codec.toLocaleLowerCase()))),u.sendBytes=g.bytes,u.sendBitrate=d?8*Math.max(0,u.sendBytes-d.sendBytes):0,g.inputFrame?(u.captureFrameRate=g.inputFrame.frameRate,u.captureResolutionHeight=g.inputFrame.height,u.captureResolutionWidth=g.inputFrame.width):T&&(u.captureResolutionWidth=T.width,u.captureResolutionHeight=T.height),g.sentFrame?(u.sendFrameRate=g.sentFrame.frameRate,u.sendResolutionHeight=g.sentFrame.height,u.sendResolutionWidth=g.sentFrame.width):T&&(u.sendResolutionWidth=T.width,u.sendResolutionHeight=T.height),g.avgEncodeMs&&(u.encodeDelay=g.avgEncodeMs),R&&R.bitrateMax?u.targetSendBitrate=1e3*R.bitrateMax:g.targetBitrate&&(u.targetSendBitrate=g.targetBitrate),u.sendPackets=g.packets,u.sendPacketsLost=g.packetsLost,u.sendJitterMs=g.jitterMs,u.sendRttMs=g.rttMs,u.totalDuration=d?d.totalDuration+1:1,u.totalFreezeTime=d?d.totalFreezeTime:0,this.isLocalVideoFreeze(g)&&(u.totalFreezeTime+=1),g.scalabilityMode&&this.scalabilityMode!==g.scalabilityMode&&(F.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(g.scalabilityMode)),this.scalabilityMode=g.scalabilityMode)}this.trafficStats&&(u.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var c;this.localStats.set(i,u),(d?.sendResolutionWidth!==u.sendResolutionWidth||d?.sendResolutionHeight!==u.sendResolutionHeight)&&((c=this.onStatsChanged)===null||c===void 0||c.call(this,"resolution",{width:u.sendResolutionWidth,height:u.sendResolutionHeight})),u&&m&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,m.track,u);break}case He.LocalAudioTrack:{const d=s,u=lf({},Pw),p=t.getStats(),m=t.getLocalMedia(i);if(p){const g=p.audioSend.find((T=>T.ssrc===m?.ssrcs[0].ssrcId));if(g){if(g.codec!=="opus"&&g.codec!=="aac"&&g.codec!=="PCMU"&&g.codec!=="PCMA"&&g.codec!=="G722"||(u.codecType=g.codec),g.inputLevel)u.sendVolumeLevel=Math.round(32767*g.inputLevel);else{const T=t.getLocalAudioVolume();T&&(u.sendVolumeLevel=Math.round(32767*T))}u.sendBytes=g.bytes,u.sendPackets=g.packets,u.sendPacketsLost=g.packetsLost,u.sendJitterMs=g.jitterMs,u.sendRttMs=g.rttMs,u.sendBitrate=d?8*Math.max(0,u.sendBytes-d.sendBytes):0}}this.trafficStats&&(u.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(He.LocalAudioTrack,u),u&&m&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,m.track,u);break}}}))}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach((n=>{var i,s;let[o,{videoStats:c,audioStats:d,videoPcStats:u}]=n;const p=d,m=c,g=u,T=lf({},h4),R=lf({},sc),I=lf({},p4),{audioTrack:A,videoTrack:w,audioSSRC:k,videoSSRC:L}=t.getRemoteMedia(o);let j;j=this.store.useP2P?t.getStats(!0):t.getStats();const K=(i=j)===null||i===void 0?void 0:i.audioRecv.find((de=>de.ssrc===k)),W=(s=j)===null||s===void 0?void 0:s.videoRecv.find((de=>de.ssrc===L)),Y=this.trafficStats&&this.trafficStats.peer_delay.find((de=>de.peer_uid===o));if(K&&(K.codec!=="opus"&&K.codec!=="aac"&&K.codec!=="PCMU"&&K.codec!=="PCMA"&&K.codec!=="G722"||(T.codecType=K.codec),K.outputLevel?T.receiveLevel=Math.round(32767*K.outputLevel):A&&(T.receiveLevel=Math.round(32767*A.getVolumeLevel())),T.receiveBytes=K.bytes,T.receivePackets=K.packets,T.receivePacketsLost=K.packetsLost,T.receivePacketsDiscarded=K.packetsDiscarded,T.packetLossRate=T.receivePacketsLost/(T.receivePackets+T.receivePacketsLost),T.receiveBitrate=p?8*Math.max(0,T.receiveBytes-p.receiveBytes):0,T.totalDuration=p?p.totalDuration+1:1,T.totalFreezeTime=p?p.totalFreezeTime:0,T.freezeRate=T.totalFreezeTime/T.totalDuration,T.receiveDelay=K.jitterBufferMs,T.totalDuration>10&&YC.isRemoteAudioFreeze(A)&&(T.totalFreezeTime+=1)),W){var se;W.codec!=="H264"&&W.codec!=="H265"&&W.codec!=="VP8"&&W.codec!=="VP9"&&W.codec!=="AV1X"&&W.codec!=="AV1"||(R.codecType=W.codec),R.receiveBytes=W.bytes,R.receiveBitrate=m?8*Math.max(0,R.receiveBytes-m.receiveBytes):0,R.decodeFrameRate=W.decodeFrameRate<0?0:W.decodeFrameRate,R.renderFrameRate=W.decodeFrameRate<0?0:W.decodeFrameRate,W.outputFrame&&(R.renderFrameRate=W.outputFrame.frameRate),W.receivedFrame?(R.receiveFrameRate=W.receivedFrame.frameRate,R.receiveResolutionHeight=W.receivedFrame.height,R.receiveResolutionWidth=W.receivedFrame.width):w&&(R.receiveResolutionHeight=w._videoHeight||0,R.receiveResolutionWidth=w._videoWidth||0),W.framesRateFirefox!==void 0&&(R.receiveFrameRate=Math.round(W.framesRateFirefox)),R.receivePackets=W.packets,R.receivePacketsLost=W.packetsLost,R.packetLossRate=R.receivePacketsLost/(R.receivePackets+R.receivePacketsLost);const de=m?m.totalFreezeTime:0,ge=m?m.totalDuration:0;R.totalDuration=m?m.totalDuration+1:1,R.totalFreezeTime=(se=W.totalFreezesDuration)!==null&&se!==void 0?se:de||0,R.receiveDelay=W.jitterBufferMs||0;const je=!!L&&t.getRemoteVideoIsReady(L);W.totalFreezesDuration===void 0&&w&&je&&YC.isRemoteVideoFreeze(w,W,g)&&(R.totalFreezeTime+=1),R.freezeRate=Math.max(0,Math.min((R.totalFreezeTime-de)/(R.totalDuration-ge),1))}Y&&(T.end2EndDelay=Y.B_ad,R.end2EndDelay=Y.B_vd,T.transportDelay=Y.B_ed,R.transportDelay=Y.B_ed,T.currentPacketLossRate=Y.B_ealr4/100,R.currentPacketLossRate=Y.B_evlr4/100,I.uplinkNetworkQuality=Y.B_punq?Y.B_punq:0,I.downlinkNetworkQuality=Y.B_pdnq?Y.B_pdnq:0),this.remoteStats.set(o,{audioStats:T,videoStats:R,videoPcStats:W,networkStats:I}),A&&this.exceptionMonitor.setRemoteAudioStats(A,T),w&&this.exceptionMonitor.setRemoteVideoStats(w,R)}))}}class CF{constructor(){Q(this,"destChannelMediaInfos",new Map),Q(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){ac(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){ac(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){wv(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function Xm(e){if(!(e instanceof CF))return new Pe(H.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new Pe(H.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new Pe(H.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Jm{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,n){Q(this,"uid",void 0),Q(this,"_uintid",void 0),Q(this,"_trust_in_room_",!0),Q(this,"_trust_audio_enabled_state_",!0),Q(this,"_trust_video_enabled_state_",!0),Q(this,"_trust_audio_mute_state_",!0),Q(this,"_trust_video_mute_state_",!0),Q(this,"_audio_muted_",!1),Q(this,"_video_muted_",!1),Q(this,"_audio_enabled_",!0),Q(this,"_video_enabled_",!0),Q(this,"_audio_added_",!1),Q(this,"_video_added_",!1),Q(this,"_is_pre_created",!1),Q(this,"_video_pre_subscribed",!1),Q(this,"_audio_pre_subscribed",!1),Q(this,"_trust_video_stream_added_state_",!0),Q(this,"_trust_audio_stream_added_state_",!0),Q(this,"_audioTrack",void 0),Q(this,"_videoTrack",void 0),Q(this,"_dataChannels",[]),Q(this,"_audioSSRC",void 0),Q(this,"_videoSSRC",void 0),Q(this,"_audioOrtc",void 0),Q(this,"_videoOrtc",void 0),Q(this,"_cname",void 0),Q(this,"_rtxSsrcId",void 0),Q(this,"_videoMid",void 0),Q(this,"_audioMid",void 0),this.uid=t,this._uintid=n}}function SP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function qC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?SP(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):SP(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}const XC="9",JC=2e4,o0=4e4;function A_(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function Fd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?A_(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A_(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}var Qm=(function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e})(Qm||{});const a0=new Map;function bF(e,t,n,i){let{scale:s}=e;if(s===0&&i===Qm.UP||s>=t.length-1&&i===Qm.DOWN)return e;let o=Fd(Fd({},e),{},{scale:i===Qm.DOWN?++s:--s});switch(n){case"maintain-framerate":o=Fd(Fd({},o),t[s].motion);break;case"maintain-resolution":o=Fd(Fd({},o),t[s].detail);break;case"balanced":o=Fd(Fd({},o),t[s].balanced)}return o}function IF(e,t){if(t){const n={overUse:0,underUse:0,adaptationList:W4(t)};a0.set(e,n)}else a0.delete(e)}function W4(e){const t=Fd({},e),{bitrateMax:n,frameRate:i,scaleResolutionDownBy:s,bitrateMin:o}=t,{MIN_FRAME_RATE:c,MAX_THRESHOLD_FRAMERATE:d,MAX_SCALE:u,BITRATE_MIN_THRESHOLD:p,BITRATE_MAX_THRESHOLD:m,BWE_SCALE_UP_THRESHOLD:g,BWE_SCALE_DOWN_THRESHOLD:T,PERF_SCALE_DOWN_THRESHOLD:R,PERF_SCALE_UP_THRESHOLD:I,BALANCE_BITRATE_FACTOR:A,BALANCE_FRAMERATE_FACTOR:w,BALANCE_RESOLUTION_FACTOR:k,MOTION_RESOLUTION_FACTOR:L,MOTION_BITRATE_FACTOR:j,DETAIL_FRAMERATE_FACTOR:K,DETAIL_BITRATE_FACTOR:W}=Ow,Y=Math.min(t.frameRate,d),se=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(T,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(R,1)*Y),fps_up:i},balanced:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:o},motion:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:o},detail:{scaleResolutionDownBy:1,frameRate:i,bitrateMax:n,bitrateMin:o}}];for(let de=1;de<=u;de++){const ge={bwe_up:Math.round(Math.pow(g,de)*n),bwe_down:Math.round(Math.pow(T,de+1)*n),fps_up:Math.round(Math.pow(I,de)*Y),fps_down:Math.round(Math.pow(R,de+1)*Y)},je={scaleResolutionDownBy:s/Math.pow(k,de),frameRate:Math.max(Math.round(Math.pow(w,de)*i),c),bitrateMax:Math.max(Math.round(Math.pow(A,de)*n),m),bitrateMin:Math.max(Math.round(Math.pow(A,de)*o),p)},_t={scaleResolutionDownBy:s/Math.pow(L,de),frameRate:i,bitrateMax:Math.max(Math.round(Math.pow(j,de)*n),m),bitrateMin:Math.max(Math.round(Math.pow(j,de)*o),p)},ht={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(K,de)*i),c),bitrateMax:Math.max(Math.round(Math.pow(W,de)*n),m),bitrateMin:Math.max(Math.round(Math.pow(W,de)*o),p)};se.push({scale:de,threshold:ge,balanced:je,motion:_t,detail:ht})}return se}function H4(e,t,n,i,s,o){const c=a0.get(e)||{overUse:0,underUse:0,adaptationList:W4(s)},{adaptationList:d}=c;a0.set(e,c);const{OVERUSE_TIMES_THRESHOLD:u,UNDERUSE_TIMES_THRESHOLD:p}=Ow,{scale:m}=i;let g,T;return typeof t=="number"&&t>0&&(function(R,I,A,w){if(I>=A.length)return!1;let{threshold:{fps_down:k}}=A[I];return re("FORCE_AG_HIGH_FRAMERATE")&&w==="maintain-framerate"&&(k=A[0].threshold.fps_down),R<k})(t,m,d,o)&&(c.overUse++,T=Gg.CPU,c.overUse>u)||typeof n=="number"&&n>0&&(function(R,I,A){if(I>=A.length)return!1;const{threshold:{bwe_down:w}}=A[I];return R<w})(n,m,d)&&(c.overUse++,T=Gg.BANDWIDTH,c.overUse>u)?(c.overUse=0,c.underUse=0,g=bF(i,d,o,Qm.DOWN),[g,T]):(typeof t=="number"&&t>0&&typeof n=="number"&&n>0&&(function(R,I,A,w){if(I===0)return;let{threshold:{fps_up:k}}=A[I];return re("FORCE_AG_HIGH_FRAMERATE")&&w==="maintain-framerate"&&(k=A[1].threshold.fps_up),R>k})(t,m,d,o)&&(function(R,I,A){if(I===0)return;const{threshold:{bwe_up:w}}=A[I];return R>w})(n,m,d)&&(c.underUse++,c.underUse>p&&(c.overUse=0,c.underUse=0,g=bF(i,d,o,Qm.UP),g.scale===0&&(T=Gg.NONE))),[g,T])}function TP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function QC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?TP(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):TP(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}const Pv=new Map;function vP(e,t){const n=Pv.get(e);if(n){const{timer:i}=n;window.clearTimeout(i),Pv.delete(e)}t.qualityLimitationReason=Gg.NONE,IF(e)}function AF(e,t){var n;let i;switch(t){case He.LocalAudioTrack:i=gn.Audio;break;case He.LocalVideoTrack:i=Re(n=e._hints).call(n,Ni.SCREEN_TRACK)?gn.Screen:gn.High;break;case He.LocalVideoLowTrack:i=gn.Low}return i}function c0(e){const t=ai();if(e.some((n=>n._bypassWebAudio)))throw new Ge(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new Ge(H.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function wF(e,t){c0(e);const n=new Js;return e.forEach((i=>n.addAudioTrack(i))),n}const yP=!ai().supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&_h();function ZC(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var n;return yP?(n={spec:t,store:e},b_("PlanBConnection").create(n)):new Os(t,e)}function RP(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function ti(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(_C(e.turnServer.servers))return!1;if(re("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some((t=>t.forceturn)))return!0}return!1}catch{return!1}}var ni;function wh(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function na(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?wh(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wh(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}let Os=(ni=class H0 extends vt{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map((t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"")).filter((t=>{var n;return Re(n=Object.keys(vC)).call(n,t)})))]}constructor(t,n){super(t,n),Q(this,"id",Oi(5,"connection-")),Q(this,"store",void 0),Q(this,"peerConnection",void 0),Q(this,"forceTurn",!1),Q(this,"remoteSDP",void 0),Q(this,"initialOffer",void 0),Q(this,"transportEventReceiver",void 0),Q(this,"statsFilter",void 0),Q(this,"extension",{useXR:re("USE_XR")}),Q(this,"localCapabilities",void 0),Q(this,"remoteCodecs",void 0),Q(this,"localCandidateCount",0),Q(this,"allCandidatesReceived",!1),Q(this,"isPreallocation",!1),Q(this,"preMediaMap",new Map),Q(this,"dataStreamChannelMap",new Map),Q(this,"establishPromise",void 0),Q(this,"recoveredDataChannelIds",[]),Q(this,"currentDataChannelId",1),Q(this,"supportAV1RtpSpec",!1),Q(this,"mutex",void 0),Q(this,"qualityLimitationReason",Gg.NONE),Q(this,"isFirstConnected",!1),this.store=n,this.forceTurn=ti(t),this.mutex=new ro("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(H0.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=LD(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,fi()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,t.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(t){return this.preMediaMap.get(t)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(t,n){if(this.remoteCodecs=n,!this.remoteSDP)return void F.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(t,n,this.store.codec)){const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i);const o=this.remoteSDP.toString();s?.(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}else F.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Km(i.sdp),o=await sF({filterRTX:!re("USE_PUB_RTX")&&!re("USE_SUB_RTX"),filterVideoFec:re("FILTER_VIDEO_FEC"),filterAudioFec:re("FILTER_AUDIO_FEC"),filterVideoCodec:re("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:re("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:re("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=zm(o),this.initialOffer=i,re("ENABLE_SVC")&&this.store.codec=="av1"){const d=await(async function(){try{const u=new RTCPeerConnection;u.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:gC.L1T3}]});const p=await u.createOffer();if(!p.sdp)return void u.close();const m=Qo(p.sdp).mediaDescriptions[0];if(!m)return;const g=m.attributes.extmaps.find((T=>T.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension"));return u.close(),g}catch{return}})();var t;d&&(this.supportAV1RtpSpec=!0,(t=o.send)===null||t===void 0||t.videoExtensions.push(d))}let c;return i.sdp&&cF(i.sdp)&&(c=Ki(o),(n=c).send&&(Nv(dt.VIDEO,n.send.videoExtensions),Nv(dt.AUDIO,n.send.audioExtensions)),n.recv&&(Nv(dt.VIDEO,n.recv.videoExtensions),Nv(dt.AUDIO,n.recv.audioExtensions)),n.sendrecv&&(Nv(dt.VIDEO,n.sendrecv.videoExtensions),Nv(dt.AUDIO,n.sendrecv.audioExtensions))),na(na({},s),{},{rtpCapabilities:c||o,offerSDP:i.sdp})}catch(i){throw new Ge(H.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}var n}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&cF(this.initialOffer.sdp)&&(n=t.rtpCapabilities,i=this.localCapabilities,n.send&&(Hm(dt.VIDEO,n.send.videoExtensions,i.send.videoExtensions),Hm(dt.AUDIO,n.send.audioExtensions,i.send.audioExtensions)),n.recv&&(Hm(dt.VIDEO,n.recv.videoExtensions,i.recv.videoExtensions),Hm(dt.AUDIO,n.recv.audioExtensions,i.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Ki(this._localCapabilities)}get rtpCapabilities(){return Ki(this._rtpCapabilities)}get candidates(){return Ki(this._candidates)}get iceParameters(){return Ki(this._iceParameters)}get dtlsParameters(){return Ki(this._dtlsParameters)}constructor(u){let p=arguments.length>1&&arguments[1]!==void 0&&arguments[1],m=arguments.length>2&&arguments[2]!==void 0&&arguments[2];Q(this,"sessionDesc",void 0),Q(this,"_localCapabilities",void 0),Q(this,"_rtpCapabilities",void 0),Q(this,"_candidates",void 0),Q(this,"_originCandidates",void 0),Q(this,"_iceParameters",void 0),Q(this,"_isUseExtmapAllowMixed",void 0),Q(this,"_isUseLocalCodecs",void 0),Q(this,"_dtlsParameters",void 0),Q(this,"setup",void 0),Q(this,"currentMidIndex",void 0),Q(this,"cname",void 0),Q(this,"useLocalCodecsMids",[]),Q(this,"preloadSsrcs",[]),Q(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=p,this._isUseLocalCodecs=m,u=Ki(u);const{iceParameters:g,dtlsParameters:T,candidates:R,rtpCapabilities:I,setup:A,localCapabilities:w,cname:k}=u;this._rtpCapabilities=I,this._candidates=R,this._originCandidates=Ki(R),this._iceParameters=g,this._dtlsParameters=T,this._localCapabilities=w,this.setup=A,this.cname=k,[this.sessionDesc]=this.updateRemoteRTPCapabilities(I),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(u){return u.length===this.preloadSsrcs.length&&u.every((p=>{var m;return Re(m=this.preloadSsrcs).call(m,p)}))}preloadRemoteMedia(u){let p=0;const m=[],g=[];for(;u>0;){const T=[qC({ssrcId:o0+p},re("USE_SUB_RTX")?{rtx:o0+p+1}:{})],R="".concat(o0+p,"_").concat(JC+p),{ssrcs:I,ssrcGroups:A}=R_(T,this.cname,re("SYNC_GROUP")?R:void 0),w=this.preCreateOrRecycleSendMedia("video",I,A,void 0),k=[{ssrcId:JC+p}],L="".concat(o0+p,"_").concat(JC+p),{ssrcs:j,ssrcGroups:K}=R_(k,this.cname,re("SYNC_GROUP")?L:void 0),W=this.preCreateOrRecycleSendMedia("audio",j,K,void 0);u--,p+=2,m.push(w,W),g.push(I[0].ssrcId,j[0].ssrcId)}return this.useLocalCodecsMids.push(...m),this.preloadSsrcs=g,{mids:m,preSSRCs:g,isAvailable:!0}}preCreateOrRecycleSendMedia(u,p,m,g){const T=this.rtpCapabilities.send.videoCodecs,R=this._isUseLocalCodecs||T.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;F.debug("create or recycle send media without remote rtp capabilities, ssrcs ",p[0].ssrcId);const I=u===dt.VIDEO?R.videoCodecs:R.audioCodecs,A=u===dt.VIDEO?R.videoExtensions:R.audioExtensions;this.currentMidIndex+=1;const w="".concat(this.currentMidIndex);let k={media:{mediaType:u,port:XC,protos:["UDP","TLS","RTP","SAVPF"],fmts:I.map((L=>L.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:A,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:m,rtcpFeedbackWildcards:[],payloads:I,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(w)}};return k=this.mungSendMediaDesc(k,g),this.sessionDesc.mediaDescriptions.push(k),this.updateBundleMids(),w}toString(){return Wg(this.sessionDesc)}send(u,p,m,g){const{ssrcs:T,ssrcGroups:R}=R_(p,this.cname,re("SYNC_GROUP")?m:void 0),I=this.findPreloadMediaDesc(T);if(I){if(fi()&&this.firefoxSsrcMidMap.set(T[0].ssrcId,I.attributes.mid),g&&(g.twcc||g.remb)){const A=this.sessionDesc.mediaDescriptions.indexOf(I);return this.sessionDesc.mediaDescriptions[A]=this.mungSendMediaDesc(I,g),{mid:I.attributes.mid,needExchangeSDP:!0}}return{mid:I.attributes.mid,needExchangeSDP:!1}}{const A=this.findAvailableMediaIndex(u,T);let w;return A===-1||A===1&&(Xo()||(function(){const k=$n();return!(k.name!==mi.CHROME||!k.osVersion)&&Number(k.version)<=90})()||re("ENABLE_ENCODED_TRANSFORM")&&ms())||A===0&&!(function(k){const L=$n();return!(L.name!==mi.FIREFOX||!L.osVersion)&&Number(L.version)===k})(138)&&re("USE_SUB_RTX")||gv()?(w=this.createOrRecycleSendMedia(u,T,R,"sendonly",g),this.updateBundleMids()):(w=Ki(this.sessionDesc.mediaDescriptions[A]),w.attributes.direction="sendonly",w.attributes.ssrcs=T,w.attributes.ssrcGroups=R,this.sessionDesc.mediaDescriptions[A]=this.mungSendMediaDesc(w,g)),fi()&&this.firefoxSsrcMidMap.set(T[0].ssrcId,w.attributes.mid),{mid:w.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:u,needExchangeSDP:p}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:u.attributes.mid,needExchangeSDP:p}}batchSend(u){const p=u.map((T=>{let{kind:R,ssrcMsg:I,mslabel:A}=T;return this.send(R,I,A)})),m=[];let g=!1;return p.forEach((T=>{let{mid:R,needExchangeSDP:I}=T;I&&(g=!0),m.push(R)})),{mids:m,needExchangeSDP:g}}stopSending(u){const p=this.sessionDesc.mediaDescriptions.filter((m=>m.attributes.mid&&u.indexOf(m.attributes.mid)!==-1));if(p.length!==u.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");p.forEach((m=>{m.attributes.mid==="0"||fi()||gv()?m.attributes.ssrcs=[]:(m.attributes.ssrcs=[],m.attributes.direction="inactive",m.media.port="0")})),this.updateBundleMids()}mute(u){const p=this.sessionDesc.mediaDescriptions.find((m=>m.attributes.mid===u));if(!p)throw new Error("mediaDescription not found with ".concat(u," in remote SDP when calling RemoteSDP.mute."));p.attributes.direction="inactive"}unmute(u){const p=this.sessionDesc.mediaDescriptions.find((m=>m.attributes.mid===u));if(!p)throw new Error("mediaDescription not found with ".concat(u," in remote SDP when calling RemoteSDP.unmute."));p.attributes.direction="sendonly"}muteRemote(u){const p=this.sessionDesc.mediaDescriptions.filter((m=>Re(u).call(u,m.attributes.mid||"")));if(p.length!==u.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");p.forEach((m=>{m.attributes.direction="inactive"}))}unmuteRemote(u){const p=this.sessionDesc.mediaDescriptions.filter((m=>Re(u).call(u,m.attributes.mid||"")));if(p.length!==u.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");p.forEach((m=>{m.attributes.direction="recvonly"}))}receive(u,p,m,g){u.forEach(((T,R)=>{this.createOrRecycleRecvMedia(T,[],"recvonly",p,m,g[R])})),this.updateBundleMids()}stopReceiving(u){const p=this.sessionDesc.mediaDescriptions.filter((m=>u.indexOf(m.attributes.mid)!==-1));if(p.length!==u.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");p.forEach((m=>{m.media.port="0",m.attributes.direction="inactive"})),this.updateBundleMids()}updateRemoteRTPCapabilities(u){const p=this.sessionDesc||Qo((m=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(m?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var m;this._rtpCapabilities=u;let g=!1;const T=this.rtpCapabilities.send,R=this.localCapabilities.send,I=this.localCapabilities.recv,A=I.videoCodecs,w=I.audioCodecs,k=I.videoExtensions,L=I.audioExtensions;for(const Y of p.mediaDescriptions){var j;if(Y.attributes.direction!=="sendonly"||typeof Y.attributes.mid!="string"||!Re(j=this.useLocalCodecsMids).call(j,Y.attributes.mid)){if(g=!0,Y.attributes.iceUfrag=this._iceParameters.iceUfrag,Y.attributes.icePwd=this._iceParameters.icePwd,Y.attributes.fingerprints=this._dtlsParameters.fingerprints,Y.attributes.candidates=this._candidates,Y.attributes.setup=this.setup,Y.media.mediaType==="application"&&(Y.attributes.sctpPort="5000"),Y.media.mediaType==="video")if(this._isUseLocalCodecs&&Y.attributes.direction==="sendonly"){var K;Y.media.fmts=A.map((de=>de.payloadType.toString(10))),Y.attributes.payloads=A,Y.attributes.extmaps=k;const se=Y.attributes.mid;typeof se!="string"||Re(K=this.useLocalCodecsMids).call(K,se)||this.useLocalCodecsMids.push(se)}else if(T.videoCodecs.length===0){const se=R.videoCodecs.filter((de=>{var ge,je;return(ge=de.rtpMap)===null||ge===void 0?void 0:Re(je=ge.encodingName.toLowerCase()).call(je,"vp8")}))||[R.videoCodecs[0]];Y.media.fmts=se.map((de=>de.payloadType.toString(10))),Y.attributes.payloads=se,Y.attributes.extmaps=[]}else Y.media.fmts=T.videoCodecs.map((se=>se.payloadType.toString(10))),Y.attributes.payloads=T.videoCodecs,Y.attributes.extmaps=T.videoExtensions;if(Y.media.mediaType==="audio")if(this._isUseLocalCodecs&&Y.attributes.direction==="sendonly"){var W;Y.media.fmts=w.map((de=>de.payloadType.toString(10))),Y.attributes.payloads=w,Y.attributes.extmaps=L;const se=Y.attributes.mid;typeof se!="string"||Re(W=this.useLocalCodecsMids).call(W,se)||this.useLocalCodecsMids.push(se)}else if(T.audioCodecs.length===0){const se=R.audioCodecs.filter((de=>{var ge,je;return(ge=de.rtpMap)===null||ge===void 0?void 0:Re(je=ge.encodingName.toLowerCase()).call(je,"opus")}))||[R.audioCodecs[0]];Y.media.fmts=se.map((de=>de.payloadType.toString(10))),Y.attributes.payloads=se,Y.attributes.extmaps=[]}else Y.media.fmts=T.audioCodecs.map((se=>se.payloadType.toString(10))),Y.attributes.payloads=T.audioCodecs,Y.attributes.extmaps=T.audioExtensions,C_(Y)}}return this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1,[this.sessionDesc,g]}updateCandidates(u){const p=this._originCandidates.filter((g=>g.transport==="udp")),m=[];if(p.forEach((g=>{m.push(qC(qC({},g),{},{foundation:"tcpcandidate",priority:Number(g.priority)-1+"",transport:"tcp",port:Number(g.port)+90+""}))})),p.length!==0){switch(u){case As.TCP_RELAY:this._candidates=m;break;case As.UDP_TCP_RELAY:case As.RELAY:this._candidates=[...p,...m];break;default:this._candidates=p}for(const g of this.sessionDesc.mediaDescriptions)g.attributes.candidates=this.candidates}}restartICE(u){u=Ki(u),this._iceParameters=u,this.sessionDesc.mediaDescriptions.forEach((p=>{p.attributes.iceUfrag=u.iceUfrag,p.attributes.icePwd=u.icePwd}))}predictReceivingMids(u){const p=[];for(let m=0;m<u;m++)p.push((this.currentMidIndex+m+1).toString(10));return p}findAvailableMediaIndex(u,p){return this.sessionDesc.mediaDescriptions.findIndex((m=>{const g=m.media.mediaType===u&&m.media.port!=="0"&&(m.attributes.direction==="sendonly"||m.attributes.direction==="sendrecv")&&m.attributes.ssrcs.length===0;if(fi()){if(g){const T=this.firefoxSsrcMidMap.get(p[0].ssrcId);return!(T||m.attributes.mid!=="0"&&m.attributes.mid!=="1")||!(!T||T!==m.attributes.mid)}return!1}return g}))}createOrRecycleDataChannel(){for(const m of this.sessionDesc.mediaDescriptions)if(m.media.mediaType==="application")return{mediaDesc:m,needExchangeSDP:!1};this.currentMidIndex+=1;const u="".concat(this.currentMidIndex),p={media:{mediaType:"application",port:XC,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(u),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(p),{mediaDesc:p,needExchangeSDP:!0}}createOrRecycleRecvMedia(u,p,m,g,T,R){const I=u._mediaStreamTrack.kind,A=this.rtpCapabilities.recv,w=Ih(I,A,this.localCapabilities.send,I===dt.VIDEO?g:T),k=I===dt.VIDEO?A.videoExtensions:A.audioExtensions;this.currentMidIndex+=1;const L="".concat(this.currentMidIndex);let j={media:{mediaType:I,port:XC,protos:["UDP","TLS","RTP","SAVPF"],fmts:w.map((W=>W.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:k,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:w,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:m,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(L)}};j=this.mungRecvMediaDsec(j,u,R);const K=this.findFirstClosedMedia(I);if(K){const W=this.sessionDesc.mediaDescriptions.indexOf(K);this.sessionDesc.mediaDescriptions[W]=j}else this.sessionDesc.mediaDescriptions.push(j);return j}updateRemoteDtlsParameters(u){const p=new Set(this._dtlsParameters.fingerprints.map((T=>T.fingerprint))),m=new Set(u.map((T=>T.fingerprint)));let g=!1;p.size!==m.size&&(g=!0);for(const T of p)m.has(T)||(g=!0);return g}updateRemoteCodec(u,p,m){const g=[...new Set(this._rtpCapabilities.recv.videoCodecs.map((j=>j.rtpMap&&j.rtpMap.encodingName.toLowerCase()||"")).filter((j=>{var K;return Re(K=Object.keys(vC)).call(K,j)})))],T=new Set(p);if(g.every((j=>T.has(j))))return F.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(p)),!1;const R=this._rtpCapabilities.recv.videoCodecs.filter((j=>p.some((K=>{var W;return Re(W=j.rtpMap&&j.rtpMap.encodingName.toLowerCase()||"").call(W,K)}))));if(R.length===0)return F.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(g," codecs: ").concat(p)),!1;const I=[...new Set(R.map((j=>j.rtpMap&&j.rtpMap.encodingName.toLowerCase()||"")))];let A;if(F.debug("updateRemoteCodec, from ".concat(g," to ").concat(I)),u.length===0)A=this.sessionDesc.mediaDescriptions.filter((j=>j.media.mediaType==="video"&&j.attributes.direction==="recvonly"));else if(A=this.sessionDesc.mediaDescriptions.filter((j=>j.attributes.mid&&j.media.mediaType==="video"&&Re(u).call(u,j.attributes.mid)&&j.attributes.direction==="recvonly")),A.length!==u.length)return F.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(u,", codecs: ").concat(p)),!1;if(re("USE_PUB_RTX")||re("USE_SUB_RTX")){const j=td(R,this.rtpCapabilities.recv.videoCodecs);R.push(...j)}this._rtpCapabilities.recv.videoCodecs=R;const w=this.localCapabilities.send,k=this.rtpCapabilities.recv,L=Ih(dt.VIDEO,k,w,m);return A.forEach((j=>{const K=L.map((W=>W.payloadType.toString(10)));F.debug("updateRemoteCodec mid: ".concat(j.attributes.mid,", from"),j.attributes.payloads,"to",L),j.attributes.payloads=L,j.media.fmts=K})),!0}createOrRecycleSendMedia(u,p,m,g,T){const R=this.rtpCapabilities.send.videoCodecs,I=this._isUseLocalCodecs||R.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,A=u===dt.VIDEO?I.videoCodecs:I.audioCodecs,w=u===dt.VIDEO?I.videoExtensions:I.audioExtensions;this.currentMidIndex+=1;const k="".concat(this.currentMidIndex);let L={media:{mediaType:u,port:XC,protos:["UDP","TLS","RTP","SAVPF"],fmts:A.map((K=>K.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:w,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:p,ssrcGroups:m,rtcpFeedbackWildcards:[],payloads:A,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:g,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(k)}};L=this.mungSendMediaDesc(L,T);const j=this.findFirstClosedMedia(u);if(j){const K=this.sessionDesc.mediaDescriptions.indexOf(j);this.sessionDesc.mediaDescriptions[K]=L}else this.sessionDesc.mediaDescriptions.push(L);return L}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((u=>u.media.port!=="0")).map((u=>u.attributes.mid))}mungRecvMediaDsec(u,p,m){const g=Ki(u);return t0(g),Qg(g,p),dP(g,p),n0(g),i0(g,m,this.localCapabilities.send),g}mungSendMediaDesc(u,p){const m=Ki(u);return i0(m,p,this.localCapabilities.recv),C_(m),m}updateRecvMedia(u,p){const m=this.sessionDesc.mediaDescriptions.findIndex((g=>g.attributes.mid===u));if(m!==-1){const g=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[m],p);this.sessionDesc.mediaDescriptions[m]=g}}bumpMid(u){this.currentMidIndex+=u}findFirstClosedMedia(u){return this.sessionDesc.mediaDescriptions.find((p=>fi()?p.media.port==="0"&&p.media.mediaType===u:p.media.port==="0"))}findPreloadMediaDesc(u){return this.sessionDesc.mediaDescriptions.find((p=>{var m;return((m=p.attributes)===null||m===void 0||(m=m.ssrcs[0])===null||m===void 0?void 0:m.ssrcId)===u[0].ssrcId}))}getSSRC(u){var p;return(p=this.sessionDesc.mediaDescriptions.find((m=>m.attributes.mid===u)))===null||p===void 0?void 0:p.attributes.ssrcs}}(na(na({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!re("ENABLE_PRE_SUB_WITH_PRE_PC")||!re("PRE_USE_LOCAL_CODECS"))&&xD(this.store)),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const s=this.remoteSDP.toString(),o=oF(this.initialOffer.sdp,this.extension),c=this.logSDPExchange(o||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),c?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s});const d=this.peerConnection.getTransceivers()[0];if(d!=null&&d.receiver&&this.tryBindTransportEvents(d.receiver),xD(this.store))if(t.preallocation&&re("ENABLE_PRE_SUB_WITH_PRE_PC")){const u=re("PRE_SUB_NUM"),{mids:p,preSSRCs:m}=this.remoteSDP.preloadRemoteMedia(u);await Ym(this.peerConnection,this.remoteSDP,this.extension),F.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(m)),this.presetMedia(p,m)}else{const{preSSRCs:u=[]}=t,p=u.map((g=>g.ssrcMsg[0].ssrcId));if(u.length===0)return;const{mids:m}=this.remoteSDP.batchSend(u.map((g=>Object.assign({},g))));await Ym(this.peerConnection,this.remoteSDP,this.extension),F.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(p)),this.presetMedia(m,p)}}catch(s){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(s.toString()))}var n,i}presetMedia(t,n){t.forEach(((i,s)=>{this.peerConnection.getTransceivers().forEach((o=>{if(o.mid!=null&&i===o.mid&&o.receiver.track){const c=o.receiver.track;let d;c.kind==="video"&&re("ENABLE_PRE_RENDER")&&(d=new QD({trackId:"track-".concat(c.kind,"-unknown-").concat(this.store.clientId,"_").concat(Oi(5,""))},!0),d.updateVideoTrack(c),d.onFirstVideoFrameRender=()=>{var u;const p=this.preMediaMap.get(n[s]);p&&(p.firstVideoRender=Date.now()),(u=this.onFirstVideoRender)===null||u===void 0||u.call(this,n[s])},d.play(this.store.sessionId||void 0)),this.preMediaMap.set(n[s],{mid:i,track:c,player:d,transceiver:o})}})),this.store.peerReceiver()}))}checkDtlsParameters(t){return!!this.remoteSDP&&t.length>0&&this.remoteSDP.updateRemoteDtlsParameters(t)}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let n=!1;const{rtpCapabilities:i}=t;if([,n]=this.remoteSDP.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const c=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);n=n||c}const{preSSRCs:s=[]}=t,o=s.map((c=>c.ssrcMsg[0].ssrcId));if(!this.remoteSDP.checkPreloadSsrcs(o)){const c=[],d=[];if(Array.from(this.preMediaMap.entries()).every((u=>{let[p,{mid:m,player:g,track:T}]=u;return c.push(m),d.push(p),this.preMediaMap.delete(p),g&&g.destroy(),!0})),c.length>0&&(this.remoteSDP.stopSending(c),await Ym(this.peerConnection,this.remoteSDP,this.extension),F.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(d)),fe.reportApiInvoke(this.store.sessionId,{name:Cn.PRELOAD_MEDIA_FAILED,options:[s,d],tag:Tr.TRACER}).onSuccess()),s.length>0){const{mids:u}=this.remoteSDP.batchSend(s.map((p=>Object.assign({},p))));await Ym(this.peerConnection,this.remoteSDP,this.extension),F.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(o)),this.presetMedia(u,o)}}n?(await Ym(this.peerConnection,this.remoteSDP,this.extension),F.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):F.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(n){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(t,n,i){var s=this;return jc((function*(){const o=yield Jn(s.mutex.lock("From P2PConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],d=Qw();t.forEach((w=>{const k=s.peerConnection.addTransceiver(w._mediaStreamTrack,na({direction:"sendonly"},w.trackMediaType==="video"&&s.supportAV1RtpSpec&&d?{sendEncodings:[{scalabilityMode:d}]}:{}));c.push(k),w._updateRtpTransceiver(k)})),fi()&&re("SIMULCAST")===!0&&(yield Jn(s.applySimulcastForFirefox(c,t)));const u=yield Jn(s.peerConnection.createOffer()),p=s.remoteSDP.predictReceivingMids(t.length),m=s.mungSendOfferSDP(u.sdp,t,p),g=Qo(m),T=p.map((w=>{const k=g.mediaDescriptions.find((L=>L.attributes.mid===w));if(!k)throw new Error("Cannot extract ssrc from mediaDescription.");return nF(k,re("USE_PUB_RTX"))}));let R;try{R=yield T}catch(w){R=[],s.remoteSDP.receive(t,n,i,R);const k=s.remoteSDP.toString();throw yield Jn(s.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield Jn(s.peerConnection.setRemoteDescription({type:"answer",sdp:k})),yield Jn(s.stopSending(p,!0)),w}s.remoteSDP.receive(t,n,i,R);const I=s.remoteSDP.toString(),A=s.logSDPExchange(m,"offer","local","send");return yield Jn(s.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield Jn(s.applySimulcastEncodings(c,t)),yield Jn(s.applySendEncodings(c,t)),A?.(I),yield Jn(s.peerConnection.setRemoteDescription({type:"answer",sdp:I})),c.map(((w,k)=>{const L=p[k];return{localSSRC:T[k],id:L,transceiver:w}}))}catch(c){throw c instanceof Ge?c:new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{o()}}))()}async createDataChannels(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let i=this.dataStreamChannelMap.get(t);if(i&&i.readyState==="open")F.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const o=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof o!="number")throw new Error("create DataChannel error, because cannot get dc id");i=this.peerConnection.createDataChannel("datastream-channel",{id:o,negotiated:!0,ordered:!1,maxRetransmits:re("DATASTREAM_MAX_RETRANSMITS")}),i.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,i)}n.forEach((o=>{o._updateOriginDataChannel(i)}));const{needExchangeSDP:s}=this.remoteSDP.sendDataChannel();if(s){const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c),F.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else F.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(i){throw i instanceof Ge?i:new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(i.toString()))}}async stopDataChannels(t){try{const n=this.dataStreamChannelMap.get(t);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(t)}catch(n){throw n instanceof Ge?n:new Ge(H.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getTransceivers().filter((u=>t.indexOf(u.mid)!==-1));if(s.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");s.map((u=>{var p;vP(this.id+u.mid,this),u.direction="inactive",(p=u.stop)===null||p===void 0||p.call(u)}));const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(t);const d=this.remoteSDP.toString();c?.(d),await this.peerConnection.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}finally{i&&i()}}async receive(t,n,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:o,needExchangeSDP:c}=this.remoteSDP.send(t,n,i,s);c&&(await Ym(this.peerConnection,this.remoteSDP,this.extension),F.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));const d=this.peerConnection.getTransceivers().find((u=>u.mid===o));if(!d)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,id:o,transceiver:d}}catch(o){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:i}=this.remoteSDP.batchSend(t);return i&&(await Ym(this.peerConnection,this.remoteSDP,this.extension),F.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map((s=>{const o=this.peerConnection.getTransceivers().find((c=>c.mid===s));if(!o)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:o.receiver.track,id:s,transceiver:o}}))}catch(n){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach((o=>{Array.from(this.preMediaMap.entries()).some((c=>{let[d,{mid:u,player:p}]=c;if(u===o)return this.preMediaMap.delete(d),p&&p.destroy(),!0}))})),this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();i?.(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();i?.(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();i?.(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter((c=>c.mid&&t.indexOf(c.mid)!==-1));if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map((c=>{c.direction="inactive"}));const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const o=this.remoteSDP.toString();s?.(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter((c=>c.mid&&t.indexOf(c.mid)!==-1));if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map((async(c,d)=>{c.direction="sendonly"}));const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);const o=this.remoteSDP.toString();s?.(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return jc((function*(){const i=yield Jn(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const s=ai().supportPCSetConfiguration,o=re("FORCE_TURN_TCP")||n.forceTurn;if(t===As.RELAY&&!s)return;if(s&&!o){const g=t===As.RELAY?"relay":"all",T=n.peerConnection.getConfiguration();T.iceTransportPolicy!==g&&(F.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(T.iceTransportPolicy,"] to [").concat(g,"]")),T.iceTransportPolicy=g,n.peerConnection.setConfiguration(T))}n.remoteSDP.updateCandidates(t);const c=yield Jn(n.peerConnection.createOffer({iceRestart:!0}));if(!c.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const d=Km(c.sdp),{remoteIceParameters:u}=yield d.iceParameters;n.remoteSDP.restartICE(u);const p=n.remoteSDP.toString(),m=n.logSDPExchange(c.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Jn(n.peerConnection.setLocalDescription(c)),m?.(p),yield Jn(n.peerConnection.setRemoteDescription({type:"answer",sdp:p}))}catch(s){F.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),s)}finally{i()}}))()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(As.TCP_RELAY),await Ym(this.peerConnection,this.remoteSDP,this.extension)}catch(n){F.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),n)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach((n=>{vP(this.id+n.mid,this)})),this.preMediaMap.forEach((n=>{let{player:i}=n;i&&i.destroy()})),this.preMediaMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return na(na({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const o=this.remoteSDP.toString(),c=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),c?.(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(i){throw new Ge(H.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter((s=>s.mid===t));i.length===1&&(this.isVP8Simulcast(n)?fi()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find((s=>s.mid===n));i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:s}=n.getSelectedCandidatePair();return{local:na(na({},Ad),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:na(na({},Ad),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var n;const i="code: ".concat(t.errorCode,", message: ").concat(t.errorText),s=t.port?"local: ".concat(t.port):"",o=y_(t.url||"");F.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(i,"), url: ").concat(o||"",", host_candidate:").concat(s)),(n=this.onICECandidateError)===null||n===void 0||n.call(this,i)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&F.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,F.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,F.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),re("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]},i=t.cloudProxyServer||"disabled";return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&(_C(t.turnServer.servers)?n.iceServers=t.turnServer.servers:re("NEW_TURN_MODE")&&n.iceServers&&i==="disabled"?(re("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&n.iceServers.push(...H0.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):n.iceServers.push(...H0.newTurnServerConfigToIceServers(t.turnServer.servers)),re("NEW_FORCE_TURN")&&(n.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(n.iceServers&&n.iceServers.push(...H0.turnServerConfigToIceServers(t.turnServer.servers)),re("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...H0.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),re("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((s=>{s.forceturn&&(n.iceTransportPolicy="relay")})))),re("ENABLE_ENCODED_TRANSFORM")&&ai().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach((i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(of(i.turnServerURL),":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&!re("FORCE_TURN_TCP")&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))})),n}static newTurnServerConfigToIceServers(t){const n=[];return t.forEach((i=>{const s=re("NEW_TURN_MODE");s===1?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}):s===2?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}):s===3?n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(of(i.turnServerURL),":443?transport=tcp")}):s===4&&(n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=udp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":3478?transport=tcp")}),n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(of(i.turnServerURL),":443?transport=tcp")}))})),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var s;n!=null&&n.state&&((s=this.onDTLSTransportStateChange)===null||s===void 0||s.call(this,n.state))},n.onerror=s=>{var o;(o=this.onDTLSTransportError)===null||o===void 0||o.call(this,"error"in s?s.error:s)};const i=n.iceTransport;i&&(i.onstatechange=()=>{const s=n?.iceTransport.state;var o;s&&((o=this.onICETransportStateChange)===null||o===void 0||o.call(this,s))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:s,remote:o}=i.getSelectedCandidatePair()||{};if(s&&o){const c=s.address+":"+s.port,d=o.address+":"+o.port;F.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(y_(c)),", remote ").concat(JSON.stringify(y_(d))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var i,s;if(n||(n=this.peerConnection.getSenders().find((w=>w.track===t._mediaStreamTrack))),!n)return F.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return F.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ai().supportSetRtpSenderParameters)return F.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const o={},c={};switch(t._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;case"balanced":o.degradationPreference="balanced"}const d=(function(A,w){return A.getTransceivers().find((k=>k.sender.track===w||k.receiver.track===w))})(this.peerConnection,t._mediaStreamTrack),u=S4(t);if((function(A){var w;return!(!re("ENABLE_AG_ADAPTATION")||!(A instanceof AC||Re(w=A._hints).call(w,Ni.CUSTOM_TRACK))||!re("FORCE_SUPPORT_AG_ADAPTATION")&&!(jU(14,0,!1)&&TD(17,4)||BU(14)&&Rw(17,4,!0)))})(t)&&d&&n&&u&&this.getLocalVideoStats&&Re(i=["vp8","vp9"]).call(i,this.store.codec)){var p;const A=o.degradationPreference||(Re(p=t._hints).call(p,Ni.CUSTOM_TRACK)?re("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(w,k,L,j,K,W){if(vP(w,L),K(k),j!=="balanced"&&j!=="maintain-framerate"&&j!=="maintain-resolution")return;let Y=-1;IF(w,k);const se=window.setInterval((()=>{const ge=Pv.get(w);if(!re("ENABLE_AG_ADAPTATION")||!ge)return vP(w,L),void K(k);const je=W();if(je.sendPackets>0&&je.OutgoingAvailableBandwidth>0){if(Y===-1)return void(Y=Date.now());if(Date.now()-Y<1e3)return;const _t=je.sendFrameRate,ht=je.OutgoingAvailableBandwidth,[Ct,Ft]=H4(w,_t,ht,ge.adaptationConfig,k,j);Ft&&(L.qualityLimitationReason=Ft),Ct&&ge.adaptationConfig.scale!==Ct.scale&&(F.debug("[".concat(w,"] applyAdaptation: ").concat(L.qualityLimitationReason,`
           sendFps `).concat(_t,", bwe ").concat(ht,", switch from ").concat(ge.adaptationConfig.scale," to ").concat(Ct.scale," ")),ge.adaptationConfig=QC(QC({},ge.adaptationConfig),Ct),K(Ct))}}),re("CHECK_LOCAL_STATS_INTERVAL")),de=QC({},k);Pv.set(w,{timer:se,adaptationConfig:de,originConfig:k,adaptationFunc:K}),F.debug("[".concat(w,"] start adaptation, originConfig: ").concat(JSON.stringify(k),", degradationPreference: ").concat(j))})(this.id+d.mid,u,this,A,(w=>{n&&this.updateAdaptation(n,w)}),this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var m;const{bitrateMax:A,frameRate:w,scaleResolutionDownBy:k}=t._encoderConfig;A&&(c.maxBitrate=1e3*A),(Re(m=t._hints).call(m,Ni.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(w&&(c.maxFramerate=Sl(w)),k&&k>=1&&(c.scaleResolutionDownBy=k))}const{maxFramerate:g}=re("ENCODER_CONFIG_LIMIT");if(g&&typeof g=="number"&&(c.maxFramerate=c.maxFramerate?Math.min(c.maxFramerate,g):g),re("DSCP_TYPE")&&_h()){var T;const A=re("DSCP_TYPE");Re(T=["very-low","low","medium","high"]).call(T,A)&&(c.networkPriority=A)}const R=n.getParameters(),I=(s=R.encodings)===null||s===void 0?void 0:s[0];fi()&&!I&&(o.encodings=[c]),I&&Object.assign(I,c),Object.assign(R,o),F.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(R.encodings))),await n.setParameters(R),await(async function(A,w,k){try{var L;if(!ai().supportSetRtpSenderParameters||!(function(se){return se==="vp9"||se==="av1"})(A)||!re("ENABLE_SVC"))return;const j={},K={},W=w.getParameters(),Y=(L=W.encodings)===null||L===void 0?void 0:L[0];K.scalabilityMode=Qw(k),Y&&Object.assign(Y,K),Object.assign(W,j),await w.setParameters(W),F.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(W.encodings)))}catch(j){F.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",j)}})(this.store.codec,n,re("SVC_MODE"))}async updateAdaptation(t,n){var i,s;if(!t)return F.debug("[updateAdaptation] no rtpSender found");if(!ai().supportSetRtpSenderParameters)return F.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const o={},{bitrateMax:c,frameRate:d,scaleResolutionDownBy:u}=n;c&&(o.maxBitrate=1e3*c),d&&(o.maxFramerate=Sl(d)),u&&u>=1&&Re(i=["vp8","vp9"]).call(i,this.store.codec)&&(o.scaleResolutionDownBy=u);const p=t.getParameters(),m=(s=p.encodings)===null||s===void 0?void 0:s[0];m&&Object.assign(m,o),Object.assign(p,{});try{await t.setParameters(p),F.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(p.encodings)))}catch(g){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?F.debug("[updateAdaptation] peerConnection not connected}"):F.debug("[updateAdaptation] updateRtpSenderEncodings failed",g):F.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,n){try{if(!ai().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const s=t[i],o=n[i];o instanceof zi&&!this.isVP8Simulcast(o)&&await this.updateRtpSenderEncodings(o,s.sender)}}catch{F.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){const s=Qo(t);return n.forEach(((o,c)=>{const d=i[c],u=s.mediaDescriptions.find((p=>p.attributes.mid===d));u&&(Qg(u,o),rF(u,o,this.store.codec))})),Wg(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let u=0;u<t.length;u++){var i,s,o,c,d;const p=t[u],m=n[u];if(m instanceof zi&&!Re(i=m._hints).call(i,Ni.LOW_STREAM)&&(s=m._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((o=m._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(c=m._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((d=m._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1&&this.store.codec==="vp8"){const g={},T={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};g.encodings=[{rid:"m",active:!0,maxBitrate:T.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:T.high}];const R=p.sender.getParameters();await p.sender.setParameters(Object.assign(R,g))}}}async applySimulcastEncodings(t,n){if(!fi()&&t.length===n.length)for(let i=0;i<t.length;i++){const s=n[i];if(s instanceof zi&&this.isVP8Simulcast(s)){const o=t[i],c={},d={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:d.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:d.medium,scaleResolutionDownBy:4}];const u=o.sender.getParameters();await o.sender.setParameters(Object.assign(u,c))}}}isVP8Simulcast(t){var n,i,s,o,c;return!!(t instanceof zi&&re("SIMULCAST")&&this.store.codec==="vp8"&&!Re(n=t._hints).call(n,Ni.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=t._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=t._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=t._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(t,n,i,s){if(re("SDP_LOGGING"))return F.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(s,`
`),t),n==="offer"?o=>{this.logSDPExchange(o,"answer",i==="local"?"remote":"local",s)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(t){if(ai().supportPCSetConfiguration){const n=H0.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}t.isPreallocation&&(this.isPreallocation=!0)}},At(ni.prototype,"updateRemoteRTPCapabilities",[cc],Object.getOwnPropertyDescriptor(ni.prototype,"updateRemoteRTPCapabilities"),ni.prototype),At(ni.prototype,"connect",[cc],Object.getOwnPropertyDescriptor(ni.prototype,"connect"),ni.prototype),At(ni.prototype,"updateRemoteConnect",[cc],Object.getOwnPropertyDescriptor(ni.prototype,"updateRemoteConnect"),ni.prototype),At(ni.prototype,"createDataChannels",[cc],Object.getOwnPropertyDescriptor(ni.prototype,"createDataChannels"),ni.prototype),At(ni.prototype,"receive",[cc],Object.getOwnPropertyDescriptor(ni.prototype,"receive"),ni.prototype),At(ni.prototype,"batchReceive",[cc],Object.getOwnPropertyDescriptor(ni.prototype,"batchReceive"),ni.prototype),At(ni.prototype,"stopReceiving",[cc],Object.getOwnPropertyDescriptor(ni.prototype,"stopReceiving"),ni.prototype),At(ni.prototype,"muteRemote",[cc],Object.getOwnPropertyDescriptor(ni.prototype,"muteRemote"),ni.prototype),At(ni.prototype,"unmuteRemote",[cc],Object.getOwnPropertyDescriptor(ni.prototype,"unmuteRemote"),ni.prototype),At(ni.prototype,"muteLocal",[cc],Object.getOwnPropertyDescriptor(ni.prototype,"muteLocal"),ni.prototype),At(ni.prototype,"unmuteLocal",[cc],Object.getOwnPropertyDescriptor(ni.prototype,"unmuteLocal"),ni.prototype),At(ni.prototype,"close",[cc],Object.getOwnPropertyDescriptor(ni.prototype,"close"),ni.prototype),At(ni.prototype,"updateEncoderConfig",[cc],Object.getOwnPropertyDescriptor(ni.prototype,"updateEncoderConfig"),ni.prototype),At(ni.prototype,"updateSendParameters",[cc],Object.getOwnPropertyDescriptor(ni.prototype,"updateSendParameters"),ni.prototype),At(ni.prototype,"replaceTrack",[cc],Object.getOwnPropertyDescriptor(ni.prototype,"replaceTrack"),ni.prototype),At(ni.prototype,"updateAdaptation",[cc],Object.getOwnPropertyDescriptor(ni.prototype,"updateAdaptation"),ni.prototype),At(ni.prototype,"getRemoteSSRC",[cc],Object.getOwnPropertyDescriptor(ni.prototype,"getRemoteSSRC"),ni.prototype),ni);function cc(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,o=await s.lock("From P2PConnection.".concat(t));try{for(var c=arguments.length,d=new Array(c),u=0;u<c;u++)d[u]=arguments[u];return await i.apply(this,d)}finally{o()}},n}function CP(e,t){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=Sl(t.width),i.height=Sl(t.height);const s=Sl(t.framerate||15);document.body.append(n),document.body.append(i);let o=e._mediaStreamTrack;n.srcObject=new MediaStream([o]),n.play();const c=i.getContext("2d");if(!c)throw new Pe(H.UNEXPECTED_ERROR,"can not get canvas context");const d=ai(),u=i.captureStream(d.supportRequestFrame?0:s).getVideoTracks()[0];u.canvas||(u.canvas=i),i.startCapture=()=>{if(!n)return i.stopCapture&&i.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const m=n.videoWidth,g=n.videoHeight/m,T=i.width*g;Math.abs(T-i.height)>=2&&(F.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(T)),i.height=T)}c.drawImage(n,0,0,i.width,i.height),u.requestFrame&&u.requestFrame(),o!==e._mediaStreamTrack&&(o=e._mediaStreamTrack,n.srcObject=new MediaStream([o]))},i.stopCapture=jD((()=>i.startCapture&&i.startCapture()),s);const p=u.stop;return u.stop=()=>{p.call(u),n&&(n.remove(),n.srcObject=null,n=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),F.debug("clean low stream renderer")},u}var Oh=(function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e})(Oh||{}),qt=(function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e})(qt||{}),Vt=(function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e})(Vt||{}),$i=(function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e})($i||{}),Ha=(function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e})(Ha||{}),w_=(function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e})(w_||{});const O_=1e3,$g=6,l0=3,jt=Math.max($g,l0,60);function Bt(e,t,n){n!=null&&Number.isFinite(n)&&(e[t]=Math.round(Math.max(0,n)))}function OF(e){const t={[Ha.CONN_TYPE]:0,[Ha.RTT]:e.rtt,[Ha.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=e.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(t[Ha.CONN_TYPE]=1),n==="tcp"&&(t[Ha.CONN_TYPE]=3),n==="tls"&&(t[Ha.CONN_TYPE]=4);break}case"srflx":t[Ha.CONN_TYPE]=2;break;case"unknown":t[Ha.CONN_TYPE]=5;break;default:t[Ha.CONN_TYPE]=0}return t}function NF(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class K4 extends rr{constructor(t){super(),Q(this,"store",void 0),Q(this,"uploadWRTCStatsTimer",void 0),Q(this,"uploadOutboundDenoiserStatsTimer",void 0),Q(this,"uploadExtStatsTimer",void 0),Q(this,"uploadExtUsageStatsTimer",void 0),Q(this,"uploadInboundExtStatsTimer",void 0),Q(this,"requestStats",void 0),Q(this,"requestTransportStats",void 0),Q(this,"requestLocalMedia",void 0),Q(this,"requestRemoteMedia",void 0),Q(this,"requestAllTracks",void 0),Q(this,"requestVideoIsReady",void 0),Q(this,"requestUploadStats",void 0),Q(this,"requestUpload",void 0),Q(this,"uploadOutboundStarted",!1),Q(this,"uploadInboundStarted",!1),Q(this,"uploadTransportStarted",!1),Q(this,"uploadBaseStatsStarted",!1),Q(this,"uploadExtensionUsageStarted",!1),Q(this,"lastRecvStats",void 0),Q(this,"lastSendStats",void 0),Q(this,"lastRefRecvStats",void 0),Q(this,"lastRefSendStats",void 0),Q(this,"lastNormalRecvStats",void 0),Q(this,"lastNormalSendStats",void 0),Q(this,"lastExtendStats",{}),Q(this,"needUploadStats",{}),Q(this,"needUploadRenderFreezeTime",!0),Q(this,"lastUploadCompensateTime",-1),Q(this,"uploadCompensateDeltaTime",0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;const n=t%l0==0,i=t%$g==0,s=t%60==0;let o,c;if(this.uploadTransportStarted&&(o=this.requestStats(),this.store.useP2P&&(c=this.requestStats(!0))),!o&&this.uploadOutboundStarted&&(o=this.requestStats()),!c&&this.uploadInboundStarted&&(c=this.requestStats(!0)),o||c){var d;const u={};if(this.uploadTransportStarted&&o){const m=this.getTransportStats(o,c,n);m&&(u.misc=[m])}if(this.uploadOutboundStarted&&o){const m=this.getOutboundStats(o,i?this.lastNormalSendStats:void 0,n?this.lastRefSendStats:void 0,this.lastSendStats,s);m&&(u.outbound=[m])}if(this.uploadInboundStarted&&c){this.uploadCompensateStats(t);const m=this.getInboundStats(c,i?this.lastNormalRecvStats:void 0,n?this.lastRefRecvStats:void 0,this.lastRecvStats);m&&(u.inbound=m)}const p=(d=this.requestTransportStats)===null||d===void 0?void 0:d.call(this).connectState;p&&(Array.isArray(u.misc)?u.misc[0]&&u.misc[0].addition&&(u.misc[0].addition[w_.RTC_PEER_CONNECTION_STATE]=ul[p]):u.misc=[{addition:{[w_.RTC_PEER_CONNECTION_STATE]:ul[p]}}]),this.needUploadStats.sendType&&(Array.isArray(u.outbound)&&u.outbound[0]&&u.outbound[0].high&&(u.outbound[0].high[Oh.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(u)}this.lastRecvStats=c,this.lastSendStats=o,i&&(this.lastNormalRecvStats=c,this.lastNormalSendStats=o),n&&(this.lastRefRecvStats=c,this.lastRefSendStats=o)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval((()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var n,i;const s=(n=this.requestTransportStats)===null||n===void 0?void 0:n.call(this);return void(s&&((i=this.requestUploadStats)===null||i===void 0||i.call(this,{misc:[{addition:{[w_.RTC_PEER_CONNECTION_STATE]:ul[s.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===jt+1&&(t=1)}),O_)}uploadCompensateStats(t){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const n=t%l0==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!n)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const i=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=i,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const s=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*s;const o=this.requestStats(!0);new Array(s).fill(0).forEach((()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const c={};if(this.uploadInboundStarted&&o){const d=this.requestRemoteMedia()||[],u=[];d.forEach((p=>{let[m,g]=p;const T={peer:m.uid};if(m._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(m._videoSSRC)&&g.has(dt.VIDEO)&&m.videoTrack){const R=(function(I,A,w){if(!A.videoRecv.find((L=>L.ssrc===I)))return;const k={};if(w&&w._player){const L=w._player,{renderFreezeAccTime2:j,videoElementStatus:K}=L;if(nf.visibility==="visible"&&K===gs.PLAYING&&ai().supportRequestVideoFrameCallback){const W=Math.min(6e3,j);L.renderFreezeAccTime2=Math.max(0,j-W),Bt(k,qt.Video_Render_Freeze_Time_Render2,W),re("USE_NEW_RENDER_FREEZE_TIME")&&Bt(k,qt.Video_Render_Freeze_Time_Render,W)}}return k})(m._videoSSRC,o,m.videoTrack);R&&(T.video=R)}T.video&&u.push(T)})),u.length>0&&(c.inbound=u,this.requestUploadStats(c))}}))}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(t,n,i){if(!this.requestStats)return;if(!i)return t.rtt==null?void 0:{addition:{[Ha.RTT]:t.rtt,[Ha.CONN_TYPE]:void 0,[Ha.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};const s=OF(t);if(this.store.useP2P){if(n){const o=OF(n);s[Ha.CONN_TYPE]+=o[Ha.CONN_TYPE]<<3}s[Ha.CONN_TYPE]+=110}else s[Ha.CONN_TYPE]+=100;return{addition:s}}getOutboundStats(t,n,i,s,o){if(!this.requestUploadStats||!this.requestLocalMedia)return;const c=this.requestLocalMedia();if(!c||c.length===0)return;let d,u,p;return c.forEach((m=>{let[g,{track:T,ssrcs:R}]=m;switch(g){case He.LocalVideoLowTrack:case He.LocalVideoTrack:if(g===He.LocalVideoTrack){var I;const A=(function(j,K,W,Y,se,de){const ge=K.videoSend.find((Ct=>Ct.ssrc===j));if(!ge)return;const je={},{sentFrame:_t,inputFrame:ht}=ge;if(Y&&(Bt(je,qt.Video_Send_Qp_Sum,ge.qpSumPerFrame),ht&&_t)){const Ct=ht.frameRate,Ft=_t.frameRate;je[qt.Video_Send_Freeze]=(function(mn,We){let Se=!0;return Se=!(mn<=5)&&(mn<=10?We<3:mn<=20?We<4:We<5),Se})(Ct,Ft)?1:0}if(se){switch(_t&&(Bt(je,Vt.Video_Send_Height,_t.height),Bt(je,Vt.Video_Send_Width,_t.width),Bt(je,Vt.Video_Send_Frame_Rate,_t.frameRate)),je[Vt.Video_Send_Disabled]=W._originMediaStreamTrack&&!W._originMediaStreamTrack.enabled||W._mediaStreamTrack&&!W._mediaStreamTrack.enabled?1:0,ge.adaptionChangeReason){case"none":je[Vt.Video_Send_Adaptation]=0;break;case"cpu":je[Vt.Video_Send_Adaptation]=1;break;case"bandwidth":je[Vt.Video_Send_Adaptation]=2;break;case"other":je[Vt.Video_Send_Adaptation]=3}let Ct=0;ge.adaptionChangeReason&&(Ct+=NF(ge.adaptionChangeReason)),K.qualityLimitationReason&&(Ct+=NF(K.qualityLimitationReason)<<3),je[Vt.Video_Send_Adaptation]=Ct,je[Vt.Video_Send_Player_Status]=IC[W._player?W._player.videoElementStatus:"uninit"],Bt(je,Vt.Video_Send_Nacks,ge.nacksCount),Bt(je,Vt.Video_Send_Plis,ge.plisCount),Bt(je,Vt.Video_Send_Firs,ge.firsCount),Bt(je,Vt.Video_Send_Avg_Encode,ge.avgEncodeMs),Bt(je,Vt.Video_Send_Huge_Frame_Sent,ge.hugeFramesSent),Bt(je,Vt.Video_Send_Bytes_Retransmit,ge.retransmittedBytesSent),Bt(je,Vt.Video_Send_Packages_Retransmit,ge.retransmittedPacketsSent),Bt(je,Vt.Video_Send_Key_Frames_Encoded,ge.keyFramesEncoded);const Ft=se.videoSend.find((mn=>mn.ssrc===j));if(Ft){let mn=O_*l0;Ft.timestamp&&ge.timestamp&&(mn=ge.timestamp-Ft.timestamp),Ft.packets!=null&&ge.packets!=null&&Bt(je,Vt.Video_Send_Package_Rate,1e3*(ge.packets-Ft.packets)/mn),ge.packetsLost!=null&&Ft.packetsLost!=null&&Bt(je,Vt.Video_Send_Package_Lost,ge.packetsLost-Ft.packetsLost),Ft.bytes!=null&&ge.bytes!=null&&Bt(je,Vt.Video_Send_Bitrate,8*(ge.bytes-Ft.bytes)/mn)}}return je})(R[0].ssrcId,t,T,n,i),w=T.__className__==="CameraVideoTrack"?3:Re(I=T._hints).call(I,Ni.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==w||o)&&(this.needUploadStats={sendType:w},this.lastExtendStats.sendType=w);const k=T&&(function(j,K,W,Y){const se=K.videoSend.find((ge=>ge.ssrc===j));if(!se)return null;const de={};if(Y){const ge=se.inputFrame,je=ge&&ge.height||W.videoHeight||0,_t=ge&&ge.width||W.videoWidth||0,ht=ge&&ge.frameRate||0;Bt(de,Vt.Video_Capture_Height,je),Bt(de,Vt.Video_Capture_Width,_t),Bt(de,Vt.Video_Capture_Frame_Rate,ht)}return de})(R[0].ssrcId,t,T,!!i),L=(function(j,K){const W={};return K&&(Bt(W,Vt.Video_Send_Retransmit,j.bitrate.retransmit),Bt(W,Vt.Video_Send_Target_Encoded,j.bitrate.targetEncoded),Bt(W,Vt.Video_Send_Actual_Encoded,j.bitrate.actualEncoded),Bt(W,Vt.Video_Send_Transmit,j.bitrate.transmit),Bt(W,Vt.Video_Send_Bandwidth,j.sendBandwidth)),W})(t,!!i);u=Object.assign({},A,k,L)}else p=(function(A,w,k,L,j){const K=w.videoSend.find((Y=>Y.ssrc===A));if(!K)return;const W={};if(L){const Y=K.sentFrame;Y&&(Bt(W,Vt.Video_Send_Low_Height,Y.height),Bt(W,Vt.Video_Send_Low_Width,Y.width),Bt(W,Vt.Video_Send_Low_Frame_Rate,Y.frameRate));const se=L.videoSend.find((de=>de.ssrc===A));if(se){let de=O_*$g;se.timestamp&&K.timestamp&&(de=K.timestamp-se.timestamp),se.packets!=null&&K.packets!=null&&Bt(W,Vt.Video_Send_Low_Package_Rate,1e3*(K.packets-se.packets)/de),K.packetsLost!=null&&se.packetsLost!=null&&Bt(W,Vt.Video_Send_Low_Package_Lost,K.packetsLost-se.packetsLost),se.bytes!=null&&K.bytes!=null&&Bt(W,Vt.Video_Send_Low_Bitrate,8*(K.bytes-se.bytes)/de)}}return W})(R[0].ssrcId,t,0,i);break;case He.LocalAudioTrack:d=T&&(function(A,w,k,L,j,K){const W=w.audioSend.find((se=>se.ssrc===A));if(!W)return;const Y={};if(j){Y[Vt.Audio_Send_Disabled]=k._originMediaStreamTrack&&!k._originMediaStreamTrack.enabled||k._mediaStreamTrack&&!k._mediaStreamTrack.enabled?1:0;const se=100*k._source.getAccurateVolumeLevel(),de=W.inputLevel;if(de!=null){const je=Math.ceil(50*Math.log10(100*de+1));Bt(Y,Vt.Audio_Send_Level,je)}Bt(Y,Vt.Audio_Capture_PCM_Level,se),Bt(Y,Vt.Audio_Send_AEC_Return_Loss,W.aecReturnLoss),Bt(Y,Vt.Audio_Send_AEC_Return_Loss_Enhancement,W.aecReturnLossEnhancement),Bt(Y,Vt.Audio_Send_Bytes_Retransmit,W.retransmittedBytesSent),Bt(Y,Vt.Audio_Send_Packages_Retransmit,W.retransmittedPacketsSent),Y[Vt.Audio_Send_Freeze]=0;const ge=j.audioSend.find((je=>je.ssrc===A));if(ge){let je=O_*$g;ge.timestamp&&W.timestamp&&(je=W.timestamp-ge.timestamp),ge.bytes!=null&&W.bytes!=null&&Bt(Y,Vt.Audio_Send_Bitrate,8*(W.bytes-ge.bytes)/je),ge.packets!=null&&W.packets!=null&&Bt(Y,Vt.Audio_Send_Package_Rate,1e3*(W.packets-ge.packets)/je)}}return Y})(R[0].ssrcId,t,T,0,i)}})),{high:u,low:p,audio:d}}getInboundStats(t,n,i,s){if(!this.requestRemoteMedia)return;const o=this.requestRemoteMedia()||[],c=[];return o.forEach((d=>{let[u,p]=d;const m={peer:u.uid};if(p.has(dt.VIDEO)&&u.videoTrack){const g=u._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(u._videoSSRC)||!1,T=u.videoTrack?(function(R,I,A,w,k,L,j,K){const W=I.videoRecv.find((Ct=>Ct.ssrc===R));if(!W)return;const Y={},{receivedFrame:se,outputFrame:de,decodeFrameRate:ge}=W;Bt(Y,$i.Video_Render_Frame_Rate_Decode,ge),W.framesRateFirefox&&Bt(Y,$i.Video_Recv_Frame_Rate,W.framesRateFirefox),se&&Bt(Y,$i.Video_Recv_Frame_Rate,se.frameRate),Bt(Y,$i.Video_Recv_Frame_Dropped,W.framesDroppedCount),Bt(Y,$i.Video_Recv_Bytes_Retransmit,W.retransmittedBytesReceived),Bt(Y,$i.Video_Recv_Packages_Retransmit,W.retransmittedPacketsReceived),Bt(Y,$i.Video_Recv_Packages_Discarded,W.packetsDiscarded),Bt(Y,$i.Video_Recv_Avg_Decode,W.avgDecodeMs),Bt(Y,$i.Video_Recv_Avg_Processing_Delay,W.avgProcessingDelayMs),Bt(Y,$i.Video_Recv_Avg_Assembly_Time,W.avgFramesAssembledFromMultiplePacketsMs),Bt(Y,$i.Video_Recv_Avg_Inter_Frame_Delay,W.avgInterFrameDelayMs),Bt(Y,$i.Video_Recv_Key_Frames_Decoded,W.keyFramesDecoded);const je=K&&K.videoRecv.find((Ct=>Ct.ssrc===R));if(je){const Ct=I.timestamp-K.timestamp||O_;W.packetsLost!=null&&je.packetsLost!=null&&Bt(Y,$i.Video_Recv_Package_Lost,W.packetsLost-je.packetsLost),je.bytes!=null&&W.bytes!=null&&Bt(Y,$i.Video_Recv_Bitrate,8*(W.bytes-je.bytes)/Ct),je.packets!=null&&W.packets!=null&&Bt(Y,$i.Video_Recv_Package_Rate,1e3*(W.packets-je.packets)/Ct)}const _t=L&&L.videoRecv.find((Ct=>Ct.ssrc===R));if(_t&&(Bt(Y,qt.Video_Recv_Qp_Sum,W.qpSumPerFrame),Y[qt.Video_Recv_Freeze]=w&&YC.isRemoteVideoFreeze(A,W,_t)?1:0),j){var ht;const Ct=j.videoRecv.find((mn=>mn.ssrc===R));se?(Bt(Y,Vt.Video_Recv_Height,se.height),Bt(Y,Vt.Video_Recv_Width,se.width)):A&&(Bt(Y,Vt.Video_Recv_Height,A._videoHeight||0),Bt(Y,Vt.Video_Recv_Width,A._videoWidth||0)),de&&Bt(Y,Vt.Video_Recv_Frame_Rate_Output,de.frameRate);const Ft=(ht=A._player)===null||ht===void 0?void 0:ht.rendFrameRate.toFixed(0);if(Ft&&Bt(Y,Vt.Video_Render_Frame_Rate_Render,+Ft),Bt(Y,Vt.Video_Recv_Jitter_Buffer,W.jitterBufferMs),Bt(Y,Vt.Video_Recv_Current_Delay,W.currentDelayMs),Bt(Y,Vt.Video_Recv_Firs,W.firsCount),Bt(Y,Vt.Video_Recv_Nacks,W.nacksCount),Bt(Y,Vt.Video_Recv_Plis,W.plisCount),A){Y[Vt.Video_Recv_Disabled]=A._originMediaStreamTrack.enabled&&A._mediaStreamTrack.enabled?0:1;const mn=A._player;if(mn){const{freezeTimeCounterList:We,renderFreezeAccTime:Se,renderFreezeAccTime2:we,videoElementStatus:be}=mn;if(We&&We.length>0&&Bt(Y,qt.Video_Render_Freeze_Time,We.splice(0,1)[0]),k&&nf.visibility==="visible"&&be===gs.PLAYING&&ai().supportRequestVideoFrameCallback){const M=Math.min(6e3,we);mn.renderFreezeAccTime2=Math.max(0,we-M),Bt(Y,qt.Video_Render_Freeze_Time_Render2,M);const O=Math.min(6e3,Se);mn.renderFreezeAccTime=Math.max(0,Se-O),Bt(Y,qt.Video_Render_Freeze_Time_Render,re("USE_NEW_RENDER_FREEZE_TIME")?M:O)}if(typeof W.totalFreezesDuration=="number"){const M=Ct&&Ct.totalFreezesDuration?W.totalFreezesDuration-Ct.totalFreezesDuration:W.totalFreezesDuration;Bt(Y,Vt.Video_Render_Freeze_Duration,1e3*M)}}}if(Y[Vt.Video_Recv_Player_Status]=IC[A._player?A._player.videoElementStatus:"uninit"],Ct&&W.totalInterFrameDelay!==void 0&&W.totalSquaredInterFrameDelay!==void 0&&Ct.totalInterFrameDelay!==void 0&&Ct.totalSquaredInterFrameDelay!==void 0){const mn=W.totalInterFrameDelay-Ct.totalInterFrameDelay,We=W.totalSquaredInterFrameDelay-Ct.totalSquaredInterFrameDelay,Se=W.framesDecodeCount-Ct.framesDecodeCount,we=mn/Se*1e3,be=Math.round(1e3*Math.sqrt((We-Math.pow(mn,2)/Se)/Se));!isNaN(be)&&we+be>Math.max(3*we,we+150)&&(Y[Vt.Video_Recv_I_Frame_Delay]=be)}}return Y})(u._videoSSRC,t,u.videoTrack,g===!0,this.needUploadRenderFreezeTime,n,i,s):void 0;T&&(m.video=T)}if(p.has(dt.AUDIO)&&u.audioTrack){const g=u.audioTrack?(function(T,R,I,A,w,k){const L=R.audioRecv.find((Y=>Y.ssrc===T));if(!L)return;const j={};Bt(j,$i.Audio_Recv_Jitter,L.jitterMs),Bt(j,$i.Audio_Recv_Bytes_Retransmit,L.retransmittedBytesReceived),Bt(j,$i.Audio_Recv_Packages_Retransmit,L.retransmittedPacketsReceived),Bt(j,$i.Audio_Recv_Packages_Discarded,L.packetsDiscarded),Bt(j,$i.Audio_Recv_Avg_Processing_Delay,L.avgProcessingDelayMs);const K=k&&k.audioRecv.find((Y=>Y.ssrc===T));if(K){const Y=O_;L.packets!=null&&K.packets!=null&&Bt(j,$i.Audio_Recv_Package_Rate,1e3*(L.packets-K.packets)/Y),L.packetsLost!=null&&K.packetsLost!=null&&Bt(j,$i.Audio_Recv_Package_Lost,L.packetsLost-K.packetsLost)}if(A){const{receivedFrames:Y,droppedFrames:se}=L;Y!=null&&se!=null&&(j[qt.Audio_Recv_Freeze]=(W=Y)===0||100*se/W>20?1:0)}var W;if(w){const Y=100*I._source.getAccurateVolumeLevel(),se=L.outputLevel;if(se!=null){const ge=Math.ceil(50*Math.log10(100*se+1));Bt(j,Vt.Audio_Render_Level,ge)}Bt(j,Vt.Audio_Recv_PCM_Level,Y),I&&(j[Vt.Audio_Recv_Disabled]=I._originMediaStreamTrack.enabled&&I._mediaStreamTrack.enabled?0:1),Bt(j,Vt.Audio_Recv_Jitter_Buffer,L.jitterBufferMs),Bt(j,Vt.Audio_Recv_Current_Delay,L.jitterBufferMs),j[Vt.Audio_Recv_Player_Status]=IC[wi.getPlayerState(I.getTrackId())];const de=w.audioRecv.find((ge=>ge.ssrc===T));if(de){de.bytes!=null&&L.bytes!=null&&Bt(j,Vt.Audio_Recv_Bitrate,8*(L.bytes-de.bytes)/(O_*l0));const ge=L.concealedSamples-de.concealedSamples;ge>0&&Bt(j,Vt.Audio_Recv_Concealed_Samples,ge);const je=L.totalSamplesReceived-de.totalSamplesReceived;je>0&&Bt(j,Vt.Audio_Recv_Total_Samples_Received,je);const _t=L.freezeSamples80-de.freezeSamples80;_t>0&&Bt(j,Vt.Audio_Render_Freeze_Samples_80ms,_t);const ht=L.freezeSamples200-de.freezeSamples200;ht>0&&Bt(j,Vt.Audio_Render_Freeze_Samples_200ms,ht);const Ct=L.freezeMs80-de.freezeMs80;Bt(j,Vt.Audio_Render_Freeze_Time_80ms,Ct<0?0:Ct);const Ft=L.freezeMs200-de.freezeMs200;Bt(j,Vt.Audio_Render_Freeze_Time_200ms,Ft<0?0:Ft)}}return j})(u._audioSSRC,t,u.audioTrack,n,i,s):void 0;g&&(m.audio=g)}(m.video||m.audio)&&c.push(m)})),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,c}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval((()=>{if(!this.requestAllTracks||!this.requestUpload)return;const t=(this.requestAllTracks()||[]).find((n=>n instanceof Uw));if(t&&t._external.getDenoiserStats){const n=t._external.getDenoiserStats();n&&this.requestUpload(Ln.DENOISER_STATS,n)}}),2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval((()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach((t=>{t.getProcessorStats().forEach((n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)}))}))}),2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval((()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach((t=>{let[n,i]=t;i.has(dt.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach((s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)})),i.has(dt.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach((s=>{this.requestUpload&&this.requestUpload(s.type,s.stats)}))}))}),2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const t=new Map;this.uploadExtUsageStatsTimer=window.setInterval((async()=>{const n=Date.now(),i={connectionInterval:re("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let s=[];const o=this.requestAllTracks&&this.requestAllTracks()||[];for(const p of o)!p.muted&&p.enabled&&(s=s.concat(await p.getProcessorUsage()));const c=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[p,m]of c)m.has(dt.VIDEO)&&p.videoTrack&&(s=s.concat(await p.videoTrack.getProcessorUsage())),m.has(dt.AUDIO)&&p.audioTrack&&(s=s.concat(await p.audioTrack.getProcessorUsage()));if(s.length===0)return;i.details=(function(p,m){const g={};for(const{id:A,value:w,level:k,direction:L}of p){var T;const j=(T=m.get(A))!==null&&T!==void 0?T:0,K=w===2?j+re("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:j;var R,I;m.set(A,K),g[A]?(w===2&&(g[A].value=w),k>g[A].level&&(g[A].level=k),L==="remote"&&(g[A].remoteUidCount+=1),g[A].totalTs=(R=m.get(A))!==null&&R!==void 0?R:0):g[A]={value:w,level:k,remoteUidCount:L==="local"?0:1,totalTs:(I=m.get(A))!==null&&I!==void 0?I:0}}return Object.keys(g).map((A=>{const{level:w,value:k,totalTs:L}=g[A];return{id:A,level:w,value:k,totalTs:L}}))})(s,t);const d=Date.now(),u=d>n?d:n+1;this.requestUpload&&this.requestUpload(Ln.EXTENSION_USAGE_STATS,{usageStats:i,sendTs:u})}),re("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const bP=re("ICE_RESTART_INTERVAL");let Zm=new Map,Iu=new Map,N_=[As.UDP_TCP_RELAY,As.TCP_RELAY,As.RELAY],IP=re("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&ai().supportPCSetConfiguration;function DF(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=Zm.get(e.id);n&&(window.clearTimeout(n),Zm.delete(e.id));const i=Iu.get(e.id);t&&i&&i.index===N_.length-1&&(F.debug("[".concat(e.id,"] reset ICE restart policy")),Iu.delete(e.id))}function Mn(e,t,n){if(Zm.size===0&&Iu.size===0&&(Array.isArray(re("RESTART_SEQUENCE"))&&re("RESTART_SEQUENCE").length>0&&!(function(d,u){if(d.length!==u.length)return!1;for(let p=0;p<d.length;p+=1){const m=d[p];if(d.filter((g=>g===m)).length!==u.filter((g=>g===m)).length)return!1}return!0})(N_,re("RESTART_SEQUENCE"))&&(N_=re("RESTART_SEQUENCE").filter((d=>{var u;if(Re(u=Object.values(As)).call(u,d))return!0})),F.debug("use reconnection policy from config distribution, queues: ".concat(N_.join(" => ")))),IP=re("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&ai().supportPCSetConfiguration),N_.length===0)return void n();let i,{index:s=0,type:o}=Iu.get(e.id)||{};if(IP&&o===As.RELAY)return void n();let c=o&&s>=N_.length-1;if(IP)o=As.RELAY;else{if(c)return void n();o?(s++,o=N_[s]):(o=N_[0],s=0)}F.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(o,", index: ").concat(s)),t(o),Iu.set(e.id,{index:s,type:o}),i=window.setTimeout((()=>Mn(e,t,n)),bP),Zm.set(e.id,i)}var Un;function df(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function uf(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?df(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):df(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}function d0(e){var t,n,i,s=2;for(typeof Symbol<"u"&&(n=dw,i=Symbol.iterator);s--;){if(n&&(t=e[n])!=null)return t.call(e);if(i&&(t=e[i])!=null)return new eS(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function eS(e){function t(n){if(Object(n)!==n)return De.reject(new TypeError(n+" is not an object."));var i=n.done;return De.resolve(n.value).then((function(s){return{value:s,done:i}}))}return eS=function(n){this.s=n,this.n=n.next},eS.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var i=this.s.return;return i===void 0?De.resolve({value:n,done:!0}):t(i.apply(this.s,arguments))},throw:function(n){var i=this.s.return;return i===void 0?De.reject(n):t(i.apply(this.s,arguments))}},new eS(e)}let ia=(Un=class extends rr{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(kt.StateChange,t,this._state)}constructor(e,t){super(),Q(this,"isPlanB",void 0),Q(this,"store",void 0),Q(this,"statsUploader",void 0),Q(this,"connection",void 0),Q(this,"localTrackMap",new Map),Q(this,"remoteUserMap",new Map),Q(this,"localDataChannels",[]),Q(this,"remoteDataChannelMap",new Map),Q(this,"pendingLocalTracks",[]),Q(this,"pendingRemoteTracks",[]),Q(this,"pendingLocalDataChannels",[]),Q(this,"pendingRemoteDataChannels",[]),Q(this,"statsCollector",void 0),Q(this,"shouldForwardP2PCreation",void 0),Q(this,"iceFailedCount",0),Q(this,"dtlsFailedCount",0),Q(this,"mutex",void 0),Q(this,"_state",ut.Disconnected),Q(this,"_pcStatsUploadType",re("NEW_ICE_RESTART")?T_.FIRST_CONNECTION:T_.OLD_FIRST_CONNECTION),Q(this,"_isStartRestartIce",!1),Q(this,"_restartTimer",void 0),Q(this,"_isTryConnecting",!1),Q(this,"_iceError",null),Q(this,"_forceTurn",!1),Q(this,"_isWaitPcToRePub",!1),Q(this,"handleMuteLocalTrack",(async(n,i,s)=>{const o=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==ut.Connected)return void s(new Ge(H.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const c=this.filterTobeMutedTracks(n);if(c.length===0)return void i();const d=c.find((p=>p[0]==="videoLowTrack"));if(d){const p=d[1];this.store.enableInstantMuteRestore?(p.track._originMediaStreamTrack.enabled=!1,F.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):p.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?F.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(c.map((p=>{let[,{id:m}]=p;return m})));const u=this.createMuteMessage(c);await ei(this,kt.RequestMuteLocal,u),i()}catch(c){s(c)}finally{o()}})),Q(this,"handleUnmuteLocalTrack",(async(n,i,s)=>{const o=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==ut.Connected)return void s(new Ge(H.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();const d=c.find((p=>p[0]==="videoLowTrack"));if(d){const p=d[1];if(this.store.enableInstantMuteRestore)p.track._originMediaStreamTrack.enabled=!0,F.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(p.track._originMediaStreamTrack.stop(),!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&ai().supportDualStreamEncoding){const m=n._mediaStreamTrack.clone();p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m}else{const m=CP(n,Kr(this,kt.RequestLowStreamParameter));p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m}await new De(((m,g)=>{this.handleReplaceTrack(p.track,m,g,!0)}))}}this.store.enableInstantMuteRestore?F.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(c.map((p=>{let[,{id:m}]=p;return m})));const u=this.createUnmuteMessage(c);await ei(this,kt.RequestUnmuteLocal,u),i()}catch(c){s(c)}finally{o()}})),Q(this,"handleUpdateVideoEncoder",(async(n,i,s,o)=>{let c;o||(c=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const u=this.localTrackMap.get(He.LocalVideoTrack);if(!this.connection||!u||u.track!==n||this.state!==ut.Connected)return void i();const{id:p,track:m}=u;await this.connection.updateSendParameters(p,m),await this.connection.updateEncoderConfig(p,m),this.emit(kt.UpdateVideoEncoder,m),i()}catch(u){s(u)}finally{var d;(d=c)===null||d===void 0||d()}})),Q(this,"handleUpdateVideoSendParameters",(async(n,i,s)=>{const o=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(He.LocalVideoTrack);if(!this.connection||!c||c.track!==n||this.state!==ut.Connected)return void i();const{id:d,track:u}=c;await this.connection.updateSendParameters(d,u),i()}catch(c){s(c)}finally{o()}})),Q(this,"handleReplaceMixingTrack",(async(n,i,s,o)=>{if(!this.connection||this.state!==ut.Connected)return void i();const c=wF([n]);let d;F.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(c.getTrackId(),"]")),typeof o=="boolean"&&o||(d=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,c),i()}catch(p){s(p)}finally{var u;(u=d)===null||u===void 0||u()}})),Q(this,"handleReplaceTrack",(async(n,i,s,o)=>{let c;F.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof o=="boolean"&&o||(c=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var d;const p=Array.from(this.localTrackMap.entries()).find((m=>{let[,{track:g}]=m;return n===g}));if(!this.connection||!p||this.state!==ut.Connected)return void i();if(await((d=this.connection)===null||d===void 0?void 0:d.replaceTrack(n,p[1].id)),this.isPlanB){const m=p[1];m.id=n._mediaStreamTrack.id,this.localTrackMap.set(p[0],m)}if(p[0]===He.LocalVideoTrack&&!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&ai().supportDualStreamEncoding){const m=this.localTrackMap.get(He.LocalVideoLowTrack);if(m){const g=n._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=g,m.track._originMediaStreamTrack=g,await new De(((T,R)=>{this.handleReplaceTrack(m.track,T,R,!0)}))}}i()}catch(p){s(p)}finally{var u;(u=c)===null||u===void 0||u()}})),Q(this,"handleGetRTCStats",(n=>{n(this.statsCollector.getRTCStats())})),Q(this,"handleGetLocalVideoStats",(n=>{n(this.statsCollector.getLocalVideoTrackStats())})),Q(this,"handleGetLocalAudioStats",(n=>{n(this.statsCollector.getLocalAudioTrackStats())})),Q(this,"handleGetRemoteVideoStats",(n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid])),Q(this,"handleGetRemoteAudioStats",(n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new K4(this.store),this.bindStatsUploaderEvents(),this.mutex=new ro("P2PChannel-mutex",this.store.clientId),this.isPlanB=!ai().supportUnifiedPlan||re("CHROME_FORCE_PLAN_B")&&_h(),this.shouldForwardP2PCreation=re("FORWARD_P2P_CREATION")&&ai().supportPCSetConfiguration&&Xp(),this.shouldForwardP2PCreation&&(this.connection=ZC(this.store),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=ut.New,this._forceTurn=ti(e),F.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const i=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||i||t)&&((i||t)&&this.connection&&(F.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=ZC(this.store,e),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Ge(H.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=re("NEW_ICE_RESTART")?T_.FIRST_CONNECTION:T_.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new Ge(H.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===ut.Connected){if(this.connection instanceof Os&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return F.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),fe.reportApiInvoke(this.store.sessionId,{name:Cn.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:Tr.TRACER}).onSuccess(),void setTimeout((()=>{this.emit(kt.RequestReconnect)}));await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ut.Connected}updateRemoteRTPCapabilities(e){const t=Array.from(this.localTrackMap.entries()).filter((s=>{var o;let[c]=s;return Re(o=[He.LocalVideoLowTrack,He.LocalVideoTrack]).call(o,c)})),n=t.map((s=>{let[,{id:o}]=s;return o})),i=t.map((s=>{let[o]=s;return o}));if(this.connection instanceof Os){if(fe.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(i),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Re(e).call(e,this.store.codec)){const s=["vp9","vp8","h264"].find((o=>Re(e).call(e,o)));s&&(this.store.codec=s,F.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(s,".")))}this.connection.updateRemoteRTPCapabilities(n,e)}}async getEstablishParams(){var e;if(this.connection instanceof Os&&this.connection.peerConnectionState!=="closed"&&Re(e=[ut.New,ut.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==ut.Connected){if(this.state===ut.Disconnected)throw new Ge(H.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach((n=>{var i;Re(i=this.pendingLocalDataChannels).call(i,n)||this.pendingLocalDataChannels.push(n)})),[]}const t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach((n=>{const i=Date.now();this.store.publish(n.id.toString(),"datachannel",i)})),await this.connection.createDataChannels(this.store.uid,t),t.forEach((n=>{this.localDataChannels.push(n);const i=Date.now();this.store.publish(n.id+"","datachannel",void 0,i)})),e.map((n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId}))))}publish(e,t,n){var i=this;return jc((function*(){const s=yield Jn(i.mutex.lock("From P2PChannel.publish"));try{var o;const c=i.connection&&Re(o=["disconnected","failed"]).call(o,i.connection.peerConnectionState);if(!i.connection||i.state!==ut.Connected||c){if(i.state===ut.Disconnected)throw new Ge(H.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(e);const u=e.filter((p=>i.pendingLocalTracks.indexOf(p)===-1));return i.pendingLocalTracks=i.pendingLocalTracks.concat(u),void(c&&(i._isWaitPcToRePub=!0))}i.store.pubId=i.store.pubId+1,ma.markPublishStart(i.store.clientId,i.store.pubId);const d=i.filterTobePublishedTracks(e,t,n);if(d.length===0)return void(yield Jn(i.tryToUnmuteAudio(e)));yield*lC(d0(i.doPublish(i.connection,d)))}finally{s()}}))()}doPublish(e,t){var n=this;return jc((function*(){t.forEach((T=>{let{track:R,type:I}=T;const A=Date.now();n.store.publish(R.getTrackId(),I===He.LocalAudioTrack?"audio":"video",A)})),n.bindLocalTrackEvents(t);const i=t.map((T=>{let{track:R}=T;return R})),s=yield Jn(e.send(i,n.store.codec,n.store.audioCodec)),o=(yield Jn(s.next())).value,c=n.createGatewayPublishMessage(t,o);let d;try{d=yield c}catch(T){throw s.throw(T),T?.code===H.WS_ABORT&&t.forEach((R=>{let{track:I}=R;n.pendingLocalTracks.indexOf(I)===-1&&n.pendingLocalTracks.push(I)})),n.unbindLocalTrackEvents(t),T}const u=n.mapPubResToRemoteConfig(c,d,i),p=(yield Jn(s.next(u))).value;if(n.state===ut.Disconnected)throw new Ge(H.UNEXPECTED_ERROR,"PeerConnection already disconnected.");re("ENABLE_VIDEO_SEI");const m=re("ENABLE_ENCODED_TRANSFORM"),g=re("ENABLE_AUDIO_METADATA");i.forEach((async T=>{const R=T.getRTCRtpTransceiver();if(!R||!m)return;const{interceptLocalVideoFrame:I,interceptLocalAudioFrame:A}=s0();T.trackMediaType===dt.VIDEO?await I(R.sender,T):T.trackMediaType===dt.AUDIO&&await A(R.sender,{metadata:g?()=>{const w=T.metadata.shift();return w&&w.value}:void 0})})),t.forEach((T=>{let{type:R}=T;n.statsCollector.addLocalStats(R)})),n.assignLocalTracks(t,p),n.statsUploader.startUploadOutboundStats(),t.forEach((T=>{let{track:R,type:I}=T;const A=Date.now();n.store.publish(R.getTrackId(),I===He.LocalAudioTrack?"audio":"video",void 0,A)}))}))()}async updateVideoStreamParameter(e,t){const n=this.localTrackMap.get(t);if(!n||!this.connection)return;if(!(n.track instanceof zi))return F.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:i}=n,s=(function(o,c){const d={};return o.height&&o.width&&(d.scaleResolutionDownBy=v_(o,c)),d.maxFramerate=o.framerate?Sl(o.framerate):void 0,d.maxBitrate=o.bitrate?1e3*o.bitrate:void 0,d})(e,i);if(i._encoderConfig||(i._encoderConfig={}),t!==He.LocalVideoLowTrack||!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&ai().supportDualStreamEncoding)s.scaleResolutionDownBy!=null&&(i._encoderConfig.scaleResolutionDownBy=s.scaleResolutionDownBy);else{const o=i._originMediaStreamTrack;if(!o.canvas)return F.warn("[".concat(i.getTrackId(),"] no canvas on track"));(function(c,d){const u=c.canvas;d.width&&(u.width=Sl(d.width)),d.height&&(u.height=Sl(d.height)),d.framerate&&(u.stopCapture&&u.stopCapture(),u.stopCapture=jD((()=>{!u.startCapture&&u.stopCapture&&u.stopCapture(),u.startCapture&&u.startCapture()}),Sl(d.framerate)))})(o,e)}s.maxBitrate!=null&&(i._encoderConfig.bitrateMax=s.maxBitrate/1e3),s.maxFramerate!=null&&(i._encoderConfig.frameRate&&typeof i._encoderConfig.frameRate=="object"?i._encoderConfig.frameRate.max=s.maxFramerate:i._encoderConfig.frameRate={max:s.maxFramerate}),F.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(e){var t=this;return jc((function*(){if(!t.connection||t.state!==ut.Connected)return;const n=yield Jn(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const s=t.localTrackMap.get(He.LocalVideoTrack);if(!s)throw new Ge(H.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(He.LocalVideoLowTrack))throw new Ge(H.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const o=[{track:t.getLowVideoTrack(s.track,e),type:He.LocalVideoLowTrack}];if(yield*lC(d0(t.doPublish(t.connection,o))),s.track.muted||!s.track.enabled){var i;const c=(i=t.localTrackMap.get(He.LocalVideoLowTrack))===null||i===void 0?void 0:i.id;c!==void 0&&(yield Jn(t.connection.muteLocal([c])))}}finally{n()}}))()}async republish(){this.pendingLocalTracks.length>0&&(F.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await On(this,kt.RequestRePublish,this.pendingLocalTracks),this.emit(kt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(F.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await On(this,kt.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:i}=this.pendingRemoteTracks[t];(i!==dt.AUDIO||n._audio_added_&&n._audioSSRC)&&(i!==dt.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await On(this,kt.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===dt.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach((t=>{let{user:n}=t;this.emit(kt.MediaReconnectEnd,n.uid)})),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==ut.Connected)return void e.forEach((i=>{const s=this.pendingLocalTracks.indexOf(i);s!==-1&&this.pendingLocalTracks.splice(s,1)}));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find((i=>i[0]==="videoLowTrack"));return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==ut.Connected)return void e.forEach((n=>{const i=this.pendingLocalDataChannels.indexOf(n);i!==-1&&this.pendingLocalDataChannels.splice(i,1)}));const t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach((n=>{const i=this.localDataChannels.indexOf(n);i!==-1&&this.localDataChannels.splice(i,1)})),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map((n=>n.id))):void 0}async unpublishLowStream(){if(!this.connection||this.state!==ut.Connected)return;const e=this.localTrackMap.get(He.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[He.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map((i=>{let[,{id:s}]=i;return s}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((i=>{let[s,{track:o}]=i;return{type:s,track:o}}))),t.forEach((i=>{let[s]=i;this.statsCollector.removeLocalStats(s)})),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(e,t){if(!this.connection||this.state!==ut.Connected)throw new Ge(H.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=t.filter((i=>{var s;return!((s=this.remoteDataChannelMap.get(e))!==null&&s!==void 0&&s.get(i.id))}));if(n.length!==0)return await this.connection.createDataChannels(e.uid,n),n.forEach((i=>{var s;this.remoteDataChannelMap.has(e)?(s=this.remoteDataChannelMap.get(e))===null||s===void 0||s.set(i.id,i):this.remoteDataChannelMap.set(e,new Map([[i.id,i]]));const o=this.pendingRemoteDataChannels.findIndex((c=>{let{user:d,id:u}=c;return d.uid===e.uid&&u===i.id}));o!==-1&&this.pendingRemoteDataChannels.splice(o,1)})),n.map((i=>i.id))}async subscribe(e,t,n,i,s){var o;if(!this.connection||this.state!==ut.Connected)throw new Ge(H.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((o=this.remoteUserMap.get(e))!==null&&o!==void 0&&o.has(t))return;let c,d,u,p;const m=this.connection.getPreMedia(n);if(m)F.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),u=m.transceiver,c=m.track,d=m.mid,p=m.player,m.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:m.firstVideoRender});else if(s){const R=s.find((A=>{let{stream_type:w}=A;return w===t}));if(!R)throw new Ge(H.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const I=await this.connection.receive(t,R.ssrcs,String(e._uintid),R.attributes);this.connection instanceof Os&&(u=I.transceiver),c=I.track,d=I.id}else{const R=await this.connection.receive(t,[{ssrcId:n,rtx:i}],String(e._uintid),void 0);this.connection instanceof Os&&(u=R.transceiver),c=R.track,d=R.id}if(t===dt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(c):(e._audioTrack=new $l(c,e.uid,e._uintid,this.store),F.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),u&&e._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(c):(e._videoTrack=new tf(c,e.uid,e._uintid,this.store,p),F.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(vc.PLAY_START,(()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})})),e._videoTrack.once(vc.PLAY_END,(()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)})),p?e._videoTrack.once(vc.FIRST_FRAME_RENDER,(()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})):e._videoTrack.once(vc.FIRST_FRAME_DECODED,(()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}))),u&&e._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._videoTrack)),u&&re("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:R,interceptRemoteAudioFrame:I}=s0();t==dt.VIDEO?await R(u.receiver,{onSei:re("ENABLE_VIDEO_SEI")&&(A=>{var w;return(w=e._videoTrack)===null||w===void 0?void 0:w._onSei(A)})}):t==dt.AUDIO&&await I(u.receiver,{enableTopn:!!re("ENABLE_AUDIO_TOPN"),enableMetadata:!!re("ENABLE_AUDIO_METADATA"),enablePts:!!re("ENABLE_AUDIO_PTS"),onMetadata:A=>{this.safeEmit(kt.AudioMetadata,A)},onPts:A=>{this.safeEmit(kt.AudioPts,A)}})}const g=this.remoteUserMap.get(e);g?g.set(t,d):this.remoteUserMap.set(e,new Map([[t,d]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const T=this.pendingRemoteTracks.findIndex((R=>{let{user:I,kind:A}=R;return I.uid===e.uid&&t===A}));T!==-1&&(this.pendingRemoteTracks.splice(T,1),this.emit(kt.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==ut.Connected)throw new Ge(H.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter((s=>{var o;let{user:c,mediaType:d}=s;return!((o=this.remoteUserMap.get(c))!==null&&o!==void 0&&o.has(d))}));const t=[],n=new Map;e.forEach((s=>{if(!this.connection)return;const o=this.connection.getPreMedia(s.ssrcId);if(o){const{track:c,mid:d,transceiver:u,player:p}=o;n.set(s.ssrcId,{track:c,id:d,transceiver:u,player:p})}else t.push(s)}));const i=await this.connection.batchReceive(t.map((s=>{let{user:o,mediaType:c,ssrcId:d,rtxSsrcId:u}=s;return{kind:c,ssrcMsg:[{ssrcId:d,rtx:u}],mslabel:String(o._uintid)}})));t.forEach(((s,o)=>{n.set(s.ssrcId,i[o])}));for(const{user:s,mediaType:o,ssrcId:c}of e){const d=n.get(c);if(!d)return void F.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(s.uid," subscribe data,").concat(o,", ").concat(c));const{track:u,id:p,transceiver:m,player:g}=d;if(m&&re("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:I,interceptRemoteAudioFrame:A}=s0();o==dt.VIDEO?await I(m.receiver,{onSei:re("ENABLE_VIDEO_SEI")&&(w=>{var k;return(k=s._videoTrack)===null||k===void 0?void 0:k._onSei(w)})}):o==dt.AUDIO&&await A(m.receiver,{enableTopn:!!re("ENABLE_AUDIO_TOPN"),enableMetadata:!!re("ENABLE_AUDIO_METADATA"),enablePts:!!re("ENABLE_AUDIO_PTS"),onMetadata:w=>{this.safeEmit(kt.AudioMetadata,w)},onPts:w=>{this.safeEmit(kt.AudioPts,w)}})}if(o===dt.AUDIO?(s._audioTrack?s._audioTrack._updateOriginMediaStreamTrack(u):(s._audioTrack=new $l(u,s.uid,s._uintid,this.store),F.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(s._audioTrack.getTrackId()))),m&&s._audioTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(s,s._audioTrack)):(s._videoTrack?s._videoTrack._updateOriginMediaStreamTrack(u):(s._videoTrack=new tf(u,s.uid,s._uintid,this.store,g),F.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(s._videoTrack.getTrackId()))),m&&s._videoTrack._updateRtpTransceiver(m),this.bindRemoteTrackEvents(s,s._videoTrack)),re("ENABLE_VIDEO_SEI")&&m){const{interceptRemoteVideoFrame:I,interceptRemoteAudioFrame:A}=s0();o==dt.VIDEO?await I(m.receiver,{onSei:w=>{var k;(k=s._videoTrack)===null||k===void 0||k._onSei(w)}}):o==dt.AUDIO&&await A(m.receiver)}const T=this.remoteUserMap.get(s);T?T.set(o,p):this.remoteUserMap.set(s,new Map([[o,p]])),this.statsCollector.addRemoteStats(s.uid),this.statsUploader.startUploadInboundStats();const R=this.pendingRemoteTracks.findIndex((I=>{let{user:A,kind:w}=I;return A.uid===s.uid&&o===w}));R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(kt.MediaReconnectEnd,s.uid))}}async unsubscribe(e,t,n){const i=this.pendingRemoteTracks.filter((c=>{let{user:d,kind:u}=c;return t!==void 0?d.uid===e.uid&&t===u:d.uid===e.uid}));if(i.forEach((c=>{const d=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(d,1)})),this.connection&&this.state===ut.Connected||n||i.forEach((c=>{let{kind:d}=c;var u;if(d===dt.AUDIO)(u=e._audioTrack)===null||u===void 0||u._destroy(),e._audioTrack=void 0;else if(d===dt.VIDEO){var p;(p=e._videoTrack)===null||p===void 0||p._destroy(),e._videoTrack=void 0}})),!this.connection||this.state!==ut.Connected)return;const s=this.filterTobeUnSubscribedTracks(e,t);if(s.length===0)return;await this.connection.stopReceiving(s.map((c=>{let[,{id:d}]=c;return d})));const o=this.createUnsubscribeMessage(s);return this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),s.forEach((c=>{let[d,{kind:u}]=c;var p,m;if(u===dt.VIDEO&&d._videoSSRC&&((p=this.connection)===null||p===void 0||p.setStatsRemoteVideoIsReady(d._videoSSRC,!1)),u===dt.VIDEO)this.unbindRemoteTrackEvents(d._videoTrack),n||((m=d._videoTrack)===null||m===void 0||m._destroy(),d._videoTrack=void 0);else if(u===dt.AUDIO){var g;this.unbindRemoteTrackEvents(d._audioTrack),!n&&((g=d._audioTrack)===null||g===void 0||g._destroy(),d._audioTrack=void 0)}})),o}async unsubscribeDataChannel(e,t){if(t.forEach((s=>{const o=this.pendingRemoteDataChannels.findIndex((c=>c.id===s.id));o!==-1&&this.pendingRemoteDataChannels.splice(o,1)})),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(e,t);if(n.length===0)return;t.forEach((s=>{s._close()}));const i=this.remoteDataChannelMap.get(e);return n.forEach((s=>{i&&i.delete(s.id)})),i&&i.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),n.map((s=>s.id))}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:s,mediaType:o}of e){const c=this.pendingRemoteTracks.filter((d=>{let{user:u,kind:p}=d;return o!==void 0?u.uid===s.uid&&o===p:u.uid===s.uid}));c.forEach((d=>{const u=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(u,1)})),t=t.concat(c)}if(!this.connection||this.state!==ut.Connected)return void t.forEach((s=>{let{user:o,kind:c}=s;var d;if(c===dt.AUDIO)(d=o._audioTrack)===null||d===void 0||d._destroy(),o._audioTrack=void 0;else if(c===dt.VIDEO){var u;(u=o._videoTrack)===null||u===void 0||u._destroy(),o._videoTrack=void 0}}));const n=Ks(e).call(e,((s,o)=>{let{user:c,mediaType:d}=o;const u=this.filterTobeUnSubscribedTracks(c,d);return s.concat(u)}),[]);if(n.length===0)return;await this.connection.stopReceiving(n.map((s=>{let[,{id:o}]=s;return o})));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach((s=>{let[o,{kind:c}]=s;var d,u;if(c===dt.VIDEO&&o._videoSSRC&&((d=this.connection)===null||d===void 0||d.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),c===dt.VIDEO)this.unbindRemoteTrackEvents(o._videoTrack),(u=o._videoTrack)===null||u===void 0||u._destroy(),o._videoTrack=void 0;else if(c===dt.AUDIO){var p;this.unbindRemoteTrackEvents(o._audioTrack),(p=o._audioTrack)===null||p===void 0||p._destroy(),o._audioTrack=void 0}})),i}isPreSubScribe(e){return!this.connection||this.state!==ut.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void F.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void F.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const i=t===dt.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void F.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||F.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){const t=this.localTrackMap.get(He.LocalAudioTrack),n=t&&t.track;n&&n.metadata.push(e)}getAllTracks(e){const t=this.localTrackMap.get(He.LocalAudioTrack);if(t?.track instanceof Js){const n=t.track;return Array.from(this.localTrackMap.entries()).filter((i=>{let[s]=i;return s!==He.LocalAudioTrack})).filter((i=>{let[s]=i;return!(e&&s===He.LocalVideoLowTrack)})).map((i=>{let[,{track:s}]=i;return s})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((n=>{let[i]=n;return!(e&&i===He.LocalVideoLowTrack)})).map((n=>{let[,{track:i}]=n;return i}))}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,n,i,s){if(e){const c=this.localTrackMap.get(He.LocalAudioTrack),d=i?this.localTrackMap.get(He.LocalVideoLowTrack):this.localTrackMap.get(He.LocalVideoTrack);fe.publish(this.store.sessionId,{eventElapse:ma.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c?.track.getTrackLabel(),videoName:d?.track.getTrackLabel(),screenshare:d?.track._hints.indexOf(Ni.SCREEN_TRACK)!==-1,audio:!!c,video:!!d,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}else{var o;n||(n=[]);const c=n.find((u=>u instanceof Rr)),d=i?(o=this.localTrackMap.get(He.LocalVideoTrack))===null||o===void 0?void 0:o.track:n.find((u=>u instanceof zi));fe.publish(this.store.sessionId,{eventElapse:ma.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c?.getTrackLabel(),videoName:d?.getTrackLabel(),screenshare:d?._hints.indexOf(Ni.SCREEN_TRACK)!==-1,audio:!!c,video:!!d,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}}reportSubscribeEvent(e,t,n,i){const s=i===dt.VIDEO?n._videoSSRC:n._audioSSRC;s&&fe.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===dt.VIDEO,audio:i===dt.AUDIO,peerid:n.uid,subscribeRequestid:s,p2pid:this.store.p2pId,eventElapse:ma.measureFromSubscribeStart(this.store.clientId,s),preSsrc:this.isPreSubScribe(s)})}reset(){F.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new ro("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=ZC(this.store),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(He.LocalAudioTrack);if(e?.track instanceof Js){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((n=>{t.removeAudioTrack(n)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=ut.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(He.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(He.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof zi||t&&t.track instanceof Rr?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(Ii(t=this.remoteUserMap).call(t)).find((i=>i.uid===e));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get(He.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Zt(e).call(e,((n,i)=>n.level-i.level)),e}async disconnectForReconnect(){this.connection&&(F.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=ut.Reconnecting,re("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=ZC(this.store),this.emit(kt.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[n,{track:i}]=e;switch(n){case He.LocalVideoTrack:Re(t=i._hints).call(t,Ni.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case He.LocalAudioTrack:i instanceof Js?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case He.LocalVideoLowTrack:}})),this.emit(kt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;Array.from(Ii(n).call(n)).forEach((i=>{this.setPendingRemoteMedia(t,i)})),this.emit(kt.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach((e=>{this.pendingLocalDataChannels.push(e)})),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach((e=>{let[t,n]=e;Array.from(Ii(n).call(n)).forEach((i=>{this.setPendingRemoteDataChannel(t,i)}))})),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),F.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(const n of this.pendingRemoteDataChannels){const{user:i,id:s}=n;if((e instanceof Jm?e.uid:e)===i.uid&&s===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:s}=n;if((e instanceof Jm?e.uid:e)===i.uid&&t===s)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return jc((function*(){if(!t.connection||t.state!==ut.Connected)return;const n=yield Jn(t.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield Jn(t.connection.restartICE(e));const o=yield Jn(i.next());if(o.done)return;const c=o.value,d=yield c;switch(RP(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case As.UDP_TCP_RELAY:t._pcStatsUploadType=T_.UDP_TCP_RESTART;break;case As.TCP_RELAY:t._pcStatsUploadType=T_.TCP_RESTART;break;case As.RELAY:t._pcStatsUploadType=T_.RELAY_RESTART;break;default:t._pcStatsUploadType=T_.OLD_RESTART}t._isTryConnecting=!0,i.next(d)}catch(o){var s;(s=i)===null||s===void 0||s.throw(o)}finally{n()}}))()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(He.LocalVideoTrack),n=this.localTrackMap.get(He.LocalAudioTrack),i=e.videoSend.find((R=>R.ssrc===t?.ssrcs[0].ssrcId)),s=e.audioSend.find((R=>R.ssrc===n?.ssrcs[0].ssrcId));if(!i||!s)return 1;const o=Sc(this,kt.NeedSignalRTT),c=i?i.rttMs:void 0,d=s?s.rttMs:void 0,u=c&&d?(c+d)/2:c||d,p=(u&&o?(u+o)/2:u||o)||0,m=100*e.sendPacketLossRate*.7/50+.3*p/1500,g=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,T=t?.track;if(T&&T._encoderConfig&&T._hints.indexOf(Ni.SCREEN_TRACK)===-1){const R=T._encoderConfig.bitrateMax,I=e.bitrate.actualEncoded;if(R&&I){const A=(1e3*R-I)/(1e3*R);return Yg[A<.15?0:A<.3?1:A<.45?2:A<.6?3:4][g]}}return g}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[i]=n;const s=i._audioSSRC,o=i._videoSSRC,c=e.audioRecv.find((I=>I.ssrc===s)),d=e.videoRecv.find((I=>I.ssrc===o));if(!c&&!d)return void(t+=1);const u=Sc(this,kt.NeedSignalRTT),p=e.rtt,m=(p&&u?(p+u)/2:p||u)||0,g=c?c.jitterMs:void 0,T=e.recvPacketLossRate;let R=.7*T*100/50+.3*m/1500;g&&(R=.6*T*100/50+.2*m/1500+.2*g/400),t+=R<.1?1:R<.17?2:R<.36?3:R<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new De(((t,n)=>{this.handleMuteLocalTrack(e,t,n)}))}async replaceTrack(e,t){var n;if(F.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==ut.Connected)return;const i=Array.from(this.localTrackMap.entries()).find((o=>{let[,{track:c}]=o;return e===c}));if(!i)return;const s=i[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:s}]),this.bindLocalTrackEvents([{track:t,type:s}]),i[1].track=t),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(t,i[1].id)),this.isPlanB){const o=i[1];o.id=t._mediaStreamTrack.id,this.localTrackMap.set(s,o)}if(s===He.LocalVideoTrack&&!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&ai().supportDualStreamEncoding){const o=this.localTrackMap.get(He.LocalVideoLowTrack);if(o){const c=e._mediaStreamTrack.clone();o.track._originMediaStreamTrack.stop(),o.track._mediaStreamTrack=c,o.track._originMediaStreamTrack=c,await new De(((d,u)=>{this.handleReplaceTrack(o.track,d,u,!0)}))}}}filterTobePublishedTracks(e,t,n){const i=[],s=this.getAllTracks();e=km(e=e.filter((u=>s.indexOf(u)===-1)));let o,c=!1;const d=this.localTrackMap.get(He.LocalAudioTrack);for(const u of e){if(u instanceof zi&&(this.localTrackMap.has(He.LocalVideoTrack)||c?new Ge(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:u,type:He.LocalVideoTrack}),c=!0),t)){const p=this.getLowVideoTrack(u,n);i.push({track:p,type:He.LocalVideoLowTrack})}if(u instanceof Rr)if(d){const p=d.track;if(p instanceof Js)c0([u]),p.addAudioTrack(u),this.bindLocalAudioTrackEvents(u,!0);else{const m=wF([p,u]);F.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(m.getTrackId(),"]")),this.replaceTrack(p,m)}}else o instanceof Js?(c0([u]),o.addAudioTrack(u)):o||!u._useAudioElement&&ai().webAudioMediaStreamDest&&!u._bypassWebAudio?o=wF(o?[u,o]:[u]):o=u}return o&&(F.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(o.getTrackId(),"]")),i.push({track:o,type:He.LocalAudioTrack})),i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=km(e=e.filter((i=>n.indexOf(i)!==-1)));for(const i of e){if(i instanceof Rr){const s=this.localTrackMap.get(He.LocalAudioTrack);if(!s)continue;s.track instanceof Js?(s.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),s.track.trackList.length===0&&(t.push([He.LocalAudioTrack,s]),s.track.close())):t.push([He.LocalAudioTrack,s])}if(i instanceof zi){const s=this.localTrackMap.get(He.LocalVideoTrack);if(!s)continue;t.push([He.LocalVideoTrack,s]);const o=this.localTrackMap.get(He.LocalVideoLowTrack);o&&t.push([He.LocalVideoLowTrack,o])}}return t}filterTobePublishedDataChannels(e){return e=(e=km(e)).filter((t=>this.localDataChannels.findIndex((n=>n.id===t.id))===-1))}filterTobeUnpublishedDataChannels(e){return e=(e=(e=km(e)).filter((t=>this.localDataChannels.indexOf(t)!==-1))).filter((t=>t._originDataChannel))}bindLocalTrackEvents(e){e.forEach((t=>{let{track:n,type:i}=t;switch(i){case He.LocalVideoTrack:n.addListener(rt.GET_STATS,this.handleGetLocalVideoStats),n.addListener(rt.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(rt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(rt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(rt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case He.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case He.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof Js?e.trackList.forEach((n=>{n.addListener(rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(rt.GET_STATS,this.handleGetLocalAudioStats),n.addListener(rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(rt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(rt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(rt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((t=>{let[n,{track:i}]=t;return{track:i,type:n}}))),e.forEach((t=>{let{track:n,type:i}=t;switch(i){case He.LocalVideoTrack:n.off(rt.GET_STATS,this.handleGetLocalVideoStats),n.off(rt.GET_RTC_STATS,this.handleGetRTCStats),n.off(rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(rt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(rt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(rt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case He.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case He.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof Js?e.trackList.forEach((t=>{t.off(rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(rt.GET_STATS,this.handleGetLocalAudioStats),t.off(rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(rt.GET_STATS,this.handleGetLocalAudioStats),e.off(rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(rt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(rt.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof tf&&t.addListener(rt.GET_STATS,(n=>{n(this.handleGetRemoteVideoStats(e))})),t instanceof $l&&t.addListener(rt.GET_STATS,(n=>{n(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(rt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;n.has(dt.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(dt.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((n,i)=>{var s;let o,c,{track:d,type:u}=n;switch(u){case He.LocalAudioTrack:o=gn.Audio,c={dtx:d instanceof Uw&&d._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case He.LocalVideoTrack:o=Re(s=d._hints).call(s,Ni.SCREEN_TRACK)?gn.Screen:gn.High,c=uf(uf({},eF(d)),{},{codec:this.store.codec,svc_mode:Qw()});break;case He.LocalVideoLowTrack:o=gn.Low,c=uf(uf({},eF(d)),{},{codec:this.store.codec,svc_mode:Qw()})}return{stream_type:o,attributes:c,ssrcs:t[i]}}))}createGatewayUnpublishMessage(e){return e.map((t=>{var n;let i,[s,{track:o,ssrcs:c,id:d}]=t;switch(s){case He.LocalVideoTrack:i=Re(n=o._hints).call(n,Ni.SCREEN_TRACK)?gn.Screen:gn.High;break;case He.LocalAudioTrack:i=gn.Audio;break;case He.LocalVideoLowTrack:i=gn.Low}return{stream_type:i,ssrcs:c,mid:d}}))}assignLocalTracks(e,t){e.forEach(((n,i)=>{let{track:s,type:o}=n;this.localTrackMap.set(o,{track:s,id:t[i].id,ssrcs:t[i].localSSRC})}))}withdrawLocalTracks(e){e.forEach((t=>{let[n]=t;this.localTrackMap.delete(n)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(kt.PeerConnectionStateChange,t),t==="connecting"&&e instanceof Os&&!fi()&&re("FIRST_TCP_CANDIDATE")&&window.setTimeout((()=>{t==="connecting"&&e.extendCandidate()}),re("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof Os&&DF(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=T_.DISCONNECTED_OR_FAILED,Sc(this,kt.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const n=this.pendingLocalTracks.map((s=>s.getTrackId())),i=this.pendingLocalDataChannels.map((s=>"dc_".concat(s.id)));fe.reportApiInvoke(this.store.sessionId,{name:Cn.REPUB_AFTER_PC_CONNECTED,options:n.concat(i),tag:Tr.TRACER}).onSuccess(),this.republish()}if(re("NEW_ICE_RESTART")&&e instanceof Os&&!fi()&&!this._forceTurn){if(Re($e).call($e,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=s=>{RP(e)&&(F.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(s)),Sc(this,kt.QueryClientConnectionState)==="CONNECTED"&&this.emit(kt.RequestRestartICE,s))},i=()=>{RP(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),F.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout((()=>this.emit(kt.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout((()=>{Mn(e,n,i)}),800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout((()=>{e.iceConnectionState==="disconnected"&&re("ICE_RESTART")&&Sc(this,kt.QueryClientConnectionState)==="CONNECTED"&&this.emit(kt.RequestRestartICE)}),800),void setTimeout((()=>{e.peerConnectionState==="disconnected"&&(F.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout((()=>this.emit(kt.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())}),4e3);t==="failed"&&(F.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout((()=>this.emit(kt.P2PLost)),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),fe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Tr.TRACER}).onSuccess(),this.emit(kt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const i=Array.from(Ii(n=this.remoteUserMap).call(n)).find((o=>o._audioSSRC===t));var s;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(s=i.audioTrack)===null||s===void 0||s.emit(vc.FIRST_FRAME_DECODED),fe.firstRemoteFrame(this.store.sessionId,Nn.FIRST_AUDIO_DECODE,yr.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:ma.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const i=Array.from(Ii(n=this.remoteUserMap).call(n)).find((s=>s._audioSSRC===t));i&&fe.firstRemoteFrame(this.store.sessionId,Nn.FIRST_AUDIO_RECEIVED,yr.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:ma.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,i)=>{var s;const o=Array.from(Ii(s=this.remoteUserMap).call(s)).find((c=>c._videoSSRC===t));o&&this.store.firstVideoFrameDecoded(o.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(t,n,i)},e.onFirstVideoRender=t=>{var n;const i=Array.from(Ii(n=this.remoteUserMap).call(n)).find((s=>s._videoSSRC===t));i&&(this.store.firstVideoFrameDecoded(i.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(i))},e.onFirstVideoReceived=t=>{var n;const i=Array.from(Ii(n=this.remoteUserMap).call(n)).find((s=>s._videoSSRC===t));i&&(this.store.firstVideoFrameDecoded(i.uid,{firstReceived:Date.now()}),fe.firstRemoteFrame(this.store.sessionId,Nn.FIRST_VIDEO_RECEIVED,yr.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:ma.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(t,n)=>{const i=t.candidateType==="relay",s=n.candidateType==="relay";n.candidateType!=="unknown"&&i===s||this.emit(kt.ConnectionTypeChange,i),F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(xd(n))," -> ").concat(JSON.stringify(xd(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(xd(n))," -> ").concat(JSON.stringify(xd(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const t=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return uf(uf({},t),n)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof Os&&(function(t){Iu.delete(t.id),DF(t)})(e),e.close(),this.emit(kt.PeerConnectionStateChange,"closed"),(function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0})(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(He.LocalAudioTrack);if(e instanceof Rr&&n?.track instanceof Js)return n.track.isActive||t.push([He.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find((s=>{let[,{track:o}]=s;return e===o}));if(i&&(t.push(i),i[0]===He.LocalVideoTrack)){const s=this.localTrackMap.get(He.LocalVideoLowTrack);s&&t.push([He.LocalVideoLowTrack,s])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(He.LocalAudioTrack);if(e instanceof Rr&&n?.track instanceof Js)return n.track.isActive&&t.push([He.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find((s=>{let[,{track:o}]=s;return e===o}));if(i)if(i[0]===He.LocalVideoTrack){t.push(i);const s=this.localTrackMap.get(He.LocalVideoLowTrack);s&&t.push([He.LocalVideoLowTrack,s])}else t.push(i);return t}createMuteMessage(e){return e.map((t=>{var n;let i,[s,{track:o,ssrcs:c,id:d}]=t;switch(s){case He.LocalAudioTrack:i=gn.Audio;break;case He.LocalVideoTrack:i=Re(n=o._hints).call(n,Ni.SCREEN_TRACK)?gn.Screen:gn.High;break;case He.LocalVideoLowTrack:i=gn.Low}return{stream_type:i,ssrcs:c,mid:d}}))}createUnmuteMessage(e){return e.map((t=>{var n;let i,[s,{track:o,ssrcs:c,id:d}]=t;switch(s){case He.LocalAudioTrack:i=gn.Audio;break;case He.LocalVideoTrack:i=Re(n=o._hints).call(n,Ni.SCREEN_TRACK)?gn.Screen:gn.High;break;case He.LocalVideoLowTrack:i=gn.Low}return{stream_type:i,ssrcs:c,mid:d}}))}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const s=i.get(t);if(!s)return n;n.push([e,{kind:t,id:s}])}else Array.from(i.entries()).forEach((s=>{let[o,c]=s;n.push([e,{kind:o,id:c}])}));return n}filterTobeUnSubscribedDataChannels(e,t){const n=[];return t.forEach((i=>{var s;(s=this.remoteDataChannelMap.get(e))!==null&&s!==void 0&&s.has(i.id)&&n.push(i)})),n}createUnsubscribeMessage(e){const t=[];return e.forEach((n=>{let[i,{kind:s,id:o}]=n;switch(s){case dt.VIDEO:return void(i._videoSSRC&&t.push({stream_type:dt.VIDEO,ssrcId:i._videoSSRC}));case dt.AUDIO:return void(i._audioSSRC&&t.push({stream_type:dt.AUDIO,ssrcId:i._audioSSRC}))}})),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach((n=>{let[i,{kind:s}]=n;if(t.has(i)){let o=t.get(i);s===dt.VIDEO?o|=dn.Video:o|=dn.Audio,t.set(i,o)}else s===dt.VIDEO?t.set(i,dn.Video):t.set(i,dn.Audio)})),{users:Array.from(t.entries()).map((n=>{let[i,s]=n;return{stream_id:i.uid,stream_type:s}}))}}withdrawRemoteTracks(e){e.forEach((t=>{let[n,{kind:i}]=t;const s=this.remoteUserMap.get(n);s&&(s.delete(i),Array.from(s.entries()).length===0&&this.remoteUserMap.delete(n))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get(He.LocalVideoTrack),n=this.localTrackMap.get(He.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new De(((i,s)=>{this.handleUpdateVideoEncoder(t.track,i,s,!0)}))),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new De(((i,s)=>{this.handleUpdateVideoEncoder(n.track,i,s,!0)})))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof Os&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof Os&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,t,n){return e.map(((i,s)=>{var o;let{stream_type:c}=i;const d=(o=t.find((u=>{let{stream_type:p}=u;return c===p})))===null||o===void 0?void 0:o.attributes;if(d&&re("DISABLE_SCREEN_SHARE_REMB")){const u=n[s]._hints;(Re(u).call(u,Ni.SCREEN_TRACK)||Re(u).call(u,Ni.SCREEN_LOW_TRACK))&&(d.remb=!1,F.debug("disable remb for screen share, hints:",u))}return d}))}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof Rr){var t;const i=this.filterTobeUnmutedTracks(e[n]);if(i.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(i.map((o=>{let[,{id:c}]=o;return c}))));const s=this.createUnmuteMessage(i);return void await ei(this,kt.RequestUnmuteLocal,s)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(kt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(kt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await In(Tu(this.dtlsFailedCount,Es)),this.emit(kt.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await On(this,kt.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(kt.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(He.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof zi))}throwIfTrackTypeNotMatch(e){if(e.filter((t=>t instanceof zi)).length>1)throw new Ge(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((t=>t instanceof Rr)).length>1&&(e.some((t=>t instanceof Rr&&t._bypassWebAudio))||!ai().webAudioMediaStreamDest))throw new Ge(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof zi&&this.pendingLocalTracks.some((n=>n instanceof zi)))throw new Ge(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Rr&&this.pendingLocalTracks.some((n=>n instanceof Rr))&&(!ai().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((n=>n instanceof Rr&&n._bypassWebAudio))))throw new Ge(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var n;const i=!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&ai().supportDualStreamEncoding,s=uf(uf({},{width:160,height:120,framerate:15,bitrate:50}),t);let o;o=i?e._mediaStreamTrack.clone():CP(e,s);const c=Oi(8,"track-low-"),d=new zi(o,uf(uf({},i&&{scaleResolutionDownBy:v_(s,e)}),{},{frameRate:s.framerate,bitrateMax:s.bitrate,bitrateMin:s.bitrate}),void 0,void 0,c);return d.on(Sh.TRANSCEIVER_UPDATED,(u=>{e._updateRtpTransceiver(u,bC.LOW_STREAM)})),d._hints.push(Ni.LOW_STREAM),Re(n=e._hints).call(n,Ni.SCREEN_TRACK)&&d._hints.push(Ni.SCREEN_LOW_TRACK),e.on("sei-to-send",(u=>{d.emit("sei-to-send",u)})),e.addListener(rt.NEED_CLOSE,(()=>{d.close()})),d}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof Os){var s,o,c,d;const u=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:p,dtlsTransportState:m,peerConnectionState:g}=this.connection,{local:T,remote:R}=await this.connection.getSelectedCandidatePair();fe.pcStats(this.store.sessionId,{startTime:u,eventElapse:e-u||0,iceconnectionsate:p,dtlsstate:m,connectionstate:g,intSucc:t?1:2,error:this._iceError||i||"",selectedLocalCandidateProtocol:(s=T?.protocol)!==null&&s!==void 0?s:"",selectedLocalCandidateType:(o=T.candidateType)!==null&&o!==void 0?o:"",selectedLocalCandidateAddress:"".concat(T.address,":").concat(T.port),selectedRemoteCandidateProtocol:(c=R.protocol)!==null&&c!==void 0?c:"",selectedRemoteCandidateType:(d=R.candidateType)!==null&&d!==void 0?d:"",selectedRemoteCandidateAddress:"".concat(R.address,":").concat(R.port),restartCnt:n,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const t=this.store.keyMetrics,n=t.firstVideoFrameDecoded.find((m=>m.userId===e.uid));if(!n)return;const{isInternalUpload:i,isExternalUpload:s}=n;if(i&&s)return;const{subscribeEnd:o,firstPreRender:c,peerPublishDuration:d,peerPubStatusMs:u}=n;let{firstRender:p=0}=n;if(o&&(p||c)&&d&&u){n.isInternalUpload=!0;const{playEnd:m}=n;m&&(n.isExternalUpload=!0);const{firstPreRender:g=0}=n;p=g||p;const T=e.videoTrack,R={peer:e._uintid,width:T?._videoWidth||0,height:T?._videoHeight||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:d,peerPubStatusMs:u,joinChannelStart:t.joinStart||0,preloadStart:t.preloadStart||0,preloadEnd:t.preloadEnd||0,apStart:t.requestAPStart||0,apEnd:t.requestAPEnd||0,suaEnd:t.requestSUAEnd||0,beforeConnect:t.beforeConnect||0,peerReceiver:t.peerReceiver||0,ice:t.iceConnectionEnd||0,pc:t.peerConnectionEnd||0,signalConnected:t.signalConnected||0,joinReq:t.joinReq||0,joinRes:t.joinRep||0,userJoinNotify:n.userJoinNotify||0,videoAddNotify:n.videoAddNotify||0,subscribeStart:n.subscribeStart||0,subscribeEnd:n.subscribeEnd||0,firstReceived:n.firstReceived||0,firstDecoded:n.firstDecoded||0,firstPreRender:g||0,firstRender:m?Math.max(p,m):Math.max(p,o),playStart:n.playStart||0,playEnd:n.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:Po(this.store)};fe.firstXLAPeerFirstVideoFrame(this.store.sessionId,R)}}reportVideoFirstFrameDecoded(e,t,n,i){var s;const o=Array.from(Ii(s=this.remoteUserMap).call(s)).find((c=>c._videoSSRC===e));if(o){i||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,d=c.subscribe.find((u=>u.userId===o.uid&&u.type==="video"));fe.firstRemoteVideoDecode(this.store.sessionId,Nn.FIRST_VIDEO_DECODE,yr.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:n,subscribeElapse:ma.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:d?.subscribeEnd||0,subscriberStart:d?.subscribeStart||0,videoAddNotify:d?.streamAdded||0,state:i?1:0,firstFrame:d?.firstFrame||0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(e);if(!i)return!1;const s=i.get(t);if(!s)return!1;const o=await this.connection.getRemoteSSRC(s);return o!==void 0&&o!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;t===He.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,bC.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}},At(Un.prototype,"startP2PConnection",[Ka],Object.getOwnPropertyDescriptor(Un.prototype,"startP2PConnection"),Un.prototype),At(Un.prototype,"connect",[Ka],Object.getOwnPropertyDescriptor(Un.prototype,"connect"),Un.prototype),At(Un.prototype,"updateRemoteRTPCapabilities",[Ka],Object.getOwnPropertyDescriptor(Un.prototype,"updateRemoteRTPCapabilities"),Un.prototype),At(Un.prototype,"publishDataChannel",[Ka],Object.getOwnPropertyDescriptor(Un.prototype,"publishDataChannel"),Un.prototype),At(Un.prototype,"unpublish",[Ka],Object.getOwnPropertyDescriptor(Un.prototype,"unpublish"),Un.prototype),At(Un.prototype,"unpublishDataChannel",[Ka],Object.getOwnPropertyDescriptor(Un.prototype,"unpublishDataChannel"),Un.prototype),At(Un.prototype,"unpublishLowStream",[Ka],Object.getOwnPropertyDescriptor(Un.prototype,"unpublishLowStream"),Un.prototype),At(Un.prototype,"subscribeDataChannel",[Ka],Object.getOwnPropertyDescriptor(Un.prototype,"subscribeDataChannel"),Un.prototype),At(Un.prototype,"subscribe",[Ka],Object.getOwnPropertyDescriptor(Un.prototype,"subscribe"),Un.prototype),At(Un.prototype,"massSubscribe",[Ka],Object.getOwnPropertyDescriptor(Un.prototype,"massSubscribe"),Un.prototype),At(Un.prototype,"unsubscribe",[Ka],Object.getOwnPropertyDescriptor(Un.prototype,"unsubscribe"),Un.prototype),At(Un.prototype,"unsubscribeDataChannel",[Ka],Object.getOwnPropertyDescriptor(Un.prototype,"unsubscribeDataChannel"),Un.prototype),At(Un.prototype,"massUnsubscribe",[Ka],Object.getOwnPropertyDescriptor(Un.prototype,"massUnsubscribe"),Un.prototype),At(Un.prototype,"muteRemote",[Ka],Object.getOwnPropertyDescriptor(Un.prototype,"muteRemote"),Un.prototype),At(Un.prototype,"unmuteRemote",[Ka],Object.getOwnPropertyDescriptor(Un.prototype,"unmuteRemote"),Un.prototype),At(Un.prototype,"hasRemoteMediaWithLock",[Ka],Object.getOwnPropertyDescriptor(Un.prototype,"hasRemoteMediaWithLock"),Un.prototype),At(Un.prototype,"disconnectForReconnect",[Ka],Object.getOwnPropertyDescriptor(Un.prototype,"disconnectForReconnect"),Un.prototype),At(Un.prototype,"updateBitrateLimit",[Ka],Object.getOwnPropertyDescriptor(Un.prototype,"updateBitrateLimit"),Un.prototype),At(Un.prototype,"remoteMediaSsrcChanged",[Ka],Object.getOwnPropertyDescriptor(Un.prototype,"remoteMediaSsrcChanged"),Un.prototype),Un);function Ka(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,o=await s.lock("From P2PChannel.".concat(t));try{for(var c=arguments.length,d=new Array(c),u=0;u<c;u++)d[u]=arguments[u];return await i.apply(this,d)}finally{o()}},n}function PF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function z4(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?PF(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):PF(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}const tY=Date.now(),kF=20,$C=new Map,u0=new Map;async function LF(e){const t=$C.get(e),n=Array.isArray(t)&&t[t.length-1],i=u0.get(e);if(!n)return void(i.isSyncing=!1);const s={uid:n.uid,payload:n.payload};i.firstRecvTs===0&&(i.firstRecvTs=n.recvTs,i.firstSendTs=n.sendTs);const o=n.sendTs-i.firstSendTs,c=o-(Date.now()-i.firstRecvTs);c>0&&(i.firstRecvTs=Date.now()-o);let d=n.mediaDelay+c;d<=0?(t.pop(),Y4(n.context,s),d=0):d=Math.min(d,kF),setTimeout((()=>t.length&&LF(e)),d)}function Y4(e,t){e.safeEmit($t.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function nY(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return Y4(n,{uid:e.uid,payload:e.payload});const i="".concat(n.id,"-").concat(e.uid),s=$C.get(i)||[],o=s.findIndex((p=>e.sendTs>=p.sendTs)),c=z4(z4({},e),{},{context:n,mediaDelay:t,recvTs:Date.now()});o===-1?s.push(c):s.splice(o,0,c),$C.set(i,s);let d=!1;var u;u0.has(i)?d=!((u=u0.get(i))===null||u===void 0||!u.isSyncing):u0.set(i,{isSyncing:d,firstRecvTs:0,firstSendTs:0}),d||LF(i)}const q4=$n().name;function MF(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function kv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?MF(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):MF(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}const eb="websdk_ng_cache_parameter",iY=re("MAX_PRELOAD_ASYNC_LENGTH"),Lv=1e4,Au=new Map,$m=[];let h0=null,p0=0,tb=0;const AP=new Map,UF=(function(e,t){const n=[];let i=0;const s=async()=>{const o=n.shift();o&&await o(),n.length>0&&i<t?s():i--};return async function(){for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return new De((async(u,p)=>{n.push((async()=>{try{const m=await e(...c);u(m)}catch(m){p(m)}})),i<t&&(i++,s())}))}})(xF,iY),wP=Gc.CancelToken.source();async function xF(e,t,n,i,s,o){try{if(!re("ENABLE_PRELOAD"))return;if(!ai().supportWebCrypto)return void Cd((()=>{F.warn("Your browser does not support preloading, this feature  be run in a secure environment")}),"preload_webcrypto_not_supported");if(!n&&n!==null)throw new Ge(H.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&ls(n,"token",1,2047),ls(e,"appid",1,2047),wv(t),i&&Ch(i);const c=__();F.debug("preload channel ".concat(t,", uid is ").concat(i));const d={appId:e,cname:t,token:n||e,uid:typeof i!="string"?i:null,sid:c,proxyServer:s};let u,p;typeof i=="string"?(d.stringUid=i,[p,u]=await De.all([Zz(i,{sid:c,appId:e},wP.token),vF(kv(kv({},d),{},{token:n||e,uid:0}),wP.token)]),d.uid=p.uid,u.gatewayInfo.uid=d.uid,u.gatewayInfo.res.uid=d.uid):(o&&(d.stringUid=o),u=await vF(d,wP.token));const m={sid:c,appId:e,cname:t,token:n||e,uid:d.stringUid||i,intUid:d.uid||u.gatewayInfo.uid,stringUid:d.stringUid,ts:Date.now(),sua:p,ap:u};await(async function(g){let T;try{g.uid&&OP({appId:g.appId,cname:g.cname,token:g.token,uid:g.uid,stringUid:g.stringUid});const R=X4(g),I=await(async function(w,k){try{const L=await window.crypto.subtle.importKey("raw",WU(k),"AES-GCM",!1,["encrypt"]),j=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},L,bd(window.btoa(JSON.stringify(w))));return Mm(new Uint8Array(j))}catch{return}})(g,g.token||g.appId);if(!I)return;T=f0(eb);const A=T?JSON.parse(T):[];A.push({[R]:I}),A.length>re("AP_CACHE_NUM")&&A.shift(),_0(eb,JSON.stringify(A))}catch(R){F.warn("Error caching server parameters:",R.message),_0(eb,"")}})(m),p0++}catch(c){throw tb++,(function(d){h0||(h0=window.setTimeout((()=>{let p="";AP.forEach(((m,g)=>{p+="".concat(g,": ").concat(m," ;")})),fe.reportApiInvoke(null,{name:Cn.PRELOAD,options:{success:p0,failed:tb,err:p}}).onError(d),p0=0,tb=0,AP.clear(),h0=null}),Lv));const u=AP.get(d.code)||0;AP.set(d.code,u+1)})(c),c}}async function VF(e){try{if(re("AP_REQUEST_DETAIL")||re("ENABLE_ROLE_SELECT_EDGE"))return;const t=OP(e);if(!t||e.cloudProxyServer!=="disabled")return;const n=await(async function(i,s){try{const o=await window.crypto.subtle.importKey("raw",WU(s),"AES-GCM",!1,["decrypt"]),c=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},o,bd(i));return JSON.parse(window.atob(Mm(new Uint8Array(c))))}catch{return}})(t,e.token||e.appId);if(!n||!(function(i,s){return i.cname===s.cname&&i.appId===s.appId&&i.token===s.token?s.stringUid?i.stringUid===s.stringUid:typeof s.uid=="number"?i.uid===s.uid:i.uid==s.uid:!1})(n,e))return;if(n&&Date.now()-n.ts<re("AP_CACHE_LIFETIME"))return n}catch(t){F.warn("Error get preloadInfo",t.message)}}function OP(e){let t;try{if(t=f0(eb),!t)return;const n=JSON.parse(t),i=X4(e),s=(function(c,d){for(let u=c.length-1;u>=0;u--)if(d(c[u]))return u;return-1})(n,(c=>i in c));if(s===-1)return;const o=n.splice(s,1)[0];return _0(eb,JSON.stringify(n)),o[i]}catch(n){F.warn("Error delete preload info: ".concat(t),n.message),_0(eb,"")}}function NP(e){if(e){let t=Au.get(e);t&&(window.clearTimeout(t),t=null,Au.delete(e)),Re($m).call($m,e)||e.cloudProxyServer!=="disabled"||$m.push(e)}if(Au.size<re("AP_CACHE_NUM")&&$m.length>0){const t=$m.shift();Au.set(t,window.setTimeout((async()=>{const{appId:n,cname:i,token:s,stringUid:o,uid:c,proxyServer:d}=t;try{await UF(n,i,s,c,d,o),Au.has(t)&&NP(t)}catch(u){F.warn("update preload failed",u.message),FF(t)}}),re("AP_UPDATE_INTERVAL")))}}function FF(e){const t=$m.indexOf(e);t!==-1&&$m.splice(t,1);let n=Au.get(e);n&&(window.clearTimeout(n),n=null,Au.delete(e),NP())}function BF(e,t){const n=e.sua,i=e.ap;t&&n&&fe.reqUserAccount(e.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:t,uid:e.intUid,errorCode:null,extend:n.req}),fe.reportResourceTiming(e.ap.url,e.sid),fe.joinWebProxyAP(e.sid,{lts:i.requestTime,elapse:i.elapse,sucess:1,apServerAddr:i.url,turnServerAddrList:i.proxyInfo.addresses.map((s=>s.ip)).join(","),eventType:"disabled",unilbsServerIds:[Ss.CHOOSE_SERVER,Ss.CLOUD_PROXY_FALLBACK].toString()}),fe.joinChooseServer(e.sid,{lts:i.requestTime,elapse:i.elapse,succ:!0,csAddr:i.url,opid:i.opid,serverList:i.gatewayInfo.gatewayAddrs.map((s=>s.address)),ec:null,cid:i.gatewayInfo.cid.toString(),uid:i.gatewayInfo.uid.toString(),csIp:i.gatewayInfo.csIp,unilbsServerIds:[Ss.CHOOSE_SERVER].toString(),isHttp3:i.isHttp3})}function f0(e){return window.atob(window.localStorage.getItem(e)||"")}function _0(e,t){window.localStorage.setItem(e,window.btoa(t))}function X4(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),i4(t)}function rY(e){let t=(function(){const n=jF.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}})();return(function(n,i){let s=n.appId;s!==void 0&&(Ns(i,10),lc(i,s));let o=n.cid;o!==void 0&&(Ns(i,16),Ns(i,o));let c=n.cname;c!==void 0&&(Ns(i,26),lc(i,c));let d=n.deviceId;d!==void 0&&(Ns(i,34),lc(i,d));let u=n.elapse;u!==void 0&&(Ns(i,40),tE(i,u));let p=n.fileSize;p!==void 0&&(Ns(i,48),tE(i,ib(p)));let m=n.height;m!==void 0&&(Ns(i,56),tE(i,ib(m)));let g=n.jpg;g!==void 0&&(Ns(i,66),Ns(i,g.length),HF(i,g));let T=n.networkType;T!==void 0&&(Ns(i,72),tE(i,ib(T)));let R=n.osType;R!==void 0&&(Ns(i,80),tE(i,ib(R)));let I=n.requestId;I!==void 0&&(Ns(i,90),lc(i,I));let A=n.sdkVersion;A!==void 0&&(Ns(i,98),lc(i,A));let w=n.sequence;w!==void 0&&(Ns(i,104),tE(i,ib(w)));let k=n.sid;k!==void 0&&(Ns(i,114),lc(i,k));let L=n.timestamp;L!==void 0&&(Ns(i,120),tE(i,L));let j=n.uid;j!==void 0&&(Ns(i,128),Ns(i,j));let K=n.vid;K!==void 0&&(Ns(i,136),Ns(i,K));let W=n.width;W!==void 0&&(Ns(i,144),tE(i,ib(W)));let Y=n.service;Y!==void 0&&(Ns(i,152),Ns(i,Y));let se=n.callbackData;se!==void 0&&(Ns(i,162),Ns(i,se.length),HF(i,se));let de=n.ticket;de!==void 0&&(Ns(i,170),lc(i,de));let ge=n.vendorConfigs;ge!==void 0&&(Ns(i,178),lc(i,ge))})(e,t),(function(n){let i=n.bytes,s=n.limit;return i.length===s?i:i.subarray(0,s)})(t)}function sY(e){return(function(n){let i={};e:for(;!DP(n);){let s=qr(n);switch(s>>>3){case 0:break e;case 1:i.code=qr(n);break;case 2:i.msg=eE(n,qr(n));break;case 3:i.requestId=eE(n,qr(n));break;case 4:i.timestamp=tS(n,!1);break;default:nb(n,7&s)}}return i})({bytes:t=e,offset:0,limit:t.length});var t}function nb(e,t){switch(t){case 0:for(;128&wu(e););break;case 2:GF(e,qr(e));break;case 5:GF(e,4);break;case 1:GF(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function ib(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let jF=[];function GF(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function DP(e){return e.offset>=e.limit}function m0(e,t){let n=e.bytes,i=e.offset,s=e.limit,o=i+t;if(o>n.length){let c=new Uint8Array(2*o);c.set(n),e.bytes=c}return e.offset=o,o>s&&(e.limit=o),i}function WF(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function HF(e,t){let n=m0(e,t.length);e.bytes.set(t,n)}function eE(e,t){let n=WF(e,t),i=String.fromCharCode,s=e.bytes,o="�",c="";for(let d=0;d<t;d++){let u,p,m,g,T=s[d+n];(128&T)==0?c+=i(T):(224&T)==192?d+1>=t?c+=o:(u=s[d+n+1],(192&u)!=128?c+=o:(g=(31&T)<<6|63&u,g<128?c+=o:(c+=i(g),d++))):(240&T)==224?d+2>=t?c+=o:(u=s[d+n+1],p=s[d+n+2],(49344&(u|p<<8))!=32896?c+=o:(g=(15&T)<<12|(63&u)<<6|63&p,g<2048||g>=55296&&g<=57343?c+=o:(c+=i(g),d+=2))):(248&T)==240?d+3>=t?c+=o:(u=s[d+n+1],p=s[d+n+2],m=s[d+n+3],(12632256&(u|p<<8|m<<16))!=8421504?c+=o:(g=(7&T)<<18|(63&u)<<12|(63&p)<<6|63&m,g<65536||g>1114111?c+=o:(g-=65536,c+=i(55296+(g>>10),56320+(1023&g)),d+=3))):c+=o}return c}function lc(e,t){let n=t.length,i=0;for(let c=0;c<n;c++){let d=t.charCodeAt(c);d>=55296&&d<=56319&&c+1<n&&(d=(d<<10)+t.charCodeAt(++c)-56613888),i+=d<128?1:d<2048?2:d<65536?3:4}Ns(e,i);let s=m0(e,i),o=e.bytes;for(let c=0;c<n;c++){let d=t.charCodeAt(c);d>=55296&&d<=56319&&c+1<n&&(d=(d<<10)+t.charCodeAt(++c)-56613888),d<128?o[s++]=d:(d<2048?o[s++]=d>>6&31|192:(d<65536?o[s++]=d>>12&15|224:(o[s++]=d>>18&7|240,o[s++]=d>>12&63|128),o[s++]=d>>6&63|128),o[s++]=63&d|128)}}function wu(e){return e.bytes[WF(e,1)]}function rb(e,t){let n=m0(e,1);e.bytes[n]=t}function qr(e){let t,n=0,i=0;do t=wu(e),n<32&&(i|=(127&t)<<n),n+=7;while(128&t);return i}function Ns(e,t){for(t>>>=0;t>=128;)rb(e,127&t|128),t>>>=7;rb(e,t)}function tS(e,t){let n,i=0,s=0,o=0;return n=wu(e),i=127&n,128&n&&(n=wu(e),i|=(127&n)<<7,128&n&&(n=wu(e),i|=(127&n)<<14,128&n&&(n=wu(e),i|=(127&n)<<21,128&n&&(n=wu(e),s=127&n,128&n&&(n=wu(e),s|=(127&n)<<7,128&n&&(n=wu(e),s|=(127&n)<<14,128&n&&(n=wu(e),s|=(127&n)<<21,128&n&&(n=wu(e),o=127&n,128&n&&(n=wu(e),o|=(127&n)<<7))))))))),{low:i|s<<28,high:s>>>4|o<<24,unsigned:t}}function tE(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,s=t.high>>>24,o=s===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:s<128?9:10,c=m0(e,o),d=e.bytes;switch(o){case 10:d[c+9]=s>>>7&1;case 9:d[c+8]=o!==9?128|s:127&s;case 8:d[c+7]=o!==8?i>>>21|128:i>>>21&127;case 7:d[c+6]=o!==7?i>>>14|128:i>>>14&127;case 6:d[c+5]=o!==6?i>>>7|128:i>>>7&127;case 5:d[c+4]=o!==5?128|i:127&i;case 4:d[c+3]=o!==4?n>>>21|128:n>>>21&127;case 3:d[c+2]=o!==3?n>>>14|128:n>>>14&127;case 2:d[c+1]=o!==2?n>>>7|128:n>>>7&127;case 1:d[c]=o!==1?128|n:127&n}}const KF={},E0={},PP=4294967296,oY=PP*PP,zF=oY/2;sb(0,!0);const J4=sb(0),aY=ob(0,-2147483648,!1),Q4=ob(-1,2147483647,!1);function sb(e,t){let n,i,s;return t?(s=0<=(e>>>=0)&&e<256)&&(i=E0[e],i)?i:(n=ob(e,0,!0),s&&(E0[e]=n),n):(s=-128<=(e|=0)&&e<128)&&(i=KF[e],i)?i:(n=ob(e,e<0?-1:0,!1),s&&(KF[e]=n),n)}function ob(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function YF(e,t){if(isNaN(e))return J4;{if(e<=-zF)return aY;if(e+1>=zF)return Q4}return e<0?J4:ob(e%PP|0,e/PP|0,t)}function kP(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}class LP extends rr{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(gl.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this._qualityRatio}),6e4))}constructor(t){var n;super(),Q(this,"name","AgoraRTCImageModeration"),Q(this,"_connectionState",ea.CONNECTING),Q(this,"_sequence",0),Q(this,"_moderationStartTime",void 0),Q(this,"_workerConnection",void 0),Q(this,"_workerMessageLengthLimit",void 0),Q(this,"_qualityRatio",void 0),Q(this,"_connectInfo",void 0),Q(this,"_cancelTokenSource",Gc.CancelToken.source()),Q(this,"_retryConfig",void 0),Q(this,"_moderationInterval",void 0),Q(this,"_moderationTimer",null),Q(this,"_moderationMode",1),Q(this,"_quality",1),Q(this,"_qualityTimer",null),Q(this,"_ticket",void 0),Q(this,"_moderationIntervalMinimum",void 0),Q(this,"_uploadFailedNum",0),Q(this,"_uploadNum",0),Q(this,"_uploadTimer",null),Q(this,"_extraInfo",void 0),Q(this,"_vendor",""),Q(this,"_encoder",new TextEncoder),Q(this,"_moderationId",void 0),Q(this,"inspectImage",(()=>{if(this.connectionState!==ea.CONNECTED)throw new Pe(H.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval((()=>{this.connectionState===ea.CONNECTED?this.requestToInspectImage():F.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)}),this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()})),this._moderationId=Oi(5,"image-moderation-"),this._workerMessageLengthLimit=re("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=re("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=re("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Xw("worker-"+this._moderationId,Es),this.on(gl.STATE_CHANGE,((i,s)=>{F.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Lr[i]," ").concat(s||""))})),this.handleWorkerEvents()}async init(t,n){this.emit(gl.STATE_CHANGE,Lr.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=n,new De(((s,o)=>{this.on(gl.CONNECTION_STATE_CHANGE,((c,d)=>{c===ea.CONNECTED&&s()})),this.requestAP(t,i,n).then((c=>{this.connectWorker(c)})).catch((c=>{o(c)}))}))}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),F.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===ea.CONNECTED&&this.inspectImage()}async requestAP(t,n,i){const s=re("WEBCS_DOMAIN").map((u=>"https://".concat(u,"/api/v1"))),o=await(function(u,p,m,g){let{appId:T,areaCode:R,cname:I,sid:A,token:w,uid:k}=p;cf++;const L="moderation_plugin",j={service_name:L,json_body:JSON.stringify({appId:T,areaCode:R,cname:I,command:"allocateEdge",requestId:cf,seq:cf,sid:A,appToken:w,ts:Date.now(),uid:k+""})};let K,W,Y=u[0];return Id((async()=>{K=Date.now();const se=await id(Y,{data:j,cancelToken:m,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(W=Date.now()-K,se.code!==0){const je=new Pe(H.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+se.code,{retry:!0,responseTime:W});throw F.error(je.toString()),je}const de=JSON.parse(se.json_body);if(de.code!==200){const je=new Pe(H.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(de.code,", reason: ").concat(de.reason),{code:de.code,responseTime:W});throw F.error(je.toString()),je}if(!de.servers||!Array.isArray(de.servers)||de.servers.length===0){const je=new Pe(H.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:de.code,responseTime:W});throw F.error(je.toString()),je}if(!de.servers.some((je=>!!je.wss))){const je=new Pe(H.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:de.code,responseTime:W});throw F.error(je.toString()),je}const ge=re("IMAGE_MODERATION_WORKER_HOST");return{addressList:de.servers.map((je=>{let{address:_t,wss:ht}=je;if(_t&&ht)return"wss://".concat(_t.replace(/\./g,"-"),".").concat(ge,":").concat(ht,"/moderation")})).filter((je=>!!je)),workerToken:de.workerToken,vid:de.vid,ticket:de.appTicket,responseTime:W}}),((se,de)=>(fe.apworkerEvent(A,{success:!0,sc:200,serviceName:L,responseDetail:JSON.stringify(se.addressList),firstSuccess:de===0,responseTime:W,serverIp:u[de%u.length]}),!1)),((se,de)=>(fe.apworkerEvent(A,{success:!1,sc:se.data&&se.data.code||200,serviceName:L,responseTime:W,serverIp:u[de%u.length]}),!!(se.code!==H.OPERATION_ABORTED&&se.code!==H.UNEXPECTED_RESPONSE||se.data&&se.data.retry)&&(Y=u[(de+1)%u.length],!0))),g)})(s,t,n,i);this.emit(gl.STATE_CHANGE,Lr.AP_CONNECTED);const{addressList:c,ticket:d}=o;return this._ticket=d,c}async connectWorker(t){this.emit(gl.STATE_CHANGE,Lr.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(cn.CONNECTED,(async()=>{this.emit(gl.STATE_CHANGE,Lr.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=ea.CONNECTED})),this._workerConnection.on(cn.CLOSED,(()=>{this.connectionState=ea.CLOSED})),this._workerConnection.on(cn.FAILED,(()=>{this.connectionState=ea.CLOSED})),this._workerConnection.on(cn.RECONNECTING,(()=>{this.connectionState=this.connectionState===ea.CONNECTED?ea.RECONNECTING:ea.CONNECTING})),this._workerConnection.on(cn.ON_MESSAGE,(async t=>{if(t.data instanceof ArrayBuffer){const n=sY(new Uint8Array(t.data));re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&F.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,F.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout((()=>{fe.reportApiInvoke(this._connectInfo.sid||null,{name:Cn.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:Tr.TRACER}).onError(new Pe(H.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null}),re("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else F.error("[".concat(this._moderationId,"] Unexpected message type from worker"))})),this._workerConnection.on(cn.WILL_RECONNECT,((t,n,i)=>{t==="recover"&&i(t),i("tryNext")})),this._workerConnection.on(cn.REQUEST_NEW_URLS,((t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)}))}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=Sc(this,gl.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&F.debug("Only the track being played can be inspected"));this._sequence++;const i=await this.generateRequestData(t,n);this._workerConnection.sendMessage(i,!0,!0)}else re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&F.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:i,cname:s,cid:o,vid:c,sid:d,uid:u}=n;const p=Date.now(),m=await t.getCurrentFrameImage("image/jpeg",this.quality),g=await zD(m,i,s),T=this._sequence+"-"+o+"-"+u+"-"+p+"-"+Oi(12,""),R={appId:i,cid:o,cname:s,deviceId:"",elapse:LP.intToLong(Number(p-this._moderationStartTime)),fileSize:m.buffer.byteLength,height:m.height,width:m.width,jpg:g,networkType:6,osType:7,requestId:T,sdkVersion:"4.24.0",sequence:this._sequence,sid:d,timestamp:YF(p),uid:u,vid:c,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete R.callbackData;const I=rY(R);if(I.byteLength<this._workerMessageLengthLimit){if(re("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const A=(function(w){for(var k=1;k<arguments.length;k++){var L=arguments[k]!=null?arguments[k]:{};k%2?kP(Object(L),!0).forEach((function(j){Q(w,j,L[j])})):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(L)):kP(Object(L)).forEach((function(j){Object.defineProperty(w,j,Object.getOwnPropertyDescriptor(L,j))}))}return w})({},R);delete A.jpg,F.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(A))}return I}{const A=this.quality*this._qualityRatio;return this.quality=A,await this.generateRequestData(t,{appId:i,cname:s,cid:o,vid:c,sid:d,uid:u})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Gc.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=ea.CLOSED,this.emit(gl.STATE_CHANGE,Lr.CLOSED)}}function Z4(e){if(Mi(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new Pe(H.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new Pe(H.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const $4={name:"ImageModeration",create:function(e){let{config:t}=e;return Z4(t),new LP(t)}};var qF,XF,JF,QF,ZF,$F,eB,tB,nB,iB,rB,sB,oB,aB,cB,lB,dB,uB,hB,pB,fB,_B,mB,EB,gB,SB,TB,vB,yB,RB,CB,bB,IB,AB,wB,OB,NB,DB,PB,kB,St,Tt;function Ou(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function Nh(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Ou(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ou(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}ro.setLogger(F);let g0=(qF=Ye(),XF=Ye({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof bv))return[t];t=[t]}return t.map((n=>n?Object(n).toString():"null"))}}),JF=Ye({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==rc.DATA?(Array.isArray(t)||(t=[t]),t.map((n=>n.getTrackId()))):[t.getChannelId()])}),QF=Ye({argsMap:(e,t,n,i)=>[typeof t=="object"?t.uid:t,n,i]}),ZF=Ye({argsMap:(e,t,n)=>[t,n]}),$F=Ye({argsMap:(e,t)=>t.map((n=>{let{user:i,mediaType:s}=n;return[i?.uid,s]}))}),eB=Ye({argsMap:(e,t,n,i)=>[typeof t=="object"?t.uid:t,n,i]}),tB=Ye({argsMap:(e,t)=>t.map((n=>{let{user:i,mediaType:s}=n;return{uid:i?.uid,mediaType:s}}))}),nB=Ye(),iB=Ye(),rB=Ye(),sB=Ye(),oB=Ye(),aB=Ye(),cB=Ye(),lB=Ye(),dB=Ye(),uB=Ye(),hB=Ye(),pB=Ye(),fB=Ye(),_B=Ye(),mB=Ye(),EB=Ye({argsMap:(e,t)=>[t]}),gB=Ye(),SB=Ye(),TB=Ye(),vB=Ye(),yB=Ye(),RB=Ye(),CB=Ye(),bB=Ye(),IB=Ye({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),AB=Ye(),wB=Ye(),OB=Ye(),NB=Ye(),DB=Ye(),PB=Ye(),kB=Ye({reportResult:!0}),St=Ye(),Tt=class extends rr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let n;if(super(),Q(this,"store",void 0),Q(this,"_uid",void 0),Q(this,"_channelName",void 0),Q(this,"_uintUid",void 0),Q(this,"_users",[]),Q(this,"_config",void 0),Q(this,"_clientId",void 0),Q(this,"_appId",void 0),Q(this,"_sessionId",null),Q(this,"_key",void 0),Q(this,"_rtmConfig",{}),Q(this,"_joinInfo",void 0),Q(this,"_gateway",void 0),Q(this,"_statsCollector",void 0),Q(this,"_configDistribute",void 0),Q(this,"_leaveMutex",void 0),Q(this,"_publishMutex",void 0),Q(this,"_renewTokenMutex",void 0),Q(this,"_subscribeMutex",void 0),Q(this,"_encryptionMode","none"),Q(this,"_encryptionSecret",null),Q(this,"_encryptionSalt",null),Q(this,"_encryptDataStream",!1),Q(this,"_encryptDataStreamKey",null),Q(this,"_encryptDataStreamIv",null),Q(this,"_proxyServer",void 0),Q(this,"_turnServer",{servers:[],mode:"auto"}),Q(this,"_cloudProxyServerMode","disabled"),Q(this,"_isDualStreamEnabled",!1),Q(this,"_defaultStreamFallbackType",void 0),Q(this,"_lowStreamParameter",void 0),Q(this,"_streamFallbackTypeCacheMap",new Map),Q(this,"_remoteStreamTypeCacheMap",new Map),Q(this,"_axiosCancelSource",Gc.CancelToken.source()),Q(this,"_audioVolumeIndicationInterval",void 0),Q(this,"_networkQualityInterval",void 0),Q(this,"_userOfflineTimeout",void 0),Q(this,"_streamRemovedTimeout",void 0),Q(this,"_liveTranscodeStreamingClient",void 0),Q(this,"_liveRawStreamingClient",void 0),Q(this,"_channelMediaRelayClient",void 0),Q(this,"_networkQualitySensitivity","normal"),Q(this,"_p2pChannel",void 0),Q(this,"_useLocalAccessPoint",!1),Q(this,"_setLocalAPVersion",void 0),Q(this,"_joinAndNotLeaveYet",!1),Q(this,"_numberOfJoinCount",0),Q(this,"_joinResponse",null),Q(this,"_remoteDefaultVideoStreamType",void 0),Q(this,"_inspect",void 0),Q(this,"_moderation",void 0),Q(this,"_license",void 0),Q(this,"_pendingPublishedUsers",[]),Q(this,"ntpAlignErrorCount",0),Q(this,"remoteInboundOffset",0),Q(this,"_peerConnectionState",void 0),Q(this,"_handleLocalTrackEnable",((s,o,c)=>{this.publish(s,!1).then(o).catch(c)})),Q(this,"_handleLocalTrackDisable",((s,o,c)=>{this.unpublish(s).then(o).catch(c)})),Q(this,"_handleUserOnline",(s=>{if(re("BLOCK_LOCAL_CLIENT")&&Gm(s.uid,this.channelName))return void F.debug("[".concat(s.uid,"] will be ignored in local"));this.isStringUID&&typeof s.uid!="string"&&F.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const o=this._users.find((c=>c.uid===s.uid));if(o)o._trust_in_room_=!0,o._is_pre_created&&(o._is_pre_created=!1,this.safeEmit($t.USER_JOINED,o));else{const c=new Jm(s.uid,s.uint_id||s.uid);this._users.push(c),F.debug("[".concat(this._clientId,"] user online"),s.uid),this.store.firstVideoFrameDecoded(c.uid,{userJoinNotify:Date.now()}),this.safeEmit($t.USER_JOINED,c)}})),Q(this,"_handleUserOffline",(s=>{if(re("BLOCK_LOCAL_CLIENT")&&Gm(s.uid,this.channelName))return;const o=this._users.find((c=>c.uid===s.uid));o&&(this._handleRemoveStream(s),this._handleRemoveDataChannels(s),o._audio_pre_subscribed||o._video_pre_subscribed?o._is_pre_created=!0:Pm(this._users,o),this._remoteStreamTypeCacheMap.delete(o.uid),this._streamFallbackTypeCacheMap.delete(o.uid),F.debug("[".concat(this._clientId,"] user offline"),s.uid,"reason:",s.reason),this.safeEmit($t.USER_LEAVED,o,s.reason))})),Q(this,"_handleAddAudioOrVideoStream",((s,o,c,d,u,p,m,g)=>{if(re("BLOCK_LOCAL_CLIENT")&&Gm(o,this.channelName))return;const T=this._users.find((I=>I.uid===o));if(!T)return void F.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));F.debug("[".concat(this._clientId,"] stream added with uid ").concat(o,", type ").concat(s)),this.store.subscribe(T.uid,s,void 0,void 0,void 0,Date.now()),s==="video"&&this.store.firstVideoFrameDecoded(T.uid,{videoAddNotify:Date.now()});const R=s==="audio"?T.hasAudio:T.hasVideo;if(T._uintid||(T._uintid=p||o),s==="audio"?T._trust_audio_stream_added_state_=!0:T._trust_video_stream_added_state_=!0,s==="audio"?(T._audio_added_=!0,c!==void 0&&(T._audioSSRC=c),d!==void 0&&(T._cname=d),m&&(T._audioOrtc=m)):(T._video_added_=!0,c!==void 0&&(T._videoSSRC=c),d!==void 0&&(T._cname=d),g!==void 0&&(T._rtxSsrcId=g),m&&(T._videoOrtc=m)),(s==="audio"?T.hasAudio:T.hasVideo)&&!R&&(F.info("[".concat(this._clientId,"] remote user ").concat(T.uid," published ").concat(s)),this.safeEmit($t.USER_PUBLISHED,T,s)),s==="video"?fe.onGatewayStream(this._sessionId,Nn.ON_ADD_VIDEO_STREAM,yr.ON_ADD_VIDEO_STREAM,{peer:p||o,ssrc:T._videoSSRC}):fe.onGatewayStream(this._sessionId,Nn.ON_ADD_AUDIO_STREAM,yr.ON_ADD_AUDIO_STREAM,{peer:p||o,ssrc:T._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(T,s,c).then((I=>{if(I&&(F.debug("[".concat(this._clientId,"] resubscribe ").concat(s," for user ").concat(T.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof ia))return this._p2pChannel.unsubscribe(T,s,!0).then((()=>this._subscribe(T,s,!0).catch((A=>{F.error("[".concat(this._clientId,"] resubscribe error"),A.toString())}))))})),this._p2pChannel.hasPendingRemoteMedia(T,s)&&(F.debug("[".concat(this._clientId,"] resubscribe ").concat(s," for user ").concat(T.uid," after reconnect.")),this._subscribe(T,s,!0).catch((I=>{F.error("[".concat(this._clientId,"] resubscribe error"),I.toString())}))),s==="video"&&!Xo()&&!mo()){const I=this._getEncodingName(u);I?.toLocaleLowerCase()==vC.av1&&SF().then((A=>{A||this._gateway.downgradeCodec(I)}))}})),Q(this,"_handleRemoveStream",(s=>{if(re("BLOCK_LOCAL_CLIENT")&&Gm(s.uid,this.channelName))return;const o=this._users.find((d=>d.uid===s.uid));if(!o)return void F.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));F.debug("[".concat(this._clientId,"] stream removed with uid ").concat(s.uid));let c=()=>{};o.hasAudio&&o.hasVideo?c=()=>{F.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished audio track")),this.safeEmit($t.USER_UNPUBLISHED,o,"audio"),F.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished video track")),this.safeEmit($t.USER_UNPUBLISHED,o,"video")}:o.hasVideo?c=()=>{F.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished video track")),this.safeEmit($t.USER_UNPUBLISHED,o,"video")}:o.hasAudio&&(c=()=>{F.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished audio track")),this.safeEmit($t.USER_UNPUBLISHED,o,"audio")}),o._video_pre_subscribed||o._audio_pre_subscribed||(o._trust_audio_stream_added_state_=!0,o._trust_video_stream_added_state_=!0,o._audio_added_=!1,o._video_added_=!1,this._p2pChannel instanceof ia&&this._p2pChannel.unsubscribe(o).then((d=>{if(d)return this._gateway.unsubscribe(d,o.uid)})),o._audioSSRC=void 0,o._videoSSRC=void 0,o._audioOrtc=void 0,o._videoOrtc=void 0,o._rtxSsrcId=void 0),fe.onGatewayStream(this._sessionId,Nn.ON_REMOVE_STREAM,yr.ON_REMOVE_STREAM,{peer:s.uint_id||s.uid}),c()})),Q(this,"_handleSetStreamLocalEnable",((s,o,c)=>{if(re("BLOCK_LOCAL_CLIENT")&&Gm(o,this.channelName))return;const d=this._users.find((m=>m.uid===o));if(!d)return void F.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));F.debug("[".concat(this._clientId,"] local ").concat(s," ").concat(c?"enabled":"disabled"," with uid ").concat(o));const u=s==="audio"?d.hasAudio:d.hasVideo;if(s==="audio"){d._trust_audio_enabled_state_=!0;const m=d._audio_enabled_;if(d._audio_enabled_=c,d._audio_enabled_===m)return;{const g=d._audio_enabled_?"enable-local-audio":"disable-local-audio";F.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(o,", msg: ").concat(g)),this.safeEmit($t.USER_INFO_UPDATED,o,g)}}else{d._trust_video_enabled_state_=!0;const m=d._video_enabled_;if(d._video_enabled_=c,d._video_enabled_===m)return;{const g=d._video_enabled_?"enable-local-video":"disable-local-video";F.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(g)),this.safeEmit($t.USER_INFO_UPDATED,o,g)}}const p=s==="audio"?d.hasAudio:d.hasVideo;return u!==p?!u&&p?(F.info("[".concat(this._clientId,"] remote user ").concat(o," published ").concat(s)),void this.safeEmit($t.USER_PUBLISHED,d,s)):(s==="video"&&d._videoTrack&&d._videoTrack._destroy(),s==="audio"&&d._audioTrack,this._p2pChannel.muteRemote(d,s),F.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished ").concat(s)),void this.safeEmit($t.USER_UNPUBLISHED,d,s)):void 0})),Q(this,"_handleMuteStream",((s,o,c)=>{if(re("BLOCK_LOCAL_CLIENT")&&Gm(s,this.channelName))return;F.debug("[".concat(this._clientId,"] receive mute message"),s,o,c);const d=this._users.find((m=>m.uid===s));if(!d)return void F.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(s));const u=o==="audio"?d.hasAudio:d.hasVideo;if(o==="audio"){d._trust_audio_mute_state_=!0;const m=d._audio_muted_;if(d._audio_muted_=c,d._audio_muted_===m)return;{const g=d._audio_muted_?"mute-audio":"unmute-audio";F.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(g)),this.safeEmit($t.USER_INFO_UPDATED,s,g)}}else{d._trust_video_mute_state_=!0;const m=d._video_muted_;if(d._video_muted_=c,d._video_muted_===m)return;{const g=d._video_muted_?"mute-video":"unmute-video";F.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(g)),this.safeEmit($t.USER_INFO_UPDATED,s,g)}}const p=o==="audio"?d.hasAudio:d.hasVideo;if(u!==p){if(!u&&p)return(o==="audio"?d._audioSSRC:d._videoSSRC)?(F.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(o)),void this.safeEmit($t.USER_PUBLISHED,d,o)):void F.warning("[".concat(this._clientId,"] remote user ").concat(s," receive ").concat(o," unmute message  before add stream message, ").concat(o," SSRC doesn't exist yet."));o==="video"&&d._videoTrack&&!d._video_pre_subscribed&&d._videoTrack._destroy(),o==="audio"&&d._audioTrack,this._p2pChannel.muteRemote(d,o),F.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(o)),this.safeEmit($t.USER_UNPUBLISHED,d,o)}})),Q(this,"_handleP2PLost",(async s=>{F.debug("[".concat(this._clientId,"] receive p2p lost"),s),parseInt(s.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():F.warning("[".concat(this._clientId,"] P2PLost stream not found"),s)})),Q(this,"_handleTokenWillExpire",(()=>{F.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit($t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)})),Q(this,"_handleBeforeUnload",(s=>{s.type==="beforeunload"&&s.returnValue!==void 0&&s.returnValue!==""||(this.leave(),F.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))})),Q(this,"_handleUpdateNetworkQuality",(()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit($t.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const s={downlinkNetworkQuality:0,uplinkNetworkQuality:0};s.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),s.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit($t.NETWORK_QUALITY,s)})),Q(this,"_handleP2PAddAudioOrVideoStream",((s,o,c,d)=>{const u=this._users.find((m=>m.uid===o));if(!u)return void F.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));F.debug("[".concat(this._clientId,"] stream added with uid ").concat(o,", type ").concat(s)),this.store.subscribe(u.uid,s,void 0,void 0,void 0,Date.now());const p=s==="audio"?u.hasAudio:u.hasVideo;s==="audio"?u._trust_audio_stream_added_state_=!0:u._trust_video_stream_added_state_=!0,s==="audio"?(u._audio_added_=!0,c!==void 0&&(u._audioSSRC=c),d!==void 0&&(u._audioMid=d)):(u._video_added_=!0,c!==void 0&&(u._videoSSRC=c),d!==void 0&&(u._videoMid=d)),(s==="audio"?u.hasAudio:u.hasVideo)&&!p&&(F.info("[".concat(this._clientId,"] remote user ").concat(u.uid," published ").concat(s)),this.safeEmit($t.USER_PUBLISHED,u,s)),this._p2pChannel.hasPendingRemoteMedia(u,s)&&(F.debug("[".concat(this._clientId,"] resubscribe ").concat(s," for user ").concat(u.uid," after reconnect.")),this._subscribe(u,s,!0).catch((m=>{F.error("[".concat(this._clientId,"] resubscribe error"),m.toString())})))})),this._config=e,this._clientId=t||Oi(5,"client-"),this.store=new class{constructor(s,o,c,d){nn(this,"state",void 0),this.state={codec:s,audioCodec:o,mode:c,clientId:d,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Bs.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(s){this.state=(function(o,c){switch(c.type){case tn.SET_SESSION_ID:return z(z({},o),{},{sessionId:c.sessionId});case tn.SET_P2P_ID:return z(z({},o),{},{p2pId:c.p2pId});case tn.SET_UID:return z(z({},o),{},{uid:c.uid});case tn.SET_INT_UID:return z(z({},o),{},{intUid:c.intUid});case tn.SET_PUB_ID:return z(z({},o),{},{pubId:c.pubId});case tn.KEY_METRIC_CLIENT_CREATED:return z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{clientCreated:c.metric})});case tn.KEY_METRIC_JOIN_START:return z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{joinStart:c.metric})});case tn.KEY_METRIC_PRELOAD_START:return z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{preloadStart:c.metric})});case tn.KEY_METRIC_PRELOAD_END:return z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{preloadEnd:c.metric})});case tn.KEY_METRIC_JOIN_END:return z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{joinEnd:c.metric})});case tn.KEY_METRIC_REQUEST_AP_START:return z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{requestAPStart:c.metric})});case tn.KEY_METRIC_REQUEST_AP_END:return z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{requestAPEnd:c.metric})});case tn.KEY_METRIC_REQUEST_SUA_END:return z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{requestSUAEnd:c.metric})});case tn.KEY_METRIC_BEFORE_CONNECT:return z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{beforeConnect:c.metric})});case tn.KEY_METRIC_PEER_RECEIVER:return z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{peerReceiver:c.metric})});case tn.KEY_METRIC_SIGNAL_CONNECTED:return z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{signalConnected:c.metric})});case tn.KEY_METRIC_JOIN_REQ:return z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{joinReq:c.metric})});case tn.KEY_METRIC_JOIN_REP:return z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{joinRep:c.metric})});case tn.KEY_METRIC_JOIN_GATEWAY_START:return z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{joinGatewayStart:c.metric})});case tn.KEY_METRIC_JOIN_GATEWAY_END:return z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{joinGatewayEnd:c.metric})});case tn.KEY_METRIC_PEER_CONNECTION_START:return z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{peerConnectionStart:c.metric})});case tn.KEY_METRIC_PEER_CONNECTION_END:return z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{peerConnectionEnd:c.metric})});case tn.KEY_METRIC_DESCRIPTION_START:return z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{descriptionStart:c.metric})});case tn.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{signalChannelOpen:c.metric})});case tn.KEY_METRIC_ICE_CONNECTION_END:return z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{iceConnectionEnd:c.metric})});case tn.KEY_METRIC_PUBLISH:{const d=o.keyMetrics.publish,u=d.findIndex((p=>p.trackId===c.metric.trackId));return u!==-1?(d[u]=z(z({},d[u]),c.metric),z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{publish:[...d]})})):z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{publish:[...o.keyMetrics.publish,c.metric]})})}case tn.KEY_METRIC_SUBSCRIBE:{const d=o.keyMetrics.subscribe,u=d.findIndex((p=>p.userId===c.metric.userId&&p.type===c.metric.type));return u!==-1?(d[u]=z(z({},d[u]),c.metric),z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{subscribe:[...d]})})):z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{subscribe:[...o.keyMetrics.subscribe,c.metric]})})}case tn.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const d=o.keyMetrics.firstVideoFrameDecoded,u=d.findIndex((p=>p.userId===c.metric.userId));return u!==-1?(d[u]=z(z({},d[u]),c.metric),z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{firstVideoFrameDecoded:[...d]})})):z(z({},o),{},{keyMetrics:z(z({},o.keyMetrics),{},{firstVideoFrameDecoded:[...o.keyMetrics.firstVideoFrameDecoded,c.metric]})})}case tn.RESET_FIRST_VIDEO_FRAME_DECODED:return o.keyMetrics.firstVideoFrameDecoded=[],o;case tn.SET_CLOUD_PROXY_SERVER_MODE:return o.cloudProxyServerMode=c.mode,o;case tn.RECORD_JOIN_CHANNEL_SERVICE:return typeof c.index!="number"?o.joinChannelServiceRecords=[...o.joinChannelServiceRecords,c.record]:(o.joinChannelServiceRecords[c.index]=z(z({},o.joinChannelServiceRecords[c.index]),c.record),o.joinChannelServiceRecords=[...o.joinChannelServiceRecords]),o;case tn.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return o.joinChannelServiceRecords=[],o;case tn.RESET_KEY_METRICS:return o.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},o;case tn.SET_USE_P2P:return z(z({},o),{},{useP2P:c.val});case tn.SET_TRANSPORT_TYPE:return z(z({},o),{},{p2pTransport:c.val});default:return o}})(this.state,s)}set autoSubscribe(s){this.state.autoSubscribe=s}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(s){this.state.enableInstantMuteRestore=s}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(s){this.dispatch({type:tn.SET_SESSION_ID,sessionId:s})}get sessionId(){return this.state.sessionId}set cid(s){this.state.cid=s}get cid(){return this.state.cid}set codec(s){this.state.codec=s}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(s){this.dispatch({type:tn.SET_P2P_ID,p2pId:s})}get p2pId(){return this.state.p2pId}set dcId(s){this.dispatch({type:tn.SET_DC_ID,dcId:s})}get dcId(){return this.state.dcId}set uid(s){this.dispatch({type:tn.SET_UID,uid:s})}get uid(){return this.state.uid}set intUid(s){this.dispatch({type:tn.SET_INT_UID,intUid:s})}get intUid(){return this.state.intUid}set pubId(s){this.dispatch({type:tn.SET_PUB_ID,pubId:s})}get pubId(){return this.state.pubId}set cloudProxyServerMode(s){this.dispatch({type:tn.SET_CLOUD_PROXY_SERVER_MODE,mode:s})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(s){this.dispatch({type:tn.SET_USE_P2P,val:s})}get useP2P(){return this.state.useP2P}set p2pTransport(s){this.dispatch({type:tn.SET_TRANSPORT_TYPE,val:s})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(s){this.state.hasStartJoinChannel=s}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(s){this.state.isABTestSuccess=s}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:tn.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:tn.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:tn.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:tn.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:tn.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:tn.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:tn.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:tn.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:tn.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:tn.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:tn.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:tn.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:tn.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:tn.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:tn.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:tn.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:tn.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(s,o){this.dispatch({type:tn.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:z({userId:s},o)})}descriptionStart(){this.dispatch({type:tn.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:tn.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:tn.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(s,o,c,d){this.dispatch({type:tn.KEY_METRIC_PUBLISH,metric:z(z({trackId:s,type:o},c&&{publishStart:c}),d&&{publishEnd:d})})}subscribe(s,o,c,d,u,p,m){this.dispatch({type:tn.KEY_METRIC_SUBSCRIBE,metric:z(z(z(z(z({userId:s,type:o},c&&{subscribeStart:c}),d&&{subscribeEnd:d}),u&&{firstFrame:u}),p&&{streamAdded:p}),m&&{firstDecoded:m})})}massSubscribe(s,o,c,d){s.forEach((u=>{this.dispatch({type:tn.KEY_METRIC_SUBSCRIBE,metric:z(z(z({userId:u.userId,type:u.type},o&&{subscribeStart:o}),c&&{subscribeEnd:c}),d&&{firstFrame:d})})}))}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(s,o){s.service==="gateway"&&Array.isArray(s.urls)&&(s.urls=s.urls.map((c=>c.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2"))));try{return typeof o!="number"?(this.dispatch({type:tn.RECORD_JOIN_CHANNEL_SERVICE,record:z(z({},s),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(o<0||o>=this.state.joinChannelServiceRecords.length||this.dispatch({type:tn.RECORD_JOIN_CHANNEL_SERVICE,record:s,index:o}),o)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:tn.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:tn.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:tn.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new ro("client-leave",this._clientId),this._publishMutex=new ro("client-publish",this._clientId),this._renewTokenMutex=new ro("client-renewtoken",this._clientId),this._subscribeMutex=new ro("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),F.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(ql," build: ").concat(Nw,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{jn(e.clientRoleOptions),n=Object.assign({},e.clientRoleOptions)}catch(s){F.warning("[".concat(this._clientId,"] ").concat(s.toString()))}var i;this._statsCollector=new YC(this.store),this._statsCollector.onStatsException=(s,o,c)=>{F.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(s,", msg: ").concat(o,", uid: ").concat(c)),s===ta.VIDEO_ENCODE_FAILED&&this.localTracks.forEach((d=>{d instanceof AC&&re("ENABLE_ENCODE_EXCEPTION")&&d.findClosestProfile()})),this.safeEmit($t.EXCEPTION,{code:s,msg:o,uid:c})},this._statsCollector.onUploadPublishDuration=(s,o,c,d)=>{const u=this._users.find((p=>p.uid===s));u&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(u._uintid,{peerPublishDuration:c,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(u)),fe.peerPublishStatus(this._sessionId,{subscribeElapse:d,audioPublishDuration:o,videoPublishDuration:c,peer:u._uintid}))},this._statsCollector.onVideoCodecChanged=s=>{if(re("VIDEO_STANDARD_BITRATE_VERSION")&&(s==="av1"||s==="h265"||s==="h264")){const o=this.localTracks.find((c=>c instanceof zi));o&&o._saveEncodeBitrateRatio!==1&&o.setSaveEncodeBitrateRatio(s==="h264"?re("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new uP(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Es,httpRetryConfig:e.httpRetryConfig||Es,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:n}),this._configDistribute=new eY(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(i={store:this.store,statsCollector:this._statsCollector},b_("P2PChannel").create(i)),this._handleP2PEvents()):this._p2pChannel=new ia(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,n,i,s){let o=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],c=arguments.length>6&&arguments[6]!==void 0&&arguments[6];te("JOIN_GATEWAY_USE_443PORT_ONLY",o),te("JOIN_GATEWAY_USE_DUAL_DOMAIN",c);const d=this._gateway.signal.websocket;return d instanceof Ov&&(d.use443PortOnly=o,d.tryDoubleDomain=c),(async function(u,p,m){mv.get(u)||mv.set(u,[]),mu.get(u)||mu.set(u,p),Br.get(u)||Br.set(u,0);const g=mv.get(u),T=mu.get(u);if(!g||!T)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(Br.get(u)===T){const k=xg();g.push(k),await k.promise}Br.set(u,Br.get(u)+1);for(var R=arguments.length,I=new Array(R>3?R-3:0),A=3;A<R;A++)I[A-3]=arguments[A];const w=await m(...I);return Br.set(u,Br.get(u)-1),Br.get(u)===T-1&&g.length>0&&(g[0].resolve(),g.shift()),Br.get(u)===0&&(mv.set(u,[]),mu.set(u,0),Br.set(u,0)),w})("client.join",re("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,n,i,s)}async join(e,t,n,i,s){const o=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const c=(bw||bw||(bw=(window.location.protocol.split(":")[0]||"").toUpperCase(),bw))==="HTTPS",d=vu()?window.isSecureContext:"Browser Not Support";(!vu()&&!c||!window.isSecureContext)&&F.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let u;fe.setAppId(e);try{if(!n&&n!==null)throw new Pe(H.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));if(n&&ls(n,"token",1,2047),ls(e,"appid",1,2047),wv(t),i&&Ch(i),s)if(typeof s=="string")ls(s,"optionalInfo",1,256),u=s;else{if(typeof s!="object")throw new Pe(H.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:w,enableInstantMuteRestore:k}=s;w&&(gr(w,"autoSubscribe"),F.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(w)),this.store.autoSubscribe=w),k&&(gr(k,"enableInstantMuteRestore"),F.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(k)),this.store.enableInstantMuteRestore=k)}}}catch(w){throw fe.reportApiInvoke(__(),{name:Cn.JOIN,options:[e,t,n,i],states:{isHttps:c,isSecureContext:d},tag:Tr.TRACER}).onError(w),w}if(this._leaveMutex.isLocked&&(F.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),F.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const w=new Pe(H.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw fe.reportApiInvoke(__(),{name:Cn.JOIN,options:[e,t,n,i],states:{isHttps:c,isSecureContext:d},tag:Tr.TRACER}).onError(w),w}this._gateway.state="CONNECTING",this.store.preloadStart();const p=await VF({appId:e,cname:t,uid:i,stringUid:typeof i=="string"?i:void 0,token:n||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new Pe(H.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const m=p?.sid||__();F.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(o)),this._sessionId||(this._sessionId=m,this.store.sessionId=this._sessionId);const g=fe.reportApiInvoke(m,{id:this._clientId,name:Cn.JOIN,options:[e,t,n,i],states:{isHttps:c,isSecureContext:d},tag:Tr.TRACER}),T=Nh(Nh(Nh({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof i!="string"?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:u,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!p},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:re("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(T.setLocalAPVersion=this._setLocalAPVersion),typeof i=="string"&&(T.stringUid=i,this._uintUid?(T.uid=this._uintUid,this._uintUid=void 0):T.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(T.aesmode=this._encryptionMode,T.aespassword=await(async w=>{const k=(function(W){const Y=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),se=new Uint8Array(new ArrayBuffer(Y.length));for(let de=0;de<Y.length;de+=1)se[de]=Y.charCodeAt(de);return se})(),L=await window.crypto.subtle.importKey("spki",k,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),j=ID(w),K=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},L,j);return(function(W){let Y="";for(let se=0;se<W.length;se+=1)Y+=String.fromCharCode(W[se]);return window.btoa(Y)})(new Uint8Array(K))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Pe(H.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(T.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const w=new TextEncoder,k=re("USE_PURE_ENCRYPTION_MASTER_KEY")?w.encode(T.appId+this._encryptionSecret+this._encryptionSecret):w.encode(T.appId+T.cname+this._encryptionSecret);this._encryptDataStreamIv=await(async function(L,j,K){const W=await window.crypto.subtle.importKey("raw",j,"PBKDF2",!1,["deriveBits","deriveKey"]),Y=L==="aes-128-gcm2"?128:256,se=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:vv,hash:"SHA-256",salt:K},W,Y+c4);return new Uint8Array(se).subarray(Y/8)})(this._encryptionMode,k,bd(this._encryptionSalt)),this._encryptDataStreamKey=await(async function(L,j,K){const W=await window.crypto.subtle.importKey("raw",j,"PBKDF2",!1,["deriveBits","deriveKey"]),Y=L==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:vv,hash:"SHA-256",salt:K},W,{name:"AES-GCM",length:Y},!0,["encrypt","decrypt"])})(this._encryptionMode,k,bd(this._encryptionSalt))}else d?F.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):F.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,F.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:T.stringUid});const R=this._sessionId;setTimeout((()=>{this.connectionState==="CONNECTING"&&R===this._sessionId&&fe.joinChannelTimeout(this._sessionId,5)}),5e3);try{var I;let w;const k=T.cloudProxyServer;if(Re(I=["proxy3","proxy4","proxy5"]).call(I,k)){const Y=re("PROXY_SERVER_TYPE3");Array.isArray(Y)?T.proxyServer=Y[0]:T.proxyServer=Y}if(fe.setProxyServer(T.proxyServer),F.setProxyServer(T.proxyServer),this.store.requestAPStart(),p){if(F.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(T.stringUid?", ".concat(T.stringUid," => ").concat(p.intUid):""," ")),T.stringUid&&!T.uid&&(T.uid=p.intUid),w={gatewayInfo:p.ap.gatewayInfo},re("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&T.turnServer.mode==="auto")if(p.ap.proxyInfo.addresses.length===0)F.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const Y=(await lP(p.ap.proxyInfo,p.ap.gatewayInfo.uid)).map((se=>({turnServerURL:se.address,tcpport:se.tcpport||go.tcpport,udpport:se.udpport||go.udpport,username:se.username||go.username,password:se.password||go.password,forceturn:!1,security:!0})));T.turnServer={mode:"manual",servers:Y}}BF(p,T.stringUid)}else{if(T.stringUid&&!T.uid){let Y;[Y,w]=await De.all([F4(T.stringUid,T,this._axiosCancelSource.token,this._config.httpRetryConfig||Es,this.store).finally((()=>{this.store.requestSUAEnd()})),TF(T,this._axiosCancelSource.token,this._config.httpRetryConfig||Es,!0,this.store).finally((()=>{this.store.requestAPEnd()}))]),F.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(T.stringUid," => ").concat(Y)),T.uid=Y,w.gatewayInfo.uid=Y,w.gatewayInfo.res.uid=Y}else w=await TF(T,this._axiosCancelSource.token,this._config.httpRetryConfig||Es,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Pe(H.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout((()=>{this._configDistribute.startGetConfigDistribute(T,this._axiosCancelSource.token),this._configDistribute.on(kC.UPDATE_BITRATE_LIMIT,(Y=>{this._p2pChannel.updateBitrateLimit(Y)})),this._configDistribute.on(kC.UPDATE_CLIENT_ROLE_OPTIONS,(Y=>{this._setClientRoleOptions(Y)}))}),0),this._key=n||e;const L=w.gatewayInfo,j=T.uid?T.uid:L.uid;this._joinInfo=Nh(Nh({},T),{},{cid:L.cid,uid:j,vid:L.vid,apResponse:L.res,apGatewayAddress:L.apGatewayAddress,uni_lbs_ip:L.uni_lbs_ip,gatewayAddrs:L.gatewayAddrs}),this.store.intUid=j,this.store.cid=L.cid;const K=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Pe(H.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));g.onSuccess(K),this._appId=e,this._channelName=T.cname,this._uid=K,this.store.uid=K,setTimeout((()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Xo()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()}),0);const W=T.stringUid?"string uid: ".concat(T.stringUid,",uid: ").concat(T.uid):"uid: ".concat(this._uid);return F.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(W)),setTimeout((()=>{F.startUpload()}),5e3),this.store.joinEnd(),A=this,Re(yh).call(yh,A)||yh.push(A),this._cloudProxyServerMode==="disabled"&&ai().supportWebCrypto&&re("ENABLE_PRELOAD")&&NP(this._joinInfo),K}catch(w){const k=Array.isArray(w)?w[0]:w;throw k&&k.code===H.OPERATION_ABORTED?F.warning("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),k):F.error("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),k),k.code!==H.OPERATION_ABORTED&&this._numberOfJoinCount===o&&(this._gateway.state="DISCONNECTED",this._reset()),g.onError(k),k}var A}_joinGateway(){if(!this._joinInfo||!this._key)throw new Pe(H.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!re("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){F.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Xo()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),(function(t){const n=yh.indexOf(t);n!==-1&&yh.splice(n,1)})(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return F.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",Ti.LEAVE),F.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof bv))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new Pe(H.INVALID_PARAMS,"param list is empty");const n=e;if(this._gateway.role==="audience")throw new Pe(H.INVALID_OPERATION,"audience can not publish stream");for(const s of n){if(!(s instanceof bv))throw new Pe(H.INVALID_PARAMS,"parameter is not local track");if(!s._enabled&&t)throw new Pe(H.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(s.getTrackId()))}F.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map((s=>"".concat(s.getTrackId()," ")))));const i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&n.forEach((s=>{const o=this._configDistribute.getBitrateLimit();s instanceof zi&&o&&s.setBitrateLimit(o.uplink)}));try{await this._publishHighStream(n),F.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map((s=>"".concat(s.getTrackId()," ")))))}catch(s){throw F.error("[".concat(this._clientId,"] publish error"),s.toString()),s}finally{i()}}async _publishDataChannel(e){if(e==null)throw new Pe(H.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));Mi(e.id,"id",0,65535,!0),gr(e.ordered,"ordered"),ls(e.metadata,"metadata",0,512),F.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex((s=>s.id===e.id))!==-1)throw new Pe(H.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new Pe(H.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(H.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&re("FORCE_TURN")&&!re("TURN_ENABLE_TCP")&&!re("TURN_ENABLE_UDP"))throw new Pe(H.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=(function(s){return r0(s,!1)})(e),i=await this._p2pChannel.publishDataChannel([n]);if(i.length>0){if(typeof n._originDataChannelId!="number")throw F.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new Pe(H.CREATE_DATACHANNEL_ERROR);try{await De.all(i.map((s=>this._uid&&this._gateway.publishDataChannel(this._uid,s,!0)))),await n._waitTillOpen()}catch(s){if(s.code!==H.DISCONNECT_P2P)throw s}}return F.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw F.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new Pe(H.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof bv))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);F.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map((i=>"".concat(i.getTrackId()," ")))," "));const n=await this._publishMutex.lock();try{if(this.store.useP2P){const i=await this._p2pChannel.unpublish(t);i&&await this._gateway.sendExtensionMessage(Mr.UNPUBLISH,{unpubMsg:i},!0)}else{const i=await this._p2pChannel.unpublish(t);i&&await this._gateway.unpublish(i,this._uid),F.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map((s=>"".concat(s.getTrackId())))))}}catch(i){throw F.error("[".concat(this._clientId,"] unpublish error"),i.toString()),i}finally{n&&n()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),F.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map((n=>"".concat(n.id," ")))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(e);n&&await this._gateway.unpublishDataChannel(n),F.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map((i=>"".concat(i.id)))))}catch(n){throw F.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t,n){if(!(e instanceof Jm)){const i=this.remoteUsers.find((s=>s.uid===e));if(!i)throw new Pe(H.INVALID_REMOTE_USER,"user is not in the channel");e=i}return t==="datachannel"?this._subscribeDataChannel(e,n):this._subscribe(e,t)}async presubscribe(e,t){if(Tn(t,"mediaType",["audio","video"]),this.store.useP2P)throw new Pe(H.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new Pe(H.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(H.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=t===dt.AUDIO,i=t===dt.VIDEO,s=await this._subscribeMutex.lock();try{const{ssrcId:o,ortc:c,rtxSsrcId:d,cname:u,uint_id:p}=await this._gateway.presubscribe(e,t,!0);if(o==null)throw new Pe(H.UNEXPECTED_RESPONSE,"no ssrc id");let m=this._users.find((T=>T.uid===e));m||(m=new Jm(e,p||e),m._is_pre_created=!0,this._users.push(m)),u&&(m._cname=u),m._uintid||(m._uintid=p||e),n&&(m._audioSSRC=o,m._audio_pre_subscribed=!0,c&&(m._audioOrtc=c)),i&&(m._videoSSRC=o,m._video_pre_subscribed=!0,c&&(m._videoOrtc=c),d!=null&&(m._rtxSsrcId=d)),F.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(o)),await this._p2pChannel.subscribe(m,t,o,d,c);const g=n?m._audioTrack:m._videoTrack;if(!g)throw new Pe(H.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(m._trust_audio_stream_added_state_=!0,m._audio_added_=!0),i&&(m._trust_video_stream_added_state_=!0,m._video_added_=!0),g}catch(o){throw F.error("[".concat(this._clientId,"] presub user ").concat(e," error"),o),o}finally{s()}}async _subscribeDataChannel(e,t){var n;if(Mi(t,"channelId",0,65535,!0),!this._joinInfo)throw new Pe(H.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(H.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find((d=>d===e)))throw F.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new Pe(H.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw F.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new Pe(H.INVALID_REMOTE_USER,"user is not published");const s=(n=e._dataChannels)===null||n===void 0?void 0:n.find((d=>d.id===t));if(!s)throw F.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new Pe(H.REMOTE_USER_IS_NOT_PUBLISHED);const o=await this._subscribeMutex.lock();F.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const d=await this._p2pChannel.subscribeDataChannel(e,[s]);if(d&&Re(d).call(d,s.id))try{var c;if(typeof s._originDataChannelId!="number")throw F.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Pe(H.CREATE_DATACHANNEL_ERROR);const u={id:s.id,datachannelId:s._originDataChannelId,ordered:s.ordered,maxRetransmits:s.maxRetransmits,metadata:(c=s.metadata)!==null&&c!==void 0?c:""};await this._gateway.subscribeDataChannel(e.uid,u,!0),await s._waitTillOpen()}catch(u){if(u?.code!==H.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[s]),u;await this._p2pChannel.unsubscribeDataChannel(e,[s]),this._p2pChannel.setPendingRemoteDataChannel(e,s.id)}return F.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),s}finally{o()}}async _p2pSubscribe(e,t,n){if(Tn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Pe(H.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(H.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((o=>o===e))){const o=new Pe(H.INVALID_REMOTE_USER,"user is not in the channel");throw F.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),o}if(!e.hasAudio&&!e.hasVideo){const o=new Pe(H.INVALID_REMOTE_USER,"user is not published");throw F.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),o}if(!n&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){const o=new Pe(H.REMOTE_USER_IS_NOT_PUBLISHED);throw F.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),o}const s=await this._subscribeMutex.lock();F.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const c=t==="audio"?e._audioSSRC:e._videoSSRC,d=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,c,d)}catch(c){throw c}F.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((c=>{F.warning("[".concat(this._clientId,"] auto set fallback failed"),c)}));const o=t==="audio"?e._audioTrack:e._videoTrack;if(!o)throw new Pe(H.UNEXPECTED_ERROR,"can not find remote track in user object");return o}catch(o){throw F.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),o),o}finally{s()}}async _subscribe(e,t,n){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(Tn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Pe(H.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(H.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((p=>p===e))){const p=new Pe(H.INVALID_REMOTE_USER,"user is not in the channel");throw F.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),p}if(!e.hasAudio&&!e.hasVideo){const p=new Pe(H.INVALID_REMOTE_USER,"user is not published");throw F.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),p}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const p=new Pe(H.REMOTE_USER_IS_NOT_PUBLISHED);throw F.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),p}let s=t==="audio"?e._audioSSRC:e._videoSSRC,o=t==="audio"?e._audioOrtc:e._videoOrtc,c=t==="video"?e._rtxSsrcId:void 0,d={stream_type:t==="audio"?dt.AUDIO:dt.VIDEO,ssrcId:s};t==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const u=await this._subscribeMutex.lock();F.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{const m=t==="audio"?e._audioSSRC:e._videoSSRC;m!==void 0&&m!==s&&(s=m,o=t==="audio"?e._audioOrtc:e._videoOrtc,c=t==="video"?e._rtxSsrcId:void 0,d={stream_type:t==="audio"?dt.AUDIO:dt.VIDEO,ssrcId:s}),ma.markSubscribeStart(this.store.clientId,s),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,s,c,o);try{this._p2pChannel.isPreSubScribe(s)||await this._gateway.subscribe(e.uid,d,!0)}catch(g){if(g?.code!==H.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),g;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(m){throw this._p2pChannel.reportSubscribeEvent(!1,m?.code,e,t),m}F.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((m=>{F.warning("[".concat(this._clientId,"] auto set fallback failed"),m)}));const p=t==="audio"?e._audioTrack:e._videoTrack;if(!p)throw new Pe(H.UNEXPECTED_ERROR,"can not find remote track in user object");return t==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),p}catch(p){throw F.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),p),p}finally{u()}}async massSubscribe(e){if(Hi(e,"subscribeList"),!this._joinInfo)throw new Pe(H.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(H.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,i=await this._subscribeMutex.lock();F.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map((d=>{let{user:u,mediaType:p}=d;return"user: ".concat(u?.uid,", mediaType: ").concat(p)})).join("; ")));const s=(e=[...e]).map((d=>{let{user:u,mediaType:p}=d;return{user:u,mediaType:p}})),o=await this._p2pChannel.globalLock();try{var c;for(let u=e.length-1;u>=0;u--){const p=e[u],{user:m,mediaType:g}=p;if(Tn(g,"mediaType",["audio","video"]),!m){const A=new Pe(H.INVALID_PARAMS,"user property does not exist in subscribeList item");throw F.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),A}if(!this._users.find((A=>A===m))){const A=new Pe(H.INVALID_REMOTE_USER,"user is not in the channel");F.error("[".concat(this._clientId,"] can not massSubscribe ").concat(m.uid,", this user is not in the channel")),s[u].error=A,e.splice(u,1);continue}if(g==="audio"&&(!m.hasAudio||m._audioSSRC===void 0)||g==="video"&&(!m.hasVideo||m._videoSSRC===void 0)){const A=new Pe(H.REMOTE_USER_IS_NOT_PUBLISHED);F.error("[".concat(this._clientId,"] can not subscribe ").concat(m.uid," with mediaType ").concat(g,", remote user is not published")),s[u].error=A,e.splice(u,1);continue}const R=dn.Video|dn.LwoVideo,I=n.get(m);if(I){if(g==="video"?I&R:I&dn.Audio){e.splice(u,1),F.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(m.uid,", mediaType:").concat(g," twice"));continue}n.set(m,I|(g==="video"?R:dn.Audio))}else n.set(m,g==="video"?R:dn.Audio)}for(let u=e.length-1;u>=0;u--){const p=e[u],{user:m,mediaType:g}=p,T=dn.Video|dn.LwoVideo;if(this._p2pChannel.hasRemoteMedia(m,g)){await this._p2pChannel.unmuteRemoteNoLock(m,g);const R=n.get(m);n.set(m,g==="video"?R^T:R^dn.Audio),e.splice(u,1)}}this.store.massSubscribe(e.map((u=>({userId:u.user.uid,type:u.mediaType}))),t);let d=Ks(c=Array.from(n.entries())).call(c,((u,p)=>{let[m,g]=p;if(g===0)return u;const T={stream_id:m.uid,stream_type:g};return g&dn.Audio&&(T.audio_ssrc=m._audioSSRC),g&dn.Video&&(T.video_ssrc=m._videoSSRC),u.push(T),u}),[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map((p=>{let{user:m,mediaType:g}=p;return{user:m,mediaType:g,ssrcId:g===dt.VIDEO?m._videoSSRC:m._audioSSRC,rtxSsrcId:g===dt.VIDEO?m._rtxSsrcId:void 0}})));const u=new Map;if(d=d.filter((p=>p.video_ssrc&&!this._p2pChannel.isPreSubScribe(p.video_ssrc)||p.audio_ssrc&&!this._p2pChannel.isPreSubScribe(p.audio_ssrc)||!p.video_ssrc&&!p.audio_ssrc)),d.length>0){const p=await this._gateway.subscribeAll(d,!0);(p?.users||[]).forEach((m=>{let{stream_id:g,video_error_code:T,audio_error_code:R,error_code:I}=m;(T||R||I)&&u.set(g,{video_error_code:T,audio_error_code:R,error_code:I})}))}if(Array.from(u.entries()).length>0){const p=[];Array.from(u.entries()).forEach((m=>{let[g,T]=m;const R=this.remoteUsers.find((I=>I.uid===g));if(R){let I;T.error_code||T.video_error_code&&T.audio_error_code?I=void 0:T.video_error_code?I=dt.VIDEO:T.audio_error_code&&(I=dt.AUDIO),p.push({user:R,mediaType:I})}})),p.length>0&&await this._p2pChannel.massUnsubscribeNoLock(p)}for(const p of s){const m=u.get(p.user.uid);if(m){const g=m.error_code||p.mediaType==="audio"&&m.audio_error_code||p.mediaType==="video"&&m.video_error_code;if(g){const T=UC(g);F.error("user:".concat(p.user.uid," mediaType:").concat(p.mediaType," has massSubscribe error ").concat(T.desc)),p.error=new Pe(H.SUBSCRIBE_FAILED,"code ".concat(g,": ").concat(T.desc))}}p.error||(p.mediaType==="video"?p.track=p.user.videoTrack:p.track=p.user.audioTrack)}return this.store.massSubscribe(s.filter((p=>!p.error)).map((p=>({userId:p.user.uid,type:p.mediaType}))),void 0,Date.now()),s.forEach((p=>{var m;fe.subscribe(this.store.sessionId,{succ:!!p.error,ec:((m=p.error)===null||m===void 0?void 0:m.code)||null,video:p.mediaType===dt.VIDEO,audio:p.mediaType===dt.AUDIO,peerid:p.user.uid,subscribeRequestid:p.mediaType===dt.VIDEO?p.user._videoSSRC:p.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(p.user._videoSSRC)},!0)})),F.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map((p=>{let{user:m,mediaType:g}=p;return"user: ".concat(m?.uid,", mediaType: ").concat(g)})).join("; "))),s}catch(u){throw await this._p2pChannel.massUnsubscribeNoLock(e),u}}finally{o(),i()}}async unsubscribe(e,t,n){if(!(e instanceof Jm)){const o=this.remoteUsers.find((c=>c.uid===e));if(!o)throw new Pe(H.INVALID_REMOTE_USER,"user is not in the channel");e=o}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,n)}else await this._unsubscribeDataChannel(e,n);if(t&&Tn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Pe(H.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find((o=>o===e))){const o=new Pe(H.INVALID_REMOTE_USER,"user is not in the channel");throw F.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),o}F.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const s=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{const o=await this._p2pChannel.unsubscribe(e,t);o&&await this._gateway.unsubscribe(o,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&Pm(this._users,e),F.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(o){if(o.code===H.DISCONNECT_P2P)return void F.warning("disconnecting p2p, abort unsubscribe request.");throw F.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),o.toString()),o}finally{s()}}async _unsubscribeDataChannel(e,t){if(t&&Mi(t,"id",0,65535,!0),!this._joinInfo)throw new Pe(H.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find((s=>s===e))){const s=new Pe(H.INVALID_REMOTE_USER,"user is not in the channel");throw F.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),s}let i;if(typeof t=="number"){const s=e._dataChannels.find((o=>o.id===t));s&&(i=[s])}else i=e._dataChannels;if(i===void 0){const s=new Pe(H.REMOTE_USER_IS_NOT_PUBLISHED);throw F.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),s}F.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(i.map((s=>s.id))));try{const s=await this._p2pChannel.unsubscribeDataChannel(e,i);s&&await this._gateway.unsubscribeDataChannel(s,e.uid),F.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(s))}catch(s){if(s.code===H.DISCONNECT_P2P)return void F.warning("disconnecting p2p, abort unsubscribe request.");throw F.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),s.toString()),s}}async massUnsubscribe(e){if(Hi(e,"unsubscribeList"),!this._joinInfo)throw new Pe(H.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");F.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map((n=>{let{user:i,mediaType:s}=n;return"user: ".concat(i?.uid,", mediaType: ").concat(s,";")})).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:i,mediaType:s}=e[n];if(!i){const d=new Pe(H.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw F.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),d}if(Tn(s,"mediaType",["video","audio",void 0]),!this._users.find((d=>d===i))){F.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),e.splice(n,1);continue}const c=dn.Video|dn.LwoVideo;if(t.has(i)){const d=t.get(i);let u;switch(s){case"video":u=d&c;break;case"audio":u=d&dn.Audio;break;default:u=d&(dn.Audio|c)}if(u){F.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(s," twice.")),e.splice(n,1);continue}s?s==="audio"?t.set(i,d|dn.Audio):s==="video"&&t.set(i,d|c):t.set(i,d|dn.Audio|c)}else s?s==="audio"?t.set(i,dn.Audio):s==="video"&&t.set(i,c):t.set(i,dn.Audio|c)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),F.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map((i=>{let{user:s,mediaType:o}=i;return"user: ".concat(s?.uid,", mediaType: ").concat(o,";")})).join()))}catch(n){if(n.code===H.DISCONNECT_P2P)return void F.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw F.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(e){(function(n){if(!n)throw new Ge(H.INVALID_PARAMS);Gr(n.width)||Eo(n.width,"streamParameter.width"),Gr(n.height)||Eo(n.height,"streamParameter.height"),Gr(n.framerate)||Eo(n.framerate,"streamParameter.framerate"),Gr(n.bitrate)||Mi(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&F.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),F.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,He.LocalVideoLowTrack)}async enableDualStream(){if(!ai().supportDualStream)throw fe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Pe(H.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Pe(H.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw fe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,fe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),F.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Pe(H.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(He.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw fe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,fe.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),F.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if((function(i){Tn(i,"role",["audience","host"])})(e),t&&jn(t),this.mode==="rtc"||this.mode==="p2p")throw F.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new Pe(H.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new Pe(H.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new Pe(H.INVALID_OPERATION,"can not set client role to audience when publishing stream");const n=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==n&&re("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",vr.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),F.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&jn(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{F.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;const n=t.timestamp-Date.now();return Math.abs(n)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(ls(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new Pe(H.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Pe(H.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,fe.setProxyServer(this._proxyServer),F.setProxyServer(this._proxyServer),F.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new Pe(H.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Pe(H.INVALID_OPERATION,"You have already set the proxy")}if(_C(e))return this._turnServer={servers:e,mode:"original-manual"},void F.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map((n=>n.urls)).join(","),"."));e.forEach((n=>wD(n))),this._turnServer={servers:e,mode:"manual"},F.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new Pe(H.INVALID_OPERATION,"you should set license before join channel");if(ls(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new Pe(H.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,F.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new Pe(H.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Pe(H.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new Pe(H.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new Pe(H.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,F.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Pe(H.INVALID_OPERATION,"Stop proxy server after leave channel");fe.setProxyServer(),F.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",F.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new Pe(H.INVALID_PARAMS,"accessPoints is required.");Hi(e.accessPoints.serverList,"accessPoints.serverList"),ls(e.accessPoints.domain,"accessPoints.domain");const t=(T,R)=>{Mi(T,R,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Pe(H.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");re("CLOSE_AFB_FOR_LOCAL_AP")&&(te("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),te("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,s=e.accessPoints.domain,o=e.accessPoints.serverList.map((T=>i.test(T)?"".concat(T.replace(/\./g,"-"),".").concat(s):T)),c=o.map((T=>"".concat(T,":").concat(n)));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,te("WEBCS_DOMAIN",c),te("WEBCS_DOMAIN_BACKUP_LIST",c),te("GATEWAY_DOMAINS",[s]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Hi(e.report.hostname,"report.hostname"),te("EVENT_REPORT_DOMAIN",e.report.hostname[0]),te("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(te("EVENT_REPORT_DOMAIN",o[0]),te("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]));let d=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),d=e.report.port),te("STATS_COLLECTOR_PORT",d),e.report?te("ENABLE_EVENT_REPORT",!0):te("ENABLE_EVENT_REPORT",!1);let u="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Hi(e.log.hostname,"log.hostname"),u=e.log.hostname[0]):u=o[0];let p=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),p=e.log.port),te("LOG_UPLOAD_SERVER","".concat(u,":").concat(p));let m=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Hi(e.cds.hostname,"cds.hostname"),m=e.cds.hostname):m=o;let g=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),g=e.cds.port),te("CDS_AP",m.map((T=>"".concat(T,":").concat(g)))),e.cds?te("ENABLE_CONFIG_DISTRIBUTE",!0):te("ENABLE_CONFIG_DISTRIBUTE",!1),F.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Hi(e,"serverList"),ls(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Pe(H.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map((i=>n.test(i)?"".concat(i.replace(/\./g,"-"),".").concat(t):i)),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,te("WEBCS_DOMAIN",e),te("WEBCS_DOMAIN_BACKUP_LIST",e),te("GATEWAY_DOMAINS",[t]),te("EVENT_REPORT_DOMAIN",e[0]),te("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),te("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),F.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(Tn(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw F.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else F.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){Tn(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout((()=>{const n=this._users.find((i=>i.uid===e));n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()}),2e3)}catch(n){throw F.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}F.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){Tn(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw F.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}F.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n,i){(function(o){Tn(o,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),ls(t,"secret");const s=["aes-128-gcm2","aes-256-gcm2"];if(Re(s).call(s,e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new Pe(H.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new Pe(H.INVALID_PARAMS,"current encrypt mode does not need salt");if(i){if(gr(i,"encryptDataStream"),!Re(s).call(s,e))throw new Pe(H.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||F.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=Mm(n))}async renewToken(e){if(ls(e,"token",1,2047),!this._key||!this._joinInfo)throw new Pe(H.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(re("USE_NEW_TOKEN")){F.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const i=await G4(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Es);F.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:i})}else F.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});F.debug("[".concat(this._clientId,"] renewToken success"))}catch(i){throw this._key=t,this._joinInfo.token=t,F.error("[".concat(this._clientId,"] renewToken failed"),i.toString()),i}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?F.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval((()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit($t.VOLUME_INDICATOR,e)}),re("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new Pe(H.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Pe(H.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new Pe(H.LIVE_STREAMING_TASK_CONFLICT);const n=t?Wm.TRANSCODE:Wm.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(Wm.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter((n=>n&&n.hasUrl(e)));if(!t.length)throw new Pe(H.INVALID_PARAMS,"can not find live streaming url to stop");await De.all(t.map((n=>n&&n.stopLiveStreamingTask(e))))}async startChannelMediaRelay(e){Xm(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){Xm(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof ia&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Pe(H.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const s=new TextEncoder;e.payload=s.encode(e.payload)}let i=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Re(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(i=!0,e.payload=await(async function(s,o,c){var d;const u=Ks(d=Array.from(c)).call(d,((A,w)=>A+w),0),p={serverTs:0,seq:l4++,length:c.length,checkSum:u},m=new Uint8Array(Tv(u,2)),g=new ArrayBuffer(yC),T=new DataView(g);T.setUint32(0,p.serverTs),T.setUint16(4,p.seq),T.setUint16(6,p.length),T.setUint16(8,p.checkSum);const R=16-c.length%16;c=Jp(c,new Uint8Array(R));const I=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:s,tagLength:a4,additionalData:m},o,c);return Jp(new Uint8Array(g),new Uint8Array(I))})(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new Pe(H.INVALID_PARAMS,i?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Yt.DATA_STREAM,{payload:Mm(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-tY},!n)}sendMetadata(e){if(!this._joinInfo)throw new Pe(H.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new Pe(H.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Yt.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Mm(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(Sz),!this._joinInfo)throw new Pe(H.INVALID_OPERATION,"can not send custom report, not joined");await fe.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(re("DELETE_NEQ_AFTER_USER_LEAVE")){const t=this._users.map((n=>n.uid+""));Object.keys(e).forEach((n=>{Re(t).call(t,n)||delete e[n]}))}return e}async pickSVCLayer(e,t){Tn(t.spatialLayer,"spatialLayer",[0,1,2,3]),Tn(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw F.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(e){const{apRTM:t=!1,rtmFlag:n}=e;if(gr(t,"apRTM"),Mi(n,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=n,F.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(F.debug("[".concat(this._clientId,"] reset client")),(function(e){const t=Rh.indexOf(e);t!==-1&&Rh.splice(t,1)})(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Gc.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&FF(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&fe.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach((e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach((t=>t._close())),e._dataChannels.length=0)})),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new ro("client-publish",this._clientId),this._subscribeMutex=new ro("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var n;const i=e||__();e?F.debug("[".concat(this._clientId,"] new Session ").concat(i)):F.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(i));const s=e?"":this._sessionId||"";this._sessionId=i,this.store.sessionId=i,fe.addSid(i);const o={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:t?.stringUid||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:s,clientRole:this.role==="audience"?2:1};fe.sessionInit(this._sessionId,Nh({cname:t.channel,appid:t.appId},o)),this._joinInfo&&(this._joinInfo.sid=i),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=i)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new Pe(H.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(H.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&re("FORCE_TURN")&&!re("TURN_ENABLE_TCP")&&!re("TURN_ENABLE_UDP"))throw new Pe(H.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");F.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const i=(await n.next()).value;if(i){try{await this._gateway.sendExtensionMessage(Mr.PUBLISH,i,!0)}catch(s){throw n.throw(s),s}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const i=(await n.next()).value;if(i){var t;let s;try{s=await this._gateway.publish(this._uid,i,!0)}catch(o){if(o.code!==H.DISCONNECT_P2P)throw n.throw(o),o}await n.next(((t=s)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const s of e)s instanceof zi&&s._encoderConfig&&this._gateway.setVideoProfile(s._encoderConfig).catch((o=>{F.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))})),!s.muted&&s.enabled||await this._p2pChannel.muteLocalTrack(s)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n?.code,e),n?.code===H.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Pe(H.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Pe(H.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));F.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),i=(await n.next()).value;if(i){var t;let s;try{s=await this._gateway.publish(this._uid,i,!0)}catch(o){if(o.code!==H.DISCONNECT_P2P)throw n.throw(o),o}n.next(((t=s)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n?.code,void 0,!0),n?.code===H.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){const t=()=>{if(!this._joinInfo||!this._appId)return new Pe(H.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(i={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},b_("LiveStreaming").create(i));var i;return n.onLiveStreamError=(s,o)=>{fe.reportApiInvoke(this._sessionId,{name:Cn.ON_LIVE_STREAM_ERROR,options:[s,o],tag:Tr.TRACER}).onSuccess(),this.safeEmit($t.LIVE_STREAMING_ERROR,s,o)},n.onLiveStreamWarning=(s,o)=>{fe.reportApiInvoke(this._sessionId,{name:Cn.ON_LIVE_STREAM_WARNING,options:[s,o],tag:Tr.TRACER}).onSuccess(),this.safeEmit($t.LIVE_STREAMING_WARNING,s,o)},n.on(Is.REQUEST_WORKER_MANAGER_LIST,((s,o,c)=>{if(!this._joinInfo)return c(new Pe(H.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(d,u,p,m){const g=re("UAP_AP").slice(0,re("AJAX_REQUEST_CONCURRENT")).map((T=>u.proxyServer?"https://".concat(u.proxyServer,"/ap/?url=").concat(T+"/api/v1?action=uap"):"https://".concat(T,"/api/v1?action=uap")));return await pF(g,d,u,p,m)})(s,this._joinInfo,this._axiosCancelSource.token,Es).then(o).catch(c)})),n};return e===Wm.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Pe(H.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:n}=this.getLocalVideoStats(),i=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:n}},b_("ChannelMediaRelay").create(e));i.on("state",(s=>{s===wa.RELAY_STATE_FAILURE&&i&&i.dispose(),this.safeEmit($t.CHANNEL_MEDIA_RELAY_STATE,s)})),i.on("event",(s=>{this.safeEmit($t.CHANNEL_MEDIA_RELAY_EVENT,s)})),this._channelMediaRelayClient=i,this._statsCollector.onStatsChanged=(s,o)=>{var c;s==="resolution"&&((c=this._channelMediaRelayClient)===null||c===void 0||c.setVideoProfile(o))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){const{added:n,deleted:i}=e,s=[];if(t){const o=[];this._users.forEach((c=>{c._dataChannels.forEach((d=>{n.every((u=>u.uid!==c._uintid||u.stream_id!==d.id))&&o.push({uid:c._uintid,stream_id:d.id,ordered:d.ordered,max_retrans_times:d.maxRetransmits,metadata:d.metadata})}))})),o.length>0&&this._handleUpdateDataChannel({added:[],deleted:o})}Array.isArray(n)&&n.length>0&&n.forEach((o=>{const{uid:c,stream_id:d,ordered:u,max_retrans_times:p,metadata:m}=o,g=this._users.find((T=>T._uintid===c));if(!g)return void F.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(F.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(c)),Re(s).call(s,g)||s.push(g),g._uintid||(g._uintid=c),g._dataChannels.findIndex((T=>T.id===o.stream_id))===-1){const T={id:d,ordered:!!u,maxRetransmits:p,metadata:m},R=(function(I){return r0(I,!0)})(T);g._dataChannels.push(R),F.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published datachannel")),t||this.safeEmit($t.USER_PUBLISHED,g,"datachannel",T)}this._p2pChannel.hasPendingRemoteDataChannel(g,o.stream_id)&&(F.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(g.uid," after reconnect.")),this._subscribeDataChannel(g,o.stream_id).catch((T=>{F.error("[".concat(this._clientId,"] resubscribe datachannel error"),T.toString())})))})),t&&(this.safeEmit($t.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach((o=>{const{uid:c,stream_id:d}=o,u=this._users.find((m=>m._uintid===c));if(!u)return void F.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const p=u._dataChannels.find((m=>m.id===o.stream_id));p&&(F.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(c)),this._p2pChannel.unsubscribeDataChannel(u,[p]).then((m=>{if(u._dataChannels=u._dataChannels.filter((g=>g!==p)),m)return this._gateway.unsubscribeDataChannel(m,u.uid)})),F.info("[".concat(this._clientId,"] remote user ").concat(c," unpublished datachannel ,id:").concat(p.id)),this.safeEmit($t.USER_UNPUBLISHED,u,"datachannel",p._config))}))}_getEncodingName(e){var t;if(!this._joinResponse)return;const n=(t=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||t===void 0?void 0:t.videoCodecs;if(n)for(const s of n){var i;if(s.payloadType===e)return s==null||(i=s.rtpMap)===null||i===void 0?void 0:i.encodingName}}_handleRemoveDataChannels(e){const t=this._users.find((n=>n.uid===e.uid));if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){F.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const n=()=>{F.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach((i=>{this.safeEmit($t.USER_UNPUBLISHED,t,"datachannel",i._config)}))};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then((i=>{if(i)return this._gateway.unsubscribeDataChannel(i,t.uid)})),n()}}else F.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Qs.UPDATE_GATEWAY_CONFIG,(()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void F.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Object.keys(t).forEach((i=>{const{value:s,type:o,expires:c}=t[i];c&&c<=n||o||jV()||!Object.prototype.hasOwnProperty.call(TC,i)||(zt[i]=s,en[i]=s,F.debug("Update gateway parameters from config distribute",i,s))}))}catch(t){F.error("Error update config from local cache",t.message)}})()})),this._gateway.on(Qs.DISCONNECT_P2P,(async()=>{await this._p2pChannel.disconnectForReconnect()})),this._gateway.on(Qs.CONNECTION_STATE_CHANGE,((e,t,n)=>{var i;if(n===Ti.FALLBACK)return;const s=()=>{this.safeEmit($t.CONNECTION_STATE_CHANGE,e,t,n)};if(fe.reportApiInvoke(this._sessionId||((i=this._gateway.joinInfo)===null||i===void 0?void 0:i.sid)||null,{name:Cn.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:Tr.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),F.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void s();if(e==="RECONNECTING")this._users.forEach((c=>{c._trust_in_room_=!1,c._trust_audio_enabled_state_=!1,c._trust_video_enabled_state_=!1,c._trust_audio_mute_state_=!1,c._trust_video_mute_state_=!1,c._trust_audio_stream_added_state_=!1,c._trust_video_stream_added_state_=!1,c._is_pre_created||(c._audio_pre_subscribed||(c._audioSSRC=void 0,c._audioOrtc=void 0),c._video_pre_subscribed||(c._videoSSRC=void 0,c._videoOrtc=void 0,c._rtxSsrcId=void 0),c._cname=void 0)})),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var o;this._streamFallbackTypeCacheMap.forEach(((c,d)=>{this._gateway.setStreamFallbackOption(d,c).catch((u=>{F.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),u)}))})),this._remoteStreamTypeCacheMap.forEach(((c,d)=>{this._gateway.setRemoteVideoStreamType(d,c).catch((u=>{F.warning("[".concat(this._clientId,"] auto set remote stream type failed"),u)}))})),this._remoteDefaultVideoStreamType!==void 0&&((o=this._joinInfo)===null||o===void 0?void 0:o.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then((()=>{F.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))})).catch((c=>{F.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(c))})),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout((()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter((c=>!c._trust_in_room_)).forEach((c=>{F.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(c.uid)),this._handleUserOffline({uid:c.uid})})))}),3e3),this._streamRemovedTimeout=window.setTimeout((()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach((c=>{c._trust_audio_mute_state_||(F.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,dt.AUDIO,!1)),c._trust_video_mute_state_||(F.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(c.uid)),this._handleMuteStream(c.uid,dt.VIDEO,!1)),c._trust_audio_enabled_state_||(F.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(c.uid)),this._handleSetStreamLocalEnable("audio",c.uid,!0)),c._trust_video_enabled_state_||(F.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(c.uid)),this._handleSetStreamLocalEnable("video",c.uid,!0)),c._trust_video_stream_added_state_||(F.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(c.uid)),this._handleResetAddStream(c,"video")),c._trust_audio_stream_added_state_||(F.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(c.uid)),this._handleResetAddStream(c,"audio")),c._video_added_||c._audio_added_||(F.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(c.uid)),this._handleRemoveStream({uid:c.uid,uint_id:c._uintid}))})))}),1e3))}s()})),this._gateway.on(Qs.REQUEST_NEW_GATEWAY_LIST,(async(e,t)=>{if(!this._joinInfo)return t(new Pe(H.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const i=await VF(Nh(Nh({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));i?(n=i.ap,BF(i),this._joinInfo.preload=!0):(n=await EP(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Es,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const s=[];n.gatewayInfo.gatewayAddrs.forEach((o=>{let{address:c}=o;const[d,u]=c.split(":");this._joinInfo&&this._joinInfo.proxyServer?s.push({proxy:this._joinInfo.proxyServer,host:d,port:u}):s.push({host:d,port:u})})),e(s)}catch(n){t(n)}})),this._gateway.on(Qs.NETWORK_QUALITY,(e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit($t.NETWORK_QUALITY,e)})),this._gateway.on(Qs.STREAM_TYPE_CHANGE,((e,t)=>{this.safeEmit($t.STREAM_TYPE_CHANGED,e,t),fe.reportApiInvoke(this._sessionId,{name:Cn.STREAM_TYPE_CHANGE,options:[e,t],tag:Tr.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))})),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(Qs.IS_P2P_DISCONNECTED,(e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)})),this._gateway.on(Qs.REQUEST_P2P_CONNECTION_PARAMS,(async(e,t,n)=>{try{let i=await this._p2pChannel.getEstablishParams();i&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(i=await this._p2pChannel.startP2PConnection(e)),t(i)}catch(i){n(i)}})),this._gateway.on(Qs.JOIN_RESPONSE,((e,t)=>{if(this.store.useP2P)return;let n;this._joinResponse=e,e.attributes?n=e.attributes.userAttributes.preSubSsrcs:F.debug("no attributes in joinResponse");const i=iF(e.ortc,t,n);this._p2pChannel.connect(i)})),this._gateway.on(Qs.PRE_CONNECT_PC,(async e=>{const{candidates:t,fingerprint:n,turnServer:i}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){const{cert:o,cid:c}=this._joinInfo.apResponse,d="".concat(c,"_").concat(o);if(d.length<4||d.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:i,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var s;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(c,"_").concat(o),icePwd:"".concat(c,"_").concat(o)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(s=re("FINGERPRINT"))!==null&&s!==void 0?s:n}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(u){u.code&&u.code===H.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:i,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}}))}_handleGatewaySignalEvents(){this._gateway.signal.on(an.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(an.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(an.ON_ADD_AUDIO_STREAM,(e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc))),this._gateway.signal.on(an.ON_ADD_VIDEO_STREAM,(e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId))),this._gateway.signal.on(an.ON_REMOTE_DATASTREAM_UPDATE,(e=>{this._handleUpdateDataChannel(e)})),this._gateway.signal.on(an.ON_REMOTE_FULL_DATASTREAM_INFO,(e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)})),this._gateway.signal.on(an.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(an.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(an.MUTE_AUDIO,(e=>this._handleMuteStream(e.uid,dt.AUDIO,!0))),this._gateway.signal.on(an.UNMUTE_AUDIO,(e=>this._handleMuteStream(e.uid,dt.AUDIO,!1))),this._gateway.signal.on(an.MUTE_VIDEO,(e=>this._handleMuteStream(e.uid,dt.VIDEO,!0))),this._gateway.signal.on(an.UNMUTE_VIDEO,(e=>this._handleMuteStream(e.uid,dt.VIDEO,!1))),this._gateway.signal.on(an.RECEIVE_METADATA,(e=>{const t=bd(e.metadata);this.safeEmit($t.RECEIVE_METADATA,e.uid,t)})),this._gateway.signal.on(an.ON_DATA_STREAM,(async e=>{var t;if(!e)return;let n=bd(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Re(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<yC)throw new Pe(H.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(yC));n=await(async function(o,c,d){const u=d.subarray(0,yC),p=u.slice(8,yC),m=(p[0]<<8)+p[1],g=(u[6]<<8)+u[7],T=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:o,tagLength:a4,additionalData:new Uint8Array(Tv(m,2))},c,d.subarray(yC));return new Uint8Array(T).subarray(0,g)})(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let i=0;if(e.ordered||e.syncWithAudio){const s=this._p2pChannel.getStats(),o=this.remoteUsers.find((d=>d.uid===e.uid)),c=s?.audioRecv.find((d=>d.ssrc===o?._audioSSRC));i=c?.jitterBufferMs}(i==null||Number.isNaN(i))&&(i=0),nY(Nh(Nh({},e),{},{payload:n}),i,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})})),this._gateway.signal.on(an.ON_CRYPT_ERROR,(()=>{Cd((()=>{F.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit($t.CRYPT_ERROR)}),this._sessionId)})),this._gateway.signal.on(an.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(an.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{F.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Ti.TOKEN_EXPIRE),this.safeEmit($t.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()})),this._gateway.signal.on(an.ON_STREAM_FALLBACK_UPDATE,(e=>{F.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit($t.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")})),this._gateway.signal.on(an.ON_PUBLISH_STREAM,(e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),F.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))})),this._gateway.signal.on(an.ENABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)})),this._gateway.signal.on(an.DISABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)})),this._gateway.signal.on(st.REQUEST_TIMEOUT,((e,t)=>{if(this._joinInfo)switch(e){case Yt.PUBLISH:{if(!t)return;const s=t.ortc;if(s){var n,i;const o=s.some((u=>{let{stream_type:p}=u;return p===gn.Audio})),c=s.some((u=>{let{stream_type:p}=u;return p!==gn.Audio})),d=s.some((u=>{let{stream_type:p}=u;return p===gn.Screen||p===gn.ScreenLow}));t.state==="offer"&&fe.publish(this._joinInfo.sid,{eventElapse:ma.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:H.TIMEOUT,audio:o,video:c,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:d,audioName:o?(n=s.find((u=>{let{stream_type:p}=u;return p===gn.Audio})))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:c?(i=s.find((u=>{let{stream_type:p}=u;return p!==gn.Audio})))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0})}break}case Yt.SUBSCRIBE:t&&fe.subscribe(this._joinInfo.sid,{succ:!1,ec:H.TIMEOUT,audio:t.stream_type===dt.AUDIO,video:t.stream_type===dt.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:ma.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}})),this._gateway.signal.on(an.ON_P2P_OK,(e=>{this.uid,this._uid})),this._gateway.signal.on(an.ON_PUBLISHED_USER_LIST,(e=>{if(e==null||!e.users)return;re("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter((i=>!Gm(i.string_id||i.stream_id,this.channelName))));const t=[],n=[];for(const i of e.users){let s=this._users.find((m=>m._uintid===i.stream_id));s?s._trust_in_room_=!0:(s=new Jm(i.string_id||i.stream_id,i.stream_id),this._users.push(s),this.store.firstVideoFrameDecoded(s.uid,{userJoinNotify:Date.now()}),this.getListeners($t.PUBLISHED_USER_LIST).length===0&&(F.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit($t.USER_JOINED,s)));const o=dn.Audio&i.stream_type,c=(dn.Video|dn.LwoVideo)&i.stream_type,d=(65280&i.stream_type)!=0,u=o&&s.hasAudio,p=c&&s.hasVideo;c&&(s._trust_video_stream_added_state_=!0,s._video_added_=!0,s._videoSSRC=i.video_ssrc,s._rtxSsrcId=i.video_rtx),o&&(s._trust_audio_stream_added_state_=!0,s._audio_added_=!0,s._audioSSRC=i.audio_ssrc),o&&!u&&this.getListeners($t.PUBLISHED_USER_LIST).length===0&&(F.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published audio")),this.safeEmit($t.USER_PUBLISHED,s,"audio")),c&&!p&&this.getListeners($t.PUBLISHED_USER_LIST).length===0&&(F.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published video")),this.safeEmit($t.USER_PUBLISHED,s,"video")),(o&&!u||c&&!p||d)&&t.push(s),c&&this._p2pChannel.hasPendingRemoteMedia(s,"video")&&n.push({user:s,mediaType:"video"}),o&&this._p2pChannel.hasPendingRemoteMedia(s,"audio")&&n.push({user:s,mediaType:"audio"})}n.length>0&&(F.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map((i=>"user: ".concat(i.user.uid,", mediaType: ").concat(i.mediaType))).join("; ")," ")),this.massSubscribe(n).catch((i=>{F.error("[".concat(this._clientId,"] mass resubscribe error"),i.toString())}))),this.getListeners($t.PUBLISHED_USER_LIST).length>0?re("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(F.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map((i=>i.uid)).join(", "))),this.safeEmit($t.PUBLISHED_USER_LIST,t)):F.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map((i=>i.uid)).join(", ")))})),this._gateway.signal.on(an.ON_RTP_CAPABILITY_CHANGE,(e=>{const{video_codec:t}=e;this._p2pChannel instanceof ia&&this._p2pChannel.updateRemoteRTPCapabilities(t.map((n=>n.toLowerCase())).filter((n=>{var i;return Re(i=Object.keys(vC)).call(i,n)})))}))}_handleP2PEvents(){this._gateway.signal.on(an.ON_USER_OFFLINE,(()=>{this._p2pChannel.disconnectForReconnect()})),this._gateway.signal.on(Mr.PUBLISH,((e,t,n)=>{const{uid:i}=e;e.forEach((s=>{const{kind:o,ssrcs:c,mid:d,isMuted:u}=s;this._handleP2PAddAudioOrVideoStream(o,i,c[0].ssrcId,d);const p=this._users.find((m=>m.uid===i));return p&&this.store.useP2P?this._p2pChannel.mockSubscribe(p,o,c[0].ssrcId,d).then((()=>{t()})).catch(n):t(),this._handleMuteStream(i,o,!!u)}))})),this._gateway.signal.on(Mr.CALL,(async(e,t,n)=>{if(this.store.useP2P)try{var i;t(await this._p2pChannel.startP2P({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer},e))}catch(s){n(s)}})),this._gateway.signal.on(st.P2P_CONNECTION,(async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)})),this._gateway.signal.on(Mr.UNPUBLISH,(async(e,t,n)=>{if(this.store.useP2P){const{unpubMsg:i,uid:s}=e,o=this._users.find((c=>c.uid===s));if(!o)return F.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(s)),void t();try{i.forEach((async c=>{let{stream_type:d}=c;const u=d===gn.Audio?dt.AUDIO:dt.VIDEO;await this._p2pChannel.unsubscribe(o,u),this._handleMuteStream(s,u,!0)})),t()}catch(c){n(c)}}})),this._gateway.signal.on(Mr.CONTROL,(async(e,t)=>{const{action:n}=e;switch(n){case Jg.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,dt.VIDEO,!0);break;case Jg.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,dt.AUDIO,!0);break;case Jg.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,dt.VIDEO,!1);break;case Jg.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,dt.AUDIO,!1)}})),this._gateway.signal.on(Mr.RESTART_ICE,(async(e,t,n)=>{if(this.store.useP2P)try{const{direction:i,iceParameter:s}=e;i!==Wt.SEND_ONLY||s?t(await this._p2pChannel.restartICE(i,s)):(this._p2pChannel.handleDisconnect(i),t())}catch(i){n(i)}})),this._gateway.signal.on(Mr.CANDIDATE,(e=>{if(this.store.useP2P){const{candidate:t,direction:n}=e;this._p2pChannel.addRemoteCandidate(t,n)}})),this._p2pChannel.on(kt.RequestP2PRestartICE,(async(e,t,n)=>{try{const{direction:i}=e;t(await this._gateway.sendExtensionMessage(Mr.RESTART_ICE,e,i===Wt.SEND_ONLY))}catch(i){n(i)}})),this._p2pChannel.on(kt.LocalCandidate,(e=>{this._gateway.sendExtensionMessage(Mr.CANDIDATE,JSON.stringify(e),!0)})),this._p2pChannel.on(kt.RequestP2PMuteLocal,(async(e,t,n)=>{try{await this._gateway.sendExtensionMessage(Mr.CONTROL,e,!0),t()}catch(i){n(i)}})),this._p2pChannel.on(kt.RequestP2PUnmuteRemote,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===H.DISCONNECT_P2P?t():n(i)}else t()})),this._p2pChannel.on(kt.RequestP2PMuteRemote,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===H.DISCONNECT_P2P?t():n(i)}else t()})),this._p2pChannel.on(kt.StateChange,((e,t)=>{t===ut.Connected&&this._p2pChannel.republish()}))}_handleP2PChannelEvents(){this._p2pChannel.on(kt.PeerConnectionStateChange,(e=>{const t=this._peerConnectionState;e!==t&&(this.safeEmit($t.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)})),this._p2pChannel.on(kt.RequestMuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===H.DISCONNECT_P2P?t():n(i)}else t()})),this._p2pChannel.on(kt.RequestUnmuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(i){i.code===H.DISCONNECT_P2P?t():n(i)}else t()})),this._p2pChannel.on(kt.RequestRePublish,((e,t,n)=>{this.publish(e,!1).then(t).catch(n)})),this._p2pChannel.on(kt.RequestRePublishDataChannel,((e,t,n)=>{De.all(e.map((async i=>{const s=await this._p2pChannel.publishDataChannel([i]);try{s.forEach((o=>{this._uid&&this._gateway.publishDataChannel(this._uid,o,!0)}))}catch(o){if(o.code!==H.DISCONNECT_P2P)throw o}}))).then(t).catch(n)})),this._p2pChannel.on(kt.RequestReSubscribe,(async(e,t,n)=>{try{for(const{user:i,kind:s}of e)s===dt.VIDEO?await this.subscribe(i,"video"):await this.subscribe(i,"audio");t()}catch(i){n(i)}})),this._p2pChannel.on(kt.RequestUpload,((e,t)=>{this._gateway.upload(e,t)})),this._p2pChannel.on(kt.RequestUploadStats,(e=>{this._gateway.uploadWRTCStats(e)})),this._p2pChannel.on(kt.MediaReconnectStart,(e=>{this.safeEmit($t.MEDIA_RECONNECT_START,e)})),this._p2pChannel.on(kt.MediaReconnectEnd,(e=>{this.safeEmit($t.MEDIA_RECONNECT_END,e)})),this._p2pChannel.on(kt.NeedSignalRTT,(e=>{e(this._gateway.getSignalRTT())})),this._p2pChannel.on(kt.RequestRestartICE,(async e=>{if(this.store.useP2P)return;const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const i=n.value;let s;try{s=await this._gateway.restartICE({iceParameters:i})}catch(c){return void t.throw(c)}const{iceParameters:o}=(function(c){const d=c.iceParameters;return{iceParameters:{iceUfrag:d.iceUfrag,icePwd:d.icePwd}}})(s);await t.next({remoteIceParameters:o})})),this._p2pChannel.on(kt.RequestReconnect,(async()=>{this._gateway.reconnect()})),this._p2pChannel.on(kt.RequestReconnectPC,(async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:s,gatewayAddress:o}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:i}),c=iF(s,o);await this._p2pChannel.connect(c),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()})),this._p2pChannel.on(kt.RequestUnpublishForReconnectPC,(async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()})),this._p2pChannel.on(kt.P2PLost,(()=>{this.safeEmit($t.P2P_LOST,this.store.uid)})),this._p2pChannel.on(kt.UpdateVideoEncoder,(e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)})),this._p2pChannel.on(kt.ConnectionTypeChange,(e=>{this.safeEmit($t.IS_USING_CLOUD_PROXY,e)})),this._p2pChannel.on(kt.RequestLowStreamParameter,(e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})})),this._p2pChannel.on(kt.QueryClientConnectionState,(e=>{e(this.connectionState)})),this._p2pChannel.on(kt.AudioMetadata,(e=>{this.safeEmit($t.AUDIO_METADATA,e)})),this._p2pChannel.on(kt.AudioPts,(e=>{this.safeEmit($t.AUDIO_PTS,Number(e))}))}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new Pe(H.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new Pe(H.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(t={config:e},b_("ContentInspect").create(t));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:i,cname:s,sid:o,token:c,uid:d,cid:u,vid:p}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:s,sid:o,token:c,uid:d,cid:u,vid:p?Number(p):0},Es)}catch(n){throw Array.isArray(n)?n[0]:n}var t}handleVideoInspectEvents(e){e.on(So.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.safeEmit($t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===$o.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit($t.CONTENT_INSPECT_ERROR,new Pe(H.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}})),e.on(So.INSPECT_RESULT,((t,n)=>{var i;if(n?.code===H.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return F.debug("Stop inspect content because that has left channel"),this==null||(i=this._inspect)===null||i===void 0||i.close(),void(this._inspect=void 0);this.safeEmit($t.CONTENT_INSPECT_RESULT,t,n)})),e.on(So.CLIENT_LOCAL_VIDEO_TRACK,(t=>{t(this.localTracks.filter((n=>n.trackMediaType==="video"))[0])}))}async disableContentInspect(){if(!this._inspect)throw new Pe(H.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(gr(e,"enabled"),e){if(!t)throw new Pe(H.INVALID_PARAMS,"config is required");if(Z4(t),!this._joinInfo)throw new Pe(H.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{const i=(n={config:t},b_("ImageModeration").create(n));this._moderation=i,this.handleImageModerationEvents(i);const{appId:s,cname:o,sid:c,token:d,uid:u,cid:p,vid:m}=this._joinInfo;await i.init({appId:s,areaCode:"",cname:o,sid:c,token:d,uid:u,cid:p,vid:m?Number(m):0},Es)}}catch(i){throw Array.isArray(i)?i[0]:i}}else{var n;if(!this._moderation)throw new Pe(H.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}}handleImageModerationEvents(e){e.on(gl.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.safeEmit($t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===ea.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new Pe(H.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}})),e.on(gl.CLIENT_LOCAL_VIDEO_TRACK,(t=>{t(this.localTracks.filter((n=>n.trackMediaType==="video"))[0])}))}setP2PTransport(e){if((function(t){Tn(t,"transport",["default","auto","relay","sd-rtn"])})(e),this.mode!=="p2p")throw new Pe(H.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,F.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return F.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){gr(e,"enabled"),te("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},At(Tt.prototype,"leave",[qF],Object.getOwnPropertyDescriptor(Tt.prototype,"leave"),Tt.prototype),At(Tt.prototype,"publish",[XF],Object.getOwnPropertyDescriptor(Tt.prototype,"publish"),Tt.prototype),At(Tt.prototype,"unpublish",[JF],Object.getOwnPropertyDescriptor(Tt.prototype,"unpublish"),Tt.prototype),At(Tt.prototype,"subscribe",[QF],Object.getOwnPropertyDescriptor(Tt.prototype,"subscribe"),Tt.prototype),At(Tt.prototype,"presubscribe",[ZF],Object.getOwnPropertyDescriptor(Tt.prototype,"presubscribe"),Tt.prototype),At(Tt.prototype,"massSubscribe",[$F],Object.getOwnPropertyDescriptor(Tt.prototype,"massSubscribe"),Tt.prototype),At(Tt.prototype,"unsubscribe",[eB],Object.getOwnPropertyDescriptor(Tt.prototype,"unsubscribe"),Tt.prototype),At(Tt.prototype,"massUnsubscribe",[tB],Object.getOwnPropertyDescriptor(Tt.prototype,"massUnsubscribe"),Tt.prototype),At(Tt.prototype,"setLowStreamParameter",[nB],Object.getOwnPropertyDescriptor(Tt.prototype,"setLowStreamParameter"),Tt.prototype),At(Tt.prototype,"enableDualStream",[iB],Object.getOwnPropertyDescriptor(Tt.prototype,"enableDualStream"),Tt.prototype),At(Tt.prototype,"disableDualStream",[rB],Object.getOwnPropertyDescriptor(Tt.prototype,"disableDualStream"),Tt.prototype),At(Tt.prototype,"setClientRole",[sB],Object.getOwnPropertyDescriptor(Tt.prototype,"setClientRole"),Tt.prototype),At(Tt.prototype,"_setClientRoleOptions",[oB],Object.getOwnPropertyDescriptor(Tt.prototype,"_setClientRoleOptions"),Tt.prototype),At(Tt.prototype,"setProxyServer",[aB],Object.getOwnPropertyDescriptor(Tt.prototype,"setProxyServer"),Tt.prototype),At(Tt.prototype,"setTurnServer",[cB],Object.getOwnPropertyDescriptor(Tt.prototype,"setTurnServer"),Tt.prototype),At(Tt.prototype,"setLicense",[lB],Object.getOwnPropertyDescriptor(Tt.prototype,"setLicense"),Tt.prototype),At(Tt.prototype,"startProxyServer",[dB],Object.getOwnPropertyDescriptor(Tt.prototype,"startProxyServer"),Tt.prototype),At(Tt.prototype,"stopProxyServer",[uB],Object.getOwnPropertyDescriptor(Tt.prototype,"stopProxyServer"),Tt.prototype),At(Tt.prototype,"setLocalAccessPointsV2",[hB],Object.getOwnPropertyDescriptor(Tt.prototype,"setLocalAccessPointsV2"),Tt.prototype),At(Tt.prototype,"setLocalAccessPoints",[pB],Object.getOwnPropertyDescriptor(Tt.prototype,"setLocalAccessPoints"),Tt.prototype),At(Tt.prototype,"setRemoteDefaultVideoStreamType",[fB],Object.getOwnPropertyDescriptor(Tt.prototype,"setRemoteDefaultVideoStreamType"),Tt.prototype),At(Tt.prototype,"setRemoteVideoStreamType",[_B],Object.getOwnPropertyDescriptor(Tt.prototype,"setRemoteVideoStreamType"),Tt.prototype),At(Tt.prototype,"setStreamFallbackOption",[mB],Object.getOwnPropertyDescriptor(Tt.prototype,"setStreamFallbackOption"),Tt.prototype),At(Tt.prototype,"setEncryptionConfig",[EB],Object.getOwnPropertyDescriptor(Tt.prototype,"setEncryptionConfig"),Tt.prototype),At(Tt.prototype,"renewToken",[gB],Object.getOwnPropertyDescriptor(Tt.prototype,"renewToken"),Tt.prototype),At(Tt.prototype,"enableAudioVolumeIndicator",[SB],Object.getOwnPropertyDescriptor(Tt.prototype,"enableAudioVolumeIndicator"),Tt.prototype),At(Tt.prototype,"startLiveStreaming",[TB],Object.getOwnPropertyDescriptor(Tt.prototype,"startLiveStreaming"),Tt.prototype),At(Tt.prototype,"setLiveTranscoding",[vB],Object.getOwnPropertyDescriptor(Tt.prototype,"setLiveTranscoding"),Tt.prototype),At(Tt.prototype,"stopLiveStreaming",[yB],Object.getOwnPropertyDescriptor(Tt.prototype,"stopLiveStreaming"),Tt.prototype),At(Tt.prototype,"startChannelMediaRelay",[RB],Object.getOwnPropertyDescriptor(Tt.prototype,"startChannelMediaRelay"),Tt.prototype),At(Tt.prototype,"updateChannelMediaRelay",[CB],Object.getOwnPropertyDescriptor(Tt.prototype,"updateChannelMediaRelay"),Tt.prototype),At(Tt.prototype,"stopChannelMediaRelay",[bB],Object.getOwnPropertyDescriptor(Tt.prototype,"stopChannelMediaRelay"),Tt.prototype),At(Tt.prototype,"sendCustomReportMessage",[IB],Object.getOwnPropertyDescriptor(Tt.prototype,"sendCustomReportMessage"),Tt.prototype),At(Tt.prototype,"pickSVCLayer",[AB],Object.getOwnPropertyDescriptor(Tt.prototype,"pickSVCLayer"),Tt.prototype),At(Tt.prototype,"setRTMConfig",[wB],Object.getOwnPropertyDescriptor(Tt.prototype,"setRTMConfig"),Tt.prototype),At(Tt.prototype,"enableContentInspect",[OB],Object.getOwnPropertyDescriptor(Tt.prototype,"enableContentInspect"),Tt.prototype),At(Tt.prototype,"disableContentInspect",[NB],Object.getOwnPropertyDescriptor(Tt.prototype,"disableContentInspect"),Tt.prototype),At(Tt.prototype,"setImageModeration",[DB],Object.getOwnPropertyDescriptor(Tt.prototype,"setImageModeration"),Tt.prototype),At(Tt.prototype,"setP2PTransport",[PB],Object.getOwnPropertyDescriptor(Tt.prototype,"setP2PTransport"),Tt.prototype),At(Tt.prototype,"getJoinChannelServiceRecords",[kB],Object.getOwnPropertyDescriptor(Tt.prototype,"getJoinChannelServiceRecords"),Tt.prototype),At(Tt.prototype,"setPublishAudioFilterEnabled",[St],Object.getOwnPropertyDescriptor(Tt.prototype,"setPublishAudioFilterEnabled"),Tt.prototype),Tt);class ab{constructor(t,n){Q(this,"id",0),Q(this,"element",void 0),Q(this,"peerPair",void 0),Q(this,"context",void 0),Q(this,"audioPlayerElement",void 0),Q(this,"audioTrack",void 0),ab.count+=1,this.id=ab.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(i,s)=>{const o=s==="offer"?await i.createOffer():await i.createAnswer();return await i.setLocalDescription(o),i.iceGatheringState==="complete"?i.localDescription:new De((c=>{i.onicegatheringstatechange=()=>{i.iceGatheringState==="complete"&&c(i.localDescription)}}))},n=async(i,s)=>await i.setRemoteDescription(s);try{const i=await t(this.peerPair[0],"offer");await n(this.peerPair[1],i);const s=await t(this.peerPair[1],"answer");await n(this.peerPair[0],s)}catch(i){throw new Pe(H.LOCAL_AEC_ERROR,i.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(s){throw new Pe(H.LOCAL_AEC_ERROR,s.toString()).print()}if(!n)throw new Pe(H.LOCAL_AEC_ERROR,"no dest node when local aec").print();const i=n.stream.getAudioTracks()[0];return this.audioTrack=i,i}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){F.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach((t=>{t.close()})),this.peerPair=void 0,this.audioPlayerElement=void 0}}var S0,MP;Q(ab,"count",0);const cY=window.AudioContext||window.webkitAudioContext,e6=new(S0=Ye({report:fe}),At((MP=class{constructor(){Q(this,"units",[]),Q(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return F.debug("the system does not need to process local aec"),-1;this.context||(this.context=new cY);let t=this.units.find((n=>n&&n.getElement()===e));return t||(t=new ab(e,this.context),this.units.push(t)),t.startEchoCancellation(),F.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return $n().name!==mi.SAFARI}}).prototype,"processExternalMediaAEC",[S0],Object.getOwnPropertyDescriptor(MP.prototype,"processExternalMediaAEC"),MP.prototype),MP);function LB(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function UP(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?LB(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):LB(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}const xP=window||document;function t6(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!xP)return;const n=r._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const i=s=>{if(!(s&&s.blockedURI&&(r.onSecurityPolicyViolation||r.getListeners(fa.SECURITY_POLICY_VIOLATION).length>0)))return;const o=s.blockedURI;re("CSP_DETECTED_HOSTNAME_LIST").some((c=>Re(o).call(o,c)))&&(r.onSecurityPolicyViolation&&typeof r.onSecurityPolicyViolation=="function"&&r.onSecurityPolicyViolation(s),r.getListeners(fa.SECURITY_POLICY_VIOLATION).length>0&&r.safeEmit(fa.SECURITY_POLICY_VIOLATION,s))};n&&xP.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||r.getListeners(fa.SECURITY_POLICY_VIOLATION).length>0)&&xP.addEventListener("securitypolicyviolation",i),r._cspEventHandlerPointer=i}var lY=ee,n6=O5,i6=RegExp.prototype,dc=function(e){return e===i6||lY(i6,e)?n6(e):e.flags},Mo=S(dc);function nS(e){let t=e.length;for(;--t>=0;)e[t]=0}const VP=256,cb=286,nE=30,Mv=15,lb=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),FP=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),r6=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),D_=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Nu=new Array(576);nS(Nu);const iE=new Array(60);nS(iE);const rE=new Array(512);nS(rE);const Uv=new Array(256);nS(Uv);const db=new Array(29);nS(db);const ub=new Array(nE);function BP(e,t,n,i,s){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=s,this.has_stree=e&&e.length}let MB,UB,jP;function GP(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}nS(ub);const hb=e=>e<256?rE[e]:rE[256+(e>>>7)],Rc=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},ra=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,Rc(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},hf=(e,t,n)=>{ra(e,n[2*t],n[2*t+1])},xB=(e,t)=>{let n=0;do n|=1&e,e>>>=1,n<<=1;while(--t>0);return n>>>1},VB=(e,t,n)=>{const i=new Array(16);let s,o,c=0;for(s=1;s<=Mv;s++)c=c+n[s-1]<<1,i[s]=c;for(o=0;o<=t;o++){let d=e[2*o+1];d!==0&&(e[2*o]=xB(i[d]++,d))}},FB=e=>{let t;for(t=0;t<cb;t++)e.dyn_ltree[2*t]=0;for(t=0;t<nE;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},BB=e=>{e.bi_valid>8?Rc(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},WP=(e,t,n,i)=>{const s=2*t,o=2*n;return e[s]<e[o]||e[s]===e[o]&&i[t]<=i[n]},HP=(e,t,n)=>{const i=e.heap[n];let s=n<<1;for(;s<=e.heap_len&&(s<e.heap_len&&WP(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!WP(t,i,e.heap[s],e.depth));)e.heap[n]=e.heap[s],n=s,s<<=1;e.heap[n]=i},KP=(e,t,n)=>{let i,s,o,c,d=0;if(e.sym_next!==0)do i=255&e.pending_buf[e.sym_buf+d++],i+=(255&e.pending_buf[e.sym_buf+d++])<<8,s=e.pending_buf[e.sym_buf+d++],i===0?hf(e,s,t):(o=Uv[s],hf(e,o+VP+1,t),c=lb[o],c!==0&&(s-=db[o],ra(e,s,c)),i--,o=hb(i),hf(e,o,n),c=FP[o],c!==0&&(i-=ub[o],ra(e,i,c)));while(d<e.sym_next);hf(e,256,t)},zP=(e,t)=>{const n=t.dyn_tree,i=t.stat_desc.static_tree,s=t.stat_desc.has_stree,o=t.stat_desc.elems;let c,d,u,p=-1;for(e.heap_len=0,e.heap_max=573,c=0;c<o;c++)n[2*c]!==0?(e.heap[++e.heap_len]=p=c,e.depth[c]=0):n[2*c+1]=0;for(;e.heap_len<2;)u=e.heap[++e.heap_len]=p<2?++p:0,n[2*u]=1,e.depth[u]=0,e.opt_len--,s&&(e.static_len-=i[2*u+1]);for(t.max_code=p,c=e.heap_len>>1;c>=1;c--)HP(e,n,c);u=o;do c=e.heap[1],e.heap[1]=e.heap[e.heap_len--],HP(e,n,1),d=e.heap[1],e.heap[--e.heap_max]=c,e.heap[--e.heap_max]=d,n[2*u]=n[2*c]+n[2*d],e.depth[u]=(e.depth[c]>=e.depth[d]?e.depth[c]:e.depth[d])+1,n[2*c+1]=n[2*d+1]=u,e.heap[1]=u++,HP(e,n,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((m,g)=>{const T=g.dyn_tree,R=g.max_code,I=g.stat_desc.static_tree,A=g.stat_desc.has_stree,w=g.stat_desc.extra_bits,k=g.stat_desc.extra_base,L=g.stat_desc.max_length;let j,K,W,Y,se,de,ge=0;for(Y=0;Y<=Mv;Y++)m.bl_count[Y]=0;for(T[2*m.heap[m.heap_max]+1]=0,j=m.heap_max+1;j<573;j++)K=m.heap[j],Y=T[2*T[2*K+1]+1]+1,Y>L&&(Y=L,ge++),T[2*K+1]=Y,K>R||(m.bl_count[Y]++,se=0,K>=k&&(se=w[K-k]),de=T[2*K],m.opt_len+=de*(Y+se),A&&(m.static_len+=de*(I[2*K+1]+se)));if(ge!==0){do{for(Y=L-1;m.bl_count[Y]===0;)Y--;m.bl_count[Y]--,m.bl_count[Y+1]+=2,m.bl_count[L]--,ge-=2}while(ge>0);for(Y=L;Y!==0;Y--)for(K=m.bl_count[Y];K!==0;)W=m.heap[--j],W>R||(T[2*W+1]!==Y&&(m.opt_len+=(Y-T[2*W+1])*T[2*W],T[2*W+1]=Y),K--)}})(e,t),VB(n,p,e.bl_count)},jB=(e,t,n)=>{let i,s,o=-1,c=t[1],d=0,u=7,p=4;for(c===0&&(u=138,p=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)s=c,c=t[2*(i+1)+1],++d<u&&s===c||(d<p?e.bl_tree[2*s]+=d:s!==0?(s!==o&&e.bl_tree[2*s]++,e.bl_tree[32]++):d<=10?e.bl_tree[34]++:e.bl_tree[36]++,d=0,o=s,c===0?(u=138,p=3):s===c?(u=6,p=3):(u=7,p=4))},GB=(e,t,n)=>{let i,s,o=-1,c=t[1],d=0,u=7,p=4;for(c===0&&(u=138,p=3),i=0;i<=n;i++)if(s=c,c=t[2*(i+1)+1],!(++d<u&&s===c)){if(d<p)do hf(e,s,e.bl_tree);while(--d!=0);else s!==0?(s!==o&&(hf(e,s,e.bl_tree),d--),hf(e,16,e.bl_tree),ra(e,d-3,2)):d<=10?(hf(e,17,e.bl_tree),ra(e,d-3,3)):(hf(e,18,e.bl_tree),ra(e,d-11,7));d=0,o=s,c===0?(u=138,p=3):s===c?(u=6,p=3):(u=7,p=4)}};let WB=!1;const s6=(e,t,n,i)=>{ra(e,0+(i?1:0),3),BB(e),Rc(e,n),Rc(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var dY=e=>{WB||((()=>{let t,n,i,s,o;const c=new Array(16);for(i=0,s=0;s<28;s++)for(db[s]=i,t=0;t<1<<lb[s];t++)Uv[i++]=s;for(Uv[i-1]=s,o=0,s=0;s<16;s++)for(ub[s]=o,t=0;t<1<<FP[s];t++)rE[o++]=s;for(o>>=7;s<nE;s++)for(ub[s]=o<<7,t=0;t<1<<FP[s]-7;t++)rE[256+o++]=s;for(n=0;n<=Mv;n++)c[n]=0;for(t=0;t<=143;)Nu[2*t+1]=8,t++,c[8]++;for(;t<=255;)Nu[2*t+1]=9,t++,c[9]++;for(;t<=279;)Nu[2*t+1]=7,t++,c[7]++;for(;t<=287;)Nu[2*t+1]=8,t++,c[8]++;for(VB(Nu,287,c),t=0;t<nE;t++)iE[2*t+1]=5,iE[2*t]=xB(t,5);MB=new BP(Nu,lb,257,cb,Mv),UB=new BP(iE,FP,0,nE,Mv),jP=new BP(new Array(0),r6,0,19,7)})(),WB=!0),e.l_desc=new GP(e.dyn_ltree,MB),e.d_desc=new GP(e.dyn_dtree,UB),e.bl_desc=new GP(e.bl_tree,jP),e.bi_buf=0,e.bi_valid=0,FB(e)},uY=(e,t,n,i)=>{let s,o,c=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(d=>{let u,p=4093624447;for(u=0;u<=31;u++,p>>>=1)if(1&p&&d.dyn_ltree[2*u]!==0)return 0;if(d.dyn_ltree[18]!==0||d.dyn_ltree[20]!==0||d.dyn_ltree[26]!==0)return 1;for(u=32;u<VP;u++)if(d.dyn_ltree[2*u]!==0)return 1;return 0})(e)),zP(e,e.l_desc),zP(e,e.d_desc),c=(d=>{let u;for(jB(d,d.dyn_ltree,d.l_desc.max_code),jB(d,d.dyn_dtree,d.d_desc.max_code),zP(d,d.bl_desc),u=18;u>=3&&d.bl_tree[2*D_[u]+1]===0;u--);return d.opt_len+=3*(u+1)+5+5+4,u})(e),s=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=s&&(s=o)):s=o=n+5,n+4<=s&&t!==-1?s6(e,t,n,i):e.strategy===4||o===s?(ra(e,2+(i?1:0),3),KP(e,Nu,iE)):(ra(e,4+(i?1:0),3),((d,u,p,m)=>{let g;for(ra(d,u-257,5),ra(d,p-1,5),ra(d,m-4,4),g=0;g<m;g++)ra(d,d.bl_tree[2*D_[g]+1],3);GB(d,d.dyn_ltree,u-1),GB(d,d.dyn_dtree,p-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,c+1),KP(e,e.dyn_ltree,e.dyn_dtree)),FB(e),i&&BB(e)},hY=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,t===0?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(Uv[n]+VP+1)]++,e.dyn_dtree[2*hb(t)]++),e.sym_next===e.sym_end),pY=e=>{ra(e,2,3),hf(e,256,Nu),(t=>{t.bi_valid===16?(Rc(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},T0={_tr_init:dY,_tr_stored_block:s6,_tr_flush_block:uY,_tr_tally:hY,_tr_align:pY},v0=(e,t,n,i)=>{let s=65535&e|0,o=e>>>16&65535|0,c=0;for(;n!==0;){c=n>2e3?2e3:n,n-=c;do s=s+t[i++]|0,o=o+s|0;while(--c);s%=65521,o%=65521}return s|o<<16|0};const Cc=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var Uo=(e,t,n,i)=>{const s=Cc,o=i+n;e^=-1;for(let c=i;c<o;c++)e=e>>>8^s[255&(e^t[c])];return-1^e},P_={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},YP={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:HB,_tr_stored_block:KB,_tr_flush_block:iS,_tr_tally:rS,_tr_align:sS}=T0,{Z_NO_FLUSH:oS,Z_PARTIAL_FLUSH:fY,Z_FULL_FLUSH:Dh,Z_FINISH:Du,Z_BLOCK:bc,Z_OK:Ic,Z_STREAM_END:pf,Z_STREAM_ERROR:k_,Z_DATA_ERROR:zB,Z_BUF_ERROR:YB,Z_DEFAULT_COMPRESSION:_Y,Z_FILTERED:qP,Z_HUFFMAN_ONLY:XP,Z_RLE:mY,Z_FIXED:EY,Z_DEFAULT_STRATEGY:gY,Z_UNKNOWN:JP,Z_DEFLATED:pb}=YP,qB=286,SY=30,TY=19,vY=2*qB+1,xv=15,vl=258,rd=262,Ph=42,ff=113,_f=666,aS=(e,t)=>(e.msg=P_[t],t),sE=e=>2*e-(e>4?9:0),cS=e=>{let t=e.length;for(;--t>=0;)e[t]=0},lS=e=>{let t,n,i,s=e.w_size;t=e.hash_size,i=t;do n=e.head[--i],e.head[i]=n>=s?n-s:0;while(--t);t=s,i=t;do n=e.prev[--i],e.prev[i]=n>=s?n-s:0;while(--t)};let za=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const To=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),n!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,t.pending===0&&(t.pending_out=0))},Fi=(e,t)=>{iS(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,To(e.strm)},Ur=(e,t)=>{e.pending_buf[e.pending++]=t},Vv=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},QP=(e,t,n,i)=>{let s=e.avail_in;return s>i&&(s=i),s===0?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),n),e.state.wrap===1?e.adler=v0(e.adler,t,s,n):e.state.wrap===2&&(e.adler=Uo(e.adler,t,s,n)),e.next_in+=s,e.total_in+=s,s)},Fv=(e,t)=>{let n,i,s=e.max_chain_length,o=e.strstart,c=e.prev_length,d=e.nice_match;const u=e.strstart>e.w_size-rd?e.strstart-(e.w_size-rd):0,p=e.window,m=e.w_mask,g=e.prev,T=e.strstart+vl;let R=p[o+c-1],I=p[o+c];e.prev_length>=e.good_match&&(s>>=2),d>e.lookahead&&(d=e.lookahead);do if(n=t,p[n+c]===I&&p[n+c-1]===R&&p[n]===p[o]&&p[++n]===p[o+1]){o+=2,n++;do;while(p[++o]===p[++n]&&p[++o]===p[++n]&&p[++o]===p[++n]&&p[++o]===p[++n]&&p[++o]===p[++n]&&p[++o]===p[++n]&&p[++o]===p[++n]&&p[++o]===p[++n]&&o<T);if(i=vl-(T-o),o=T-vl,i>c){if(e.match_start=t,c=i,i>=d)break;R=p[o+c-1],I=p[o+c]}}while((t=g[t&m])>u&&--s!=0);return c<=e.lookahead?c:e.lookahead},Bv=e=>{const t=e.w_size;let n,i,s;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-rd)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),lS(e),i+=t),e.strm.avail_in===0)break;if(n=QP(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=n,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=za(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=za(e,e.ins_h,e.window[s+3-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<rd&&e.strm.avail_in!==0)},ZP=(e,t)=>{let n,i,s,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,c=0,d=e.strm.avail_in;do{if(n=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s||(s=e.strm.avail_out-s,i=e.strstart-e.block_start,n>i+e.strm.avail_in&&(n=i+e.strm.avail_in),n>s&&(n=s),n<o&&(n===0&&t!==Du||t===oS||n!==i+e.strm.avail_in)))break;c=t===Du&&n===i+e.strm.avail_in?1:0,KB(e,0,0,c),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,To(e.strm),i&&(i>n&&(i=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,n-=i),n&&(QP(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(c===0);return d-=e.strm.avail_in,d&&(d>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=d&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-d,e.strm.next_in),e.strstart),e.strstart+=d,e.insert+=d>e.w_size-e.insert?e.w_size-e.insert:d),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),c?4:t!==oS&&t!==Du&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(QP(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,o=s>e.w_size?e.w_size:s,i=e.strstart-e.block_start,(i>=o||(i||t===Du)&&t!==oS&&e.strm.avail_in===0&&i<=s)&&(n=i>s?s:i,c=t===Du&&e.strm.avail_in===0&&n===i?1:0,KB(e,e.block_start,n,c),e.block_start+=n,To(e.strm)),c?3:1)},dS=(e,t)=>{let n,i;for(;;){if(e.lookahead<rd){if(Bv(e),e.lookahead<rd&&t===oS)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=za(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),n!==0&&e.strstart-n<=e.w_size-rd&&(e.match_length=Fv(e,n)),e.match_length>=3)if(i=rS(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=za(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=za(e,e.ins_h,e.window[e.strstart+1]);else i=rS(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(Fi(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Du?(Fi(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Fi(e,!1),e.strm.avail_out===0)?1:2},sd=(e,t)=>{let n,i,s;for(;;){if(e.lookahead<rd){if(Bv(e),e.lookahead<rd&&t===oS)return 1;if(e.lookahead===0)break}if(n=0,e.lookahead>=3&&(e.ins_h=za(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,n!==0&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-rd&&(e.match_length=Fv(e,n),e.match_length<=5&&(e.strategy===qP||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,i=rS(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=s&&(e.ins_h=za(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(Fi(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(i=rS(e,0,e.window[e.strstart-1]),i&&Fi(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=rS(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Du?(Fi(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(Fi(e,!1),e.strm.avail_out===0)?1:2};function Bd(e,t,n,i,s){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=s}const y0=[new Bd(0,0,0,0,ZP),new Bd(4,4,8,4,dS),new Bd(4,5,16,8,dS),new Bd(4,6,32,32,dS),new Bd(4,4,16,16,sd),new Bd(8,16,32,32,sd),new Bd(8,16,128,128,sd),new Bd(8,32,128,256,sd),new Bd(32,128,258,1024,sd),new Bd(32,258,258,4096,sd)];function R0(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=pb,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*vY),this.dyn_dtree=new Uint16Array(2*(2*SY+1)),this.bl_tree=new Uint16Array(2*(2*TY+1)),cS(this.dyn_ltree),cS(this.dyn_dtree),cS(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(xv+1),this.heap=new Uint16Array(2*qB+1),cS(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*qB+1),cS(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const fb=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Ph&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==ff&&t.status!==_f?1:0},XB=e=>{if(fb(e))return aS(e,k_);e.total_in=e.total_out=0,e.data_type=JP;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?Ph:ff,e.adler=t.wrap===2?0:1,t.last_flush=-2,HB(t),Ic},JB=e=>{const t=XB(e);return t===Ic&&(n=>{n.window_size=2*n.w_size,cS(n.head),n.max_lazy_match=y0[n.level].max_lazy,n.good_match=y0[n.level].good_length,n.nice_match=y0[n.level].nice_length,n.max_chain_length=y0[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(e.state),t},o6=(e,t,n,i,s,o)=>{if(!e)return k_;let c=1;if(t===_Y&&(t=6),i<0?(c=0,i=-i):i>15&&(c=2,i-=16),s<1||s>9||n!==pb||i<8||i>15||t<0||t>9||o<0||o>EY||i===8&&c!==1)return aS(e,k_);i===8&&(i=9);const d=new R0;return e.state=d,d.strm=e,d.status=Ph,d.wrap=c,d.gzhead=null,d.w_bits=i,d.w_size=1<<d.w_bits,d.w_mask=d.w_size-1,d.hash_bits=s+7,d.hash_size=1<<d.hash_bits,d.hash_mask=d.hash_size-1,d.hash_shift=~~((d.hash_bits+3-1)/3),d.window=new Uint8Array(2*d.w_size),d.head=new Uint16Array(d.hash_size),d.prev=new Uint16Array(d.w_size),d.lit_bufsize=1<<s+6,d.pending_buf_size=4*d.lit_bufsize,d.pending_buf=new Uint8Array(d.pending_buf_size),d.sym_buf=d.lit_bufsize,d.sym_end=3*(d.lit_bufsize-1),d.level=t,d.strategy=o,d.method=n,JB(e)};var yY=(e,t)=>{if(fb(e)||t>bc||t<0)return e?aS(e,k_):k_;const n=e.state;if(!e.output||e.avail_in!==0&&!e.input||n.status===_f&&t!==Du)return aS(e,e.avail_out===0?YB:k_);const i=n.last_flush;if(n.last_flush=t,n.pending!==0){if(To(e),e.avail_out===0)return n.last_flush=-1,Ic}else if(e.avail_in===0&&sE(t)<=sE(i)&&t!==Du)return aS(e,YB);if(n.status===_f&&e.avail_in!==0)return aS(e,YB);if(n.status===Ph&&n.wrap===0&&(n.status=ff),n.status===Ph){let s=pb+(n.w_bits-8<<4)<<8,o=-1;if(o=n.strategy>=XP||n.level<2?0:n.level<6?1:n.level===6?2:3,s|=o<<6,n.strstart!==0&&(s|=32),s+=31-s%31,Vv(n,s),n.strstart!==0&&(Vv(n,e.adler>>>16),Vv(n,65535&e.adler)),e.adler=1,n.status=ff,To(e),n.pending!==0)return n.last_flush=-1,Ic}if(n.status===57){if(e.adler=0,Ur(n,31),Ur(n,139),Ur(n,8),n.gzhead)Ur(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Ur(n,255&n.gzhead.time),Ur(n,n.gzhead.time>>8&255),Ur(n,n.gzhead.time>>16&255),Ur(n,n.gzhead.time>>24&255),Ur(n,n.level===9?2:n.strategy>=XP||n.level<2?4:0),Ur(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Ur(n,255&n.gzhead.extra.length),Ur(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Uo(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Ur(n,0),Ur(n,0),Ur(n,0),Ur(n,0),Ur(n,0),Ur(n,n.level===9?2:n.strategy>=XP||n.level<2?4:0),Ur(n,3),n.status=ff,To(e),n.pending!==0)return n.last_flush=-1,Ic}if(n.status===69){if(n.gzhead.extra){let s=n.pending,o=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+o>n.pending_buf_size;){let d=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+d),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>s&&(e.adler=Uo(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex+=d,To(e),n.pending!==0)return n.last_flush=-1,Ic;s=0,o-=d}let c=new Uint8Array(n.gzhead.extra);n.pending_buf.set(c.subarray(n.gzindex,n.gzindex+o),n.pending),n.pending+=o,n.gzhead.hcrc&&n.pending>s&&(e.adler=Uo(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let s,o=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>o&&(e.adler=Uo(e.adler,n.pending_buf,n.pending-o,o)),To(e),n.pending!==0)return n.last_flush=-1,Ic;o=0}s=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Ur(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>o&&(e.adler=Uo(e.adler,n.pending_buf,n.pending-o,o)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let s,o=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>o&&(e.adler=Uo(e.adler,n.pending_buf,n.pending-o,o)),To(e),n.pending!==0)return n.last_flush=-1,Ic;o=0}s=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Ur(n,s)}while(s!==0);n.gzhead.hcrc&&n.pending>o&&(e.adler=Uo(e.adler,n.pending_buf,n.pending-o,o))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(To(e),n.pending!==0))return n.last_flush=-1,Ic;Ur(n,255&e.adler),Ur(n,e.adler>>8&255),e.adler=0}if(n.status=ff,To(e),n.pending!==0)return n.last_flush=-1,Ic}if(e.avail_in!==0||n.lookahead!==0||t!==oS&&n.status!==_f){let s=n.level===0?ZP(n,t):n.strategy===XP?((o,c)=>{let d;for(;;){if(o.lookahead===0&&(Bv(o),o.lookahead===0)){if(c===oS)return 1;break}if(o.match_length=0,d=rS(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++,d&&(Fi(o,!1),o.strm.avail_out===0))return 1}return o.insert=0,c===Du?(Fi(o,!0),o.strm.avail_out===0?3:4):o.sym_next&&(Fi(o,!1),o.strm.avail_out===0)?1:2})(n,t):n.strategy===mY?((o,c)=>{let d,u,p,m;const g=o.window;for(;;){if(o.lookahead<=vl){if(Bv(o),o.lookahead<=vl&&c===oS)return 1;if(o.lookahead===0)break}if(o.match_length=0,o.lookahead>=3&&o.strstart>0&&(p=o.strstart-1,u=g[p],u===g[++p]&&u===g[++p]&&u===g[++p])){m=o.strstart+vl;do;while(u===g[++p]&&u===g[++p]&&u===g[++p]&&u===g[++p]&&u===g[++p]&&u===g[++p]&&u===g[++p]&&u===g[++p]&&p<m);o.match_length=vl-(m-p),o.match_length>o.lookahead&&(o.match_length=o.lookahead)}if(o.match_length>=3?(d=rS(o,1,o.match_length-3),o.lookahead-=o.match_length,o.strstart+=o.match_length,o.match_length=0):(d=rS(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++),d&&(Fi(o,!1),o.strm.avail_out===0))return 1}return o.insert=0,c===Du?(Fi(o,!0),o.strm.avail_out===0?3:4):o.sym_next&&(Fi(o,!1),o.strm.avail_out===0)?1:2})(n,t):y0[n.level].func(n,t);if(s!==3&&s!==4||(n.status=_f),s===1||s===3)return e.avail_out===0&&(n.last_flush=-1),Ic;if(s===2&&(t===fY?sS(n):t!==bc&&(KB(n,0,0,!1),t===Dh&&(cS(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),To(e),e.avail_out===0))return n.last_flush=-1,Ic}return t!==Du?Ic:n.wrap<=0?pf:(n.wrap===2?(Ur(n,255&e.adler),Ur(n,e.adler>>8&255),Ur(n,e.adler>>16&255),Ur(n,e.adler>>24&255),Ur(n,255&e.total_in),Ur(n,e.total_in>>8&255),Ur(n,e.total_in>>16&255),Ur(n,e.total_in>>24&255)):(Vv(n,e.adler>>>16),Vv(n,65535&e.adler)),To(e),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Ic:pf)},C0=(e,t)=>{let n=t.length;if(fb(e))return k_;const i=e.state,s=i.wrap;if(s===2||s===1&&i.status!==Ph||i.lookahead)return k_;if(s===1&&(e.adler=v0(e.adler,t,n,0)),i.wrap=0,n>=i.w_size){s===0&&(cS(i.head),i.strstart=0,i.block_start=0,i.insert=0);let u=new Uint8Array(i.w_size);u.set(t.subarray(n-i.w_size,n),0),t=u,n=i.w_size}const o=e.avail_in,c=e.next_in,d=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Bv(i);i.lookahead>=3;){let u=i.strstart,p=i.lookahead-2;do i.ins_h=za(i,i.ins_h,i.window[u+3-1]),i.prev[u&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=u,u++;while(--p);i.strstart=u,i.lookahead=2,Bv(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=c,e.input=d,e.avail_in=o,i.wrap=s,Ic},b0={deflateInit:(e,t)=>o6(e,t,pb,15,8,gY),deflateInit2:o6,deflateReset:JB,deflateResetKeep:XB,deflateSetHeader:(e,t)=>fb(e)||e.state.wrap!==2?k_:(e.state.gzhead=t,Ic),deflate:yY,deflateEnd:e=>{if(fb(e))return k_;const t=e.state.status;return e.state=null,t===ff?aS(e,zB):Ic},deflateSetDictionary:C0,deflateInfo:"pako deflate (from Nodeca project)"};const $P=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var I0={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const i in n)$P(n,i)&&(e[i]=n[i])}}return e},flattenChunks:e=>{let t=0;for(let i=0,s=e.length;i<s;i++)t+=e[i].length;const n=new Uint8Array(t);for(let i=0,s=0,o=e.length;i<o;i++){let c=e[i];n.set(c,s),s+=c.length}return n}};let _b=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{_b=!1}const oE=new Uint8Array(256);for(let e=0;e<256;e++)oE[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;oE[254]=oE[254]=1;var mb={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,n,i,s,o,c=e.length,d=0;for(s=0;s<c;s++)n=e.charCodeAt(s),(64512&n)==55296&&s+1<c&&(i=e.charCodeAt(s+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),s++)),d+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(d),o=0,s=0;o<d;s++)n=e.charCodeAt(s),(64512&n)==55296&&s+1<c&&(i=e.charCodeAt(s+1),(64512&i)==56320&&(n=65536+(n-55296<<10)+(i-56320),s++)),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},buf2string:(e,t)=>{const n=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let i,s;const o=new Array(2*n);for(s=0,i=0;i<n;){let c=e[i++];if(c<128){o[s++]=c;continue}let d=oE[c];if(d>4)o[s++]=65533,i+=d-1;else{for(c&=d===2?31:d===3?15:7;d>1&&i<n;)c=c<<6|63&e[i++],d--;d>1?o[s++]=65533:c<65536?o[s++]=c:(c-=65536,o[s++]=55296|c>>10&1023,o[s++]=56320|1023&c)}}return((c,d)=>{if(d<65534&&c.subarray&&_b)return String.fromCharCode.apply(null,c.length===d?c:c.subarray(0,d));let u="";for(let p=0;p<d;p++)u+=String.fromCharCode(c[p]);return u})(o,s)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&(192&e[n])==128;)n--;return n<0||n===0?t:n+oE[e[n]]>t?n:t}},QB=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const a6=Object.prototype.toString,{Z_NO_FLUSH:RY,Z_SYNC_FLUSH:CY,Z_FULL_FLUSH:bY,Z_FINISH:ek,Z_OK:tk,Z_STREAM_END:IY,Z_DEFAULT_COMPRESSION:AY,Z_DEFAULT_STRATEGY:wY,Z_DEFLATED:nk}=YP;function ik(e){this.options=I0.assign({level:AY,method:nk,chunkSize:16384,windowBits:15,memLevel:8,strategy:wY},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new QB,this.strm.avail_out=0;let n=b0.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==tk)throw new Error(P_[n]);if(t.header&&b0.deflateSetHeader(this.strm,t.header),t.dictionary){let i;if(i=typeof t.dictionary=="string"?mb.string2buf(t.dictionary):a6.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,n=b0.deflateSetDictionary(this.strm,i),n!==tk)throw new Error(P_[n]);this._dict_set=!0}}function OY(e,t){const n=new ik(t);if(n.push(e,!0),n.err)throw n.msg||P_[n.err];return n.result}ik.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize;let s,o;if(this.ended)return!1;for(o=t===~~t?t:t===!0?ek:RY,typeof e=="string"?n.input=mb.string2buf(e):a6.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(o===CY||o===bY)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(s=b0.deflate(n,o),s===IY)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),s=b0.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===tk;if(n.avail_out!==0){if(o>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},ik.prototype.onData=function(e){this.chunks.push(e)},ik.prototype.onEnd=function(e){e===tk&&(this.result=I0.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var rk={deflate:OY};const sk=16209;var ok=function(e,t){let n,i,s,o,c,d,u,p,m,g,T,R,I,A,w,k,L,j,K,W,Y,se,de,ge;const je=e.state;n=e.next_in,de=e.input,i=n+(e.avail_in-5),s=e.next_out,ge=e.output,o=s-(t-e.avail_out),c=s+(e.avail_out-257),d=je.dmax,u=je.wsize,p=je.whave,m=je.wnext,g=je.window,T=je.hold,R=je.bits,I=je.lencode,A=je.distcode,w=(1<<je.lenbits)-1,k=(1<<je.distbits)-1;e:do{R<15&&(T+=de[n++]<<R,R+=8,T+=de[n++]<<R,R+=8),L=I[T&w];t:for(;;){if(j=L>>>24,T>>>=j,R-=j,j=L>>>16&255,j===0)ge[s++]=65535&L;else{if(!(16&j)){if((64&j)==0){L=I[(65535&L)+(T&(1<<j)-1)];continue t}if(32&j){je.mode=16191;break e}e.msg="invalid literal/length code",je.mode=sk;break e}K=65535&L,j&=15,j&&(R<j&&(T+=de[n++]<<R,R+=8),K+=T&(1<<j)-1,T>>>=j,R-=j),R<15&&(T+=de[n++]<<R,R+=8,T+=de[n++]<<R,R+=8),L=A[T&k];n:for(;;){if(j=L>>>24,T>>>=j,R-=j,j=L>>>16&255,!(16&j)){if((64&j)==0){L=A[(65535&L)+(T&(1<<j)-1)];continue n}e.msg="invalid distance code",je.mode=sk;break e}if(W=65535&L,j&=15,R<j&&(T+=de[n++]<<R,R+=8,R<j&&(T+=de[n++]<<R,R+=8)),W+=T&(1<<j)-1,W>d){e.msg="invalid distance too far back",je.mode=sk;break e}if(T>>>=j,R-=j,j=s-o,W>j){if(j=W-j,j>p&&je.sane){e.msg="invalid distance too far back",je.mode=sk;break e}if(Y=0,se=g,m===0){if(Y+=u-j,j<K){K-=j;do ge[s++]=g[Y++];while(--j);Y=s-W,se=ge}}else if(m<j){if(Y+=u+m-j,j-=m,j<K){K-=j;do ge[s++]=g[Y++];while(--j);if(Y=0,m<K){j=m,K-=j;do ge[s++]=g[Y++];while(--j);Y=s-W,se=ge}}}else if(Y+=m-j,j<K){K-=j;do ge[s++]=g[Y++];while(--j);Y=s-W,se=ge}for(;K>2;)ge[s++]=se[Y++],ge[s++]=se[Y++],ge[s++]=se[Y++],K-=3;K&&(ge[s++]=se[Y++],K>1&&(ge[s++]=se[Y++]))}else{Y=s-W;do ge[s++]=ge[Y++],ge[s++]=ge[Y++],ge[s++]=ge[Y++],K-=3;while(K>2);K&&(ge[s++]=ge[Y++],K>1&&(ge[s++]=ge[Y++]))}break}}break}}while(n<i&&s<c);K=R>>3,n-=K,R-=K<<3,T&=(1<<R)-1,e.next_in=n,e.next_out=s,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=s<c?c-s+257:257-(s-c),je.hold=T,je.bits=R};const ak=15,NY=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),DY=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),PY=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),A0=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Eb=(e,t,n,i,s,o,c,d)=>{const u=d.bits;let p,m,g,T,R,I,A=0,w=0,k=0,L=0,j=0,K=0,W=0,Y=0,se=0,de=0,ge=null;const je=new Uint16Array(16),_t=new Uint16Array(16);let ht,Ct,Ft,mn=null;for(A=0;A<=ak;A++)je[A]=0;for(w=0;w<i;w++)je[t[n+w]]++;for(j=u,L=ak;L>=1&&je[L]===0;L--);if(j>L&&(j=L),L===0)return s[o++]=20971520,s[o++]=20971520,d.bits=1,0;for(k=1;k<L&&je[k]===0;k++);for(j<k&&(j=k),Y=1,A=1;A<=ak;A++)if(Y<<=1,Y-=je[A],Y<0)return-1;if(Y>0&&(e===0||L!==1))return-1;for(_t[1]=0,A=1;A<ak;A++)_t[A+1]=_t[A]+je[A];for(w=0;w<i;w++)t[n+w]!==0&&(c[_t[t[n+w]]++]=w);if(e===0?(ge=mn=c,I=20):e===1?(ge=NY,mn=DY,I=257):(ge=PY,mn=A0,I=0),de=0,w=0,A=k,R=o,K=j,W=0,g=-1,se=1<<j,T=se-1,e===1&&se>852||e===2&&se>592)return 1;for(;;){ht=A-W,c[w]+1<I?(Ct=0,Ft=c[w]):c[w]>=I?(Ct=mn[c[w]-I],Ft=ge[c[w]-I]):(Ct=96,Ft=0),p=1<<A-W,m=1<<K,k=m;do m-=p,s[R+(de>>W)+m]=ht<<24|Ct<<16|Ft|0;while(m!==0);for(p=1<<A-1;de&p;)p>>=1;if(p!==0?(de&=p-1,de+=p):de=0,w++,--je[A]==0){if(A===L)break;A=t[n+c[w]]}if(A>j&&(de&T)!==g){for(W===0&&(W=j),R+=k,K=A-W,Y=1<<K;K+W<L&&(Y-=je[K+W],!(Y<=0));)K++,Y<<=1;if(se+=1<<K,e===1&&se>852||e===2&&se>592)return 1;g=de&T,s[g]=j<<24|K<<16|R-o|0}}return de!==0&&(s[R+de]=A-W<<24|64<<16|0),d.bits=j,0};const{Z_FINISH:c6,Z_BLOCK:ck,Z_TREES:L_,Z_OK:jv,Z_STREAM_END:kY,Z_NEED_DICT:kh,Z_STREAM_ERROR:Pu,Z_DATA_ERROR:ZB,Z_MEM_ERROR:l6,Z_BUF_ERROR:d6,Z_DEFLATED:w0}=YP,Gv=16180,Lh=16190,mf=16191,O0=16192,gb=16194,Wv=16199,Sb=16200,ao=16206,vo=16209,u6=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Hv(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const uS=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Gv||t.mode>16211?1:0},$B=e=>{if(uS(e))return Pu;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Gv,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,jv},ej=e=>{if(uS(e))return Pu;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,$B(e)},tj=(e,t)=>{let n;if(uS(e))return Pu;const i=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Pu:(i.window!==null&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,ej(e))},lk=(e,t)=>{if(!e)return Pu;const n=new Hv;e.state=n,n.strm=e,n.window=null,n.mode=Gv;const i=tj(e,t);return i!==jv&&(e.state=null),i};let N0,dk,h6=!0;const p6=e=>{if(h6){N0=new Int32Array(512),dk=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Eb(1,e.lens,0,288,N0,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Eb(2,e.lens,0,32,dk,0,e.work,{bits:5}),h6=!1}e.lencode=N0,e.lenbits=9,e.distcode=dk,e.distbits=5},f6=(e,t,n,i)=>{let s;const o=e.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),i>=o.wsize?(o.window.set(t.subarray(n-o.wsize,n),0),o.wnext=0,o.whave=o.wsize):(s=o.wsize-o.wnext,s>i&&(s=i),o.window.set(t.subarray(n-i,n-i+s),o.wnext),(i-=s)?(o.window.set(t.subarray(n-i,n),0),o.wnext=i,o.whave=o.wsize):(o.wnext+=s,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=s))),0};var aE=(e,t)=>{let n,i,s,o,c,d,u,p,m,g,T,R,I,A,w,k,L,j,K,W,Y,se,de=0;const ge=new Uint8Array(4);let je,_t;const ht=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(uS(e)||!e.output||!e.input&&e.avail_in!==0)return Pu;n=e.state,n.mode===mf&&(n.mode=O0),c=e.next_out,s=e.output,u=e.avail_out,o=e.next_in,i=e.input,d=e.avail_in,p=n.hold,m=n.bits,g=d,T=u,se=jv;e:for(;;)switch(n.mode){case Gv:if(n.wrap===0){n.mode=O0;break}for(;m<16;){if(d===0)break e;d--,p+=i[o++]<<m,m+=8}if(2&n.wrap&&p===35615){n.wbits===0&&(n.wbits=15),n.check=0,ge[0]=255&p,ge[1]=p>>>8&255,n.check=Uo(n.check,ge,2,0),p=0,m=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&p)<<8)+(p>>8))%31){e.msg="incorrect header check",n.mode=vo;break}if((15&p)!==w0){e.msg="unknown compression method",n.mode=vo;break}if(p>>>=4,m-=4,Y=8+(15&p),n.wbits===0&&(n.wbits=Y),Y>15||Y>n.wbits){e.msg="invalid window size",n.mode=vo;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&p?16189:mf,p=0,m=0;break;case 16181:for(;m<16;){if(d===0)break e;d--,p+=i[o++]<<m,m+=8}if(n.flags=p,(255&Mo(n))!==w0){e.msg="unknown compression method",n.mode=vo;break}if(57344&Mo(n)){e.msg="unknown header flags set",n.mode=vo;break}n.head&&(n.head.text=p>>8&1),512&Mo(n)&&4&n.wrap&&(ge[0]=255&p,ge[1]=p>>>8&255,n.check=Uo(n.check,ge,2,0)),p=0,m=0,n.mode=16182;case 16182:for(;m<32;){if(d===0)break e;d--,p+=i[o++]<<m,m+=8}n.head&&(n.head.time=p),512&Mo(n)&&4&n.wrap&&(ge[0]=255&p,ge[1]=p>>>8&255,ge[2]=p>>>16&255,ge[3]=p>>>24&255,n.check=Uo(n.check,ge,4,0)),p=0,m=0,n.mode=16183;case 16183:for(;m<16;){if(d===0)break e;d--,p+=i[o++]<<m,m+=8}n.head&&(n.head.xflags=255&p,n.head.os=p>>8),512&Mo(n)&&4&n.wrap&&(ge[0]=255&p,ge[1]=p>>>8&255,n.check=Uo(n.check,ge,2,0)),p=0,m=0,n.mode=16184;case 16184:if(1024&Mo(n)){for(;m<16;){if(d===0)break e;d--,p+=i[o++]<<m,m+=8}n.length=p,n.head&&(n.head.extra_len=p),512&Mo(n)&&4&n.wrap&&(ge[0]=255&p,ge[1]=p>>>8&255,n.check=Uo(n.check,ge,2,0)),p=0,m=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&Mo(n)&&(R=n.length,R>d&&(R=d),R&&(n.head&&(Y=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(o,o+R),Y)),512&Mo(n)&&4&n.wrap&&(n.check=Uo(n.check,i,R,o)),d-=R,o+=R,n.length-=R),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&Mo(n)){if(d===0)break e;R=0;do Y=i[o+R++],n.head&&Y&&n.length<65536&&(n.head.name+=String.fromCharCode(Y));while(Y&&R<d);if(512&Mo(n)&&4&n.wrap&&(n.check=Uo(n.check,i,R,o)),d-=R,o+=R,Y)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&Mo(n)){if(d===0)break e;R=0;do Y=i[o+R++],n.head&&Y&&n.length<65536&&(n.head.comment+=String.fromCharCode(Y));while(Y&&R<d);if(512&Mo(n)&&4&n.wrap&&(n.check=Uo(n.check,i,R,o)),d-=R,o+=R,Y)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&Mo(n)){for(;m<16;){if(d===0)break e;d--,p+=i[o++]<<m,m+=8}if(4&n.wrap&&p!==(65535&n.check)){e.msg="header crc mismatch",n.mode=vo;break}p=0,m=0}n.head&&(n.head.hcrc=Mo(n)>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=mf;break;case 16189:for(;m<32;){if(d===0)break e;d--,p+=i[o++]<<m,m+=8}e.adler=n.check=u6(p),p=0,m=0,n.mode=Lh;case Lh:if(n.havedict===0)return e.next_out=c,e.avail_out=u,e.next_in=o,e.avail_in=d,n.hold=p,n.bits=m,kh;e.adler=n.check=1,n.mode=mf;case mf:if(t===ck||t===L_)break e;case O0:if(n.last){p>>>=7&m,m-=7&m,n.mode=ao;break}for(;m<3;){if(d===0)break e;d--,p+=i[o++]<<m,m+=8}switch(n.last=1&p,p>>>=1,m-=1,3&p){case 0:n.mode=16193;break;case 1:if(p6(n),n.mode=Wv,t===L_){p>>>=2,m-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=vo}p>>>=2,m-=2;break;case 16193:for(p>>>=7&m,m-=7&m;m<32;){if(d===0)break e;d--,p+=i[o++]<<m,m+=8}if((65535&p)!=(p>>>16^65535)){e.msg="invalid stored block lengths",n.mode=vo;break}if(n.length=65535&p,p=0,m=0,n.mode=gb,t===L_)break e;case gb:n.mode=16195;case 16195:if(R=n.length,R){if(R>d&&(R=d),R>u&&(R=u),R===0)break e;s.set(i.subarray(o,o+R),c),d-=R,o+=R,u-=R,c+=R,n.length-=R;break}n.mode=mf;break;case 16196:for(;m<14;){if(d===0)break e;d--,p+=i[o++]<<m,m+=8}if(n.nlen=257+(31&p),p>>>=5,m-=5,n.ndist=1+(31&p),p>>>=5,m-=5,n.ncode=4+(15&p),p>>>=4,m-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=vo;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;m<3;){if(d===0)break e;d--,p+=i[o++]<<m,m+=8}n.lens[ht[n.have++]]=7&p,p>>>=3,m-=3}for(;n.have<19;)n.lens[ht[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,je={bits:n.lenbits},se=Eb(0,n.lens,0,19,n.lencode,0,n.work,je),n.lenbits=je.bits,se){e.msg="invalid code lengths set",n.mode=vo;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;de=n.lencode[p&(1<<n.lenbits)-1],w=de>>>24,k=de>>>16&255,L=65535&de,!(w<=m);){if(d===0)break e;d--,p+=i[o++]<<m,m+=8}if(L<16)p>>>=w,m-=w,n.lens[n.have++]=L;else{if(L===16){for(_t=w+2;m<_t;){if(d===0)break e;d--,p+=i[o++]<<m,m+=8}if(p>>>=w,m-=w,n.have===0){e.msg="invalid bit length repeat",n.mode=vo;break}Y=n.lens[n.have-1],R=3+(3&p),p>>>=2,m-=2}else if(L===17){for(_t=w+3;m<_t;){if(d===0)break e;d--,p+=i[o++]<<m,m+=8}p>>>=w,m-=w,Y=0,R=3+(7&p),p>>>=3,m-=3}else{for(_t=w+7;m<_t;){if(d===0)break e;d--,p+=i[o++]<<m,m+=8}p>>>=w,m-=w,Y=0,R=11+(127&p),p>>>=7,m-=7}if(n.have+R>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=vo;break}for(;R--;)n.lens[n.have++]=Y}}if(n.mode===vo)break;if(n.lens[256]===0){e.msg="invalid code -- missing end-of-block",n.mode=vo;break}if(n.lenbits=9,je={bits:n.lenbits},se=Eb(1,n.lens,0,n.nlen,n.lencode,0,n.work,je),n.lenbits=je.bits,se){e.msg="invalid literal/lengths set",n.mode=vo;break}if(n.distbits=6,n.distcode=n.distdyn,je={bits:n.distbits},se=Eb(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,je),n.distbits=je.bits,se){e.msg="invalid distances set",n.mode=vo;break}if(n.mode=Wv,t===L_)break e;case Wv:n.mode=Sb;case Sb:if(d>=6&&u>=258){e.next_out=c,e.avail_out=u,e.next_in=o,e.avail_in=d,n.hold=p,n.bits=m,ok(e,T),c=e.next_out,s=e.output,u=e.avail_out,o=e.next_in,i=e.input,d=e.avail_in,p=n.hold,m=n.bits,n.mode===mf&&(n.back=-1);break}for(n.back=0;de=n.lencode[p&(1<<n.lenbits)-1],w=de>>>24,k=de>>>16&255,L=65535&de,!(w<=m);){if(d===0)break e;d--,p+=i[o++]<<m,m+=8}if(k&&(240&k)==0){for(j=w,K=k,W=L;de=n.lencode[W+((p&(1<<j+K)-1)>>j)],w=de>>>24,k=de>>>16&255,L=65535&de,!(j+w<=m);){if(d===0)break e;d--,p+=i[o++]<<m,m+=8}p>>>=j,m-=j,n.back+=j}if(p>>>=w,m-=w,n.back+=w,n.length=L,k===0){n.mode=16205;break}if(32&k){n.back=-1,n.mode=mf;break}if(64&k){e.msg="invalid literal/length code",n.mode=vo;break}n.extra=15&k,n.mode=16201;case 16201:if(n.extra){for(_t=n.extra;m<_t;){if(d===0)break e;d--,p+=i[o++]<<m,m+=8}n.length+=p&(1<<n.extra)-1,p>>>=n.extra,m-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;de=n.distcode[p&(1<<n.distbits)-1],w=de>>>24,k=de>>>16&255,L=65535&de,!(w<=m);){if(d===0)break e;d--,p+=i[o++]<<m,m+=8}if((240&k)==0){for(j=w,K=k,W=L;de=n.distcode[W+((p&(1<<j+K)-1)>>j)],w=de>>>24,k=de>>>16&255,L=65535&de,!(j+w<=m);){if(d===0)break e;d--,p+=i[o++]<<m,m+=8}p>>>=j,m-=j,n.back+=j}if(p>>>=w,m-=w,n.back+=w,64&k){e.msg="invalid distance code",n.mode=vo;break}n.offset=L,n.extra=15&k,n.mode=16203;case 16203:if(n.extra){for(_t=n.extra;m<_t;){if(d===0)break e;d--,p+=i[o++]<<m,m+=8}n.offset+=p&(1<<n.extra)-1,p>>>=n.extra,m-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=vo;break}n.mode=16204;case 16204:if(u===0)break e;if(R=T-u,n.offset>R){if(R=n.offset-R,R>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=vo;break}R>n.wnext?(R-=n.wnext,I=n.wsize-R):I=n.wnext-R,R>n.length&&(R=n.length),A=n.window}else A=s,I=c-n.offset,R=n.length;R>u&&(R=u),u-=R,n.length-=R;do s[c++]=A[I++];while(--R);n.length===0&&(n.mode=Sb);break;case 16205:if(u===0)break e;s[c++]=n.length,u--,n.mode=Sb;break;case ao:if(n.wrap){for(;m<32;){if(d===0)break e;d--,p|=i[o++]<<m,m+=8}if(T-=u,e.total_out+=T,n.total+=T,4&n.wrap&&T&&(e.adler=n.check=Mo(n)?Uo(n.check,s,T,c-T):v0(n.check,s,T,c-T)),T=u,4&n.wrap&&(Mo(n)?p:u6(p))!==n.check){e.msg="incorrect data check",n.mode=vo;break}p=0,m=0}n.mode=16207;case 16207:if(n.wrap&&Mo(n)){for(;m<32;){if(d===0)break e;d--,p+=i[o++]<<m,m+=8}if(4&n.wrap&&p!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=vo;break}p=0,m=0}n.mode=16208;case 16208:se=kY;break e;case vo:se=ZB;break e;case 16210:return l6;default:return Pu}return e.next_out=c,e.avail_out=u,e.next_in=o,e.avail_in=d,n.hold=p,n.bits=m,(n.wsize||T!==e.avail_out&&n.mode<vo&&(n.mode<ao||t!==c6))&&f6(e,e.output,e.next_out,T-e.avail_out),g-=e.avail_in,T-=e.avail_out,e.total_in+=g,e.total_out+=T,n.total+=T,4&n.wrap&&T&&(e.adler=n.check=Mo(n)?Uo(n.check,s,T,e.next_out-T):v0(n.check,s,T,e.next_out-T)),e.data_type=n.bits+(n.last?64:0)+(n.mode===mf?128:0)+(n.mode===Wv||n.mode===gb?256:0),(g===0&&T===0||t===c6)&&se===jv&&(se=d6),se},cE={inflateReset:ej,inflateReset2:tj,inflateResetKeep:$B,inflateInit:e=>lk(e,15),inflateInit2:lk,inflate:aE,inflateEnd:e=>{if(uS(e))return Pu;let t=e.state;return t.window&&(t.window=null),e.state=null,jv},inflateGetHeader:(e,t)=>{if(uS(e))return Pu;const n=e.state;return(2&n.wrap)==0?Pu:(n.head=t,t.done=!1,jv)},inflateSetDictionary:(e,t)=>{const n=t.length;let i,s,o;return uS(e)?Pu:(i=e.state,i.wrap!==0&&i.mode!==Lh?Pu:i.mode===Lh&&(s=1,s=v0(s,t,n,0),s!==i.check)?ZB:(o=f6(e,t,n,n),o?(i.mode=16210,l6):(i.havedict=1,jv)))},inflateInfo:"pako inflate (from Nodeca project)"},_6=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const m6=Object.prototype.toString,{Z_NO_FLUSH:LY,Z_FINISH:D0,Z_OK:Kv,Z_STREAM_END:P0,Z_NEED_DICT:nj,Z_STREAM_ERROR:E6,Z_DATA_ERROR:g6,Z_MEM_ERROR:uk}=YP;function hk(e){this.options=I0.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits)==0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new QB,this.strm.avail_out=0;let n=cE.inflateInit2(this.strm,t.windowBits);if(n!==Kv)throw new Error(P_[n]);if(this.header=new _6,cE.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=mb.string2buf(t.dictionary):m6.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=cE.inflateSetDictionary(this.strm,t.dictionary),n!==Kv)))throw new Error(P_[n])}function MY(e,t){const n=new hk(t);if(n.push(e),n.err)throw n.msg||P_[n.err];return n.result}hk.prototype.push=function(e,t){const n=this.strm,i=this.options.chunkSize,s=this.options.dictionary;let o,c,d;if(this.ended)return!1;for(c=t===~~t?t:t===!0?D0:LY,m6.call(e)==="[object ArrayBuffer]"?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),o=cE.inflate(n,c),o===nj&&s&&(o=cE.inflateSetDictionary(n,s),o===Kv?o=cE.inflate(n,c):o===g6&&(o=nj));n.avail_in>0&&o===P0&&n.state.wrap>0&&e[n.next_in]!==0;)cE.inflateReset(n),o=cE.inflate(n,c);switch(o){case E6:case g6:case nj:case uk:return this.onEnd(o),this.ended=!0,!1}if(d=n.avail_out,n.next_out&&(n.avail_out===0||o===P0))if(this.options.to==="string"){let u=mb.utf8border(n.output,n.next_out),p=n.next_out-u,m=mb.buf2string(n.output,u);n.next_out=p,n.avail_out=i-p,p&&n.output.set(n.output.subarray(u,u+p),0),this.onData(m)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(o!==Kv||d!==0){if(o===P0)return o=cE.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},hk.prototype.onData=function(e){this.chunks.push(e)},hk.prototype.onEnd=function(e){e===Kv&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=I0.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var UY={inflate:MY};const{deflate:xY}=rk,{inflate:VY}=UY;var FY=xY,S6=VY,T6=(function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e})(T6||{});class BY{constructor(){Q(this,"_sequence",0),Q(this,"_startTime",Date.now()),Q(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const d=new Uint8Array(4);d.set([1,0,0,0]);const u={id:0,length:4,data:d.buffer},p={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[u]};n.commonPacketHeader.extension=1,n.extension=p,n.payload=this.compress(t),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;re("SHOW_DATASTREAM2_LOG")&&F.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const i=new ArrayBuffer(n.commonPacketHeader.length),s=new Uint8Array(i),o=new DataView(i);let c=0;if(o.setUint16(c,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),c+=2,o.setUint32(c,n.commonPacketHeader.sequence,!0),c+=4,o.setUint16(c,n.commonStreamHeader,!0),c+=2,n.extension){const d=this.serializeExtension(n.extension);s.set(new Uint8Array(d),c),c+=d.byteLength}if(s.set(new Uint8Array(n.payload),c),c+=n.payload.byteLength,c!==n.commonPacketHeader.length)throw Error("serialize error!");return i}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const n=new DataView(t);let i=0;const s=n.getUint16(i,!0);i+=2;const o={length:16383&s,reserved:(16384&s)>>14,extension:(32768&s)>>15,sequence:n.getUint16(i+2,!0)<<16|n.getUint16(i,!0)};let c,d;if(i+=4,re("SHOW_DATASTREAM2_LOG")&&F.debug("receive data header: ".concat(JSON.stringify(o))),n.getUint16(i,!0),i+=2,o.extension){d=this.deserializeExtension(t.slice(i)),i+=2+d.length,c=t.slice(i);let u=!1;if(d.datas.length>0){const p=d.datas.find((m=>m.id===0));p&&(u=(1&new DataView(p.data).getUint32(0,!0))==1)}c=u?this.decompress(c):c}else c=t.slice(8);return c}serializeExtension(t){const{profile:n,length:i,datas:s}=t,o=new ArrayBuffer(i+2),c=new Uint8Array(o),d=new DataView(o);let u=0;if(d.setUint8(u++,n),d.setUint8(u++,i),s.forEach((p=>{n?(d.setUint8(u++,p.id),d.setUint8(u++,p.length),c.set(new Uint8Array(p.data),u),u+=p.data.byteLength):(d.setUint8(u++,p.id|p.length<<4),c.set(new Uint8Array(p.data),u),u+=p.data.byteLength)})),u!==i+2)throw Error("serialize extension error, is ".concat(u,"!==").concat(i+2));return o}deserializeExtension(t){const n=new DataView(t);let i=0;const s=n.getUint8(i);i++;const o=n.getUint8(i);i++;const c=s===T6.TWO_BYTE,d=[],u=new DataView(t,2);let p=0;for(;p<o;){let m=0,g=0,T=new ArrayBuffer(0);c?(m=u.getUint8(p),p++,g=u.getUint8(p),p++):(m=15&u.getUint8(p),g=u.getUint8(p)>>4,p++),g>0&&(T=u.buffer.slice(p+2,p+2+g),p+=T.byteLength),d.push({id:m,length:g,data:T})}if(p!==o)throw Error("parse error");return{profile:s,length:o,datas:d}}decompress(t){return S6(new Uint8Array(t))}compress(t){return FY(new Uint8Array(t))}}const jY={name:"DataStream",create:(e,t)=>{const n=t?new Rz(e):new $D(e);return n.useDataStream(new BY),n}};class GY extends rr{constructor(t,n,i){super(),Q(this,"ws",void 0),Q(this,"requestId",1),Q(this,"heartBeatTimer",void 0),Q(this,"joinInfo",void 0),Q(this,"clientId",void 0),Q(this,"onOpen",(()=>{this.emit("open"),this.startHeartBeatCheck()})),Q(this,"onClose",(s=>{this.emit("close"),this.dispose()})),Q(this,"onMessage",(s=>{const o=JSON.parse(s.data);if(!o||o.command!=="serverResponse"||!o.requestId)return o&&o.command==="serverStatus"&&o.serverStatus&&o.serverStatus.command?(this.emit("status",o.serverStatus),void this.emit(o.serverStatus.command,o.serverStatus)):void 0;this.emit("req_".concat(o.requestId),o)})),this.joinInfo=t,this.clientId=n,this.ws=new Xw("cross-channel-".concat(this.clientId),i),this.ws.on(cn.RECONNECTING,(()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")})),this.ws.on(cn.CONNECTED,this.onOpen),this.ws.on(cn.ON_MESSAGE,this.onMessage),this.ws.on(cn.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new De(((n,i)=>{const s=window.setTimeout((()=>{i(new Pe(H.TIMEOUT,"wait status timeout, status: ".concat(t)))}),5e3);this.once(t,(o=>{window.clearTimeout(s),o.state&&o.state!==0?i(new Pe(H.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)})),this.once("dispose",(()=>{window.clearTimeout(s),i(new Pe(H.WS_ABORT))}))}))}async request(t){if(this.ws.state==="closed")throw new Pe(H.WS_DISCONNECT);const n=()=>new De(((c,d)=>{this.ws.once(cn.CLOSED,(()=>d(new Pe(H.WS_ABORT)))),this.ws.once(cn.CONNECTED,c)}));this.ws.state!=="connected"&&await n();const i=this.sendMessage(t),s=new De(((c,d)=>{const u=()=>{d(new Pe(H.WS_ABORT))};this.ws.once(cn.RECONNECTING,u),this.ws.once(cn.CLOSED,u),this.once("req_".concat(i),c),In(3e3).then((()=>{this.removeAllListeners("req_".concat(i)),this.ws.off(cn.RECONNECTING,u),this.ws.off(cn.CLOSED,u),d(new Pe(H.TIMEOUT,"cross channel ws request timeout"))}))})),o=await s;if(!o||o.code!==200)throw new Pe(H.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(o)));return o}async connect(t){this.ws.removeAllListeners(cn.REQUEST_NEW_URLS),this.ws.on(cn.REQUEST_NEW_URLS,(n=>{n(t)})),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval((()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})}),3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class WY extends rr{set state(t){t!==this._state&&(t!==wa.RELAY_STATE_FAILURE&&(this.errorCode=vi.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,i,s,o){super(),Q(this,"joinInfo",void 0),Q(this,"sid",void 0),Q(this,"clientId",void 0),Q(this,"cancelToken",Gc.CancelToken.source()),Q(this,"workerToken",void 0),Q(this,"requestId",0),Q(this,"signal",void 0),Q(this,"prevChannelMediaConfig",void 0),Q(this,"httpRetryConfig",void 0),Q(this,"_resolution",void 0),Q(this,"_state",wa.RELAY_STATE_IDLE),Q(this,"errorCode",vi.RELAY_OK),Q(this,"onStatus",(c=>{F.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(c))),c&&c.command&&(c.command==="onAudioPacketReceived"&&this.emit("event",ko.PACKET_RECEIVED_AUDIO_FROM_SRC),c.command==="onVideoPacketReceived"&&this.emit("event",ko.PACKET_RECEIVED_VIDEO_FROM_SRC),c.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=vi.SRC_TOKEN_EXPIRED,this.state=wa.RELAY_STATE_FAILURE),c.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=vi.DEST_TOKEN_EXPIRED,this.state=wa.RELAY_STATE_FAILURE))})),Q(this,"onReconnect",(async()=>{F.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",ko.NETWORK_DISCONNECTED),this.state=wa.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch((c=>{this.state!==wa.RELAY_STATE_IDLE&&(F.error("auto restart channel media relay failed",c.toString()),this.errorCode=vi.SERVER_CONNECTION_LOST,this.state=wa.RELAY_STATE_FAILURE)}))})),this.joinInfo=t,this.clientId=n,this.sid=__(),this.signal=new GY(this.joinInfo,this.clientId,i),this.httpRetryConfig=s,this._resolution=o}async startChannelMediaRelay(t){if(this.state!==wa.RELAY_STATE_IDLE)throw new Pe(H.INVALID_OPERATION);this.state=wa.RELAY_STATE_CONNECTING,await this.connect(),F.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new Pe(H.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new Pe(H.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new Pe(H.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==wa.RELAY_STATE_RUNNING)throw new Pe(H.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==wa.RELAY_STATE_RUNNING)throw new Pe(H.INVALID_OPERATION);const n=this.genMessage(oo.SetVideoProfile);await this.signal.request(n),F.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),F.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=wa.RELAY_STATE_IDLE,this.dispose()}dispose(){F.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Gc.CancelToken.source(),this.state=wa.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await $z(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",ko.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(oo.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),F.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const i=this.genMessage(oo.SetSdkProfile,t);await this.signal.request(i),F.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const s=this.genMessage(oo.SetSourceChannel,t);await this.signal.request(s),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",ko.PACKET_JOINED_SRC_CHANNEL),F.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const o=this.genMessage(oo.SetSourceUserId,t);await this.signal.request(o),F.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const c=this.genMessage(oo.SetDestChannel,t);await this.signal.request(c),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",ko.PACKET_JOINED_DEST_CHANNEL),F.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const d=this.genMessage(oo.StartPacketTransfer,t);await this.signal.request(d),this.emit("event",ko.PACKET_SENT_TO_DEST_CHANNEL),this.state=wa.RELAY_STATE_RUNNING,F.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(oo.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",ko.PACKET_UPDATE_DEST_CHANNEL),F.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(oo.StopPacketTransfer);await this.signal.request(t),F.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const i=[],s=[],o=[];this.requestId+=1;const c={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:ql,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};c.sdkVersion==="4.24.0"&&(c.sdkVersion="0.0.1");let d=null,u=null;switch(t){case oo.SetSdkProfile:return c.clientRequest={command:"SetSdkProfile",type:"multi_channel"},c;case oo.SetSourceChannel:if(u=n&&n.getSrcChannelMediaInfo(),!u)throw new Pe(H.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceChannel",uid:"0",channelName:u.channelName,token:u.token||this.joinInfo.appId},c;case oo.SetSourceUserId:if(u=n&&n.getSrcChannelMediaInfo(),!u)throw new Pe(H.UNEXPECTED_ERROR,"can not find source config");return c.clientRequest={command:"SetSourceUserId",uid:u.uid+""},c;case oo.SetDestChannel:if(d=n&&n.getDestChannelMediaInfo(),!d)throw new Pe(H.UNEXPECTED_ERROR,"can not find dest config");return d.forEach((p=>{i.push(p.channelName),s.push(p.uid+""),o.push(p.token||this.joinInfo.appId)})),c.clientRequest={command:"SetDestChannel",channelName:i,uid:s,token:o},c;case oo.StartPacketTransfer:return c.clientRequest={command:"StartPacketTransfer"},c;case oo.Reconnect:return c.clientRequest={command:"Reconnect"},c;case oo.StopPacketTransfer:return c.clientRequest={command:"StopPacketTransfer"},c;case oo.UpdateDestChannel:if(d=n&&n.getDestChannelMediaInfo(),!d)throw new Pe(H.UNEXPECTED_ERROR,"can not find dest config");return d.forEach((p=>{i.push(p.channelName),s.push(p.uid+""),o.push(p.token||this.joinInfo.appId)})),c.clientRequest={command:"UpdateDestChannel",channelName:i,uid:s,token:o},c;case oo.SetVideoProfile:c.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return c}}const v6={name:"ChannelMediaRelay",create:function(e){return new WY(e.joinInfo,e.clientId,e.websocketRetryConfig||Es,e.httpRetryConfig||Es,e.resolution)}};function Tb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function k0(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Tb(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tb(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}class y6 extends rr{constructor(t,n,i,s){super(),Q(this,"spec",void 0),Q(this,"token",void 0),Q(this,"websocket",void 0),Q(this,"pingpongTimer",void 0),Q(this,"reconnectMode","retry"),Q(this,"serviceMode",void 0),Q(this,"reqId",0),Q(this,"commandReqId",0),Q(this,"handleWebSocketOpen",(()=>{this.reconnectMode="retry",this.startPingPong()})),Q(this,"handleWebSocketMessage",(o=>{if(!o.data)return;const c=JSON.parse(o.data);c.requestId?this.emit("@".concat(c.requestId,"-").concat(c.sid),c):(fe.workerEvent(this.spec.sid,{actionType:"status",serverCode:c.code,workerType:this.serviceMode===Wm.TRANSCODE?1:2}),this.emit(S_.PUBLISH_STREAM_STATUS,c))})),this.spec=n,this.token=t,this.serviceMode=s,this.websocket=new Xw("live-streaming",i),this.websocket.on(cn.CONNECTED,this.handleWebSocketOpen),this.websocket.on(cn.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(cn.REQUEST_NEW_URLS,((o,c)=>{On(this,S_.REQUEST_NEW_ADDRESS).then(o).catch(c)})),this.websocket.on(cn.RECONNECTING,(()=>{this.websocket.reconnectMode=this.reconnectMode}))}init(t){return this.websocket.init(t)}async request(t,n,i,s){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const o=this.commandReqId,c=this.reqId;if(!c||!this.websocket)throw new Pe(H.UNEXPECTED_ERROR);const d=k0({command:t,sdkVersion:ql==="4.24.0"?"0.0.1":ql,seq:c,requestId:c,allocate:i,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new Pe(H.WS_DISCONNECT);const u=()=>new De(((T,R)=>{this.websocket.once(cn.CLOSED,(()=>R(new Pe(H.WS_ABORT)))),this.websocket.once(cn.CONNECTED,T)}));this.websocket.state!=="connected"&&await u(),d.clientRequest&&(d.clientRequest.workerToken=this.token);const p=new De(((T,R)=>{const I=()=>{R(new Pe(H.WS_ABORT))};this.websocket.once(cn.RECONNECTING,I),this.websocket.once(cn.CLOSED,I),this.once("@".concat(c,"-").concat(this.spec.sid),(A=>{T(A)}))}));s&&fe.workerEvent(this.spec.sid,k0(k0({},s),{},{requestId:o,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const m=Date.now();this.websocket.sendMessage(d);let g=null;try{g=await p}catch(T){if(this.websocket.state==="closed")throw T;return await u(),await this.request(t,n,i)}return s&&fe.workerEvent(this.spec.sid,k0(k0({},s),{},{requestId:o,actionType:"response",payload:JSON.stringify(g.serverResponse),serverCode:g.code,success:g.code===200,responseTime:Date.now()-m})),g.code!==200&&this.handleResponseError(g),g}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=ql==="4.24.0"?"0.0.1":ql;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Gs.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void F.warning("live stream response already exists stream");case Gs.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Gs.LIVE_STREAM_RESPONSE_BAD_STREAM:case Gs.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Pe(H.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Gs.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new Pe(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Gs.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Pe(H.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Gs.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new Pe(H.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(S_.WARNING,n,t.serverResponse.url)}case Gs.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new Pe(H.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(S_.WARNING,n,t.serverResponse.url)}case Gs.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Pe(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Gs.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Pe(H.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Gs.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new Pe(H.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(S_.WARNING,n,t.serverResponse.url)}case Gs.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Pe(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Gs.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Pe(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Gs.LIVE_STREAM_RESPONSE_WORKER_LOST:case Gs.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new Pe(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Gs.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new Pe(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new Pe(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Gs.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Gs.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Gs.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Gs.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Pe(H.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval((()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Cw)}),6e3)}}function Yc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function yl(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Yc(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yc(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}class HY extends rr{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Es,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Es;super(),Q(this,"onLiveStreamWarning",void 0),Q(this,"onLiveStreamError",void 0),Q(this,"spec",void 0),Q(this,"retryTimeout",1e4),Q(this,"connection",void 0),Q(this,"httpRetryConfig",void 0),Q(this,"wsRetryConfig",void 0),Q(this,"streamingTasks",new Map),Q(this,"isStartingStreamingTask",!1),Q(this,"taskMutex",new ro("live-streaming")),Q(this,"cancelToken",Gc.CancelToken.source()),Q(this,"transcodingConfig",void 0),Q(this,"uapResponse",void 0),Q(this,"lastTaskId",1),Q(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=i,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=yl(yl({},qg),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(F.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map((c=>yl(yl(yl({},qV),c),{},{zOrder:c.zOrder?c.zOrder+1:1})))),(function(c){Gr(c.width)||Mi(c.width,"config.width",0,1e4),Gr(c.height)||Mi(c.height,"config.height",0,1e4),Gr(c.videoBitrate)||Mi(c.videoBitrate,"config.videoBitrate",1,1e6),Gr(c.videoFrameRate)||Mi(c.videoFrameRate,"config.videoFrameRate"),Gr(c.lowLatency)||gr(c.lowLatency,"config.lowLatency"),Gr(c.audioSampleRate)||Tn(c.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Gr(c.audioBitrate)||Mi(c.audioBitrate,"config.audioBitrate",1,128),Gr(c.audioChannels)||Tn(c.audioChannels,"config.audioChannels",[1,2,3,4,5]),Gr(c.videoGop)||Mi(c.videoGop,"config.videoGop"),Gr(c.videoCodecProfile)||Tn(c.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Gr(c.userCount)||Mi(c.userCount,"config.userCount",0,17),Gr(c.backgroundColor)||Mi(c.backgroundColor,"config.backgroundColor",0,16777215),Gr(c.userConfigExtraInfo)||ls(c.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),c.transcodingUsers&&!Gr(c.transcodingUsers)&&(Hi(c.transcodingUsers,"config.transcodingUsers"),c.transcodingUsers.forEach(((d,u)=>{Ch(d.uid),Gr(d.x)||Mi(d.x,"transcodingUser[".concat(u,"].x"),0,1e4),Gr(d.y)||Mi(d.y,"transcodingUser[".concat(u,"].y"),0,1e4),Gr(d.width)||Mi(d.width,"transcodingUser[".concat(u,"].width"),0,1e4),Gr(d.height)||Mi(d.height,"transcodingUser[".concat(u,"].height"),0,1e4),Gr(d.zOrder)||Mi(d.zOrder-1,"transcodingUser[".concat(u,"].zOrder"),0,100),Gr(d.alpha)||Mi(d.alpha,"transcodingUser[".concat(u,"].alpha"),0,1,!1)}))),Gr(c.watermark)||XV(c.watermark,"watermark"),Gr(c.backgroundImage)||XV(c.backgroundImage,"backgroundImage"),c.images&&!Gr(c.images)&&(Hi(c.images,"config.images"),c.images.forEach(((d,u)=>{XV(d,"images[".concat(u,"]"))})))})(n);const i=[];n.images&&i.push(...n.images.map((c=>yl(yl(yl({},zw),c),{},{zOrder:255})))),n.backgroundImage&&(i.push(yl(yl(yl({},zw),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(i.push(yl(yl(yl({},zw),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=i,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map((c=>yl({},c))),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const s=(n.userConfigs||[]).map((c=>typeof c.uid=="number"?De.resolve(c.uid):F4(c.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)));if((await De.all(s)).forEach(((c,d)=>{n.userConfigs&&n.userConfigs[d]&&(n.userConfigs[d].uid=c)})),this.transcodingConfig=n,this.connection)try{var o;const c=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(cs(o=this.streamingTasks).call(o)).map((d=>d.taskId)).join("#")});F.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(c.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(c){if(!c.data||!c.data.retry)throw c;c.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach((d=>{F.warning("[".concat(this.spec.clientId,"] live streaming receive error"),c.toString(),"try to republish",d.url),this.startLiveStreamingTask(d.url,d.mode,c).then((()=>{F.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(d.url," success"))})).catch((u=>{F.error("[".concat(this.spec.clientId,"] live streaming republish failed"),d.url,u.toString()),this.onLiveStreamError&&this.onLiveStreamError(d.url,u)}))}))}}async startLiveStreamingTask(t,n,i){if(!this.transcodingConfig&&n===Wm.TRANSCODE)throw new Pe(H.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const s={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};F.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const o=await this.taskMutex.lock();if(!this.connection&&i)return void o();if(this.streamingTasks.get(t)&&!i)return o(),new Pe(H.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(d){throw o(),d}switch(n){case Wm.TRANSCODE:s.transcodingConfig=yl({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(s.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const c=this.lastTaskId++;try{const d=new De(((p,m)=>{In(this.retryTimeout).then((()=>{if(i)return m(i);const g=this.statusError.get(t);return g?(this.statusError.delete(t),m(g)):void 0}))})),u=await De.race([this.connection.request("request",{clientRequest:s},!0,{url:t,command:"PublishStream",workerType:n===Wm.TRANSCODE?1:2,requestByUser:!i,tid:c.toString()}),d]);this.isStartingStreamingTask=!1,F.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(u.code)),this.streamingTasks.set(t,{clientRequest:s,mode:n,url:t,taskId:c}),o()}catch(d){if(o(),this.isStartingStreamingTask=!1,!d.data||!d.data.retry||i)throw d;return d.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,d)):await this.startLiveStreamingTask(t,n,d)}}stopLiveStreamingTask(t){return new De(((n,i)=>{const s=this.streamingTasks.get(t);if(!s||!this.connection)return new Pe(H.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const o=s.mode;s.abortTask=()=>{F.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:s.url}},!1,{url:t,command:"UnPublishStream",workerType:o===Wm.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then((c=>{F.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(c.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()})).catch(i)}))}resetAllTask(){var t;const n=Array.from(cs(t=this.streamingTasks).call(t));this.terminate();for(const i of n)this.startLiveStreamingTask(i.url,i.mode).catch((s=>{this.onLiveStreamError&&this.onLiveStreamError(i.url,s)}))}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Gc.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new Pe(H.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await On(this,Is.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new y6(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(S_.WARNING,((i,s)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(s,i))),this.connection.on(S_.PUBLISH_STREAM_STATUS,(i=>this.handlePublishStreamServer(i))),this.connection.on(S_.REQUEST_NEW_ADDRESS,((i,s)=>{if(!this.connection)return s(new Pe(H.UNEXPECTED_ERROR,"can not get new live streaming address list"));On(this,Is.REQUEST_WORKER_MANAGER_LIST,t).then((o=>{this.uapResponse=o,i(o.addressList)})).catch(s)})),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",i=this.streamingTasks.get(n),s=t.reason;switch(t.code){case Gs.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Gs.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Gs.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Gs.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const c=new Pe(H.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(i)return F.error(c.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,c);if(!this.isStartingStreamingTask)return;this.statusError.set(n,c)}case Gs.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const c=new Pe(H.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,s);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,c)}case Gs.LIVE_STREAM_RESPONSE_WORKER_LOST:case Gs.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var o;if(!this.connection)return;this.connection.tryNextAddress();const c=Array.from(cs(o=this.streamingTasks).call(o));for(const d of c)d.abortTask?d.abortTask():(F.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",d.url),this.startLiveStreamingTask(d.url,d.mode,new Pe(H.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then((()=>{F.debug("[".concat(this.spec.clientId,"] republish live stream success"),d.url)})).catch((u=>{F.error(u.toString()),this.onLiveStreamError&&this.onLiveStreamError(d.url,u)})));return}}}hasUrl(t){return this.streamingTasks.has(t)}}const KY={name:"LiveStreaming",create:function(e){return new HY(e.joinInfo,e.websocketRetryConfig||Es,e.httpRetryConfig||Es)}};function zY(e){let t=b6();return(function(n,i){let s=n.appId;s!==void 0&&(gi(i,10),M_(i,s));let o=n.cid;o!==void 0&&(gi(i,16),gi(i,o));let c=n.cname;c!==void 0&&(gi(i,26),M_(i,c));let d=n.deviceId;d!==void 0&&(gi(i,34),M_(i,d));let u=n.elapse;u!==void 0&&(gi(i,40),lE(i,u));let p=n.fileSize;p!==void 0&&(gi(i,48),lE(i,zv(p)));let m=n.height;m!==void 0&&(gi(i,56),lE(i,zv(m)));let g=n.jpg;g!==void 0&&(gi(i,66),gi(i,g.length),(function(We,Se){let we=hS(We,Se.length);We.bytes.set(Se,we)})(i,g));let T=n.networkType;T!==void 0&&(gi(i,72),lE(i,zv(T)));let R=n.osType;R!==void 0&&(gi(i,80),lE(i,zv(R)));let I=n.requestId;I!==void 0&&(gi(i,90),M_(i,I));let A=n.sdkVersion;A!==void 0&&(gi(i,98),M_(i,A));let w=n.sequence;w!==void 0&&(gi(i,104),lE(i,zv(w)));let k=n.sid;k!==void 0&&(gi(i,114),M_(i,k));let L=n.timestamp;L!==void 0&&(gi(i,120),lE(i,L));let j=n.uid;j!==void 0&&(gi(i,128),gi(i,j));let K=n.vid;K!==void 0&&(gi(i,136),gi(i,K));let W=n.width;W!==void 0&&(gi(i,144),lE(i,zv(W)));let Y=n.service;Y!==void 0&&(gi(i,152),gi(i,Y));let se=n.callbackData;se!==void 0&&(gi(i,162),M_(i,se));let de=n.jpgEncryption;de!==void 0&&(gi(i,168),gi(i,de));let ge=n.requestType;ge!==void 0&&(gi(i,176),gi(i,ge));let je=n.scorePorn;je!==void 0&&(gi(i,185),Mh(i,je));let _t=n.scoreSexy;_t!==void 0&&(gi(i,193),Mh(i,_t));let ht=n.scoreNeutral;ht!==void 0&&(gi(i,201),Mh(i,ht));let Ct=n.scene;Ct!==void 0&&(gi(i,208),gi(i,Ct));let Ft=n.ossFilePrefix;Ft!==void 0&&(gi(i,218),M_(i,Ft));let mn=n.serviceVendor;if(mn!==void 0)for(let We of mn){gi(i,226);let Se=b6();XY(We,Se),gi(i,Se.limit),I6(i,Se),sj(Se)}})(e,t),(function(n){let i=n.bytes,s=n.limit;return i.length===s?i:i.subarray(0,s)})(t)}function YY(e){return(function(n){let i={};e:for(;!Yv(n);){let s=li(n);switch(s>>>3){case 0:break e;case 1:i.code=li(n);break;case 2:i.msg=Ef(n,li(n));break;case 3:{let o=R6(n);i.data=qY(n),n.limit=o;break}default:C6(n,7&s)}}return i})({bytes:t=e,offset:0,limit:t.length});var t}function qY(e){let t={};e:for(;!Yv(e);){let n=li(e);switch(n>>>3){case 0:break e;case 1:t.requestId=Ef(e,li(e));break;case 2:t.requestType=li(e)>>>0;break;case 3:t.scorePorn=L0(e);break;case 4:t.scoreSexy=L0(e);break;case 5:t.scoreNeutral=L0(e);break;case 6:t.requestScene=li(e)>>>0;break;case 7:t.scene=li(e)>>>0;break;default:C6(e,7&n)}}return t}function XY(e,t){let n=e.service;n!==void 0&&(gi(t,8),gi(t,n));let i=e.vendor;i!==void 0&&(gi(t,16),gi(t,i));let s=e.token;s!==void 0&&(gi(t,26),M_(t,s));let o=e.callbackUrl;o!==void 0&&(gi(t,34),M_(t,o))}function R6(e){let t=li(e),n=e.limit;return e.limit=e.offset+t,n}function C6(e,t){switch(t){case 0:for(;128&oj(e););break;case 2:pk(e,li(e));break;case 5:pk(e,4);break;case 1:pk(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let ij=new Float32Array(1);new Uint8Array(ij.buffer);let Ac=new Float64Array(1),Na=new Uint8Array(Ac.buffer);function zv(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let rj=[];function b6(){const e=rj.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function sj(e){rj.push(e)}function pk(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function Yv(e){return e.offset>=e.limit}function hS(e,t){let n=e.bytes,i=e.offset,s=e.limit,o=i+t;if(o>n.length){let c=new Uint8Array(2*o);c.set(n),e.bytes=c}return e.offset=o,o>s&&(e.limit=o),i}function fk(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function Ef(e,t){let n=fk(e,t),i=String.fromCharCode,s=e.bytes,o="�",c="";for(let d=0;d<t;d++){let u,p,m,g,T=s[d+n];(128&T)==0?c+=i(T):(224&T)==192?d+1>=t?c+=o:(u=s[d+n+1],(192&u)!=128?c+=o:(g=(31&T)<<6|63&u,g<128?c+=o:(c+=i(g),d++))):(240&T)==224?d+2>=t?c+=o:(u=s[d+n+1],p=s[d+n+2],(49344&(u|p<<8))!=32896?c+=o:(g=(15&T)<<12|(63&u)<<6|63&p,g<2048||g>=55296&&g<=57343?c+=o:(c+=i(g),d+=2))):(248&T)==240?d+3>=t?c+=o:(u=s[d+n+1],p=s[d+n+2],m=s[d+n+3],(12632256&(u|p<<8|m<<16))!=8421504?c+=o:(g=(7&T)<<18|(63&u)<<12|(63&p)<<6|63&m,g<65536||g>1114111?c+=o:(g-=65536,c+=i(55296+(g>>10),56320+(1023&g)),d+=3))):c+=o}return c}function M_(e,t){let n=t.length,i=0;for(let c=0;c<n;c++){let d=t.charCodeAt(c);d>=55296&&d<=56319&&c+1<n&&(d=(d<<10)+t.charCodeAt(++c)-56613888),i+=d<128?1:d<2048?2:d<65536?3:4}gi(e,i);let s=hS(e,i),o=e.bytes;for(let c=0;c<n;c++){let d=t.charCodeAt(c);d>=55296&&d<=56319&&c+1<n&&(d=(d<<10)+t.charCodeAt(++c)-56613888),d<128?o[s++]=d:(d<2048?o[s++]=d>>6&31|192:(d<65536?o[s++]=d>>12&15|224:(o[s++]=d>>18&7|240,o[s++]=d>>12&63|128),o[s++]=d>>6&63|128),o[s++]=63&d|128)}}function I6(e,t){let n=hS(e,t.limit),i=e.bytes,s=t.bytes;for(let o=0,c=t.limit;o<c;o++)i[o+n]=s[o]}function oj(e){return e.bytes[fk(e,1)]}function _k(e,t){let n=hS(e,1);e.bytes[n]=t}function L0(e){let t=fk(e,8),n=e.bytes;return Na[0]=n[t++],Na[1]=n[t++],Na[2]=n[t++],Na[3]=n[t++],Na[4]=n[t++],Na[5]=n[t++],Na[6]=n[t++],Na[7]=n[t++],Ac[0]}function Mh(e,t){let n=hS(e,8),i=e.bytes;Ac[0]=t,i[n++]=Na[0],i[n++]=Na[1],i[n++]=Na[2],i[n++]=Na[3],i[n++]=Na[4],i[n++]=Na[5],i[n++]=Na[6],i[n++]=Na[7]}function li(e){let t,n=0,i=0;do t=oj(e),n<32&&(i|=(127&t)<<n),n+=7;while(128&t);return i}function gi(e,t){for(t>>>=0;t>=128;)_k(e,127&t|128),t>>>=7;_k(e,t)}function lE(e,t){let n=t.low>>>0,i=(t.low>>>28|t.high<<4)>>>0,s=t.high>>>24,o=s===0?i===0?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:s<128?9:10,c=hS(e,o),d=e.bytes;switch(o){case 10:d[c+9]=s>>>7&1;case 9:d[c+8]=o!==9?128|s:127&s;case 8:d[c+7]=o!==8?i>>>21|128:i>>>21&127;case 7:d[c+6]=o!==7?i>>>14|128:i>>>14&127;case 6:d[c+5]=o!==6?i>>>7|128:i>>>7&127;case 5:d[c+4]=o!==5?128|i:127&i;case 4:d[c+3]=o!==4?n>>>21|128:n>>>21&127;case 3:d[c+2]=o!==3?n>>>14|128:n>>>14&127;case 2:d[c+1]=o!==2?n>>>7|128:n>>>7&127;case 1:d[c]=o!==1?128|n:127&n}}function A6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}const JY=new Map([["moderation",1],["supervise",2]]);class QY extends rr{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(So.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=Ks(n=t.map((i=>JY.get(i)||0))).call(n,((i,s)=>i+s)),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this.qualityRatio}),6e4))}constructor(t){super(),Q(this,"name","AgoraRTCVideoContentInspect"),Q(this,"_connectionState",$o.CONNECTING),Q(this,"_innerConnectionState",void 0),Q(this,"sequence",0),Q(this,"inspectStartTime",void 0),Q(this,"workerManagerConnection",void 0),Q(this,"workerConnection",void 0),Q(this,"workerMessageLengthLimit",void 0),Q(this,"inspectIntervalMinimum",void 0),Q(this,"qualityRatio",void 0),Q(this,"_connectInfo",void 0),Q(this,"_cancelTokenSource",Gc.CancelToken.source()),Q(this,"_retryConfig",void 0),Q(this,"wmSequence",0),Q(this,"inspectInterval",void 0),Q(this,"inspectTimer",null),Q(this,"ossFilePrefix",void 0),Q(this,"extraInfo",void 0),Q(this,"_inspectType",void 0),Q(this,"_inspectMode",void 0),Q(this,"_quality",1),Q(this,"qualityTimer",null),Q(this,"_inspectId",void 0),Q(this,"_needWorkUrlOnly",!1),Q(this,"inspectImage",(()=>{if(this.connectionState!==$o.CONNECTED)throw new Pe(H.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval((()=>{this.connectionState===$o.CONNECTED?this.requestToInspectImage():F.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)}),this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()})),this._inspectId=Oi(5,"inspect-"),this.workerMessageLengthLimit=re("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=re("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=re("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Xw("worker-manager-"+this._inspectId,Es),this.on(So.STATE_CHANGE,((n,i)=>{this._innerConnectionState=n,F.debug("[".concat(this._inspectId,"] Inspect operation :").concat(kr[n]," ").concat(i||""))})),this.handleWorkerManagerEvents(),this.workerConnection=new Xw("worker-"+this._inspectId,Es),this.handleWorkerEvents()}async init(t,n){this.emit(So.STATE_CHANGE,kr.CONNECT_AP),this._connectInfo=t;const i=this._cancelTokenSource.token;return this._retryConfig=n,new De(((s,o)=>{this.on(So.CONNECTION_STATE_CHANGE,((c,d)=>{d===$o.CONNECTED&&s()})),this.requestAP(t,i,n).then((c=>{this.connectWorkerManager(c)})).catch((c=>{o(c)}))}))}async requestAP(t,n,i){const s=re("WEBCS_DOMAIN").map((d=>"https://".concat(d,"/api/v1"))),o=await(function(d,u,p,m){let{appId:g,areaCode:T,cname:R,sid:I,token:A,uid:w}=u;cf++;const k="image_moderation_api",L={service_name:k,json_body:JSON.stringify({appId:g,areaCode:T,cname:R,command:"allocateEdge",requestId:cf,seq:cf,sid:I,token:A,ts:Date.now(),uid:w+""})};let j,K,W=d[0];return Id((async()=>{j=Date.now();const Y=await id(W,{data:L,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(K=Date.now()-j,Y.code!==0){const je=new Pe(H.UNEXPECTED_RESPONSE,"image inspect ap error, code"+Y.code,{retry:!0,responseTime:K});throw F.error(je.toString()),je}const se=JSON.parse(Y.json_body);if(se.code!==200){const je=new Pe(H.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(se.code,", reason: ").concat(se.reason),{code:se.code,responseTime:K});throw F.error(je.toString()),je}if(!se.servers||!Array.isArray(se.servers)||se.servers.length===0){const je=new Pe(H.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:se.code,responseTime:K});throw F.error(je.toString()),je}const de=re("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ge=re("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:se.servers.map((je=>{let{address:_t,wss:ht}=je;if(_t&&ht)return"wss://".concat(_t.replace(/\./g,"-"),".").concat(de,":").concat(ge||ht)})).filter((je=>!!je)),workerToken:se.workerToken,vid:se.vid,responseTime:K}}),((Y,se)=>(fe.apworkerEvent(I,{success:!0,sc:200,serviceName:k,responseDetail:JSON.stringify(Y.addressList),firstSuccess:se===0,responseTime:K,serverIp:d[se%d.length]}),!1)),((Y,se)=>(fe.apworkerEvent(I,{success:!1,sc:Y.data&&Y.data.code||200,serviceName:k,responseTime:K,serverIp:d[se%d.length]}),!!(Y.code!==H.OPERATION_ABORTED&&Y.code!==H.UNEXPECTED_RESPONSE||Y.data&&Y.data.retry)&&(W=d[(se+1)%d.length],!0))),m)})(s,t,n,i);this.emit(So.STATE_CHANGE,kr.AP_CONNECTED);const{addressList:c}=o;return this.wmSequence++,c}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(So.STATE_CHANGE,kr.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(cn.CONNECTED,(async()=>{this.emit(So.STATE_CHANGE,kr.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(cn.CLOSED,(()=>{this._innerConnectionState<kr.GET_WORKER_MANAGER_RESPONSE&&F.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))})),this.workerManagerConnection.on(cn.FAILED,(()=>{this._innerConnectionState<kr.GET_WORKER_MANAGER_RESPONSE&&F.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))})),this.workerManagerConnection.on(cn.RECONNECTING,(()=>{this._innerConnectionState<kr.GET_WORKER_MANAGER_RESPONSE&&F.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))})),this.workerManagerConnection.on(cn.ON_MESSAGE,(async t=>{this.emit(So.STATE_CHANGE,kr.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const i=JSON.parse(t.data);if(i.code!==200)throw F.error("[".concat(this._inspectId,"] Unexpected code ").concat(i.code," from worker manager")),new Pe(H.UNEXPECTED_RESPONSE,"response code of worker is unexpected",i);if(!(i.serverResponse&&i.serverResponse.portWss&&n))throw F.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(i))),new Pe(H.UNEXPECTED_RESPONSE,"response content of worker is unexpected",i);{const s=re("VIDEO_INSPECT_WORKER_PORT")||i.serverResponse.portWss,o=n.replace(/:\d+\/?$/,":".concat(s));this.emit(So.STATE_CHANGE,kr.CONNECT_WORKER,o),this._needWorkUrlOnly?this.emit(So.REQUEST_NEW_WORKER_URL,o):await this.connectWorker(o)}})),this.workerManagerConnection.on(cn.WILL_RECONNECT,((t,n,i)=>{i(t)})),this.workerManagerConnection.on(cn.REQUEST_NEW_URLS,((t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)}))}handleWorkerEvents(){this.workerConnection.on(cn.CONNECTED,(async()=>{this.emit(So.STATE_CHANGE,kr.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=$o.CONNECTED})),this.workerConnection.on(cn.ON_MESSAGE,(async t=>{if(t.data instanceof ArrayBuffer){const i=YY(new Uint8Array(t.data));if(re("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&F.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(i)),i.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(So.INSPECT_RESULT,void 0,void 0);if(i.data&&i.data.scorePorn&&i.data.scoreSexy&&i.data.scoreNeutral){var n;const s={porn:i.data.scorePorn,sexy:i.data.scoreSexy,neutral:i.data.scoreNeutral},o=Ks(n=Object.keys(s)).call(n,((d,u)=>s[d]>s[u]?d:u),"porn"),c=Object.keys(s).find((d=>d===o));this.emit(So.INSPECT_RESULT,c)}else this.emit(So.INSPECT_RESULT,void 0,new Pe(H.UNEXPECTED_RESPONSE,i.code+"","There is an unexpected data on message"))}else this.emit(So.INSPECT_RESULT,void 0,new Pe(H.UNEXPECTED_RESPONSE,i.code+"",i.msg))}else F.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(So.INSPECT_RESULT,void 0,new Pe(H.UNEXPECTED_RESPONSE,"invalid worker message type"))})),this.workerConnection.on(cn.CLOSED,(()=>{this.connectionState=$o.CLOSED})),this.workerConnection.on(cn.FAILED,(()=>{this.connectionState=$o.CLOSED})),this.workerConnection.on(cn.RECONNECTING,(()=>{this.connectionState=this.connectionState===$o.CONNECTED?$o.RECONNECTING:$o.CONNECTING})),this.workerConnection.on(cn.WILL_RECONNECT,((t,n,i)=>{t==="recover"&&i(t),i("tryNext")})),this.workerConnection.on(cn.REQUEST_NEW_URLS,((t,n)=>{this.workerManagerConnection.close(),this.once(So.REQUEST_NEW_WORKER_URL,(i=>{t([i])})),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then((i=>{this.connectWorkerManager(i,!0)})).catch((i=>{n(i)}))}))}async requestToInspectImage(){this.sequence++;const t=Sc(this,So.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(So.INSPECT_RESULT,void 0,new Pe(H.INVALID_OPERATION,"Only the track being played can be inspected"));const i=await this.generateRequestData(t,n);this.workerConnection.sendMessage(i,!0,!0)}else this.emit(So.INSPECT_RESULT,void 0,new Pe(H.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:i,cname:s,cid:o,vid:c,sid:d,uid:u}=n;const p=Date.now(),m=await t.getCurrentFrameImage("image/jpeg",this.quality),g=await zD(m,i,s),T=this.sequence+"-"+o+"-"+u+"-"+p+"-"+Oi(12,""),R={appId:i,cid:o,cname:s,deviceId:"",elapse:(I=Number(p-this.inspectStartTime),{low:I|=0,high:I>>31,unsigned:I>=0}),fileSize:g.byteLength,jpgEncryption:2,height:m.height,width:m.width,jpg:g,networkType:6,osType:7,requestId:T,sdkVersion:"4.24.0",sequence:this.sequence,sid:d,timestamp:YF(p),uid:u,vid:c,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var I;this.extraInfo===void 0&&delete R.callbackData,this.ossFilePrefix===void 0&&delete R.ossFilePrefix;const A=zY(R);if(A.byteLength<this.workerMessageLengthLimit){if(re("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const w=(function(k){for(var L=1;L<arguments.length;L++){var j=arguments[L]!=null?arguments[L]:{};L%2?A6(Object(j),!0).forEach((function(K){Q(k,K,j[K])})):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(j)):A6(Object(j)).forEach((function(K){Object.defineProperty(k,K,Object.getOwnPropertyDescriptor(j,K))}))}return k})({},R);delete w.jpg,F.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(w))}return A}{const w=this.quality*this.qualityRatio;return this.quality=w,await this.generateRequestData(t,{appId:i,cname:s,cid:o,vid:c,sid:d,uid:u})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Gc.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=$o.CLOSED,this.emit(So.STATE_CHANGE,kr.CLOSED)}}const w6={name:"ContentInspect",create:function(e){let{config:t}=e;return(function(n){if(!n)throw new Pe(H.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new Pe(H.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const i=[...new Set(n.inspectType)];i.forEach((s=>{var o;if(!Re(o=["supervise","moderation"]).call(o,s))throw new Pe(H.INVALID_PARAMS,"".concat(s," is not a valid inspect type."))})),n.inspectType=i}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new Pe(H.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")})(t),new QY(t)}};var O6=S(xn.Object.getOwnPropertySymbols),ZY=Ut,$Y=kl.indexOf,aj=Qu,mk=ye([].indexOf),N6=!!mk&&1/mk([1],1,-0)<0;ZY({target:"Array",proto:!0,forced:N6||!aj("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return N6?mk(this,e,t)||0:$Y(this,e,t)}});var eq=to("Array","indexOf"),tq=ee,cj=eq,lj=Array.prototype,D6=function(e){var t=e.indexOf;return e===lj||tq(lj,e)&&t===lj.indexOf?cj:t},P6=S(D6);function k6(e,t){if(e==null)return{};var n,i,s=(function(c,d){if(c==null)return{};var u={};for(var p in c)if({}.hasOwnProperty.call(c,p)){if(P6(d).call(d,p)!==-1)continue;u[p]=c[p]}return u})(e,t);if(O6){var o=O6(e);for(i=0;i<o.length;i++)n=o[i],P6(t).call(t,n)===-1&&{}.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}let L6=class{get localCapabilities(){return Ki(this._localCapabilities)}get rtpCapabilities(){return Ki(this._rtpCapabilities)}get candidates(){return Ki(this._candidates)}get iceParameters(){return Ki(this._iceParameters)}get dtlsParameters(){return Ki(this._dtlsParameters)}constructor(e){Q(this,"sessionDesc",void 0),Q(this,"_localCapabilities",void 0),Q(this,"_rtpCapabilities",void 0),Q(this,"_candidates",void 0),Q(this,"_iceParameters",void 0),Q(this,"_dtlsParameters",void 0),Q(this,"setup",void 0),Q(this,"currentMidIndex",void 0),Q(this,"cname","o/i14u9pJrxRKAsu"),Q(this,"firefoxSsrcMidMap",new Map),e=Ki(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:s,localCapabilities:o,direction:c,setup:d,videoCodec:u,audioCodec:p}=e;let m;this.setup=d,m=c===Wt.RECEIVE_ONLY?Qo(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Qo(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=s,this._candidates=i,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=o;const g=c===Wt.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,T=c===Wt.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,R=c===Wt.RECEIVE_ONLY?s.send.videoCodecs:Ih(dt.VIDEO,g,T,u),I=c===Wt.RECEIVE_ONLY?s.send.audioCodecs:Ih(dt.AUDIO,g,T,p);for(const A of m.mediaDescriptions)A.attributes.iceUfrag=t.iceUfrag,A.attributes.icePwd=t.icePwd,A.attributes.fingerprints=n.fingerprints,A.attributes.candidates=i,A.attributes.setup=this.setup,A.media.mediaType==="application"&&(A.attributes.sctpPort="5000"),A.media.mediaType==="video"&&(A.media.fmts=R.map((w=>w.payloadType.toString(10))),A.attributes.payloads=R,A.attributes.extmaps=g.videoExtensions),A.media.mediaType==="audio"&&(A.media.fmts=I.map((w=>w.payloadType.toString(10))),A.attributes.payloads=I,A.attributes.extmaps=g.audioExtensions,C_(A));this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}toString(){return Wg(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every((t=>this.hasMid(t))):this.sessionDesc.mediaDescriptions.some((t=>t.attributes.mid===e))}send(e,t,n,i,s){n=n.replace(/ /g,"-");const{ssrcs:o,ssrcGroups:c}=R_(t,this.cname,re("SYNC_GROUP")?n:void 0),d=this.findPreloadMediaDesc(o);if(d){if(fi()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,d.attributes.mid),s&&(s.twcc||s.remb)){const u=this.sessionDesc.mediaDescriptions.indexOf(d);return this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(d,s),{mid:d.attributes.mid,needExchangeSDP:!0}}return{mid:d.attributes.mid,needExchangeSDP:!1}}{const u=this.findAvailableMediaIndex(e,o,i);let p;return u===-1?(p=this.createOrRecycleSendMedia(e,o,c,"sendonly",i,s),this.updateBundleMids()):(p=Ki(this.sessionDesc.mediaDescriptions[u]),p.attributes.direction="sendonly",p.attributes.ssrcs=o,p.attributes.ssrcGroups=c,this.sessionDesc.mediaDescriptions[u]=this.mungSendMediaDesc(p,s)),fi()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,p.attributes.mid),{needExchangeSDP:!0,mid:p.attributes.mid}}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter((n=>n.attributes.mid&&e.indexOf(n.attributes.mid)!==-1));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((n=>{n.attributes.ssrcs=[]})),this.updateBundleMids()}receive(e,t,n){const i=[];return e.forEach((s=>{const o=s._mediaStreamTrack.kind,c=this.findAvailableRecvMediaIndex(o);let d,u=!1;c===-1?(u=!0,d=this.createOrRecycleRecvMedia(s,[],"recvonly",t,n),this.updateBundleMids()):(d=Ki(this.sessionDesc.mediaDescriptions[c]),d.attributes.direction="recvonly"),i.push({mid:d.attributes.mid,needCreateTransceiver:u})})),i}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter((n=>e.indexOf(n.attributes.mid)!==-1));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((n=>{n.media.port="0",n.attributes.direction="inactive"})),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:t,protocol:n,address:i,port:s,type:o,relatedAddress:c,relatedPort:d,priority:u}=new RTCIceCandidate(e),p={foundation:t??"",componentId:"1",transport:n??"",priority:u?u+"":"",connectionAddress:i??"",port:s?s+"":"",type:o?o+"":"",relAddr:c??"",relPort:d?d+"":"",extension:{}};this.candidates.some((m=>m.priority===p.priority&&m.connectionAddress===p.connectionAddress&&m.port===p.port))||(this._candidates.push(p),this.sessionDesc.mediaDescriptions.forEach((m=>{m.attributes.candidates=this.candidates})))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,n,i,s){const o=e._mediaStreamTrack.kind,c=this.rtpCapabilities.recv,d=Ih(o,c,this.localCapabilities.send,o===dt.AUDIO?s:i),u=o===dt.VIDEO?c.videoExtensions:c.audioExtensions,p="".concat(++this.currentMidIndex);let m={media:{mediaType:o,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.map((T=>T.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:d,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(p)}};m=this.mungRecvMediaDsec(m,e);const g=this.findFirstClosedMedia(o);if(g){const T=this.sessionDesc.mediaDescriptions.indexOf(g);this.sessionDesc.mediaDescriptions[T]=m}else this.sessionDesc.mediaDescriptions.push(m);return m}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((n=>Re(e).call(e,n.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((n=>{n.attributes.direction="inactive"}))}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((n=>Re(e).call(e,n.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((n=>{n.attributes.direction="recvonly"}))}findAvailableMediaIndex(e,t,n){return this.sessionDesc.mediaDescriptions.findIndex((i=>{const s=i.media.mediaType===e&&i.media.port!=="0"&&(i.attributes.direction==="sendonly"||i.attributes.direction==="sendrecv")&&i.attributes.ssrcs.length===0;if(fi()){if(s){const o=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(o||i.attributes.mid!=="0"&&i.attributes.mid!=="1")||!(!o||o!==i.attributes.mid)}return!1}return s&&i.attributes.mid===n}))}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex((t=>{const n=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&n}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}restartICE(e){e=Ki(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}createOrRecycleSendMedia(e,t,n,i,s,o){const c=this.rtpCapabilities.send,d=e===dt.VIDEO?c.videoCodecs:c.audioCodecs,u=e===dt.VIDEO?c.videoExtensions:c.audioExtensions;fi()&&(s="".concat(++this.currentMidIndex));let p={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:d.map((g=>g.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:u,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:d,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:s}};p=this.mungSendMediaDesc(p,o);const m=this.findFirstClosedMedia(e);if(m){const g=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[g]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}mungRecvMediaDsec(e,t,n){const i=Ki(e);return t0(i),Qg(i,t),dP(i,t),n0(i),i0(i,n,this.localCapabilities.send),i}mungSendMediaDesc(e,t){const n=Ki(e);return i0(n,t,this.localCapabilities.recv),C_(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((i=>i.attributes.mid===e));if(n!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=i}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>e.media.port!=="0")).map((e=>e.attributes.mid))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var n;return((n=t.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===e[0].ssrcId}))}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>fi()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0"))}};const ar=["sdp"];var er;function dE(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function uE(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?dE(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dE(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}let ku=(er=class Ok extends QV{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,n,i){super(t,n),Q(this,"direction",void 0),Q(this,"name",void 0),Q(this,"store",void 0),Q(this,"spec",void 0),Q(this,"peerConnection",void 0),Q(this,"initialOffer",void 0),Q(this,"transport",void 0),Q(this,"statsFilter",void 0),Q(this,"localCandidateCount",0),Q(this,"_isInRestartIce",!1),Q(this,"mutex",void 0),Q(this,"onLocalCandidate",void 0),Q(this,"remoteSDP",void 0),Q(this,"pendingCandidates",[]),Q(this,"localCapabilities",void 0),Q(this,"isReady",!1),Q(this,"restartCnt",0),Q(this,"curTurnServerIndex",0),this.store=n,this.spec=t,this.mutex=new ro("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Ok.resolvePCConfiguration(t,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=i??Wt.SEND_ONLY,this.name=this.direction===Wt.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=LD(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,fi()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{const n=await sF();if(this.localCapabilities=zm(n),t){const{sdp:i}=t,s=k6(t,ar),o=(function(){const m={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},g=bh(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},R={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},I={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ed(g,m,"videoExtensions",T,R,I),ed(g,m,"videoCodecs",T,R,I),ed(g,m,"audioExtensions",T,R,I),ed(g,m,"audioCodecs",T,R,I),re("RAISE_H264_BASELINE_PRIORITY")){const A=I.videoCodecs.findIndex((w=>w.rtpMap&&w.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&w.fmtp&&w.fmtp.parameters["profile-level-id"]==="42001f"));if(A!==-1){const w=I.videoCodecs.findIndex((k=>k.rtpMap&&k.rtpMap.encodingName.toLocaleLowerCase()==="h264"));if(w<A){F.debug("raising H264 baseline profile priority");const k=I.videoCodecs[A];I.videoCodecs.splice(A,1),I.videoCodecs.splice(w,0,k)}w!==-1&&re("FILTER_SEND_H264_BASELINE")&&(T.videoCodecs=T.videoCodecs.filter((k=>!(k.rtpMap&&k.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&k.fmtp&&k.fmtp.parameters["profile-level-id"]!=="42001f"))))}}return{send:T,recv:R,sendrecv:I}})({},{},i);this.remoteSDP=new L6({remoteIceParameters:s.iceParameters,remoteDtlsParameters:s.dtlsParameters,candidates:[],remoteRTPCapabilities:o,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const c=await this.peerConnection.createAnswer();if(!c.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const d=Km(c.sdp);await this.peerConnection.setLocalDescription(c);const u=await Cu({},{},c.sdp);this.localCapabilities=zm(u);const p=this.peerConnection.getTransceivers()[0];return p!=null&&p.receiver&&p.receiver.transport&&this.tryBindTransportEvents(p.receiver.transport),uE(uE({},d),{},{sdp:c.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const s=Km(i.sdp);return this.initialOffer=i,uE(uE({},s),{},{sdp:i.sdp})}}catch(n){throw new Ge(H.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:i,dtlsParameters:s}=t,o=await Cu({},{},n);this.remoteSDP=new L6({remoteIceParameters:i,remoteDtlsParameters:s,candidates:[],remoteRTPCapabilities:o,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const c=this.peerConnection.getTransceivers()[0];c!=null&&c.sender&&c.sender.transport&&this.tryBindTransportEvents(c.sender.transport)}catch(n){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach((n=>{this.peerConnection.addIceCandidate(n)})),this.pendingCandidates=[])}catch(n){throw new Ge(H.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(t,n,i){var s=this;return jc((function*(){const o=yield Jn(s.mutex.lock("From P2PConnection.send"));try{if(!s.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const c=[],d=s.remoteSDP.receive(t,n,i);t.forEach(((w,k)=>{if(d[k].needCreateTransceiver){const L=s.peerConnection.addTransceiver(w._mediaStreamTrack,{direction:"sendonly"});c.push(L),w._updateRtpTransceiver(L)}else{const L=s.peerConnection.getTransceivers().find((j=>j.mid===d[k].mid));if(!L)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(d[k].mid));c.push(L),w._updateRtpTransceiver(L)}})),fi()&&re("SIMULCAST")===!0&&(yield Jn(s.applySimulcastForFirefox(c,t)));const u=d.map((w=>w.mid)),p=yield Jn(s.peerConnection.createOffer()),m=s.mungSendOfferSDP(p.sdp,t,u),g=Qo(m),T=u.map((w=>{const k=g.mediaDescriptions.find((L=>L.attributes.mid===w));if(!k)throw new Error("Cannot extract ssrc from mediaDescription.");return nF(k,re("USE_PUB_RTX"))})),R=c.map(((w,k)=>{const L=u[k];return{localSSRC:T[k],id:L}}));yield Jn(s.peerConnection.setLocalDescription({type:"offer",sdp:m}));try{yield R}catch(w){const k=s.remoteSDP.toString();throw yield Jn(s.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield Jn(s.peerConnection.setRemoteDescription({type:"answer",sdp:k})),yield Jn(s.stopSending(u,!0)),w}yield Jn(s.applySimulcastEncodings(c,t)),yield Jn(s.applySendEncodings(c,t));const I=s.remoteSDP.toString(),A=s.logSDPExchange(m,"offer","local","send");return A?.(I),yield Jn(s.setRemoteDescription({type:"answer",sdp:I})),c.map(((w,k)=>{const L=u[k];return{localSSRC:T[k],id:L}}))}catch(c){throw c instanceof Ge?c:new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(c.toString()))}finally{o()}}))()}async stopSending(t,n){const i=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const s=this.peerConnection.getTransceivers().filter((u=>t.indexOf(u.mid)!==-1));if(s.length!==t.length)throw new Error("Transceivers' length (".concat(s.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));s.map((u=>{var p;u.direction="inactive",(p=u.stop)===null||p===void 0||p.call(u)}));const o=await this.peerConnection.createOffer(),c=this.logSDPExchange(o.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(t);const d=this.remoteSDP.toString();c?.(d),await this.setRemoteDescription({type:"answer",sdp:d})}catch(s){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(s.toString()))}finally{i&&i()}}async receive(t,n,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:o,needExchangeSDP:c}=this.remoteSDP.send(t,n,i,s);if(c){const u=this.remoteSDP.toString(),p=this.logSDPExchange(u,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:u});const m=await this.peerConnection.createAnswer(),g=this.mungReceiveAnswerSDP(m.sdp,o,t);p?.(g||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:g}),F.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else F.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const d=this.peerConnection.getTransceivers().find((u=>u.mid===o));if(!d||d.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:d.receiver.track,mid:d.mid,transceiver:d}}catch(o){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async mockReceive(t,n,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:o,needExchangeSDP:c}=this.remoteSDP.send(t,n,i,s);if(c){const d=this.remoteSDP.toString(),u=this.logSDPExchange(d,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:d});const p=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(p.sdp,o,t);u?.(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),F.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else F.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(o){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),i=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const s=await this.peerConnection.createAnswer();i?.(s.sdp||""),await this.peerConnection.setLocalDescription(s)}catch(n){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===Bs.Auto&&(this.store.p2pTransport=Bs.SdRtn,ai().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Ok.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,ai().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Ok.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:i}=Km(n.sdp);return this.store.descriptionStart(),this.direction===Wt.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),i}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Wt.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:i}=Km(n.sdp);return await this.peerConnection.setLocalDescription(n),i}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const o=this.remoteSDP.toString(),c=this.logSDPExchange(s,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),c?.(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(i){throw new Ge(H.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getTransceivers().filter((s=>s.mid===t));i.length===1&&(this.isVP8Simulcast(n)?fi()||await this.applySimulcastEncodings(i,[n]):await this.applySendEncodings(i,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getTransceivers().find((s=>s.mid===n));i&&await i.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:i,remote:s}=n.getSelectedCandidatePair();return{local:uE(uE({},Ad),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port}),remote:uE(uE({},Ad),{},{candidateType:s.type,protocol:s.protocol,address:s.address,port:s.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,n;Re(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var n;t.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else F.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s={iceServers:[]};var o;return t.iceServers?s.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(_C(t.turnServer.servers)?s.iceServers=t.turnServer.servers:(s.iceServers&&s.iceServers.push(...Ok.turnServerConfigToIceServers(t.turnServer.servers,n,i)),re("USE_TURN_SERVER_OF_GATEWAY")&&s.iceServers&&t.turnServer.serversFromGateway&&s.iceServers.push(...Ok.turnServerConfigToIceServers(t.turnServer.serversFromGateway,n,i)),Re(o=[Bs.Relay,Bs.SdRtn]).call(o,n)&&(s.iceTransportPolicy="relay"),re("FORCE_TURN_TCP")?s.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((c=>{c.forceturn&&(s.iceTransportPolicy="relay")})))),re("ENABLE_ENCODED_TRANSFORM")&&ai().supportWebRTCEncodedTransform&&(s.encodedInsertableStreams=!0),F.debug("P2PConnection p2pTransport is ".concat(n)),s}static turnServerConfigToIceServers(t,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const s=[],o=t.filter((d=>d.tcpport));F.debug("P2PConnection turnServers is ".concat(o,", current index is ").concat(i));const c=o.length>i?o[i]:o[0];switch(n){case Bs.SdRtn:const d=t.filter((p=>{var m;return Re(m=p.username).call(m,"glb:")&&p.turnServerURL==p.turnServerURL})),u=d.length>i?d[i]:d[0];u&&(s.push({username:u.username,credential:u.password,credentialType:"password",urls:"turn:".concat(of(u.turnServerURL),":").concat(u.tcpport,"?transport=udp")}),s.push({username:u.username,credential:u.password,credentialType:"password",urls:"turns:".concat(of(u.turnServerURL),":").concat(u.tcpport,"?transport=tcp")}));break;case Bs.Relay:c&&(s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(of(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}));break;default:c&&(s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(c.turnServerURL,":").concat(c.tcpport,"?transport=udp")}),s.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(of(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}),s.push({username:c.username,credential:c.password,credentialType:"password",urls:"stun:".concat(c.turnServerURL,":").concat(c.tcpport)}))}return s}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var i;t!=null&&t.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,t.state))},t.onerror=i=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in i?i.error:i)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const i=t?.iceTransport.state;var s;i&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:i,remote:s}=n.getSelectedCandidatePair()||{};if(i&&s){const o=i.address+":"+i.port,c=s.address+":"+s.port;F.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(y_(o)),", remote ").concat(JSON.stringify(y_(c))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,n){var i;if(n||(n=this.peerConnection.getSenders().find((m=>m.track===t._mediaStreamTrack))),!n)return F.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return F.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!ai().supportSetRtpSenderParameters)return F.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const s={},o={};switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(t._encoderConfig){var c;const{bitrateMax:m,frameRate:g,scaleResolutionDownBy:T}=t._encoderConfig;m&&(o.maxBitrate=1e3*m),Re(c=t._hints).call(c,Ni.LOW_STREAM)&&(g&&(o.maxFramerate=Sl(g)),T&&T>=1&&(o.scaleResolutionDownBy=T))}if(re("DSCP_TYPE")&&_h()){var d;const m=re("DSCP_TYPE");Re(d=["very-low","low","medium","high"]).call(d,m)&&(o.networkPriority=m)}const u=n.getParameters(),p=(i=u.encodings)===null||i===void 0?void 0:i[0];fi()&&!p&&(s.encodings=[o]),p&&Object.assign(p,o),Object.assign(u,s),F.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(u.encodings))),await n.setParameters(u)}async applySendEncodings(t,n){try{if(!ai().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const s=t[i],o=n[i];o instanceof zi&&!this.isVP8Simulcast(o)&&await this.updateRtpSenderEncodings(o,s.sender)}}catch{F.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,i){const s=Qo(t);return n.forEach(((o,c)=>{const d=i[c],u=s.mediaDescriptions.find((p=>p.attributes.mid===d));u&&(Qg(u,o),rF(u,o,this.store.codec))})),Wg(s)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let u=0;u<t.length;u++){var i,s,o,c,d;const p=t[u],m=n[u];if(m instanceof zi&&!Re(i=m._hints).call(i,Ni.LOW_STREAM)&&(s=m._encoderConfig)!==null&&s!==void 0&&s.bitrateMax&&((o=m._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(c=m._scalabilityMode)!==null&&c!==void 0&&c.numSpatialLayers&&((d=m._scalabilityMode)===null||d===void 0?void 0:d.numSpatialLayers)>1&&this.store.codec==="vp8"){const g={},T={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};g.encodings=[{rid:"m",active:!0,maxBitrate:T.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:T.high}];const R=p.sender.getParameters();await p.sender.setParameters(Object.assign(R,g))}}}async applySimulcastEncodings(t,n){if(!fi()&&t.length===n.length)for(let i=0;i<t.length;i++){const s=n[i];if(s instanceof zi&&this.isVP8Simulcast(s)){const o=t[i],c={},d={high:1e3*(s._encoderConfig.bitrateMax-50),medium:5e4};c.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:d.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:d.medium,scaleResolutionDownBy:4}];const u=o.sender.getParameters();await o.sender.setParameters(Object.assign(u,c))}}}isVP8Simulcast(t){var n,i,s,o,c;return!!(t instanceof zi&&re("SIMULCAST")&&this.store.codec==="vp8"&&!Re(n=t._hints).call(n,Ni.LOW_STREAM)&&(i=t._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=t._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=t._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=t._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1)}logSDPExchange(t,n,i,s){if(re("SDP_LOGGING"))return F.upload("[".concat(this.store.clientId,"] exchanging ").concat(i," ").concat(n," SDP during P2PConnection.").concat(s,`
`),t),n==="offer"?o=>{this.logSDPExchange(o,"answer",i==="local"?"remote":"local",s)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter((c=>c.mid&&t.indexOf(c.mid)!==-1));if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map((c=>{c.direction="inactive"}));const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.muteRemote(t);const o=this.remoteSDP.toString();s?.(o),await this.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter((c=>c.mid&&t.indexOf(c.mid)!==-1));if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map((async c=>{c.direction="sendonly"}));const i=await this.peerConnection.createOffer(),s=this.logSDPExchange(i.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(i),this.remoteSDP.unmuteRemote(t);const o=this.remoteSDP.toString();s?.(o),await this.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(t,n){var i;if(n=n??((i=this.currentRemoteDescription)===null||i===void 0?void 0:i.sdp)){var s;const o=(s=Qo(n).mediaDescriptions.find((c=>c.attributes.mid===t)))===null||s===void 0?void 0:s.attributes.ssrcs;return o?.[0].ssrcId}}async setRemoteDescription(t){var n;await this.peerConnection.setRemoteDescription(t),Re(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,n,i){const s=Qo(t),o=s.mediaDescriptions.find((c=>c.attributes.mid===n));return o&&i===dt.AUDIO&&o.media.mediaType==="audio"&&C_(o),Wg(s)}},At(er.prototype,"establish",[Ea],Object.getOwnPropertyDescriptor(er.prototype,"establish"),er.prototype),At(er.prototype,"connect",[Ea],Object.getOwnPropertyDescriptor(er.prototype,"connect"),er.prototype),At(er.prototype,"receive",[Ea],Object.getOwnPropertyDescriptor(er.prototype,"receive"),er.prototype),At(er.prototype,"mockReceive",[Ea],Object.getOwnPropertyDescriptor(er.prototype,"mockReceive"),er.prototype),At(er.prototype,"stopReceiving",[Ea],Object.getOwnPropertyDescriptor(er.prototype,"stopReceiving"),er.prototype),At(er.prototype,"restartICE",[Ea],Object.getOwnPropertyDescriptor(er.prototype,"restartICE"),er.prototype),At(er.prototype,"close",[Ea],Object.getOwnPropertyDescriptor(er.prototype,"close"),er.prototype),At(er.prototype,"updateEncoderConfig",[Ea],Object.getOwnPropertyDescriptor(er.prototype,"updateEncoderConfig"),er.prototype),At(er.prototype,"updateSendParameters",[Ea],Object.getOwnPropertyDescriptor(er.prototype,"updateSendParameters"),er.prototype),At(er.prototype,"replaceTrack",[Ea],Object.getOwnPropertyDescriptor(er.prototype,"replaceTrack"),er.prototype),At(er.prototype,"muteLocal",[Ea],Object.getOwnPropertyDescriptor(er.prototype,"muteLocal"),er.prototype),At(er.prototype,"unmuteLocal",[Ea],Object.getOwnPropertyDescriptor(er.prototype,"unmuteLocal"),er.prototype),er);function Ea(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,o=await s.lock("From P2PConnection.".concat(t));try{for(var c=arguments.length,d=new Array(c),u=0;u<c;u++)d[u]=arguments[u];return await i.apply(this,d)}finally{o()}},n}let Uh=(function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e})({});var dj,uj,hj,pj,fj,_j,mj,Ej,gj,Sj,Cr,br;function M0(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function Ek(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?M0(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M0(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}let gf=(dj=qc(Uh.SEND_ONLY),uj=qc(Uh.SEND_ONLY),hj=qc(),pj=qc(Uh.RECEIVE_ONLY),fj=qc(Uh.RECEIVE_ONLY),_j=qc(Uh.RECEIVE_ONLY),mj=qc(Uh.RECEIVE_ONLY),Ej=qc(Uh.RECEIVE_ONLY),gj=qc(Uh.RECEIVE_ONLY),Sj=qc(),Cr=qc(Uh.RECEIVE_ONLY),br=class extends rr{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(kt.StateChange,t,this._state)}constructor(e,t){super(),Q(this,"isPlanB",!1),Q(this,"store",void 0),Q(this,"statsUploader",void 0),Q(this,"sendConnection",void 0),Q(this,"recvConnection",void 0),Q(this,"localTrackMap",new Map),Q(this,"remoteUserMap",new Map),Q(this,"localDataChannels",[]),Q(this,"pendingLocalTracks",[]),Q(this,"pendingRemoteTracks",[]),Q(this,"statsCollector",void 0),Q(this,"dtlsFailedCount",0),Q(this,"sendMutex",void 0),Q(this,"recvMutex",void 0),Q(this,"_state",ut.Disconnected),Q(this,"_restartStates",["disconnected","failed"]),Q(this,"reconnectInterval",void 0),Q(this,"uploadUnplinkStarted",!1),Q(this,"uploadDownlinkStarted",!1),Q(this,"uplinkStateUploadInterval",void 0),Q(this,"downlinkStatsUploadInterval",void 0),Q(this,"handleMuteLocalTrack",(async(n,i,s)=>{const o=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==ut.Connected)return void s(new Ge(H.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const u=this.filterTobeMutedTracks(n);if(u.length===0)return void i();const p=u.find((R=>R[0]==="videoLowTrack"));p&&p[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(u.map((R=>{let[,{id:I}]=R;return I})));let m=!1;var c,d;n.trackMediaType==="video"?m=!((c=this.localTrackMap.get(He.LocalAudioTrack))===null||c===void 0||!c.track._muted):m=((d=this.localTrackMap.get(He.LocalVideoTrack))===null||d===void 0?void 0:d.id)===void 0;const g=this.createMuteMessage(u);await ei(this,kt.RequestMuteLocal,g);const T=n.trackMediaType==="video"?Jg.MUTE_LOCAL_VIDEO:Jg.MUTE_LOCAL_AUDIO;await ei(this,kt.RequestP2PMuteLocal,{action:T,message:g,isMuteAll:m}),i()}catch(u){s(u)}finally{o()}})),Q(this,"handleUnmuteLocalTrack",(async(n,i,s)=>{const o=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==ut.Connected)return void s(new Ge(H.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const c=this.filterTobeUnmutedTracks(n);if(c.length===0)return void i();await this.sendConnection.unmuteLocal(c.map((p=>{let[,{id:m}]=p;return m})));const d=this.createUnmuteMessage(c),u=n.trackMediaType==="video"?Jg.UNMUTE_LOCAL_VIDEO:Jg.UNMUTE_LOCAL_AUDIO;await ei(this,kt.RequestP2PMuteLocal,{action:u,message:d}),i()}catch(c){s(c)}finally{o()}})),Q(this,"handleUpdateVideoEncoder",(async(n,i,s,o)=>{let c;typeof o=="boolean"&&o||(c=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const u=this.localTrackMap.get(He.LocalVideoTrack);if(!this.sendConnection||!u||u.track!==n||this.state!==ut.Connected)return void i();const{id:p,track:m}=u;p&&(await this.sendConnection.updateSendParameters(p,m),await this.sendConnection.updateEncoderConfig(p,m),this.emit(kt.UpdateVideoEncoder,m)),i()}catch(u){s(u)}finally{var d;(d=c)===null||d===void 0||d()}})),Q(this,"handleUpdateVideoSendParameters",(async(n,i,s)=>{const o=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const c=this.localTrackMap.get(He.LocalVideoTrack);if(!this.sendConnection||!c||c.track!==n||this.state!==ut.Connected)return void i();const{id:d,track:u}=c;d&&await this.sendConnection.updateSendParameters(d,u),i()}catch(c){s(c)}finally{o()}})),Q(this,"handleReplaceTrack",(async(n,i,s,o)=>{let c;F.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof o=="boolean"&&o||(c=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var d;const p=Array.from(this.localTrackMap.entries()).find((m=>{let[,{track:g}]=m;return n===g}));if(!this.sendConnection||!p||p[1].id===void 0||this.state!==ut.Connected)return void i();if(await((d=this.sendConnection)===null||d===void 0?void 0:d.replaceTrack(n,p[1].id)),p[0]===He.LocalVideoTrack&&ai().supportDualStreamEncoding){const m=this.localTrackMap.get(He.LocalVideoLowTrack);if(m){const g=n._mediaStreamTrack.clone();m.track._originMediaStreamTrack.stop(),m.track._mediaStreamTrack=g,m.track._originMediaStreamTrack=g,await new De(((T,R)=>{this.handleReplaceTrack(m.track,T,R,!0)}))}}i()}catch(p){s(p)}finally{var u;(u=c)===null||u===void 0||u()}})),Q(this,"handleGetLocalVideoStats",(n=>{n(this.statsCollector.getLocalVideoTrackStats())})),Q(this,"handleGetLocalAudioStats",(n=>{n(this.statsCollector.getLocalAudioTrackStats())})),Q(this,"handleGetRemoteVideoStats",(n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid])),Q(this,"handleGetRemoteAudioStats",(n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new K4(e),this.bindStatsUploaderEvents(),this.sendMutex=new ro("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new ro("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval((()=>{[this.sendConnection,this.recvConnection].forEach((n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))}))}),re("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new Ge(H.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new Ge(H.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let n;try{if(t){this.recvConnection&&(F.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new ku(e,this.store,Wt.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const i=await this.recvConnection.establish(t);return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}{this.state=ut.New,this.sendConnection&&(F.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new ku(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const i=await this.sendConnection.establish();return{iceParameters:i.iceParameters,dtlsParameters:i.dtlsParameters,sdp:i.sdp}}}finally{n&&n()}}async p2pConnect(e){if(!this.sendConnection)throw new Ge(H.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ut.Connected}async addRemoteCandidate(e,t){if(t===Wt.RECEIVE_ONLY){if(!this.sendConnection)throw new Ge(H.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Ge(H.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,n){var i=this;return jc((function*(){const s=yield Jn(i.sendMutex.lock("From P2PChannel.publish"));try{if(!i.sendConnection||i.state!==ut.Connected){i.throwIfTrackTypeNotMatch(e);const p=e.filter((m=>i.pendingLocalTracks.indexOf(m)===-1));return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(p))}i.store.pubId=i.store.pubId+1,ma.markPublishStart(i.store.clientId,i.store.pubId);const o=i.filterTobePublishedTracks(e,t,n);if(o.length===0)return void(yield Jn(i.tryToUnmuteAudio(e)));o.forEach((p=>{let{track:m,type:g}=p;const T=Date.now();i.store.publish(m.getTrackId(),g===He.LocalAudioTrack?"audio":"video",T)})),i.bindLocalTrackEvents(o);const c=yield Jn(i.sendConnection.send(o.map((p=>{let{track:m}=p;return m})),i.store.codec,i.store.audioCodec)),d=(yield Jn(c.next())).value,u=i.createGatewayPublishMessage(o,d);try{yield u}catch(p){throw c.throw(p),p?.code===H.WS_ABORT&&o.forEach((m=>{let{track:g}=m;i.pendingLocalTracks.indexOf(g)===-1&&i.pendingLocalTracks.push(g)})),i.unbindLocalTrackEvents(o),p}yield Jn(c.next()),o.forEach((p=>{let{type:m}=p;i.statsCollector.addLocalStats(m)})),i.statsUploader.startUploadOutboundStats(),i.assignLocalTracks(o,d),o.forEach((p=>{let{track:m,type:g}=p;const T=Date.now();i.store.publish(m.getTrackId(),g===He.LocalAudioTrack?"audio":"video",void 0,T)})),i.startUploadUplinkState()}finally{s()}}))()}async unpublish(e){if(!this.sendConnection||this.state!==ut.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter((s=>!Re(e).call(e,s))));const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find((s=>s[0]==="videoLowTrack"));n&&n[1].track.close();const i=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map((s=>{let[,{id:o}]=s;return o}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((s=>{let[o,{track:c}]=s;return{type:o,track:c}}))),t.forEach((s=>{let[o]=s;this.statsCollector.removeLocalStats(o)})),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===ut.Connected)return n&&n[1].track.close(),i;e.forEach((s=>{const o=this.pendingLocalTracks.indexOf(s);o!==-1&&this.pendingLocalTracks.splice(o,1)}))}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const t=[],n=[];Array.from(this.localTrackMap.entries()).forEach((i=>{let[s,{track:o,ssrcs:c}]=i;const d={stream_type:AF(o,s),ssrcs:c};o._muted||!o._enabled?t.push(d):n.push(d)})),t.length>0&&t.forEach((i=>{ei(this,kt.RequestMuteLocal,[i])})),n.length>0&&n.forEach((i=>{ei(this,kt.RequestUnmuteLocal,[i])}))};e(),this.uplinkStateUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return jc((function*(){throw new Ge(H.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")}))()}async republish(){this.pendingLocalTracks.length>0&&(F.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await On(this,kt.RequestRePublish,this.pendingLocalTracks),this.emit(kt.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Ge(H.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,n,i){var s;if(!this.recvConnection)throw new Ge(H.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((s=this.remoteUserMap.get(e))!==null&&s!==void 0&&s.has(t))return;const{track:o,mid:c,transceiver:d}=await this.recvConnection.receive(t,[{ssrcId:n}],String(e.uid),i);t===dt.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(o):(e._audioTrack=new $l(o,e.uid,e._uintid,this.store),F.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),d&&e._audioTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=n,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(o):(e._videoTrack=new tf(o,e.uid,e._uintid,this.store),F.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),d&&e._videoTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(e,e._videoTrack));const u=this.remoteUserMap.get(e);u?u.set(t,c):this.remoteUserMap.set(e,new Map([[t,c]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const p=this.pendingRemoteTracks.findIndex((m=>{let{user:g,kind:T}=m;return g.uid===e.uid&&t===T}));p!==-1&&(this.pendingRemoteTracks.splice(p,1),this.emit(kt.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,n,i){if(!this.recvConnection)throw new Ge(H.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:n}],String(e.uid),i)}async unsubscribe(e,t,n){const i=this.pendingRemoteTracks.filter((o=>{let{user:c,kind:d}=o;return t!==void 0?c.uid===e.uid&&t===d:c.uid===e.uid}));if(i.forEach((o=>{const c=this.pendingRemoteTracks.indexOf(o);this.pendingRemoteTracks.splice(c,1)})),this.recvConnection||n||i.forEach((o=>{let{kind:c}=o;var d;if(c===dt.AUDIO)(d=e._audioTrack)===null||d===void 0||d._destroy(),e._audioTrack=void 0;else if(c===dt.VIDEO){var u;(u=e._videoTrack)===null||u===void 0||u._destroy(),e._videoTrack=void 0}})),!this.recvConnection)return;const s=this.filterTobeUnSubscribedTracks(e,t);s.length!==0&&(await this.recvConnection.stopReceiving(s.map((o=>{let[,{id:c}]=o;return c}))),this.withdrawRemoteTracks(s),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),s.forEach((o=>{let[c,{kind:d}]=o;var u,p;if(d===dt.VIDEO&&c._videoSSRC&&((u=this.recvConnection)===null||u===void 0||u.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),d===dt.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),n||((p=c._videoTrack)===null||p===void 0||p._destroy(),c._videoTrack=void 0);else if(d===dt.AUDIO){var m;this.unbindRemoteTrackEvents(c._audioTrack),!n&&((m=c._audioTrack)===null||m===void 0||m._destroy(),c._audioTrack=void 0)}})),s.forEach((o=>{let[,{kind:c}]=o;ei(this,kt.RequestP2PMuteRemote,c)})))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach((t=>{let[,n]=t;[dt.VIDEO,dt.AUDIO].forEach((i=>{n.has(i)?ei(this,kt.RequestP2PUnmuteRemote,i):ei(this,kt.RequestP2PMuteRemote,i)}))}));e(),this.downlinkStatsUploadInterval=window.setInterval((()=>{e()}),3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Ge(H.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Ge(H.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Ge(H.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Ge(H.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void F.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void F.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const i=t===dt.VIDEO?e._videoSSRC:e._audioSSRC;i!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;const n=this.remoteUserMap.get(e);if(!n)return void F.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||F.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(He.LocalAudioTrack);if(t?.track instanceof Js){const n=t.track;return Array.from(this.localTrackMap.entries()).filter((i=>{let[s]=i;return s!==He.LocalAudioTrack})).filter((i=>{let[s]=i;return!(e&&s===He.LocalVideoLowTrack)})).map((i=>{let[,{track:s}]=i;return s})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((n=>{let[i]=n;return!(e&&i===He.LocalVideoLowTrack)})).map((n=>{let[,{track:i}]=n;return i}))}reportPublishEvent(e,t,n,i,s){if(e){const c=this.localTrackMap.get(He.LocalAudioTrack),d=i?this.localTrackMap.get(He.LocalVideoLowTrack):this.localTrackMap.get(He.LocalVideoTrack);fe.publish(this.store.sessionId,{eventElapse:ma.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c?.track.getTrackLabel(),videoName:d?.track.getTrackLabel(),screenshare:d?.track._hints.indexOf(Ni.SCREEN_TRACK)!==-1,audio:!!c,video:!!d,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}else{var o;n||(n=[]);const c=n.find((u=>u instanceof Rr)),d=i?(o=this.localTrackMap.get(He.LocalVideoTrack))===null||o===void 0?void 0:o.track:n.find((u=>u instanceof zi));fe.publish(this.store.sessionId,{eventElapse:ma.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:c?.getTrackLabel(),videoName:d?.getTrackLabel(),screenshare:d?._hints.indexOf(Ni.SCREEN_TRACK)!==-1,audio:!!c,video:!!d,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:s})}}reportSubscribeEvent(e,t,n,i){const s=i===dt.VIDEO?n._videoSSRC:n._audioSSRC;s&&fe.subscribe(this.store.sessionId,{succ:e,ec:t,video:i===dt.VIDEO,audio:i===dt.AUDIO,peerid:n.uid,subscribeRequestid:i===dt.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:ma.measureFromSubscribeStart(this.store.clientId,s)})}reset(){F.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new ro("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new ro("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(He.LocalAudioTrack);if(e?.track instanceof Js){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((n=>{t.removeAudioTrack(n)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=ut.Disconnected}getStats(e){var t,n;return e?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(He.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(He.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof zi||t&&t.track instanceof Rr?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(Ii(t=this.remoteUserMap).call(t)).find((i=>i.uid===e));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((n=>{let[i]=n;return{uid:i.uid,level:i.audioTrack?100*i.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get(He.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Zt(e).call(e,((n,i)=>n.level-i.level)),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(F.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=ut.Reconnecting,re("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach((e=>{var t;let[n,{track:i}]=e;switch(n){case He.LocalVideoTrack:Re(t=i._hints).call(t,Ni.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case He.LocalAudioTrack:i instanceof Js?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case He.LocalVideoLowTrack:}})),this.emit(kt.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;Array.from(Ii(n).call(n)).forEach((i=>{this.setPendingRemoteMedia(t,i)})),this.emit(kt.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),F.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:i,kind:s}=n;if((e instanceof Jm?e.uid:e)===i.uid&&t===s)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let n,i;if(e===Wt.SEND_ONLY){if(!this.sendConnection)throw new Ge(H.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection}else{if(!this.recvConnection)throw new Ge(H.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection}try{if(t){const s=await i.restartICE(t);return i.isInRestartIce=!1,s}{const s=await i.restartICE();if(s){const o=await On(this,kt.RequestP2PRestartICE,{direction:Wt.RECEIVE_ONLY,iceParameter:s});await i.restartICE(o),i.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),t=this.localTrackMap.get(He.LocalVideoTrack),n=this.localTrackMap.get(He.LocalAudioTrack),i=e.videoSend.find((R=>{var I;return R.ssrc===(t==null||(I=t.ssrcs)===null||I===void 0?void 0:I[0].ssrcId)})),s=e.audioSend.find((R=>{var I;return R.ssrc===(n==null||(I=n.ssrcs)===null||I===void 0?void 0:I[0].ssrcId)}));if(!i||!s)return 1;const o=Sc(this,kt.NeedSignalRTT),c=i?i.rttMs:void 0,d=s?s.rttMs:void 0,u=c&&d?(c+d)/2:c||d,p=(u&&o?(u+o)/2:u||o)||0,m=100*e.sendPacketLossRate*.7/50+.3*p/1500,g=m<.17?1:m<.36?2:m<.59?3:m<.1?4:5,T=t?.track;if(T&&T._encoderConfig&&T._hints.indexOf(Ni.SCREEN_TRACK)===-1){const R=T._encoderConfig.bitrateMax,I=e.bitrate.actualEncoded;if(R&&I){const A=(1e3*R-I)/(1e3*R);return Yg[A<.15?0:A<.3?1:A<.45?2:A<.6?3:4][g]}}return g}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[i]=n;const s=i._audioSSRC,o=i._videoSSRC,c=e.audioRecv.find((I=>I.ssrc===s)),d=e.videoRecv.find((I=>I.ssrc===o));if(!c&&!d)return void(t+=1);const u=Sc(this,kt.NeedSignalRTT),p=e.rtt,m=(p&&u?(p+u)/2:p||u)||0,g=c?c.jitterMs:void 0,T=e.recvPacketLossRate;let R=.7*T*100/50+.3*m/1500;g&&(R=.6*T*100/50+.2*m/1500+.2*g/400),t+=R<.1?1:R<.17?2:R<.36?3:R<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new De(((t,n)=>{this.handleMuteLocalTrack(e,t,n)}))}filterTobePublishedTracks(e,t,n){const i=[],s=ai(),o=this.getAllTracks();e=km(e=e.filter((u=>o.indexOf(u)===-1)));let c=!1,d=!1;for(const u of e){if(u instanceof zi&&(this.localTrackMap.has(He.LocalVideoTrack)||c?new Ge(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:u,type:He.LocalVideoTrack}),c=!0),t)){const p=this.getLowVideoTrack(u,n);i.push({track:p,type:He.LocalVideoLowTrack})}if(u instanceof Rr){const p=this.localTrackMap.get(He.LocalAudioTrack);if(p){if(!(p.track instanceof Js))throw new Ge(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new Ge(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(u),this.bindLocalAudioTrackEvents(u,!0)}else if(d){const m=i.find((g=>{let{type:T}=g;return T===He.LocalAudioTrack}));if(!(m.track instanceof Js))throw new Ge(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(u._bypassWebAudio)throw new Ge(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");m.track.addAudioTrack(u)}else{if(!s.webAudioMediaStreamDest||u instanceof Js||u._bypassWebAudio)i.push({track:u,type:He.LocalAudioTrack});else{const m=new Js;m.addAudioTrack(u),i.push({track:m,type:He.LocalAudioTrack})}d=!0}}}return i}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=km(e=e.filter((i=>n.indexOf(i)!==-1)));for(const i of e){if(i instanceof Rr){const s=this.localTrackMap.get(He.LocalAudioTrack);if(!s)continue;s.track instanceof Js?(s.track.removeAudioTrack(i),this.unbindLocalAudioTrackEvents(i),s.track.trackList.length===0&&(t.push([He.LocalAudioTrack,s]),s.track.close())):t.push([He.LocalAudioTrack,s])}if(i instanceof zi){const s=this.localTrackMap.get(He.LocalVideoTrack);if(!s)continue;t.push([He.LocalVideoTrack,s]);const o=this.localTrackMap.get(He.LocalVideoLowTrack);o&&t.push([He.LocalVideoLowTrack,o])}}return t}bindLocalTrackEvents(e){e.forEach((t=>{let{track:n,type:i}=t;switch(i){case He.LocalVideoTrack:n.addListener(rt.GET_STATS,this.handleGetLocalVideoStats),n.addListener(rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(rt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(rt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(rt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case He.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case He.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof Js?e.trackList.forEach((n=>{n.addListener(rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(rt.GET_STATS,this.handleGetLocalAudioStats),n.addListener(rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(rt.GET_STATS,this.handleGetLocalAudioStats),e.addListener(rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(rt.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((t=>{let[n,{track:i}]=t;return{track:i,type:n}}))),e.forEach((t=>{let{track:n,type:i}=t;switch(i){case He.LocalVideoTrack:n.off(rt.GET_STATS,this.handleGetLocalVideoStats),n.off(rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(rt.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(rt.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(rt.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case He.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case He.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof Js?e.trackList.forEach((t=>{t.off(rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(rt.GET_STATS,this.handleGetLocalAudioStats),t.off(rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(rt.GET_STATS,this.handleGetLocalAudioStats),e.off(rt.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(rt.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(rt.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(rt.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(rt.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof tf&&t.addListener(rt.GET_STATS,(n=>{n(this.handleGetRemoteVideoStats(e))})),t instanceof $l&&t.addListener(rt.GET_STATS,(n=>{n(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(rt.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;n.has(dt.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(dt.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((n,i)=>{var s;let o,{track:c,type:d}=n;switch(d){case He.LocalAudioTrack:o=gn.Audio;break;case He.LocalVideoTrack:o=Re(s=c._hints).call(s,Ni.SCREEN_TRACK)?gn.Screen:gn.High;break;case He.LocalVideoLowTrack:o=gn.Low}return{kind:d===He.LocalAudioTrack?dt.AUDIO:dt.VIDEO,stream_type:o,mid:t[i].id,ssrcs:t[i].localSSRC,isMuted:c.muted||!c.enabled}}))}createGatewayUnpublishMessage(e){return e.map((t=>{var n;let i,[s,{track:o,ssrcs:c,id:d}]=t;switch(s){case He.LocalVideoTrack:i=Re(n=o._hints).call(n,Ni.SCREEN_TRACK)?gn.Screen:gn.High;break;case He.LocalAudioTrack:i=gn.Audio;break;case He.LocalVideoLowTrack:i=gn.Low}return{stream_type:i,ssrcs:c,mid:d}}))}assignLocalTracks(e,t){e.forEach(((n,i)=>{let{track:s,type:o}=n;this.localTrackMap.set(o,{track:s,id:t[i].id,ssrcs:t[i].localSSRC})}))}withdrawLocalTracks(e){e.forEach((t=>{let[n]=t;this.localTrackMap.delete(n)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var n;F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(kt.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),Re(n=this._restartStates).call(n,t)&&!e.isInRestartIce&&(t==="disconnected"&&await In(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),fe.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Tr.TRACER}).onSuccess(),this.emit(kt.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const i=Array.from(Ii(n=this.remoteUserMap).call(n)).find((o=>o._audioSSRC===t));var s;i&&(this.store.subscribe(i.uid,"audio",void 0,void 0,void 0,Date.now()),(s=i.audioTrack)===null||s===void 0||s.emit(vc.FIRST_FRAME_DECODED),fe.firstRemoteFrame(this.store.sessionId,Nn.FIRST_AUDIO_DECODE,yr.FIRST_AUDIO_DECODE,{peer:i._uintid,subscribeElapse:ma.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const i=Array.from(Ii(n=this.remoteUserMap).call(n)).find((s=>s._audioSSRC===t));i&&fe.firstRemoteFrame(this.store.sessionId,Nn.FIRST_AUDIO_RECEIVED,yr.FIRST_AUDIO_RECEIVED,{peer:i._uintid,subscribeElapse:ma.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,i)=>{this.reportVideoFirstFrameDecoded(t,n,i)},e.onFirstVideoReceived=t=>{var n;const i=Array.from(Ii(n=this.remoteUserMap).call(n)).find((s=>s._videoSSRC===t));i&&fe.firstRemoteFrame(this.store.sessionId,Nn.FIRST_VIDEO_RECEIVED,yr.FIRST_VIDEO_RECEIVED,{peer:i._uintid,subscribeElapse:ma.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const i=t.candidateType==="relay",s=n.candidateType==="relay";n.candidateType!=="unknown"&&i===s||this.emit(kt.ConnectionTypeChange,i),F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(xd(n))," -> ").concat(JSON.stringify(xd(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{F.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(xd(n))," -> ").concat(JSON.stringify(xd(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(kt.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const t=e===Wt.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,F.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Wt.SEND_ONLY?this.restartICE(e):On(this,kt.RequestP2PRestartICE,{direction:Wt.SEND_ONLY}))}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(He.LocalAudioTrack);if(e instanceof Rr&&n?.track instanceof Js)return n.track.isActive||t.push([He.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find((s=>{let[,{track:o}]=s;return e===o}));if(i&&(t.push(i),i[0]===He.LocalVideoTrack)){const s=this.localTrackMap.get(He.LocalVideoLowTrack);s&&t.push([He.LocalVideoLowTrack,s])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(He.LocalAudioTrack);if(e instanceof Rr&&n?.track instanceof Js)return n.track.isActive&&t.push([He.LocalAudioTrack,n]),t;const i=Array.from(this.localTrackMap.entries()).find((s=>{let[,{track:o}]=s;return e===o}));if(i)if(i[0]===He.LocalVideoTrack){t.push(i);const s=this.localTrackMap.get(He.LocalVideoLowTrack);s&&t.push([He.LocalVideoLowTrack,s])}else t.push(i);return t}createMuteMessage(e){return e.map((t=>{var n;let i,[s,{track:o,ssrcs:c,id:d}]=t;switch(s){case He.LocalAudioTrack:i=gn.Audio;break;case He.LocalVideoTrack:i=Re(n=o._hints).call(n,Ni.SCREEN_TRACK)?gn.Screen:gn.High;break;case He.LocalVideoLowTrack:i=gn.Low}return{stream_type:i,ssrcs:c,mid:d}}))}createUnmuteMessage(e){return e.map((t=>{var n;let i,[s,{track:o,ssrcs:c,id:d}]=t;switch(s){case He.LocalAudioTrack:i=gn.Audio;break;case He.LocalVideoTrack:i=Re(n=o._hints).call(n,Ni.SCREEN_TRACK)?gn.Screen:gn.High;break;case He.LocalVideoLowTrack:i=gn.Low}return{stream_type:i,ssrcs:c,mid:d}}))}filterTobeUnSubscribedTracks(e,t){const n=[],i=this.remoteUserMap.get(e);if(!i)return n;if(t){const s=i.get(t);if(!s)return n;n.push([e,{kind:t,id:s}])}else Array.from(i.entries()).forEach((s=>{let[o,c]=s;n.push([e,{kind:o,id:c}])}));return n}createUnsubscribeMessage(e){const t=[];return e.forEach((n=>{let[i,{kind:s,id:o}]=n;switch(s){case dt.VIDEO:return void(i._videoSSRC&&t.push({stream_type:dt.VIDEO,ssrcId:i._videoSSRC}));case dt.AUDIO:return void(i._audioSSRC&&t.push({stream_type:dt.AUDIO,ssrcId:i._audioSSRC}))}})),t}withdrawRemoteTracks(e){e.forEach((t=>{let[n,{kind:i}]=t;const s=this.remoteUserMap.get(n);s&&(s.delete(i),Array.from(s.entries()).length===0&&this.remoteUserMap.delete(n))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get(He.LocalVideoTrack),n=this.localTrackMap.get(He.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new De(((i,s)=>{this.handleUpdateVideoEncoder(t.track,i,s,!0)}))),n&&e.low_stream_uplink&&(await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new De(((i,s)=>{this.handleUpdateVideoEncoder(n.track,i,s,!0)})))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof Rr){const n=this.filterTobeUnmutedTracks(e[t]);if(n.length===0)continue;const i=this.createUnmuteMessage(n);return void await ei(this,kt.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter((e=>{let[,{ssrcs:t}]=e;return!!t})),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(kt.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(kt.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await In(Tu(this.dtlsFailedCount,Es)),this.emit(kt.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(He.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof zi))}throwIfTrackTypeNotMatch(e){if(e.filter((t=>t instanceof zi)).length>1)throw new Ge(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((t=>t instanceof Rr)).length>1&&(e.some((t=>t instanceof Rr&&t._bypassWebAudio))||!ai().webAudioMediaStreamDest))throw new Ge(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof zi&&this.pendingLocalTracks.some((n=>n instanceof zi)))throw new Ge(H.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof Rr&&this.pendingLocalTracks.some((n=>n instanceof Rr))&&(!ai().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((n=>n instanceof Rr&&n._bypassWebAudio))))throw new Ge(H.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=!re("DISABLE_DUAL_STREAM_USE_ENCODING")&&ai().supportDualStreamEncoding,i=Ek(Ek({},{width:160,height:120,framerate:15,bitrate:50}),t);let s;s=n?e._mediaStreamTrack.clone():CP(e,i);const o=Oi(8,"track-low-"),c=new zi(s,Ek(Ek({},n&&{scaleResolutionDownBy:v_(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,o);return c.on(Sh.TRANSCEIVER_UPDATED,(d=>{e._updateRtpTransceiver(d,bC.LOW_STREAM)})),c._hints.push(Ni.LOW_STREAM),e.addListener(rt.NEED_CLOSE,(()=>{c.close()})),c}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,n,i){var s;const o=Array.from(Ii(s=this.remoteUserMap).call(s)).find((c=>c._videoSSRC===e));if(o){i||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const c=this.store.keyMetrics,d=c.subscribe.find((u=>u.userId===o.uid&&u.type==="video"));fe.firstRemoteVideoDecode(this.store.sessionId,Nn.FIRST_VIDEO_DECODE,yr.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:n,subscribeElapse:ma.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:c.requestAPEnd||0,apStart:c.requestAPStart||0,joinGwEnd:c.joinGatewayEnd||0,joinGwStart:c.joinGatewayStart||0,pcEnd:c.peerConnectionEnd||0,pcStart:c.peerConnectionStart||0,subscriberEnd:d?.subscribeEnd||0,subscriberStart:d?.subscribeStart||0,videoAddNotify:d?.streamAdded||0,state:i?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.recvConnection)return!1;const i=this.remoteUserMap.get(e);if(!i)return!1;const s=i.get(t);if(!s)return!1;const o=await this.recvConnection.getRemoteSSRC(s);return o!==void 0&&o!==n}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new Ge(H.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Ge(H.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new Ge(H.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new Ge(H.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new Ge(H.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new Ge(H.NOT_SUPPORTED)}async preConnect(e){throw new Ge(H.NOT_SUPPORTED)}getEstablishParams(){throw new Ge(H.NOT_SUPPORTED)}async reSubscribe(e){throw new Ge(H.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,t){throw new Ge(H.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;t===He.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,bC.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}},At(br.prototype,"p2pConnect",[dj],Object.getOwnPropertyDescriptor(br.prototype,"p2pConnect"),br.prototype),At(br.prototype,"unpublish",[uj],Object.getOwnPropertyDescriptor(br.prototype,"unpublish"),br.prototype),At(br.prototype,"unpublishLowStream",[hj],Object.getOwnPropertyDescriptor(br.prototype,"unpublishLowStream"),br.prototype),At(br.prototype,"subscribe",[pj],Object.getOwnPropertyDescriptor(br.prototype,"subscribe"),br.prototype),At(br.prototype,"mockSubscribe",[fj],Object.getOwnPropertyDescriptor(br.prototype,"mockSubscribe"),br.prototype),At(br.prototype,"unsubscribe",[_j],Object.getOwnPropertyDescriptor(br.prototype,"unsubscribe"),br.prototype),At(br.prototype,"muteRemote",[mj],Object.getOwnPropertyDescriptor(br.prototype,"muteRemote"),br.prototype),At(br.prototype,"unmuteRemote",[Ej],Object.getOwnPropertyDescriptor(br.prototype,"unmuteRemote"),br.prototype),At(br.prototype,"hasRemoteMediaWithLock",[gj],Object.getOwnPropertyDescriptor(br.prototype,"hasRemoteMediaWithLock"),br.prototype),At(br.prototype,"disconnectForReconnect",[Sj],Object.getOwnPropertyDescriptor(br.prototype,"disconnectForReconnect"),br.prototype),At(br.prototype,"remoteMediaSsrcChanged",[Cr],Object.getOwnPropertyDescriptor(br.prototype,"remoteMediaSsrcChanged"),br.prototype),br);function qc(e){return function(t,n,i){const s=t[n];if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];switch(e){case Uh.SEND_ONLY:{const u=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await s.apply(this,c)}finally{u()}}case Uh.RECEIVE_ONLY:{const u=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await s.apply(this,c)}finally{u()}}default:{const u=await this.sendMutex.lock("From P2PChannel2.".concat(n)),p=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await s.apply(this,c)}finally{u(),p()}}}},i}}class qv extends rr{constructor(t,n){super(),Q(this,"signal",void 0),Q(this,"token",void 0),Q(this,"tokenTimeout",void 0),Q(this,"tokenInterval",void 0),Q(this,"_sequence",0),Q(this,"userMap",new Map),Q(this,"encoder",new TextEncoder),this.signal=t,this.token=n;const i=()=>{this.signal.connectionState===Pt.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(i,1e3):this.tokenInterval=window.setTimeout(i,3*re("P2P_TOKEN_INTERVAL"))};i()}async send(t,n,i,s,o){var c;if(this.userMap.size===0)return;const d=Array.from(cs(c=this.userMap).call(c))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),s=s??Oi(6,""),o=o??this._sequence++;const u={_id:s,_type:t,_seq:o,_message:n,token:"".concat(this.token,"_").concat(d)};re("SHOW_P2P_LOG")&&F.debug("send message",u,"noNeedResponse : ".concat(i)),this.splitMessage(JSON.stringify(u)).forEach((m=>{this.signal.request(Yt.DATA_STREAM,{payload:Mm(this.encoder.encode(m))})}));const p=new De(((m,g)=>{const T=window.setTimeout((()=>{this.off("res-@".concat(s,"_ack"),R),this.off("res-@".concat(s),A),this.off(Ru.ABORT,I),F.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(s)),this.userMap.size===0?g(new Ge(H.INVALID_REMOTE_USER)):g(new Ge(H.TIMEOUT))}),re("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),R=()=>{T&&window.clearTimeout(T),this.off(Ru.ABORT,I),i&&m()},I=()=>{T&&window.clearTimeout(T),this.off("res-@".concat(s,"_ack"),R),this.off("res-@".concat(s),A),g(new Ge(H.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(s)))};this.once(Ru.ABORT,I),this.once("res-@".concat(s,"_ack"),R);const A=(k,L)=>{w=!0,T&&window.clearTimeout(T),this.off("res-@".concat(s,"_ack"),R),this.off(Ru.ABORT,I),k==="success"?m(L):g(new Ge(H.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(s)))};let w=!1;i||(this.once("res-@".concat(s),A),In(re("SIGNAL_REQUEST_TIMEOUT")).then((()=>{w||F.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(s,", ").concat(u))})))}));try{return await p}catch(m){if(m.code===H.TIMEOUT)return await this.send(t,n,i,s,o);throw m}}onMessage(t){var n;const{_uid:i}=t;let s,o=this.userMap.get(i);if(o)s=o.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==Mr.CHECK)return;const{token:p}=t;s=new Map,o={uid:i,isStart:!0,token:p,splitMessageMap:s,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(i,o),this.signal.emit(an.ON_USER_ONLINE,{uid:i}),this.handleUserOnline()}if("id"in t&&"total"in t){var c;const{id:p,total:m}=t,g=(c=s.get(p))!==null&&c!==void 0?c:[];if(g.push(t),s.has(p)||s.set(p,g),g.length!==m)return;{const T=Zt(g).call(g,((R,I)=>R.index-I.index)).map((R=>R.payload)).join("");s.delete(p),(t=JSON.parse(T))._uid=i}}const{_type:d,token:u}=t;if(Re(n=[Mr.ACK,Mr.CHECK]).call(n,d))return d===Mr.CHECK&&this.handleCheckToken(o,u),void this.receiveMessage(t);u==="".concat(o.token,"_").concat(this.token)?this.handleReceivedMessage(t):F.debug('Receive unexpected message", '.concat(u,", cur_token: ").concat(o.token,"_").concat(this.token),t)}check(){const t={_id:Oi(6,""),token:this.token,_type:Mr.CHECK};re("SHOW_P2P_LOG")&&F.debug("send message",t),this.signal.request(Yt.DATA_STREAM,{payload:Mm(this.encoder.encode(JSON.stringify(t)))})}ack(t){const n={_id:t,_type:Mr.ACK,token:this.token};re("SHOW_P2P_LOG")&&F.debug("send message",n),this.signal.request(Yt.DATA_STREAM,{payload:Mm(this.encoder.encode(JSON.stringify(n)))})}response(t,n,i){this.send(Mr.RESPONSE,JSON.stringify({success:!i,message:n}),!0,t)}handleReceivedMessage(t){const n=()=>{this.userMap.forEach((p=>{const{receivedMessagesMap:m,nextExpectedSequenceNumber:g}=p;for(;m.has(g);){const T=m.get(g);m.delete(g),this.receiveMessage(T),p.nextExpectedSequenceNumber++}}))};if(!t)return void n();const{_uid:i,_seq:s}=t,o=this.userMap.get(i),{receivedMessagesMap:c,isStart:d,nextExpectedSequenceNumber:u}=o;if(s<u)return this.ack(t._id),void F.debug("[external-signal] receive old message, seq: ".concat(s,", ").concat(t._message));c.set(s,t),d&&s===u&&(this.receiveMessage(t),c.delete(u),o.nextExpectedSequenceNumber++,n())}receiveMessage(t){const{_id:n,_type:i,_message:s,_uid:o}=t;if(re("SHOW_P2P_LOG")&&F.debug("receive message",t),n){let c;switch(t._type!==Mr.ACK&&(s&&(c=JSON.parse(s)),this.ack(t._id)),t._type){case Mr.CANDIDATE:case Mr.CONTROL:this.signal.emit(i,c,o);break;case Mr.PUBLISH:case Mr.UNPUBLISH:case Mr.RESTART_ICE:case Mr.CALL:c.uid=o,On(this.signal,i,c).then((d=>{this.response(t._id,d)})).catch((()=>{this.response(t._id,void 0,!0)}));break;case Mr.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case Mr.RESPONSE:{const{success:d,message:u}=c;this.emit("res-@".concat(n),d?"success":"failed",u);break}}}}splitMessage(t){if(t.length<qv.MAX_MESSAGE_SIZE)return[t];const n=[],{remoteToken:i}=JSON.parse(t),s=Oi(6,"");let o=0,c=800;const d=Math.ceil(t.length/c);for(;t.length>0;){o++;const u={id:s,index:o,total:d,payload:t.slice(0,c),token:"".concat(this.token,"_").concat(i)};JSON.stringify(u).length>qv.MAX_MESSAGE_SIZE?c-=50:(n.push(u),t=t.slice(c))}return n.map((u=>JSON.stringify(u)))}handleCheckToken(t,n){return t.token!==n?(F.debug("token changed, from ".concat(t.token," to ").concat(n)),this.reset(t.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout((()=>{F.debug("token timeout, ".concat(n)),this.reset(t.uid)}),re("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const t=await On(this.signal,Mr.CALL,void 0),n=await this.send(Mr.CALL,t);this.signal.emit(st.P2P_CONNECTION,n,!0)}async reset(t,n){const i=this.userMap.get(t);i&&(this.emit(Ru.ABORT),this.signal.emit(an.ON_USER_OFFLINE,{uid:i.uid,reason:Kz.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(F.debug("change local token from ".concat(n," to ").concat(n)),this.token=Oi(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Ru.ABORT)}}Q(qv,"MAX_SIZE",1),Q(qv,"MAX_MESSAGE_SIZE",1024);class nq extends rr{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Pt.CONNECTED?this.emit(st.WS_CONNECTED):t===Pt.RECONNECTING?this.emit(st.WS_RECONNECTING,this._websocketReconnectReason):t===Pt.CLOSED&&this.emit(st.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),Q(this,"_disconnectedReason",void 0),Q(this,"_websocketReconnectReason",void 0),Q(this,"_connectionState",Pt.CLOSED),Q(this,"reconnectToken",void 0),Q(this,"p2pToken",void 0),Q(this,"websocket",void 0),Q(this,"openConnectionTime",void 0),Q(this,"clientId",void 0),Q(this,"lastMsgTime",Date.now()),Q(this,"uploadCache",[]),Q(this,"uploadCacheInterval",void 0),Q(this,"rttRolling",new Iw(5)),Q(this,"pingpongTimer",void 0),Q(this,"pingpongTimeoutCount",0),Q(this,"joinResponse",void 0),Q(this,"multiIpOption",void 0),Q(this,"initError",void 0),Q(this,"spec",void 0),Q(this,"store",void 0),Q(this,"_external_signal",void 0),Q(this,"onWebsocketMessage",(i=>{if(i.data instanceof ArrayBuffer)return void this.emit(st.ON_BINARY_DATA,i.data);const s=JSON.parse(i.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(s,"_id")){const o="res-@".concat(s._id);this.emit(o,s._result,s._message)}else if(Object.prototype.hasOwnProperty.call(s,"_type")){switch(s._type){case an.ON_DATA_STREAM:return void this.handleDataStream(s._message);case an.MUTE_AUDIO:case an.MUTE_VIDEO:case an.ON_P2P_LOST:case an.ON_USER_ONLINE:return;case an.ON_USER_OFFLINE:const{uid:o}=s._message;return F.debug("[".concat(this.clientId,"] user-offline uid: ").concat(o)),void this._external_signal.reset(o)}if(this.emit(s._type,s._message),s._type===an.ON_NOTIFICATION&&this.handleNotification(s._message),s._type===an.ON_USER_BANNED)switch(s._message.error_code){case 14:this.close(Ti.UID_BANNED);break;case 15:this.close(Ti.IP_BANNED);break;case 16:this.close(Ti.CHANNEL_BANNED)}if(s._type===an.ON_USER_LICENSE_BANNED)switch(s._message.error_code){case gt.ERR_LICENSE_MISSING:this.close(Ti.LICENSE_MISSING);break;case gt.ERR_LICENSE_EXPIRED:this.close(Ti.LICENSE_EXPIRED);break;case gt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Ti.LICENSE_MINUTES_EXCEEDED);break;case gt.ERR_LICENSE_PERIOD_INVALID:this.close(Ti.LICENSE_PERIOD_INVALID);break;case gt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Ti.LICENSE_MULTIPLE_SDK_SERVICE);break;case gt.ERR_LICENSE_ILLEGAL:this.close(Ti.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new Ov("gateway-".concat(this.clientId),this.spec.retryConfig,!0,re("JOIN_GATEWAY_USE_DUAL_DOMAIN"),re("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===Pt.CONNECTED&&this.reconnect("retry",vr.OFFLINE)})),this.p2pToken=Oi(6,""),this._external_signal=new qv(this,this.p2pToken)}async request(t,n,i,s){const o=Oi(6,""),c={_id:o,_type:t,_message:n},d=this.websocket.connectionID,u=()=>new De(((I,A)=>{if(this.connectionState===Pt.CONNECTED)return I();const w=()=>{this.off(st.WS_CLOSED,k),I()},k=()=>{this.off(st.WS_CONNECTED,w),A(new Ge(H.WS_ABORT))};this.once(st.WS_CONNECTED,w),this.once(st.WS_CLOSED,k)}));if(this.connectionState!==Pt.CONNECTING&&this.connectionState!==Pt.RECONNECTING||t===Yt.JOIN||t===Yt.REJOIN||await u(),this.websocket.sendMessage(c,!0),s)return;const p=new De(((I,A)=>{let w=!1;const k=(j,K)=>{w=!0,I({isSuccess:j==="success",message:K||{}}),this.off(st.WS_CLOSED,L),this.off(st.WS_RECONNECTING,L),this.emit(st.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(o),k);const L=()=>{A(new Ge(H.WS_ABORT,"type: ".concat(t))),this.off(st.WS_CLOSED,L),this.off(st.WS_RECONNECTING,L),this.off("res-@".concat(o),k)};this.once(st.WS_CLOSED,L),this.once(st.WS_RECONNECTING,L),In(re("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==d||w||(F.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(st.REQUEST_TIMEOUT,t,n))}))}));let m=null;try{m=await p}catch(I){if(this.connectionState===Pt.CLOSED||t===Yt.LEAVE)throw new Ge(H.WS_ABORT);return!this.spec.forceWaitGatewayResponse||i?I.throw():t===Yt.JOIN||t===Yt.REJOIN?null:(await u(),await this.request(t,n))}if(m.isSuccess)return m.message;const g=Number(m.message.error_code||m.message.code),T=UC(g),R=new Ge(H.UNEXPECTED_RESPONSE,"".concat(T.desc,": ").concat(m.message.error_str),{code:g,data:m.message,desc:T.desc});return T.action==="success"?m.message:(F.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(g,", message: ").concat(T.desc,", action: ").concat(T.action)),g===gt.ERR_TOO_MANY_BROADCASTERS?((t===Yt.JOIN||t===Yt.REJOIN)&&(this.initError=R,this.close()),R.throw()):T.action==="failed"?R.throw():T.action==="quit"?(this.initError=R,this.close(),R.throw()):(g===gt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=m.message.option,F.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",vr.MULTI_IP)):this.reconnect(T.action,vr.SERVER_ERROR),t===Yt.JOIN||t===Yt.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new De((i=>{const s=o=>{(!n||n(o))&&(this.off(t,s),i(o))};this.on(t,s)}))}uploadWRTCStats(t){if(!this.store.sessionId)return void F.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload(Ln.WRTC_STATS,n)}upload(t,n){const i={_type:t,_message:n};try{this.websocket.sendMessage(i)}catch{const o=re("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(i),this.uploadCache.length>o&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==Pt.CONNECTED)return;const c=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(c._type,c._message)}),re("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const i={_type:t,_message:n};this.websocket.sendMessage(i)}async sendExtensionMessage(t,n,i){return await this._external_signal.send(t,n,i)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new De(((n,i)=>{this.once(st.WS_CONNECTED,(()=>n(this.joinResponse))),this.once(st.WS_CLOSED,(()=>i(this.initError||new Ge(H.WS_ABORT)))),this.connectionState=Pt.CONNECTING,this.websocket.init(t).catch(i)}))}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||Ti.LEAVE,this.connectionState=Pt.CLOSED,F.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=Oi(6,""),this._external_signal.clear(),this._external_signal=new qv(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(st.ABORT_P2P_EXECUTION);const t=await On(this,st.REQUEST_JOIN_INFO),n=await this.request(Yt.JOIN,t);if(!n)return this.emit(st.REPORT_JOIN_GATEWAY,H.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(st.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Pt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}async downgradeCodec(t){return!1}handleDataStream(t){try{var n;const i=bd(t.payload),s=new TextDecoder().decode(i),o=JSON.parse(s);"total"in o&&"id"in o||Re(n=Object.values(Mr)).call(n,o._type)?(o._uid=t.uid,this._external_signal.onMessage(o)):this.emit(an.ON_DATA_STREAM,t)}catch{this.emit(an.ON_DATA_STREAM,t)}}handleNotification(t){F.debug("[".concat(this.clientId,"] receive notification: "),t);const n=UC(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Ti.UID_BANNED),void this.close()):void this.reconnect(n.action,vr.SERVER_ERROR);F.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=re("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(F.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>re("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",vr.TIMEOUT):this.request(Yt.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const i=Date.now()-n;this.rttRolling.add(i),re("REPORT_STATS")&&this.send(Yt.PING_BACK,{pingpongElapse:i})})).catch((i=>{}))}handleWebsocketEvents(){this.websocket.on(cn.RECONNECT_CREATE_CONNECTION,(t=>{this.emit(st.WS_RECONNECT_CREATE_CONNECTION,t)})),this.websocket.on(cn.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(cn.CLOSED,(()=>{this.connectionState=Pt.CLOSED})),this.websocket.on(cn.FAILED,(()=>{this._disconnectedReason=Ti.NETWORK_ERROR,this.connectionState=Pt.CLOSED})),this.websocket.on(cn.RECONNECTING,(t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Pt.CONNECTED?this.connectionState=Pt.RECONNECTING:this.connectionState=Pt.CONNECTING})),this.websocket.on(cn.WILL_RECONNECT,((t,n,i)=>{t!=="retry"?(F.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):F.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),i(t)})),this.websocket.on(cn.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.join().catch((t=>{if(this.emit(st.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof Ge&&t.code===H.UNEXPECTED_RESPONSE&&t.data.code===gt.ERR_NO_AUTHORIZED)return F.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",vr.SERVER_ERROR);F.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",vr.SERVER_ERROR):(this.initError=t,this.close())}))})),this.websocket.on(cn.REQUEST_NEW_URLS,((t,n)=>{On(this,st.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)})),this.websocket.on(cn.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(an.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}}const M6={name:"P2PChannel",create:function(e){let{store:t,statsCollector:n}=e;return new gf(t,n)},createSubmodule:function(e){let{store:t,spec:n}=e;return new nq(n,t)}};function Tj(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function U6(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Tj(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tj(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}class Yi{constructor(t){Q(this,"sessionDesc",void 0),Q(this,"localCapabilities",void 0),Q(this,"rtpCapabilities",void 0),Q(this,"candidates",void 0),Q(this,"_originCandidates",void 0),Q(this,"iceParameters",void 0),Q(this,"dtlsParameters",void 0),Q(this,"setup",void 0),Q(this,"currentMidIndex",void 0),Q(this,"cname",void 0),t=Ki(t);const{iceParameters:n,dtlsParameters:i,candidates:s,rtpCapabilities:o,setup:c,localCapabilities:d,sdkCodec:u,cname:p}=t,m=Qo(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=o,this.candidates=s,this._originCandidates=Ki(s),this.iceParameters=n,this.dtlsParameters=i,this.setup=c,this.localCapabilities=d,this.cname=p;for(let g=0;g<m.mediaDescriptions.length;g++){const T=m.mediaDescriptions[g];if(T.attributes.iceUfrag=n.iceUfrag,T.attributes.icePwd=n.icePwd,T.attributes.fingerprints=i.fingerprints,T.attributes.candidates=s,T.attributes.setup=c,T.media.mediaType==="video"){T.media.fmts=o.videoCodecs.map((A=>A.payloadType.toString(10)));const R=o.videoCodecs.filter((A=>{var w,k;return(w=A.rtpMap)===null||w===void 0?void 0:Re(k=w.encodingName.toLowerCase()).call(k,u)})),I=o.videoCodecs.filter((A=>!Re(R).call(R,A)));T.attributes.payloads=[...R,...I],T.attributes.extmaps=o.videoExtensions}T.media.mediaType==="audio"&&(T.media.fmts=o.audioCodecs.map((R=>R.payloadType.toString(10))),T.attributes.payloads=o.audioCodecs,T.attributes.extmaps=o.audioExtensions),m.mediaDescriptions[g]=this.mungMediaDesc(T)}this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}toString(){return Wg(this.sessionDesc)}send(t,n,i){const{ssrcs:s,ssrcGroups:o}=R_(n,this.cname),c=this.sessionDesc.mediaDescriptions.find((p=>t===dt.VIDEO?p.media.mediaType==="video":p.media.mediaType==="audio")),d=s[0].attributes.label,u=s[0].attributes.mslabel;return c.attributes.ssrcs=c.attributes.ssrcs.concat(s),c.attributes.ssrcGroups=c.attributes.ssrcGroups.concat(o),{id:d,mslabel:u}}batchSend(t){return t.map((n=>{let{kind:i,ssrcMsg:s}=n;return this.send(i,s,void 0)}))}stopSending(t){this.sessionDesc.mediaDescriptions.forEach((n=>{const i=[],s=[],o=[];n.attributes.ssrcs.forEach((c=>{Re(t).call(t,c.attributes.label||"")?o.push(c):i.push(c)})),n.attributes.ssrcGroups.forEach((c=>{var d;Re(d=o.map((u=>u.ssrcId))).call(d,c.ssrcIds[0])||s.push(c)})),n.attributes.ssrcs=i,n.attributes.ssrcGroups=s}))}mute(t){const n=this.sessionDesc.mediaDescriptions.find((i=>i.attributes.mid===t));if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find((i=>i.attributes.mid===t));if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,i){t.forEach(((s,o)=>{const c=s._mediaStreamTrack,d=this.sessionDesc.mediaDescriptions.findIndex((p=>p.attributes.mid===c.kind)),u=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[d],s);this.sessionDesc.mediaDescriptions[d]=u}))}stopReceiving(t){}updateCandidates(t){const n=this._originCandidates.filter((s=>s.transport==="udp")),i=[];if(n.forEach((s=>{i.push(U6(U6({},s),{},{foundation:"tcpcandidate",priority:Number(s.priority)-1+"",transport:"tcp",port:Number(s.port)+90+""}))})),n.length!==0){switch(t){case As.TCP_RELAY:this.candidates=i;break;case As.UDP_TCP_RELAY:case As.RELAY:this.candidates=[...n,...i];break;default:this.candidates=n}for(const s of this.sessionDesc.mediaDescriptions)s.attributes.candidates=this.candidates}}restartICE(t){t=Ki(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach((n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd}))}predictReceivingMids(t){const n=[];for(let i=0;i<t;i++)n.push((this.currentMidIndex+i+1).toString(10));return n}mungRecvMediaDsec(t,n){const i=Ki(t);return Qg(i,n),dP(i,n),i}updateRecvMedia(t,n){const i=this.sessionDesc.mediaDescriptions.findIndex((s=>s.attributes.mid===t));if(i!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],n);this.sessionDesc.mediaDescriptions[i]=s}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,i){const s=this.sessionDesc.mediaDescriptions.find((c=>t===dt.VIDEO?c.attributes.mid==="video":c.attributes.mid==="audio"));if(s){const c=s.attributes.ssrcs.find((d=>d.attributes.label===n));var o;c&&(c.attributes.label=i,(o=c.attributes.msid)===null||o===void 0||o.replace(n,i))}}mungMediaDesc(t){const n=Ki(t);return t0(n),(function(i){const s=i.attributes.extmaps.find((o=>e0(o.extensionName)));s&&i.attributes.extmaps.splice(i.attributes.extmaps.indexOf(s),1),i.attributes.payloads.forEach((o=>{const c=o.rtcpFeedbacks.findIndex((d=>d.type==="transport-cc"));c!==-1&&o.rtcpFeedbacks.splice(c,1)}))})(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const i of n.attributes.ssrcs)if(i.attributes.label===t)return[i]}}var ji;function U0(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,i)}return n}function gk(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?U0(Object(n),!0).forEach((function(i){Q(e,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U0(Object(n)).forEach((function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))}))}return e}let Lu=(ji=class Uj extends vt{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map((t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"")).filter((t=>{var n;return Re(n=Object.keys(vC)).call(n,t)})))]}constructor(t,n){super(t,n),Q(this,"store",void 0),Q(this,"peerConnection",void 0),Q(this,"remoteSDP",void 0),Q(this,"initialOffer",void 0),Q(this,"statsFilter",void 0),Q(this,"useRTX",!1),Q(this,"localCapabilities",void 0),Q(this,"localCandidateCount",0),Q(this,"allCandidatesReceived",!1),Q(this,"establishPromise",void 0),Q(this,"mutex",void 0),this.store=n,this.mutex=new ro("P2PConnection-mutex",n.clientId),this.peerConnection=new RTCPeerConnection(Uj.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=LD(this.peerConnection,re("STATS_UPDATE_INTERVAL"),void 0,fi()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Km(t.sdp),i=bh(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:re("FILTER_VIDEO_FEC"),filterAudioFec:re("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=i,this.initialOffer=t,gk(gk({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:i},offerSDP:t.sdp})}catch(t){throw new Ge(H.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Yi(gk(gk({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(t,n){throw new Ge(H.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,n){var i=this;return jc((function*(){const s=yield Jn(i.mutex.lock());try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=t.map((T=>i.peerConnection.addTrack(T._mediaStreamTrack))),c=yield Jn(i.peerConnection.createOffer()),d=Qo(c.sdp),u=t.map((T=>{const R=T._mediaStreamTrack,I=d.mediaDescriptions.find((A=>A.attributes.mid===R.kind));if(!I)throw new Error("Cannot extract ssrc from mediaDescription.");return(function(A,w,k){const L=A.attributes.ssrcs.filter((K=>K.attributes.label===w)),j=A.attributes.ssrcGroups;if(L.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(j&&L.length>1){const K=j.find((W=>W.ssrcIds.indexOf(L[0].ssrcId)!==-1));return K?[{ssrcId:K.ssrcIds[0],rtx:k?K.ssrcIds[1]:void 0}]:[{ssrcId:L[0].ssrcId}]}return[{ssrcId:L[0].ssrcId}]})(I,R.id,i.useRTX)}));let p;try{p=yield u}catch(T){throw o.forEach((R=>{Xo()&&R.replaceTrack(null),i.peerConnection.removeTrack(R)})),T}const m=i.mungSendOfferSDP(c.sdp,t);i.remoteSDP.receive(t,n,p);const g=i.remoteSDP.toString();return yield Jn(i.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield Jn(i.applySendEncodings(o,t)),yield Jn(i.peerConnection.setRemoteDescription({type:"answer",sdp:g})),t.map(((T,R)=>{const I=T._mediaStreamTrack.id;return{localSSRC:u[R],id:I}}))}catch(o){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}}))()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter((o=>{var c;return t.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1}));if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map((o=>{Xo()&&o.replaceTrack(null),this.peerConnection.removeTrack(o)}));const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(t);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,i,s){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:o,mslabel:c}=this.remoteSDP.send(t,n,s),d=new De(((m,g)=>{const T=setTimeout((()=>{g(new Error("Cannot receive track, id: ".concat(o)))}),1e4),R=I=>{const A=$n();if((A.name==="Safari"&&Number(A.version)===11||mo())&&I.track.id!==o&&I.streams[0].id===c){var w;const k=I.streams[0].getTracks()[0];return(w=this.remoteSDP)===null||w===void 0||w.updateTrackLabel(t,o,I.track.id),this.peerConnection.removeEventListener("track",R),clearTimeout(T),void m(k)}if(I.track.id===o)return this.peerConnection.removeEventListener("track",R),clearTimeout(T),void m(I.track)};this.peerConnection.addEventListener("track",R)})),u=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:u});const p=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(p),{track:await d,id:o}}catch(o){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(i)}catch(n){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter((i=>{var s;return t.indexOf(((s=i.track)===null||s===void 0?void 0:s.id)||"")!==-1}));if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map((i=>{if(Xo()&&i.track)i.track.enabled=!1;else{const s=i.getParameters();s.encodings.forEach((o=>o.active=!1)),i.setParameters(s)}}))}catch(n){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter((o=>{var c;return t.indexOf(((c=o.track)===null||c===void 0?void 0:c.id)||"")!==-1}));if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map((async o=>{if(Xo()&&o.track)o.track.enabled=!0;else{const c=o.getParameters();c.encodings.forEach((d=>d.active=!0)),await o.setParameters(c)}}));const i=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(i);const s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return jc((function*(){const i=yield Jn(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const s=ai().supportPCSetConfiguration;if(t===As.RELAY&&!s)return;if(s){const p=n.peerConnection.getConfiguration(),m=t===As.RELAY?"relay":"all";p.iceTransportPolicy!==m&&(F.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(p.iceTransportPolicy,"] to [").concat(m,"]")),p.iceTransportPolicy=m,n.peerConnection.setConfiguration(p))}t!==As.RELAY&&n.remoteSDP.updateCandidates(t);const o=yield Jn(n.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const c=Km(o.sdp),{remoteIceParameters:d}=yield c.iceParameters;n.remoteSDP.restartICE(d);const u=n.remoteSDP.toString();yield Jn(n.peerConnection.setLocalDescription(o)),yield Jn(n.peerConnection.setRemoteDescription({type:"answer",sdp:u}))}catch(s){F.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),s)}finally{i()}}))()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const i=await this.peerConnection.createOffer(),s=this.mungSendOfferSDP(i.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const o=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(i){throw new Ge(H.EXCHANGE_SDP_FAILED,i.toString())}}async updateSendParameters(t,n){const i=this.peerConnection.getSenders().filter((s=>{var o;return((o=s.track)===null||o===void 0?void 0:o.id)===t}));i.length===1&&await this.applySendEncodings(i,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const i=this.peerConnection.getSenders().find((s=>{var o;return((o=s.track)===null||o===void 0?void 0:o.id)===n}));i&&await i.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,n){throw new Ge(H.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new Ge(H.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,F.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,F.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),re("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(_C(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...Uj.turnServerConfigToIceServers(t.turnServer.servers)),re("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Uj.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((i=>{i.forceturn&&(n.iceTransportPolicy="relay")})))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach((i=>{i.security?i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turns:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}):(i.udpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.udpport,"?transport=udp")}),i.tcpport&&n.push({username:i.username,credential:i.password,credentialType:"password",urls:"turn:".concat(i.turnServerURL,":").concat(i.tcpport,"?transport=tcp")}))})),n}async updateRtpSenderEncodings(t,n){var i;if(n||(n=this.peerConnection.getSenders().find((p=>{var m;return((m=p.track)===null||m===void 0?void 0:m.id)===t._mediaStreamTrack.id}))),!n)return F.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!ai().supportSetRtpSenderParameters)return F.warn("Browser not support set rtp-sender parameters");const s={},o={};if(t instanceof zi)switch(t._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(re("DSCP_TYPE")&&_h()){var c;const p=re("DSCP_TYPE");Re(c=["very-low","low","medium","high"]).call(c,p)&&(o.networkPriority=p)}const d=n.getParameters(),u=(i=d.encodings)===null||i===void 0?void 0:i[0];u&&Object.assign(u,o),Object.assign(d,s),F.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(d.encodings))),await n.setParameters(d)}async applySendEncodings(t,n){try{if(!ai().supportSetRtpSenderParameters||t.length!==n.length)return;for(let i=0;i<t.length;i++){const s=t[i],o=n[i];s&&o&&await this.updateRtpSenderEncodings(o,s)}}catch{F.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const i=Qo(t);return n.forEach(((s,o)=>{const c=s._mediaStreamTrack,d=i.mediaDescriptions.find((u=>u.attributes.mid===c.kind));d&&Qg(d,s)})),Wg(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,i)=>{var s;(s=this.onFirstVideoDecoded)===null||s===void 0||s.call(this,t,n,i)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var i;(i=this.onSelectedLocalCandidateChanged)===null||i===void 0||i.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var i;(i=this.onSelectedRemoteCandidateChanged)===null||i===void 0||i.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map(((o,c)=>{let{id:d,mslabel:u}=o;const{kind:p}=t[c];return new De(((m,g)=>{const T=setTimeout((()=>{g(new Error("Cannot receive track, id: ".concat(d)))}),1e4),R=I=>{const A=$n();if(A.name==="Safari"&&Number(A.version)===11&&I.track.id!==d&&I.streams[0].id===u){var w;const k=I.streams[0].getTracks()[0];return(w=this.remoteSDP)===null||w===void 0||w.updateTrackLabel(p,d,I.track.id),this.peerConnection.removeEventListener("track",R),clearTimeout(T),void m({track:k,id:d})}if(I.track.id===d)return this.peerConnection.removeEventListener("track",R),clearTimeout(T),void m({track:I.track,id:d})};this.peerConnection.addEventListener("track",R)}))})),i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const s=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(s),await De.all(n)}catch(n){throw new Ge(H.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n?.[0].ssrcId}setConfiguration(t){if(ai().supportPCSetConfiguration){const n=Uj.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}},At(ji.prototype,"connect",[Mu],Object.getOwnPropertyDescriptor(ji.prototype,"connect"),ji.prototype),At(ji.prototype,"stopSending",[Mu],Object.getOwnPropertyDescriptor(ji.prototype,"stopSending"),ji.prototype),At(ji.prototype,"receive",[Mu],Object.getOwnPropertyDescriptor(ji.prototype,"receive"),ji.prototype),At(ji.prototype,"stopReceiving",[Mu],Object.getOwnPropertyDescriptor(ji.prototype,"stopReceiving"),ji.prototype),At(ji.prototype,"muteRemote",[Mu],Object.getOwnPropertyDescriptor(ji.prototype,"muteRemote"),ji.prototype),At(ji.prototype,"unmuteRemote",[Mu],Object.getOwnPropertyDescriptor(ji.prototype,"unmuteRemote"),ji.prototype),At(ji.prototype,"muteLocal",[Mu],Object.getOwnPropertyDescriptor(ji.prototype,"muteLocal"),ji.prototype),At(ji.prototype,"unmuteLocal",[Mu],Object.getOwnPropertyDescriptor(ji.prototype,"unmuteLocal"),ji.prototype),At(ji.prototype,"close",[Mu],Object.getOwnPropertyDescriptor(ji.prototype,"close"),ji.prototype),At(ji.prototype,"updateEncoderConfig",[Mu],Object.getOwnPropertyDescriptor(ji.prototype,"updateEncoderConfig"),ji.prototype),At(ji.prototype,"updateSendParameters",[Mu],Object.getOwnPropertyDescriptor(ji.prototype,"updateSendParameters"),ji.prototype),At(ji.prototype,"replaceTrack",[Mu],Object.getOwnPropertyDescriptor(ji.prototype,"replaceTrack"),ji.prototype),At(ji.prototype,"getRemoteSSRC",[Mu],Object.getOwnPropertyDescriptor(ji.prototype,"getRemoteSSRC"),ji.prototype),ji);function Mu(e,t,n){const i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const s=this.mutex,o=await s.lock("Locking from P2PConnection.".concat(t));try{for(var c=arguments.length,d=new Array(c),u=0;u<c;u++)d[u]=arguments[u];return await i.apply(this,d)}finally{o()}},n}const iq={name:"PlanBConnection",create:function(e){let{store:t,spec:n}=e;return new Lu(n,t)}},rq={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ai().supportWebRTCEncodedTransform)return void F.warning("browser not support audio encoded transform");if(Av.has(e)||!e.track)return;const n={track:e.track};if(ms()){if(!e.createEncodedStreams)return void F.warning("browser not support createEncodedStreams() API");let s=null;try{s=e.createEncodedStreams()}catch(c){return void F.error("create audio-encoded-streams error",c&&c.message)}const o=new TransformStream({transform(c,d){n.controller||(n.controller=d),e.track&&e.track.id!==n.track.id&&(F.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const u=t.metadata&&t.metadata();u?(function(p,m){const{chunk:g,controller:T}=m,R=E_.METADATA;g.data=(function(I,A,w){const k=w.byteLength,L=k+tP+Bm,j=Vw+Fw+L,K=new ArrayBuffer(I.byteLength+j),W=new DataView(K);W.setUint8(0,eP),W.setUint16(1,L),W.setUint8(3,A),W.setUint16(4,k);for(let se=0;se<k;se++)W.setUint8(6+se,w[se]);const Y=new Uint8Array(W.buffer);return Y.set(new Uint8Array(I),j),Y.buffer})(g.data,R,p),T.enqueue(g)})(u,{chunk:c,controller:d}):d.enqueue(c)}});s.readable.pipeThrough(o).pipeTo(s.writable)}else if(Xo()){if(typeof RTCRtpScriptTransform>"u")return void F.warning("browser not support RTCRtpScriptTransform");const s=xw(),o=new MessageChannel;await new De((d=>s.onmessage=u=>{u.data==="registered"&&d(void 0)}));const c=new RTCRtpScriptTransform(s,{name:"audio-metadata-tx",port:o.port2},[o.port2]);e.transform=c,await new De((d=>s.onmessage=u=>{u.data==="started"&&d(void 0)})),o.port1.onmessage=d=>{var u;if(d.data.transformed&&e.track&&((u=e.track)===null||u===void 0?void 0:u.id)!==n.track.id)F.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i);else if(d.data.getMetadata){const p=t.metadata&&t.metadata();p&&o.port1.postMessage({metadata:p})}},n.worker=s}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}const s=Av.get(e);if(s){Av.delete(e);try{var o,c;(o=s.controller)===null||o===void 0||o.terminate(),(c=s.worker)===null||c===void 0||c.terminate()}catch(d){F.warning(d&&d.message)}}}Av.set(e,n),e.track.addEventListener("ended",i)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ai().supportWebRTCEncodedTransform)return void F.warning("browser not support audio encoded transform");if(sP.has(e))return;const n={track:e.track,onMetadata:t.onMetadata,onPts:t.onPts};if(ms()&&!mo()){if(!e.createEncodedStreams)return void F.warning("browser not support createEncodedStreams() API");vw(mi.CHROME,87,116)||(t.enableTopn=!1);let s=null;try{s=e.createEncodedStreams()}catch(c){return void F.error("create audio-encoded-streams error",c&&c.message)}const o=new TransformStream({transform(c,d){n.controller||(n.controller=d),e.track&&e.track.id!==n.track.id&&(F.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i)),t.enableTopn?(function(u,p,m){var g;const T=wC(new DataView(p.data));if(!T)return m.enqueue(p);const R=u.track.id;VV.set(R,u.track);const I=(g=T.tlv.find((K=>K.tag===E_.AUDIO_LEVEL)))===null||g===void 0?void 0:g.value;let A=0;typeof I=="number"&&(A=127-I);const w=Math.round(Math.pow(10,A/60)-1),{selected:k,speaker:L}=(function(K,W){let Y=El.get(K);if(Y||(Y=(function(se){const de=new C4;return El.set(se,de),Ld||(Ld=new DC(re("TOPN_SILENCE_THRESHOLD")||500),Ld.on("ActiveSpeakerChanged",(ge=>{ge!=null&&(Bw=ge)}))),Ld.addSpeakers([de]),de})(K)),El.size<=Kg)return{selected:!0,speaker:Y};if(!Ld)throw new Error("no active speaker detector");return Ld.levelChanged(Y.id,W),Kc=Ld.loudest.map((se=>se.id)),Bw&&!Re(Kc).call(Kc,Bw)&&Kc.length>=Kg&&Kc.pop(),{selected:Re(Kc).call(Kc,Y.id)||Y.id===Bw,speaker:Y}})(u,w),j=(function(K,W,Y){const se=Md.get(K)||new rP(K,W);return se.score=Y,Md.set(K,se),(function(de){if(iP.set(de,!0),!jw)return void(jw=Date.now());const ge=Date.now();ge-jw>1e3&&(iP.get(de)?iP.set(de,!1):(Gw(de),iP.delete(de)),jw=ge)})(K),se})(R,u.track,L.energyScore);j.addSample(k),j.active&&(p.data=T.frame.buffer,m.enqueue(p))})(e,c,d):t.enableMetadata||t.enablePts?(function(u,p,m,g){const T=new DataView(u.data),R=T.getUint8(0);let I;if((128&R)!=0&&R!==71){const k=(function(L){if(L.byteLength<=0)return[];const j=[];let K=0;for(;K<L.byteLength;){const Y=(128&L.getUint8(K))>>7,se=127&L.getUint8(K);if(!(Y&&K+4<=L.byteLength)){K++;break}{const de=L.getUint32(K,!1),ge=(16776192&de)>>10,je=1023&de;j.push({pt:se,ts_offset:ge,length:je,data:new Uint8Array}),K+=4}}let W=L.byteLength-K;for(const Y of j){if(Y.length>W)return console.warn("Broken red payload"),[];Y.length>0&&(Y.data=new Uint8Array(L.buffer,L.byteOffset+K,Y.length),K+=Y.length,W-=Y.length)}if(W>0){const Y={pt:j.length>0?j[j.length-1].pt:0,ts_offset:0,length:W,data:new Uint8Array(L.buffer,L.byteOffset+K,W)};j.push(Y)}return j})(T);if(k.length>0){const L=(function(j){let K=0;for(let se=0;se<j.length;se++)K+=se<j.length-1?4:1,K+=j[se].length;const W=new Uint8Array(K);let Y=0;for(let se=0;se<j.length;se++)if(se<j.length-1){const de=(2147483648|(127&j[se].pt)<<24|(262143&j[se].ts_offset)<<10|1023&j[se].length)>>>0;W[Y++]=de>>24&255,W[Y++]=de>>16&255,W[Y++]=de>>8&255,W[Y++]=255&de}else W[Y++]=127&j[se].pt;for(const se of j)W.set(se.data,Y),Y+=se.length;return W})(k.map((j=>{const K=new Uint8Array(j.length);K.set(j.data);const W=wC(new DataView(K.buffer));return W!=null&&W.frame&&(j.data=W?.frame),I=W,j})));u.data=L.buffer}}else I=wC(T),I&&(u.data=I.frame.buffer);if(p.enqueue(u),!I)return;const A=I.tlv.find((k=>k.tag===E_.METADATA));A&&m&&A.value instanceof Uint8Array&&m(A.value);const w=I.tlv.find((k=>k.tag===E_.AUDIO_64_BIT_PTS));w&&g&&w.value instanceof Uint8Array&&w.value.length==8&&g(new DataView(w.value.buffer).getBigUint64(0,!0))})(c,d,t.onMetadata,t.onPts):d.enqueue(c)}});s.readable.pipeThrough(o).pipeTo(s.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void F.warning("browser not support RTCRtpScriptTransform");const s=xw(),o=new MessageChannel;await new De((d=>s.onmessage=u=>{u.data==="registered"&&d(void 0)}));const c=new RTCRtpScriptTransform(s,{name:"audio-metadata-rx",port:o.port2},[o.port2]);e.transform=c,await new De((d=>s.onmessage=u=>{u.data==="started"&&d(void 0)})),o.port1.onmessage=d=>{var u;d.data.transformed&&e.track&&((u=e.track)===null||u===void 0?void 0:u.id)!==n.track.id?(F.debug("audio track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i)):d.data.metadata&&n.onMetadata?n.onMetadata(d.data.metadata):d.data.pts&&n.onPts&&n.onPts(d.data.pts)},n.worker=s}function i(){e.track.removeEventListener("ended",i),(function(s){const o=sP.get(s);if(o){(function(u){const p=El.get(u);p&&(El.delete(u),Ld&&(Ld.removeSpeakers([p]),El.size===0&&(Ld.destroy(),Ld=null)))})(s),Gw(s.track.id),sP.delete(s);try{var c,d;(c=o.controller)===null||c===void 0||c.terminate(),(d=o.worker)===null||d===void 0||d.terminate()}catch(u){F.warning(u&&u.message)}}})(e)}sP.set(e,n),e.track.addEventListener("ended",i)},interceptLocalVideoFrame:async function(e,t){if(!ai().supportWebRTCEncodedTransform)return void F.warning("browser not support video encoded transform");if(zg.has(e)||!e.track)return;const n={track:e.track};if(ms()){if(!e.createEncodedStreams)return void F.warning("browser not support createEncodedStreams() API");let s=null;try{s=e.createEncodedStreams()}catch(d){return void F.error("create video-encoded-streams error",d&&d.message)}const o=[];t.on("sei-to-send",(d=>{o.push(d)}));const c=new TransformStream({transform(d,u){n.controller||(n.controller=u),e.track&&e.track.id!==n.track.id&&(F.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const p=Hw(new Uint8Array(d.data)),m=o.shift();if(m){const g=(function(T,R,I){switch(I){case Ww:return(function(A,w){const k=BV(w),L=k.length,j=Math.floor(L/255),K=L%255,W=new Uint8Array(6+j+1+L+A.byteLength);W[0]=0,W[1]=0,W[2]=0,W[3]=1,W[4]=6,W[5]=101;let Y=0;for(;Y<j;)W[6+Y]=255,Y++;return W[6+Y]=K,Y++,W.set(k,6+Y),W.set(new Uint8Array(A),6+Y+L),W.buffer})(T,R);case oP:return(function(A,w){const k=BV(w),L=k.length,j=Math.floor(L/255),K=L%255,W=new Uint8Array(7+j+1+L+1+A.byteLength);W[0]=0,W[1]=0,W[2]=0,W[3]=1,W[4]=78,W[5]=1,W[6]=101;let Y=0;for(;Y<j;)W[7+Y]=255,Y++;return W[7+Y]=K,Y++,W.set(k,7+Y),Y+=L,W[7+Y]=128,Y++,W.set(new Uint8Array(A),7+Y),W.buffer})(T,R);default:return null}})(d.data,m,p);g&&(d.data=g)}u.enqueue(d)}});s.readable.pipeThrough(c).pipeTo(s.writable)}else{if(!Xo())return;{if(typeof RTCRtpScriptTransform>"u")return void F.warning("browser not support RTCRtpScriptTransform");const s=xw(),o=new MessageChannel;await new De((d=>s.onmessage=u=>{u.data==="registered"&&d(void 0)}));const c=new RTCRtpScriptTransform(s,{name:"sei-tx",port:o.port2},[o.port2]);e.transform=c,await new De((d=>s.onmessage=u=>{u.data==="started"&&d(void 0)})),t.on("sei-to-send",(d=>{o.port1.postMessage({sei:d})})),o.port1.onmessage=d=>{var u;d.data.transformed&&e.track&&((u=e.track)===null||u===void 0?void 0:u.id)!==n.track.id&&(F.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i))},n.worker=s}}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}const s=zg.get(e);if(s){zg.delete(e);try{var o,c;(o=s.controller)===null||o===void 0||o.terminate(),(c=s.worker)===null||c===void 0||c.terminate()}catch(d){F.warning(d&&d.message)}}}zg.set(e,n),e.track.addEventListener("ended",i)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!ai().supportWebRTCEncodedTransform)return void F.warning("browser not support video encoded transform");if(!e.track)return;if(Kw.has(e)){const s=Kw.get(e);return void(s&&(s.onSei=t.onSei))}const n={track:e.track,onSei:t.onSei};if(ms()){if(!e.createEncodedStreams)return void F.warning("browser not support createEncodedStreams() API");let s=null;try{s=e.createEncodedStreams()}catch(c){return void F.error("create video-encoded-streams error",c&&c.message)}const o=new TransformStream({transform(c,d){n.controller||(n.controller=d),e.track&&e.track.id!==n.track.id&&(F.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i));const u=(function(p,m){switch(m){case Ww:return(function(g){const T=new DataView(g.data);let R=0;for(;R+4<g.data.byteLength;){if(T.getUint8(R+0)===0&&T.getUint8(R+1)===0&&T.getUint8(R+2)===0&&T.getUint8(R+3)===1&&T.getUint8(R+4)===6){let I=R+6,A=0,w=0;for(;(w=T.getUint8(I++))===255;)A+=255;A+=w;const k=FV(g.data,I,A);return new Uint8Array(k)}R++}return null})(p);case oP:return(function(g){const T=new DataView(g.data);let R=0;for(;R+5<g.data.byteLength;){if(T.getUint8(R+0)===0&&T.getUint8(R+1)===0&&T.getUint8(R+2)===0&&T.getUint8(R+3)===1&&T.getUint8(R+4)===78&&T.getUint8(R+5)===1&&T.getUint8(R+6)===101){let I=R+7,A=0,w=0;for(;(w=T.getUint8(I++))===255;)A+=255;A+=w;const k=FV(g.data,I,A);return new Uint8Array(k)}R++}return null})(p);default:return null}})(c,Hw(new Uint8Array(c.data)));u&&n.onSei&&n.onSei(u),d.enqueue(c)}});s.readable.pipeThrough(o).pipeTo(s.writable)}else if(Xo()){if(typeof RTCRtpScriptTransform>"u")return void F.warning("browser not support RTCRtpScriptTransform");const s=xw(),o=new MessageChannel;await new De((d=>s.onmessage=u=>{u.data==="registered"&&d(void 0)}));const c=new RTCRtpScriptTransform(s,{name:"sei-rx",port:o.port2},[o.port2]);e.transform=c,await new De((d=>s.onmessage=u=>{u.data==="started"&&d(void 0)})),o.port1.onmessage=d=>{var u;d.data.transformed&&e.track&&((u=e.track)===null||u===void 0?void 0:u.id)!==n.track.id?(F.debug("video track changed: ".concat(n.track.id," => ").concat(e.track.id)),n.track.removeEventListener("ended",i),n.track=e.track,n.track.addEventListener("ended",i)):d.data.sei&&n.onSei&&n.onSei(d.data.sei)},n.worker=s}function i(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",i)}(function(s){const o=Kw.get(s);if(o){Kw.delete(s);try{var c,d;(c=o.controller)===null||c===void 0||c.terminate(),(d=o.worker)===null||d===void 0||d.terminate()}catch(u){F.warning(u&&u.message)}}})(e)}Kw.set(e,n),e.track.addEventListener("ended",i)}},x6={name:"InterceptFrame",create:()=>rq};Yl(),te("PROCESS_ID","process-".concat(Oi(8,""),"-").concat(Oi(4,""),"-").concat(Oi(4,""),"-").concat(Oi(4,""),"-").concat(Oi(12,""))),(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void F.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();F.debug("Loading global parameters from cache",t),Object.keys(t).forEach((i=>{if(Object.prototype.hasOwnProperty.call(en,i)){const{value:s,expires:o}=t[i];if(o&&o<=n)return;zt[i]=s,en[i]=s}}))}catch(t){F.error("Error loading mutableParamsCache: ".concat(e),t.message)}})(),Array.isArray(zt.AREAS)&&zt.AREAS.length>0&&fP(zt.AREAS,!0);const Ds=(e,t,n)=>{F.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),te(e,t,n)};Tl(v6,!1),Tl(KY,!1),Tl($4,!1),Tl(w6,!1),Tl(jY,!1),Tl(M6,!1),Tl(iq,!1),Tl(x6,!1);const r=(function(e){const t=new rr,n=e,i={getListeners:t.getListeners.bind(t),on:(s,o)=>((function(c,d){c===fa.SECURITY_POLICY_VIOLATION&&t6(d,!0)})(s,o),t.on.bind(t)(s,o)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return UP(UP({},n),i)})({__TRACK_LIST__:yv,VERSION:ql,BUILD:Nw,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:Ds,getParameter:re,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;const n=await(async function(i){let s;return ai().supportUnifiedPlan?(i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"}),s=(await i.createOffer()).sdp):s=(await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,s})(t);if(!n)return e;t.close(),t=null,e=(function(i){const s={video:[],audio:[]};return i.match(/ VP8/i)&&s.video.push("VP8"),i.match(/ VP9/i)&&s.video.push("VP9"),i.match(/ AV1/i)&&s.video.push("AV1"),i.match(/ H264/i)&&s.video.push("H264"),i.match(/ H265/i)&&s.video.push("H265"),i.match(/ opus/i)&&s.audio.push("OPUS"),i.match(/ PCMU/i)&&s.audio.push("PCMU"),i.match(/ PCMA/i)&&s.audio.push("PCMA"),i.match(/ G722/i)&&s.audio.push("G722"),s})(n)}catch(t){throw new Pe(H.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=fe.reportApiInvoke(null,{name:Cn.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Tr.TRACER});let t=!1;try{const o=window.RTCPeerConnection,c=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,d=window.WebSocket;t=!!(o&&c&&d),t&&Xp()&&gD(75)&&new o().close()}catch(o){return F.error("check system requirement failed: ",o),!1}let n=!1;const i=$n();i.name===mi.CHROME&&Number(i.version)>=58&&(Eu.engine.name!=="WebKit"||(function(){const o=$n();if(fh()){if(o.os===sn.MAC_OS)return!0;if(o.os===sn.IOS){const c=Eu.os.version&&Eu.os.version.split(".");if(c&&Number(c[0])===14&&c[1]&&Number(c[1])>=3||c&&Number(c[0])>14)return!0}}return!1})())&&(n=!0),(i.name===mi.FIREFOX&&Number(i.version)>=56||i.name===mi.OPERA&&Number(i.version)>=45||i.name===mi.SAFARI&&Number(i.version)>=11||i.name==="WebKit"&&(mo()||Su())&&i.osVersion&&Number(i.osVersion.split(".")[0])>=11||GU()||$n().name===mi.QQ)&&(n=!0),F.debug("checkSystemRequirements, api:",t,"browser",n);const s=t&&n;return e.onSuccess(s),s},getDevices:function(e){return _l.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return _l.getRecordingDevices(e)},getCameras:function(e){return _l.getCamerasDevices(e)},getElectronScreenSources:GD,getPlaybackDevices:function(e){return _l.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=Oi(5,"client-"),i=fe.reportApiInvoke(null,{id:n,name:Cn.CREATE_CLIENT,options:[t],tag:Tr.TRACER});try{(function(s){Tn(s.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Tn(s.mode,"config.mode",["rtc","live","p2p"]),s.audioCodec!==void 0&&Tn(s.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),s.proxyServer!==void 0&&ls(s.proxyServer,"config.proxyServer",1,1e4),s.turnServer!==void 0&&wD(s.turnServer),s.httpRetryConfig!==void 0&&t4(s.httpRetryConfig),s.websocketRetryConfig!==void 0&&t4(s.websocketRetryConfig)})(t)}catch(s){throw i.onError(s),s}return(TD(16,0)||Rw(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",F.debug("browser not support vp9, force use vp8")),te("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),i.onSuccess(),new g0(Nh(Nh({forceWaitGatewayResponse:!0},t),{},{role:Re(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),n)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=re("CAMERA_CAPTURE_CONFIG"),n=Oi(8,"track-cam-"),i=fe.reportApiInvoke(null,{id:n,tag:Tr.TRACER,name:Cn.CREATE_CAM_VIDEO_TRACK,options:[Ji({},e),t]});t&&(e.encoderConfig=t);const s=Mw(e);let o=null;F.info("start create camera video track with config",JSON.stringify(e),"trackId",n);try{o=(await Dd({video:s},n)).getVideoTracks()[0]||null}catch(d){throw i.onError(d),d}if(!o){const d=new Ge(H.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(d),d.throw(F)}if(e.optimizationMode&&ZD(n,o,e,Nd(e.encoderConfig)),re("USE_STANDARD_BITRATE_DEFAULT")){const d=Nd(e.encoderConfig);e.encoderConfig=d,delete d.bitrateMax,delete d.bitrateMin}const c=new AC(o,e,s,e.scalabiltyMode?VD(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n);return i.onSuccess(c.getTrackId()),F.info("create camera video success, trackId:",n),c},createCustomVideoTrack:function(e){const t=Oi(8,"track-cus-"),n=fe.reportApiInvoke(null,{id:t,tag:Tr.TRACER,name:Cn.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});re("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const i=new zi(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?VD(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[Ni.CUSTOM_TRACK]);return n.onSuccess(i.getTrackId()),F.info("create custom video track success with config",e,"trackId",i.getTrackId()),i},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=typeof t=="object"?(function(T){return ux(T)})(t):void 0;n&&(t="auto");const i=Oi(8,"track-scr-v-"),s=fe.reportApiInvoke(null,{id:i,tag:Tr.TRACER,name:Cn.CREATE_SCREEN_VIDEO_TRACK,options:[Ji({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const o=(function(T){const R={};T.screenSourceType&&(R.mediaSource=T.screenSourceType),T.extensionId&&ms()&&(R.extensionId=T.extensionId);const{displaySurface:I,selfBrowserSurface:A,surfaceSwitching:w,systemAudio:k,preferCurrentTab:L}=T;(Ev(107)||yw(107)||vD(93))&&(I&&(Tn(I,"displaySurface",["browser","window","monitor"]),R.displaySurface=I),A?(Tn(A,"selfBrowserSurface",["exclude","include"]),R.selfBrowserSurface=A):R.selfBrowserSurface="include",w&&(Tn(w,"surfaceSwitching",["exclude","include"]),R.surfaceSwitching=w)),(Ev(105)||yw(105)||vD(91))&&k&&(Tn(k,"systemAudio",["exclude","include"]),R.systemAudio=k),(Ev(94)||yw(94)||vD(80))&&L&&(R.preferCurrentTab=!0),T.electronScreenSourceId&&(R.sourceId=T.electronScreenSourceId);const j=T.encoderConfig?CC(T.encoderConfig):null;return R.mandatory={chromeMediaSource:"desktop",maxWidth:j?j.width:void 0,maxHeight:j?j.height:void 0},j&&(j.frameRate&&(typeof j.frameRate=="number"?(R.mandatory.maxFrameRate=j.frameRate,R.mandatory.minFrameRate=j.frameRate):(R.mandatory.maxFrameRate=j.frameRate.max||j.frameRate.ideal||j.frameRate.exact||void 0,R.mandatory.minFrameRate=j.frameRate.min||j.frameRate.ideal||j.frameRate.exact||void 0),R.frameRate=j.frameRate),j.width&&(R.width=j.width),j.height&&(R.height=j.height)),R})(e);let c=null,d=null;const u=ai();if(!u.supportShareAudio&&t==="enable"){const T=new Ge(H.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return s.onError(T),T.throw(F)}F.info("start create screen video track with config",e,"withAudio",t,"trackId",i);const p=u.supportShareAudio&&t!=="disable";try{const T=await Dd({screen:o,screenAudio:p?n||!0:void 0},i);c=T.getVideoTracks()[0]||null,d=T.getAudioTracks()[0]||null}catch(T){throw s.onError(T),T}if(!c){const T=new Ge(H.UNEXPECTED_ERROR,"can not find track in media stream");return s.onError(T),T.throw(F)}if(!d&&t==="enable"){c&&c.stop();const T=new Ge(H.SHARE_AUDIO_NOT_ALLOWED);return s.onError(T),T.throw(F)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(ZD(i,c,e,e.encoderConfig&&CC(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const m=new zi(c,e.encoderConfig?CC(e.encoderConfig):{},e.scalabiltyMode?VD(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i,[Ni.SCREEN_TRACK]);if(!d)return s.onSuccess(m.getTrackId()),F.info("create screen video track success","video:",m.getTrackId()),m;const g=new Rr(d,void 0,Oi(8,"track-scr-a-"),!1);return s.onSuccess([m.getTrackId(),g.getTrackId()]),F.info("create screen video track success","video:",m.getTrackId(),"audio:",g.getTrackId()),[m,g]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=re("CAMERA_CAPTURE_CONFIG"),i=Oi(8,"track-mic-"),s=Oi(8,"track-cam-"),o=fe.reportApiInvoke(null,{id:"".concat(i,"-").concat(s),tag:Tr.TRACER,name:Cn.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,n]});n&&(t.encoderConfig=n);const c=Mw(t),d=g4(e);let u=null,p=null;F.info("start create camera video track(".concat(s,") and microphone audio track(").concat(i,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const T=await Dd({audio:d,video:c},"".concat(i,"-").concat(s));u=T.getAudioTracks()[0],p=T.getVideoTracks()[0]}catch(T){throw o.onError(T),T}if(!u||!p){const T=new Ge(H.UNEXPECTED_ERROR,"can not find tracks in media stream");return o.onError(T),T.throw(F)}if(t.optimizationMode&&ZD(s,p,t,Nd(t.encoderConfig)),re("USE_STANDARD_BITRATE_DEFAULT")){const T=Nd(t.encoderConfig);t.encoderConfig=T,delete T.bitrateMax,delete T.bitrateMin}const m=new Uw(u,e,d,i),g=new AC(p,t,c,t.scalabiltyMode?VD(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s);return o.onSuccess([m.getTrackId(),g.getTrackId()]),F.info("create camera video track(".concat(s,") and microphone audio track(").concat(i,") success")),[m,g]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Oi(8,"track-mic-"),n=fe.reportApiInvoke(null,{id:t,tag:Tr.TRACER,name:Cn.CREATE_MIC_AUDIO_TRACK,options:[e]}),i=g4(e);let s=null;F.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{s=(await Dd({audio:i},t)).getAudioTracks()[0]||null}catch(c){throw n.onError(c),c}if(!s){const c=new Ge(H.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(c),c.throw(F)}const o=new Uw(s,e,i,t);return n.onSuccess(o.getTrackId()),F.info("create microphone audio track success, trackId:",t),o},createCustomAudioTrack:function(e){const t=Oi(8,"track-cus-"),n=fe.reportApiInvoke(null,{id:t,tag:Tr.TRACER,name:Cn.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),i=new Rr(e.mediaStreamTrack,e.encoderConfig?xm(e.encoderConfig):{},t,!1);return F.info("create custom audio track success with config",e,"trackId",i.getTrackId()),n.onSuccess(i.getTrackId()),i},createBufferSourceAudioTrack:async function(e){var t;const{cacheOnlineFile:n,encoderConfig:i}=e;let{source:s}=e;const o={source:s instanceof AudioBuffer?"AudioBuffer":s instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":s,cacheOnlineFile:n,encoderConfig:i},c=Oi(8,"track-buf-"),d=fe.reportApiInvoke(null,{id:c,tag:Tr.TRACER,name:Cn.CREATE_BUFFER_AUDIO_TRACK,options:[o]});if(re("DISABLE_WEBAUDIO"))throw new Ge(H.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");F.info("start create buffer source audio track with config",JSON.stringify(o),"trackId",c);const u=s;if(!(s instanceof AudioBuffer))try{s=await(async function(g,T){let R=null;if(typeof g=="string"){const A=Yx.get(g);if(A)return F.debug("use cached audio resource: ",g),A;try{R=(await Id((()=>Gc.get(g,{responseType:"arraybuffer"})),void 0,void 0,{maxRetryCount:3})).data}catch(w){throw new Ge(H.FETCH_AUDIO_FILE_FAILED,w.toString())}}else R=await new De(((w,k)=>{const L=new FileReader;L.onload=j=>{j.target?w(j.target.result):k(new Ge(H.READ_LOCAL_AUDIO_FILE_ERROR))},L.onerror=()=>{k(new Ge(H.READ_LOCAL_AUDIO_FILE_ERROR))},L.readAsArrayBuffer(g)}));const I=await(function(A){const w=vh();return new De(((k,L)=>{w.decodeAudioData(A,(j=>{k(j)}),(j=>{L(new Ge(H.DECODE_AUDIO_FILE_FAILED,j.toString()))}))}))})(R);return typeof g=="string"&&T&&Yx.set(g,I),I})(s,n)}catch(g){return d.onError(g),g.throw(F)}const p=new T4(s),m=new Xs(u,p,i?xm(i):{},c);return F.info("create buffer source audio track success, trackId:",c),d.onSuccess(m.getTrackId()),m},setAppType:function(e){if(F.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw F.debug("Invalid appType"),new Pe(H.INVALID_PARAMS,"invalid app type",e);te("APP_TYPE",Math.floor(e))},setLogLevel:function(e){F.setLogLevel(e)},enableLogUpload:function(){re("USE_NEW_LOG")?te("UPLOAD_LOG",!0):F.enableLogUpload()},disableLogUpload:function(){re("USE_NEW_LOG")?te("UPLOAD_LOG",!1):F.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new CF},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=fe.reportApiInvoke(null,{tag:Tr.TRACER,name:Cn.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Rr||e instanceof $l)){const u=new Pe(H.INVALID_TRACK,"the parameter is not a audio track");return n.onError(u),u.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof Rr?e.getTrackLabel():"remote_track",s=e.getVolumeLevel();let o=s,c=s;const d=Date.now();return new De((u=>{const p=setInterval((()=>{const m=e.getVolumeLevel();o=m>o?m:o,c=m<c?m:c;const g=o-c>1e-4,T=Date.now()-d;if(g||T>t){clearInterval(p);const R=g,I={duration:T,deviceLabel:i,maxVolumeLevel:o,result:R};F.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(I))),n.onSuccess(I),u(R)}}),200)}))},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=fe.reportApiInvoke(null,{tag:Tr.TRACER,name:Cn.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof zi||e instanceof tf)){const g=new Pe(H.INVALID_TRACK,"the parameter is not a video track");return n.onError(g),g.throw()}t&&t<1e3&&(t=1e3);const i=e instanceof zi?e.getTrackLabel():"remote_track",s=e.getMediaStreamTrack(!0),o=document.createElement("video");o.style.width="1px",o.style.height="1px",o.setAttribute("muted",""),o.muted=!0,o.setAttribute("playsinline",""),o.controls=!1,(Xo()||fh())&&(o.style.opacity="0.01",o.style.position="fixed",o.style.left="0",o.style.top="0",document.body.appendChild(o)),o.srcObject=new MediaStream([s]),o.play();const c=document.createElement("canvas");c.width=160,c.height=120;let d=0,u=0;try{const g=Date.now();d=await(function(T,R,I,A){let w,k=0,L=null;return new De(((j,K)=>{function W(){k>A&&w&&(w(),j(k));const Y=I.getContext("2d");if(!Y){const ge=new Pe(H.UNEXPECTED_ERROR,"can not get canvas 2d context.");return F.error(ge.toString()),void K(ge)}Y.drawImage(T,0,0,160,120);const se=Y.getImageData(0,0,I.width,I.height),de=Math.floor(se.data.length/3);if(L){for(let ge=0;ge<de;ge+=3)if(se.data[ge]!==L[ge])return k+=1,void(L=se.data);L=se.data}else L=se.data}setTimeout((()=>{w&&(w(),j(k))}),R),w=jD((()=>{W()}),30)}))})(o,t,c,4),u=Date.now()-g}catch(g){throw n.onError(g),g}q4===mi.SAFARI&&(o.pause(),o.remove()),o.srcObject=null;const p=d>4,m={duration:u,changedPicNum:d,deviceLabel:i,result:p};return F.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(m))),n.onSuccess(m),p},setArea:fP,audioElementPlayCenter:wi,resumeAudioContext:function(){wi.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){e6.processExternalMediaAEC(e)},registerExtensions:function(e){const t=re("PLUGIN_INFO")||[];e.forEach((n=>{"name"in n&&!Re(t).call(t,n.name)&&t.push(n.name);const i=n;i.__registered__=!0,i.logger.hookLog=F.extLog,i.reporter.hookApiInvoke=fe.extApiInvoke,i.parameters&&Object.keys(i.parameters).forEach((s=>{i.parameters[s]=re(s)}))})),Ds("PLUGIN_INFO",t)},ChannelMediaRelayError:vi,ChannelMediaRelayEvent:ko,ChannelMediaRelayState:wa,RemoteStreamFallbackType:Rv,RemoteStreamType:yz,ConnectionDisconnectedReason:Ti,AudienceLatencyLevelType:Di,AREAS:Ri,preload:async function(e,t,n,i){return xF(e,t,n,i)}});return Object.defineProperties(r,{onAudioAutoplayFailed:{get:()=>Ql.onAudioAutoplayFailed,set:e=>{Ql.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Ql.onAutoplayFailed,set:e=>{Ql.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>r._onSecurityPolicyViolation,set(e){r._onSecurityPolicyViolation=e,t6(e)}},__CLIENT_LIST__:{get:()=>re("SHOW_GLOBAL_CLIENT_LIST")?yh:[]}}),_l.on(qs.CAMERA_DEVICE_CHANGED,(e=>{F.info("camera device changed",JSON.stringify(e)),r.onCameraChanged&&r.onCameraChanged(e),r.safeEmit(fa.CAMERA_CHANGED,e)})),_l.on(qs.RECORDING_DEVICE_CHANGED,(e=>{F.info("microphone device changed",JSON.stringify(e)),r.onMicrophoneChanged&&r.onMicrophoneChanged(e),r.safeEmit(fa.MICROPHONE_CHANGED,e)})),_l.on(qs.PLAYOUT_DEVICE_CHANGED,(e=>{F.debug("playout device changed",JSON.stringify(e)),r.onPlaybackDeviceChanged&&r.onPlaybackDeviceChanged(e),r.safeEmit(fa.PLAYBACK_DEVICE_CHANGED,e)})),wi.onAutoplayFailed=()=>{F.info("detect audio element autoplay failed"),Ql.onAudioAutoplayFailed&&Ql.onAudioAutoplayFailed()},Ai.on("autoplay-failed",(()=>{F.info("detect webaudio autoplay failed"),Ql.onAudioAutoplayFailed&&Ql.onAudioAutoplayFailed(),r.safeEmit(fa.AUTOPLAY_FAILED)})),Ai.on(js.STATE_CHANGE,((e,t)=>{F.info("audio context state changed: ".concat(t," => ").concat(e)),r.onAudioContextStateChanged&&r.onAudioContextStateChanged(e,t),r.safeEmit(fa.AUDIO_CONTEXT_STATE_CHANGED,e,t)})),$r.on(Ys.NETWORK_STATE_CHANGE,((e,t)=>{F.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))})),window&&(window.__ARTC__=r),r}))})(fG)),fG.exports}var lTe=cTe();const dTe=L7(lTe);/**
 * @license agora-rtc-react
 * @version 2.5.0
 *
 * Copyright (c) Agora, Inc.
 *
 * This source code is licensed under the MIT license.
 */var uTe=Object.create,vJ=Object.defineProperty,hTe=Object.getOwnPropertyDescriptor,pTe=Object.getOwnPropertyNames,fTe=Object.getPrototypeOf,_Te=Object.prototype.hasOwnProperty,mTe=(l,a)=>()=>(a||l((a={exports:{}}).exports,a),a.exports),ETe=(l,a)=>{for(var h in a)vJ(l,h,{get:a[h],enumerable:!0})},Eie=(l,a,h,_)=>{if(a&&typeof a=="object"||typeof a=="function")for(let S of pTe(a))!_Te.call(l,S)&&S!==h&&vJ(l,S,{get:()=>a[S],enumerable:!(_=hTe(a,S))||_.enumerable});return l},gTe=(l,a,h)=>(Eie(l,a,"default"),h),hO=(l,a,h)=>(h=l!=null?uTe(fTe(l)):{},Eie(!l||!l.__esModule?vJ(h,"default",{value:l,enumerable:!0}):h,l)),pO=mTe((l,a)=>{(function(h,_){typeof l=="object"&&typeof a<"u"?a.exports=_():typeof define=="function"&&define.amd?define(_):(h=typeof globalThis<"u"?globalThis:h||self).AgoraRTC=_()})(l,function(){function h(r,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if(n!=="default"&&!(n in r)){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}})}),Object.freeze(r)}var _=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function S(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var y=function(r){try{return!!r()}catch{return!0}},b=!y(function(){var r=(function(){}).bind();return typeof r!="function"||r.hasOwnProperty("prototype")}),D=b,U=Function.prototype,x=U.call,q=D&&U.bind.bind(x,x),J=D?q:function(r){return function(){return x.apply(r,arguments)}},ee=J({}.isPrototypeOf),ue=function(r){return r&&r.Math===Math&&r},oe=ue(typeof globalThis=="object"&&globalThis)||ue(typeof window=="object"&&window)||ue(typeof self=="object"&&self)||ue(typeof _=="object"&&_)||ue(typeof _=="object"&&_)||(function(){return this})()||Function("return this")(),le=b,pe=Function.prototype,Ne=pe.apply,Ve=pe.call,Ae=typeof Reflect=="object"&&Reflect.apply||(le?Ve.bind(Ne):function(){return Ve.apply(Ne,arguments)}),Ue=J,ke=Ue({}.toString),qe=Ue("".slice),Te=function(r){return qe(ke(r),8,-1)},he=Te,_e=J,ye=function(r){if(he(r)==="Function")return _e(r)},Ie=typeof document=="object"&&document.all,$=Ie===void 0&&Ie!==void 0?function(r){return typeof r=="function"||r===Ie}:function(r){return typeof r=="function"},me={},Xe=!y(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),ct=b,Me=Function.prototype.call,Je=ct?Me.bind(Me):function(){return Me.apply(Me,arguments)},mt={},yt={}.propertyIsEnumerable,xe=Object.getOwnPropertyDescriptor,it=xe&&!yt.call({1:2},1);mt.f=it?function(r){var e=xe(this,r);return!!e&&e.enumerable}:yt;var ft,pt,xt=function(r,e){return{enumerable:!(1&r),configurable:!(2&r),writable:!(4&r),value:e}},ln=y,pn=Te,Zn=Object,ri=J("".split),si=ln(function(){return!Zn("z").propertyIsEnumerable(0)})?function(r){return pn(r)==="String"?ri(r,""):Zn(r)}:Zn,En=function(r){return r==null},oi=En,ui=TypeError,Kn=function(r){if(oi(r))throw new ui("Can't call method on "+r);return r},qn=si,Zi=Kn,Gi=function(r){return qn(Zi(r))},yi=$,vn=function(r){return typeof r=="object"?r!==null:yi(r)},xn={},ir=xn,Bi=oe,Sn=$,Us=function(r){return Sn(r)?r:void 0},Rn=function(r,e){return arguments.length<2?Us(ir[r])||Us(Bi[r]):ir[r]&&ir[r][e]||Bi[r]&&Bi[r][e]},Kt=oe.navigator,wt=Kt&&Kt.userAgent,Ot=wt?String(wt):"",un=oe,rn=Ot,Vn=un.process,Ci=un.Deno,is=Vn&&Vn.versions||Ci&&Ci.version,ur=is&&is.v8;ur&&(pt=(ft=ur.split("."))[0]>0&&ft[0]<4?1:+(ft[0]+ft[1])),!pt&&rn&&(!(ft=rn.match(/Edge\/(\d+)/))||ft[1]>=74)&&(ft=rn.match(/Chrome\/(\d+)/))&&(pt=+ft[1]);var wr=pt,hn=wr,hr=y,rs=oe.String,eo=!!Object.getOwnPropertySymbols&&!hr(function(){var r=Symbol("symbol detection");return!rs(r)||!(Object(r)instanceof Symbol)||!Symbol.sham&&hn&&hn<41}),Qc=eo&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Rf=Rn,Yd=$,Xr=ee,ho=Object,Fo=Qc?function(r){return typeof r=="symbol"}:function(r){var e=Rf("Symbol");return Yd(e)&&Xr(e.prototype,ho(r))},ju=String,Ts=function(r){try{return ju(r)}catch{return"Object"}},bE=$,Cf=Ts,gy=TypeError,hi=function(r){if(bE(r))return r;throw new gy(Cf(r)+" is not a function")},Sa=hi,oa=En,ka=function(r,e){var t=r[e];return oa(t)?void 0:Sa(t)},B_=Je,kS=$,Gu=vn,Sy=TypeError,Hh={exports:{}},Kh=oe,bf=Object.defineProperty,Wu=oe,Hu=function(r,e){try{bf(Kh,r,{value:e,configurable:!0,writable:!0})}catch{Kh[r]=e}return e},Ja="__core-js_shared__",po=Hh.exports=Wu[Ja]||Hu(Ja,{});(po.versions||(po.versions=[])).push({version:"3.42.0",mode:"pure",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var zh=Hh.exports,If=zh,Bo=function(r,e){return If[r]||(If[r]=e||{})},Yh=Kn,Ty=Object,Ao=function(r){return Ty(Yh(r))},j_=Ao,vy=J({}.hasOwnProperty),bi=Object.hasOwn||function(r,e){return vy(j_(r),e)},Ku=J,Qa=0,G_=Math.random(),yy=Ku(1 .toString),Ol=function(r){return"Symbol("+(r===void 0?"":r)+")_"+yy(++Qa+G_,36)},IE=Bo,Af=bi,LS=Ol,AE=eo,Nc=Qc,Dc=oe.Symbol,W_=IE("wks"),wE=Nc?Dc.for||Dc:Dc&&Dc.withoutSetter||LS,Fn=function(r){return Af(W_,r)||(W_[r]=AE&&Af(Dc,r)?Dc[r]:wE("Symbol."+r)),W_[r]},H_=Je,MS=vn,wo=Fo,Nl=ka,K_=function(r,e){var t,n;if(kS(t=r.toString)&&!Gu(n=B_(t,r))||kS(t=r.valueOf)&&!Gu(n=B_(t,r))||e!=="string")return n;throw new Sy("Can't convert object to primitive value")},wf=TypeError,qh=Fn("toPrimitive"),hs=function(r,e){if(!MS(r)||wo(r))return r;var t,n=Nl(r,qh);if(n){if(t=H_(n,r,e),!MS(t)||wo(t))return t;throw new wf("Can't convert object to primitive value")}return K_(r,e)},z_=Fo,hc=function(r){var e=hs(r,"string");return z_(e)?e:e+""},Xh=vn,Of=oe.document,US=Xh(Of)&&Xh(Of.createElement),Jh=function(r){return US?Of.createElement(r):{}},jb=Jh,xS=!Xe&&!y(function(){return Object.defineProperty(jb("div"),"a",{get:function(){return 7}}).a!==7}),OE=Xe,Qh=Je,cd=mt,Zh=xt,$h=Gi,VS=hc,zu=bi,Ry=xS,ep=Object.getOwnPropertyDescriptor;me.f=OE?ep:function(r,e){if(r=$h(r),e=VS(e),Ry)try{return ep(r,e)}catch{}if(zu(r,e))return Zh(!Qh(cd.f,r,e),r[e])};var qd=y,ld=$,Y_=/#|\.prototype\./,La=function(r,e){var t=tp[Nf(r)];return t===Yu||t!==FS&&(ld(e)?qd(e):!!e)},Nf=La.normalize=function(r){return String(r).replace(Y_,".").toLowerCase()},tp=La.data={},FS=La.NATIVE="N",Yu=La.POLYFILL="P",dd=La,BS=hi,Ma=b,ss=ye(ye.bind),aa=function(r,e){return BS(r),e===void 0?r:Ma?ss(r,e):function(){return r.apply(e,arguments)}},os={},NE=Xe&&y(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),DE=vn,PE=String,qu=TypeError,lr=function(r){if(DE(r))return r;throw new qu(PE(r)+" is not an object")},ud=Xe,Cy=xS,Gb=NE,Dl=lr,Df=hc,jS=TypeError,Xu=Object.defineProperty,by=Object.getOwnPropertyDescriptor,Ju="enumerable",q_="configurable",np="writable";os.f=ud?Gb?function(r,e,t){if(Dl(r),e=Df(e),Dl(t),typeof r=="function"&&e==="prototype"&&"value"in t&&np in t&&!t[np]){var n=by(r,e);n&&n[np]&&(r[e]=t.value,t={configurable:q_ in t?t[q_]:n[q_],enumerable:Ju in t?t[Ju]:n[Ju],writable:!1})}return Xu(r,e,t)}:Xu:function(r,e,t){if(Dl(r),e=Df(e),Dl(t),Cy)try{return Xu(r,e,t)}catch{}if("get"in t||"set"in t)throw new jS("Accessors not supported");return"value"in t&&(r[e]=t.value),r};var X_=os,Iy=xt,pc=Xe?function(r,e,t){return X_.f(r,e,Iy(1,t))}:function(r,e,t){return r[e]=t,r},Pl=oe,J_=Ae,Ay=ye,kE=$,wy=me.f,GS=dd,Ta=xn,Oy=aa,Zc=pc,LE=bi,Ny=function(r){var e=function(t,n,i){if(this instanceof e){switch(arguments.length){case 0:return new r;case 1:return new r(t);case 2:return new r(t,n)}return new r(t,n,i)}return J_(r,this,arguments)};return e.prototype=r.prototype,e},Ut=function(r,e){var t,n,i,s,o,c,d,u,p,m=r.target,g=r.global,T=r.stat,R=r.proto,I=g?Pl:T?Pl[m]:Pl[m]&&Pl[m].prototype,A=g?Ta:Ta[m]||Zc(Ta,m,{})[m],w=A.prototype;for(s in e)n=!(t=GS(g?s:m+(T?".":"#")+s,r.forced))&&I&&LE(I,s),c=A[s],n&&(d=r.dontCallGetSet?(p=wy(I,s))&&p.value:I[s]),o=n&&d?d:e[s],(t||R||typeof c!=typeof o)&&(u=r.bind&&n?Oy(o,Pl):r.wrap&&n?Ny(o):R&&kE(o)?Ay(o):o,(r.sham||o&&o.sham||c&&c.sham)&&Zc(u,"sham",!0),Zc(A,s,u),R&&(LE(Ta,i=m+"Prototype")||Zc(Ta,i,{}),Zc(Ta[i],s,o),r.real&&w&&(t||!w[s])&&Zc(w,s,o)))},Dy=Math.ceil,Py=Math.floor,Pf=Math.trunc||function(r){var e=+r;return(e>0?Py:Dy)(e)},N=Pf,X=function(r){var e=+r;return e!=e||e===0?0:N(e)},ie=X,ve=Math.max,tt=Math.min,lt=function(r,e){var t=ie(r);return t<0?ve(t+e,0):tt(t,e)},Ht=X,Jr=Math.min,xs=function(r){var e=Ht(r);return e>0?Jr(e,9007199254740991):0},pr=xs,Vr=function(r){return pr(r.length)},Ua=Gi,ip=lt,$c=Vr,hd=function(r){return function(e,t,n){var i=Ua(e),s=$c(i);if(s===0)return!r&&-1;var o,c=ip(n,s);if(r&&t!=t){for(;s>c;)if((o=i[c++])!=o)return!0}else for(;s>c;c++)if((r||c in i)&&i[c]===t)return r||c||0;return!r&&-1}},kl={includes:hd(!0),indexOf:hd(!1)},cL=kl.includes;Ut({target:"Array",proto:!0,forced:y(function(){return!Array(1).includes()})},{includes:function(r){return cL(this,r,arguments.length>1?arguments[1]:void 0)}});var ky=oe,mO=xn,to=function(r,e){var t=mO[r+"Prototype"],n=t&&t[e];if(n)return n;var i=ky[r],s=i&&i.prototype;return s&&s[e]},Wb=to("Array","includes"),Hb=vn,EO=Te,gO=Fn("match"),Ly=function(r){var e;return Hb(r)&&((e=r[gO])!==void 0?!!e:EO(r)==="RegExp")},lL=Ly,dL=TypeError,Kb={};Kb[Fn("toStringTag")]="z";var WS=String(Kb)==="[object z]",uL=WS,Ll=$,Xd=Te,SO=Fn("toStringTag"),TO=Object,vO=Xd((function(){return arguments})())==="Arguments",fc=uL?Xd:function(r){var e,t,n;return r===void 0?"Undefined":r===null?"Null":typeof(t=(function(i,s){try{return i[s]}catch{}})(e=TO(r),SO))=="string"?t:vO?Xd(e):(n=Xd(e))==="Object"&&Ll(e.callee)?"Arguments":n},zb=fc,hL=String,Fr=function(r){if(zb(r)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return hL(r)},Yb=Fn("match"),HS=Ut,qb=function(r){if(lL(r))throw new dL("The method doesn't accept regular expressions");return r},yO=Kn,rp=Fr,ME=function(r){var e=/./;try{"/./"[r](e)}catch{try{return e[Yb]=!1,"/./"[r](e)}catch{}}return!1},Xb=J("".indexOf);HS({target:"String",proto:!0,forced:!ME("includes")},{includes:function(r){return!!~Xb(rp(yO(this)),rp(qb(r)),arguments.length>1?arguments[1]:void 0)}});var RO=to("String","includes"),sp=ee,CO=Wb,bO=RO,UE=Array.prototype,KS=String.prototype,pL=function(r){var e=r.includes;return r===UE||sp(UE,r)&&e===UE.includes?CO:typeof r=="string"||r===KS||sp(KS,r)&&e===KS.includes?bO:e},Re=S(pL),IO=hi,AO=Ao,Jb=si,Jd=Vr,My=TypeError,el="Reduce of empty array with no initial value",pd=function(r){return function(e,t,n,i){var s=AO(e),o=Jb(s),c=Jd(s);if(IO(t),c===0&&n<2)throw new My(el);var d=0,u=1;if(n<2)for(;;){if(d in o){i=o[d],d+=u;break}if(d+=u,c<=d)throw new My(el)}for(;c>d;d+=u)d in o&&(i=t(i,o[d],d,s));return i}},xE={left:pd()},Qb=y,Qu=function(r,e){var t=[][r];return!!t&&Qb(function(){t.call(null,e||function(){return 1},1)})},fd=oe,Zb=Ot,VE=Te,kf=function(r){return Zb.slice(0,r.length)===r},Lf=kf("Bun/")?"BUN":kf("Cloudflare-Workers")?"CLOUDFLARE":kf("Deno/")?"DENO":kf("Node.js/")?"NODE":fd.Bun&&typeof Bun.version=="string"?"BUN":fd.Deno&&typeof Deno.version=="object"?"DENO":VE(fd.process)==="process"?"NODE":fd.window&&fd.document?"BROWSER":"REST",_d=Lf==="NODE",fL=xE.left;Ut({target:"Array",proto:!0,forced:!_d&&wr>79&&wr<83||!Qu("reduce")},{reduce:function(r){var e=arguments.length;return fL(this,r,e,e>1?arguments[1]:void 0)}});var Ml=to("Array","reduce"),$b=ee,op=Ml,FE=Array.prototype,Uy=function(r){var e=r.reduce;return r===FE||$b(FE,r)&&e===FE.reduce?op:e},ap=Uy,Ks=S(ap),eI=Te,tl=Array.isArray||function(r){return eI(r)==="Array"},BE=Ut,xy=tl,Vy=J([].reverse),nl=[1,2];BE({target:"Array",proto:!0,forced:String(nl)===String(nl.reverse())},{reverse:function(){return xy(this)&&(this.length=this.length),Vy(this)}});var md=to("Array","reverse"),Q_=ee,cp=md,Ul=Array.prototype,Z_=function(r){var e=r.reverse;return r===Ul||Q_(Ul,r)&&e===Ul.reverse?cp:e},Fy=Z_,zS=S(Fy),tI=Ol,Za=Bo("keys"),ps=function(r){return Za[r]||(Za[r]=tI(r))},Hr=!y(function(){function r(){}return r.prototype.constructor=null,Object.getPrototypeOf(new r)!==r.prototype}),$_=bi,Zu=$,nI=Ao,em=Hr,By=ps("IE_PROTO"),jE=Object,YS=jE.prototype,lp=em?jE.getPrototypeOf:function(r){var e=nI(r);if($_(e,By))return e[By];var t=e.constructor;return Zu(t)&&e instanceof t?t.prototype:e instanceof jE?YS:null},wO=J,qS=hi,iI=vn,tm=function(r){return iI(r)||r===null},dp=String,Mf=TypeError,up=function(r,e,t){try{return wO(qS(Object.getOwnPropertyDescriptor(r,e)[t]))}catch{}},rI=vn,sI=Kn,XS=function(r){if(tm(r))return r;throw new Mf("Can't set "+dp(r)+" as a prototype")},jy=Object.setPrototypeOf||("__proto__"in{}?(function(){var r,e=!1,t={};try{(r=up(Object.prototype,"__proto__","set"))(t,[]),e=t instanceof Array}catch{}return function(n,i){return sI(n),XS(i),rI(n)&&(e?r(n,i):n.__proto__=i),n}})():void 0),xl={},Oo={},Uf=bi,OO=Gi,_L=kl.indexOf,mL=Oo,oI=J([].push),jo=function(r,e){var t,n=OO(r),i=0,s=[];for(t in n)!Uf(mL,t)&&Uf(n,t)&&oI(s,t);for(;e.length>i;)Uf(n,t=e[i++])&&(~_L(s,t)||oI(s,t));return s},nm=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],JS=jo,QS=nm.concat("length","prototype");xl.f=Object.getOwnPropertyNames||function(r){return JS(r,QS)};var Qd={};Qd.f=Object.getOwnPropertySymbols;var GE=Rn,WE=xl,EL=Qd,NO=lr,gL=J([].concat),DO=GE("Reflect","ownKeys")||function(r){var e=WE.f(NO(r)),t=EL.f;return t?gL(e,t(r)):e},hp=bi,aI=DO,Gy=me,PO=os,pp={},kO=jo,Wy=nm,fp=Object.keys||function(r){return kO(r,Wy)},LO=Xe,Hy=NE,MO=os,ZS=lr,UO=Gi,xO=fp;pp.f=LO&&!Hy?Object.defineProperties:function(r,e){ZS(r);for(var t,n=UO(e),i=xO(e),s=i.length,o=0;s>o;)MO.f(r,t=i[o++],n[t]);return r};var il,$S=Rn("document","documentElement"),cI=lr,xf=pp,$u=nm,eT=Oo,lI=$S,dI=Jh,_p="prototype",mp="script",Ky=ps("IE_PROTO"),HE=function(){},Vf=function(r){return"<"+mp+">"+r+"</"+mp+">"},KE=function(r){r.write(Vf("")),r.close();var e=r.parentWindow.Object;return r=null,e},Ff=function(){try{il=new ActiveXObject("htmlfile")}catch{}var r,e,t;Ff=typeof document<"u"?document.domain&&il?KE(il):(e=dI("iframe"),t="java"+mp+":",e.style.display="none",lI.appendChild(e),e.src=String(t),(r=e.contentWindow.document).open(),r.write(Vf("document.F=Object")),r.close(),r.F):KE(il);for(var n=$u.length;n--;)delete Ff[_p][$u[n]];return Ff()};eT[Ky]=!0;var Zd=Object.create||function(r,e){var t;return r!==null?(HE[_p]=cI(r),t=new HE,HE[_p]=null,t[Ky]=r):t=Ff(),e===void 0?t:xf.f(t,e)},uI=vn,Bf=pc,xi=Error,fs=J("".replace),ca=String(new xi("zxcasd").stack),zE=/\n\s*at [^:]*:[^\n]*/,YE=zE.test(ca),im=xt,zy=!y(function(){var r=new Error("a");return!("stack"in r)||(Object.defineProperty(r,"stack",im(1,7)),r.stack!==7)}),tT=pc,qE=function(r,e){if(YE&&typeof r=="string"&&!xi.prepareStackTrace)for(;e--;)r=fs(r,zE,"");return r},SL=zy,fo=Error.captureStackTrace,Vl={},hI=Vl,VO=Fn("iterator"),FO=Array.prototype,pI=function(r){return r!==void 0&&(hI.Array===r||FO[VO]===r)},fI=fc,nT=ka,_I=En,rl=Vl,la=Fn("iterator"),Ep=function(r){if(!_I(r))return nT(r,la)||nT(r,"@@iterator")||rl[fI(r)]},iT=Je,Yy=hi,mI=lr,gp=Ts,qy=Ep,EI=TypeError,rm=function(r,e){var t=arguments.length<2?qy(r):e;if(Yy(t))return mI(iT(t,r));throw new EI(gp(r)+" is not iterable")},BO=Je,Xy=lr,jO=ka,Jy=function(r,e,t){var n,i;Xy(r);try{if(!(n=jO(r,"return"))){if(e==="throw")throw t;return t}n=BO(n,r)}catch(s){i=!0,n=s}if(e==="throw")throw t;if(i)throw n;return Xy(n),t},GO=aa,WO=Je,gI=lr,HO=Ts,TL=pI,KO=Vr,Qy=ee,zO=rm,SI=Ep,Zy=Jy,YO=TypeError,jf=function(r,e){this.stopped=r,this.result=e},$y=jf.prototype,eh=function(r,e,t){var n,i,s,o,c,d,u,p=t&&t.that,m=!(!t||!t.AS_ENTRIES),g=!(!t||!t.IS_RECORD),T=!(!t||!t.IS_ITERATOR),R=!(!t||!t.INTERRUPTED),I=GO(e,p),A=function(k){return n&&Zy(n,"normal",k),new jf(!0,k)},w=function(k){return m?(gI(k),R?I(k[0],k[1],A):I(k[0],k[1])):R?I(k,A):I(k)};if(g)n=r.iterator;else if(T)n=r;else{if(!(i=SI(r)))throw new YO(HO(r)+" is not iterable");if(TL(i)){for(s=0,o=KO(r);o>s;s++)if((c=w(r[s]))&&Qy($y,c))return c;return new jf(!1)}n=zO(r,i)}for(d=g?r.next:n.next;!(u=WO(d,n)).done;){try{c=w(u.value)}catch(k){Zy(n,"throw",k)}if(typeof c=="object"&&c&&Qy($y,c))return c}return new jf(!1)},vL=Fr,qO=Ut,XE=ee,eR=lp,Gf=jy,tR=function(r,e,t){for(var n=aI(e),i=PO.f,s=Gy.f,o=0;o<n.length;o++){var c=n[o];hp(r,c)||t&&hp(t,c)||i(r,c,s(e,c))}},sm=Zd,JE=pc,QE=xt,XO=function(r,e){uI(e)&&"cause"in e&&Bf(r,"cause",e.cause)},JO=function(r,e,t,n){SL&&(fo?fo(r,e):tT(r,"stack",qE(t,n)))},QO=eh,ZO=function(r,e){return r===void 0?arguments.length<2?"":e:vL(r)},TI=Fn("toStringTag"),Wf=Error,$O=[].push,Fl=function(r,e){var t,n=XE(ZE,this);Gf?t=Gf(new Wf,n?eR(this):ZE):(t=n?this:sm(ZE),JE(t,TI,"Error")),e!==void 0&&JE(t,"message",ZO(e)),JO(t,Fl,t.stack,1),arguments.length>2&&XO(t,arguments[2]);var i=[];return QO(r,$O,{that:i}),JE(t,"errors",i),t};Gf?Gf(Fl,Wf):tR(Fl,Wf,{name:!0});var ZE=Fl.prototype=sm(Wf.prototype,{constructor:QE(1,Fl),message:QE(1,""),name:QE(1,"AggregateError")});qO({global:!0},{AggregateError:Fl});var Hf,Sp,Tp,eN=$,nR=oe.WeakMap,vI=eN(nR)&&/native code/.test(String(nR)),iR=oe,tN=vn,yL=pc,rT=bi,$E=zh,sT=ps,yI=Oo,eg="Object already initialized",tg=iR.TypeError,nN=iR.WeakMap;if(vI||$E.state){var No=$E.state||($E.state=new nN);No.get=No.get,No.has=No.has,No.set=No.set,Hf=function(r,e){if(No.has(r))throw new tg(eg);return e.facade=r,No.set(r,e),e},Sp=function(r){return No.get(r)||{}},Tp=function(r){return No.has(r)}}else{var Ed=sT("state");yI[Ed]=!0,Hf=function(r,e){if(rT(r,Ed))throw new tg(eg);return e.facade=r,yL(r,Ed,e),e},Sp=function(r){return rT(r,Ed)?r[Ed]:{}},Tp=function(r){return rT(r,Ed)}}var sl,RI,Kf,$a={set:Hf,get:Sp,has:Tp,enforce:function(r){return Tp(r)?Sp(r):Hf(r,{})},getterFor:function(r){return function(e){var t;if(!tN(e)||(t=Sp(e)).type!==r)throw new tg("Incompatible receiver, "+r+" required");return t}}},zf=Xe,oT=bi,ng=Function.prototype,iN=zf&&Object.getOwnPropertyDescriptor,rR=oT(ng,"name"),Yf={PROPER:rR&&(function(){}).name==="something",CONFIGURABLE:rR&&(!zf||zf&&iN(ng,"name").configurable)},rN=pc,Vs=function(r,e,t,n){return n&&n.enumerable?r[e]=t:rN(r,e,t),r},th=y,qf=$,sN=vn,Xf=Zd,$d=lp,va=Vs,Jf=Fn("iterator"),aT=!1;[].keys&&("next"in(Kf=[].keys())?(RI=$d($d(Kf)))!==Object.prototype&&(sl=RI):aT=!0);var CI=!sN(sl)||th(function(){var r={};return sl[Jf].call(r)!==r});qf((sl=CI?{}:Xf(sl))[Jf])||va(sl,Jf,function(){return this});var sR={IteratorPrototype:sl,BUGGY_SAFARI_ITERATORS:aT},oN=fc,om=WS?{}.toString:function(){return"[object "+oN(this)+"]"},oR=WS,aN=os.f,cN=pc,lN=bi,aR=om,cR=Fn("toStringTag"),ya=function(r,e,t,n){var i=t?r:r&&r.prototype;i&&(lN(i,cR)||aN(i,cR,{configurable:!0,value:e}),n&&!oR&&cN(i,"toString",aR))},dN=sR.IteratorPrototype,uN=Zd,RL=xt,hN=ya,xa=Vl,ec=function(){return this},ig=function(r,e,t,n){var i=e+" Iterator";return r.prototype=uN(dN,{next:RL(+!n,t)}),hN(r,i,!1,!0),xa[i]=ec,r},pN=Ut,fN=Je,_N=Yf,mN=ig,lR=lp,bI=ya,dR=Vs,uR=Vl,EN=sR,II=_N.PROPER,vp=EN.BUGGY_SAFARI_ITERATORS,am=Fn("iterator"),hR="keys",yp="values",rg="entries",AI=function(){return this},pR=function(r,e,t,n,i,s,o){mN(t,e,n);var c,d,u,p=function(w){if(w===i&&I)return I;if(!vp&&w&&w in T)return T[w];switch(w){case hR:case yp:case rg:return function(){return new t(this,w)}}return function(){return new t(this)}},m=e+" Iterator",g=!1,T=r.prototype,R=T[am]||T["@@iterator"]||i&&T[i],I=!vp&&R||p(i),A=e==="Array"&&T.entries||R;if(A&&(c=lR(A.call(new r)))!==Object.prototype&&c.next&&(bI(c,m,!0,!0),uR[m]=AI),II&&i===yp&&R&&R.name!==yp&&(g=!0,I=function(){return fN(R,this)}),i)if(d={values:p(yp),keys:s?I:p(hR),entries:p(rg)},o)for(u in d)(vp||g||!(u in T))&&dR(T,u,d[u]);else pN({target:e,proto:!0,forced:vp||g},d);return o&&T[am]!==I&&dR(T,am,I,{}),uR[e]=I,d},Rp=function(r,e){return{value:r,done:e}},gN=Gi,eu=Vl,cT=$a;os.f;var CL=pR,Qf=Rp,tu="Array Iterator",SN=cT.set,fR=cT.getterFor(tu);CL(Array,"Array",function(r,e){SN(this,{type:tu,target:gN(r),index:0,kind:e})},function(){var r=fR(this),e=r.target,t=r.index++;if(!e||t>=e.length)return r.target=null,Qf(void 0,!0);switch(r.kind){case"keys":return Qf(t,!1);case"values":return Qf(e[t],!1)}return Qf([t,e[t]],!1)},"values"),eu.Arguments=eu.Array;var lT=os,as=function(r,e,t){return lT.f(r,e,t)},bL=Rn,IL=as,TN=Xe,cm=Fn("species"),Zf=ee,vN=TypeError,sg=function(r,e){if(Zf(e,r))return r;throw new vN("Incorrect invocation")},dT=$,ol=zh,yN=J(Function.toString);dT(ol.inspectSource)||(ol.inspectSource=function(r){return yN(r)});var uT=ol.inspectSource,RN=J,wI=y,hT=$,_R=fc,CN=uT,nu=function(){},_o=Rn("Reflect","construct"),lm=/^\s*(?:class|function)\b/,bN=RN(lm.exec),Va=!lm.test(nu),Cp=function(r){if(!hT(r))return!1;try{return _o(nu,[],r),!0}catch{return!1}},mR=function(r){if(!hT(r))return!1;switch(_R(r)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Va||!!bN(lm,CN(r))}catch{return!0}};mR.sham=!0;var nh,fr,_c,Bl,$f=!_o||wI(function(){var r;return Cp(Cp.call)||!Cp(Object)||!Cp(function(){r=!0})||r})?mR:Cp,IN=$f,AL=Ts,OI=TypeError,Pc=lr,iu=function(r){if(IN(r))return r;throw new OI(AL(r)+" is not a constructor")},AN=En,jl=Fn("species"),og=function(r,e){var t,n=Pc(r).constructor;return n===void 0||AN(t=Pc(n)[jl])?e:iu(t)},Do=J([].slice),dm=TypeError,da=function(r,e){if(r<e)throw new dm("Not enough arguments");return r},pT=/(?:ipad|iphone|ipod).*applewebkit/i.test(Ot),vs=oe,ih=Ae,wN=aa,e_=$,fT=bi,um=y,t_=$S,ON=Do,ER=Jh,_T=da,NN=pT,gR=_d,ag=vs.setImmediate,mT=vs.clearImmediate,wL=vs.process,Or=vs.Dispatch,Fs=vs.Function,Wi=vs.MessageChannel,_r=vs.String,Nr=0,Go={},rh="onreadystatechange";um(function(){nh=vs.location});var sh=function(r){if(fT(Go,r)){var e=Go[r];delete Go[r],e()}},hm=function(r){return function(){sh(r)}},ru=function(r){sh(r.data)},no=function(r){vs.postMessage(_r(r),nh.protocol+"//"+nh.host)};ag&&mT||(ag=function(r){_T(arguments.length,1);var e=e_(r)?r:Fs(r),t=ON(arguments,1);return Go[++Nr]=function(){ih(e,void 0,t)},fr(Nr),Nr},mT=function(r){delete Go[r]},gR?fr=function(r){wL.nextTick(hm(r))}:Or&&Or.now?fr=function(r){Or.now(hm(r))}:Wi&&!NN?(Bl=(_c=new Wi).port2,_c.port1.onmessage=ru,fr=wN(Bl.postMessage,Bl)):vs.addEventListener&&e_(vs.postMessage)&&!vs.importScripts&&nh&&nh.protocol!=="file:"&&!um(no)?(fr=no,vs.addEventListener("message",ru,!1)):fr=rh in ER("script")?function(r){t_.appendChild(ER("script"))[rh]=function(){t_.removeChild(this),sh(r)}}:function(r){setTimeout(hm(r),0)});var al={set:ag,clear:mT},bp=oe,NI=Xe,gd=Object.getOwnPropertyDescriptor,n_=function(r){if(!NI)return bp[r];var e=gd(bp,r);return e&&e.value},pm=function(){this.head=null,this.tail=null};pm.prototype={add:function(r){var e={item:r,next:null},t=this.tail;t?t.next=e:this.head=e,this.tail=e},get:function(){var r=this.head;if(r)return(this.head=r.next)===null&&(this.tail=null),r.item}};var io,fm,_m,i_,cg,oh=pm,tc=/ipad|iphone|ipod/i.test(Ot)&&typeof Pebble<"u",r_=/web0s(?!.*chrome)/i.test(Ot),mc=oe,lg=n_,ET=aa,mm=al.set,DN=oh,gT=pT,DI=tc,Gl=r_,dg=_d,kc=mc.MutationObserver||mc.WebKitMutationObserver,SR=mc.document,TR=mc.process,Em=mc.Promise,Sd=lg("queueMicrotask");if(!Sd){var ah=new DN,Ip=function(){var r,e;for(dg&&(r=TR.domain)&&r.exit();e=ah.get();)try{e()}catch(t){throw ah.head&&io(),t}r&&r.enter()};gT||dg||Gl||!kc||!SR?!DI&&Em&&Em.resolve?((i_=Em.resolve(void 0)).constructor=Em,cg=ET(i_.then,i_),io=function(){cg(Ip)}):dg?io=function(){TR.nextTick(Ip)}:(mm=ET(mm,mc),io=function(){mm(Ip)}):(fm=!0,_m=SR.createTextNode(""),new kc(Ip).observe(_m,{characterData:!0}),io=function(){_m.data=fm=!fm}),Sd=function(r){ah.head||io(),ah.add(r)}}var s_=Sd,Td=function(r){try{return{error:!1,value:r()}}catch(e){return{error:!0,value:e}}},cl=oe.Promise,PN=oe,su=cl,PI=$,OL=dd,NL=uT,DL=Fn,vR=Lf,ug=wr,o_=su&&su.prototype,yR=DL("species"),RR=PI(PN.PromiseRejectionEvent),kN=OL("Promise",function(){var r=NL(su),e=r!==String(su);if(!e&&ug===66||!o_.catch||!o_.finally)return!0;if(!ug||ug<51||!/native code/.test(r)){var t=new su(function(i){i(1)}),n=function(i){i(function(){},function(){})};if((t.constructor={})[yR]=n,!(t.then(function(){})instanceof n))return!0}return!(e||vR!=="BROWSER"&&vR!=="DENO"||RR)}),ch={CONSTRUCTOR:kN,REJECTION_EVENT:RR},ua={},CR=hi,LN=TypeError,bR=function(r){var e,t;this.promise=new r(function(n,i){if(e!==void 0||t!==void 0)throw new LN("Bad Promise constructor");e=n,t=i}),this.resolve=CR(e),this.reject=CR(t)};ua.f=function(r){return new bR(r)};var hg,IR,ys=Ut,Ap=_d,Lc=oe,lh=Je,PL=Vs,kL=ya,LL=function(r){var e=bL(r);TN&&e&&!e[cm]&&IL(e,cm,{configurable:!0,get:function(){return this}})},AR=hi,dh=$,kI=vn,wR=sg,LI=og,wp=al.set,ll=s_,ST=function(r,e){try{arguments.length===1?console.error(r):console.error(r,e)}catch{}},ML=Td,MN=oh,OR=$a,pg=cl,NR=ch,MI=ua,Op="Promise",DR=NR.CONSTRUCTOR,UN=NR.REJECTION_EVENT,TT=OR.getterFor(Op),UI=OR.set,xI=pg&&pg.prototype,Np=pg,vT=xI,gm=Lc.TypeError,yT=Lc.document,fg=Lc.process,Vi=MI.f,VI=Vi,PR=!!(yT&&yT.createEvent&&Lc.dispatchEvent),RT="unhandledrejection",kR=function(r){var e;return!(!kI(r)||!dh(e=r.then))&&e},CT=function(r,e){var t,n,i,s=e.value,o=e.state===1,c=o?r.ok:r.fail,d=r.resolve,u=r.reject,p=r.domain;try{c?(o||(e.rejection===2&&UL(e),e.rejection=1),c===!0?t=s:(p&&p.enter(),t=c(s),p&&(p.exit(),i=!0)),t===r.promise?u(new gm("Promise-chain cycle")):(n=kR(t))?lh(n,t,d,u):d(t)):u(s)}catch(m){p&&!i&&p.exit(),u(m)}},Sm=function(r,e){r.notified||(r.notified=!0,ll(function(){for(var t,n=r.reactions;t=n.get();)CT(t,r);r.notified=!1,e&&!r.rejection&&mg(r)}))},_g=function(r,e,t){var n,i;PR?((n=yT.createEvent("Event")).promise=e,n.reason=t,n.initEvent(r,!1,!0),Lc.dispatchEvent(n)):n={promise:e,reason:t},!UN&&(i=Lc["on"+r])?i(n):r===RT&&ST("Unhandled promise rejection",t)},mg=function(r){lh(wp,Lc,function(){var e,t=r.facade,n=r.value;if(LR(r)&&(e=ML(function(){Ap?fg.emit("unhandledRejection",n,t):_g(RT,t,n)}),r.rejection=Ap||LR(r)?2:1,e.error))throw e.value})},LR=function(r){return r.rejection!==1&&!r.parent},UL=function(r){lh(wp,Lc,function(){var e=r.facade;Ap?fg.emit("rejectionHandled",e):_g("rejectionhandled",e,r.value)})},ou=function(r,e,t){return function(n){r(e,n,t)}},vd=function(r,e,t){r.done||(r.done=!0,t&&(r=t),r.value=e,r.state=2,Sm(r,!0))},Eg=function(r,e,t){if(!r.done){r.done=!0,t&&(r=t);try{if(r.facade===e)throw new gm("Promise can't be resolved itself");var n=kR(e);n?ll(function(){var i={done:!1};try{lh(n,e,ou(Eg,i,r),ou(vd,i,r))}catch(s){vd(i,s,r)}}):(r.value=e,r.state=1,Sm(r,!1))}catch(i){vd({done:!1},i,r)}}};DR&&(vT=(Np=function(r){wR(this,vT),AR(r),lh(hg,this);var e=TT(this);try{r(ou(Eg,e),ou(vd,e))}catch(t){vd(e,t)}}).prototype,(hg=function(r){UI(this,{type:Op,done:!1,notified:!1,parent:!1,reactions:new MN,rejection:!1,state:0,value:null})}).prototype=PL(vT,"then",function(r,e){var t=TT(this),n=Vi(LI(this,Np));return t.parent=!0,n.ok=!dh(r)||r,n.fail=dh(e)&&e,n.domain=Ap?fg.domain:void 0,t.state===0?t.reactions.add(n):ll(function(){CT(n,t)}),n.promise}),IR=function(){var r=new hg,e=TT(r);this.promise=r,this.resolve=ou(Eg,e),this.reject=ou(vd,e)},MI.f=Vi=function(r){return r===Np||r===void 0?new IR(r):VI(r)}),ys({global:!0,wrap:!0,forced:DR},{Promise:Np}),kL(Np,Op,!1,!0),LL(Op);var gg=Fn("iterator"),Qr=!1;try{var FI=0,Ra={next:function(){return{done:!!FI++}},return:function(){Qr=!0}};Ra[gg]=function(){return this},Array.from(Ra,function(){throw 2})}catch{}var xL=cl,BI=function(r,e){try{if(!e&&!Qr)return!1}catch{return!1}var t=!1;try{var n={};n[gg]=function(){return{next:function(){return{done:t=!0}}}},r(n)}catch{}return t},Dp=ch.CONSTRUCTOR||!BI(function(r){xL.all(r).then(void 0,function(){})}),MR=Je,xN=hi,VN=ua,jI=Td,GI=eh;Ut({target:"Promise",stat:!0,forced:Dp},{all:function(r){var e=this,t=VN.f(e),n=t.resolve,i=t.reject,s=jI(function(){var o=xN(e.resolve),c=[],d=0,u=1;GI(r,function(p){var m=d++,g=!1;u++,MR(o,e,p).then(function(T){g||(g=!0,c[m]=T,--u||n(c))},i)}),--u||n(c)});return s.error&&i(s.value),t.promise}});var VL=Ut,FN=ch.CONSTRUCTOR;cl&&cl.prototype,VL({target:"Promise",proto:!0,forced:FN,real:!0},{catch:function(r){return this.then(void 0,r)}});var FL=Je,BN=hi,BL=ua,jL=Td,a_=eh;Ut({target:"Promise",stat:!0,forced:Dp},{race:function(r){var e=this,t=BL.f(e),n=t.reject,i=jL(function(){var s=BN(e.resolve);a_(r,function(o){FL(s,e,o).then(t.resolve,n)})});return i.error&&n(i.value),t.promise}});var jN=ua;Ut({target:"Promise",stat:!0,forced:ch.CONSTRUCTOR},{reject:function(r){var e=jN.f(this);return(0,e.reject)(r),e.promise}});var WI=lr,GL=vn,WL=ua,bT=function(r,e){if(WI(r),GL(e)&&e.constructor===r)return e;var t=WL.f(r);return(0,t.resolve)(e),t.promise},HL=Ut,au=cl,HI=ch.CONSTRUCTOR,GN=bT,WN=Rn("Promise"),IT=!HI;HL({target:"Promise",stat:!0,forced:!0},{resolve:function(r){return GN(IT&&this===WN?au:this,r)}});var yd=Je,HN=hi,UR=ua,Pp=Td,KL=eh;Ut({target:"Promise",stat:!0,forced:Dp},{allSettled:function(r){var e=this,t=UR.f(e),n=t.resolve,i=t.reject,s=Pp(function(){var o=HN(e.resolve),c=[],d=0,u=1;KL(r,function(p){var m=d++,g=!1;u++,yd(o,e,p).then(function(T){g||(g=!0,c[m]={status:"fulfilled",value:T},--u||n(c))},function(T){g||(g=!0,c[m]={status:"rejected",reason:T},--u||n(c))})}),--u||n(c)});return s.error&&i(s.value),t.promise}});var zL=Je,Sg=hi,KN=Rn,YL=ua,qL=Td,XL=eh,KI="No one promise resolved";Ut({target:"Promise",stat:!0,forced:Dp},{any:function(r){var e=this,t=KN("AggregateError"),n=YL.f(e),i=n.resolve,s=n.reject,o=qL(function(){var c=Sg(e.resolve),d=[],u=0,p=1,m=!1;XL(r,function(g){var T=u++,R=!1;p++,zL(c,e,g).then(function(I){R||m||(m=!0,i(I))},function(I){R||m||(R=!0,d[T]=I,--p||s(new t(d,KI)))})}),--p||s(new t(d,KI))});return o.error&&s(o.value),n.promise}});var JL=Ut,QL=Ae,ZL=Do,zN=ua,Tg=hi,Tm=Td,vg=oe.Promise,zI=!1;JL({target:"Promise",stat:!0,forced:!vg||!vg.try||Tm(function(){vg.try(function(r){zI=r===8},8)}).error||!zI},{try:function(r){var e=arguments.length>1?ZL(arguments,1):[],t=zN.f(this),n=Tm(function(){return QL(Tg(r),void 0,e)});return(n.error?t.reject:t.resolve)(n.value),t.promise}});var yg=ua;Ut({target:"Promise",stat:!0},{withResolvers:function(){var r=yg.f(this);return{promise:r.promise,resolve:r.resolve,reject:r.reject}}});var AT=Ut,Rg=cl,xR=y,YI=Rn,qI=$,VR=og,FR=bT,YN=Rg&&Rg.prototype;AT({target:"Promise",proto:!0,real:!0,forced:!!Rg&&xR(function(){YN.finally.call({then:function(){}},function(){})})},{finally:function(r){var e=VR(this,YI("Promise")),t=qI(r);return this.then(t?function(n){return FR(e,r()).then(function(){return n})}:r,t?function(n){return FR(e,r()).then(function(){throw n})}:r)}});var wT=J,qN=X,OT=Fr,$L=Kn,e1=wT("".charAt),XI=wT("".charCodeAt),BR=wT("".slice),Cg=function(r){return function(e,t){var n,i,s=OT($L(e)),o=qN(t),c=s.length;return o<0||o>=c?r?"":void 0:(n=XI(s,o))<55296||n>56319||o+1===c||(i=XI(s,o+1))<56320||i>57343?r?e1(s,o):n:r?BR(s,o,o+2):i-56320+(n-55296<<10)+65536}},vm={codeAt:Cg(!1),charAt:Cg(!0)},t1=vm.charAt,NT=Fr,JI=$a,XN=pR,jR=Rp,GR="String Iterator",JN=JI.set,QI=JI.getterFor(GR);XN(String,"String",function(r){JN(this,{type:GR,string:NT(r),index:0})},function(){var r,e=QI(this),t=e.string,n=e.index;return n>=t.length?jR(void 0,!0):(r=t1(t,n),e.index+=r.length,jR(r,!1))});var QN=xn.Promise,WR={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},n1=oe,i1=ya,DT=Vl;for(var ym in WR)i1(n1[ym],ym),DT[ym]=DT.Array;var bg=QN,De=S(bg),ZN=to("Array","values"),ZI=fc,c_=bi,l_=ee,d_=ZN,kp=Array.prototype,PT={DOMTokenList:!0,NodeList:!0},u_=function(r){var e=r.values;return r===kp||l_(kp,r)&&e===kp.values||c_(PT,ZI(r))?d_:e},cs=S(u_),HR=Ts,kT=TypeError,$I=Do,$N=Math.floor,h_=function(r,e){var t=r.length;if(t<8)for(var n,i,s=1;s<t;){for(i=s,n=r[s];i&&e(r[i-1],n)>0;)r[i]=r[--i];i!==s++&&(r[i]=n)}else for(var o=$N(t/2),c=h_($I(r,0,o),e),d=h_($I(r,o),e),u=c.length,p=d.length,m=0,g=0;m<u||g<p;)r[m+g]=m<u&&g<p?e(c[m],d[g])<=0?c[m++]:d[g++]:m<u?c[m++]:d[g++];return r},KR=h_,eA=Ot.match(/firefox\/(\d+)/i),zR=!!eA&&+eA[1],YR=/MSIE|Trident/.test(Ot),qR=Ot.match(/AppleWebKit\/(\d+)\./),LT=!!qR&&+qR[1],tA=Ut,Ig=J,eD=hi,r1=Ao,Ag=Vr,f=function(r,e){if(!delete r[e])throw new kT("Cannot delete property "+HR(e)+" of "+HR(r))},E=Fr,v=y,C=KR,P=Qu,B=zR,ce=YR,Ee=wr,Fe=LT,Ze=[],Et=Ig(Ze.sort),Nt=Ig(Ze.push),ot=v(function(){Ze.sort(void 0)}),at=v(function(){Ze.sort(null)}),Si=P("sort"),Xn=!v(function(){if(Ee)return Ee<70;if(!(B&&B>3)){if(ce)return!0;if(Fe)return Fe<603;var r,e,t,n,i="";for(r=65;r<76;r++){switch(e=String.fromCharCode(r),r){case 66:case 69:case 70:case 72:t=3;break;case 68:case 71:t=4;break;default:t=2}for(n=0;n<47;n++)Ze.push({k:e+n,v:t})}for(Ze.sort(function(s,o){return o.v-s.v}),n=0;n<Ze.length;n++)e=Ze[n].k.charAt(0),i.charAt(i.length-1)!==e&&(i+=e);return i!=="DGBEFHACIJK"}});tA({target:"Array",proto:!0,forced:ot||!at||!Si||!Xn},{sort:function(r){r!==void 0&&eD(r);var e=r1(this);if(Xn)return r===void 0?Et(e):Et(e,r);var t,n,i=[],s=Ag(e);for(n=0;n<s;n++)n in e&&Nt(i,e[n]);for(C(i,(function(o){return function(c,d){return d===void 0?-1:c===void 0?1:o!==void 0?+o(c,d)||0:E(c)>E(d)?1:-1}})(r)),t=Ag(i),n=0;n<t;)e[n]=i[n++];for(;n<s;)f(e,n++);return e}});var _s=to("Array","sort"),Qe=ee,Ke=_s,et=Array.prototype,bt=function(r){var e=r.sort;return r===et||Qe(et,r)&&e===et.sort?Ke:e},Zt=S(bt),qi=Ut,Bn=J,pi=lt,Fa=RangeError,mr=String.fromCharCode,uh=String.fromCodePoint,s1=Bn([].join);qi({target:"String",stat:!0,forced:!!uh&&uh.length!==1},{fromCodePoint:function(r){for(var e,t=[],n=arguments.length,i=0;n>i;){if(e=+arguments[i++],pi(e,1114111)!==e)throw new Fa(e+" is not a valid code point");t[i]=e<65536?mr(e):mr(55296+((e-=65536)>>10),e%1024+56320)}return s1(t,"")}});var xW=y,VW=Fn("iterator"),MT=!xW(function(){var r=new URL("b?a=1&b=2&c=3","https://a"),e=r.searchParams,t=new URLSearchParams("a=1&a=2&b=3"),n="";return r.pathname="c%20d",e.forEach(function(i,s){e.delete("b"),n+=s+i}),t.delete("a",2),t.delete("b",void 0),!r.toJSON||!t.has("a",1)||t.has("a",2)||!t.has("a",void 0)||t.has("b")||!e.size&&!0||!e.sort||r.href!=="https://a/c%20d?a=1&c=3"||e.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!e[VW]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://тест").host!=="xn--e1aybc"||new URL("https://a#б").hash!=="#%D0%B1"||n!=="a1c3"||new URL("https://x",void 0).host!=="x"}),FW=Vs,nA=Ut,o1=oe,iA=n_,BW=Rn,UT=Je,Ca=J,Rm=Xe,a1=MT,c1=Vs,jW=as,GW=function(r,e,t){for(var n in e)t&&t.unsafe&&r[n]?r[n]=e[n]:FW(r,n,e[n],t);return r},WW=ya,HW=ig,rA=$a,l1=sg,sA=$,KW=bi,zW=aa,YW=fc,qW=lr,d1=vn,Rs=Fr,XW=Zd,u1=xt,h1=rm,JW=Ep,xT=Rp,Lp=da,QW=KR,ZW=Fn("iterator"),Mp="URLSearchParams",p1=Mp+"Iterator",f1=rA.set,Wo=rA.getterFor(Mp),$W=rA.getterFor(p1),_1=iA("fetch"),VT=iA("Request"),Cm=iA("Headers"),oA=VT&&VT.prototype,m1=Cm&&Cm.prototype,eH=o1.TypeError,tH=o1.encodeURIComponent,nH=String.fromCharCode,iH=BW("String","fromCodePoint"),rH=parseInt,FT=Ca("".charAt),E1=Ca([].join),Wl=Ca([].push),g1=Ca("".replace),sH=Ca([].shift),S1=Ca([].splice),T1=Ca("".split),v1=Ca("".slice),oH=Ca(/./.exec),aH=/\+/g,cH=/^[0-9a-f]+$/i,y1=function(r,e){var t=v1(r,e,e+2);return oH(cH,t)?rH(t,16):NaN},lH=function(r){for(var e=0,t=128;t>0&&r&t;t>>=1)e++;return e},dH=function(r){var e=null;switch(r.length){case 1:e=r[0];break;case 2:e=(31&r[0])<<6|63&r[1];break;case 3:e=(15&r[0])<<12|(63&r[1])<<6|63&r[2];break;case 4:e=(7&r[0])<<18|(63&r[1])<<12|(63&r[2])<<6|63&r[3]}return e>1114111?null:e},R1=function(r){for(var e=(r=g1(r,aH," ")).length,t="",n=0;n<e;){var i=FT(r,n);if(i==="%"){if(FT(r,n+1)==="%"||n+3>e){t+="%",n++;continue}var s=y1(r,n+1);if(s!=s){t+=i,n++;continue}n+=2;var o=lH(s);if(o===0)i=nH(s);else{if(o===1||o>4){t+="�",n++;continue}for(var c=[s],d=1;d<o&&!(++n+3>e||FT(r,n)!=="%");){var u=y1(r,n+1);if(u!=u){n+=3;break}if(u>191||u<128)break;Wl(c,u),n+=2,d++}if(c.length!==o){t+="�";continue}var p=dH(c);p===null?t+="�":i=iH(p)}}t+=i,n++}return t},uH=/[!'()~]|%20/g,hH={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},pH=function(r){return hH[r]},C1=function(r){return g1(tH(r),uH,pH)},aA=HW(function(r,e){f1(this,{type:p1,target:Wo(r).entries,index:0,kind:e})},Mp,function(){var r=$W(this),e=r.target,t=r.index++;if(!e||t>=e.length)return r.target=null,xT(void 0,!0);var n=e[t];switch(r.kind){case"keys":return xT(n.key,!1);case"values":return xT(n.value,!1)}return xT([n.key,n.value],!1)},!0),b1=function(r){this.entries=[],this.url=null,r!==void 0&&(d1(r)?this.parseObject(r):this.parseQuery(typeof r=="string"?FT(r,0)==="?"?v1(r,1):r:Rs(r)))};b1.prototype={type:Mp,bindURL:function(r){this.url=r,this.update()},parseObject:function(r){var e,t,n,i,s,o,c,d=this.entries,u=JW(r);if(u)for(t=(e=h1(r,u)).next;!(n=UT(t,e)).done;){if(s=(i=h1(qW(n.value))).next,(o=UT(s,i)).done||(c=UT(s,i)).done||!UT(s,i).done)throw new eH("Expected sequence with length 2");Wl(d,{key:Rs(o.value),value:Rs(c.value)})}else for(var p in r)KW(r,p)&&Wl(d,{key:p,value:Rs(r[p])})},parseQuery:function(r){if(r)for(var e,t,n=this.entries,i=T1(r,"&"),s=0;s<i.length;)(e=i[s++]).length&&(t=T1(e,"="),Wl(n,{key:R1(sH(t)),value:R1(E1(t,"="))}))},serialize:function(){for(var r,e=this.entries,t=[],n=0;n<e.length;)r=e[n++],Wl(t,C1(r.key)+"="+C1(r.value));return E1(t,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var BT=function(){l1(this,Up);var r=f1(this,new b1(arguments.length>0?arguments[0]:void 0));Rm||(this.size=r.entries.length)},Up=BT.prototype;if(GW(Up,{append:function(r,e){var t=Wo(this);Lp(arguments.length,2),Wl(t.entries,{key:Rs(r),value:Rs(e)}),Rm||this.length++,t.updateURL()},delete:function(r){for(var e=Wo(this),t=Lp(arguments.length,1),n=e.entries,i=Rs(r),s=t<2?void 0:arguments[1],o=s===void 0?s:Rs(s),c=0;c<n.length;){var d=n[c];if(d.key!==i||o!==void 0&&d.value!==o)c++;else if(S1(n,c,1),o!==void 0)break}Rm||(this.size=n.length),e.updateURL()},get:function(r){var e=Wo(this).entries;Lp(arguments.length,1);for(var t=Rs(r),n=0;n<e.length;n++)if(e[n].key===t)return e[n].value;return null},getAll:function(r){var e=Wo(this).entries;Lp(arguments.length,1);for(var t=Rs(r),n=[],i=0;i<e.length;i++)e[i].key===t&&Wl(n,e[i].value);return n},has:function(r){for(var e=Wo(this).entries,t=Lp(arguments.length,1),n=Rs(r),i=t<2?void 0:arguments[1],s=i===void 0?i:Rs(i),o=0;o<e.length;){var c=e[o++];if(c.key===n&&(s===void 0||c.value===s))return!0}return!1},set:function(r,e){var t=Wo(this);Lp(arguments.length,1);for(var n,i=t.entries,s=!1,o=Rs(r),c=Rs(e),d=0;d<i.length;d++)(n=i[d]).key===o&&(s?S1(i,d--,1):(s=!0,n.value=c));s||Wl(i,{key:o,value:c}),Rm||(this.size=i.length),t.updateURL()},sort:function(){var r=Wo(this);QW(r.entries,function(e,t){return e.key>t.key?1:-1}),r.updateURL()},forEach:function(r){for(var e,t=Wo(this).entries,n=zW(r,arguments.length>1?arguments[1]:void 0),i=0;i<t.length;)n((e=t[i++]).value,e.key,this)},keys:function(){return new aA(this,"keys")},values:function(){return new aA(this,"values")},entries:function(){return new aA(this,"entries")}},{enumerable:!0}),c1(Up,ZW,Up.entries,{}),c1(Up,"toString",function(){return Wo(this).serialize()},{enumerable:!0}),Rm&&jW(Up,"size",{get:function(){return Wo(this).entries.length},configurable:!0,enumerable:!0}),WW(BT,Mp),nA({global:!0,forced:!a1},{URLSearchParams:BT}),!a1&&sA(Cm)){var fH=Ca(m1.has),_H=Ca(m1.set),I1=function(r){if(d1(r)){var e,t=r.body;if(YW(t)===Mp)return e=r.headers?new Cm(r.headers):new Cm,fH(e,"content-type")||_H(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),XW(r,{body:u1(0,Rs(t)),headers:u1(0,e)})}return r};if(sA(_1)&&nA({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(r){return _1(r,arguments.length>1?I1(arguments[1]):{})}}),sA(VT)){var cA=function(r){return l1(this,oA),new VT(r,arguments.length>1?I1(arguments[1]):{})};oA.constructor=cA,cA.prototype=oA,nA({global:!0,dontCallGetSet:!0,forced:!0},{Request:cA})}}var Ho,mH={URLSearchParams:BT,getState:Wo},EH=xn.URLSearchParams,A1=Xe,gH=J,SH=Je,TH=y,lA=fp,vH=Qd,yH=mt,RH=Ao,CH=si,xp=Object.assign,w1=Object.defineProperty,bH=gH([].concat),IH=!xp||TH(function(){if(A1&&xp({b:1},xp(w1({},"a",{enumerable:!0,get:function(){w1(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var r={},e={},t=Symbol("assign detection"),n="abcdefghijklmnopqrst";return r[t]=7,n.split("").forEach(function(i){e[i]=i}),xp({},r)[t]!==7||lA(xp({},e)).join("")!==n})?function(r,e){for(var t=RH(r),n=arguments.length,i=1,s=vH.f,o=yH.f;n>i;)for(var c,d=CH(arguments[i++]),u=s?bH(lA(d),s(d)):lA(d),p=u.length,m=0;p>m;)c=u[m++],A1&&!SH(o,d,c)||(t[c]=d[c]);return t}:xp,AH=lr,wH=Jy,OH=Xe,NH=os,DH=xt,dA=function(r,e,t){OH?NH.f(r,e,DH(0,t)):r[e]=t},PH=aa,kH=Je,LH=Ao,MH=function(r,e,t,n){try{return n?e(AH(t)[0],t[1]):e(t)}catch(i){wH(r,"throw",i)}},UH=pI,xH=$f,VH=Vr,O1=dA,FH=rm,BH=Ep,N1=Array,cu=J,uA=2147483647,jH=/[^\0-\u007E]/,D1=/[.\u3002\uFF0E\uFF61]/g,P1="Overflow: input needs wider integers to process",k1=RangeError,GH=cu(D1.exec),Vp=Math.floor,hA=String.fromCharCode,L1=cu("".charCodeAt),M1=cu([].join),Hl=cu([].push),WH=cu("".replace),HH=cu("".split),KH=cu("".toLowerCase),U1=function(r){return r+22+75*(r<26)},zH=function(r,e,t){var n=0;for(r=t?Vp(r/700):r>>1,r+=Vp(r/e);r>455;)r=Vp(r/35),n+=36;return Vp(n+36*r/(r+38))},YH=function(r){var e=[];r=(function(w){for(var k=[],L=0,j=w.length;L<j;){var K=L1(w,L++);if(K>=55296&&K<=56319&&L<j){var W=L1(w,L++);(64512&W)==56320?Hl(k,((1023&K)<<10)+(1023&W)+65536):(Hl(k,K),L--)}else Hl(k,K)}return k})(r);var t,n,i=r.length,s=128,o=0,c=72;for(t=0;t<r.length;t++)(n=r[t])<128&&Hl(e,hA(n));var d=e.length,u=d;for(d&&Hl(e,"-");u<i;){var p=uA;for(t=0;t<r.length;t++)(n=r[t])>=s&&n<p&&(p=n);var m=u+1;if(p-s>Vp((uA-o)/m))throw new k1(P1);for(o+=(p-s)*m,s=p,t=0;t<r.length;t++){if((n=r[t])<s&&++o>uA)throw new k1(P1);if(n===s){for(var g=o,T=36;;){var R=T<=c?1:T>=c+26?26:T-c;if(g<R)break;var I=g-R,A=36-R;Hl(e,hA(U1(R+I%A))),g=Vp(I/A),T+=36}Hl(e,hA(U1(g))),c=zH(o,m,u===d),o=0,u++}}o++,s++}return M1(e,"")},qH=Ut,pA=Xe,XH=MT,fA=oe,x1=aa,Ko=J,jT=Vs,zo=as,JH=sg,_A=bi,mA=IH,Fp=function(r){var e=LH(r),t=xH(this),n=arguments.length,i=n>1?arguments[1]:void 0,s=i!==void 0;s&&(i=PH(i,n>2?arguments[2]:void 0));var o,c,d,u,p,m,g=BH(e),T=0;if(!g||this===N1&&UH(g))for(o=VH(e),c=t?new this(o):N1(o);o>T;T++)m=s?i(e[T],T):e[T],O1(c,T,m);else for(c=t?new this:[],p=(u=FH(e,g)).next;!(d=kH(p,u)).done;T++)m=s?MH(u,i,[d.value,T],!0):d.value,O1(c,T,m);return c.length=T,c},ba=Do,QH=vm.codeAt,ZH=function(r){var e,t,n=[],i=HH(WH(KH(r),D1,"."),".");for(e=0;e<i.length;e++)t=i[e],Hl(n,GH(jH,t)?"xn--"+YH(t):t);return M1(n,".")},Mc=Fr,$H=ya,e8=da,V1=mH,F1=$a,t8=F1.set,GT=F1.getterFor("URL"),n8=V1.URLSearchParams,i8=V1.getState,bm=fA.URL,EA=fA.TypeError,WT=fA.parseInt,r8=Math.floor,B1=Math.pow,Yo=Ko("".charAt),Ia=Ko(/./.exec),Im=Ko([].join),s8=Ko(1 .toString),o8=Ko([].pop),Bp=Ko([].push),gA=Ko("".replace),a8=Ko([].shift),c8=Ko("".split),Am=Ko("".slice),HT=Ko("".toLowerCase),l8=Ko([].unshift),SA="Invalid scheme",jp="Invalid host",j1="Invalid port",G1=/[a-z]/i,d8=/[\d+-.a-z]/i,TA=/\d/,u8=/^0x/i,h8=/^[0-7]+$/,p8=/^\d+$/,W1=/^[\da-f]+$/i,f8=/[\0\t\n\r #%/:<>?@[\\\]^|]/,_8=/[\0\t\n\r #/:<>?@[\\\]^|]/,m8=/^[\u0000-\u0020]+/,E8=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,g8=/[\t\n\r]/g,wm=function(r){var e,t,n,i;if(typeof r=="number"){for(e=[],t=0;t<4;t++)l8(e,r%256),r=r8(r/256);return Im(e,".")}if(typeof r=="object"){for(e="",n=(function(s){for(var o=null,c=1,d=null,u=0,p=0;p<8;p++)s[p]!==0?(u>c&&(o=d,c=u),d=null,u=0):(d===null&&(d=p),++u);return u>c?d:o})(r),t=0;t<8;t++)i&&r[t]===0||(i&&(i=!1),n===t?(e+=t?":":"::",i=!0):(e+=s8(r[t],16),t<7&&(e+=":")));return"["+e+"]"}return r},KT={},H1=mA({},KT,{" ":1,'"':1,"<":1,">":1,"`":1}),K1=mA({},H1,{"#":1,"?":1,"{":1,"}":1}),vA=mA({},K1,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Kl=function(r,e){var t=QH(r,0);return t>32&&t<127&&!_A(e,r)?r:encodeURIComponent(r)},zT={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Om=function(r,e){var t;return r.length===2&&Ia(G1,Yo(r,0))&&((t=Yo(r,1))===":"||!e&&t==="|")},z1=function(r){var e;return r.length>1&&Om(Am(r,0,2))&&(r.length===2||(e=Yo(r,2))==="/"||e==="\\"||e==="?"||e==="#")},S8=function(r){return r==="."||HT(r)==="%2e"},yA={},Y1={},RA={},q1={},X1={},CA={},J1={},Q1={},YT={},qT={},bA={},IA={},AA={},wA={},Z1={},OA={},Gp={},nc={},$1={},lu={},Uc={},NA=function(r,e,t){var n,i,s,o=Mc(r);if(e){if(i=this.parse(o))throw new EA(i);this.searchParams=null}else{if(t!==void 0&&(n=new NA(t,!0)),i=this.parse(o,null,n))throw new EA(i);(s=i8(new n8)).bindURL(this),this.searchParams=s}};NA.prototype={type:"URL",parse:function(r,e,t){var n,i,s,o,c,d=this,u=e||yA,p=0,m="",g=!1,T=!1,R=!1;for(r=Mc(r),e||(d.scheme="",d.username="",d.password="",d.host=null,d.port=null,d.path=[],d.query=null,d.fragment=null,d.cannotBeABaseURL=!1,r=gA(r,m8,""),r=gA(r,E8,"$1")),r=gA(r,g8,""),n=Fp(r);p<=n.length;){switch(i=n[p],u){case yA:if(!i||!Ia(G1,i)){if(e)return SA;u=RA;continue}m+=HT(i),u=Y1;break;case Y1:if(i&&(Ia(d8,i)||i==="+"||i==="-"||i==="."))m+=HT(i);else{if(i!==":"){if(e)return SA;m="",u=RA,p=0;continue}if(e&&(d.isSpecial()!==_A(zT,m)||m==="file"&&(d.includesCredentials()||d.port!==null)||d.scheme==="file"&&!d.host))return;if(d.scheme=m,e)return void(d.isSpecial()&&zT[d.scheme]===d.port&&(d.port=null));m="",d.scheme==="file"?u=wA:d.isSpecial()&&t&&t.scheme===d.scheme?u=q1:d.isSpecial()?u=Q1:n[p+1]==="/"?(u=X1,p++):(d.cannotBeABaseURL=!0,Bp(d.path,""),u=$1)}break;case RA:if(!t||t.cannotBeABaseURL&&i!=="#")return SA;if(t.cannotBeABaseURL&&i==="#"){d.scheme=t.scheme,d.path=ba(t.path),d.query=t.query,d.fragment="",d.cannotBeABaseURL=!0,u=Uc;break}u=t.scheme==="file"?wA:CA;continue;case q1:if(i!=="/"||n[p+1]!=="/"){u=CA;continue}u=YT,p++;break;case X1:if(i==="/"){u=qT;break}u=nc;continue;case CA:if(d.scheme=t.scheme,i===Ho)d.username=t.username,d.password=t.password,d.host=t.host,d.port=t.port,d.path=ba(t.path),d.query=t.query;else if(i==="/"||i==="\\"&&d.isSpecial())u=J1;else if(i==="?")d.username=t.username,d.password=t.password,d.host=t.host,d.port=t.port,d.path=ba(t.path),d.query="",u=lu;else{if(i!=="#"){d.username=t.username,d.password=t.password,d.host=t.host,d.port=t.port,d.path=ba(t.path),d.path.length--,u=nc;continue}d.username=t.username,d.password=t.password,d.host=t.host,d.port=t.port,d.path=ba(t.path),d.query=t.query,d.fragment="",u=Uc}break;case J1:if(!d.isSpecial()||i!=="/"&&i!=="\\"){if(i!=="/"){d.username=t.username,d.password=t.password,d.host=t.host,d.port=t.port,u=nc;continue}u=qT}else u=YT;break;case Q1:if(u=YT,i!=="/"||Yo(m,p+1)!=="/")continue;p++;break;case YT:if(i!=="/"&&i!=="\\"){u=qT;continue}break;case qT:if(i==="@"){g&&(m="%40"+m),g=!0,s=Fp(m);for(var I=0;I<s.length;I++){var A=s[I];if(A!==":"||R){var w=Kl(A,vA);R?d.password+=w:d.username+=w}else R=!0}m=""}else if(i===Ho||i==="/"||i==="?"||i==="#"||i==="\\"&&d.isSpecial()){if(g&&m==="")return"Invalid authority";p-=Fp(m).length+1,m="",u=bA}else m+=i;break;case bA:case IA:if(e&&d.scheme==="file"){u=OA;continue}if(i!==":"||T){if(i===Ho||i==="/"||i==="?"||i==="#"||i==="\\"&&d.isSpecial()){if(d.isSpecial()&&m==="")return jp;if(e&&m===""&&(d.includesCredentials()||d.port!==null))return;if(o=d.parseHost(m))return o;if(m="",u=Gp,e)return;continue}i==="["?T=!0:i==="]"&&(T=!1),m+=i}else{if(m==="")return jp;if(o=d.parseHost(m))return o;if(m="",u=AA,e===IA)return}break;case AA:if(!Ia(TA,i)){if(i===Ho||i==="/"||i==="?"||i==="#"||i==="\\"&&d.isSpecial()||e){if(m!==""){var k=WT(m,10);if(k>65535)return j1;d.port=d.isSpecial()&&k===zT[d.scheme]?null:k,m=""}if(e)return;u=Gp;continue}return j1}m+=i;break;case wA:if(d.scheme="file",i==="/"||i==="\\")u=Z1;else{if(!t||t.scheme!=="file"){u=nc;continue}switch(i){case Ho:d.host=t.host,d.path=ba(t.path),d.query=t.query;break;case"?":d.host=t.host,d.path=ba(t.path),d.query="",u=lu;break;case"#":d.host=t.host,d.path=ba(t.path),d.query=t.query,d.fragment="",u=Uc;break;default:z1(Im(ba(n,p),""))||(d.host=t.host,d.path=ba(t.path),d.shortenPath()),u=nc;continue}}break;case Z1:if(i==="/"||i==="\\"){u=OA;break}t&&t.scheme==="file"&&!z1(Im(ba(n,p),""))&&(Om(t.path[0],!0)?Bp(d.path,t.path[0]):d.host=t.host),u=nc;continue;case OA:if(i===Ho||i==="/"||i==="\\"||i==="?"||i==="#"){if(!e&&Om(m))u=nc;else if(m===""){if(d.host="",e)return;u=Gp}else{if(o=d.parseHost(m))return o;if(d.host==="localhost"&&(d.host=""),e)return;m="",u=Gp}continue}m+=i;break;case Gp:if(d.isSpecial()){if(u=nc,i!=="/"&&i!=="\\")continue}else if(e||i!=="?")if(e||i!=="#"){if(i!==Ho&&(u=nc,i!=="/"))continue}else d.fragment="",u=Uc;else d.query="",u=lu;break;case nc:if(i===Ho||i==="/"||i==="\\"&&d.isSpecial()||!e&&(i==="?"||i==="#")){if((c=HT(c=m))===".."||c==="%2e."||c===".%2e"||c==="%2e%2e"?(d.shortenPath(),i==="/"||i==="\\"&&d.isSpecial()||Bp(d.path,"")):S8(m)?i==="/"||i==="\\"&&d.isSpecial()||Bp(d.path,""):(d.scheme==="file"&&!d.path.length&&Om(m)&&(d.host&&(d.host=""),m=Yo(m,0)+":"),Bp(d.path,m)),m="",d.scheme==="file"&&(i===Ho||i==="?"||i==="#"))for(;d.path.length>1&&d.path[0]==="";)a8(d.path);i==="?"?(d.query="",u=lu):i==="#"&&(d.fragment="",u=Uc)}else m+=Kl(i,K1);break;case $1:i==="?"?(d.query="",u=lu):i==="#"?(d.fragment="",u=Uc):i!==Ho&&(d.path[0]+=Kl(i,KT));break;case lu:e||i!=="#"?i!==Ho&&(i==="'"&&d.isSpecial()?d.query+="%27":d.query+=i==="#"?"%23":Kl(i,KT)):(d.fragment="",u=Uc);break;case Uc:i!==Ho&&(d.fragment+=Kl(i,H1))}p++}},parseHost:function(r){var e,t,n;if(Yo(r,0)==="["){if(Yo(r,r.length-1)!=="]"||(e=(function(i){var s,o,c,d,u,p,m,g=[0,0,0,0,0,0,0,0],T=0,R=null,I=0,A=function(){return Yo(i,I)};if(A()===":"){if(Yo(i,1)!==":")return;I+=2,R=++T}for(;A();){if(T===8)return;if(A()!==":"){for(s=o=0;o<4&&Ia(W1,A());)s=16*s+WT(A(),16),I++,o++;if(A()==="."){if(o===0||(I-=o,T>6))return;for(c=0;A();){if(d=null,c>0){if(!(A()==="."&&c<4))return;I++}if(!Ia(TA,A()))return;for(;Ia(TA,A());){if(u=WT(A(),10),d===null)d=u;else{if(d===0)return;d=10*d+u}if(d>255)return;I++}g[T]=256*g[T]+d,++c!=2&&c!==4||T++}if(c!==4)return;break}if(A()===":"){if(I++,!A())return}else if(A())return;g[T++]=s}else{if(R!==null)return;I++,R=++T}}if(R!==null)for(p=T-R,T=7;T!==0&&p>0;)m=g[T],g[T--]=g[R+p-1],g[R+--p]=m;else if(T!==8)return;return g})(Am(r,1,-1)),!e))return jp;this.host=e}else if(this.isSpecial()){if(r=ZH(r),Ia(f8,r)||(e=(function(i){var s,o,c,d,u,p,m,g=c8(i,".");if(g.length&&g[g.length-1]===""&&g.length--,(s=g.length)>4)return i;for(o=[],c=0;c<s;c++){if((d=g[c])==="")return i;if(u=10,d.length>1&&Yo(d,0)==="0"&&(u=Ia(u8,d)?16:8,d=Am(d,u===8?1:2)),d==="")p=0;else{if(!Ia(u===10?p8:u===8?h8:W1,d))return i;p=WT(d,u)}Bp(o,p)}for(c=0;c<s;c++)if(p=o[c],c===s-1){if(p>=B1(256,5-s))return null}else if(p>255)return null;for(m=o8(o),c=0;c<o.length;c++)m+=o[c]*B1(256,3-c);return m})(r),e===null))return jp;this.host=e}else{if(Ia(_8,r))return jp;for(e="",t=Fp(r),n=0;n<t.length;n++)e+=Kl(t[n],KT);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return _A(zT,this.scheme)},shortenPath:function(){var r=this.path,e=r.length;!e||this.scheme==="file"&&e===1&&Om(r[0],!0)||r.length--},serialize:function(){var r=this,e=r.scheme,t=r.username,n=r.password,i=r.host,s=r.port,o=r.path,c=r.query,d=r.fragment,u=e+":";return i!==null?(u+="//",r.includesCredentials()&&(u+=t+(n?":"+n:"")+"@"),u+=wm(i),s!==null&&(u+=":"+s)):e==="file"&&(u+="//"),u+=r.cannotBeABaseURL?o[0]:o.length?"/"+Im(o,"/"):"",c!==null&&(u+="?"+c),d!==null&&(u+="#"+d),u},setHref:function(r){var e=this.parse(r);if(e)throw new EA(e);this.searchParams.update()},getOrigin:function(){var r=this.scheme,e=this.port;if(r==="blob")try{return new Wp(r.path[0]).origin}catch{return"null"}return r!=="file"&&this.isSpecial()?r+"://"+wm(this.host)+(e!==null?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(r){this.parse(Mc(r)+":",yA)},getUsername:function(){return this.username},setUsername:function(r){var e=Fp(Mc(r));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var t=0;t<e.length;t++)this.username+=Kl(e[t],vA)}},getPassword:function(){return this.password},setPassword:function(r){var e=Fp(Mc(r));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var t=0;t<e.length;t++)this.password+=Kl(e[t],vA)}},getHost:function(){var r=this.host,e=this.port;return r===null?"":e===null?wm(r):wm(r)+":"+e},setHost:function(r){this.cannotBeABaseURL||this.parse(r,bA)},getHostname:function(){var r=this.host;return r===null?"":wm(r)},setHostname:function(r){this.cannotBeABaseURL||this.parse(r,IA)},getPort:function(){var r=this.port;return r===null?"":Mc(r)},setPort:function(r){this.cannotHaveUsernamePasswordPort()||((r=Mc(r))===""?this.port=null:this.parse(r,AA))},getPathname:function(){var r=this.path;return this.cannotBeABaseURL?r[0]:r.length?"/"+Im(r,"/"):""},setPathname:function(r){this.cannotBeABaseURL||(this.path=[],this.parse(r,Gp))},getSearch:function(){var r=this.query;return r?"?"+r:""},setSearch:function(r){(r=Mc(r))===""?this.query=null:(Yo(r,0)==="?"&&(r=Am(r,1)),this.query="",this.parse(r,lu)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var r=this.fragment;return r?"#"+r:""},setHash:function(r){(r=Mc(r))!==""?(Yo(r,0)==="#"&&(r=Am(r,1)),this.fragment="",this.parse(r,Uc)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Wp=function(r){var e=JH(this,Cs),t=e8(arguments.length,1)>1?arguments[1]:void 0,n=t8(e,new NA(r,!1,t));pA||(e.href=n.serialize(),e.origin=n.getOrigin(),e.protocol=n.getProtocol(),e.username=n.getUsername(),e.password=n.getPassword(),e.host=n.getHost(),e.hostname=n.getHostname(),e.port=n.getPort(),e.pathname=n.getPathname(),e.search=n.getSearch(),e.searchParams=n.getSearchParams(),e.hash=n.getHash())},Cs=Wp.prototype,qo=function(r,e){return{get:function(){return GT(this)[r]()},set:e&&function(t){return GT(this)[e](t)},configurable:!0,enumerable:!0}};if(pA&&(zo(Cs,"href",qo("serialize","setHref")),zo(Cs,"origin",qo("getOrigin")),zo(Cs,"protocol",qo("getProtocol","setProtocol")),zo(Cs,"username",qo("getUsername","setUsername")),zo(Cs,"password",qo("getPassword","setPassword")),zo(Cs,"host",qo("getHost","setHost")),zo(Cs,"hostname",qo("getHostname","setHostname")),zo(Cs,"port",qo("getPort","setPort")),zo(Cs,"pathname",qo("getPathname","setPathname")),zo(Cs,"search",qo("getSearch","setSearch")),zo(Cs,"searchParams",qo("getSearchParams")),zo(Cs,"hash",qo("getHash","setHash"))),jT(Cs,"toJSON",function(){return GT(this).serialize()},{enumerable:!0}),jT(Cs,"toString",function(){return GT(this).serialize()},{enumerable:!0}),bm){var eM=bm.createObjectURL,tM=bm.revokeObjectURL;eM&&jT(Wp,"createObjectURL",x1(eM,bm)),tM&&jT(Wp,"revokeObjectURL",x1(tM,bm))}$H(Wp,"URL"),qH({global:!0,forced:!XH,sham:!pA},{URL:Wp});var T8=Ut,nM=y,v8=da,iM=Fr,y8=MT,DA=Rn("URL"),R8=y8&&nM(function(){DA.canParse()}),C8=nM(function(){return DA.canParse.length!==1});T8({target:"URL",stat:!0,forced:!R8||C8},{canParse:function(r){var e=v8(arguments.length,1),t=iM(r),n=e<2||arguments[1]===void 0?void 0:iM(arguments[1]);try{return!!new DA(t,n)}catch{return!1}}});var b8=Ut,I8=da,rM=Fr,A8=MT,w8=Rn("URL");b8({target:"URL",stat:!0,forced:!A8},{parse:function(r){var e=I8(arguments.length,1),t=rM(r),n=e<2||arguments[1]===void 0?void 0:rM(arguments[1]);try{return new w8(t,n)}catch{return null}}});var XT=S(xn.URL);let sM=!0,oM=!0;function JT(r,e,t){let n=r.match(e);return n&&n.length>=t&&parseInt(n[t],10)}function du(r,e,t){if(!r.RTCPeerConnection)return;let n=r.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(o,c){if(o!==e)return i.apply(this,arguments);let d=u=>{let p=t(u);p&&(c.handleEvent?c.handleEvent(p):c(p))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(c,d),i.apply(this,[o,d])};let s=n.removeEventListener;n.removeEventListener=function(o,c){if(o!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(c))return s.apply(this,arguments);let d=this._eventMap[e].get(c);return this._eventMap[e].delete(c),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,s.apply(this,[o,d])},Object.defineProperty(n,"on"+e,{get(){return this["_on"+e]},set(o){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),o&&this.addEventListener(e,this["_on"+e]=o)},enumerable:!0,configurable:!0})}function O8(r){return typeof r!="boolean"?new Error("Argument type: "+typeof r+". Please use a boolean."):(sM=r,r?"adapter.js logging disabled":"adapter.js logging enabled")}function N8(r){return typeof r!="boolean"?new Error("Argument type: "+typeof r+". Please use a boolean."):(oM=!r,"adapter.js deprecation warnings "+(r?"disabled":"enabled"))}function aM(){if(typeof window=="object"){if(sM)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function PA(r,e){oM&&console.warn(r+" is deprecated, please use "+e+" instead.")}function cM(r){return Object.prototype.toString.call(r)==="[object Object]"}function lM(r){var e;return cM(r)?Ks(e=Object.keys(r)).call(e,function(t,n){let i=cM(r[n]),s=i?lM(r[n]):r[n],o=i&&!Object.keys(s).length;return s===void 0||o?t:Object.assign(t,{[n]:s})},{}):r}function kA(r,e,t){e&&!t.has(e.id)&&(t.set(e.id,e),Object.keys(e).forEach(n=>{n.endsWith("Id")?kA(r,r.get(e[n]),t):n.endsWith("Ids")&&e[n].forEach(i=>{kA(r,r.get(i),t)})}))}function dM(r,e,t){let n=t?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;let s=[];return r.forEach(o=>{o.type==="track"&&o.trackIdentifier===e.id&&s.push(o)}),s.forEach(o=>{r.forEach(c=>{c.type===n&&c.trackId===o.id&&kA(r,c,i)})}),i}let uM=aM;function hM(r,e){let t=r&&r.navigator;if(!t.mediaDevices)return;let n=function(o){if(typeof o!="object"||o.mandatory||o.optional)return o;let c={};return Object.keys(o).forEach(d=>{if(d==="require"||d==="advanced"||d==="mediaSource")return;let u=typeof o[d]=="object"?o[d]:{ideal:o[d]};u.exact!==void 0&&typeof u.exact=="number"&&(u.min=u.max=u.exact);let p=function(m,g){return m?m+g.charAt(0).toUpperCase()+g.slice(1):g==="deviceId"?"sourceId":g};if(u.ideal!==void 0){c.optional=c.optional||[];let m={};typeof u.ideal=="number"?(m[p("min",d)]=u.ideal,c.optional.push(m),m={},m[p("max",d)]=u.ideal,c.optional.push(m)):(m[p("",d)]=u.ideal,c.optional.push(m))}u.exact!==void 0&&typeof u.exact!="number"?(c.mandatory=c.mandatory||{},c.mandatory[p("",d)]=u.exact):["min","max"].forEach(m=>{u[m]!==void 0&&(c.mandatory=c.mandatory||{},c.mandatory[p(m,d)]=u[m])})}),o.advanced&&(c.optional=(c.optional||[]).concat(o.advanced)),c},i=function(o,c){if(e.version>=61)return c(o);if((o=JSON.parse(JSON.stringify(o)))&&typeof o.audio=="object"){let d=function(u,p,m){p in u&&!(m in u)&&(u[m]=u[p],delete u[p])};d((o=JSON.parse(JSON.stringify(o))).audio,"autoGainControl","googAutoGainControl"),d(o.audio,"noiseSuppression","googNoiseSuppression"),o.audio=n(o.audio)}if(o&&typeof o.video=="object"){let d=o.video.facingMode;d=d&&(typeof d=="object"?d:{ideal:d});let u=e.version<66;if(d&&(d.exact==="user"||d.exact==="environment"||d.ideal==="user"||d.ideal==="environment")&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||u)){let p;if(delete o.video.facingMode,d.exact==="environment"||d.ideal==="environment"?p=["back","rear"]:d.exact!=="user"&&d.ideal!=="user"||(p=["front"]),p)return t.mediaDevices.enumerateDevices().then(m=>{m=m.filter(T=>T.kind==="videoinput");let g=m.find(T=>p.some(R=>{var I;return Re(I=T.label.toLowerCase()).call(I,R)}));return!g&&m.length&&Re(p).call(p,"back")&&(g=m[m.length-1]),g&&(o.video.deviceId=d.exact?{exact:g.deviceId}:{ideal:g.deviceId}),o.video=n(o.video),uM("chrome: "+JSON.stringify(o)),c(o)})}o.video=n(o.video)}return uM("chrome: "+JSON.stringify(o)),c(o)},s=function(o){return e.version>=64?o:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[o.name]||o.name,message:o.message,constraint:o.constraint||o.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=(function(o,c,d){i(o,u=>{t.webkitGetUserMedia(u,c,p=>{d&&d(s(p))})})}).bind(t),t.mediaDevices.getUserMedia){let o=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(c){return i(c,d=>o(d).then(u=>{if(d.audio&&!u.getAudioTracks().length||d.video&&!u.getVideoTracks().length)throw u.getTracks().forEach(p=>{p.stop()}),new DOMException("","NotFoundError");return u},u=>De.reject(s(u))))}}}function pM(r){r.MediaStream=r.MediaStream||r.webkitMediaStream}function fM(r){if(typeof r=="object"&&r.RTCPeerConnection&&!("ontrack"in r.RTCPeerConnection.prototype)){Object.defineProperty(r.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});let e=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",n=>{let i;i=r.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(o=>o.track&&o.track.id===n.track.id):{track:n.track};let s=new Event("track");s.track=n.track,s.receiver=i,s.transceiver={receiver:i},s.streams=[t.stream],this.dispatchEvent(s)}),t.stream.getTracks().forEach(n=>{let i;i=r.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(o=>o.track&&o.track.id===n.id):{track:n};let s=new Event("track");s.track=n,s.receiver=i,s.transceiver={receiver:i},s.streams=[t.stream],this.dispatchEvent(s)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else du(r,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function _M(r){if(typeof r=="object"&&r.RTCPeerConnection&&!("getSenders"in r.RTCPeerConnection.prototype)&&"createDTMFSender"in r.RTCPeerConnection.prototype){let e=function(i,s){return{track:s,get dtmf(){return this._dtmf===void 0&&(s.kind==="audio"?this._dtmf=i.createDTMFSender(s):this._dtmf=null),this._dtmf},_pc:i}};if(!r.RTCPeerConnection.prototype.getSenders){r.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let i=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(o,c){let d=i.apply(this,arguments);return d||(d=e(this,o),this._senders.push(d)),d};let s=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(o){s.apply(this,arguments);let c=this._senders.indexOf(o);c!==-1&&this._senders.splice(c,1)}}let t=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],t.apply(this,[i]),i.getTracks().forEach(s=>{this._senders.push(e(this,s))})};let n=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(s=>{let o=this._senders.find(c=>c.track===s);o&&this._senders.splice(this._senders.indexOf(o),1)})}}else if(typeof r=="object"&&r.RTCPeerConnection&&"getSenders"in r.RTCPeerConnection.prototype&&"createDTMFSender"in r.RTCPeerConnection.prototype&&r.RTCRtpSender&&!("dtmf"in r.RTCRtpSender.prototype)){let e=r.RTCPeerConnection.prototype.getSenders;r.RTCPeerConnection.prototype.getSenders=function(){let t=e.apply(this,[]);return t.forEach(n=>n._pc=this),t},Object.defineProperty(r.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function mM(r){if(!r.RTCPeerConnection)return;let e=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){let[t,n,i]=arguments;if(arguments.length>0&&typeof t=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof t!="function"))return e.apply(this,[]);let s=function(c){let d={};return c.result().forEach(u=>{let p={id:u.id,timestamp:u.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[u.type]||u.type};u.names().forEach(m=>{p[m]=u.stat(m)}),d[p.id]=p}),d},o=function(c){return new Map(Object.keys(c).map(d=>[d,c[d]]))};if(arguments.length>=2){let c=function(d){n(o(s(d)))};return e.apply(this,[c,t])}return new De((c,d)=>{e.apply(this,[function(u){c(o(s(u)))},d])}).then(n,i)}}function EM(r){if(!(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender&&r.RTCRtpReceiver))return;if(!("getStats"in r.RTCRtpSender.prototype)){let t=r.RTCPeerConnection.prototype.getSenders;t&&(r.RTCPeerConnection.prototype.getSenders=function(){let i=t.apply(this,[]);return i.forEach(s=>s._pc=this),i});let n=r.RTCPeerConnection.prototype.addTrack;n&&(r.RTCPeerConnection.prototype.addTrack=function(){let i=n.apply(this,arguments);return i._pc=this,i}),r.RTCRtpSender.prototype.getStats=function(){let i=this;return this._pc.getStats().then(s=>dM(s,i.track,!0))}}if(!("getStats"in r.RTCRtpReceiver.prototype)){let t=r.RTCPeerConnection.prototype.getReceivers;t&&(r.RTCPeerConnection.prototype.getReceivers=function(){let n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n}),du(r,"track",n=>(n.receiver._pc=n.srcElement,n)),r.RTCRtpReceiver.prototype.getStats=function(){let n=this;return this._pc.getStats().then(i=>dM(i,n.track,!1))}}if(!("getStats"in r.RTCRtpSender.prototype)||!("getStats"in r.RTCRtpReceiver.prototype))return;let e=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof r.MediaStreamTrack){let t=arguments[0],n,i,s;return this.getSenders().forEach(o=>{o.track===t&&(n?s=!0:n=o)}),this.getReceivers().forEach(o=>(o.track===t&&(i?s=!0:i=o),o.track===t)),s||n&&i?De.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():i?i.getStats():De.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function gM(r){r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(s=>this._shimmedLocalStreams[s][0])};let e=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(s,o){if(!o)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let c=e.apply(this,arguments);return this._shimmedLocalStreams[o.id]?this._shimmedLocalStreams[o.id].indexOf(c)===-1&&this._shimmedLocalStreams[o.id].push(c):this._shimmedLocalStreams[o.id]=[o,c],c};let t=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(s){this._shimmedLocalStreams=this._shimmedLocalStreams||{},s.getTracks().forEach(d=>{if(this.getSenders().find(u=>u.track===d))throw new DOMException("Track already exists.","InvalidAccessError")});let o=this.getSenders();t.apply(this,arguments);let c=this.getSenders().filter(d=>o.indexOf(d)===-1);this._shimmedLocalStreams[s.id]=[s].concat(c)};let n=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[s.id],n.apply(this,arguments)};let i=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(s){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},s&&Object.keys(this._shimmedLocalStreams).forEach(o=>{let c=this._shimmedLocalStreams[o].indexOf(s);c!==-1&&this._shimmedLocalStreams[o].splice(c,1),this._shimmedLocalStreams[o].length===1&&delete this._shimmedLocalStreams[o]}),i.apply(this,arguments)}}function SM(r,e){if(!r.RTCPeerConnection)return;if(r.RTCPeerConnection.prototype.addTrack&&e.version>=65)return gM(r);let t=r.RTCPeerConnection.prototype.getLocalStreams;r.RTCPeerConnection.prototype.getLocalStreams=function(){let d=t.apply(this);return this._reverseStreams=this._reverseStreams||{},d.map(u=>this._reverseStreams[u.id])};let n=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(d){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},d.getTracks().forEach(u=>{if(this.getSenders().find(p=>p.track===u))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[d.id]){let u=new r.MediaStream(d.getTracks());this._streams[d.id]=u,this._reverseStreams[u.id]=d,d=u}n.apply(this,[d])};let i=r.RTCPeerConnection.prototype.removeStream;function s(d,u){let p=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(m=>{let g=d._reverseStreams[m],T=d._streams[g.id];p=p.replace(new RegExp(T.id,"g"),g.id)}),new RTCSessionDescription({type:u.type,sdp:p})}r.RTCPeerConnection.prototype.removeStream=function(d){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[d.id]||d]),delete this._reverseStreams[this._streams[d.id]?this._streams[d.id].id:d.id],delete this._streams[d.id]},r.RTCPeerConnection.prototype.addTrack=function(d,u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let p=[].slice.call(arguments,1);if(p.length!==1||!p[0].getTracks().find(g=>g===d))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(g=>g.track===d))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let m=this._streams[u.id];if(m)m.addTrack(d),De.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let g=new r.MediaStream([d]);this._streams[u.id]=g,this._reverseStreams[g.id]=u,this.addStream(g)}return this.getSenders().find(g=>g.track===d)},["createOffer","createAnswer"].forEach(function(d){let u=r.RTCPeerConnection.prototype[d],p={[d](){let m=arguments;return arguments.length&&typeof arguments[0]=="function"?u.apply(this,[g=>{let T=s(this,g);m[0].apply(null,[T])},g=>{m[1]&&m[1].apply(null,g)},arguments[2]]):u.apply(this,arguments).then(g=>s(this,g))}};r.RTCPeerConnection.prototype[d]=p[d]});let o=r.RTCPeerConnection.prototype.setLocalDescription;r.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(function(d,u){let p=u.sdp;return Object.keys(d._reverseStreams||[]).forEach(m=>{let g=d._reverseStreams[m],T=d._streams[g.id];p=p.replace(new RegExp(g.id,"g"),T.id)}),new RTCSessionDescription({type:u.type,sdp:p})})(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};let c=Object.getOwnPropertyDescriptor(r.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(r.RTCPeerConnection.prototype,"localDescription",{get(){let d=c.get.apply(this);return d.type===""?d:s(this,d)}}),r.RTCPeerConnection.prototype.removeTrack=function(d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!d._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(d._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let u;this._streams=this._streams||{},Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(m=>d.track===m)&&(u=this._streams[p])}),u&&(u.getTracks().length===1?this.removeStream(this._reverseStreams[u.id]):u.removeTrack(d.track),this.dispatchEvent(new Event("negotiationneeded")))}}function LA(r,e){!r.RTCPeerConnection&&r.webkitRTCPeerConnection&&(r.RTCPeerConnection=r.webkitRTCPeerConnection),r.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){let n=r.RTCPeerConnection.prototype[t],i={[t](){return arguments[0]=new(t==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};r.RTCPeerConnection.prototype[t]=i[t]})}function TM(r,e){du(r,"negotiationneeded",t=>{let n=t.target;if(!(e.version<72||n.getConfiguration&&n.getConfiguration().sdpSemantics==="plan-b")||n.signalingState==="stable")return t})}var vM=Object.freeze({__proto__:null,fixNegotiationNeeded:TM,shimAddTrackRemoveTrack:SM,shimAddTrackRemoveTrackWithNative:gM,shimGetDisplayMedia:function(r,e){r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||r.navigator.mediaDevices&&(typeof e=="function"?r.navigator.mediaDevices.getDisplayMedia=function(t){return e(t).then(n=>{let i=t.video&&t.video.width,s=t.video&&t.video.height,o=t.video&&t.video.frameRate;return t.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxFrameRate:o||3}},i&&(t.video.mandatory.maxWidth=i),s&&(t.video.mandatory.maxHeight=s),r.navigator.mediaDevices.getUserMedia(t)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:_M,shimGetStats:mM,shimGetUserMedia:hM,shimMediaStream:pM,shimOnTrack:fM,shimPeerConnection:LA,shimSenderReceiverGetStats:EM});function yM(r,e){let t=r&&r.navigator,n=r&&r.MediaStreamTrack;if(t.getUserMedia=function(i,s,o){PA("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(i).then(s,o)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){let i=function(o,c,d){c in o&&!(d in o)&&(o[d]=o[c],delete o[c])},s=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),i(o.audio,"autoGainControl","mozAutoGainControl"),i(o.audio,"noiseSuppression","mozNoiseSuppression")),s(o)},n&&n.prototype.getSettings){let o=n.prototype.getSettings;n.prototype.getSettings=function(){let c=o.apply(this,arguments);return i(c,"mozAutoGainControl","autoGainControl"),i(c,"mozNoiseSuppression","noiseSuppression"),c}}if(n&&n.prototype.applyConstraints){let o=n.prototype.applyConstraints;n.prototype.applyConstraints=function(c){return this.kind==="audio"&&typeof c=="object"&&(c=JSON.parse(JSON.stringify(c)),i(c,"autoGainControl","mozAutoGainControl"),i(c,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[c])}}}}function RM(r){typeof r=="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function MA(r,e){if(typeof r!="object"||!r.RTCPeerConnection&&!r.mozRTCPeerConnection)return;!r.RTCPeerConnection&&r.mozRTCPeerConnection&&(r.RTCPeerConnection=r.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){let s=r.RTCPeerConnection.prototype[i],o={[i](){return arguments[0]=new(i==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),s.apply(this,arguments)}};r.RTCPeerConnection.prototype[i]=o[i]});let t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){let[i,s,o]=arguments;return n.apply(this,[i||null]).then(c=>{if(e.version<53&&!s)try{c.forEach(d=>{d.type=t[d.type]||d.type})}catch(d){if(d.name!=="TypeError")throw d;c.forEach((u,p)=>{c.set(p,Object.assign({},u,{type:t[u.type]||u.type}))})}return c}).then(s,o)}}function CM(r){if(typeof r!="object"||!r.RTCPeerConnection||!r.RTCRtpSender||r.RTCRtpSender&&"getStats"in r.RTCRtpSender.prototype)return;let e=r.RTCPeerConnection.prototype.getSenders;e&&(r.RTCPeerConnection.prototype.getSenders=function(){let n=e.apply(this,[]);return n.forEach(i=>i._pc=this),n});let t=r.RTCPeerConnection.prototype.addTrack;t&&(r.RTCPeerConnection.prototype.addTrack=function(){let n=t.apply(this,arguments);return n._pc=this,n}),r.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):De.resolve(new Map)}}function bM(r){if(typeof r!="object"||!r.RTCPeerConnection||!r.RTCRtpSender||r.RTCRtpSender&&"getStats"in r.RTCRtpReceiver.prototype)return;let e=r.RTCPeerConnection.prototype.getReceivers;e&&(r.RTCPeerConnection.prototype.getReceivers=function(){let t=e.apply(this,[]);return t.forEach(n=>n._pc=this),t}),du(r,"track",t=>(t.receiver._pc=t.srcElement,t)),r.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function IM(r){r.RTCPeerConnection&&!("removeStream"in r.RTCPeerConnection.prototype)&&(r.RTCPeerConnection.prototype.removeStream=function(e){PA("removeStream","removeTrack"),this.getSenders().forEach(t=>{var n;t.track&&Re(n=e.getTracks()).call(n,t.track)&&this.removeTrack(t)})})}function AM(r){r.DataChannel&&!r.RTCDataChannel&&(r.RTCDataChannel=r.DataChannel)}function wM(r){if(typeof r!="object"||!r.RTCPeerConnection)return;let e=r.RTCPeerConnection.prototype.addTransceiver;e&&(r.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let t=arguments[1]&&arguments[1].sendEncodings;t===void 0&&(t=[]),t=[...t];let n=t.length>0;n&&t.forEach(s=>{if("rid"in s&&!/^[a-z0-9]{0,16}$/i.test(s.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in s&&!(parseFloat(s.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in s&&!(parseFloat(s.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let i=e.apply(this,arguments);if(n){let{sender:s}=i,o=s.getParameters();(!("encodings"in o)||o.encodings.length===1&&Object.keys(o.encodings[0]).length===0)&&(o.encodings=t,s.sendEncodings=t,this.setParametersPromises.push(s.setParameters(o).then(()=>{delete s.sendEncodings}).catch(()=>{delete s.sendEncodings})))}return i})}function OM(r){if(typeof r!="object"||!r.RTCRtpSender)return;let e=r.RTCRtpSender.prototype.getParameters;e&&(r.RTCRtpSender.prototype.getParameters=function(){let t=e.apply(this,arguments);return"encodings"in t||(t.encodings=[].concat(this.sendEncodings||[{}])),t})}function NM(r){if(typeof r!="object"||!r.RTCPeerConnection)return;let e=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?De.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function DM(r){if(typeof r!="object"||!r.RTCPeerConnection)return;let e=r.RTCPeerConnection.prototype.createAnswer;r.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?De.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var PM=Object.freeze({__proto__:null,shimAddTransceiver:wM,shimCreateAnswer:DM,shimCreateOffer:NM,shimGetDisplayMedia:function(r,e){r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||r.navigator.mediaDevices&&(r.navigator.mediaDevices.getDisplayMedia=function(t){if(!t||!t.video){let n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,De.reject(n)}return t.video===!0?t.video={mediaSource:e}:t.video.mediaSource=e,r.navigator.mediaDevices.getUserMedia(t)})},shimGetParameters:OM,shimGetUserMedia:yM,shimOnTrack:RM,shimPeerConnection:MA,shimRTCDataChannel:AM,shimReceiverGetStats:bM,shimRemoveStream:IM,shimSenderGetStats:CM});function kM(r){if(typeof r=="object"&&r.RTCPeerConnection){if("getLocalStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in r.RTCPeerConnection.prototype)){let e=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addStream=function(t){var n;this._localStreams||(this._localStreams=[]),Re(n=this._localStreams).call(n,t)||this._localStreams.push(t),t.getAudioTracks().forEach(i=>e.call(this,i,t)),t.getVideoTracks().forEach(i=>e.call(this,i,t))},r.RTCPeerConnection.prototype.addTrack=function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];return i&&i.forEach(o=>{var c;this._localStreams?Re(c=this._localStreams).call(c,o)||this._localStreams.push(o):this._localStreams=[o]}),e.apply(this,arguments)}}"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);let t=this._localStreams.indexOf(e);if(t===-1)return;this._localStreams.splice(t,1);let n=e.getTracks();this.getSenders().forEach(i=>{Re(n).call(n,i.track)&&this.removeTrack(i)})})}}function LM(r){if(typeof r=="object"&&r.RTCPeerConnection&&("getRemoteStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in r.RTCPeerConnection.prototype))){Object.defineProperty(r.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(i=>{var s;if(this._remoteStreams||(this._remoteStreams=[]),Re(s=this._remoteStreams).call(s,i))return;this._remoteStreams.push(i);let o=new Event("addstream");o.stream=i,this.dispatchEvent(o)})})}});let e=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){let t=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(i=>{if(t._remoteStreams||(t._remoteStreams=[]),t._remoteStreams.indexOf(i)>=0)return;t._remoteStreams.push(i);let s=new Event("addstream");s.stream=i,t.dispatchEvent(s)})}),e.apply(t,arguments)}}}function MM(r){if(typeof r!="object"||!r.RTCPeerConnection)return;let e=r.RTCPeerConnection.prototype,t=e.createOffer,n=e.createAnswer,i=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(d,u){let p=arguments.length>=2?arguments[2]:arguments[0],m=t.apply(this,[p]);return u?(m.then(d,u),De.resolve()):m},e.createAnswer=function(d,u){let p=arguments.length>=2?arguments[2]:arguments[0],m=n.apply(this,[p]);return u?(m.then(d,u),De.resolve()):m};let c=function(d,u,p){let m=i.apply(this,[d]);return p?(m.then(u,p),De.resolve()):m};e.setLocalDescription=c,c=function(d,u,p){let m=s.apply(this,[d]);return p?(m.then(u,p),De.resolve()):m},e.setRemoteDescription=c,c=function(d,u,p){let m=o.apply(this,[d]);return p?(m.then(u,p),De.resolve()):m},e.addIceCandidate=c}function UM(r){let e=r&&r.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){let t=e.mediaDevices,n=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=i=>n(xM(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(t,n,i){e.mediaDevices.getUserMedia(t).then(n,i)}).bind(e))}function xM(r){return r&&r.video!==void 0?Object.assign({},r,{video:lM(r.video)}):r}function VM(r){if(!r.RTCPeerConnection)return;let e=r.RTCPeerConnection;r.RTCPeerConnection=function(t,n){if(t&&t.iceServers){let i=[];for(let s=0;s<t.iceServers.length;s++){let o=t.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(PA("RTCIceServer.url","RTCIceServer.urls"),o=JSON.parse(JSON.stringify(o)),o.urls=o.url,delete o.url,i.push(o)):i.push(t.iceServers[s])}t.iceServers=i}return new e(t,n)},r.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(r.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function FM(r){typeof r=="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function BM(r){let e=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(t){if(t){t.offerToReceiveAudio!==void 0&&(t.offerToReceiveAudio=!!t.offerToReceiveAudio);let n=this.getTransceivers().find(s=>s.receiver.track.kind==="audio");t.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):t.offerToReceiveAudio!==!0||n||this.addTransceiver("audio",{direction:"recvonly"}),t.offerToReceiveVideo!==void 0&&(t.offerToReceiveVideo=!!t.offerToReceiveVideo);let i=this.getTransceivers().find(s=>s.receiver.track.kind==="video");t.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):t.offerToReceiveVideo!==!0||i||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function jM(r){typeof r!="object"||r.AudioContext||(r.AudioContext=r.webkitAudioContext)}var GM=Object.freeze({__proto__:null,shimAudioContext:jM,shimCallbacksAPI:MM,shimConstraints:xM,shimCreateOfferLegacy:BM,shimGetUserMedia:UM,shimLocalStreamsAPI:kM,shimRTCIceServerUrls:VM,shimRemoteStreamsAPI:LM,shimTrackEventTransceiver:FM}),WM=`	
\v\f\r                　\u2028\u2029\uFEFF`,D8=Kn,P8=Fr,UA=WM,HM=J("".replace),k8=RegExp("^["+UA+"]+"),L8=RegExp("(^|[^"+UA+"])["+UA+"]+$"),M8=function(r){return function(e){var t=P8(D8(e));return t=HM(t,k8,""),t=HM(t,L8,"$1"),t}},U8={trim:M8()},x8=Yf.PROPER,V8=y,KM=WM,F8=U8.trim;Ut({target:"String",proto:!0,forced:(function(r){return V8(function(){return!!KM[r]()||"​᠎"[r]()!=="​᠎"||x8&&KM[r].name!==r})})("trim")},{trim:function(){return F8(this)}});var B8=to("String","trim"),j8=ee,G8=B8,xA=String.prototype,W8=function(r){var e=r.trim;return typeof r=="string"||r===xA||j8(xA,r)&&e===xA.trim?G8:e},dr=S(W8),zM={exports:{}};(function(r){let e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(n=>n.trim())},e.splitSections=function(t){return t.split(`
m=`).map((n,i)=>(i>0?"m="+n:n).trim()+`\r
`)},e.getDescription=function(t){let n=e.splitSections(t);return n&&n[0]},e.getMediaSections=function(t){let n=e.splitSections(t);return n.shift(),n},e.matchPrefix=function(t,n){return e.splitLines(t).filter(i=>i.indexOf(n)===0)},e.parseCandidate=function(t){let n;n=t.indexOf("a=candidate:")===0?t.substring(12).split(" "):t.substring(10).split(" ");let i={foundation:n[0],component:{1:"rtp",2:"rtcp"}[n[1]]||n[1],protocol:n[2].toLowerCase(),priority:parseInt(n[3],10),ip:n[4],address:n[4],port:parseInt(n[5],10),type:n[7]};for(let s=8;s<n.length;s+=2)switch(n[s]){case"raddr":i.relatedAddress=n[s+1];break;case"rport":i.relatedPort=parseInt(n[s+1],10);break;case"tcptype":i.tcpType=n[s+1];break;case"ufrag":i.ufrag=n[s+1],i.usernameFragment=n[s+1];break;default:i[n[s]]===void 0&&(i[n[s]]=n[s+1])}return i},e.writeCandidate=function(t){let n=[];n.push(t.foundation);let i=t.component;i==="rtp"?n.push(1):i==="rtcp"?n.push(2):n.push(i),n.push(t.protocol.toUpperCase()),n.push(t.priority),n.push(t.address||t.ip),n.push(t.port);let s=t.type;return n.push("typ"),n.push(s),s!=="host"&&t.relatedAddress&&t.relatedPort&&(n.push("raddr"),n.push(t.relatedAddress),n.push("rport"),n.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(n.push("tcptype"),n.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(n.push("ufrag"),n.push(t.usernameFragment||t.ufrag)),"candidate:"+n.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let n=t.substring(9).split(" "),i={payloadType:parseInt(n.shift(),10)};return n=n[0].split("/"),i.name=n[0],i.clockRate=parseInt(n[1],10),i.channels=n.length===3?parseInt(n[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(t){let n=t.payloadType;t.preferredPayloadType!==void 0&&(n=t.preferredPayloadType);let i=t.channels||t.numChannels||1;return"a=rtpmap:"+n+" "+t.name+"/"+t.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(t){let n=t.substring(9).split(" ");return{id:parseInt(n[0],10),direction:n[0].indexOf("/")>0?n[0].split("/")[1]:"sendrecv",uri:n[1],attributes:n.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+`\r
`},e.parseFmtp=function(t){let n={},i,s=t.substring(t.indexOf(" ")+1).split(";");for(let o=0;o<s.length;o++)i=s[o].trim().split("="),n[i[0].trim()]=i[1];return n},e.writeFmtp=function(t){let n="",i=t.payloadType;if(t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){let s=[];Object.keys(t.parameters).forEach(o=>{t.parameters[o]!==void 0?s.push(o+"="+t.parameters[o]):s.push(o)}),n+="a=fmtp:"+i+" "+s.join(";")+`\r
`}return n},e.parseRtcpFb=function(t){let n=t.substring(t.indexOf(" ")+1).split(" ");return{type:n.shift(),parameter:n.join(" ")}},e.writeRtcpFb=function(t){let n="",i=t.payloadType;return t.preferredPayloadType!==void 0&&(i=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(s=>{n+="a=rtcp-fb:"+i+" "+s.type+(s.parameter&&s.parameter.length?" "+s.parameter:"")+`\r
`}),n},e.parseSsrcMedia=function(t){let n=t.indexOf(" "),i={ssrc:parseInt(t.substring(7,n),10)},s=t.indexOf(":",n);return s>-1?(i.attribute=t.substring(n+1,s),i.value=t.substring(s+1)):i.attribute=t.substring(n+1),i},e.parseSsrcGroup=function(t){let n=t.substring(13).split(" ");return{semantics:n.shift(),ssrcs:n.map(i=>parseInt(i,10))}},e.getMid=function(t){let n=e.matchPrefix(t,"a=mid:")[0];if(n)return n.substring(6)},e.parseFingerprint=function(t){let n=t.substring(14).split(" ");return{algorithm:n[0].toLowerCase(),value:n[1].toUpperCase()}},e.getDtlsParameters=function(t,n){return{role:"auto",fingerprints:e.matchPrefix(t+n,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,n){let i="a=setup:"+n+`\r
`;return t.fingerprints.forEach(s=>{i+="a=fingerprint:"+s.algorithm+" "+s.value+`\r
`}),i},e.parseCryptoLine=function(t){let n=t.substring(9).split(" ");return{tag:parseInt(n[0],10),cryptoSuite:n[1],keyParams:n[2],sessionParams:n.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;let n=t.substring(7).split("|");return{keyMethod:"inline",keySalt:n[0],lifeTime:n[1],mkiValue:n[2]?n[2].split(":")[0]:void 0,mkiLength:n[2]?n[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,n){return e.matchPrefix(t+n,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,n){let i=e.matchPrefix(t+n,"a=ice-ufrag:")[0],s=e.matchPrefix(t+n,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substring(12),password:s.substring(10)}:null},e.writeIceParameters=function(t){let n="a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`;return t.iceLite&&(n+=`a=ice-lite\r
`),n},e.parseRtpParameters=function(t){let n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(t)[0].split(" ");n.profile=i[2];for(let o=3;o<i.length;o++){let c=i[o],d=e.matchPrefix(t,"a=rtpmap:"+c+" ")[0];if(d){let u=e.parseRtpMap(d),p=e.matchPrefix(t,"a=fmtp:"+c+" ");switch(u.parameters=p.length?e.parseFmtp(p[0]):{},u.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),n.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(u.name.toUpperCase())}}}e.matchPrefix(t,"a=extmap:").forEach(o=>{n.headerExtensions.push(e.parseExtmap(o))});let s=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return n.codecs.forEach(o=>{s.forEach(c=>{o.rtcpFeedback.find(d=>d.type===c.type&&d.parameter===c.parameter)||o.rtcpFeedback.push(c)})}),n},e.writeRtpDescription=function(t,n){let i="";i+="m="+t+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,n.codecs.forEach(o=>{i+=e.writeRtpMap(o),i+=e.writeFmtp(o),i+=e.writeRtcpFb(o)});let s=0;return n.codecs.forEach(o=>{o.maxptime>s&&(s=o.maxptime)}),s>0&&(i+="a=maxptime:"+s+`\r
`),n.headerExtensions&&n.headerExtensions.forEach(o=>{i+=e.writeExtmap(o)}),i},e.parseRtpEncodingParameters=function(t){let n=[],i=e.parseRtpParameters(t),s=i.fecMechanisms.indexOf("RED")!==-1,o=i.fecMechanisms.indexOf("ULPFEC")!==-1,c=e.matchPrefix(t,"a=ssrc:").map(g=>e.parseSsrcMedia(g)).filter(g=>g.attribute==="cname"),d=c.length>0&&c[0].ssrc,u,p=e.matchPrefix(t,"a=ssrc-group:FID").map(g=>g.substring(17).split(" ").map(T=>parseInt(T,10)));p.length>0&&p[0].length>1&&p[0][0]===d&&(u=p[0][1]),i.codecs.forEach(g=>{if(g.name.toUpperCase()==="RTX"&&g.parameters.apt){let T={ssrc:d,codecPayloadType:parseInt(g.parameters.apt,10)};d&&u&&(T.rtx={ssrc:u}),n.push(T),s&&(T=JSON.parse(JSON.stringify(T)),T.fec={ssrc:d,mechanism:o?"red+ulpfec":"red"},n.push(T))}}),n.length===0&&d&&n.push({ssrc:d});let m=e.matchPrefix(t,"b=");return m.length&&(m=m[0].indexOf("b=TIAS:")===0?parseInt(m[0].substring(7),10):m[0].indexOf("b=AS:")===0?1e3*parseInt(m[0].substring(5),10)*.95-16e3:void 0,n.forEach(g=>{g.maxBitrate=m})),n},e.parseRtcpParameters=function(t){let n={},i=e.matchPrefix(t,"a=ssrc:").map(c=>e.parseSsrcMedia(c)).filter(c=>c.attribute==="cname")[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);let s=e.matchPrefix(t,"a=rtcp-rsize");n.reducedSize=s.length>0,n.compound=s.length===0;let o=e.matchPrefix(t,"a=rtcp-mux");return n.mux=o.length>0,n},e.writeRtcpParameters=function(t){let n="";return t.reducedSize&&(n+=`a=rtcp-rsize\r
`),t.mux&&(n+=`a=rtcp-mux\r
`),t.ssrc!==void 0&&t.cname&&(n+="a=ssrc:"+t.ssrc+" cname:"+t.cname+`\r
`),n},e.parseMsid=function(t){let n,i=e.matchPrefix(t,"a=msid:");if(i.length===1)return n=i[0].substring(7).split(" "),{stream:n[0],track:n[1]};let s=e.matchPrefix(t,"a=ssrc:").map(o=>e.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");return s.length>0?(n=s[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},e.parseSctpDescription=function(t){let n=e.parseMLine(t),i=e.matchPrefix(t,"a=max-message-size:"),s;i.length>0&&(s=parseInt(i[0].substring(19),10)),isNaN(s)&&(s=65536);let o=e.matchPrefix(t,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:n.fmt,maxMessageSize:s};let c=e.matchPrefix(t,"a=sctpmap:");if(c.length>0){let d=c[0].substring(10).split(" ");return{port:parseInt(d[0],10),protocol:d[1],maxMessageSize:s}}},e.writeSctpDescription=function(t,n){let i=[];return i=t.protocol!=="DTLS/SCTP"?["m="+t.kind+" 9 "+t.protocol+" "+n.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+n.port+`\r
`]:["m="+t.kind+" 9 "+t.protocol+" "+n.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+n.port+" "+n.protocol+` 65535\r
`],n.maxMessageSize!==void 0&&i.push("a=max-message-size:"+n.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,n,i){let s,o=n!==void 0?n:2;return s=t||e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+s+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(t,n){let i=e.splitLines(t);for(let s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substring(2)}return n?e.getDirection(n):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){let n=e.splitLines(t)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},e.parseOLine=function(t){let n=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;let n=e.splitLines(t);for(let i=0;i<n.length;i++)if(n[i].length<2||n[i].charAt(1)!=="=")return!1;return!0},r.exports=e})(zM);var YM=zM.exports,Hp=S(YM),H8=h({__proto__:null,default:Hp},[YM]);function QT(r){if(!r.RTCIceCandidate||r.RTCIceCandidate&&"foundation"in r.RTCIceCandidate.prototype)return;let e=r.RTCIceCandidate;r.RTCIceCandidate=function(t){if(typeof t=="object"&&t.candidate&&t.candidate.indexOf("a=")===0&&((t=JSON.parse(JSON.stringify(t))).candidate=t.candidate.substr(2)),t.candidate&&t.candidate.length){let n=new e(t),i=Hp.parseCandidate(t.candidate),s=Object.assign(n,i);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new e(t)},r.RTCIceCandidate.prototype=e.prototype,du(r,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new r.RTCIceCandidate(t.candidate),writable:"false"}),t))}function VA(r){!r.RTCIceCandidate||r.RTCIceCandidate&&"relayProtocol"in r.RTCIceCandidate.prototype||du(r,"icecandidate",e=>{if(e.candidate){let t=Hp.parseCandidate(e.candidate.candidate);t.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e})}function ZT(r,e){if(!r.RTCPeerConnection)return;"sctp"in r.RTCPeerConnection.prototype||Object.defineProperty(r.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});let t=function(c){if(!c||!c.sdp)return!1;let d=Hp.splitSections(c.sdp);return d.shift(),d.some(u=>{let p=Hp.parseMLine(u);return p&&p.kind==="application"&&p.protocol.indexOf("SCTP")!==-1})},n=function(c){let d=c.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(d===null||d.length<2)return-1;let u=parseInt(d[1],10);return u!=u?-1:u},i=function(c){let d=65536;return e.browser==="firefox"&&(d=e.version<57?c===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),d},s=function(c,d){let u=65536;e.browser==="firefox"&&e.version===57&&(u=65535);let p=Hp.matchPrefix(c.sdp,"a=max-message-size:");return p.length>0?u=parseInt(p[0].substr(19),10):e.browser==="firefox"&&d!==-1&&(u=2147483637),u},o=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){let{sdpSemantics:c}=this.getConfiguration();c==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){let c=n(arguments[0]),d=i(c),u=s(arguments[0],c),p;p=d===0&&u===0?Number.POSITIVE_INFINITY:d===0||u===0?Math.max(d,u):Math.min(d,u);let m={};Object.defineProperty(m,"maxMessageSize",{get:()=>p}),this._sctp=m}return o.apply(this,arguments)}}function $T(r){if(!r.RTCPeerConnection||!("createDataChannel"in r.RTCPeerConnection.prototype))return;function e(n,i){let s=n.send;n.send=function(){let o=arguments[0],c=o.length||o.size||o.byteLength;if(n.readyState==="open"&&i.sctp&&c>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return s.apply(n,arguments)}}let t=r.RTCPeerConnection.prototype.createDataChannel;r.RTCPeerConnection.prototype.createDataChannel=function(){let n=t.apply(this,arguments);return e(n,this),n},du(r,"datachannel",n=>(e(n.channel,n.target),n))}function FA(r){if(!r.RTCPeerConnection||"connectionState"in r.RTCPeerConnection.prototype)return;let e=r.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{let n=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{let s=i.target;if(s._lastConnectionState!==s.connectionState){s._lastConnectionState=s.connectionState;let o=new Event("connectionstatechange",i);s.dispatchEvent(o)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function BA(r,e){if(!r.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;let t=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let i=n.sdp.split(`
`).filter(s=>dr(s).call(s)!=="a=extmap-allow-mixed").join(`
`);r.RTCSessionDescription&&n instanceof r.RTCSessionDescription?arguments[0]=new r.RTCSessionDescription({type:n.type,sdp:i}):n.sdp=i}return t.apply(this,arguments)}}function ev(r,e){if(!r.RTCPeerConnection||!r.RTCPeerConnection.prototype)return;let t=r.RTCPeerConnection.prototype.addIceCandidate;t&&t.length!==0&&(r.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?De.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),De.resolve())})}function tv(r,e){if(!r.RTCPeerConnection||!r.RTCPeerConnection.prototype)return;let t=r.RTCPeerConnection.prototype.setLocalDescription;t&&t.length!==0&&(r.RTCPeerConnection.prototype.setLocalDescription=function(){let n=arguments[0]||{};if(typeof n!="object"||n.type&&n.sdp)return t.apply(this,arguments);if(n={type:n.type,sdp:n.sdp},!n.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":n.type="offer";break;default:n.type="answer"}return n.sdp||n.type!=="offer"&&n.type!=="answer"?t.apply(this,[n]):(n.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(i=>t.apply(this,[i]))})}var K8=Object.freeze({__proto__:null,removeExtmapAllowMixed:BA,shimAddIceCandidateNullOrEmpty:ev,shimConnectionState:FA,shimMaxMessageSize:ZT,shimParameterlessSetLocalDescription:tv,shimRTCIceCandidate:QT,shimRTCIceCandidateRelayProtocol:VA,shimSendThrowTypeError:$T});(function(){let{window:r}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},t=aM,n=(function(s){let o={browser:null,version:null};if(s===void 0||!s.navigator)return o.browser="Not a browser.",o;let{navigator:c}=s;if(c.mozGetUserMedia)o.browser="firefox",o.version=JT(c.userAgent,/Firefox\/(\d+)\./,1);else if(c.webkitGetUserMedia||s.isSecureContext===!1&&s.webkitRTCPeerConnection)o.browser="chrome",o.version=JT(c.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!s.RTCPeerConnection||!c.userAgent.match(/AppleWebKit\/(\d+)\./))return o.browser="Not a supported browser.",o;o.browser="safari",o.version=JT(c.userAgent,/AppleWebKit\/(\d+)\./,1),o.supportsUnifiedPlan=s.RTCRtpTransceiver&&"currentDirection"in s.RTCRtpTransceiver.prototype}return o})(r),i={browserDetails:n,commonShim:K8,extractVersion:JT,disableLog:O8,disableWarnings:N8,sdp:H8};switch(n.browser){case"chrome":if(!vM||!LA||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),i;if(n.version===null)return t("Chrome shim can not determine version, not shimming."),i;t("adapter.js shimming chrome."),i.browserShim=vM,ev(r,n),tv(r),hM(r,n),pM(r),LA(r,n),fM(r),SM(r,n),_M(r),mM(r),EM(r),TM(r,n),QT(r),VA(r),FA(r),ZT(r,n),$T(r),BA(r,n);break;case"firefox":if(!PM||!MA||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),i;t("adapter.js shimming firefox."),i.browserShim=PM,ev(r,n),tv(r),yM(r,n),MA(r,n),RM(r),IM(r),CM(r),bM(r),AM(r),wM(r),OM(r),NM(r),DM(r),QT(r),FA(r),ZT(r,n),$T(r);break;case"safari":if(!GM||!e.shimSafari)return t("Safari shim is not included in this adapter release."),i;t("adapter.js shimming safari."),i.browserShim=GM,ev(r,n),tv(r),VM(r),BM(r),MM(r),kM(r),LM(r),FM(r),UM(r),jM(r),QT(r),VA(r),ZT(r,n),$T(r),BA(r,n);break;default:t("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var jA=oe;Ut({global:!0,forced:jA.globalThis!==jA},{globalThis:jA});var qM=S(oe),GA={exports:{}};(function(r,e){(function(t,n){var i="function",s="undefined",o="object",c="string",d="major",u="model",p="name",m="type",g="vendor",T="version",R="architecture",I="console",A="mobile",w="tablet",k="smarttv",L="wearable",j="embedded",K="Amazon",W="Apple",Y="ASUS",se="BlackBerry",de="Browser",ge="Chrome",je="Firefox",_t="Google",ht="Huawei",Ct="LG",Ft="Microsoft",mn="Motorola",We="Opera",Se="Samsung",we="Sharp",be="Sony",M="Xiaomi",O="Zebra",G="Facebook",ne="Chromium OS",Be="Mac OS",Lt=" Browser",yn=function(us){for(var ii={},bn=0;bn<us.length;bn++)ii[us[bn].toUpperCase()]=us[bn];return ii},tr=function(us,ii){return typeof us===c&&xo(ii).indexOf(xo(us))!==-1},xo=function(us){return us.toLowerCase()},Rl=function(us,ii){if(typeof us===c)return us=us.replace(/^\s\s*/,""),typeof ii===s?us:us.substring(0,500)},Sf=function(us,ii){for(var bn,di,co,Qi,cr,Dn,wn=0;wn<ii.length&&!cr;){var Xc=ii[wn],bl=ii[wn+1];for(bn=di=0;bn<Xc.length&&!cr&&Xc[bn];)if(cr=Xc[bn++].exec(us))for(co=0;co<bl.length;co++)Dn=cr[++di],typeof(Qi=bl[co])===o&&Qi.length>0?Qi.length===2?typeof Qi[1]==i?this[Qi[0]]=Qi[1].call(this,Dn):this[Qi[0]]=Qi[1]:Qi.length===3?typeof Qi[1]!==i||Qi[1].exec&&Qi[1].test?this[Qi[0]]=Dn?Dn.replace(Qi[1],Qi[2]):n:this[Qi[0]]=Dn?Qi[1].call(this,Dn,Qi[2]):n:Qi.length===4&&(this[Qi[0]]=Dn?Qi[3].call(this,Dn.replace(Qi[1],Qi[2])):n):this[Qi]=Dn||n;wn+=2}},xh=function(us,ii){for(var bn in ii)if(typeof ii[bn]===o&&ii[bn].length>0){for(var di=0;di<ii[bn].length;di++)if(tr(ii[bn][di],us))return bn==="?"?n:bn}else if(tr(ii[bn],us))return bn==="?"?n:bn;return ii.hasOwnProperty("*")?ii["*"]:us},hE={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Xv={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[T,[p,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[T,[p,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[p,T],[/opios[\/ ]+([\w\.]+)/i],[T,[p,We+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[T,[p,We+" GX"]],[/\bopr\/([\w\.]+)/i],[T,[p,We]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[T,[p,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[T,[p,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[p,T],[/quark(?:pc)?\/([-\w\.]+)/i],[T,[p,"Quark"]],[/\bddg\/([\w\.]+)/i],[T,[p,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[T,[p,"UC"+de]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[T,[p,"WeChat"]],[/konqueror\/([\w\.]+)/i],[T,[p,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[T,[p,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[T,[p,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[T,[p,"Smart Lenovo "+de]],[/(avast|avg)\/([\w\.]+)/i],[[p,/(.+)/,"$1 Secure "+de],T],[/\bfocus\/([\w\.]+)/i],[T,[p,je+" Focus"]],[/\bopt\/([\w\.]+)/i],[T,[p,We+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[T,[p,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[T,[p,"Dolphin"]],[/coast\/([\w\.]+)/i],[T,[p,We+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[T,[p,"MIUI"+Lt]],[/fxios\/([\w\.-]+)/i],[T,[p,je]],[/\bqihoobrowser\/?([\w\.]*)/i],[T,[p,"360"]],[/\b(qq)\/([\w\.]+)/i],[[p,/(.+)/,"$1Browser"],T],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[p,/(.+)/,"$1"+Lt],T],[/samsungbrowser\/([\w\.]+)/i],[T,[p,Se+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[T,[p,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[p,"Sogou Mobile"],T],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[p,T],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[p],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[T,p],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[p,G],T],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[p,T],[/\bgsa\/([\w\.]+) .*safari\//i],[T,[p,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[T,[p,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[T,[p,ge+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[p,ge+" WebView"],T],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[T,[p,"Android "+de]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[p,T],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[T,[p,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[T,p],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[p,[T,xh,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[p,T],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[p,"Netscape"],T],[/(wolvic|librewolf)\/([\w\.]+)/i],[p,T],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[T,[p,je+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[p,[T,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[p,[T,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[R,"amd64"]],[/(ia32(?=;))/i],[[R,xo]],[/((?:i[346]|x)86)[;\)]/i],[[R,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[R,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[R,"armhf"]],[/windows (ce|mobile); ppc;/i],[[R,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[R,/ower/,"",xo]],[/(sun4\w)[;\)]/i],[[R,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[R,xo]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[u,[g,Se],[m,w]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[u,[g,Se],[m,A]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[u,[g,W],[m,A]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[u,[g,W],[m,w]],[/(macintosh);/i],[u,[g,W]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[u,[g,we],[m,A]],[/(?:honor)([-\w ]+)[;\)]/i],[u,[g,"Honor"],[m,A]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[u,[g,ht],[m,w]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[u,[g,ht],[m,A]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[u,/_/g," "],[g,M],[m,A]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[u,/_/g," "],[g,M],[m,w]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[u,[g,"OPPO"],[m,A]],[/\b(opd2\d{3}a?) bui/i],[u,[g,"OPPO"],[m,w]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[u,[g,"Vivo"],[m,A]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[u,[g,"Realme"],[m,A]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[u,[g,mn],[m,A]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[u,[g,mn],[m,w]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[u,[g,Ct],[m,w]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[u,[g,Ct],[m,A]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[u,[g,"Lenovo"],[m,w]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[u,/_/g," "],[g,"Nokia"],[m,A]],[/(pixel c)\b/i],[u,[g,_t],[m,w]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[u,[g,_t],[m,A]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[u,[g,be],[m,A]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[u,"Xperia Tablet"],[g,be],[m,w]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[u,[g,"OnePlus"],[m,A]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[u,[g,K],[m,w]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[u,/(.+)/g,"Fire Phone $1"],[g,K],[m,A]],[/(playbook);[-\w\),; ]+(rim)/i],[u,g,[m,w]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[u,[g,se],[m,A]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[u,[g,Y],[m,w]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[u,[g,Y],[m,A]],[/(nexus 9)/i],[u,[g,"HTC"],[m,w]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[g,[u,/_/g," "],[m,A]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[u,[g,"TCL"],[m,w]],[/(itel) ((\w+))/i],[[g,xo],u,[m,xh,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[u,[g,"Acer"],[m,w]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[u,[g,"Meizu"],[m,A]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[u,[g,"Ulefone"],[m,A]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[u,[g,"Energizer"],[m,A]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[u,[g,"Cat"],[m,A]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[u,[g,"Smartfren"],[m,A]],[/droid.+; (a(?:015|06[35]|142p?))/i],[u,[g,"Nothing"],[m,A]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[g,u,[m,A]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[g,u,[m,w]],[/(surface duo)/i],[u,[g,Ft],[m,w]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[u,[g,"Fairphone"],[m,A]],[/(u304aa)/i],[u,[g,"AT&T"],[m,A]],[/\bsie-(\w*)/i],[u,[g,"Siemens"],[m,A]],[/\b(rct\w+) b/i],[u,[g,"RCA"],[m,w]],[/\b(venue[\d ]{2,7}) b/i],[u,[g,"Dell"],[m,w]],[/\b(q(?:mv|ta)\w+) b/i],[u,[g,"Verizon"],[m,w]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[u,[g,"Barnes & Noble"],[m,w]],[/\b(tm\d{3}\w+) b/i],[u,[g,"NuVision"],[m,w]],[/\b(k88) b/i],[u,[g,"ZTE"],[m,w]],[/\b(nx\d{3}j) b/i],[u,[g,"ZTE"],[m,A]],[/\b(gen\d{3}) b.+49h/i],[u,[g,"Swiss"],[m,A]],[/\b(zur\d{3}) b/i],[u,[g,"Swiss"],[m,w]],[/\b((zeki)?tb.*\b) b/i],[u,[g,"Zeki"],[m,w]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[g,"Dragon Touch"],u,[m,w]],[/\b(ns-?\w{0,9}) b/i],[u,[g,"Insignia"],[m,w]],[/\b((nxa|next)-?\w{0,9}) b/i],[u,[g,"NextBook"],[m,w]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[g,"Voice"],u,[m,A]],[/\b(lvtel\-)?(v1[12]) b/i],[[g,"LvTel"],u,[m,A]],[/\b(ph-1) /i],[u,[g,"Essential"],[m,A]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[u,[g,"Envizen"],[m,w]],[/\b(trio[-\w\. ]+) b/i],[u,[g,"MachSpeed"],[m,w]],[/\btu_(1491) b/i],[u,[g,"Rotor"],[m,w]],[/(shield[\w ]+) b/i],[u,[g,"Nvidia"],[m,w]],[/(sprint) (\w+)/i],[g,u,[m,A]],[/(kin\.[onetw]{3})/i],[[u,/\./g," "],[g,Ft],[m,A]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[u,[g,O],[m,w]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[u,[g,O],[m,A]],[/smart-tv.+(samsung)/i],[g,[m,k]],[/hbbtv.+maple;(\d+)/i],[[u,/^/,"SmartTV"],[g,Se],[m,k]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[g,Ct],[m,k]],[/(apple) ?tv/i],[g,[u,W+" TV"],[m,k]],[/crkey/i],[[u,ge+"cast"],[g,_t],[m,k]],[/droid.+aft(\w+)( bui|\))/i],[u,[g,K],[m,k]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[u,[g,we],[m,k]],[/(bravia[\w ]+)( bui|\))/i],[u,[g,be],[m,k]],[/(mitv-\w{5}) bui/i],[u,[g,M],[m,k]],[/Hbbtv.*(technisat) (.*);/i],[g,u,[m,k]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[g,Rl],[u,Rl],[m,k]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[m,k]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[g,u,[m,I]],[/droid.+; (shield) bui/i],[u,[g,"Nvidia"],[m,I]],[/(playstation [345portablevi]+)/i],[u,[g,be],[m,I]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[u,[g,Ft],[m,I]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[u,[g,Se],[m,L]],[/((pebble))app/i],[g,u,[m,L]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[u,[g,W],[m,L]],[/droid.+; (glass) \d/i],[u,[g,_t],[m,L]],[/droid.+; (wt63?0{2,3})\)/i],[u,[g,O],[m,L]],[/droid.+; (glass) \d/i],[u,[g,_t],[m,L]],[/(pico) (4|neo3(?: link|pro)?)/i],[g,u,[m,L]],[/; (quest( \d| pro)?)/i],[u,[g,G],[m,L]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[g,[m,j]],[/(aeobc)\b/i],[u,[g,K],[m,j]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[u,[m,A]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[u,[m,w]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[m,w]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[m,A]],[/(android[-\w\. ]{0,9});.+buil/i],[u,[g,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[T,[p,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[p,T],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[T,[p,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[p,T],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[T,p]],os:[[/microsoft (windows) (vista|xp)/i],[p,T],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[p,[T,xh,hE]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[T,xh,hE],[p,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[T,/_/g,"."],[p,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[p,Be],[T,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[T,p],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[p,T],[/\(bb(10);/i],[T,[p,se]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[T,[p,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[T,[p,je+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[T,[p,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[T,[p,"watchOS"]],[/crkey\/([\d\.]+)/i],[T,[p,ge+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[p,ne],T],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[p,T],[/(sunos) ?([\w\.\d]*)/i],[[p,"Solaris"],T],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[p,T]]},Cl=function(us,ii){if(typeof us===o&&(ii=us,us=n),!(this instanceof Cl))return new Cl(us,ii).getResult();var bn=typeof t!==s&&t.navigator?t.navigator:n,di=us||(bn&&bn.userAgent?bn.userAgent:""),co=bn&&bn.userAgentData?bn.userAgentData:n,Qi=ii?(function(Dn,wn){var Xc={};for(var bl in Dn)wn[bl]&&wn[bl].length%2==0?Xc[bl]=wn[bl].concat(Dn[bl]):Xc[bl]=Dn[bl];return Xc})(Xv,ii):Xv,cr=bn&&bn.userAgent==di;return this.getBrowser=function(){var Dn={};return Dn[p]=n,Dn[T]=n,Sf.call(Dn,di,Qi.browser),Dn[d]=(function(wn){return typeof wn===c?wn.replace(/[^\d\.]/g,"").split(".")[0]:n})(Dn[T]),cr&&bn&&bn.brave&&typeof bn.brave.isBrave==i&&(Dn[p]="Brave"),Dn},this.getCPU=function(){var Dn={};return Dn[R]=n,Sf.call(Dn,di,Qi.cpu),Dn},this.getDevice=function(){var Dn={};return Dn[g]=n,Dn[u]=n,Dn[m]=n,Sf.call(Dn,di,Qi.device),cr&&!Dn[m]&&co&&co.mobile&&(Dn[m]=A),cr&&Dn[u]=="Macintosh"&&bn&&typeof bn.standalone!==s&&bn.maxTouchPoints&&bn.maxTouchPoints>2&&(Dn[u]="iPad",Dn[m]=w),Dn},this.getEngine=function(){var Dn={};return Dn[p]=n,Dn[T]=n,Sf.call(Dn,di,Qi.engine),Dn},this.getOS=function(){var Dn={};return Dn[p]=n,Dn[T]=n,Sf.call(Dn,di,Qi.os),cr&&!Dn[p]&&co&&co.platform&&co.platform!="Unknown"&&(Dn[p]=co.platform.replace(/chrome os/i,ne).replace(/macos/i,Be)),Dn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return di},this.setUA=function(Dn){return di=typeof Dn===c&&Dn.length>500?Rl(Dn,500):Dn,this},this.setUA(di),this};Cl.VERSION="0.7.40",Cl.BROWSER=yn([p,T,d]),Cl.CPU=yn([R]),Cl.DEVICE=yn([u,g,m,I,A,k,w,L,j]),Cl.ENGINE=Cl.OS=yn([p,T]),r.exports&&(e=r.exports=Cl),e.UAParser=Cl;var Da=typeof t!==s&&(t.jQuery||t.Zepto);if(Da&&!Da.ua){var Vh=new Cl;Da.ua=Vh.getResult(),Da.ua.get=function(){return Vh.getUA()},Da.ua.set=function(us){Vh.setUA(us);var ii=Vh.getResult();for(var bn in ii)Da.ua[bn]=ii[bn]}}})(typeof window=="object"?window:_)})(GA,GA.exports);var z8=S(GA.exports),XM=al.clear;Ut({global:!0,bind:!0,forced:oe.clearImmediate!==XM},{clearImmediate:XM});var JM=oe,Y8=Ae,q8=$,X8=Lf,J8=Ot,Q8=Do,Z8=da,$8=JM.Function,eK=/MSIE .\./.test(J8)||X8==="BUN"&&(function(){var r=JM.Bun.version.split(".");return r.length<3||r[0]==="0"&&(r[1]<3||r[1]==="3"&&r[2]==="0")})(),tK=Ut,QM=oe,ZM=al.set,nK=function(r,e){var t=1;return eK?function(n,i){var s=Z8(arguments.length,1)>t,o=q8(n)?n:$8(n),c=s?Q8(arguments,t):[],d=s?function(){Y8(o,this,c)}:o;return r(d)}:r},$M=QM.setImmediate?nK(ZM):ZM;tK({global:!0,bind:!0,forced:QM.setImmediate!==$M},{setImmediate:$M});var e2=S(xn.setImmediate),iK=oe,rK=s_,sK=hi,oK=da,aK=Xe;Ut({global:!0,dontCallGetSet:!0,forced:y(function(){return aK&&Object.getOwnPropertyDescriptor(iK,"queueMicrotask").value.length!==1})},{queueMicrotask:function(r){oK(arguments.length,1),rK(sK(r))}});var t2=S(xn.queueMicrotask);function n2(r,e){return function(){return r.apply(e,arguments)}}let{toString:cK}=Object.prototype,{getPrototypeOf:WA}=Object,{iterator:nv,toStringTag:i2}=Symbol,iv=(HA=Object.create(null),r=>{let e=cK.call(r);return HA[e]||(HA[e]=e.slice(8,-1).toLowerCase())});var HA;let Aa=r=>(r=r.toLowerCase(),e=>iv(e)===r),rv=r=>e=>typeof e===r,{isArray:Kp}=Array,Nm=rv("undefined"),r2=Aa("ArrayBuffer"),lK=rv("string"),zs=rv("function"),s2=rv("number"),sv=r=>r!==null&&typeof r=="object",ov=r=>{if(iv(r)!=="object")return!1;let e=WA(r);return!(e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||i2 in r||nv in r)},dK=Aa("Date"),uK=Aa("File"),hK=Aa("Blob"),pK=Aa("FileList"),fK=Aa("URLSearchParams"),[_K,mK,EK,gK]=["ReadableStream","Request","Response","Headers"].map(Aa);function Dm(r,e){let t,n,{allOwnKeys:i=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(r!=null)if(typeof r!="object"&&(r=[r]),Kp(r))for(t=0,n=r.length;t<n;t++)e.call(null,r[t],t,r);else{let s=i?Object.getOwnPropertyNames(r):Object.keys(r),o=s.length,c;for(t=0;t<o;t++)c=s[t],e.call(null,r[c],c,r)}}function o2(r,e){e=e.toLowerCase();let t=Object.keys(r),n,i=t.length;for(;i-- >0;)if(n=t[i],e===n.toLowerCase())return n;return null}let uu=qM!==void 0?qM:typeof self<"u"?self:typeof window<"u"?window:global,a2=r=>!Nm(r)&&r!==uu,SK=(KA=typeof Uint8Array<"u"&&WA(Uint8Array),r=>KA&&r instanceof KA);var KA;let TK=Aa("HTMLFormElement"),c2=(r=>{let{hasOwnProperty:e}=r;return(t,n)=>e.call(t,n)})(Object.prototype),vK=Aa("RegExp"),l2=(r,e)=>{let t=Object.getOwnPropertyDescriptors(r),n={};Dm(t,(i,s)=>{let o;(o=e(i,s,r))!==!1&&(n[s]=o||i)}),Object.defineProperties(r,n)},yK=Aa("AsyncFunction"),d2=(u2=typeof e2=="function",h2=zs(uu.postMessage),u2?e2:h2?(zA="axios@".concat(Math.random()),av=[],uu.addEventListener("message",r=>{let{source:e,data:t}=r;e===uu&&t===zA&&av.length&&av.shift()()},!1),r=>{av.push(r),uu.postMessage(zA,"*")}):r=>setTimeout(r));var u2,h2,zA,av;let RK=t2!==void 0?t2.bind(uu):typeof process<"u"&&process.nextTick||d2;var Oe={isArray:Kp,isArrayBuffer:r2,isBuffer:function(r){return r!==null&&!Nm(r)&&r.constructor!==null&&!Nm(r.constructor)&&zs(r.constructor.isBuffer)&&r.constructor.isBuffer(r)},isFormData:r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||zs(r.append)&&((e=iv(r))==="formdata"||e==="object"&&zs(r.toString)&&r.toString()==="[object FormData]"))},isArrayBufferView:function(r){let e;return e=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(r):r&&r.buffer&&r2(r.buffer),e},isString:lK,isNumber:s2,isBoolean:r=>r===!0||r===!1,isObject:sv,isPlainObject:ov,isReadableStream:_K,isRequest:mK,isResponse:EK,isHeaders:gK,isUndefined:Nm,isDate:dK,isFile:uK,isBlob:hK,isRegExp:vK,isFunction:zs,isStream:r=>sv(r)&&zs(r.pipe),isURLSearchParams:fK,isTypedArray:SK,isFileList:pK,forEach:Dm,merge:function r(){let{caseless:e}=a2(this)&&this||{},t={},n=(i,s)=>{let o=e&&o2(t,s)||s;ov(t[o])&&ov(i)?t[o]=r(t[o],i):ov(i)?t[o]=r({},i):Kp(i)?t[o]=i.slice():t[o]=i};for(let i=0,s=arguments.length;i<s;i++)arguments[i]&&Dm(arguments[i],n);return t},extend:function(r,e,t){let{allOwnKeys:n}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Dm(e,(i,s)=>{t&&zs(i)?r[s]=n2(i,t):r[s]=i},{allOwnKeys:n}),r},trim:r=>dr(r)?dr(r).call(r):r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),inherits:(r,e,t,n)=>{r.prototype=Object.create(e.prototype,n),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),t&&Object.assign(r.prototype,t)},toFlatObject:(r,e,t,n)=>{let i,s,o,c={};if(e=e||{},r==null)return e;do{for(i=Object.getOwnPropertyNames(r),s=i.length;s-- >0;)o=i[s],n&&!n(o,r,e)||c[o]||(e[o]=r[o],c[o]=!0);r=t!==!1&&WA(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e},kindOf:iv,kindOfTest:Aa,endsWith:(r,e,t)=>{r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;let n=r.indexOf(e,t);return n!==-1&&n===t},toArray:r=>{if(!r)return null;if(Kp(r))return r;let e=r.length;if(!s2(e))return null;let t=new Array(e);for(;e-- >0;)t[e]=r[e];return t},forEachEntry:(r,e)=>{let t=(r&&r[nv]).call(r),n;for(;(n=t.next())&&!n.done;){let i=n.value;e.call(r,i[0],i[1])}},matchAll:(r,e)=>{let t,n=[];for(;(t=r.exec(e))!==null;)n.push(t);return n},isHTMLForm:TK,hasOwnProperty:c2,hasOwnProp:c2,reduceDescriptors:l2,freezeMethods:r=>{l2(r,(e,t)=>{if(zs(r)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;let n=r[t];zs(n)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")}))})},toObjectSet:(r,e)=>{let t={},n=i=>{i.forEach(s=>{t[s]=!0})};return Kp(r)?n(r):n(String(r).split(e)),t},toCamelCase:r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,n){return t.toUpperCase()+n}),noop:()=>{},toFiniteNumber:(r,e)=>r!=null&&Number.isFinite(r=+r)?r:e,findKey:o2,global:uu,isContextDefined:a2,isSpecCompliantForm:function(r){return!!(r&&zs(r.append)&&r[i2]==="FormData"&&r[nv])},toJSONObject:r=>{let e=new Array(10),t=(n,i)=>{if(sv(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[i]=n;let s=Kp(n)?[]:{};return Dm(n,(o,c)=>{let d=t(o,i+1);!Nm(d)&&(s[c]=d)}),e[i]=void 0,s}}return n};return t(r,0)},isAsyncFn:yK,isThenable:r=>r&&(sv(r)||zs(r))&&zs(r.then)&&zs(r.catch),setImmediate:d2,asap:RK,isIterable:r=>r!=null&&zs(r[nv])};function Jt(r,e,t,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}Oe.inherits(Jt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Oe.toJSONObject(this.config),code:this.code,status:this.status}}});let p2=Jt.prototype,f2={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{f2[r]={value:r}}),Object.defineProperties(Jt,f2),Object.defineProperty(p2,"isAxiosError",{value:!0}),Jt.from=(r,e,t,n,i,s)=>{let o=Object.create(p2);return Oe.toFlatObject(r,o,function(c){return c!==Error.prototype},c=>c!=="isAxiosError"),Jt.call(o,r.message,e,t,n,i),o.cause=r,o.name=r.name,s&&Object.assign(o,s),o};function YA(r){return Oe.isPlainObject(r)||Oe.isArray(r)}function _2(r){return Oe.endsWith(r,"[]")?r.slice(0,-2):r}function m2(r,e,t){return r?r.concat(e).map(function(n,i){return n=_2(n),!t&&i?"["+n+"]":n}).join(t?".":""):e}let CK=Oe.toFlatObject(Oe,{},null,function(r){return/^is[A-Z]/.test(r)});function cv(r,e,t){if(!Oe.isObject(r))throw new TypeError("target must be an object");e=e||new FormData;let n=(t=Oe.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,T){return!Oe.isUndefined(T[g])})).metaTokens,i=t.visitor||u,s=t.dots,o=t.indexes,c=(t.Blob||typeof Blob<"u"&&Blob)&&Oe.isSpecCompliantForm(e);if(!Oe.isFunction(i))throw new TypeError("visitor must be a function");function d(g){if(g===null)return"";if(Oe.isDate(g))return g.toISOString();if(!c&&Oe.isBlob(g))throw new Jt("Blob is not supported. Use a Buffer instead.");return Oe.isArrayBuffer(g)||Oe.isTypedArray(g)?c&&typeof Blob=="function"?new Blob([g]):Buffer.from(g):g}function u(g,T,R){let I=g;if(g&&!R&&typeof g=="object"){if(Oe.endsWith(T,"{}"))T=n?T:T.slice(0,-2),g=JSON.stringify(g);else if(Oe.isArray(g)&&(function(A){return Oe.isArray(A)&&!A.some(YA)})(g)||(Oe.isFileList(g)||Oe.endsWith(T,"[]"))&&(I=Oe.toArray(g)))return T=_2(T),I.forEach(function(A,w){!Oe.isUndefined(A)&&A!==null&&e.append(o===!0?m2([T],w,s):o===null?T:T+"[]",d(A))}),!1}return!!YA(g)||(e.append(m2(R,T,s),d(g)),!1)}let p=[],m=Object.assign(CK,{defaultVisitor:u,convertValue:d,isVisitable:YA});if(!Oe.isObject(r))throw new TypeError("data must be an object");return(function g(T,R){if(!Oe.isUndefined(T)){if(p.indexOf(T)!==-1)throw Error("Circular reference detected in "+R.join("."));p.push(T),Oe.forEach(T,function(I,A){(!(Oe.isUndefined(I)||I===null)&&i.call(e,I,Oe.isString(A)?dr(A).call(A):A,R,m))===!0&&g(I,R?R.concat(A):[A])}),p.pop()}})(r),e}function E2(r){let e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function qA(r,e){this._pairs=[],r&&cv(r,this,e)}let g2=qA.prototype;function bK(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function S2(r,e,t){if(!e)return r;let n=t&&t.encode||bK;Oe.isFunction(t)&&(t={serialize:t});let i=t&&t.serialize,s;if(s=i?i(e,t):Oe.isURLSearchParams(e)?e.toString():new qA(e,t).toString(n),s){let o=r.indexOf("#");o!==-1&&(r=r.slice(0,o)),r+=(r.indexOf("?")===-1?"?":"&")+s}return r}g2.append=function(r,e){this._pairs.push([r,e])},g2.toString=function(r){let e=r?function(t){return r.call(this,t,E2)}:E2;return this._pairs.map(function(t){return e(t[0])+"="+e(t[1])},"").join("&")};var T2=class{constructor(){this.handlers=[]}use(r,e,t){return this.handlers.push({fulfilled:r,rejected:e,synchronous:!!t&&t.synchronous,runWhen:t?t.runWhen:null}),this.handlers.length-1}eject(r){this.handlers[r]&&(this.handlers[r]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(r){Oe.forEach(this.handlers,function(e){e!==null&&r(e)})}},v2={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},y2={exports:{}},IK=Ut,AK=Xe,R2=os.f;IK({target:"Object",stat:!0,forced:Object.defineProperty!==R2,sham:!AK},{defineProperty:R2});var C2=xn.Object,wK=y2.exports=function(r,e,t){return C2.defineProperty(r,e,t)};C2.defineProperty.sham&&(wK.sham=!0);var b2=S(y2.exports),OK=TypeError,I2=tl,NK=$f,DK=vn,PK=Fn("species"),A2=Array,kK=function(r){var e;return I2(r)&&(e=r.constructor,(NK(e)&&(e===A2||I2(e.prototype))||DK(e)&&(e=e[PK])===null)&&(e=void 0)),e===void 0?A2:e},w2=function(r,e){return new(kK(r))(e===0?0:e)},LK=y,MK=wr,UK=Fn("species"),O2=function(r){return MK>=51||!LK(function(){var e=[];return(e.constructor={})[UK]=function(){return{foo:1}},e[r](Boolean).foo!==1})},xK=Ut,VK=y,FK=tl,BK=vn,jK=Ao,GK=Vr,N2=function(r){if(r>9007199254740991)throw OK("Maximum allowed index exceeded");return r},D2=dA,WK=w2,HK=O2,KK=wr,P2=Fn("isConcatSpreadable"),zK=KK>=51||!VK(function(){var r=[];return r[P2]=!1,r.concat()[0]!==r}),YK=function(r){if(!BK(r))return!1;var e=r[P2];return e!==void 0?!!e:FK(r)};xK({target:"Array",proto:!0,forced:!zK||!HK("concat")},{concat:function(r){var e,t,n,i,s,o=jK(this),c=WK(o,0),d=0;for(e=-1,n=arguments.length;e<n;e++)if(YK(s=e===-1?o:arguments[e]))for(i=GK(s),N2(d+i),t=0;t<i;t++,d++)t in s&&D2(c,d,s[t]);else N2(d+1),D2(c,d++,s);return c.length=d,c}});var k2={},qK=Te,XK=Gi,L2=xl.f,JK=Do,M2=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];k2.f=function(r){return M2&&qK(r)==="Window"?(function(e){try{return L2(e)}catch{return JK(M2)}})(r):L2(XK(r))};var zp={},QK=Fn;zp.f=QK;var U2=xn,ZK=bi,$K=zp,e9=os.f,ki=function(r){var e=U2.Symbol||(U2.Symbol={});ZK(e,r)||e9(e,r,{value:$K.f(r)})},t9=Je,n9=Rn,i9=Fn,r9=Vs,x2=function(){var r=n9("Symbol"),e=r&&r.prototype,t=e&&e.valueOf,n=i9("toPrimitive");e&&!e[n]&&r9(e,n,function(i){return t9(t,this)},{})},s9=aa,o9=si,a9=Ao,c9=Vr,l9=w2;J([].push);var F3=function(r){return function(e,t,n,i){for(var s,o,c=a9(e),d=o9(c),u=c9(d),p=s9(t,n),m=0,g=i||l9,T=void 0;u>m;m++)m in d&&(o=p(s=d[m],m,c));return T}},B3={forEach:F3(0)},XA=Ut,wg=oe,lv=Je,V2=J,XR=Xe,Yp=eo,JR=y,Ec=bi,gc=ee,F2=lr,QR=Gi,ZR=hc,B2=Fr,j2=xt,Og=Zd,dv=fp,j3=xl,G3=k2,W3=Qd,H3=me,G2=os,K3=pp,z3=mt,W2=Vs,Y3=as,H2=Bo,tD=Oo,K2=Ol,q3=Fn,d9=zp,u9=ki,h9=x2,p9=ya,X3=$a,JA=B3.forEach,xc=ps("hidden"),Vc="Symbol",Ng="prototype",QA=X3.set,J3=X3.getterFor(Vc),hh=Object[Ng],Fc=wg.Symbol,p_=Fc&&Fc[Ng],nD=wg.RangeError,f9=wg.TypeError,z2=wg.QObject,iD=H3.f,Dg=G2.f,Pg=G3.f,Q3=z3.f,Z3=V2([].push),f_=H2("symbols"),hu=H2("op-symbols"),ZA=H2("wks"),Y2=!z2||!z2[Ng]||!z2[Ng].findChild,rD=function(r,e,t){var n=iD(hh,e);n&&delete hh[e],Dg(r,e,t),n&&r!==hh&&Dg(hh,e,n)},sD=XR&&JR(function(){return Og(Dg({},"a",{get:function(){return Dg(this,"a",{value:7}).a}})).a!==7})?rD:Dg,$A=function(r,e){var t=f_[r]=Og(p_);return QA(t,{type:Vc,tag:r,description:e}),XR||(t.description=e),t},$R=function(r,e,t){r===hh&&$R(hu,e,t),F2(r);var n=ZR(e);return F2(t),Ec(f_,n)?(t.enumerable?(Ec(r,xc)&&r[xc][n]&&(r[xc][n]=!1),t=Og(t,{enumerable:j2(0,!1)})):(Ec(r,xc)||Dg(r,xc,j2(1,Og(null))),r[xc][n]=!0),sD(r,n,t)):Dg(r,n,t)},eC=function(r,e){F2(r);var t=QR(e),n=dv(t).concat(J2(t));return JA(n,function(i){XR&&!lv(oD,t,i)||$R(r,i,t[i])}),r},oD=function(r){var e=ZR(r),t=lv(Q3,this,e);return!(this===hh&&Ec(f_,e)&&!Ec(hu,e))&&(!(t||!Ec(this,e)||!Ec(f_,e)||Ec(this,xc)&&this[xc][e])||t)},q2=function(r,e){var t=QR(r),n=ZR(e);if(t!==hh||!Ec(f_,n)||Ec(hu,n)){var i=iD(t,n);return!i||!Ec(f_,n)||Ec(t,xc)&&t[xc][n]||(i.enumerable=!0),i}},X2=function(r){var e=Pg(QR(r)),t=[];return JA(e,function(n){Ec(f_,n)||Ec(tD,n)||Z3(t,n)}),t},J2=function(r){var e=r===hh,t=Pg(e?hu:QR(r)),n=[];return JA(t,function(i){!Ec(f_,i)||e&&!Ec(hh,i)||Z3(n,f_[i])}),n};Yp||(Fc=function(){if(gc(p_,this))throw new f9("Symbol is not a constructor");var r=arguments.length&&arguments[0]!==void 0?B2(arguments[0]):void 0,e=K2(r),t=function(n){var i=this===void 0?wg:this;i===hh&&lv(t,hu,n),Ec(i,xc)&&Ec(i[xc],e)&&(i[xc][e]=!1);var s=j2(1,n);try{sD(i,e,s)}catch(o){if(!(o instanceof nD))throw o;rD(i,e,s)}};return XR&&Y2&&sD(hh,e,{configurable:!0,set:t}),$A(e,r)},W2(p_=Fc[Ng],"toString",function(){return J3(this).tag}),W2(Fc,"withoutSetter",function(r){return $A(K2(r),r)}),z3.f=oD,G2.f=$R,K3.f=eC,H3.f=q2,j3.f=G3.f=X2,W3.f=J2,d9.f=function(r){return $A(q3(r),r)},XR&&Y3(p_,"description",{configurable:!0,get:function(){return J3(this).description}})),XA({global:!0,wrap:!0,forced:!Yp,sham:!Yp},{Symbol:Fc}),JA(dv(ZA),function(r){u9(r)}),XA({target:Vc,stat:!0,forced:!Yp},{useSetter:function(){Y2=!0},useSimple:function(){Y2=!1}}),XA({target:"Object",stat:!0,forced:!Yp,sham:!XR},{create:function(r,e){return e===void 0?Og(r):eC(Og(r),e)},defineProperty:$R,defineProperties:eC,getOwnPropertyDescriptor:q2}),XA({target:"Object",stat:!0,forced:!Yp},{getOwnPropertyNames:X2}),h9(),p9(Fc,Vc),tD[xc]=!0;var Q2=eo&&!!Symbol.for&&!!Symbol.keyFor,$3=Ut,_9=Rn,m9=bi,E9=Fr,e5=Bo,t5=Q2,Z2=e5("string-to-symbol-registry"),$2=e5("symbol-to-string-registry");$3({target:"Symbol",stat:!0,forced:!t5},{for:function(r){var e=E9(r);if(m9(Z2,e))return Z2[e];var t=_9("Symbol")(e);return Z2[e]=t,$2[t]=e,t}});var g9=Ut,S9=bi,T9=Fo,v9=Ts,y9=Q2,n5=Bo("symbol-to-string-registry");g9({target:"Symbol",stat:!0,forced:!y9},{keyFor:function(r){if(!T9(r))throw new TypeError(v9(r)+" is not a symbol");if(S9(n5,r))return n5[r]}});var eU=tl,i5=$,r5=Te,s5=Fr,o5=J([].push),a5=Ut,c5=Rn,tU=Ae,l5=Je,ew=J,tC=y,nU=$,iU=Fo,rU=Do,d5=function(r){if(i5(r))return r;if(eU(r)){for(var e=r.length,t=[],n=0;n<e;n++){var i=r[n];typeof i=="string"?o5(t,i):typeof i!="number"&&r5(i)!=="Number"&&r5(i)!=="String"||o5(t,s5(i))}var s=t.length,o=!0;return function(c,d){if(o)return o=!1,d;if(eU(this))return d;for(var u=0;u<s;u++)if(t[u]===c)return d}}},R9=eo,C9=String,kg=c5("JSON","stringify"),qp=ew(/./.exec),tw=ew("".charAt),u5=ew("".charCodeAt),b9=ew("".replace),I9=ew(1 .toString),A9=/[\uD800-\uDFFF]/g,h5=/^[\uD800-\uDBFF]$/,sU=/^[\uDC00-\uDFFF]$/,oU=!R9||tC(function(){var r=c5("Symbol")("stringify detection");return kg([r])!=="[null]"||kg({a:r})!=="{}"||kg(Object(r))!=="{}"}),aU=tC(function(){return kg("\uDF06\uD834")!=='"\\udf06\\ud834"'||kg("\uDEAD")!=='"\\udead"'}),p5=function(r,e){var t=rU(arguments),n=d5(e);if(nU(n)||r!==void 0&&!iU(r))return t[1]=function(i,s){if(nU(n)&&(s=l5(n,this,C9(i),s)),!iU(s))return s},tU(kg,null,t)},w9=function(r,e,t){var n=tw(t,e-1),i=tw(t,e+1);return qp(h5,r)&&!qp(sU,i)||qp(sU,r)&&!qp(h5,n)?"\\u"+I9(u5(r,0),16):r};kg&&a5({target:"JSON",stat:!0,forced:oU||aU},{stringify:function(r,e,t){var n=rU(arguments),i=tU(oU?p5:kg,null,n);return aU&&typeof i=="string"?b9(i,A9,w9):i}});var f5=Qd,_5=Ao;Ut({target:"Object",stat:!0,forced:!eo||y(function(){f5.f(1)})},{getOwnPropertySymbols:function(r){var e=f5.f;return e?e(_5(r)):[]}}),ki("asyncIterator"),ki("hasInstance"),ki("isConcatSpreadable"),ki("iterator"),ki("match"),ki("matchAll"),ki("replace"),ki("search"),ki("species"),ki("split");var O9=x2;ki("toPrimitive"),O9();var N9=Rn,D9=ya;ki("toStringTag"),D9(N9("Symbol"),"Symbol"),ki("unscopables"),ya(oe.JSON,"JSON",!0);var P9=xn.Symbol,k9=Fn,L9=os.f,m5=k9("metadata"),cU=Function.prototype;cU[m5]===void 0&&L9(cU,m5,{value:null}),ki("asyncDispose"),ki("dispose"),ki("metadata");var E5=P9,M9=J,lU=Rn("Symbol"),dU=lU.keyFor,U9=M9(lU.prototype.valueOf),g5=lU.isRegisteredSymbol||function(r){try{return dU(U9(r))!==void 0}catch{return!1}};Ut({target:"Symbol",stat:!0},{isRegisteredSymbol:g5});for(var S5=Bo,T5=Rn,v5=J,x9=Fo,V9=Fn,aD=T5("Symbol"),nw=aD.isWellKnownSymbol,uU=T5("Object","getOwnPropertyNames"),y5=v5(aD.prototype.valueOf),R5=S5("wks"),cD=0,lD=uU(aD),C5=lD.length;cD<C5;cD++)try{var b5=lD[cD];x9(aD[b5])&&V9(b5)}catch{}var hU=function(r){if(nw&&nw(r))return!0;try{for(var e=y5(r),t=0,n=uU(R5),i=n.length;t<i;t++)if(R5[n[t]]==e)return!0}catch{}return!1};Ut({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:hU}),ki("customMatcher"),ki("observable"),Ut({target:"Symbol",stat:!0},{isRegistered:g5}),Ut({target:"Symbol",stat:!0,forced:!0},{isWellKnown:hU}),ki("matcher"),ki("metadataKey"),ki("patternMatch"),ki("replaceAll");var uv=S(E5),hv=S(zp.f("iterator"));function nC(r){return nC=typeof uv=="function"&&typeof hv=="symbol"?function(e){return typeof e}:function(e){return e&&typeof uv=="function"&&e.constructor===uv&&e!==uv.prototype?"symbol":typeof e},nC(r)}var iw=S(zp.f("toPrimitive"));function F9(r){var e=(function(t,n){if(nC(t)!="object"||!t)return t;var i=t[iw];if(i!==void 0){var s=i.call(t,n);if(nC(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(t)})(r,"string");return nC(e)=="symbol"?e:e+""}function Z(r,e,t){return(e=F9(e))in r?b2(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var Q=S(EH),I5={isBrowser:!0,classes:{URLSearchParams:Q!==void 0?Q:qA,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};let pU=typeof window<"u"&&typeof document<"u",rw=typeof navigator=="object"&&navigator||void 0,fU=pU&&(!rw||["ReactNative","NativeScript","NS"].indexOf(rw.product)<0),B9=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",j9=pU&&window.location.href||"http://localhost";function A5(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function _U(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?A5(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):A5(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var Bc=_U(_U({},Object.freeze({__proto__:null,hasBrowserEnv:pU,hasStandardBrowserEnv:fU,hasStandardBrowserWebWorkerEnv:B9,navigator:rw,origin:j9})),I5),dl=lr,G9=Je,W9=bi,H9=ee,K9=function(){var r=dl(this),e="";return r.hasIndices&&(e+="d"),r.global&&(e+="g"),r.ignoreCase&&(e+="i"),r.multiline&&(e+="m"),r.dotAll&&(e+="s"),r.unicode&&(e+="u"),r.unicodeSets&&(e+="v"),r.sticky&&(e+="y"),e},w5=RegExp.prototype,mU=function(r){var e=r.flags;return e!==void 0||"flags"in w5||W9(r,"flags")||!H9(w5,r)?e:G9(K9,r)},O5=vm.charAt,N5=Je,D5=lr,z9=$,Y9=Te,q9=/./.exec,X9=TypeError,J9=Ut,P5=Je,EU=ye,k5=ig,dD=Rp,sw=Kn,gU=xs,iC=Fr,ow=lr,Q9=vn,Z9=Te,$9=Ly,L5=mU,M5=ka,ez=y,tz=og,nz=function(r,e,t){return e+(t?O5(r,e).length:1)},iz=function(r,e){var t=r.exec;if(z9(t)){var n=N5(t,r,e);return n!==null&&D5(n),n}if(Y9(r)==="RegExp")return N5(q9,r,e);throw new X9("RegExp#exec called on incompatible receiver")},U5=$a,x5=Fn("matchAll"),V5="RegExp String",SU=V5+" Iterator",F5=U5.set,rz=U5.getterFor(SU),sz=TypeError,TU=EU("".indexOf),rC=EU("".matchAll),sC=!!rC&&!ez(function(){rC("a",/./)}),vU=k5(function(r,e,t,n){F5(this,{type:SU,regexp:r,string:e,global:t,unicode:n,done:!1})},V5,function(){var r=rz(this);if(r.done)return dD(void 0,!0);var e=r.regexp,t=r.string,n=iz(e,t);return n===null?(r.done=!0,dD(void 0,!0)):r.global?(iC(n[0])===""&&(e.lastIndex=nz(t,gU(e.lastIndex),r.unicode)),dD(n,!1)):(r.done=!0,dD(n,!1))}),B5=function(r){var e,t,n,i=ow(this),s=iC(r),o=tz(i,RegExp),c=iC(L5(i));return e=new o(o===RegExp?i.source:i,c),t=!!~TU(c,"g"),n=!!~TU(c,"u"),e.lastIndex=gU(i.lastIndex),new vU(e,s,t,n)};J9({target:"String",proto:!0,forced:sC},{matchAll:function(r){var e,t,n,i,s=sw(this);if(Q9(r)){if($9(r)&&(e=iC(sw(L5(r))),!~TU(e,"g")))throw new sz("`.matchAll` does not allow non-global regexes");if(sC)return rC(s,r);if((n=M5(r,x5))===void 0&&Z9(r)==="RegExp"&&(n=B5),n)return P5(n,r,s)}else if(sC)return rC(s,r);return t=iC(s),i=new RegExp(r,"g"),P5(B5,i,t)}});var j5=to("String","matchAll"),oz=ee,az=j5,yU=String.prototype,RU=function(r){var e=r.matchAll;return typeof r=="string"||r===yU||oz(yU,r)&&e===yU.matchAll?az:e},cz=S(RU);function G5(r){function e(t,n,i,s){let o=t[s++];if(o==="__proto__")return!0;let c=Number.isFinite(+o),d=s>=t.length;return o=!o&&Oe.isArray(i)?i.length:o,d?(Oe.hasOwnProp(i,o)?i[o]=[i[o],n]:i[o]=n,!c):(i[o]&&Oe.isObject(i[o])||(i[o]=[]),e(t,n,i[o],s)&&Oe.isArray(i[o])&&(i[o]=(function(u){let p={},m=Object.keys(u),g,T=m.length,R;for(g=0;g<T;g++)R=m[g],p[R]=u[R];return p})(i[o])),!c)}if(Oe.isFormData(r)&&Oe.isFunction(r.entries)){let t={};return Oe.forEachEntry(r,(n,i)=>{e((function(s){return cz(Oe).call(Oe,/\w+|\[(\w*)]/g,s).map(o=>o[0]==="[]"?"":o[1]||o[0])})(n),i,t,0)}),t}return null}let uD={transitional:v2,adapter:["xhr","http","fetch"],transformRequest:[function(r,e){let t=e.getContentType()||"",n=t.indexOf("application/json")>-1,i=Oe.isObject(r);if(i&&Oe.isHTMLForm(r)&&(r=new FormData(r)),Oe.isFormData(r))return n?JSON.stringify(G5(r)):r;if(Oe.isArrayBuffer(r)||Oe.isBuffer(r)||Oe.isStream(r)||Oe.isFile(r)||Oe.isBlob(r)||Oe.isReadableStream(r))return r;if(Oe.isArrayBufferView(r))return r.buffer;if(Oe.isURLSearchParams(r))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),r.toString();let s;if(i){if(t.indexOf("application/x-www-form-urlencoded")>-1)return(function(o,c){return cv(o,new Bc.classes.URLSearchParams,Object.assign({visitor:function(d,u,p,m){return Bc.isNode&&Oe.isBuffer(d)?(this.append(u,d.toString("base64")),!1):m.defaultVisitor.apply(this,arguments)}},c))})(r,this.formSerializer).toString();if((s=Oe.isFileList(r))||t.indexOf("multipart/form-data")>-1){let o=this.env&&this.env.FormData;return cv(s?{"files[]":r}:r,o&&new o,this.formSerializer)}}return i||n?(e.setContentType("application/json",!1),(function(o,c,d){if(Oe.isString(o))try{return(c||JSON.parse)(o),dr(Oe).call(Oe,o)}catch(u){if(u.name!=="SyntaxError")throw u}return(d||JSON.stringify)(o)})(r)):r}],transformResponse:[function(r){let e=this.transitional||uD.transitional,t=e&&e.forcedJSONParsing,n=this.responseType==="json";if(Oe.isResponse(r)||Oe.isReadableStream(r))return r;if(r&&Oe.isString(r)&&(t&&!this.responseType||n)){let i=!(e&&e.silentJSONParsing)&&n;try{return JSON.parse(r)}catch(s){if(i)throw s.name==="SyntaxError"?Jt.from(s,Jt.ERR_BAD_RESPONSE,this,null,this.response):s}}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Bc.classes.FormData,Blob:Bc.classes.Blob},validateStatus:function(r){return r>=200&&r<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Oe.forEach(["delete","get","head","post","put","patch"],r=>{uD.headers[r]={}});var aw=uD;let CU=Oe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),W5=Symbol("internals");function oC(r){var e;return r&&dr(e=String(r)).call(e).toLowerCase()}function Lg(r){return r===!1||r==null?r:Oe.isArray(r)?r.map(Lg):String(r)}function aC(r,e,t,n,i){return Oe.isFunction(n)?n.call(this,e,t):(i&&(e=t),Oe.isString(e)?Oe.isString(n)?e.indexOf(n)!==-1:Oe.isRegExp(n)?n.test(e):void 0:void 0)}class cC{constructor(e){e&&this.set(e)}set(e,t,n){let i=this;function s(d,u,p){let m=oC(u);if(!m)throw new Error("header name must be a non-empty string");let g=Oe.findKey(i,m);(!g||i[g]===void 0||p===!0||p===void 0&&i[g]!==!1)&&(i[g||u]=Lg(d))}let o=(d,u)=>Oe.forEach(d,(p,m)=>s(p,m,u));if(Oe.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(Oe.isString(e)&&(e=dr(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(dr(c=e).call(c)))o((d=>{let u={},p,m,g;return d&&d.split(`
`).forEach(function(T){var R,I;g=T.indexOf(":"),p=dr(R=T.substring(0,g)).call(R).toLowerCase(),m=dr(I=T.substring(g+1)).call(I),!p||u[p]&&CU[p]||(p==="set-cookie"?u[p]?u[p].push(m):u[p]=[m]:u[p]=u[p]?u[p]+", "+m:m)}),u})(e),t);else if(Oe.isObject(e)&&Oe.isIterable(e)){let d,u,p={};for(let m of e){if(!Oe.isArray(m))throw TypeError("Object iterator must return a key-value pair");p[u=m[0]]=(d=p[u])?Oe.isArray(d)?[...d,m[1]]:[d,m[1]]:m[1]}o(p,t)}else e!=null&&s(t,e,n);var c;return this}get(e,t){if(e=oC(e)){let n=Oe.findKey(this,e);if(n){let i=this[n];if(!t)return i;if(t===!0)return(function(s){let o=Object.create(null),c=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,d;for(;d=c.exec(s);)o[d[1]]=d[2];return o})(i);if(Oe.isFunction(t))return t.call(this,i,n);if(Oe.isRegExp(t))return t.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=oC(e)){let n=Oe.findKey(this,e);return!(!n||this[n]===void 0||t&&!aC(0,this[n],n,t))}return!1}delete(e,t){let n=this,i=!1;function s(o){if(o=oC(o)){let c=Oe.findKey(n,o);!c||t&&!aC(0,n[c],c,t)||(delete n[c],i=!0)}}return Oe.isArray(e)?e.forEach(s):s(e),i}clear(e){let t=Object.keys(this),n=t.length,i=!1;for(;n--;){let s=t[n];e&&!aC(0,this[s],s,e,!0)||(delete this[s],i=!0)}return i}normalize(e){let t=this,n={};return Oe.forEach(this,(i,s)=>{var o;let c=Oe.findKey(n,s);if(c)return t[c]=Lg(i),void delete t[s];let d=e?(function(u){return dr(u).call(u).toLowerCase().replace(/([a-z\d])(\w*)/g,(p,m,g)=>m.toUpperCase()+g)})(s):dr(o=String(s)).call(o);d!==s&&delete t[s],t[d]=Lg(i),n[d]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.constructor.concat(this,...t)}toJSON(e){let t=Object.create(null);return Oe.forEach(this,(n,i)=>{n!=null&&n!==!1&&(t[i]=e&&Oe.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,n]=e;return t+": "+n}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){let t=new this(e);for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];return i.forEach(o=>t.set(o)),t}static accessor(e){let t=(this[W5]=this[W5]={accessors:{}}).accessors,n=this.prototype;function i(s){let o=oC(s);t[o]||((function(c,d){let u=Oe.toCamelCase(" "+d);["get","set","has"].forEach(p=>{Object.defineProperty(c,p+u,{value:function(m,g,T){return this[p].call(this,d,m,g,T)},configurable:!0})})})(n,s),t[o]=!0)}return Oe.isArray(e)?e.forEach(i):i(e),this}}cC.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),Oe.reduceDescriptors(cC.prototype,(r,e)=>{let{value:t}=r,n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(i){this[n]=i}}}),Oe.freezeMethods(cC);var Rd=cC;function pu(r,e){let t=this||aw,n=e||t,i=Rd.from(n.headers),s=n.data;return Oe.forEach(r,function(o){s=o.call(t,s,i.normalize(),e?e.status:void 0)}),i.normalize(),s}function hD(r){return!(!r||!r.__CANCEL__)}function pv(r,e,t){Jt.call(this,r??"canceled",Jt.ERR_CANCELED,e,t),this.name="CanceledError"}function fv(r,e,t){let n=t.config.validateStatus;t.status&&n&&!n(t.status)?e(new Jt("Request failed with status code "+t.status,[Jt.ERR_BAD_REQUEST,Jt.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t)):r(t)}Oe.inherits(pv,Jt,{__CANCEL__:!0});let cw=function(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=0,i=(function(s,o){s=s||10;let c=new Array(s),d=new Array(s),u,p=0,m=0;return o=o!==void 0?o:1e3,function(g){let T=Date.now(),R=d[m];u||(u=T),c[p]=g,d[p]=T;let I=m,A=0;for(;I!==p;)A+=c[I++],I%=s;if(p=(p+1)%s,p===m&&(m=(m+1)%s),T-u<o)return;let w=R&&T-R;return w?Math.round(1e3*A/w):void 0}})(50,250);return(function(s,o){let c,d,u=0,p=1e3/o,m=function(g){u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),c=null,d&&(clearTimeout(d),d=null),s.apply(null,g)};return[function(){let g=Date.now(),T=g-u;for(var R=arguments.length,I=new Array(R),A=0;A<R;A++)I[A]=arguments[A];T>=p?m(I,g):(c=I,d||(d=setTimeout(()=>{d=null,m(c)},p-T)))},()=>c&&m(c)]})(s=>{let o=s.loaded,c=s.lengthComputable?s.total:void 0,d=o-n,u=i(d);n=o,r({loaded:o,total:c,progress:c?o/c:void 0,bytes:d,rate:u||void 0,estimated:u&&c&&o<=c?(c-o)/u:void 0,event:s,lengthComputable:c!=null,[e?"download":"upload"]:!0})},t)},lw=(r,e)=>{let t=r!=null;return[n=>e[0]({lengthComputable:t,total:r,loaded:n}),e[1]]},bU=r=>function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Oe.asap(()=>r(...t))};var H5=Bc.hasStandardBrowserEnv?((r,e)=>t=>(t=new XT(t,Bc.origin),r.protocol===t.protocol&&r.host===t.host&&(e||r.port===t.port)))(new XT(Bc.origin),Bc.navigator&&/(msie|trident)/i.test(Bc.navigator.userAgent)):()=>!0,lz=Bc.hasStandardBrowserEnv?{write(r,e,t,n,i,s){let o=[r+"="+encodeURIComponent(e)];Oe.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),Oe.isString(n)&&o.push("path="+n),Oe.isString(i)&&o.push("domain="+i),s===!0&&o.push("secure"),document.cookie=o.join("; ")},read(r){let e=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function K5(r,e,t){let n=!(function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)})(e);return r&&(n||t==0)?(function(i,s){return s?i.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):i})(r,e):e}function IU(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}let AU=r=>r instanceof Rd?(function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?IU(Object(n),!0).forEach(function(i){Z(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):IU(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e})({},r):r;function Mg(r,e){e=e||{};let t={};function n(u,p,m,g){return Oe.isPlainObject(u)&&Oe.isPlainObject(p)?Oe.merge.call({caseless:g},u,p):Oe.isPlainObject(p)?Oe.merge({},p):Oe.isArray(p)?p.slice():p}function i(u,p,m,g){return Oe.isUndefined(p)?Oe.isUndefined(u)?void 0:n(void 0,u,0,g):n(u,p,0,g)}function s(u,p){if(!Oe.isUndefined(p))return n(void 0,p)}function o(u,p){return Oe.isUndefined(p)?Oe.isUndefined(u)?void 0:n(void 0,u):n(void 0,p)}function c(u,p,m){return m in e?n(u,p):m in r?n(void 0,u):void 0}let d={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:c,headers:(u,p,m)=>i(AU(u),AU(p),0,!0)};return Oe.forEach(Object.keys(Object.assign({},r,e)),function(u){let p=d[u]||i,m=p(r[u],e[u],u);Oe.isUndefined(m)&&p!==c||(t[u]=m)}),t}var Ug=r=>{let e=Mg({},r),t,{data:n,withXSRFToken:i,xsrfHeaderName:s,xsrfCookieName:o,headers:c,auth:d}=e;if(e.headers=c=Rd.from(c),e.url=S2(K5(e.baseURL,e.url,e.allowAbsoluteUrls),r.params,r.paramsSerializer),d&&c.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):""))),Oe.isFormData(n)){if(Bc.hasStandardBrowserEnv||Bc.hasStandardBrowserWebWorkerEnv)c.setContentType(void 0);else if((t=c.getContentType())!==!1){let[u,...p]=t?t.split(";").map(m=>dr(m).call(m)).filter(Boolean):[];c.setContentType([u||"multipart/form-data",...p].join("; "))}}if(Bc.hasStandardBrowserEnv&&(i&&Oe.isFunction(i)&&(i=i(e)),i||i!==!1&&H5(e.url))){let u=s&&o&&lz.read(o);u&&c.set(s,u)}return e},z5=typeof XMLHttpRequest<"u"&&function(r){return new De(function(e,t){let n=Ug(r),i=n.data,s=Rd.from(n.headers).normalize(),o,c,d,u,p,{responseType:m,onUploadProgress:g,onDownloadProgress:T}=n;function R(){u&&u(),p&&p(),n.cancelToken&&n.cancelToken.unsubscribe(o),n.signal&&n.signal.removeEventListener("abort",o)}let I=new XMLHttpRequest;function A(){if(!I)return;let k=Rd.from("getAllResponseHeaders"in I&&I.getAllResponseHeaders());fv(function(L){e(L),R()},function(L){t(L),R()},{data:m&&m!=="text"&&m!=="json"?I.response:I.responseText,status:I.status,statusText:I.statusText,headers:k,config:r,request:I}),I=null}I.open(n.method.toUpperCase(),n.url,!0),I.timeout=n.timeout,"onloadend"in I?I.onloadend=A:I.onreadystatechange=function(){I&&I.readyState===4&&(I.status!==0||I.responseURL&&I.responseURL.indexOf("file:")===0)&&setTimeout(A)},I.onabort=function(){I&&(t(new Jt("Request aborted",Jt.ECONNABORTED,r,I)),I=null)},I.onerror=function(){t(new Jt("Network Error",Jt.ERR_NETWORK,r,I)),I=null},I.ontimeout=function(){let k=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded",L=n.transitional||v2;n.timeoutErrorMessage&&(k=n.timeoutErrorMessage),t(new Jt(k,L.clarifyTimeoutError?Jt.ETIMEDOUT:Jt.ECONNABORTED,r,I)),I=null},i===void 0&&s.setContentType(null),"setRequestHeader"in I&&Oe.forEach(s.toJSON(),function(k,L){I.setRequestHeader(L,k)}),Oe.isUndefined(n.withCredentials)||(I.withCredentials=!!n.withCredentials),m&&m!=="json"&&(I.responseType=n.responseType),T&&([d,p]=cw(T,!0),I.addEventListener("progress",d)),g&&I.upload&&([c,u]=cw(g),I.upload.addEventListener("progress",c),I.upload.addEventListener("loadend",u)),(n.cancelToken||n.signal)&&(o=k=>{I&&(t(!k||k.type?new pv(null,r,I):k),I.abort(),I=null)},n.cancelToken&&n.cancelToken.subscribe(o),n.signal&&(n.signal.aborted?o():n.signal.addEventListener("abort",o)));let w=(function(k){let L=/^([-+\w]{1,25})(:?\/\/|:)/.exec(k);return L&&L[1]||""})(n.url);w&&Bc.protocols.indexOf(w)===-1?t(new Jt("Unsupported protocol "+w+":",Jt.ERR_BAD_REQUEST,r)):I.send(i||null)})},dz=(r,e)=>{let{length:t}=r=r?r.filter(Boolean):[];if(e||t){let n,i=new AbortController,s=function(u){if(!n){n=!0,c();let p=u instanceof Error?u:this.reason;i.abort(p instanceof Jt?p:new pv(p instanceof Error?p.message:p))}},o=e&&setTimeout(()=>{o=null,s(new Jt("timeout ".concat(e," of ms exceeded"),Jt.ETIMEDOUT))},e),c=()=>{r&&(o&&clearTimeout(o),o=null,r.forEach(u=>{u.unsubscribe?u.unsubscribe(s):u.removeEventListener("abort",s)}),r=null)};r.forEach(u=>u.addEventListener("abort",s));let{signal:d}=i;return d.unsubscribe=()=>Oe.asap(c),d}},wU=S(bg),pD=zp.f("asyncIterator"),Y5=S(pD);function OU(r,e){this.v=r,this.k=e}function zl(r){return function(){return new jc(r.apply(this,arguments))}}function jc(r){var e,t;function n(s,o){try{var c=r[s](o),d=c.value,u=d instanceof OU;wU.resolve(u?d.v:d).then(function(p){if(u){var m=s==="return"?"return":"next";if(!d.k||p.done)return n(m,p);p=r[m](p).value}i(c.done?"return":"normal",p)},function(p){n("throw",p)})}catch(p){i("throw",p)}}function i(s,o){switch(s){case"return":e.resolve({value:o,done:!0});break;case"throw":e.reject(o);break;default:e.resolve({value:o,done:!1})}(e=e.next)?n(e.key,e.arg):t=null}this._invoke=function(s,o){return new wU(function(c,d){var u={key:s,arg:o,resolve:c,reject:d,next:null};t?t=t.next=u:(e=t=u,n(s,o))})},typeof r.return!="function"&&(this.return=void 0)}function zn(r){return new OU(r,0)}function Jn(r){var e={},t=!1;function n(i,s){return t=!0,s=new wU(function(o){o(r[i](s))}),{done:!1,value:new OU(s,1)}}return e[uv!==void 0&&hv||"@@iterator"]=function(){return this},e.next=function(i){return t?(t=!1,i):n("next",i)},typeof r.throw=="function"&&(e.throw=function(i){if(t)throw t=!1,i;return n("throw",i)}),typeof r.return=="function"&&(e.return=function(i){return t?(t=!1,i):n("return",i)}),e}jc.prototype[typeof uv=="function"&&Y5||"@@asyncIterator"]=function(){return this},jc.prototype.next=function(r){return this._invoke("next",r)},jc.prototype.throw=function(r){return this._invoke("throw",r)},jc.prototype.return=function(r){return this._invoke("return",r)};var lC=S(pD);function dw(r){var e,t,n,i=2;for(typeof Symbol<"u"&&(t=lC,n=Symbol.iterator);i--;){if(t&&(e=r[t])!=null)return e.call(r);if(n&&(e=r[n])!=null)return new dC(e.call(r));t="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function dC(r){function e(t){if(Object(t)!==t)return De.reject(new TypeError(t+" is not an object."));var n=t.done;return De.resolve(t.value).then(function(i){return{value:i,done:n}})}return dC=function(t){this.s=t,this.n=t.next},dC.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var n=this.s.return;return n===void 0?De.resolve({value:t,done:!0}):e(n.apply(this.s,arguments))},throw:function(t){var n=this.s.return;return n===void 0?De.reject(t):e(n.apply(this.s,arguments))}},new dC(r)}let fD=function*(r,e){let t=r.byteLength;if(!e||t<e)return void(yield r);let n,i=0;for(;i<t;)n=i+e,yield r.slice(i,n),i=n},uz=(function(){var r=zl(function*(e,t){var n,i=!1,s=!1;try{for(var o,c=dw(hz(e));i=!(o=yield zn(c.next())).done;i=!1){let d=o.value;yield*Jn(dw(fD(d,t)))}}catch(d){s=!0,n=d}finally{try{i&&c.return!=null&&(yield zn(c.return()))}finally{if(s)throw n}}});return function(e,t){return r.apply(this,arguments)}})(),hz=(function(){var r=zl(function*(e){if(e[lC])return void(yield*Jn(dw(e)));let t=e.getReader();try{for(;;){let{done:n,value:i}=yield zn(t.read());if(n)break;yield i}}finally{yield zn(t.cancel())}});return function(e){return r.apply(this,arguments)}})(),q5=(r,e,t,n)=>{let i=uz(r,e),s,o=0,c=d=>{s||(s=!0,n&&n(d))};return new ReadableStream({async pull(d){try{let{done:u,value:p}=await i.next();if(u)return c(),void d.close();let m=p.byteLength;if(t){let g=o+=m;t(g)}d.enqueue(new Uint8Array(p))}catch(u){throw c(u),u}},cancel:d=>(c(d),i.return())},{highWaterMark:2})};function NU(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function DU(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?NU(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):NU(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}let uw=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",hw=uw&&typeof ReadableStream=="function",X5=uw&&(typeof TextEncoder=="function"?(J5=new TextEncoder,r=>J5.encode(r)):async r=>new Uint8Array(await new Response(r).arrayBuffer()));var J5;let PU=function(r){try{for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return!!r(...t)}catch{return!1}},Q5=hw&&PU(()=>{let r=!1,e=new Request(Bc.origin,{body:new ReadableStream,method:"POST",get duplex(){return r=!0,"half"}}).headers.has("Content-Type");return r&&!e}),kU=hw&&PU(()=>Oe.isReadableStream(new Response("").body)),uC={stream:kU&&(r=>r.body)};var pw;uw&&(pw=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(r=>{!uC[r]&&(uC[r]=Oe.isFunction(pw[r])?e=>e[r]():(e,t)=>{throw new Jt("Response type '".concat(r,"' is not supported"),Jt.ERR_NOT_SUPPORT,t)})}));let Z5=async(r,e)=>Oe.toFiniteNumber(r.getContentLength())??(async n=>n==null?0:Oe.isBlob(n)?n.size:Oe.isSpecCompliantForm(n)?(await new Request(Bc.origin,{method:"POST",body:n}).arrayBuffer()).byteLength:Oe.isArrayBufferView(n)||Oe.isArrayBuffer(n)?n.byteLength:(Oe.isURLSearchParams(n)&&(n+=""),Oe.isString(n)?(await X5(n)).byteLength:void 0))(e);var pz=uw&&(async r=>{let{url:e,method:t,data:n,signal:i,cancelToken:s,timeout:o,onDownloadProgress:c,onUploadProgress:d,responseType:u,headers:p,withCredentials:m="same-origin",fetchOptions:g}=Ug(r);u=u?(u+"").toLowerCase():"text";let T,R=dz([i,s&&s.toAbortSignal()],o),I=R&&R.unsubscribe&&(()=>{R.unsubscribe()}),A;try{if(d&&Q5&&t!=="get"&&t!=="head"&&(A=await Z5(p,n))!==0){let K,W=new Request(e,{method:"POST",body:n,duplex:"half"});if(Oe.isFormData(n)&&(K=W.headers.get("content-type"))&&p.setContentType(K),W.body){let[Y,se]=lw(A,cw(bU(d)));n=q5(W.body,65536,Y,se)}}Oe.isString(m)||(m=m?"include":"omit");let w="credentials"in Request.prototype;T=new Request(e,DU(DU({},g),{},{signal:R,method:t.toUpperCase(),headers:p.normalize().toJSON(),body:n,duplex:"half",credentials:w?m:void 0}));let k=await fetch(T),L=kU&&(u==="stream"||u==="response");if(kU&&(c||L&&I)){let K={};["status","statusText","headers"].forEach(de=>{K[de]=k[de]});let W=Oe.toFiniteNumber(k.headers.get("content-length")),[Y,se]=c&&lw(W,cw(bU(c),!0))||[];k=new Response(q5(k.body,65536,Y,()=>{se&&se(),I&&I()}),K)}u=u||"text";let j=await uC[Oe.findKey(uC,u)||"text"](k,r);return!L&&I&&I(),await new De((K,W)=>{fv(K,W,{data:j,headers:Rd.from(k.headers),status:k.status,statusText:k.statusText,config:r,request:T})})}catch(w){throw I&&I(),w&&w.name==="TypeError"&&/Load failed|fetch/i.test(w.message)?Object.assign(new Jt("Network Error",Jt.ERR_NETWORK,r,T),{cause:w.cause||w}):Jt.from(w,w&&w.code,r,T)}});let LU={http:null,xhr:z5,fetch:pz};Oe.forEach(LU,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});let _D=r=>"- ".concat(r),$5=r=>Oe.isFunction(r)||r===null||r===!1;var e4={getAdapter:r=>{r=Oe.isArray(r)?r:[r];let{length:e}=r,t,n,i={};for(let s=0;s<e;s++){let o;if(t=r[s],n=t,!$5(t)&&(n=LU[(o=String(t)).toLowerCase()],n===void 0))throw new Jt("Unknown adapter '".concat(o,"'"));if(n)break;i[o||"#"+s]=n}if(!n){let s=Object.entries(i).map(o=>{let[c,d]=o;return"adapter ".concat(c," ")+(d===!1?"is not supported by the environment":"is not available in the build")});throw new Jt("There is no suitable adapter to dispatch the request "+(e?s.length>1?`since :
`+s.map(_D).join(`
`):" "+_D(s[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n},adapters:LU};function mD(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new pv(null,r)}function ED(r){return mD(r),r.headers=Rd.from(r.headers),r.data=pu.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),e4.getAdapter(r.adapter||aw.adapter)(r).then(function(e){return mD(r),e.data=pu.call(r,r.transformResponse,e),e.headers=Rd.from(e.headers),e},function(e){return hD(e)||(mD(r),e&&e.response&&(e.response.data=pu.call(r,r.transformResponse,e.response),e.response.headers=Rd.from(e.response.headers))),De.reject(e)})}let MU="1.9.0",fw={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{fw[r]=function(t){return typeof t===r||"a"+(e<1?"n ":" ")+r}});let _w={};fw.transitional=function(r,e,t){function n(i,s){return"[Axios v"+MU+"] Transitional option '"+i+"'"+s+(t?". "+t:"")}return(i,s,o)=>{if(r===!1)throw new Jt(n(s," has been removed"+(e?" in "+e:"")),Jt.ERR_DEPRECATED);return e&&!_w[s]&&(_w[s]=!0,console.warn(n(s," has been deprecated since v"+e+" and will be removed in the near future"))),!r||r(i,s,o)}},fw.spelling=function(r){return(e,t)=>(console.warn("".concat(t," is likely a misspelling of ").concat(r)),!0)};var mw={assertOptions:function(r,e,t){if(typeof r!="object")throw new Jt("options must be an object",Jt.ERR_BAD_OPTION_VALUE);let n=Object.keys(r),i=n.length;for(;i-- >0;){let s=n[i],o=e[s];if(o){let c=r[s],d=c===void 0||o(c,s,r);if(d!==!0)throw new Jt("option "+s+" must be "+d,Jt.ERR_BAD_OPTION_VALUE)}else if(t!==!0)throw new Jt("Unknown option "+s,Jt.ERR_BAD_OPTION)}},validators:fw};let fu=mw.validators,_u=class{constructor(r){this.defaults=r||{},this.interceptors={request:new T2,response:new T2}}async request(r,e){try{return await this._request(r,e)}catch(t){if(t instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;let i=n.stack?n.stack.replace(/^.+\n/,""):"";try{t.stack?i&&!String(t.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(t.stack+=`
`+i):t.stack=i}catch{}}throw t}}_request(r,e){typeof r=="string"?(e=e||{}).url=r:e=r||{},e=Mg(this.defaults,e);let{transitional:t,paramsSerializer:n,headers:i}=e;t!==void 0&&mw.assertOptions(t,{silentJSONParsing:fu.transitional(fu.boolean),forcedJSONParsing:fu.transitional(fu.boolean),clarifyTimeoutError:fu.transitional(fu.boolean)},!1),n!=null&&(Oe.isFunction(n)?e.paramsSerializer={serialize:n}:mw.assertOptions(n,{encode:fu.function,serialize:fu.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),mw.assertOptions(e,{baseUrl:fu.spelling("baseURL"),withXsrfToken:fu.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let s=i&&Oe.merge(i.common,i[e.method]);i&&Oe.forEach(["delete","get","head","post","put","patch","common"],T=>{delete i[T]}),e.headers=Rd.concat(s,i);let o=[],c=!0;this.interceptors.request.forEach(function(T){typeof T.runWhen=="function"&&T.runWhen(e)===!1||(c=c&&T.synchronous,o.unshift(T.fulfilled,T.rejected))});let d=[],u;this.interceptors.response.forEach(function(T){d.push(T.fulfilled,T.rejected)});let p,m=0;if(!c){let T=[ED.bind(this),void 0];for(T.unshift.apply(T,o),T.push.apply(T,d),p=T.length,u=De.resolve(e);m<p;)u=u.then(T[m++],T[m++]);return u}p=o.length;let g=e;for(m=0;m<p;){let T=o[m++],R=o[m++];try{g=T(g)}catch(I){R.call(this,I);break}}try{u=ED.call(this,g)}catch(T){return De.reject(T)}for(m=0,p=d.length;m<p;)u=u.then(d[m++],d[m++]);return u}getUri(r){return S2(K5((r=Mg(this.defaults,r)).baseURL,r.url,r.allowAbsoluteUrls),r.params,r.paramsSerializer)}};Oe.forEach(["delete","get","head","options"],function(r){_u.prototype[r]=function(e,t){return this.request(Mg(t||{},{method:r,url:e,data:(t||{}).data}))}}),Oe.forEach(["post","put","patch"],function(r){function e(t){return function(n,i,s){return this.request(Mg(s||{},{method:r,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:i}))}}_u.prototype[r]=e(),_u.prototype[r+"Form"]=e(!0)});var _v=_u;class hC{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new De(function(i){t=i});let n=this;this.promise.then(i=>{if(!n._listeners)return;let s=n._listeners.length;for(;s-- >0;)n._listeners[s](i);n._listeners=null}),this.promise.then=i=>{let s,o=new De(c=>{n.subscribe(c),s=c}).then(i);return o.cancel=function(){n.unsubscribe(s)},o},e(function(i,s,o){n.reason||(n.reason=new pv(i,s,o),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;let t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){let e=new AbortController,t=n=>{e.abort(n)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new hC(function(t){e=t}),cancel:e}}}var UU=hC;let xU={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(xU).forEach(r=>{let[e,t]=r;xU[t]=e});var VU=xU;let Ba=(function r(e){let t=new _v(e),n=n2(_v.prototype.request,t);return Oe.extend(n,_v.prototype,t,{allOwnKeys:!0}),Oe.extend(n,t,null,{allOwnKeys:!0}),n.create=function(i){return r(Mg(e,i))},n})(aw);Ba.Axios=_v,Ba.CanceledError=pv,Ba.CancelToken=UU,Ba.isCancel=hD,Ba.VERSION=MU,Ba.toFormData=cv,Ba.AxiosError=Jt,Ba.Cancel=Ba.CanceledError,Ba.all=function(r){return De.all(r)},Ba.spread=function(r){return function(e){return r.apply(null,e)}},Ba.isAxiosError=function(r){return Oe.isObject(r)&&r.isAxiosError===!0},Ba.mergeConfig=Mg,Ba.AxiosHeaders=Rd,Ba.formToJSON=r=>G5(Oe.isHTMLForm(r)?new FormData(r):r),Ba.getAdapter=e4.getAdapter,Ba.HttpStatusCode=VU,Ba.default=Ba;var Er=Ba;let Gc=()=>{};function Ew(){let r={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Gc};return r.promise=new De((e,t)=>{r.resolve=n=>{r.isFinished||(r.isResolved=!0,r.isFinished=!0,e(n),r.value=n)},r.reject=n=>{r.isFinished||(r.isRejected=!0,r.isFinished=!0,t(n))}}),r}let xg=new Map,mv=new Map,mu=new Map,Br=(function(r){return r.WIN_10="Windows 10",r.WIN_81="Windows 8.1",r.WIN_8="Windows 8",r.WIN_7="Windows 7",r.WIN_VISTA="Windows Vista",r.WIN_SERVER_2003="Windows Server 2003",r.WIN_XP="Windows XP",r.WIN_2000="Windows 2000",r.ANDROID="Android",r.HARMONY_OS="HarmonyOS",r.OPEN_BSD="Open BSD",r.SUN_OS="Sun OS",r.LINUX="Linux",r.IOS="iOS",r.MAC_OS="Mac OS",r.CHROMIUM_OS="Chromium OS",r.QNX="QNX",r.UNIX="UNIX",r.BEOS="BeOS",r.OS_2="OS/2",r.SEARCH_BOT="Search Bot",r})({}),sn=(function(r){return r.CHROME="Chrome",r.SAFARI="Safari",r.EDGE="Edge",r.FIREFOX="Firefox",r.OPERA="OPR",r.QQ="QQBrowser",r.WECHAT="MicroMessenger",r})({}),mi=new z8,ph=mi.getResult(),Eu=null;function Qn(r){if(!Eu){ph=mi.getResult();let e=(function(c){if(c.engine.name==="Blink"&&c.browser.name!=="WeChat")return sn.CHROME;switch(c.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return sn.CHROME;case"Safari":case"Mobile Safari":return sn.SAFARI;case"Edge":return sn.EDGE;case"Firefox":return sn.FIREFOX;case"QQ":case"QQBrowser":return sn.QQ;case"Opera":return sn.OPERA;case"WeChat":return sn.WECHAT;default:return c.browser.name||""}})(ph),t=$n(ph),n=(function(c){return c.os.name==="Windows"?c.os.version?c.os.name+" "+c.os.version:c.os.name:c.os.name||""})(ph),i=ph.os.version,s=$n(ph,!1),o=ph.device.type;if(!(e&&t&&n&&i))return{name:e,version:t,os:n,osVersion:i,browserVersion:s,deviceType:o};Eu={name:e,version:t,os:n,osVersion:i,browserVersion:s,deviceType:o}}return Eu}function $n(r){let e,t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return e=r.engine.name==="Blink"?r.engine.version||"":r.browser.version||"",t?e.split(".")[0]:e}function gw(){return Qn().os}function Sw(){let r=Qn();return"".concat(r.os," ").concat(r.osVersion)}function Tw(){let r=Qn();return!!(ph.engine.name==="WebKit"&&r.os===Br.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&r.name!==sn.SAFARI||fi()&&r.name!==sn.SAFARI)}function fh(){return Qn().name===sn.CHROME}function ms(){return Qn().name===sn.SAFARI}function Xo(){let r=Qn();if(r.name!==sn.SAFARI||!r.browserVersion)return!1;let e=r.browserVersion.split(".");return Number(e[0])>15||Number(e[0])===15&&Number(e[1])>=4}function FU(){return Qn().name===sn.EDGE}function jr(){return Qn().name===sn.FIREFOX}function fi(){return Qn().os===Br.IOS}function mo(r){let e=Qn();return!(e.name!==sn.CHROME||!e.osVersion)&&Number(e.version)>=r}function Ev(r){let e=Qn();return!(e.name!==sn.CHROME||!e.osVersion)&&Number(e.version)<r}function gD(r,e,t){let n=Qn();return!(n.name!==r||!n.osVersion)&&(t?Number(n.version)>=e&&Number(n.version)<=t:Number(n.version)===e)}function vw(r){let e=Qn();return!(e.name!==sn.EDGE||!e.osVersion)&&Number(e.version)>=r}function yw(r){let e=Qn();return!(e.name!==sn.FIREFOX||!e.osVersion)&&Number(e.version)>=r}function SD(r){let e=Qn();return!(e.name!==sn.SAFARI||!e.osVersion)&&Number(e.version)>=r}function BU(r,e,t){let n=Qn();if(n.os!==Br.IOS||!n.osVersion)return!1;let i=n.osVersion.split(".");return t?e&&Number(i[0])===r&&Number(i[1])>e||Number(i[0])>r:e?Number(i[0])===r&&Number(i[1])>=e||Number(i[0])>r:Number(i[0])>=r}function jU(r,e,t){let n=Qn();if(n.os!==Br.IOS||!n.osVersion)return!1;let i=n.osVersion.split(".");return e&&Number(i[0])===r&&Number(i[1])<e||Number(i[0])<r}function TD(r,e,t){let n=Qn();if(n.name!==sn.SAFARI||!n.osVersion||!n.browserVersion)return!1;let i=n.browserVersion.split(".");return t?e&&Number(i[0])===r&&Number(i[1])<e||Number(i[0])<r:e?Number(i[0])===r&&Number(i[1])<=e||Number(i[0])<r:Number(i[0])<=r}function Rw(r){let e=Qn();return!(e.name!==sn.OPERA||!e.osVersion)&&Number(e.version)>=r}function vD(){let r=Qn();if(r.os!==Br.IOS||!r.osVersion)return!1;let e=r.osVersion.split(".");return Number(e[0])<14||Number(e[0])===14&&Number(e[1])<=6}function gv(){let r=Qn();if(r.os!==Br.IOS||!r.osVersion)return!1;let e=r.osVersion.split(".");return Number(e[0])===15}function Vg(){let r=Qn();if(r.os!==Br.IOS||!r.osVersion)return!1;let e=r.osVersion.split(".");return Number(e[0])===16}function yD(){let r=Qn();if(r.os!==Br.IOS||!r.osVersion)return!1;let e=r.osVersion.split(".");return Number(e[0])===15&&Number(e[1])>=1}function gu(){return ms()&&navigator.maxTouchPoints>0}function Su(){return Qn().name===sn.WECHAT}function GU(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function RD(){let r=gw();return(function(){let{deviceType:e}=Qn();return e==="mobile"||e==="tablet"})()||r===Br.ANDROID||r===Br.IOS||r===Br.HARMONY_OS}function Xp(){let r=Qn();return r.name!==sn.EDGE&&r.name!==sn.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function _h(){return gw()===Br.ANDROID}function Fg(){let r=Qn();return _h()&&(r.name===sn.CHROME||r.name===sn.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Qt(r,e,t){return(e=(function(n){var i=(function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var d=c.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)})(n);return typeof i=="symbol"?i:i+""})(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function nn(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function nt(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?nn(Object(t),!0).forEach(function(n){Qt(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):nn(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}let z=(function(r){return r.UNEXPECTED_ERROR="UNEXPECTED_ERROR",r.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",r.TIMEOUT="TIMEOUT",r.INVALID_PARAMS="INVALID_PARAMS",r.NOT_READABLE="NOT_READABLE",r.NOT_SUPPORTED="NOT_SUPPORTED",r.INVALID_OPERATION="INVALID_OPERATION",r.OPERATION_ABORTED="OPERATION_ABORTED",r.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",r.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",r.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",r.DATACHANNEL_FAILED="DATACHANNEL_FAILED",r.NETWORK_ERROR="NETWORK_ERROR",r.NETWORK_TIMEOUT="NETWORK_TIMEOUT",r.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",r.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",r.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",r.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",r.ELECTRON_IS_NULL="ELECTRON_IS_NULL",r.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",r.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",r.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",r.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",r.PERMISSION_DENIED="PERMISSION_DENIED",r.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",r.TRACK_IS_DISABLED="TRACK_IS_DISABLED",r.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",r.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",r.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",r.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",r.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",r.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",r.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",r.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",r.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",r.UID_CONFLICT="UID_CONFLICT",r.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",r.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",r.TOKEN_EXPIRE="TOKEN_EXPIRE",r.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",r.INVALID_TRACK="INVALID_TRACK",r.SENDER_NOT_FOUND="SENDER_NOT_FOUND",r.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",r.SET_ANSWER_FAILED="SET_ANSWER_FAILED",r.ICE_FAILED="ICE_FAILED",r.PC_CLOSED="PC_CLOSED",r.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",r.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",r.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",r.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",r.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",r.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",r.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",r.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",r.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",r.INVALID_REMOTE_USER="INVALID_REMOTE_USER",r.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",r.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",r.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",r.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",r.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",r.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",r.WS_ABORT="WS_ABORT",r.WS_DISCONNECT="WS_DISCONNECT",r.WS_ERR="WS_ERR",r.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",r.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",r.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",r.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",r.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",r.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",r.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",r.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",r.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",r.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",r.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",r.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",r.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",r.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",r.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",r.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",r.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",r.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",r.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",r.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",r.INVALID_PLUGIN="INVALID_PLUGIN",r.DISCONNECT_P2P="DISCONNECT_P2P",r.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",r.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",r.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",r.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",r.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",r.PROHIBITED_OPERATION="PROHIBITED_OPERATION",r.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",r.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",r})({}),H=class extends Error{constructor(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",t=arguments.length>2?arguments[2]:void 0;super(e),Qt(this,"code",void 0),Qt(this,"message",void 0),Qt(this,"data",void 0),Qt(this,"name","AgoraRTCException"),this.code=r,this.message="AgoraRTCError ".concat(this.code,": ").concat(e),this.data=t}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",e=arguments.length>1?arguments[1]:void 0;return r==="error"&&(e||console).error(this.toString()),r==="warning"&&(e||console).warn(this.toString()),this}throw(r){throw this.print("error",r),this}};function Ge(r,e){if(typeof r!="boolean")throw new H(z.INVALID_PARAMS,"Invalid ".concat(e,": The value is of the boolean type."))}function gr(r,e,t){if(!Re(t).call(t,r))throw new H(z.INVALID_PARAMS,"".concat(e," can only be set as ").concat(JSON.stringify(t)))}function Tn(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(r<t||r>n||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!(function(i){return typeof i=="number"&&i%1==0})(r))throw new H(z.INVALID_PARAMS,"invalid ".concat(e,": the value range is [").concat(t,", ").concat(n,"]. integer only"))}function Mi(r,e){if(typeof r!="number"){if(!(r.min||r.max||r.ideal||r.exact))throw new H(z.INVALID_PARAMS,"".concat(e," is not a valid ConstrainLong"));r.min!==void 0&&Tn(r.min,"".concat(e,".min"),0,1/0),r.max!==void 0&&Tn(r.max,"".concat(e,".max"),1,1/0),r.exact!==void 0&&Tn(r.exact,"".concat(e,".exact"),1,1/0),r.ideal!==void 0&&Tn(r.ideal,"".concat(e,".ideal"),1,1/0)}else Tn(r,e,1,1/0)}function Eo(r,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(r==null)throw new H(z.INVALID_PARAMS,"".concat(e||"param"," cannot be empty"));if(!Gr(r,t,n,i))throw new H(z.INVALID_PARAMS,"Invalid ".concat(e||"string param",": Length of the string: [").concat(t,",").concat(n,"].").concat(i?" ASCII characters only.":""))}function ls(r,e){if(!Array.isArray(r))throw new H(z.INVALID_PARAMS,"".concat(e," should be an array"))}function Hi(r){return r==null}function Gr(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,n=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof r=="string"&&r.length<=t&&r.length>=e&&(!n||(function(i){if(typeof i!="string")return!1;for(let s=0;s<i.length;s+=1){let o=i.charCodeAt(s);if(o<0||o>255)return!1}return!0})(r))}var pC=(function(r){return r.COVERED="COVERED",r.POSITION="POSITION",r.SIZE="SIZE",r.STYLE="STYLE",r})(pC||{}),Sv=(function(r){return r.UNMOUNTED="UNMOUNTED",r.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",r})(Sv||{});let CD=new class{constructor(){Qt(this,"_clientSize",null),Qt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Qt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Qt(this,"getStyle",r=>window.getComputedStyle(r,null)),Qt(this,"checkCssVisibleProperty",r=>{var e;let t=!0,n=this.getStyle(r),{display:i,visibility:s,opacity:o,filter:c}=n;return(i==="none"||Re(e=["hidden","collapse"]).call(e,s)||Number(o)<.1)&&(t=!1),!!t&&(c&&c.split(" ").filter(d=>{var u;let p=d.split("(")[0];return Re(u=["brightness","blur","opacity"]).call(u,p)}).map(d=>{let[u,p]=d.split(/\(|\)/);return[u,Number(p.match(/^[0-9\.]+/))]}).forEach(d=>{let[u,p]=d;switch(u){case"brightness":(p<.1||p>3)&&(t=!1);break;case"blur":p>3&&(t=!1);break;case"opacity":p<.1&&(t=!1)}}),t)}),Qt(this,"checkPropertyUpToAllParentNodes",(r,e)=>{let t=!0,n=!0,i=o=>e(o),s=r;for(;s&&n;)i(s)||(t=!1,n=!1),s=s.parentElement,s||(n=!1);return t}),Qt(this,"checkActualCssVisibleIncludeInherit",r=>this.checkPropertyUpToAllParentNodes(r,this.checkCssVisibleProperty)),Qt(this,"getSizeAboutClient",r=>{let{width:e,height:t,left:n,right:i,top:s,bottom:o}=r.getBoundingClientRect(),c=this.getClientWidth(),d=this.getClientHeight();return{width:e,height:t,left:n,right:i,top:s,bottom:o,clientWidth:c,clientHeight:d,clientMin:Math.min(c,d)}}),Qt(this,"checkActualSize",()=>{let{width:r,height:e,clientMin:t}=this._clientSize;return this.checkSizeIsVisible(r,e,t)}),Qt(this,"elementFromPoint",(r,e)=>document.elementFromPoint?document.elementFromPoint(r,e):null),Qt(this,"checkCoverForAPoint",(r,e,t)=>{let n=this.elementFromPoint(r,e);return n!==null&&n!==t}),Qt(this,"getPointPositionList",()=>{let{width:r,height:e,left:t,top:n}=this._clientSize,i=r/6,s=e/6,o=[],c=10**6;for(let d=0;d<5;d++)for(let u=0;u<5;u++){let p=(t*c+(d===0?.1:d===4?(i*d*c-1e5)/c:i*d)*c)/c,m=(n*c+(u===0?.1:u===4?(s*u*c-1e5)/c:s*u)*c)/c;o.push({x:p,y:m})}return[...o]}),Qt(this,"checkElementCover",r=>this.getPointPositionList().map(e=>this.checkCoverForAPoint(e.x,e.y,r)).filter(e=>!!e).length>6),Qt(this,"checkSizeIsVisible",(r,e,t)=>(r>50||t/r<=10)&&(e>50||t/e<=10)),Qt(this,"checkSizeOfPartInClient",()=>{let{left:r,right:e,top:t,bottom:n,clientHeight:i,clientWidth:s,clientMin:o}=this._clientSize,c,d,u,p;if(r<0)c=0;else{if(!(r<s))return!1;c=r}if(e<0)return!1;if(d=e<s?e:s,t<0)u=0;else{if(!(t<i))return!1;u=t}if(n<0)return!1;p=n<i?n:i;let m=d-c,g=p-u;return this.checkSizeIsVisible(m,g,o)}),Qt(this,"returnHiddenResult",r=>(this._clientSize=null,{visible:!1,reason:r})),Qt(this,"checkOneElementVisible",r=>{if(r instanceof HTMLElement){if(this.checkElementIsMountedOnDom(r)){if(this.checkActualCssVisibleIncludeInherit(r)){if(this._clientSize=this.getSizeAboutClient(r),this.checkElementCover(r))return this.returnHiddenResult(pC.COVERED);{let e=this.checkActualSize(),t=this.checkSizeOfPartInClient();return e&&!t?this.returnHiddenResult(pC.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(pC.SIZE)}}return this.returnHiddenResult(pC.STYLE)}return this.returnHiddenResult(Sv.UNMOUNTED)}return this.returnHiddenResult(Sv.INVALID_HTML_ELEMENT)}),Qt(this,"checkElementIsMountedOnDom",r=>this.checkPropertyUpToAllParentNodes(r,e=>e.nodeName.toUpperCase()!=="HTML"?e.parentElement!==null:!!document.documentElement))}};function bD(r){return new TextEncoder().encode(r)}let ID=function(r,e){let t=new Uint8Array(r.byteLength+e.byteLength);return t.set(new Uint8Array(r),0),t.set(new Uint8Array(e),r.byteLength),t},AD=async r=>(function(e,t){let n="";return new Uint8Array(e).forEach(i=>{n+=i.toString(t).padStart(2,"0")}),n})(await crypto.subtle.digest("SHA-256",bD(r)),16);class Sr{constructor(){Qt(this,"_events",{}),Qt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);let n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);let n=this._events[e];this._indexOfListener(n,t)===-1&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;let n=this._events[e],i=this._indexOfListener(n,t);i!==-1&&n.splice(i,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);let t=this._events[e].map(o=>o);for(var n=arguments.length,i=new Array(n>1?n-1:0),s=1;s<n;s++)i[s-1]=arguments[s];for(let o=0;o<t.length;o+=1){let c=t[o];c.once&&this.off(e,c.listener),c.listener.apply(this,i||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];[...this._events[e]||[]].forEach(s=>{s.once&&this.off(e,s.listener);try{s.listener.apply(this,n)}catch(o){console.error("safeEmit event:".concat(e," error ").concat(o?.toString()))}})}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}}let rr=null;function fC(){if(rr)return rr;if(window.electron)return rr=window.electron;if(!window.require)return null;try{return rr=window.require("electron"),rr}catch{return null}}let Zr=(function(r){return r.CREATE_CLIENT="createClient",r.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",r.SET_AREA="setArea",r.PRELOAD="PRELOAD",r.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",r.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",r.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",r.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",r.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",r.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",r.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",r.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",r.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",r.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",r.START_PROXY_SERVER="Client.startProxyServer",r.STOP_PROXY_SERVER="Client.stopProxyServer",r.SET_PROXY_SERVER="Client.setProxyServer",r.SET_TURN_SERVER="Client.setTurnServer",r.SET_CLIENT_ROLE="Client.setClientRole",r.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",r.ENABLE_DUAL_STREAM="Client.enableDualStream",r.DISABLE_DUAL_STREAM="Client.disableDualStream",r.JOIN="Client.join",r.LEAVE="Client.leave",r.PUBLISH="Client.publish",r.UNPUBLISH="Client.unpublish",r.SUBSCRIBE="Client.subscribe",r.MASS_SUBSCRIBE="Client.massSubscribe",r.MASS_UNSUBSCRIBE="Client.massUnsubscribe",r.UNSUBSCRIBE="Client.unsubscribe",r.RENEW_TOKEN="Client.renewToken",r.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",r.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",r.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",r.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",r.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",r.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",r.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",r.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",r.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",r.START_LIVE_STREAMING="Client.startLiveStreaming",r.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",r.STOP_LIVE_STREAMING="Client.stopLiveStreaming",r.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",r.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",r.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",r.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",r.SET_CONFIG_DISTRIBUTE="_configDistribute",r.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",r.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",r.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",r.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",r.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",r.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",r.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",r.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",r.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",r.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",r.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",r.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",r.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",r.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",r.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",r.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",r.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",r.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",r.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",r.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",r.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",r.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",r.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",r.STREAM_TYPE_CHANGE="streamTypeChange",r.CONNECTION_STATE_CHANGE="connectionStateChange",r.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",r.IMAGE_MODERATION_UPLOAD="imageModerationUpload",r.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",r.PRELOAD_MEDIA_FAILED="preloadMediaFailed",r.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",r})({}),Cn=(function(r){return r.TRACER="tracer",r})({});function Tr(r){return Tn(r.timeout,"config.timeout",0,1e5),Tn(r.timeoutFactor,"config.timeoutFactor",0,100,!1),Tn(r.maxRetryCount,"config.maxRetryConfig",0,1/0),Tn(r.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let t4=(function(r){return r[r.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",r[r.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",r[r.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",r})({}),Di=(function(r){return r.LEAVE="LEAVE",r.NETWORK_ERROR="NETWORK_ERROR",r.SERVER_ERROR="SERVER_ERROR",r.UID_BANNED="UID_BANNED",r.FALLBACK="FALLBACK",r.IP_BANNED="IP_BANNED",r.CHANNEL_BANNED="CHANNEL_BANNED",r.LICENSE_MISSING="LICENSE_MISSING",r.LICENSE_EXPIRED="LICENSE_EXPIRED",r.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",r.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",r.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",r.LICENSE_ILLEGAL="LICENSE_ILLEGAL",r.TOKEN_EXPIRE="TOKEN_EXPIRE",r})({});function Ti(r){if(!Array.isArray(r)||r.length<1)return!1;try{r.forEach(e=>{if(!e.urls)throw Error()})}catch{return!1}return!0}function _C(r){return Eo(r.turnServerURL,"turnServerURL"),Eo(r.username,"username"),Eo(r.password,"password"),r.udpport&&Tn(r.udpport,"udpport",1,99999,!0),r.forceturn&&Ge(r.forceturn,"forceturn"),r.security&&Ge(r.security,"security"),r.tcpport&&Tn(r.tcpport,"tcpport",1,99999,!0),!0}function wD(r){return r.level!==void 0&&gr(r.level,"level",[1,2,3]),r.delay!==void 0&&Tn(r.delay,"delay",0,3e3,!0),!0}let jn=(function(r){return r.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",r.AUDIO_METADATA="audio-metadata",r.AUDIO_PTS="audio-pts",r.CONNECTION_STATE_CHANGE="connection-state-change",r.MEDIA_RECONNECT_START="media-reconnect-start",r.MEDIA_RECONNECT_END="media-reconnect-end",r.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",r.USER_JOINED="user-joined",r.USER_LEAVED="user-left",r.USER_PUBLISHED="user-published",r.USER_UNPUBLISHED="user-unpublished",r.USER_INFO_UPDATED="user-info-updated",r.CLIENT_BANNED="client-banned",r.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",r.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",r.VOLUME_INDICATOR="volume-indicator",r.CRYPT_ERROR="crypt-error",r.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",r.NETWORK_QUALITY="network-quality",r.STREAM_TYPE_CHANGED="stream-type-changed",r.STREAM_FALLBACK="stream-fallback",r.RECEIVE_METADATA="receive-metadata",r.STREAM_MESSAGE="stream-message",r.LIVE_STREAMING_ERROR="live-streaming-error",r.LIVE_STREAMING_WARNING="live-streaming-warning",r.EXCEPTION="exception",r.ERROR="error",r.P2P_LOST="p2p_lost",r.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",r.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",r.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",r.PUBLISHED_USER_LIST="published-user-list",r.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",r.CONTENT_INSPECT_ERROR="content-inspect-error",r.CONTENT_INSPECT_RESULT="content-inspect-result",r.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",r})({}),$t=(function(r){return r.NETWORK_ERROR="NETWORK_ERROR",r.SERVER_ERROR="SERVER_ERROR",r.MULTI_IP="MULTI_IP",r.TIMEOUT="TIMEOUT",r.OFFLINE="OFFLINE",r.LEAVE="LEAVE",r.P2P_FAILED="P2P_FAILED",r.FALLBACK="FALLBACK",r.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",r})({}),vr=(function(r){return r.ONLINE="ONLINE",r.OFFLINE="OFFLINE",r})({}),ja=(function(r){return r.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",r.ONLINE="ONLINE",r.OFFLINE="OFFLINE",r})({});function Ys(r,e){for(var t=arguments.length,n=new Array(t>2?t-2:0),i=2;i<t;i++)n[i-2]=arguments[i];return r.getListeners(e).length===0?De.reject(new H(z.UNEXPECTED_ERROR,"can not emit promise")):new De((s,o)=>{r.emit(e,...n,s,o)})}function On(r,e){if(r.getListeners(e).length===0)return De.resolve();for(var t=arguments.length,n=new Array(t>2?t-2:0),i=2;i<t;i++)n[i-2]=arguments[i];return Ys(r,e,...n)}function ei(r,e){if(r.getListeners(e).length===0)return null;for(var t=arguments.length,n=new Array(t>2?t-2:0),i=2;i<t;i++)n[i-2]=arguments[i];return Sc(r,e,...n)}function Sc(r,e){let t=null,n=null;for(var i=arguments.length,s=new Array(i>2?i-2:0),o=2;o<i;o++)s[o-2]=arguments[o];if(r.emit(e,...s,c=>{t=c},c=>{n=c}),n!==null)throw n;if(t===null)throw new H(z.UNEXPECTED_ERROR,"handler is not sync");return t}let Kr=new class extends Sr{set networkState(r){this.emit(ja.NETWORK_STATE_CHANGE,r,this._networkState),r===vr.ONLINE?this.emit(ja.ONLINE):r===vr.OFFLINE&&(this.onlineWaiter=new De(e=>{this.once(ja.ONLINE,()=>{this.onlineWaiter=void 0,e(vr.ONLINE)})}),this.emit(ja.OFFLINE)),this._networkState=r}get networkState(){return this._networkState}get isOnline(){return this._networkState===vr.ONLINE}constructor(){super(),Qt(this,"_moduleName","network-indicator"),Qt(this,"_networkState",vr.ONLINE),Qt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=vr.ONLINE}),window.addEventListener("offline",()=>{this.networkState=vr.OFFLINE})}};function $r(r,e){let t=r.indexOf(e);t!==-1&&r.splice(t,1)}function Pm(r){let e=[];return r.forEach(t=>{e.indexOf(t)===-1&&e.push(t)}),e}function km(r){De!==void 0?De.resolve().then(r):setTimeout(r,0)}function sr(r){return JSON.parse(JSON.stringify(r))}function Ki(r){try{return sr(r)}catch{return r}}let Bg={};function Lm(r,e){Bg[e]||(Bg[e]=!0,r())}function Cd(r){let e=window.atob(r),t=new Uint8Array(new ArrayBuffer(e.length));for(let n=0;n<e.length;n+=1)t[n]=e.charCodeAt(n);return t}function bd(r){let e="";for(let t=0;t<r.length;t+=1)e+=String.fromCharCode(r[t]);return window.btoa(e)}function Mm(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,t=new TextEncoder().encode(r);if(t.length>e)t=t.slice(0,e);else if(t.length<e){let n=new Uint8Array(e);n.set(t),t=n}return t}function WU(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];let n=Ks(e).call(e,(o,c)=>o+c.length,0),i=new Uint8Array(new ArrayBuffer(n)),s=0;return e.forEach(o=>{i.set(o,s),s+=o.length}),i}function Jp(r){return window.TextEncoder?new TextEncoder().encode(r).length:r.length}function Qp(r){let e=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&r.realFormData&&(r=r.realFormData),r.forEach(t=>{e+=typeof t=="string"?Jp(t):t.size}),e+138}function n4(r){let e=new H(z.TIMEOUT,"timeout");return new De((t,n)=>{window.setTimeout(()=>n(e),r)})}function Jo(r){return new De(e=>{window.setTimeout(e,r)})}function In(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,e=arguments.length>1?arguments[1]:void 0,t=Math.random().toString(16).substr(2,r).toLowerCase();return t.length===r?"".concat(e).concat(t):"".concat(e).concat(t)+In(r-t.length,"")}function Oi(){return In(32,"").toUpperCase()}let __=()=>{},Cw=new class{constructor(){Qt(this,"fnMap",new Map)}throttleByKey(r,e,t,n){for(var i=arguments.length,s=new Array(i>4?i-4:0),o=4;o<i;o++)s[o-4]=arguments[o];if(this.fnMap.has(e)){let c=this.fnMap.get(e);if(c.threshold!==t){c.fn(...c.args),clearTimeout(c.timer);let d=window.setTimeout(()=>{let u=this.fnMap.get(e);u&&u.fn(...u.args),this.fnMap.delete(e)},t);this.fnMap.set(e,{fn:r,threshold:t,timer:d,args:s,skipFn:n})}else c.skipFn&&c.skipFn(...c.args),this.fnMap.set(e,nt(nt({},c),{},{fn:r,args:s,skipFn:n}))}else{let c=window.setTimeout(()=>{let d=this.fnMap.get(e);d&&d.fn(...d.args),this.fnMap.delete(e)},t);this.fnMap.set(e,{fn:r,threshold:t,timer:c,args:s,skipFn:n})}}},HU=Cw.throttleByKey.bind(Cw);function KU(r){return typeof r=="object"&&r!==null&&!(r instanceof RegExp)}function OD(r,e){if(!KU(r)||!KU(e)||Array.isArray(r)&&!Array.isArray(e)||!Array.isArray(r)&&Array.isArray(e))return e;if(Array.isArray(e)&&Array.isArray(r)){let t=[...r];for(let n=0;n<e.length;n++)t[n]=OD(r[n],e[n]);return t}{let t=nt({},r);for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&(Object.prototype.hasOwnProperty.call(r,n)?t[n]=OD(r[n],e[n]):t[n]=e[n]);return t}}function ND(r,e){let t=[0];if(t=new Array(e).fill(0),r===0)return t;let n=0;for(;r>0&&(t[n]=255&r,r>>=8,n++,n!==e););return t}function Tv(r){return typeof r=="number"?r:r.exact||r.ideal||r.max||r.min||0}function jg(r){return Ks(r).call(r,(e,t)=>e+t,0)}function DD(r){let e="0123456789abcdef";function t(L){let j,K="";for(j=0;j<=3;j++)K+=e.charAt(L>>8*j+4&15)+e.charAt(L>>8*j&15);return K}function n(L,j){let K=(65535&L)+(65535&j);return(L>>16)+(j>>16)+(K>>16)<<16|65535&K}function i(L,j,K,W,Y,se){return n((function(de,ge){return de<<ge|de>>>32-ge})(n(n(j,L),n(W,se)),Y),K)}function s(L,j,K,W,Y,se,de){return i(j&K|~j&W,L,j,Y,se,de)}function o(L,j,K,W,Y,se,de){return i(j&W|K&~W,L,j,Y,se,de)}function c(L,j,K,W,Y,se,de){return i(j^K^W,L,j,Y,se,de)}function d(L,j,K,W,Y,se,de){return i(K^(j|~W),L,j,Y,se,de)}let u=(function(L){let j,K=1+(L.length+8>>6),W=new Array(16*K);for(j=0;j<16*K;j++)W[j]=0;for(j=0;j<L.length;j++)W[j>>2]|=L.charCodeAt(j)<<j%4*8;return W[j>>2]|=128<<j%4*8,W[16*K-2]=8*L.length,W})(r),p,m,g,T,R,I=1732584193,A=-271733879,w=-1732584194,k=271733878;for(p=0;p<u.length;p+=16)m=I,g=A,T=w,R=k,I=s(I,A,w,k,u[p+0],7,-680876936),k=s(k,I,A,w,u[p+1],12,-389564586),w=s(w,k,I,A,u[p+2],17,606105819),A=s(A,w,k,I,u[p+3],22,-1044525330),I=s(I,A,w,k,u[p+4],7,-176418897),k=s(k,I,A,w,u[p+5],12,1200080426),w=s(w,k,I,A,u[p+6],17,-1473231341),A=s(A,w,k,I,u[p+7],22,-45705983),I=s(I,A,w,k,u[p+8],7,1770035416),k=s(k,I,A,w,u[p+9],12,-1958414417),w=s(w,k,I,A,u[p+10],17,-42063),A=s(A,w,k,I,u[p+11],22,-1990404162),I=s(I,A,w,k,u[p+12],7,1804603682),k=s(k,I,A,w,u[p+13],12,-40341101),w=s(w,k,I,A,u[p+14],17,-1502002290),A=s(A,w,k,I,u[p+15],22,1236535329),I=o(I,A,w,k,u[p+1],5,-165796510),k=o(k,I,A,w,u[p+6],9,-1069501632),w=o(w,k,I,A,u[p+11],14,643717713),A=o(A,w,k,I,u[p+0],20,-373897302),I=o(I,A,w,k,u[p+5],5,-701558691),k=o(k,I,A,w,u[p+10],9,38016083),w=o(w,k,I,A,u[p+15],14,-660478335),A=o(A,w,k,I,u[p+4],20,-405537848),I=o(I,A,w,k,u[p+9],5,568446438),k=o(k,I,A,w,u[p+14],9,-1019803690),w=o(w,k,I,A,u[p+3],14,-187363961),A=o(A,w,k,I,u[p+8],20,1163531501),I=o(I,A,w,k,u[p+13],5,-1444681467),k=o(k,I,A,w,u[p+2],9,-51403784),w=o(w,k,I,A,u[p+7],14,1735328473),A=o(A,w,k,I,u[p+12],20,-1926607734),I=c(I,A,w,k,u[p+5],4,-378558),k=c(k,I,A,w,u[p+8],11,-2022574463),w=c(w,k,I,A,u[p+11],16,1839030562),A=c(A,w,k,I,u[p+14],23,-35309556),I=c(I,A,w,k,u[p+1],4,-1530992060),k=c(k,I,A,w,u[p+4],11,1272893353),w=c(w,k,I,A,u[p+7],16,-155497632),A=c(A,w,k,I,u[p+10],23,-1094730640),I=c(I,A,w,k,u[p+13],4,681279174),k=c(k,I,A,w,u[p+0],11,-358537222),w=c(w,k,I,A,u[p+3],16,-722521979),A=c(A,w,k,I,u[p+6],23,76029189),I=c(I,A,w,k,u[p+9],4,-640364487),k=c(k,I,A,w,u[p+12],11,-421815835),w=c(w,k,I,A,u[p+15],16,530742520),A=c(A,w,k,I,u[p+2],23,-995338651),I=d(I,A,w,k,u[p+0],6,-198630844),k=d(k,I,A,w,u[p+7],10,1126891415),w=d(w,k,I,A,u[p+14],15,-1416354905),A=d(A,w,k,I,u[p+5],21,-57434055),I=d(I,A,w,k,u[p+12],6,1700485571),k=d(k,I,A,w,u[p+3],10,-1894986606),w=d(w,k,I,A,u[p+10],15,-1051523),A=d(A,w,k,I,u[p+1],21,-2054922799),I=d(I,A,w,k,u[p+8],6,1873313359),k=d(k,I,A,w,u[p+15],10,-30611744),w=d(w,k,I,A,u[p+6],15,-1560198380),A=d(A,w,k,I,u[p+13],21,1309151649),I=d(I,A,w,k,u[p+4],6,-145523070),k=d(k,I,A,w,u[p+11],10,-1120210379),w=d(w,k,I,A,u[p+2],15,718787259),A=d(A,w,k,I,u[p+9],21,-343485551),I=n(I,m),A=n(A,g),w=n(w,T),k=n(k,R);return t(I)+t(A)+t(w)+t(k)}let i4=1,r4=console,ha=class{static setLogger(r){r4=r}constructor(r,e){Qt(this,"id",void 0),Qt(this,"lockingPromise",De.resolve()),Qt(this,"locks",0),Qt(this,"name",""),Qt(this,"lockId",void 0),this.lockId=i4++,r&&(this.name=r),e&&(this.id=e),this.logger("created")}logger(r,e){let t=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),n=r==="created"?"is ".concat(r,"."):"is ".concat(r,", current queue ").concat(this.locks,". ").concat(e??"");r4.debug("".concat(t," ").concat(n))}setId(r){this.id=r}get isLocked(){return this.locks>0}lock(r){let e;this.locks+=1,this.logger("locked",r);let t=new De(i=>{e=()=>{this.locks-=1,this.logger("unlocked",r),i()}}),n=this.lockingPromise.then(()=>e);return this.lockingPromise=this.lockingPromise.then(()=>t),n}};function ro(r,e){return function(t,n,i){let s=i.value;if(typeof s!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let o=this[e];if(!o)throw new Error("mutex property key ".concat(e," doesn't exist on ").concat(r));let c=await o.lock("From ".concat(r,".").concat(n));try{for(var d=arguments.length,u=new Array(d),p=0;p<d;p++)u[p]=arguments[p];return await s.apply(this,u)}finally{c()}},i}}let zr={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Es(r,e){let t=Math.floor(e.timeout*Math.pow(e.timeoutFactor,r));return Math.min(e.maxRetryTimeout,t)}function Tu(r,e,t,n){let i=Object.assign({},zr,n),s=i.timeout,o=async()=>{await(function(u){return new De(p=>{window.setTimeout(p,u)})})(s),s*=i.timeoutFactor,s=Math.min(i.maxRetryTimeout,s)},c=!1,d=new De(async(u,p)=>{e=e||(()=>!1),t=t||(()=>!0);for(let m=0;m<i.maxRetryCount;m+=1){if(c)return p(new H(z.OPERATION_ABORTED));try{let g=await r();if(!e(g,m)||m+1===i.maxRetryCount)return u(g);await o()}catch(g){if(!t(g,m)||m+1===i.maxRetryCount)return p(g);await o()}}});return d.cancel=()=>c=!0,d}let Id,bw=class{constructor(r){Qt(this,"input",[]),Qt(this,"size",void 0),this.size=r}add(r){this.input.push(r),this.input.length>this.size&&this.input.splice(0,1)}mean(){var r;return this.input.length===0?0:Ks(r=this.input).call(r,(e,t)=>e+t)/this.input.length}},Iw=0,mC=0;function Aw(r,e,t,n){return new De((i,s)=>{e.responseType=e.responseType||"json",e.data&&!t?(e.data=JSON.stringify(e.data),Iw+=Jp(e.data)):t&&(e.data.size?Iw+=e.data.size:e.data instanceof FormData?Iw+=Qp(e.data):Iw+=Jp(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=r,Er.request(e).then(o=>{typeof o.data=="string"?mC+=Jp(o.data):o.data instanceof ArrayBuffer||o.data instanceof Uint8Array?mC+=o.data.byteLength:mC+=Jp(JSON.stringify(o.data)),i(o.data)}).catch(o=>{Er.isCancel(o)?s(new H(z.OPERATION_ABORTED,"cancel token canceled")):o.code==="ECONNABORTED"?s(new H(z.NETWORK_TIMEOUT,o.message)):o.response?s(new H(z.NETWORK_RESPONSE_ERROR,o.response.status)):s(new H(z.NETWORK_ERROR,o.message))})})}async function zU(r,e){let t=new Blob([e.data],{type:"buffer"});return await Aw(r,nt(nt({},e),{},{data:t,headers:{"Content-Type":"application/octet-stream"}}),!0)}let s4=()=>window.isSecureContext!==void 0;function vu(r){if(Array.isArray(r))return r.map(t=>t);if(!yu(r))return r;let e={};for(let t in r){let n=r[t];yu(n)||Array.isArray(n)?e[t]=vu(n):e[t]=n}return e}function yu(r){return!(typeof r!="object"||Array.isArray(r)||!r)}let PD=class{constructor(r){Qt(this,"input",[]),Qt(this,"size",void 0),this.size=r}add(r){this.input.push(r),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}},mh={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},Ad={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:mh,remoteCandidate:mh},updateInterval:0},EC={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},YU={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},qU={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},XU={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0},kD=class{constructor(r,e){Qt(this,"onFirstVideoReceived",void 0),Qt(this,"onFirstVideoDecoded",void 0),Qt(this,"onFirstAudioReceived",void 0),Qt(this,"onFirstVideoDecodedTimeout",void 0),Qt(this,"onFirstAudioDecoded",void 0),Qt(this,"onSelectedLocalCandidateChanged",void 0),Qt(this,"onSelectedRemoteCandidateChanged",void 0),Qt(this,"videoIsReady",!1),Qt(this,"videoIsReady2",{}),Qt(this,"pc",void 0),Qt(this,"options",void 0),Qt(this,"intervalTimer",void 0),Qt(this,"stats",vu(Ad)),Qt(this,"isFirstVideoReceived",{}),Qt(this,"isFirstVideoDecoded",{}),Qt(this,"isFirstAudioReceived",{}),Qt(this,"isFirstAudioDecoded",{}),Qt(this,"isFirstVideoDecodedTimeout",{}),Qt(this,"lossRateWindowStats",[]),this.pc=r,this.options=e,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new De(r=>{r({local:nt({},mh),remote:nt({},mh)})})}setVideoIsReady(r){this.videoIsReady=r}setVideoIsReady2(r,e){this.videoIsReady2[r]=e}getVideoIsReady(r){return this.videoIsReady2[r]||!1}setIsFirstAudioDecoded(r){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(r){this.lossRateWindowStats.push(r),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let e=this.lossRateWindowStats.length,t=["videoSend","audioSend","videoRecv","audioRecv"],n=0,i=0,s=0,o=0;for(let c of t)r[c].forEach((d,u)=>{if(!this.lossRateWindowStats[e-1][c][u]||!this.lossRateWindowStats[0][c][u])return;let p=this.lossRateWindowStats[e-1][c][u].packets-this.lossRateWindowStats[0][c][u].packets,m=this.lossRateWindowStats[e-1][c][u].packetsLost-this.lossRateWindowStats[0][c][u].packetsLost;c==="videoSend"||c==="audioSend"?(n+=p,s+=m):(i+=p,o+=m),Number.isNaN(p)||Number.isNaN(p)?d.packetLostRate=0:d.packetLostRate=p<=0||m<=0?0:m/(p+m)});r.sendPacketLossRate=n<=0||s<=0?0:s/(n+s),r.recvPacketLossRate=i<=0||o<=0?0:o/(i+o)}},JU=class extends kD{constructor(){super(...arguments),Qt(this,"_stats",Ad),Qt(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){let r=await this._getStats(),e=this.statsResponsesToObjects(r);this._stats=vu(Ad);let t=e.filter(i=>i.type==="ssrc");this.processSSRCStats(t);let n=e.find(i=>i.type==="VideoBwe");n&&this.processBandwidthStats(n),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(r){this._stats.bitrate={actualEncoded:Number(r.googActualEncBitrate),targetEncoded:Number(r.googTargetEncBitrate),retransmit:Number(r.googRetransmitBitrate),transmit:Number(r.googTransmitBitrate)},this._stats.sendBandwidth=Number(r.googAvailableSendBandwidth)}processSSRCStats(r){r.forEach(e=>{var t;let n=Re(t=e.id).call(t,"send");switch("".concat(e.mediaType,"_").concat(n?"send":"recv")){case"video_send":{let i=vu(YU);i.codec=e.googCodecName,i.adaptionChangeReason="none",e.googCpuLimitedResolution&&(i.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(i.adaptionChangeReason="bandwidth"),i.avgEncodeMs=Number(e.googAvgEncodeMs),i.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},i.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},i.firsCount=Number(e.googFirReceived),i.nacksCount=Number(e.googNacksReceived),i.plisCount=Number(e.googPlisReceived),i.frameCount=Number(e.framesEncoded),i.bytes=Number(e.bytesSent),i.packets=Number(e.packetsSent),i.packetsLost=Number(e.packetsLost),i.ssrc=Number(e.ssrc),i.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(i),this._stats.rtt=i.rttMs;break}case"video_recv":{let i=vu(EC),s=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(i.codec=e.googCodecName,i.targetDelayMs=Number(e.googTargetDelayMs),i.renderDelayMs=Number(e.googRenderDelayMs),i.currentDelayMs=Number(e.googCurrentDelayMs),i.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),i.decodeMs=Number(e.googDecodeMs),i.maxDecodeMs=Number(e.googMaxDecodeMs),i.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},i.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},i.decodeFrameRate=Number(e.googFrameRateDecoded),i.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},i.jitterBufferMs=Number(e.googJitterBufferMs),i.firsCount=Number(e.googFirsSent),i.nacksCount=Number(e.googNacksSent),i.plisCount=Number(e.googPlisSent),i.framesDecodeCount=Number(e.framesDecoded),i.bytes=Number(e.bytesReceived),i.packets=Number(e.packetsReceived),i.packetsLost=Number(e.packetsLost),i.ssrc=Number(e.ssrc),i.packets>0&&!this.isFirstVideoReceived[i.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i.ssrc),this.isFirstVideoReceived[i.ssrc]=!0),i.framesDecodeCount>0&&!this.isFirstVideoDecoded[i.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i.ssrc,i.decodedFrame.width,i.decodedFrame.height),this.isFirstVideoDecoded[i.ssrc]=!0),s){let o=s.stats,c=Date.now()-s.lts;i.framesDecodeFreezeTime=o.framesDecodeFreezeTime,i.framesDecodeInterval=o.framesDecodeInterval,i.framesDecodeCount>o.framesDecodeCount&&this.isFirstVideoDecoded[i.ssrc]?(s.lts=Date.now(),i.framesDecodeInterval=c,i.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):i.framesDecodeCount<s.stats.framesDecodeCount&&(i.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:nt({},i),lts:Date.now()}),this._stats.videoRecv.push(i);break}case"audio_recv":{let i=vu(XU);i.codec=e.googCodecName,i.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,i.decodingCNG=Number(e.googDecodingCNG),i.decodingCTN=Number(e.googDecodingCTN),i.decodingCTSG=Number(e.googDecodingCTSG),i.decodingNormal=Number(e.googDecodingNormal),i.decodingPLC=Number(e.googDecodingPLC),i.decodingPLCCNG=Number(e.googDecodingPLCCNG),i.expandRate=Number(e.googExpandRate),i.accelerateRate=Number(e.googAccelerateRate),i.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),i.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),i.speechExpandRate=Number(e.googSpeechExpandRate),i.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),i.jitterBufferMs=Number(e.googJitterBufferMs),i.jitterMs=Number(e.googJitterReceived),i.bytes=Number(e.bytesReceived),i.packets=Number(e.packetsReceived),i.packetsLost=Number(e.packetsLost),i.ssrc=Number(e.ssrc),i.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),i.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),i.receivedFrames>0&&!this.isFirstAudioReceived[i.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i.ssrc),this.isFirstAudioReceived[i.ssrc]=!0),i.decodingNormal>0&&!this.isFirstAudioDecoded[i.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i.ssrc),this.isFirstAudioDecoded[i.ssrc]=!0),this._stats.audioRecv.push(i);break}case"audio_send":{let i=vu(qU);i.codec=e.googCodecName,i.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,i.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),i.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),i.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),i.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),i.bytes=Number(e.bytesSent),i.packets=Number(e.packetsSent),i.packetsLost=Number(e.packetsLost),i.ssrc=Number(e.ssrc),i.rttMs=Number(e.googRtt||0),this._stats.rtt=i.rttMs,this._stats.audioSend.push(i);break}}})}_getStats(){return new De((r,e)=>{this.pc.getStats(r,e)})}statsResponsesToObjects(r){let e=[];return r.result().forEach(t=>{let n={id:t.id,timestamp:t.timestamp.valueOf().toString(),type:t.type};t.names().forEach(i=>{n[i]=t.stat(i)}),e.push(n)}),e}},ww=(function(r){return r.BANDWIDTH="bandwidth",r.CPU="cpu",r.NONE="none",r.OTHER="other",r})({}),Gg=(function(r){return r.L1T1="L1T1",r.L1T2="L1T2",r.L1T3="L1T3",r.L1T3_KEY="L1T3_KEY",r.L2T1_KEY="L2T1_KEY",r.L2T2_KEY="L2T2_KEY",r.L2T3_KEY="L2T3_KEY",r.L3T1_KEY="L3T1_KEY",r.L3T2_KEY="L3T2_KEY",r.L3T3_KEY="L3T3_KEY",r})({}),gC=(function(r){return r[r.new=0]="new",r[r.connecting=1]="connecting",r[r.connected=2]="connected",r[r.disconnected=3]="disconnected",r[r.failed=4]="failed",r[r.closed=5]="closed",r})({}),ul=(function(r){return r.CERTIFICATE="certificate",r.CODEC="codec",r.CANDIDATE_PAIR="candidate-pair",r.LOCAL_CANDIDATE="local-candidate",r.REMOTE_CANDIDATE="remote-candidate",r.INBOUND="inbound-rtp",r.TRACK="track",r.OUTBOUND="outbound-rtp",r.PC="peer-connection",r.REMOTE_INBOUND="remote-inbound-rtp",r.REMOTE_OUTBOUND="remote-outbound-rtp",r.TRANSPORT="transport",r.CSRC="csrc",r.DATA_CHANNEL="data-channel",r.STREAM="stream",r.SENDER="sender",r.RECEIVER="receiver",r})({});var ic=(function(r){return r[r.kNone=1]="kNone",r[r.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",r[r.kBytesToBits=8]="kBytesToBits",r})(ic||{});function m_(r,e,t,n){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:ic.kNone;if(!e)return;let s=Number(e[t]);if(typeof s!="number")return;let o=Number(e[n]);if(typeof o!="number")return;if(!r)return o?s/o*i:void 0;let c=Number(r[t]);if(typeof c!="number")return;let d=Number(r[n]);if(typeof d!="number")return;let u=o-d;return u?(s-c)/u*i:void 0}let SC=class extends kD{constructor(){super(...arguments),Qt(this,"_stats",Ad),Qt(this,"report",void 0),Qt(this,"lastDecodeVideoReceiverStats",new Map),Qt(this,"lastVideoFramesRecv",new Map),Qt(this,"lastVideoFramesSent",new Map),Qt(this,"lastVideoFramesDecode",new Map),Qt(this,"lastVideoFramesOutput",new Map),Qt(this,"lastVideoJBDelay",new Map),Qt(this,"lastAudioJBDelay",new Map),Qt(this,"mediaBytesSent",new Map),Qt(this,"mediaBytesRetransmit",new Map),Qt(this,"mediaBytesTargetEncode",new Map),Qt(this,"lastDecodeAudioReceiverStats",new Map),Qt(this,"lastAudioConcealment",new Map),Qt(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=vu(Ad),this.report.forEach(r=>{switch(r.type){case ul.OUTBOUND:case ul.INBOUND:{let e=r.mediaType||r.kind,t=!e&&"frameWidth"in r,n=!e&&!("frameWidth"in r);r.type===ul.OUTBOUND?e==="audio"||n?this.processAudioOutboundStats(r):(e==="video"||t)&&this.processVideoOutboundStats(r):r.type===ul.INBOUND&&(e==="audio"||n?this.processAudioInboundStats(r):(e==="video"||t)&&this.processVideoInboundStats(r));break}case ul.TRANSPORT:{let e=this.report.get(r.selectedCandidatePairId);e&&this.processCandidatePairStats(e);break}case ul.CANDIDATE_PAIR:r.selected&&this.processCandidatePairStats(r)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){let r=await this.pc.getStats(),e={local:nt({},mh),remote:nt({},mh)};return r.forEach(t=>{let n;if(t.type===ul.TRANSPORT&&(n=r.get(t.selectedCandidatePairId)),t.type===ul.CANDIDATE_PAIR&&t.selected&&(n=t),n){let i=(s,o)=>{s.type=o.type,s.id=o.id,o.address&&(s.address=o.address),o.candidateType&&(s.candidateType=o.candidateType),o.port&&(s.port=o.port),o.priority&&(s.priority=o.priority),o.protocol&&(s.protocol=o.protocol),o.relayProtocol&&(s.relayProtocol=o.relayProtocol)};if(n.localCandidateId){let s=r.get(n.localCandidateId);s&&i(e.local,s)}if(n.remoteCandidateId){let s=r.get(n.remoteCandidateId);s&&i(e.remote,s)}}}),e}processCandidatePairStats(r){if(this._stats.sendBandwidth=r.availableOutgoingBitrate||0,r.currentRoundTripTime&&(this._stats.rtt=1e3*r.currentRoundTripTime),this._stats.videoSend.forEach(e=>{r.currentRoundTripTime&&(e.rttMs=1e3*r.currentRoundTripTime)}),this._stats.audioSend.forEach(e=>{r.currentRoundTripTime&&(e.rttMs=1e3*r.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=r.id,r.localCandidateId){let e=this.report.get(r.localCandidateId);e&&this.processCandidateStats(e)}if(r.remoteCandidateId){let e=this.report.get(r.remoteCandidateId);e&&this.processCandidateStats(e)}}processCandidateStats(r){let e;r.type===ul.LOCAL_CANDIDATE&&(e=this._stats.selectedCandidatePair.localCandidate),r.type===ul.REMOTE_CANDIDATE&&(e=this._stats.selectedCandidatePair.remoteCandidate),e&&(e.type=r.type,e.id=r.id,r.address&&(e.address=r.address),r.candidateType&&(e.candidateType=r.candidateType),r.port&&(e.port=r.port),r.priority&&(e.priority=r.priority),r.protocol&&(e.protocol=r.protocol),r.relayProtocol&&(e.relayProtocol=r.relayProtocol),r.type===ul.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==e.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(nt({},e),nt({},this.stats.selectedCandidatePair.localCandidate)),r.type===ul.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==e.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(nt({},e),nt({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(r){let e=this._stats.audioRecv.find(n=>n.ssrc===r.ssrc);e||(e=vu(XU),this._stats.audioRecv.push(e)),e.ssrc=r.ssrc,e.packets=r.packetsReceived,e.packetsLost=r.packetsLost,e.packetsDiscarded=r.packetsDiscarded,e.bytes=r.bytesReceived,e.jitterMs=1e3*r.jitter,e.retransmittedBytesReceived=r.retransmittedBytesReceived,e.retransmittedPacketsReceived=r.retransmittedPacketsReceived,e.totalProcessingDelay=r.totalProcessingDelay,e.jitterBufferEmittedCount=r.jitterBufferEmittedCount;let t=this.lastDecodeAudioReceiverStats.get(e.ssrc);e.avgProcessingDelayMs=m_(t,e,"totalProcessingDelay","jitterBufferEmittedCount",ic.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(r,r.trackId,e),this.calculateAudioFreeze(e,t,r),r.codecId&&(e.codec=this.getCodecFromCodecStats(r.codecId)),e.receivedFrames||(e.receivedFrames=r.packetsReceived),e.droppedFrames||(e.droppedFrames=r.packetsLost),e.receivedFrames>0&&!this.isFirstAudioReceived[e.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(e.ssrc),this.isFirstAudioReceived[e.ssrc]=!0),e.outputLevel&&e.outputLevel>0&&!this.isFirstAudioDecoded[e.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(e.ssrc),this.isFirstAudioDecoded[e.ssrc]=!0),typeof r.concealedSamples=="number"&&(e.concealedSamples=r.concealedSamples),this.lastDecodeAudioReceiverStats.set(e.ssrc,nt({},e))}calculateAudioFreeze(r,e,t){let n=this.lastAudioConcealment.get(r.ssrc);if(e!=null&&n!=null){let i=n.lts,s=t.timestamp,o=s-i;if(o<=0)return;let c=r.concealedSamples-e.concealedSamples-0,d=n.nonSilent+c,u=r.totalSamplesReceived-e.totalSamplesReceived;if(u<=0)return;let p=80*u/o,m=200*u/o,g=o/u,T=0;r.freezeSamples80=e.freezeSamples80,r.freezeMs80=e.freezeMs80,d>p&&(n.plc80>0?(r.freezeSamples80+=c,r.freezeMs80+=Math.round(c*g)):(r.freezeSamples80+=d,r.freezeMs80+=Math.round(d*g)),T=n.plc80+1);let R=0;r.freezeSamples200=e.freezeSamples200,r.freezeMs200=e.freezeMs200,d>m&&(n.plc200>0?(r.freezeSamples200+=c,r.freezeMs200+=Math.round(c*g)):(r.freezeSamples200+=d,r.freezeMs200+=Math.round(d*g)),R=n.plc200+1),this.lastAudioConcealment.set(r.ssrc,{nonSilent:c,lts:s,plc80:T,plc200:R})}else r.freezeSamples80=0,r.freezeSamples200=0,r.freezeMs80=0,r.freezeMs200=0,this.lastAudioConcealment.set(r.ssrc,{nonSilent:0,lts:t.timestamp,plc80:0,plc200:0})}processVideoInboundStats(r){let e=this._stats.videoRecv.find(o=>o.ssrc===r.ssrc);e||(e=vu(EC),this._stats.videoRecv.push(e)),e.ssrc=r.ssrc,e.packets=r.packetsReceived,e.packetsLost=r.packetsLost,e.bytes=r.bytesReceived,e.firsCount=r.firCount,e.nacksCount=r.nackCount,e.plisCount=r.pliCount,e.framesDecodeCount=r.framesDecoded,e.framesDroppedCount=r.framesDropped,e.totalInterFrameDelay=r.totalInterFrameDelay,e.totalSquaredInterFrameDelay=r.totalSquaredInterFrameDelay,e.totalFreezesDuration=r.totalFreezesDuration,e.totalProcessingDelay=r.totalProcessingDelay,e.packetsDiscarded=r.packetsDiscarded,e.framesAssembledFromMultiplePackets=r.framesAssembledFromMultiplePackets,e.totalAssemblyTime=r.totalAssemblyTime,e.keyFramesDecoded=r.keyFramesDecoded,e.retransmittedBytesReceived=r.retransmittedBytesReceived,e.retransmittedPacketsReceived=r.retransmittedPacketsReceived;let t=this.lastDecodeVideoReceiverStats.get(e.ssrc),n=this.lastVideoFramesDecode.get(e.ssrc),i=this.lastVideoFramesOutput.get(e.ssrc),s=Date.now();if(e.framesDecodeCount>0&&!this.isFirstVideoDecoded[e.ssrc]){let o=e.decodedFrame?e.decodedFrame.width:0,c=e.decodedFrame?e.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(e.ssrc,o,c),this.isFirstVideoDecoded[e.ssrc]=!0}if(t){let o=t.stats,c=s-t.lts;e.framesDecodeFreezeTime=o.framesDecodeFreezeTime,e.framesDecodeInterval=o.framesDecodeInterval,!this.isFirstVideoDecoded[e.ssrc]&&c>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[e.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(e.ssrc),this.isFirstVideoDecodedTimeout[e.ssrc]=!0),e.framesDecodeCount>o.framesDecodeCount&&this.isFirstVideoDecoded[e.ssrc]?(t.lts=Date.now(),e.framesDecodeInterval=c,e.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc))?e.framesDecodeFreezeTime+=e.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):e.framesDecodeCount<o.framesDecodeCount&&(e.framesDecodeInterval=0),r.framesDecoded&&r.qpSum&&(t.stats.framesDecodeCount>r.framesDecoded?e.qpSumPerFrame=r.qpSum/r.framesDecoded:e.qpSumPerFrame=(r.qpSum-t.qpSum)/(r.framesDecoded-t.stats.framesDecodeCount))}r.totalDecodeTime&&(e.decodeMs=1e3*r.totalDecodeTime,e.avgDecodeMs=m_(t?.stats,e,"decodeMs","framesDecodeCount")),e.avgProcessingDelayMs=m_(t?.stats,e,"totalProcessingDelay","framesDecodeCount",ic.kMillisecondsFromSeconds),e.avgFramesAssembledFromMultiplePacketsMs=m_(t?.stats,e,"totalAssemblyTime","framesAssembledFromMultiplePackets",ic.kMillisecondsFromSeconds),e.avgInterFrameDelayMs=m_(t?.stats,e,"totalInterFrameDelay","framesDecodeCount",ic.kMillisecondsFromSeconds),n&&s-n.lts>=800?(e.decodeFrameRate=Math.round((e.framesDecodeCount-n.count)/((s-n.lts)/1e3)),this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:s,rate:e.decodeFrameRate})):n?e.decodeFrameRate=n.rate:this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:s,rate:0}),e.framesDroppedCount&&r.framesReceived&&(i&&s-i.lts>=800?(e.outputFrameRate=Math.round((r.framesReceived-e.framesDroppedCount-i.count)/((s-i.lts)/1e3)),this.lastVideoFramesOutput.set(e.ssrc,{count:r.framesReceived-e.framesDroppedCount,lts:s,rate:Math.max(e.outputFrameRate,0)})):i?e.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(e.ssrc,{count:r.framesReceived-e.framesDroppedCount,lts:s,rate:0})),this.processVideoTrackReceiverStats(r,r.trackId,e),r.codecId&&(e.codec=this.getCodecFromCodecStats(r.codecId)),r.framerateMean&&(e.framesRateFirefox=r.framerateMean),e.packets>0&&!this.isFirstVideoReceived[e.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(e.ssrc),this.isFirstVideoReceived[e.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(e.ssrc,{stats:nt({},e),lts:t?t.lts:Date.now(),qpSum:r.qpSum})}processVideoOutboundStats(r){let e=this._stats.videoSend.find(n=>n.ssrc===r.ssrc);e||(e=vu(YU),this._stats.videoSend.push(e));let t=this.mediaBytesSent.get(r.ssrc);if(t)t.add(r.bytesSent);else{let n=new PD(10);n.add(r.bytesSent),this.mediaBytesSent.set(r.ssrc,n)}if(r.retransmittedBytesSent!==void 0){let n=this.mediaBytesRetransmit.get(r.ssrc);if(n)n.add(r.retransmittedBytesSent);else{let i=new PD(10);i.add(r.retransmittedBytesSent),this.mediaBytesRetransmit.set(r.ssrc,i)}}if(r.totalEncodedBytesTarget){let n=this.mediaBytesTargetEncode.get(r.ssrc);if(n)n.add(r.totalEncodedBytesTarget);else{let i=new PD(10);i.add(r.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(r.ssrc,i)}}if(e.ssrc=r.ssrc,e.bytes=r.bytesSent,e.packets=r.packetsSent,e.firsCount=r.firCount,e.nacksCount=r.nackCount,e.plisCount=r.pliCount,e.frameCount=r.framesEncoded,e.adaptionChangeReason=r.qualityLimitationReason,e.scalabilityMode=r.scalabilityMode,e.retransmittedBytesSent=r.retransmittedBytesSent,e.retransmittedPacketsSent=r.retransmittedPacketsSent,e.hugeFramesSent=r.hugeFramesSent,e.keyFramesEncoded=r.keyFramesEncoded,e.targetBitrate=r.targetBitrate,r.totalEncodeTime&&r.framesEncoded){let n=this.lastEncoderMs.get(r.ssrc);if(!n||n.lastFrameCount>r.framesEncoded)e.avgEncodeMs=1e3*r.totalEncodeTime/r.framesEncoded;else{let i=r.framesEncoded-n.lastFrameCount,s=r.totalEncodeTime-n.lastEncoderTime;e.avgEncodeMs=1e3*s/i}}if(r.framesEncoded&&r.qpSum){let n=this.lastEncoderMs.get(r.ssrc);!n||n.lastFrameCount>r.framesEncoded?e.qpSumPerFrame=r.qpSum/r.framesEncoded:e.qpSumPerFrame=(r.qpSum-n.lastQpSum)/(r.framesEncoded-n.lastFrameCount)}if(this.lastEncoderMs.set(r.ssrc,{lastFrameCount:r.framesEncoded,lastEncoderTime:r.totalEncodeTime,lastQpSum:r.qpSum,lts:Date.now()}),r.codecId&&(e.codec=this.getCodecFromCodecStats(r.codecId)),r.mediaSourceId&&this.processVideoMediaSource(r.mediaSourceId,e),this.processVideoTrackSenderStats(r,r.trackId,e),r.remoteId)this.processRemoteInboundStats(r.remoteId,e);else{let n=this.findRemoteStatsId(r.ssrc,ul.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,e)}}processAudioOutboundStats(r){let e=this._stats.audioSend.find(t=>t.ssrc===r.ssrc);if(e||(e=vu(qU),this._stats.audioSend.push(e)),e.ssrc=r.ssrc,e.packets=r.packetsSent,e.bytes=r.bytesSent,e.retransmittedBytesSent=r.retransmittedBytesSent,e.retransmittedPacketsSent=r.retransmittedPacketsSent,r.mediaSourceId&&this.processAudioMediaSource(r.mediaSourceId,e),r.codecId&&(e.codec=this.getCodecFromCodecStats(r.codecId)),this.processAudioTrackSenderStats(r,r.trackId,e),r.remoteId)this.processRemoteInboundStats(r.remoteId,e);else{let t=this.findRemoteStatsId(r.ssrc,ul.REMOTE_INBOUND);t&&this.processRemoteInboundStats(t,e)}}findRemoteStatsId(r,e){var t;let n=Array.from(cs(t=this.report).call(t)).find(i=>i.type===e&&i.ssrc===r);return n?n.id:null}processVideoMediaSource(r,e){let t=this.report.get(r);t&&t.width&&t.height&&t.framesPerSecond&&(e.inputFrame={width:t.width,height:t.height,frameRate:t.framesPerSecond})}processAudioMediaSource(r,e){let t=this.report.get(r);t&&(e.inputLevel=t.audioLevel)}processVideoTrackSenderStats(r,e,t){var n,i,s,o;let c=e?this.report.get(e):void 0,d=(n=c?.framesSent)!==null&&n!==void 0?n:r.framesSent;if(typeof d!="number")return;let u=(i=c?.frameWidth)!==null&&i!==void 0?i:r.frameWidth,p=(s=c?.frameHeight)!==null&&s!==void 0?s:r.frameHeight,m=(o=c?.framesPerSecond)!==null&&o!==void 0?o:r.framesPerSecond;if(typeof u=="number"&&typeof p=="number"||(u=0,p=0),m==null){let g=Date.now(),T=this.lastVideoFramesSent.get(t.ssrc);T&&g-T.lts>=800?(m=Math.round((d-T.count)/((g-T.lts)/1e3)),this.lastVideoFramesSent.set(t.ssrc,{count:d,lts:g,rate:m})):T?m=T.rate:this.lastVideoFramesSent.set(t.ssrc,{count:d,lts:g,rate:0})}t.sentFrame={width:u,height:p,frameRate:Math.max(0,m)}}processVideoTrackReceiverStats(r,e,t){var n,i,s,o,c;let d=e?this.report.get(e):void 0,u=(n=d?.framesReceived)!==null&&n!==void 0?n:r.framesReceived,p=(i=d?.frameWidth)!==null&&i!==void 0?i:r.frameWidth,m=(s=d?.frameHeight)!==null&&s!==void 0?s:r.frameHeight,g=(o=d?.jitterBufferDelay)!==null&&o!==void 0?o:r.jitterBufferDelay,T=(c=d?.jitterBufferEmittedCount)!==null&&c!==void 0?c:r.jitterBufferEmittedCount;if(typeof u=="number"){let R=this.lastVideoFramesRecv.get(t.ssrc),I=Date.now();t.framesReceivedCount=u;let A=0;R&&I-R.lts>=800?(A=Math.round((u-R.count)/((I-R.lts)/1e3)),this.lastVideoFramesRecv.set(t.ssrc,{count:u,lts:I,rate:A})):R?A=R.rate:this.lastVideoFramesRecv.set(t.ssrc,{count:u,lts:I,rate:0}),t.receivedFrame={width:p||0,height:m||0,frameRate:A||0},t.decodedFrame={width:p||0,height:m||0,frameRate:t.decodeFrameRate||0},t.outputFrame={width:p||0,height:m||0,frameRate:t.outputFrameRate||t.decodeFrameRate||0}}if(g&&T){let R=this.lastVideoJBDelay.get(t.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},I=R.jitterBufferMs,A=T-R.jitterBufferEmittedCount;A>0&&(I=1e3*(g-R.jitterBufferDelay)/A),t.jitterBufferMs=I,t.currentDelayMs=Math.round(I),this.lastVideoJBDelay.set(t.ssrc,{jitterBufferDelay:g,jitterBufferEmittedCount:T,jitterBufferMs:t.currentDelayMs})}}processAudioTrackSenderStats(r,e,t){var n,i,s,o;let c=e?this.report.get(e):void 0,d=(n=(i=c?.echoReturnLoss)!==null&&i!==void 0?i:r.echoReturnLoss)!==null&&n!==void 0?n:0,u=(s=(o=c?.echoReturnLossEnhancement)!==null&&o!==void 0?o:r.echoReturnLossEnhancement)!==null&&s!==void 0?s:0;t.aecReturnLoss=d,t.aecReturnLossEnhancement=u}processAudioTrackReceiverStats(r,e,t){var n,i,s,o,c,d,u,p,m;let g=e?this.report.get(e):void 0,T=(n=g?.removedSamplesForAcceleration)!==null&&n!==void 0?n:r.removedSamplesForAcceleration,R=(i=g?.totalSamplesReceived)!==null&&i!==void 0?i:r.totalSamplesReceived,I=(s=g?.jitterBufferDelay)!==null&&s!==void 0?s:r.jitterBufferDelay,A=(o=g?.jitterBufferEmittedCount)!==null&&o!==void 0?o:r.jitterBufferEmittedCount,w=(c=g?.audioLevel)!==null&&c!==void 0?c:r?.audioLevel,k=(d=g?.totalSamplesDuration)!==null&&d!==void 0?d:r?.totalSamplesDuration,L=(u=g?.concealedSamples)!==null&&u!==void 0?u:r.concealedSamples,j=(p=g?.silentConcealedSamples)!==null&&p!==void 0?p:r.silentConcealedSamples,K=(m=g?.concealmentEvents)!==null&&m!==void 0?m:r.concealmentEvents;if(typeof R=="number"&&(t.totalSamplesReceived=R),typeof j=="number"&&(t.silentConcealedSamples=j),typeof K=="number"&&(t.concealmentEvents=K),typeof L=="number"&&(t.concealedSamples=L),T&&R&&(t.accelerateRate=T/R),I&&A){let Y=this.lastAudioJBDelay.get(t.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},se=Y.jitterBufferMs,de=A-Y.jitterBufferEmittedCount;de>0&&(se=1e3*(I-Y.jitterBufferDelay)/de),t.jitterBufferMs=Math.round(se),this.lastAudioJBDelay.set(t.ssrc,{jitterBufferDelay:I,jitterBufferEmittedCount:A,jitterBufferMs:t.jitterBufferMs})}t.outputLevel=w;let W=1920;k&&R&&(W=R/k/50,t.receivedFrames=Math.round(R/W)),L&&(t.droppedFrames=Math.round(L/W))}processRemoteInboundStats(r,e){let t=this.report.get(r);t&&(e.packetsLost=t.packetsLost,t.roundTripTime&&(e.rttMs=1e3*t.roundTripTime),t.jitter&&(e.jitterMs=1e3*t.jitter),t.timestamp&&(e.timestamp=t.timestamp))}getCodecFromCodecStats(r){let e=this.report.get(r);if(!e)return"";let t=e.mimeType.match(/\/(.*)$/);return t&&t[1]?t[1]:""}updateSendBitrate(){let r=0,e=null,t=null;this.mediaBytesSent.forEach(i=>{r+=i.diffMean()}),this.mediaBytesRetransmit.forEach(i=>{e=e===null?i.diffMean():e+i.diffMean()}),this.mediaBytesTargetEncode.forEach(i=>{t=t===null?i.diffMean():t+i.diffMean()});let n=e!==null?r-e:r;this._stats.bitrate={actualEncoded:8*n/(this.options.updateInterval/1e3),transmit:8*r/(this.options.updateInterval/1e3)},e!==null&&(this._stats.bitrate.retransmit=8*e/(this.options.updateInterval/1e3)),t!==null&&(this._stats.bitrate.targetEncoded=8*t/(this.options.updateInterval/1e3))}},o4=class extends kD{updateStats(){return De.resolve()}};function QU(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4,s=(function(){let o=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return o&&o[0]?Number(o[0].split("/")[1]):null})();return s?s<76?new JU(r,{updateInterval:e,lossRateInterval:t,freezeRateLimit:n,firstVideoDecodedTimeout:i}):new SC(r,{updateInterval:e,lossRateInterval:t,freezeRateLimit:n,firstVideoDecodedTimeout:i}):(function(o){if(!window.RTCStatsReport)return!1;let c=o.getStats();return!!(c instanceof De||(function(d){return!!d&&(typeof d=="object"||typeof d=="function")&&typeof d.then=="function"})(c))})(r)?new SC(r,{updateInterval:e,lossRateInterval:t,freezeRateLimit:n,firstVideoDecodedTimeout:i}):new o4(r,{updateInterval:e,lossRateInterval:t,freezeRateLimit:n,firstVideoDecodedTimeout:i})}let LD="websdk_ng_install_id";function MD(){try{if(te("INSTALL_ID"))return te("INSTALL_ID");let r=window.localStorage.getItem(LD);return r||(r=Oi(),window.localStorage.setItem(LD,r)),en("INSTALL_ID",r),r}catch{return}}let Yl=(function(r){if(r.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return r;let e=r.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(e&&e[1]&&e[2]){let t=e[1],n=e[2];return"".concat(t,".").concat(n)}return"4.0.0.999"})("4.24.0"),ql=(function(){try{return JSON.parse("true")===!0}catch{return!0}})(),Um=(function(r){return r.Default="default",r.Auto="auto",r.Relay="relay",r.SdRtn="sd-rtn",r})({}),Bs=(function(){let r="us".concat("erna","me"),e="pa".concat("sswo","rd"),t=["t","s","t"];t.splice(1,0,"e");let n=t.join(""),i=[];for(let c=0;c<6;c++)i.push("1");let s=i.join(""),o={};return o[r]=n,o[e]=s,Object.assign(o,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})})();window.DEFAULT_TURN_CONFIG=Bs;let go={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},TC={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},Ow="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",Nw={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},or=nt(nt(nt(nt({},Nw),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:TC,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},go),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function en(r,e,t){var n,i,s;Re(n=Object.keys(or)).call(n,r)&&(!t&&Re(i=Object.keys(Eh)).call(i,r)||(or[r]=e,r!=="ENABLE_VIDEO_SEI"&&r!=="ENABLE_AUDIO_TOPN"&&r!=="ENABLE_AUDIO_METADATA"&&r!=="ENABLE_AUDIO_PTS"||e!==!0||(or.ENABLE_ENCODED_TRANSFORM=!0),r==="USE_NEW_NETWORK_CONFIG"&&e&&(s=!!e,or.USE_NEW_NETWORK_CONFIG=s,s&&(or.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],or.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],or.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],or.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],or.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",or.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",or.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),r==="ENABLE_PRE_SUB"&&e&&(or.ENABLE_INSTANT_VIDEO=!0,or.ENABLE_PREALLOC_PC=!0),r==="ENABLE_SVC"&&e&&(or.ENABLE_AUT_CC=!0),r==="NEW_FORCE_TURN"&&e&&(or.NEW_TURN_MODE||(or.NEW_TURN_MODE=4))))}function te(r){return or[r]}ql||(or.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],or.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],or.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],or.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],or.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],or.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],or.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",or.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",or.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",or.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",or.AREAS=["NORTH_AMERICA","OVERSEA"]);let re=(function(r){return r[r.REALTIME=1]="REALTIME",r})({}),Eh={};var zt=(function(r){return r.SET_SESSION_ID="SET_SESSION_ID",r.SET_P2P_ID="SET_P2P_id",r.SET_DC_ID="SET_DC_id",r.SET_UID="SET_UID",r.SET_INT_UID="SET_INT_UID",r.SET_PUB_ID="SET_PUB_ID",r.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",r.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",r.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",r.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",r.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",r.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",r.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",r.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",r.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",r.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",r.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",r.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",r.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",r.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",r.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",r.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",r.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",r.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",r.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",r.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",r.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",r.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",r.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",r.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",r.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",r.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",r.RESET_KEY_METRICS="RESET_KEY_METRICS",r.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",r.SET_USE_P2P="SET_USE_P2P",r.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",r})(zt||{});let tn=(function(r){return r.h264="h264",r.h265="h265",r.vp8="vp8",r.vp9="vp9",r.av1="av1",r})({});(function(r){r.opus="opus",r.pcma="pcma",r.pcmu="pcmu",r.g722="g722"})({});let vC=128,a4=96,c4=1e3,vv=10,yC=0;var l4=(()=>{var r={8:(n,i,s)=>{s.r(i),s.d(i,{Parser:()=>de,Printer:()=>Ct,parse:()=>Se,print:()=>we});let o=`
`,c="".concat("\r").concat(o),d=" ",u;function p(be){return be>="0"&&be<="9"}function m(be){return be>="!"&&be<="~"}function g(be){return m(be)||be>=""&&be<="ÿ"}function T(be){return be==="!"||be>="#"&&be<="'"||be>="*"&&be<="+"||be>="-"&&be<="."||be>="0"&&be<="9"||be>="A"&&be<="Z"||be>="^"&&be<="~"}function R(be){return be>="1"&&be<="9"}function I(be){return be>="A"&&be<="Z"||be>="a"&&be<="z"}function A(be){return be==="d"||be==="h"||be==="m"||be==="s"}function w(be){return be>""&&be<"	"||be>"\v"&&be<"\f"||be>""&&be<"ÿ"}function k(be){return I(be)||p(be)||be==="+"||be==="/"}function L(be){return p(be)||I(be)||be==="+"||be==="/"||be==="-"||be==="_"}function j(be){return I(be)||p(be)||be==="+"||be==="/"}function K(be,M){var O=Object.keys(be);if(Object.getOwnPropertySymbols){var G=Object.getOwnPropertySymbols(be);M&&(G=G.filter(function(ne){return Object.getOwnPropertyDescriptor(be,ne).enumerable})),O.push.apply(O,G)}return O}function W(be){for(var M=1;M<arguments.length;M++){var O=arguments[M]!=null?arguments[M]:{};M%2?K(Object(O),!0).forEach(function(G){Y(be,G,O[G])}):Object.getOwnPropertyDescriptors?Object.defineProperties(be,Object.getOwnPropertyDescriptors(O)):K(Object(O)).forEach(function(G){Object.defineProperty(be,G,Object.getOwnPropertyDescriptor(O,G))})}return be}function Y(be,M,O){return M in be?Object.defineProperty(be,M,{value:O,enumerable:!0,configurable:!0,writable:!0}):be[M]=O,be}(function(be){be.VERSION="v",be.ORIGIN="o",be.SESSION_NAME="s",be.INFORMATION="i",be.URI="u",be.EMAIL="e",be.PHONE="p",be.CONNECTION="c",be.BANDWIDTH="b",be.TIME="t",be.REPEAT="r",be.ZONE_ADJUSTMENTS="z",be.KEY="k",be.ATTRIBUTE="a",be.MEDIA="m"})(u||(u={}));class se{consumeText(M,O){let G=O;for(;G<M.length;){let ne=M[G];if(ne==="\0"||ne==="\r"||ne===o)break;G+=1}if(G-O==0)throw new Error("Invalid text, at ".concat(M));return G}consumeUnicastAddress(M,O,G){return this.consumeTill(M,O,d)}consumeOneOrMore(M,O,G){let ne=O;for(;G(M[ne]);)ne++;if(ne-O==0)throw new Error("Invalid rule at ".concat(O,"."));return ne}consumeSpace(M,O){if(M[O]===d)return O+1;throw new Error("Invalid space at ".concat(O,"."))}consumeIP4Address(M,O){let G=O;for(let ne=0;ne<4;ne++)if(G=this.consumeDecimalUChar(M,G),ne!==3){if(M[G]!==".")throw new Error("Invalid IP4 address.");G++}return G}consumeDecimalUChar(M,O){let G=O;for(let Be=0;Be<3&&p(M[G]);Be++,G++);if(G-O==0)throw new Error("Invalid decimal uchar.");let ne=parseInt(M.slice(O,G));if(ne>=0&&ne<=255)return G;throw new Error("Invalid decimal uchar")}consumeIP6Address(M,O){let G=this.consumeHexpart(M,O);return M[G]===":"&&(G+=1,G=this.consumeIP4Address(M,G)),G}consumeHexpart(M,O){let G=O;if(M[G]===":"&&M[G+1]===":"){G+=2;try{G=this.consumeHexseq(M,G)}catch{}return G}if(G=this.consumeHexseq(M,G),M[G]===":"&&M[G+1]===":"){G+=2;try{G=this.consumeHexseq(M,G)}catch{}return G}return G}consumeHexseq(M,O){let G=O;for(;G=this.consumeHex4(M,G),M[G]===":"&&M[G+1]!==":";)G+=1;return G}consumeHex4(M,O){let G=0;for(;G<4;G++)if(!((ne=M[O+G])>="0"&&ne<="9"||ne>="a"&&ne<="f"||ne>="A"&&ne<="F")){if(G===0)throw new Error("Invalid hex 4");break}var ne;return O+G}consumeFQDN(M,O){let G=O;for(;p(M[G])||I(M[G])||M[G]==="-"||M[G]===".";)G+=1;if(G-O<4)throw new Error("Invalid FQDN");return G}consumeExtnAddr(M,O){return this.consumeOneOrMore(M,O,g)}consumeMulticastAddress(M,O,G){switch(G){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(M,O);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(M,O);default:try{return this.consumeFQDN(M,O)}catch{return this.consumeExtnAddr(M,O)}}}consumeIP6MulticastAddress(M,O){let G=this.consumeHexpart(M,O);return M[G]==="/"?this.consumeInteger(M,G+1):G}consumeIP4MulticastAddress(M,O){let G=O+3,ne=M.slice(O,G),Be=parseInt(ne);if(Be<224||Be>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Lt=0;Lt<3;Lt++){if(M[G]!==".")throw new Error("Invalid IP4 multicast address.");G+=1,G=this.consumeDecimalUChar(M,G)}return M[G]==="/"&&(G+=1),G=this.consumeTTL(M,G),M[G]==="/"&&(G=this.consumeInteger(M,G)),G}consumeInteger(M,O){if(!R(M[O]))throw new Error("Invalid integer.");for(O+=1;p(M[O]);)O+=1;return O}consumeTTL(M,O){if(M[O]==="0")return O+1;if(!R(M[O]))throw new Error("Invalid TTL.");O+=1;for(let G=0;G<2&&p(M[O]);G++)O+=1;return O}consumeToken(M,O){return this.consumeOneOrMore(M,O,T)}consumeTime(M,O){let G=O;if(M[G]==="0")return G+1;for(R(M[G])&&(G+=1);p(M[G]);)G++;if(G-O<10)throw new Error("Invalid time");return G}consumeAddress(M,O){return this.consumeTill(M,O,d)}consumeTypedTime(M,O){let G=O;return G=this.consumeOneOrMore(M,G,p),A(M[G])?G+1:G}consumeRepeatInterval(M,O){if(!R(M[O]))throw new Error("Invalid repeat interval");for(O+=1;p(M[O]);)O+=1;return A(M[O])&&(O+=1),O}consumePort(M,O){return this.consumeOneOrMore(M,O,p)}consume(M,O,G){for(let ne=0;ne<G.length;ne++){if(O+ne>=M.length)throw new Error("consume exceeding value length");if(M[O+ne]!==G[ne])throw new Error("consume ".concat(G," failed at ").concat(ne))}return O+G.length}consumeTill(M,O,G){let ne=O;for(;ne<M.length&&(typeof G!="string"||M[ne]!==G)&&(typeof G!="function"||!G(M[ne]));)ne++;return ne}}class de extends se{constructor(){super(),Y(this,"records",[]),Y(this,"currentLine",0)}parse(M){let O=this.probeEOL(M);this.records=M.split(O).filter(Da=>!!dr(Da).call(Da)).map(this.parseLine),this.currentLine=0;let G=this.parseVersion(),ne=this.parseOrigin(),Be=this.parseSessionName(),Lt=this.parseInformation(),yn=this.parseUri(),tr=this.parseEmail(),xo=this.parsePhone(),Rl=this.parseConnection(),Sf=this.parseBandWidth(),xh=this.parseTimeFields(),hE=this.parseKey(),Xv=this.parseSessionAttribute(),Cl=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:G,origin:ne,sessionName:Be,information:Lt,uri:yn,emails:tr,phones:xo,connection:Rl,bandwidths:Sf,timeFields:xh,key:hE,attributes:Xv,mediaDescriptions:Cl}}getCurrentRecord(){let M=this.records[this.currentLine];if(!M)throw new Error("Record doesn't exit.");return M}probeEOL(M){for(let O=0;O<M.length;O++)if(M[O]===o)return M[O-1]==="\r"?c:o;throw new Error("Invalid newline character.")}parseLine(M,O){if(M.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let G=M[0];if(M[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:G,value:M.slice(2),line:O,cur:0}}parseSessionAttribute(){let M=new je;for(;this.currentLine<this.records.length;){let O=this.getCurrentRecord();if(O.type!==u.ATTRIBUTE)break;let G={attField:this.extractOneOrMore(O,ne=>T(ne)&&ne!==":"),_cur:0};O.value[O.cur]===":"&&(O.cur+=1,G.attValue=this.extractOneOrMore(O,w)),M.parse(G),this.currentLine++}return M.digest()}parseMediaAttributes(M){let O=new _t(M);for(;this.currentLine<this.records.length;){let G=this.getCurrentRecord();if(G.type!==u.ATTRIBUTE)break;let ne={attField:this.extractOneOrMore(G,Be=>T(Be)&&Be!==":"),_cur:0};G.value[G.cur]===":"&&(G.cur+=1,ne.attValue=this.extractOneOrMore(G,w)),O.parse(ne),this.currentLine++}return O.digest()}parseKey(){let M=this.getCurrentRecord();if(M.type===u.KEY){if(M.value==="prompt"||M.value==="clear:"||M.value==="base64:"||M.value==="uri:")return M.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){let M=this.getCurrentRecord();if(M.type===u.ZONE_ADJUSTMENTS){let O=[];for(;;)try{let G=this.extract(M,this.consumeTime);this.consumeSpaceForRecord(M);let ne=!1;M.value[M.cur]==="-"&&(ne=!0,M.cur+=1);let Be=this.extract(M,this.consumeTypedTime);O.push({time:G,typedTime:Be,back:ne})}catch{break}if(O.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,O}return[]}parseRepeat(){let M=[];for(;;){let O=this.getCurrentRecord();if(O.type!==u.REPEAT)break;{let G=this.extract(O,this.consumeRepeatInterval),ne=this.parseTypedTime(O);M.push({repeatInterval:G,typedTimes:ne}),this.currentLine++}}return M}parseTypedTime(M){let O=[];for(;;)try{this.consumeSpaceForRecord(M),O.push(this.extract(M,this.consumeTypedTime))}catch{break}if(O.length===0)throw new Error("Invalid typed time.");return O}parseTime(){let M=this.getCurrentRecord(),O=this.extract(M,this.consumeTime);this.consumeSpaceForRecord(M);let G=this.extract(M,this.consumeTime);return this.currentLine++,{startTime:O,stopTime:G}}parseBandWidth(){let M=[];for(;this.currentLine<this.records.length;){let O=this.getCurrentRecord();if(O.type!==u.BANDWIDTH)break;{let G=this.extractOneOrMore(O,T);if(O.value[O.cur]!==":")throw new Error("Invalid bandwidth field.");O.cur++;let ne=this.extractOneOrMore(O,p);M.push({bwtype:G,bandwidth:ne}),this.currentLine++}}return M}parseVersion(){let M=this.getCurrentRecord();if(M.type!==u.VERSION)throw new Error("first sdp record must be version");let O=M.value.slice(0,this.consumeOneOrMore(M.value,0,p));if(O.length!==M.value.length)throw new Error('invalid proto version, "v='.concat(M.value,'"'));return this.currentLine++,O}parseOrigin(){let M=this.getCurrentRecord();if(M.type!==u.ORIGIN)throw new Error("second line of sdp must be origin");let O=this.extractOneOrMore(M,g);this.consumeSpaceForRecord(M);let G=this.extractOneOrMore(M,p);this.consumeSpaceForRecord(M);let ne=this.extractOneOrMore(M,p);this.consumeSpaceForRecord(M);let Be=this.extractOneOrMore(M,T);this.consumeSpaceForRecord(M);let Lt=this.extractOneOrMore(M,T);this.consumeSpaceForRecord(M);let yn=this.extract(M,this.consumeUnicastAddress);return this.currentLine++,{username:O,sessId:G,sessVersion:ne,nettype:Be,addrtype:Lt,unicastAddress:yn}}parseSessionName(){let M=this.getCurrentRecord();if(M.type===u.SESSION_NAME){let O=this.extract(M,this.consumeText);return this.currentLine++,O}}parseInformation(){let M=this.getCurrentRecord();if(M.type!==u.INFORMATION)return;let O=this.extract(M,this.consumeText);return this.currentLine++,O}parseUri(){let M=this.getCurrentRecord();if(M.type===u.URI)return this.currentLine++,M.value}parseEmail(){let M=[];for(;;){let O=this.getCurrentRecord();if(O.type!==u.EMAIL)break;M.push(O.value),this.currentLine++}return M}parsePhone(){let M=[];for(;;){let O=this.getCurrentRecord();if(O.type!==u.PHONE)break;M.push(O.value),this.currentLine++}return M}parseConnection(){let M=this.getCurrentRecord();if(M.type===u.CONNECTION){let O=this.extractOneOrMore(M,T);this.consumeSpaceForRecord(M);let G=this.extractOneOrMore(M,T);this.consumeSpaceForRecord(M);let ne=this.extract(M,this.consumeAddress);return this.currentLine++,{nettype:O,addrtype:G,address:ne}}}parseMedia(){let M=this.getCurrentRecord(),O=this.extract(M,this.consumeToken);this.consumeSpaceForRecord(M);let G=this.extract(M,this.consumePort);M.value[M.cur]==="/"&&(M.cur+=1,G+=this.extract(M,this.consumeInteger)),this.consumeSpaceForRecord(M);let ne=[];for(ne.push(this.extract(M,this.consumeToken));M.value[M.cur]==="/";)M.cur+=1,ne.push(this.extract(M,this.consumeToken));if(ne.length===0)throw new Error("Invalid proto");let Be=this.parseFmt(M);return this.currentLine++,{mediaType:O,port:G,protos:ne,fmts:Be}}parseTimeFields(){let M=[];for(;this.getCurrentRecord().type===u.TIME;){let O=this.parseTime(),G=this.parseRepeat(),ne=this.parseZone();M.push({time:O,repeats:G,zones:ne})}return M}parseMediaDescription(){let M=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===u.MEDIA;){let O=this.parseMedia(),G=this.parseInformation(),ne=this.parseConnections(),Be=this.parseBandWidth(),Lt=this.parseKey(),yn=this.parseMediaAttributes(O);M.push({media:O,information:G,connections:ne,bandwidths:Be,key:Lt,attributes:yn})}return M}parseConnections(){let M=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===u.CONNECTION;)M.push(this.parseConnection());return M}parseFmt(M){let O=[];for(;;)try{this.consumeSpaceForRecord(M),O.push(this.extract(M,this.consumeToken))}catch{break}if(O.length===0)throw new Error("Invalid fmts");return O}extract(M,O){for(var G=arguments.length,ne=new Array(G>2?G-2:0),Be=2;Be<G;Be++)ne[Be-2]=arguments[Be];let Lt=O.call(this,M.value,M.cur,...ne),yn=M.value.slice(M.cur,Lt);return M.cur=Lt,yn}extractOneOrMore(M,O){let G=this.consumeOneOrMore(M.value,M.cur,O),ne=M.value.slice(M.cur,G);return M.cur=G,ne}consumeSpaceForRecord(M){if(M.value[M.cur]!==d)throw new Error("Invalid space at ".concat(M.cur,"."));M.cur+=1}}class ge extends se{constructor(){super(...arguments),Y(this,"attributes",void 0),Y(this,"digested",!1)}extractOneOrMore(M,O,G){let ne=this.consumeOneOrMore(M.attValue,M._cur,O),Be=M.attValue.slice(M._cur,ne),[Lt,yn]=G||[];if(typeof Lt=="number"&&Be.length<Lt)throw new Error("error in length, should be more or equal than ".concat(Lt," characters."));if(typeof yn=="number"&&Be.length>yn)throw new Error("error in length, should be less or equal than ".concat(yn," characters."));return M._cur=ne,Be}consumeAttributeSpace(M){if(M.attValue[M._cur]!==d)throw new Error("Invalid space at ".concat(M._cur,"."));M._cur+=1}extract(M,O){if(!M.attValue)throw new Error("Nothing to extract from attValue.");for(var G=arguments.length,ne=new Array(G>2?G-2:0),Be=2;Be<G;Be++)ne[Be-2]=arguments[Be];let Lt=O.call(this,M.attValue,M._cur,...ne),yn=M.attValue.slice(M._cur,Lt);return M._cur=Lt,yn}atEnd(M){if(!M.attValue)throw new Error;return M._cur>=M.attValue.length}peekChar(M){if(!M.attValue)throw new Error;return M.attValue[M._cur]}peek(M,O){if(!M.attValue)throw new Error;for(let G=0;G<O.length;G++)if(O[G]!==M.attValue[M._cur+G])return!1;return!0}parseIceUfrag(M){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(M,k,[4,256])}parseIcePwd(M){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(M,k,[22,256])}parseIceOptions(M){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");let O=[];for(;!this.atEnd(M);){O.push(this.extractOneOrMore(M,k));try{this.consumeAttributeSpace(M)}catch(G){if(this.atEnd(M))break;throw G}}this.attributes.iceOptions=O}parseFingerprint(M){let O=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);let G=this.extract(M,this.consumeTill);this.attributes.fingerprints.push({hashFunction:O,fingerprint:G})}parseExtmap(M){let O=this.extractOneOrMore(M,p),G;this.peekChar(M)==="/"&&(this.extract(M,this.consume,"/"),G=this.extract(M,this.consumeToken)),this.consumeAttributeSpace(M);let ne=this.extract(M,this.consumeTill,d),Be=W(W({entry:parseInt(O,10)},G&&{direction:G}),{},{extensionName:ne});this.peekChar(M)===d&&(this.consumeAttributeSpace(M),Be.extensionAttributes=this.extract(M,this.consumeTill)),this.attributes.extmaps.push(Be)}parseSetup(M){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");let O=this.extract(M,this.consumeTill);if(O!=="active"&&O!=="passive"&&O!=="actpass"&&O!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=O}}class je extends ge{constructor(){super(...arguments),Y(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(M){if(this.digested)throw new Error("already digested");try{switch(M.attField){case"group":this.parseGroup(M);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(M);break;case"ice-pwd":this.parseIcePwd(M);break;case"ice-options":this.parseIceOptions(M);break;case"fingerprint":this.parseFingerprint(M);break;case"setup":this.parseSetup(M);break;case"tls-id":this.parseTlsId(M);break;case"identity":this.parseIdentity(M);break;case"extmap":this.parseExtmap(M);break;case"msid-semantic":this.parseMsidSemantic(M);break;default:M.ignored=!0,this.attributes.unrecognized.push(M)}}catch(O){throw console.error("parsing session attribute ".concat(M.attField,' error, "a=').concat(M.attField,":").concat(M.attValue,'"')),O}if(!M.ignored&&M.attValue&&!this.atEnd(M))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(M){let O=this.extract(M,this.consumeToken),G=[];for(;!this.atEnd(M)&&this.peekChar(M)===d;)this.consumeAttributeSpace(M),G.push(this.extract(M,this.consumeToken));this.attributes.groups.push({semantic:O,identificationTag:G})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(M){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(M,L)}parseIdentity(M){let O=this.extractOneOrMore(M,j),G=[];for(;!this.atEnd(M)&&this.peekChar(M)===d;){this.consumeAttributeSpace(M);let ne=this.extract(M,this.consumeToken);this.extract(M,this.consume,"=");let Be=this.extractOneOrMore(M,Lt=>Lt!==d&&w(Lt));G.push({name:ne,value:Be})}this.attributes.identities.push({assertionValue:O,extensions:G})}parseMsidSemantic(M){this.peekChar(M)===d&&this.consumeAttributeSpace(M);let O={semantic:this.extract(M,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(M)}catch{break}if(this.peekChar(M)==="*"){this.extract(M,this.consume,"*"),O.applyForAll=!0;break}{let G=this.extract(M,this.consumeTill,d);O.identifierList.push(G)}}this.attributes.msidSemantic=O}}class _t extends ge{constructor(M){super(),Y(this,"attributes",void 0),M.protos.indexOf("RTP")!==-1||M.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(M){if(this.digested)throw new Error("already digested");try{switch(M.attField){case"extmap":this.parseExtmap(M);break;case"setup":this.parseSetup(M);break;case"ice-ufrag":this.parseIceUfrag(M);break;case"ice-pwd":this.parseIcePwd(M);break;case"ice-options":this.parseIceOptions(M);break;case"candidate":this.parseCandidate(M);break;case"remote-candidate":this.parseRemoteCandidate(M);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(M);break;case"rtpmap":this.parseRtpmap(M);break;case"ptime":this.parsePtime(M);break;case"maxptime":this.parseMaxPtime(M);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(M);break;case"ssrc":this.parseSSRC(M);break;case"fmtp":this.parseFmtp(M);break;case"rtcp-fb":this.parseRtcpFb(M);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(M);break;case"mid":this.parseMid(M);break;case"msid":this.parseMsid(M);break;case"imageattr":this.parseImageAttr(M);break;case"rid":this.parseRid(M);break;case"simulcast":this.parseSimulcast(M);break;case"sctp-port":this.parseSctpPort(M);break;case"max-message-size":this.parseMaxMessageSize(M);break;case"ssrc-group":this.parseSSRCGroup(M);break;default:M.ignored=!0,this.attributes.unrecognized.push(M)}}catch(O){throw console.error("parsing media attribute ".concat(M.attField,' error, "a=').concat(M.attField,":").concat(M.attValue,'"')),O}if(!M.ignored&&M.attValue&&!this.atEnd(M))throw new Error("attribute parsing error")}parseCandidate(M){let O=this.extractOneOrMore(M,k,[1,32]);this.consumeAttributeSpace(M);let G=this.extractOneOrMore(M,p,[1,5]);this.consumeAttributeSpace(M);let ne=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);let Be=this.extractOneOrMore(M,p,[1,10]);this.consumeAttributeSpace(M);let Lt=this.extract(M,this.consumeAddress);this.consumeAttributeSpace(M);let yn=this.extract(M,this.consumePort);this.consumeAttributeSpace(M),this.extract(M,this.consume,"typ"),this.consumeAttributeSpace(M);let tr={foundation:O,componentId:G,transport:ne,priority:Be,connectionAddress:Lt,port:yn,type:this.extract(M,this.consumeToken),extension:{}};for(this.peek(M," raddr")&&(this.extract(M,this.consume," raddr"),this.consumeAttributeSpace(M),tr.relAddr=this.extract(M,this.consumeAddress)),this.peek(M," rport")&&(this.extract(M,this.consume," rport"),this.consumeAttributeSpace(M),tr.relPort=this.extract(M,this.consumePort));this.peekChar(M)===d;){this.consumeAttributeSpace(M);let xo=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M),tr.extension[xo]=this.extractOneOrMore(M,m)}this.attributes.candidates.push(tr)}parseRemoteCandidate(M){let O=[];for(;;){let G=this.extractOneOrMore(M,p,[1,5]);this.consumeAttributeSpace(M);let ne=this.extract(M,this.consumeAddress);this.consumeAttributeSpace(M);let Be=this.extract(M,this.consumePort);O.push({componentId:G,connectionAddress:ne,port:Be});try{this.consumeAttributeSpace(M)}catch{break}}this.attributes.remoteCandidatesList.push(O)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(M){let O=this.extract(M,this.consumeToken);this.consumeAttributeSpace(M);let G=this.extract(M,this.consumeTill,"/");this.extract(M,this.consume,"/");let ne={encodingName:G,clockRate:this.extractOneOrMore(M,p)};this.atEnd(M)||this.peekChar(M)!=="/"||(this.extract(M,this.consume,"/"),ne.encodingParameters=parseInt(this.extract(M,this.consumeTill),10));let Be=this.attributes.payloads.find(Lt=>Lt.payloadType===parseInt(O,10));Be?Be.rtpMap=ne:this.attributes.payloads.push({payloadType:parseInt(O,10),rtpMap:ne,rtcpFeedbacks:[]})}parsePtime(M){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(M,this.consumeTill)}parseMaxPtime(M){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(M,this.consumeTill)}parseDirection(M){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=M.attField}parseSSRC(M){let O=this.extractOneOrMore(M,p);this.consumeAttributeSpace(M);let G=this.extract(M,this.consumeTill,":"),ne;this.peekChar(M)===":"&&(this.extract(M,this.consume,":"),ne=this.extract(M,this.consumeTill));let Be=this.attributes.ssrcs.find(Lt=>Lt.ssrcId===parseInt(O,10));Be?Be.attributes[G]=ne:this.attributes.ssrcs.push({ssrcId:parseInt(O,10),attributes:{[G]:ne}})}parseFmtp(M){let O=this.extract(M,this.consumeTill,d);this.consumeAttributeSpace(M);let G=this.extract(M,this.consumeTill),ne={};G.split(";").forEach(Lt=>{let[yn,tr]=Lt.split("=");yn=dr(yn).call(yn);let xo=typeof tr=="string"?dr(tr).call(tr):null;typeof yn=="string"&&yn.length>0&&(ne[yn]=xo)});let Be=this.attributes.payloads.find(Lt=>Lt.payloadType===parseInt(O,10));Be?Be.fmtp={parameters:ne}:this.attributes.payloads.push({payloadType:parseInt(O,10),rtcpFeedbacks:[],fmtp:{parameters:ne}})}parseFmtParameters(M){let O={},G=this.extract(M,this.consumeTill,"=");M._cur++;let ne=this.extract(M,this.consumeTill,";");for(O[G]=ne;M.attValue[M._cur]===";";){let Be=this.extract(M,this.consumeTill,"=");M._cur++;let Lt=this.extract(M,this.consumeTill,";");O[Be]=Lt}return O}parseRtcpFb(M){let O="";O=this.peekChar(M)==="*"?this.extract(M,this.consume,"*"):this.extract(M,this.consumeTill,d),this.consumeAttributeSpace(M);let G=this.extract(M,this.consumeTill,d),ne;if(G==="trr-int")ne={type:G,interval:this.extract(M,this.consumeTill)};else{let Be={type:G};this.peekChar(M)===d&&(this.consumeAttributeSpace(M),Be.parameter=this.extract(M,this.consumeToken),this.peekChar(M)===d&&(Be.additional=this.extract(M,this.consumeTill))),ne=Be}if(O==="*")this.attributes.rtcpFeedbackWildcards.push(ne);else{let Be=this.attributes.payloads.find(Lt=>Lt.payloadType===parseInt(O,10));Be?Be.rtcpFeedbacks.push(ne):this.attributes.payloads.push({payloadType:parseInt(O,10),rtcpFeedbacks:[ne]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(M){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");let O={port:this.extract(M,this.consumePort)};this.peekChar(M)===d&&(this.consumeAttributeSpace(M),O.netType=this.extractOneOrMore(M,T),this.consumeAttributeSpace(M),O.addressType=this.extractOneOrMore(M,T),this.consumeAttributeSpace(M),O.address=this.extract(M,this.consumeAddress)),this.attributes.rtcp=O}parseMsid(M){let O={id:this.extractOneOrMore(M,T,[1,64])};this.peekChar(M)===d&&(this.consumeAttributeSpace(M),O.appdata=this.extractOneOrMore(M,T,[1,64])),this.attributes.msids.push(O)}parseImageAttr(M){this.attributes.imageattr.push(M.attValue)}parseRid(M){let O=this.extractOneOrMore(M,ne=>I(ne)||p(ne)||ne==="_"||ne==="-");this.consumeAttributeSpace(M);let G={id:O,direction:this.extract(M,this.consumeToken),params:[]};if(this.peekChar(M)===d){if(this.consumeAttributeSpace(M),this.peek(M,"pt=")){this.extract(M,this.consume,"pt=");let ne=[];for(;;){let Be=this.extract(M,this.consumeToken);ne.push(Be);try{this.extract(M,this.consume,",")}catch{break}}G.payloads=ne,this.peekChar(M)===d&&this.extract(M,this.consume,d)}for(;;){let ne=this.extract(M,this.consumeToken);switch(ne){case"depend":{let Be={type:ne,rids:this.extract(M,this.consume,"=").split(",")};G.params.push(Be);break}default:{let Be={type:ne};this.peekChar(M)==="="&&(this.extract(M,this.consume,"="),Be.val=this.extract(M,this.consumeTill,";")),G.params.push(Be)}}try{this.extract(M,this.consume,";")}catch{break}}}this.attributes.rids.push(G)}parseSimulcast(M){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=M.attValue,this.extract(M,this.consumeTill)}parseSctpPort(M){this.attributes.sctpPort=this.extractOneOrMore(M,p,[1,5])}parseMaxMessageSize(M){this.attributes.maxMessageSize=this.extractOneOrMore(M,p,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(M){this.attributes.mid=this.extract(M,this.consumeToken)}parseSSRCGroup(M){let O=this.extract(M,this.consumeToken),G=[];for(;;)try{this.consumeAttributeSpace(M);let ne=this.extract(M,this.consumeInteger);G.push(parseInt(ne,10))}catch{break}this.attributes.ssrcGroups.push({semantic:O,ssrcIds:G})}}function ht(be,M,O){return M in be?Object.defineProperty(be,M,{value:O,enumerable:!0,configurable:!0,writable:!0}):be[M]=O,be}class Ct{constructor(){ht(this,"eol",c)}print(M,O){let G="";return O&&(this.eol=O),G+=this.printVersion(M.version),G+=this.printOrigin(M.origin),G+=this.printSessionName(M.sessionName),G+=this.printInformation(M.information),G+=this.printUri(M.uri),G+=this.printEmail(M.emails),G+=this.printPhone(M.phones),G+=this.printConnection(M.connection),G+=this.printBandwidth(M.bandwidths),G+=this.printTimeFields(M.timeFields),G+=this.printKey(M.key),G+=this.printSessionAttributes(M.attributes),G+=this.printMediaDescription(M.mediaDescriptions),G}printVersion(M){return"v=".concat(M).concat(this.eol)}printOrigin(M){return"o=".concat(M.username," ").concat(M.sessId," ").concat(M.sessVersion," ").concat(M.nettype," ").concat(M.addrtype," ").concat(M.unicastAddress).concat(this.eol)}printSessionName(M){return M?"s=".concat(M).concat(this.eol):""}printInformation(M){return M?"i=".concat(M).concat(this.eol):""}printUri(M){return M?"u=".concat(M).concat(this.eol):""}printEmail(M){let O="";for(let G of M)O+="e=".concat(G).concat(this.eol);return O}printPhone(M){let O="";for(let G of M)O+="e=".concat(G).concat(this.eol);return O}printConnection(M){return M?"c=".concat(M.nettype," ").concat(M.addrtype," ").concat(M.address).concat(this.eol):""}printBandwidth(M){let O="";for(let G of M)O+="b=".concat(G.bwtype,":").concat(G.bandwidth).concat(this.eol);return O}printTimeFields(M){let O="";for(let G of M){O+="t=".concat(G.time.startTime," ").concat(G.time.startTime).concat(this.eol);for(let ne of G.repeats)O+="r=".concat(ne.repeatInterval," ").concat(ne.typedTimes.join(" ")).concat(this.eol);G.zoneAdjustments&&(O+="z=",O+="z=".concat(G.zoneAdjustments.map(ne=>"".concat(ne.time," ").concat(ne.back?"-":""," ").concat(ne.typedTime)).join(" ")).concat(this.eol),O+=this.eol)}return O}printKey(M){return M?"k=".concat(M).concat(this.eol):""}printAttributes(M){let O="";for(let G of M)O+="a=".concat(G.attField).concat(G.attValue?":".concat(G.attValue):"").concat(this.eol);return O}printMediaDescription(M){let O="";for(let G of M)O+=this.printMedia(G.media),O+=this.printInformation(G.information),O+=this.printConnections(G.connections),O+=this.printBandwidth(G.bandwidths),O+=this.printKey(G.key),O+=this.printMediaAttributes(G);return O}printConnections(M){let O="";for(let G of M)O+=this.printConnection(G);return O}printMedia(M){return"m=".concat(M.mediaType," ").concat(M.port," ").concat(M.protos.join("/")," ").concat(M.fmts.join(" ")).concat(this.eol)}printSessionAttributes(M){return new mn(this.eol).print(M)}printMediaAttributes(M){return new We(this.eol).print(M)}}class Ft{constructor(M){ht(this,"eol",void 0),this.eol=M}printIceUfrag(M){return M===void 0?"":"a=ice-ufrag:".concat(M).concat(this.eol)}printIcePwd(M){return M===void 0?"":"a=ice-pwd:".concat(M).concat(this.eol)}printIceOptions(M){return M===void 0?"":"a=ice-options:".concat(M.join(d)).concat(this.eol)}printFingerprints(M){return M.length>0?M.map(O=>"a=fingerprint:".concat(O.hashFunction).concat(d).concat(O.fingerprint)).join(this.eol)+this.eol:""}printExtmap(M){return M.map(O=>"a=extmap:".concat(O.entry).concat(O.direction?"/".concat(O.direction):"").concat(d).concat(O.extensionName).concat(O.extensionAttributes?"".concat(d).concat(O.extensionAttributes):"").concat(this.eol)).join("")}printSetup(M){return M===void 0?"":"a=setup:".concat(M).concat(this.eol)}printUnrecognized(M){return M.map(O=>"a=".concat(O.attField).concat(O.attValue?":".concat(O.attValue):"").concat(this.eol)).join("")}}class mn extends Ft{print(M){let O="";return O+=this.printGroups(M.groups),O+=this.printMsidSemantic(M.msidSemantic),O+=this.printIceLite(M.iceLite),O+=this.printIceUfrag(M.iceUfrag),O+=this.printIcePwd(M.icePwd),O+=this.printIceOptions(M.iceOptions),O+=this.printFingerprints(M.fingerprints),O+=this.printSetup(M.setup),O+=this.printTlsId(M.tlsId),O+=this.printIdentity(M.identities),O+=this.printExtmap(M.extmaps),O+=this.printUnrecognized(M.unrecognized),O}printGroups(M){let O="";return M.length>0&&(O+=M.map(G=>"a=group:".concat(G.semantic).concat(G.identificationTag.map(ne=>"".concat(d).concat(ne)).join("")).concat(this.eol)).join("")),O}printIceLite(M){return M===void 0?"":"a=ice-lite"+this.eol}printTlsId(M){return M?"a=tls-id:".concat(M).concat(this.eol):""}printIdentity(M){return M.length===0?"":M.map(O=>"a=identity:".concat(O.assertionValue).concat(O.extensions.map(G=>"".concat(d).concat(G.name).concat(G.value?"=".concat(G.value):"")))).join(this.eol)+this.eol}printMsidSemantic(M){if(!M)return"";let O="a=msid-semantic:".concat(M.semantic);return M.applyForAll?O+="".concat(d,"*"):M.identifierList.length>0&&(O+=M.identifierList.map(G=>"".concat(d).concat(G))),O+this.eol}}class We extends Ft{print(M){let O=M.attributes,G="";return G+=this.printRTCP(O.rtcp),G+=this.printIceUfrag(O.iceUfrag),G+=this.printIcePwd(O.icePwd),G+=this.printIceOptions(O.iceOptions),G+=this.printCandidates(O.candidates),G+=this.printRemoteCandidatesList(O.remoteCandidatesList),G+=this.printEndOfCandidates(O.endOfCandidates),G+=this.printFingerprints(O.fingerprints),G+=this.printSetup(O.setup),G+=this.printMid(O.mid),G+=this.printExtmap(O.extmaps),G+=this.printRTPRelated(O),G+=this.printPtime(O.ptime),G+=this.printMaxPtime(O.maxPtime),G+=this.printDirection(O.direction),G+=this.printSSRCGroups(O.ssrcGroups),G+=this.printSSRC(O.ssrcs),G+=this.printRTCPMux(O.rtcpMux),G+=this.printRTCPMuxOnly(O.rtcpMuxOnly),G+=this.printRTCPRsize(O.rtcpRsize),G+=this.printMSId(O.msids),G+=this.printImageattr(O.imageattr),G+=this.printRid(O.rids),G+=this.printSimulcast(O.simulcast),G+=this.printSCTPPort(O.sctpPort),G+=this.printMaxMessageSize(O.maxMessageSize),G+=this.printUnrecognized(O.unrecognized),G}printCandidates(M){return M.map(O=>"a=candidate:".concat(O.foundation).concat(d).concat(O.componentId).concat(d).concat(O.transport).concat(d).concat(O.priority).concat(d).concat(O.connectionAddress).concat(d).concat(O.port).concat(d,"typ").concat(d).concat(O.type).concat(O.relAddr?"".concat(d,"raddr").concat(d).concat(O.relAddr):"").concat(O.relPort?"".concat(d,"rport").concat(d).concat(O.relPort):"").concat(Object.keys(O.extension).map(G=>"".concat(d).concat(G).concat(d).concat(O.extension[G])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(M){return M.map(O=>"a=remote-candidates:".concat(O.join(d)).concat(this.eol)).join("")}printEndOfCandidates(M){return M===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(M){if(!M.payloads)return"";let O=M.payloads,G="";G+=M.rtcpFeedbackWildcards.map(ne=>this.printRTCPFeedback("*",ne)).join("");for(let ne of O)G+=this.printRtpMap(ne.payloadType,ne.rtpMap),G+=this.printFmtp(ne.payloadType,ne.fmtp),G+=ne.rtcpFeedbacks.map(Be=>this.printRTCPFeedback(ne.payloadType,Be)).join("");return G}printFmtp(M,O){if(!O)return"";let G=Object.keys(O.parameters);return G.length===1&&O.parameters[G[0]]===null?"a=fmtp:".concat(M).concat(d).concat(G[0]).concat(this.eol):"a=fmtp:".concat(M).concat(d).concat(Object.keys(O.parameters).map(ne=>"".concat(ne,"=").concat(O.parameters[ne])).join(";")).concat(this.eol)}printRtpMap(M,O){return O?"a=rtpmap:".concat(M).concat(d).concat(O.encodingName,"/").concat(O.clockRate).concat(O.encodingParameters?"/".concat(O.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(M,O){let G="a=rtcp-fb:".concat(M).concat(d),ne=O;return ne.type==="trr-int"?G+="ttr-int".concat(d).concat(ne.interval):(G+="".concat(ne.type),ne.parameter&&(G+="".concat(d).concat(ne.parameter),ne.additional&&(G+="".concat(d).concat(ne.additional)))),G+this.eol}printPtime(M){return M===void 0?"":"a=ptime:".concat(M).concat(this.eol)}printMaxPtime(M){return M===void 0?"":"a=maxptime:".concat(M).concat(this.eol)}printDirection(M){return M===void 0?"":"a=".concat(M).concat(this.eol)}printSSRC(M){return M.map(O=>Object.keys(O.attributes).map(G=>"a=ssrc:".concat(O.ssrcId.toString(10)).concat(d).concat(G).concat(O.attributes[G]?":".concat(O.attributes[G]):"").concat(this.eol)).join("")).join("")}printRTCPMux(M){return M===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(M){return M===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(M){return M===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(M){if(M===void 0)return"";let O="a=rtcp:".concat(M.port);return M.netType&&(O+="".concat(d).concat(M.netType)),M.addressType&&(O+="".concat(d).concat(M.addressType)),M.address&&(O+="".concat(d).concat(M.address)),O+this.eol}printMSId(M){return M.map(O=>"a=msid:".concat(O.id).concat(O.appdata?"".concat(d).concat(O.appdata):"").concat(this.eol)).join("")}printImageattr(M){return M.map(O=>"a=imageattr:".concat(O).concat(this.eol)).join("")}printRid(M){return M.map(O=>{let G="a=rid:".concat(O.id).concat(d).concat(O.direction);return O.payloads&&(G+="".concat(d,"pt=").concat(O.payloads.join(","))),O.params.length>0&&(G+="".concat(d).concat(O.params.map(ne=>ne.type==="depend"?"depend=".concat(ne.rids.join(",")):"".concat(ne.type,"=").concat(ne.val)).join(";"))),G+this.eol}).join("")}printSimulcast(M){return M===void 0?"":"a=simulcast:".concat(M).concat(this.eol)}printSCTPPort(M){return M===void 0?"":"a=sctp-port:".concat(M).concat(this.eol)}printMaxMessageSize(M){return M===void 0?"":"a=max-message-size:".concat(M).concat(this.eol)}printMid(M){return M===void 0?"":"a=mid:".concat(M).concat(this.eol)}printSSRCGroups(M){return M.map(O=>"a=ssrc-group:".concat(O.semantic).concat(O.ssrcIds.map(G=>"".concat(d).concat(G.toString(10))).join("")).concat(this.eol)).join("")}}function Se(be){return new de().parse(be)}function we(be,M){return new Ct().print(be,M)}}},e={};function t(n){if(e[n])return e[n].exports;var i=e[n]={exports:{}};return r[n](i,i.exports,t),i.exports}return t.d=(n,i)=>{for(var s in i)t.o(i,s)&&!t.o(n,s)&&Object.defineProperty(n,s,{enumerable:!0,get:i[s]})},t.o=(n,i)=>Object.prototype.hasOwnProperty.call(n,i),t.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t(8)})();function Wc(r){return l4.parse(r)}function Qo(r,e){return l4.print(r,e)}var Wg=to("Array","keys"),fz=fc,_z=bi,mz=ee,Ez=Wg,ZU=Array.prototype,$U={DOMTokenList:!0,NodeList:!0},gz=function(r){var e=r.keys;return r===ZU||mz(ZU,r)&&e===ZU.keys||_z($U,fz(r))?Ez:e},hl=S(gz);function Ii(r,e,t){return(e=(function(n){var i=(function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var d=c.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)})(n);return typeof i=="symbol"?i:i+""})(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Wr(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function fn(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Wr(Object(t),!0).forEach(function(n){Ii(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Wr(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}let _n=new class extends Sr{constructor(){super(...arguments),Ii(this,"currentUploadLogID",0)}reportLogUploadError(r){let{errorRange:e}=r;e[e.length-1]&&e[e.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=e[e.length-1],this.emit("REPORT_LOG_UPLOAD",r))}};class d4{constructor(e){Ii(this,"logger",void 0),Ii(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(...this.prefixLists,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.info(...this.prefixLists,...t)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.warning(...this.prefixLists,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(...this.prefixLists,...t)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function ex(){let r=new Date;return r.toTimeString().split(" ")[0]+":"+r.getMilliseconds()}function UD(){let r=new Date,e=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return e?e?.[0]+":"+r.getUTCMilliseconds():r.toTimeString().split(" ")[0]+":"+r.getMilliseconds()}let wd={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},pl=Date.now(),Hg=r=>{for(let e in wd)if(Object.prototype.hasOwnProperty.call(wd,e)&&wd[e]===r)return e;return"DEFAULT"},V=new class{constructor(){Ii(this,"proxyServerURL",void 0),Ii(this,"logLevel",wd.DEBUG),Ii(this,"uploadState","collecting"),Ii(this,"uploadLogWaitingList",[]),Ii(this,"uploadLogUploadingList",[]),Ii(this,"uploadErrorCount",0),Ii(this,"currentLogID",0),Ii(this,"url",void 0),Ii(this,"extLog",(r,e)=>{this.appendLogToWaitingList(r,...e)})}debug(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];let n=[wd.DEBUG].concat(e);this.log.apply(this,n)}info(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];let n=[wd.INFO].concat(e);this.log.apply(this,n)}warning(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];let n=[wd.WARNING].concat(e);this.log.apply(this,n)}warn(){this.warning(...arguments)}error(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];let n=[wd.ERROR].concat(e);this.log.apply(this,n)}upload(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];let n=[wd.DEBUG].concat(e);this.uploadLog.apply(this,n)}setLogLevel(r){r=Math.min(Math.max(0,r),4),this.logLevel=r}enableLogUpload(){en("UPLOAD_LOG",!0)}disableLogUpload(){en("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(r){this.proxyServerURL=r}prefix(r){return new d4(this).prefix(r)}log(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];if(Date.now()-pl<100)return void setTimeout(()=>{this.log(...e)},Date.now()-pl);let n=Math.max(0,Math.min(4,e[0]));if(e[0]=ex()+" Agora-SDK [".concat(Hg(n),"]:"),this.appendLogToWaitingList(n,...e),n<this.logLevel)return;let i=ex()+" %cAgora-SDK [".concat(Hg(n),"]:"),s=[];if(!te("USE_NEW_LOG"))switch(n){case wd.DEBUG:s=[i,"color: #64B5F6;"].concat(e.slice(1)),console.log.apply(console,s);break;case wd.INFO:s=[i,"color: #1E88E5; font-weight: bold;"].concat(e.slice(1)),console.log.apply(console,s);break;case wd.WARNING:s=[i,"color: #FB8C00; font-weight: bold;"].concat(e.slice(1)),console.warn.apply(console,s);break;case wd.ERROR:s=[i,"color: #B00020; font-weight: bold;"].concat(e.slice(1)),console.error.apply(console,s)}}uploadLog(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];if(Date.now()-pl<100)return void setTimeout(()=>{this.uploadLog(...e)},Date.now()-pl);let n=Math.max(0,Math.min(4,e[0]));e[0]=ex()+" Agora-SDK [".concat(Hg(n),"]:"),this.appendLogToWaitingList(n,...e)}appendLogToWaitingList(r){if(!te("UPLOAD_LOG"))return;for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];Array.isArray(t[0])?t[0][0]=UD()+" Agora-SDK [".concat(Hg(r),"]:"):t[0]=UD()+" Agora-SDK [".concat(Hg(r),"]:");let i="";t.forEach(s=>{typeof s=="object"&&(s=JSON.stringify(s)),i+="".concat(s," ")}),this.uploadLogWaitingList.push({payload_str:i,log_level:r,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){let r=this.uploadLogUploadingList,e={sdk_version:Yl,process_id:te("PROCESS_ID"),payload:JSON.stringify(r)};return Tu(async()=>{let t=await Er.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(te("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(te("LOG_UPLOAD_SERVER"),"/upload/v1")),e,{responseType:"text"});if(t.data!=="OK"){let n=new Error("unexpected upload log response");throw n.response=t,n}},()=>(this.uploadLogUploadingList=[],!1),t=>{let n={status:-1,message:t.message,errorRange:r.map(i=>i.log_item_id)};return t.response?(n.status=t.response.status,n.data=t.response.data,n.headers=t.response.headers):t.request&&(n.status=t.request.status),_n.reportLogUploadError(n),!0},{timeout:te("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:te("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,te("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),te("UPLOAD_LOG_INTERVAL"))}).catch(r=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),te("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),te("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var F;function u4(r){return Eo(r.reportId,"params.reportId",0,100,!1),Eo(r.category,"params.category",0,100,!1),Eo(r.event,"params.event",0,100,!1),Eo(r.label,"params.label",0,100,!1),Tn(r.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(F={}).FREE="free",F.UPLOADING="uploading",(function(r){r[r.MISC=0]="MISC",r[r.INTERNAL_EVENT=1]="INTERNAL_EVENT",r[r.PUBLIC_EVENT=2]="PUBLIC_EVENT",r[r.WEB_EVENT=3]="WEB_EVENT",r[r.INTERNAL_API=4]="INTERNAL_API",r[r.WEB_API=5]="WEB_API",r[r.PUBLIC_API=6]="PUBLIC_API"})({});let Sz={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},so=(function(r){return r.PUBLISH="publish",r.SUBSCRIBE="subscribe",r.WS_COMPRESSOR_INIT="ws_compressor_init",r.SESSION_INIT="session_init",r.JOIN_CHOOSE_SERVER="join_choose_server",r.REQ_USER_ACCOUNT="req_user_account",r.JOIN_GATEWAY="join_gateway",r.REJOIN_GATEWAY="rejoin_gateway",r.STREAM_SWITCH="stream_switch",r.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",r.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",r.FIRST_VIDEO_RECEIVED="first_video_received",r.FIRST_AUDIO_RECEIVED="first_audio_received",r.FIRST_VIDEO_DECODE="first_video_decode",r.FIRST_AUDIO_DECODE="first_audio_decode",r.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",r.ON_ADD_AUDIO_STREAM="on_add_audio_stream",r.ON_ADD_VIDEO_STREAM="on_add_video_stream",r.ON_UPDATE_STREAM="on_update_stream",r.ON_REMOVE_STREAM="on_remove_stream",r.USER_ANALYTICS="req_user_analytics",r.PC_STATS="pc_stats",r.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",r.AB_TEST="ab_test",r})({}),Nn=(function(r){return r.SESSION="io.agora.pb.Wrtc.Session",r.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",r.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",r.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",r.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",r.PUBLISH="io.agora.pb.Wrtc.Publish",r.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",r.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",r.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",r.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",r.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",r.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",r.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",r.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",r.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",r.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",r.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",r.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",r.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",r.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",r.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",r.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",r.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",r.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",r.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",r.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",r.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",r.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",r.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",r.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",r.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",r.PC_STATS="io.agora.pb.Wrtc.PCStats",r.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",r.AB_TEST="io.agora.pb.Wrtc.ABTest",r})({});(function(r){r[r.WORKER_EVENT=156]="WORKER_EVENT",r[r.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let yr=(function(r){return r[r.SESSION=26]="SESSION",r[r.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",r[r.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",r[r.JOIN_GATEWAY=28]="JOIN_GATEWAY",r[r.PUBLISH=30]="PUBLISH",r[r.SUBSCRIBE=29]="SUBSCRIBE",r[r.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",r[r.STREAM_SWITCH=32]="STREAM_SWITCH",r[r.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",r[r.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",r[r.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",r[r.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",r[r.API_INVOKE=41]="API_INVOKE",r[r.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",r[r.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",r[r.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",r[r.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",r[r.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",r[r.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",r[r.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",r[r.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",r[r.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",r[r.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",r[r.WORKER_EVENT=156]="WORKER_EVENT",r[r.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",r[r.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",r[r.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",r[r.USER_ANALYTICS=1e4]="USER_ANALYTICS",r[r.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",r})({});function Gt(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(e,t,n){let i=n.value;if(typeof i=="function"){let s=r.className||e.__className__||(e.constructor.name==="AgoraRTCClient"?"Client":e.constructor.name);n.value=function(){for(var o,c=arguments.length,d=new Array(c),u=0;u<c;u++)d[u]=arguments[u];let p=d;if(r.argsMap)try{p=r.argsMap(this,...d)}catch(g){V.warning(g),p=[]}try{JSON.stringify(p)}catch{V.warning("arguments for method ".concat(s,".").concat(String(t)," not serializable for apiInvoke.")),p=[]}let m=(r.report||Ye).reportApiInvoke(this._sessionId||null,{id:this._clientId||((o=this.store)===null||o===void 0?void 0:o.clientId)||this._ID,name:"".concat(s,".").concat(String(t)),options:p,tag:Cn.TRACER,reportResult:r.reportResult},r.throttleTime);try{let g=i.apply(this,d);return g instanceof De?g.then(T=>(m.onSuccess(r.reportResult&&T),T)).catch(T=>{throw m.onError(T),T}):(m.onSuccess(r.reportResult&&g),g)}catch(g){throw m.onError(g),g}}}return n}}let Ye=new class{constructor(){Ii(this,"baseInfoMap",new Map),Ii(this,"proxyServer",void 0),Ii(this,"eventUploadTimer",void 0),Ii(this,"setSessionIdTimer",void 0),Ii(this,"url",void 0),Ii(this,"sids",new Set),Ii(this,"backupUrl",void 0),Ii(this,"_appId",void 0),Ii(this,"_aid",0),Ii(this,"keyEventUploadPendingItems",[]),Ii(this,"normalEventUploadPendingItems",[]),Ii(this,"apiInvokeUploadPendingItems",[]),Ii(this,"apiInvokeCount",0),Ii(this,"apiInvokeLoggedCount",0),Ii(this,"ltsList",[]),Ii(this,"lastSendNormalEventTime",Date.now()),Ii(this,"customReportCounterTimer",void 0),Ii(this,"customReportCount",0),Ii(this,"extApiInvoke",async r=>{for(let e of r){let t=fn(fn({},e),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Cn.TRACER});this.sendApiInvoke(t)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),te("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),te("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(r){return this.baseInfoMap.get(r)}setAppId(r){this._appId=r,this._aid=parseInt(r.replace(/[a-fA-F0-9]{8}/g,e=>{let[t,n]=e;return t+n}),16)||0}reportApiInvoke(r,e,t){e.timeout=e.timeout||6e4,e.reportResult=e.reportResult===void 0||e.reportResult;let n=Date.now();this.apiInvokeCount+=1;let i=this.apiInvokeCount,s=!!te("SHOW_REPORT_INVOKER_LOG"),o=!!te("SHOW_REPORT_USER_INVOKER_LOG"),c=s||o&&e.id;c&&(this.apiInvokeLoggedCount+=1);let d=this.apiInvokeLoggedCount;function u(T,R){if(c){let I="[apiInvoke-".concat(d,"]");if(e.id&&(I+="[".concat(e.id,"]")),e.name&&(I+="[".concat(e.name,"]"),e.name===Zr.JOIN))return V.info("".concat(I," ").concat(T));V.info("".concat(I," ").concat(T),T==="start"?e.options:R||"")}}let p=()=>({tag:e.tag,invokeId:i,sid:r,name:e.name,apiInvokeTime:n,options:e.options,states:e.states||null});u("start");let m=!1;Jo(e.timeout).then(()=>{m||(this.sendApiInvoke(fn(fn({},p()),{},{error:z.API_INVOKE_TIMEOUT,success:!1})),u("timeout"))});let g=new H(z.UNEXPECTED_ERROR,"".concat(e.name,": this api invoke is end"));return{onSuccess:T=>{let R=()=>{if(m)throw g;return m=!0,this.sendApiInvoke(fn(fn({},p()),{},{success:!0},e.reportResult&&{result:T})),u("onSuccess"),T};return t?HU(R,e.name+"Success",t,()=>m=!0):R()},onError:T=>{let R=()=>{if(m)throw T;m=!0,this.sendApiInvoke(fn(fn({},p()),{},{success:!1,error:T})),u("onFailure",T.toString())};return t?HU(R,e.name+"Error",t,()=>m=!0):R()}}}sessionInit(r,e){if(this.baseInfoMap.has(r))return;let t=Date.now(),n=this.createBaseInfo(r,t);n.cname=e.cname;let i=Object.assign({},{willUploadConsoleLog:te("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:ql?"global":"oversea",areas:te("AREAS")&&te("AREAS").join(",")},e.extend),{stringUid:s,channelProfile:o,channelMode:c,isABTestSuccess:d,lsid:u,clientRole:p}=e,m=Date.now(),g=fn(fn({},n),{},{eventType:so.SESSION_INIT,appid:e.appid,browser:navigator.userAgent,buildFormat:e.buildFormat,build:Ow,lts:m,elapse:m-t,extend:JSON.stringify(i),mode:e.mode,process:te("PROCESS_ID"),appType:te("APP_TYPE"),success:!0,version:Yl,stringUid:s,channelProfile:o,channelMode:c,isABTestSuccess:d,lsid:u,clientType:Re(T=window.navigator.userAgent).call(T,"AgoraWebView")?42:20,clientRole:p,serviceId:te("PROCESS_ID"),extensionID:te("PLUGIN_INFO").join(",")||""});var T;this.send({type:Nn.SESSION,data:g},!0)}joinChooseServer(r,e){let t=this.baseInfoMap.get(r);if(!t)return;let n=t.info,i=Date.now(),s=fn(fn({},n),{},{role:e.role,eventType:so.JOIN_CHOOSE_SERVER,lts:i,eventElapse:e.elapse||i-e.lts,chooseServerAddr:e.csAddr,errorCode:e.ec,elapse:i-t.startTime,success:e.succ,chooseServerAddrList:JSON.stringify(e.serverList),uid:e.uid?parseInt(e.uid):null,cid:e.cid?parseInt(e.cid):null,chooseServerIp:e.csIp||"",opid:e.opid,unilbsServerIds:e.unilbsServerIds,extend:e.extend||void 0,isHttp3:e.isHttp3,corssRegionTagReq:e.corssRegionTagReq||void 0,corssRegionTagRes:e.corssRegionTagRes||void 0,resourceTimingInfo:e.resourceTimingInfo||void 0});this.send({type:Nn.JOIN_CHOOSE_SERVER,data:s},!0)}reqUserAccount(r,e){let t=this.baseInfoMap.get(r);if(!t)return;let n=t.info,i=Date.now(),s=fn(fn({},n),{},{eventType:so.REQ_USER_ACCOUNT,lts:i,success:e.success,serverAddress:e.serverAddr,stringUid:e.stringUid,uid:e.uid,errorCode:e.errorCode,elapse:e.elapse||i-t.startTime,eventElapse:i-e.lts,extend:JSON.stringify(e.extend)});this.send({type:Nn.REQ_USER_ACCOUNT,data:s},!0)}joinGateway(r,e){let t=this.baseInfoMap.get(r);if(!t)return;let n=t.info;e.vid&&(n.vid=e.vid),n.uid=e.uid,n.cid=e.cid;let i=Date.now(),{firstSuccess:s,addr:o,isProxy:c}=e,d=i-t.startTime,u=fn(fn({},n),{},{eventType:so.JOIN_GATEWAY,lts:i,gatewayAddr:e.addr,success:e.succ,errorCode:e.ec,errorMsg:e.errorMsg||"",elapse:d,eventElapse:i-e.lts,firstSuccess:s,signalChannel:e.signalChannel,preload:e.preload?1:0,installId:MD(),isABTestSuccess:e.isABTestSuccess?1:0}),p=u.success?1:0;if(e.succ&&(t.lastJoinSuccessTime=i),s)this.send({type:Nn.JOIN_GATEWAY,data:u},!0);else{let m;if(o)if(c){let T=o.match(/h=(\d{1,3}-){3}\d{1,3}/g),R=o.match(/p=[0-9]{1,6}/g);m={isSuccess:p,gatewayIp:T&&T.length?T[0].split("=")[1].replace(/-/g,"."):"",port:R&&R.length?R[0].split("=")[1]:"",isProxy:c?1:0}}else{let T=o.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),R=o.match(/(:|p=)[0-9]{1,6}/g);m={isSuccess:p,gatewayIp:T&&T.length?T[0].split("//")[1].replace(/-/g,"."):"",port:R&&R.length?R[0].split(/:|p=/g)[1]:"",isProxy:c?1:0}}else m={isSuccess:p,gatewayIp:"",port:"",isProxy:c?1:0};delete u.success,delete u.eventType,delete u.firstSuccess,u.vid=Number(u.vid);let g=Object.assign({},u,m,{eventType:so.REJOIN_GATEWAY});this.send({type:Nn.RE_JOIN_GATEWAY,data:g},!0)}}joinChannelTimeout(r,e){let t=this.baseInfoMap.get(r);if(!t)return;let n=Date.now(),i=fn(fn({},t.info),{},{lts:n,timeout:e,elapse:n-t.startTime});this.send({type:Nn.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(r,e){let t=this.baseInfoMap.get(r);if(!t)return;let n=t.info,i=Date.now(),s=fn(fn({},n),{},{eventType:so.PUBLISH,lts:i,eventElapse:e.eventElapse,elapse:i-t.startTime,success:e.succ,errorCode:e.ec,videoName:e.videoName,audioName:e.audioName,screenName:e.screenName,screenshare:e.screenshare,audio:e.audio,video:e.video,p2pid:e.p2pid,publishRequestid:e.publishRequestid});this.send({type:Nn.PUBLISH,data:s},!0)}subscribe(r,e,t){let n=this.baseInfoMap.get(r);if(!n)return;let i=n.info,s=Date.now(),o=fn(fn({},i),{},{eventType:so.SUBSCRIBE,lts:s,eventElapse:e.eventElapse,elapse:s-n.startTime,success:e.succ,errorCode:e.ec,video:e.video,audio:e.audio,subscribeRequestid:e.subscribeRequestid,p2pid:e.p2pid,preSsrc:e.preSsrc?1:0},t&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof e.peerid=="string"?o.peerSuid=e.peerid:o.peer=e.peerid,this.send({type:Nn.SUBSCRIBE,data:o},!0)}wsCompressorInit(r){var e;let t=[...hl(e=this.baseInfoMap).call(e)],n=t.length?t[0]:"UnableToGetSid",i=this.baseInfoMap.get(n);if(!i)return;let s=i.info,o=Date.now(),c=fn(fn({},s),{},{eventType:so.WS_COMPRESSOR_INIT,lts:o,eventElapse:r.eventElapse,elapse:o-i.startTime,status:r.status?1:2});this.send({type:Nn.WS_COMPRESSOR_INIT,data:c},!0)}firstXLAPeerFirstVideoFrame(r,e){let t=this.baseInfoMap.get(r);if(!t)return;let n=t.info,i=Date.now(),s=e.peerPubStatusMs-(t.lastJoinSuccessTime||i),o=fn(fn({},n),{},{elapse:i-t.startTime,eventType:so.XLA_PEER_FIRST_VIDEO_FRAME,lts:i,peer:e.peer,width:e.width,height:e.height,ssrc:e.ssrc,p2pid:e.p2pid,peerPublishDuration:e.peerPublishDuration,joinChannelSuccessElapse:s,peerPubStatusMs:e.peerPubStatusMs-e.joinChannelStart,availablePublish:e.peerPublishDuration>s?1:0,preloadStart:Math.max(e.preloadStart-e.joinChannelStart,0),preloadEnd:Math.max(e.preloadEnd-e.joinChannelStart,0),encrypt:Math.max(e.apStart-e.joinChannelStart,0),ap:Math.max(e.apEnd-e.joinChannelStart,0),sua:Math.max(e.suaEnd-e.joinChannelStart,0),beforeConnect:Math.max(e.beforeConnect-e.joinChannelStart,0),peerRecevier:Math.max(e.peerReceiver-e.joinChannelStart,0),ice:Math.max(e.ice-e.joinChannelStart,0),pc:Math.max(e.pc-e.joinChannelStart,0),signalConnected:Math.max(e.signalConnected-e.joinChannelStart,0),joinReq:Math.max(e.joinReq-e.joinChannelStart,0),joinRes:Math.max(e.joinRes-e.joinChannelStart,0),userJoinNotify:Math.max(e.userJoinNotify-e.joinChannelStart,0),videoSsrcNotify:Math.max(e.videoAddNotify-e.joinChannelStart,0),subscribeDelayMs:Math.max(e.subscribeStart-e.videoAddNotify,0),subscribeStart:Math.max(e.subscribeStart-e.joinChannelStart,0),subscribeEnd:Math.max(e.subscribeEnd-e.joinChannelStart,0),firstReceived:Math.max(e.firstReceived-e.joinChannelStart,0),firstDecoded:Math.max(e.firstDecoded-e.joinChannelStart,0),firstPreRender:Math.max(e.firstPreRender-e.joinChannelStart,0),firstRender:Math.max(e.firstRender-e.joinChannelStart,0),playDelayMs:Math.max(e.playStart-e.subscribeEnd,0),playStart:Math.max(e.playStart-e.joinChannelStart,0),playEnd:Math.max(e.playEnd-e.joinChannelStart,0),isPreSub:e.isPreSub?1:0,isPrePc:e.isPrePc?1:0,isPreInstantVideo:e.isPreInstantVideo?1:0});this.send({type:Nn.XLA_PEER_FIRST_VIDEO_FRAME,data:o},!0)}firstRemoteVideoDecode(r,e,t,n){let i=this.baseInfoMap.get(r);if(!i)return;let s=i.info,o=Date.now(),c=fn(fn(fn({},s),n),{},{elapse:o-i.startTime,eventType:e,lts:o,firstDecodeFrame:Math.max((n.firstFrame||o)-i.startTime,0),apEnd:Math.max(n.apEnd-i.startTime,0),apStart:Math.max(n.apStart-i.startTime,0),joinGwEnd:Math.max(n.joinGwEnd-i.startTime,0),joinGwStart:Math.max(n.joinGwStart-i.startTime,0),pcEnd:Math.max(n.pcEnd-i.startTime,0),pcStart:Math.max(n.pcStart-i.startTime,0),subscriberEnd:Math.max(n.subscriberEnd-i.startTime,0),subscriberStart:Math.max(n.subscriberStart-i.startTime,0),videoAddNotify:Math.max(n.videoAddNotify-i.startTime,0)});this.send({type:t,data:c},!0)}firstRemoteFrame(r,e,t,n){let i=this.baseInfoMap.get(r);if(!i)return;let s=i.info,o=Date.now(),c=fn(fn(fn({},s),n),{},{elapse:o-i.startTime,eventType:e,lts:o});this.send({type:t,data:c},!0)}abTest(r,e){let t=this.baseInfoMap.get(r);if(!t)return;let n=t.info,i=Date.now(),s=fn(fn(fn({},n),e),{},{vid:n.vid===void 0?0:Number(n.vid),elapse:i-t.startTime,eventType:so.AB_TEST,lts:i});this.send({type:Nn.AB_TEST,data:s},!0)}pcStats(r,e){let t=this.baseInfoMap.get(r);if(!t)return;let n=t.info,i=Date.now(),s=fn(fn(fn({},n),e),{},{vid:n.vid===void 0?0:Number(n.vid),elapse:i-t.startTime,eventType:so.PC_STATS,lts:i,preallocation:e.preallocation?1:0});this.send({type:Nn.PC_STATS,data:s},!0)}updateRemoteRTPCapabilities(r,e){if(r){let t=this.baseInfoMap.get(r);if(!t)return;let n=t.info,i=Date.now(),s=fn(fn(fn({},n),e),{},{vid:n.vid===void 0?0:Number(n.vid),eventType:so.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:Nn.UPDATE_REMOTE_RTPCAPABILITIES,data:s},!0)}}onGatewayStream(r,e,t,n){let i=this.baseInfoMap.get(r);if(!i)return;let s=i.info,o=Date.now(),c=fn(fn(fn({},s),n),{},{eventType:e,lts:o});this.send({type:t,data:c},!0)}streamSwitch(r,e){let t=this.baseInfoMap.get(r);if(!t)return;let n=t.info,i=Date.now(),s=fn(fn({},n),{},{eventType:so.STREAM_SWITCH,lts:i,isDual:e.isdual,elapse:i-t.startTime,success:e.succ});this.send({type:Nn.STREAM_SWITCH,data:s},!0)}requestProxyAppCenter(r,e){let t=this.baseInfoMap.get(r);if(!t)return;let n=t.info,i=Date.now(),s=fn(fn({},n),{},{eventType:so.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-e.lts,elapse:i-t.startTime,APAddr:e.APAddr,workerManagerList:e.workerManagerList,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:Nn.REQUEST_PROXY_APPCENTER,data:s},!0)}requestProxyWorkerManager(r,e){let t=this.baseInfoMap.get(r);if(!t)return;let n=t.info,i=Date.now(),s=fn(fn({},n),{},{eventType:so.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-e.lts,elapse:i-t.startTime,workerManagerAddr:e.workerManagerAddr,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:Nn.REQUEST_PROXY_WORKER_MANAGER,data:s},!0)}setProxyServer(r){this.proxyServer=r,r?V.debug("reportProxyServerurl: ".concat(r)):V.debug("disable reportProxyServerurl: ".concat(r))}peerPublishStatus(r,e){let t=this.baseInfoMap.get(r);if(!t)return;let n=t.info,i=Date.now(),s=fn(fn({},n),{},{subscribeElapse:e.subscribeElapse,peer:e.peer,peerPublishDuration:Math.max(e.audioPublishDuration,e.videoPublishDuration),audiotag:e.audioPublishDuration>0?1:-1,videotag:e.videoPublishDuration>0?1:-1,lts:i,elapse:i-t.startTime,joinChannelSuccessElapse:i-(t.lastJoinSuccessTime||i),peerPublishDurationVideo:e.videoPublishDuration,peerPublishDurationAudio:e.audioPublishDuration});this.send({type:Nn.PEER_PUBLISH_STATUS,data:s},!0)}workerEvent(r,e){let t=this.baseInfoMap.get(r);if(!t)return;let n=t.info,i=Date.now();(function(s,o,c){let d=s[o];if(!d||typeof d!="string")return[s];s[o]="";let u=Jp(JSON.stringify(s)),p=0,m=[],g=0;for(let T=0;T<d.length;T++)g+=d.charCodeAt(T)<=127?1:3,g<=c-u||(m[m.length]=nt(nt({},s),{},{[o]:d.substring(p,T)}),p=T,g=d.charCodeAt(T)<=127?1:3);return p!==d.length-1&&(m[m.length]=nt(nt({},s),{},{[o]:d.substring(p)})),m})(fn(fn(fn({},n),e),{},{elapse:i-t.startTime,lts:i,productType:"WebRTC"}),"payload",1300).forEach(s=>this.send({type:Nn.WORKER_EVENT,data:s},!0))}apworkerEvent(r,e){let t=this.baseInfoMap.get(r);if(!t)return;let n=t.info,i=Date.now(),s=fn(fn(fn({},n),e),{},{elapse:i-t.startTime,lts:i});this.send({type:Nn.AP_WORKER_EVENT,data:s},!0)}joinWebProxyAP(r,e){let t=this.baseInfoMap.get(r);if(!t)return;let n=t.info,i=Date.now(),s=fn(fn(fn({},n),e),{},{elapse:i-t.startTime,lts:i,extend:e.extend||void 0});this.send({type:Nn.JOIN_WEB_PROXY_AP,data:s},!0)}WebSocketQuit(r,e){let t=this.baseInfoMap.get(r);if(!t)return;let n=t.info,i=Date.now(),s=fn(fn(fn({},n),e),{},{elapse:i-t.startTime,lts:i});this.send({type:Nn.WEBSOCKET_QUIT,data:s},!0)}async sendCustomReportMessage(r,e){if(this.customReportCount+=e.length,this.customReportCount>te("CUSTOM_REPORT_LIMIT"))throw new H(z.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));let t=Date.now(),n=e.map(i=>({type:Nn.USER_ANALYTICS,data:fn(fn({sid:r},i),{},{lts:t})}));try{te("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(n):await this.postDataToStatsCollector(n)}catch(i){throw V.error("send custom report message failed",i.toString()),new H(z.CUSTOM_REPORT_SEND_FAILED,i.message)}}sendApiInvoke(r){let e=te("NOT_REPORT_EVENT");if(r.tag&&Re(e)&&Re(e).call(e,r.tag))return!1;if(r.sid===null)return this.apiInvokeUploadPendingItems.push(r),!1;let t=this.baseInfoMap.get(r.sid);if(!t)return this.apiInvokeUploadPendingItems.push(r),!1;let{cname:n,uid:i,cid:s}=t.info,o;if(r.lts=r.lts||Date.now(),r.error)if(r.error instanceof H){let{code:d,message:u}=r.error;o=d||u||r.error.toString()}else o=r.error.toString();let c={invokeId:r.invokeId,sid:r.sid,cname:n,cid:s,uid:i,lts:r.lts,success:r.success,elapse:r.lts-t.startTime,execElapse:r.lts-r.apiInvokeTime,apiName:r.name,options:r.options?JSON.stringify(r.options):void 0,execStates:r.states?JSON.stringify(r.states):void 0,execResult:r.result?JSON.stringify(r.result):void 0,errorCode:r.error?o:void 0,errorMsg:r.error?JSON.stringify(r.error):void 0};return this.send({type:Nn.API_INVOKE,data:c},!1),!0}addSid(r){this.sids.add(r)}removeSid(r){this.sids.delete(r)}appendSessionId(){let r=this.apiInvokeUploadPendingItems;if(r.length===0)return;let e=Array.from(this.sids).find(t=>t!==null);e&&r.forEach(t=>{t&&(t.sid=e,this.sendApiInvoke(Object.assign({},t)))}),r.length=0}send(r,e){if(e)return this.keyEventUploadPendingItems.push(r),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(r),this.normalEventUploadPendingItems.length>te("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(r,e){let t=[],n=[];for(;r.length;){let s=r.shift();t.length<20?t.push(s):n.push(s)}r.push(...n);for(let s of[...t]){var i;this.ltsList.indexOf(s.data.lts)!==-1?(s.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(s.data.lts)):(this.ltsList.push(s.data.lts),Zt(i=this.ltsList).call(i,(o,c)=>o-c))}return e||(this.lastSendNormalEventTime=Date.now()),te("ENABLE_EVENT_REPORT")&&t.length&&(te("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(t):this.postDataToStatsCollector(t)).catch((s=>o=>{te("EVENT_REPORT_RETRY")&&(e?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(s):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(s),this.normalEventUploadPendingItems.length>te("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-te("NORMAL_EVENT_QUEUE_CAPACITY")),V.warning("report: drop normal events"))))})(t)),r}async postDataToStatsCollector2(r){Kr.networkState===vr.OFFLINE&&await De.race([Kr.onlineWaiter,Jo(2*zr.maxRetryTimeout)]);let e=i=>{let s=new Uint8Array;return i.forEach(o=>{let c=bD(JSON.stringify(o.data)),d=new ArrayBuffer(5),u=(m=>{let g=0;return Object.entries(Nn).forEach(T=>{let[R,I]=T;I===m.type&&(g=yr[R])}),g})(o),p=new DataView(d);p.setUint16(0,c.byteLength,!0),p.setUint8(2,255&u),p.setUint8(3,u>>>8&255),p.setUint8(4,u>>>16&255),s=ID(s,new Uint8Array(d)),s=ID(s,c)}),s},t="event",n=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(te("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(t):"https://".concat(te("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(t);for(let i=0;i<2;i+=1){i===1&&(n=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(te("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(t):"https://".concat(te("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(t));try{await Aw(n,{timeout:1e4,data:e(r),headers:fn(fn({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(s){if(i===1)throw s;continue}return}}async postDataToStatsCollector(r){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1],t=(c=>{let d=c&&c.data.sid&&this.baseInfoMap.get(c.data.sid);return d&&d.info.vid&&+d.info.vid||0})(r[0]),n=t?void 0:this._aid,i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:r.map(c=>JSON.stringify(c)),vid:t,aid:n};Kr.networkState===vr.OFFLINE&&await De.race([Kr.onlineWaiter,Jo(2*zr.maxRetryTimeout)]);let s=e?"/events/proto-raws":"/events/messages",o=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(te("EVENT_REPORT_DOMAIN"),"&p=").concat(te("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(te("EVENT_REPORT_DOMAIN"),":").concat(te("STATS_COLLECTOR_PORT")).concat(s));for(let c=0;c<2;c+=1){c===1&&(o=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(te("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(te("STATS_COLLECTOR_PORT"),"&d=").concat(s):"https://".concat(te("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(te("STATS_COLLECTOR_PORT")).concat(s)));try{e?await zU(o,{timeout:1e4,data:i}):await Aw(o,{timeout:1e4,data:i})}catch(d){if(c===1)throw d;continue}return}}createBaseInfo(r,e){let t=Object.assign({},Sz);return t.sid=r,this.baseInfoMap.set(r,{info:t,startTime:e}),t}reportResourceTiming(r,e){let t=performance.getEntriesByName(r),n=t[t.length-1];n&&this.reportApiInvoke(e,{name:"Client.resourceTiming",options:n,tag:Cn.TRACER}).onSuccess()}};_n.on("REPORT_LOG_UPLOAD",r=>{r.networkState=Kr.networkState,Ye.reportApiInvoke(null,{name:"logUploadError",options:r,tag:Cn.TRACER}).onSuccess("logUploadError")});class fe extends H{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Ii(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,V)}throw(){super.throw(V)}}let Pe={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function on(){return Pe}function ai(){return"setSinkId"in HTMLAudioElement.prototype&&(!te("RESTRICTION_SET_PLAYBACK_DEVICE")||(fh()||FU())&&!RD())}function Dw(){return!Pe.supportUnifiedPlan||te("CHROME_FORCE_PLAN_B")&&Xp()}function RC(r){return!(jr()||Ev(87)||Dw()||!te("ENABLE_PRE_SUB")&&(r==null||!r.autoSubscribe||te("FORCE_DISABLE_AUTO_SUB")))}function xD(r){return!!te("ENABLE_INSTANT_VIDEO")||!(r==null||!r.autoSubscribe||te("FORCE_DISABLE_AUTO_SUB"))}let Po=(function(r){return r.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",r.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",r.IOS_INTERRUPTION_START="ios-interruption-start",r.IOS_INTERRUPTION_END="ios-interruption-end",r.STATE_CHANGE="state-change",r})({});function js(r,e,t){return{sampleRate:r,stereo:e,bitrate:t}}function Wn(r,e,t,n,i){return{width:r,height:e,frameRate:t,bitrateMin:n,bitrateMax:i}}function An(r,e,t,n,i){return{width:{max:r},height:{max:e},frameRate:t,bitrateMin:n,bitrateMax:i}}function Od(r,e){return{numSpatialLayers:r,numTemporalLayers:e}}let tx={"90p":Wn(160,90),"90p_1":Wn(160,90),"120p":Wn(160,120,15,30,65),"120p_1":Wn(160,120,15,30,65),"120p_3":Wn(120,120,15,30,50),"120p_4":Wn(212,120),"180p":Wn(320,180,15,30,140),"180p_1":Wn(320,180,15,30,140),"180p_3":Wn(180,180,15,30,100),"180p_4":Wn(240,180,15,30,120),"240p":Wn(320,240,15,40,200),"240p_1":Wn(320,240,15,40,200),"240p_3":Wn(240,240,15,40,140),"240p_4":Wn(424,240,15,40,220),"360p":Wn(640,360,15,80,400),"360p_1":Wn(640,360,15,80,400),"360p_3":Wn(360,360,15,80,260),"360p_4":Wn(640,360,30,80,600),"360p_6":Wn(360,360,30,80,400),"360p_7":Wn(480,360,15,80,320),"360p_8":Wn(480,360,30,80,490),"360p_9":Wn(640,360,15,80,800),"360p_10":Wn(640,360,24,80,800),"360p_11":Wn(640,360,24,80,1e3),"480p":Wn(640,480,15,100,500),"480p_1":Wn(640,480,15,100,500),"480p_2":Wn(640,480,30,100,1e3),"480p_3":Wn(480,480,15,100,400),"480p_4":Wn(640,480,30,100,750),"480p_6":Wn(480,480,30,100,600),"480p_8":Wn(848,480,15,100,610),"480p_9":Wn(848,480,30,100,930),"480p_10":Wn(640,480,10,100,400),"720p":Wn(1280,720,15,120,1130),"720p_auto":Wn(1280,720,30,900,3e3),"720p_1":Wn(1280,720,15,120,1130),"720p_2":Wn(1280,720,30,120,2e3),"720p_3":Wn(1280,720,30,120,1710),"720p_5":Wn(960,720,15,120,910),"720p_6":Wn(960,720,30,120,1380),"1080p":Wn(1920,1080,15,120,2080),"1080p_1":Wn(1920,1080,15,120,2080),"1080p_2":Wn(1920,1080,30,120,3e3),"1080p_3":Wn(1920,1080,30,120,3150),"1080p_5":Wn(1920,1080,60,120,4780),"1440p":Wn(2560,1440,30,120,4850),"1440p_1":Wn(2560,1440,30,120,4850),"1440p_2":Wn(2560,1440,60,120,7350),"4k":Wn(3840,2160,30,120,8910),"4k_1":Wn(3840,2160,30,120,8910),"4k_3":Wn(3840,2160,60,120,13500)},Tz={"480p":An(640,480,5),"480p_1":An(640,480,5),"480p_2":An(640,480,30),"480p_3":An(640,480,15),"720p":An(1280,720,5),"720p_auto":Wn(1280,720,30,900,3e3),"720p_1":An(1280,720,5),"720p_2":An(1280,720,30),"720p_3":An(1280,720,15),"1080p":An(1920,1080,5),"1080p_1":An(1920,1080,5),"1080p_2":An(1920,1080,30),"1080p_3":An(1920,1080,15)},vz={"1SL1TL":Od(1,1),"3SL3TL":Od(3,3),"2SL3TL":Od(2,3)};function gh(r){return r||(r="480p_1"),typeof r=="string"?Object.assign({},tx[r]):r}function Nd(r){return typeof r=="string"?Object.assign({},Tz[r]):r}function CC(r){return typeof r=="string"?Object.assign({},vz[r]):r}let VD={speech_low_quality:js(16e3,!1),speech_standard:js(32e3,!1,18),music_standard:js(48e3,!1),standard_stereo:js(48e3,!0,56),high_quality:js(48e3,!1,128),high_quality_stereo:js(48e3,!0,192)};function FD(r){return typeof r=="string"?Object.assign({},VD[r]):r}let xm=[];function yv(r){return gr(r,"mediaSource",["screen","window","application"]),!0}let It=(function(r){return r.NEED_RENEGOTIATE="@need_renegotiate",r.NEED_REPLACE_TRACK="@need_replace_track",r.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",r.NEED_CLOSE="@need_close",r.NEED_ENABLE_TRACK="@need_enable_track",r.NEED_DISABLE_TRACK="@need_disable_track",r.NEED_SESSION_ID="@need_sid",r.SET_OPTIMIZATION_MODE="@set_optimization_mode",r.GET_STATS="@get_stats",r.GET_RTC_STATS="@get_rtc_stats",r.GET_LOW_VIDEO_TRACK="@get_low_video_track",r.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",r.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",r.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",r.NEED_MUTE_TRACK="@need_mute_track",r.NEED_UNMUTE_TRACK="@need_unmute_track",r})({}),rt=(function(r){return r.SCREEN_TRACK="screen_track",r.CUSTOM_TRACK="custome_track",r.LOW_STREAM="low_stream",r.SCREEN_LOW_TRACK="screen_low_track",r})({}),Ni=(function(r){return r[r.HIGH_STREAM=0]="HIGH_STREAM",r[r.LOW_STREAM=1]="LOW_STREAM",r})({}),bC=(function(r){return r[r.HIGH_STREAM=0]="HIGH_STREAM",r[r.LOW_STREAM=1]="LOW_STREAM",r[r.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",r[r.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",r[r.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",r[r.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",r[r.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",r[r.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",r})({}),yz=(function(r){return r[r.DISABLE=0]="DISABLE",r[r.LOW_STREAM=1]="LOW_STREAM",r[r.AUDIO_ONLY=2]="AUDIO_ONLY",r[r.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",r[r.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",r[r.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",r[r.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",r[r.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",r[r.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",r})({}),Rv=(function(r){return r.TRANSCEIVER_UPDATED="transceiver-updated",r.SEI_TO_SEND="sei-to-send",r.SEI_RECEIVED="sei-received",r.TRACK_UPDATED="track-updated",r})({}),Sh=(function(r){return r.SOURCE_STATE_CHANGE="source-state-change",r.TRACK_ENDED="track-ended",r.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",r.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",r.CLOSED="closed",r})({}),Tc=(function(r){return r.FIRST_FRAME_DECODED="first-frame-decoded",r.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",r.VIDEO_STATE_CHANGED="video-state-changed",r.PLAY_START="play-start",r.PLAY_END="play-end",r.FIRST_FRAME_RENDER="first-frame-render",r})({}),vc=(function(r){return r.AUDIO="audio",r.VIDEO="video",r.DATA="data",r})({}),rc=(function(r){return r.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",r.RECEIVE_TRACK_BUFFER="receive_track_buffer",r.ON_AUDIO_BUFFER="on_audio_buffer",r.UPDATE_SOURCE="update_source",r})({});(function(r){r.UPDATE_TRACK_SOURCE="update-track-source"})({});let fl={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},Pw={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},BD={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},h4={uplinkNetworkQuality:0,downlinkNetworkQuality:0},p4={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},sc=(function(r){return r.ON_TRACK="on_track",r.ON_NODE="on_node",r})({}),ds=(function(r){return r.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",r.REQUEST_CONSTRAINTS="request_constraints",r})({}),yc=(function(r){return r.IDLE="IDLE",r.INITING="INITING",r.INITEND="INITEND",r})({}),Zp=(function(r){return r.STATE_CHANGE="state_change",r.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",r.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",r.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",r})({}),qs=(function(r){return r.NONE="none",r.INIT="init",r.CANPLAY="canplay",r.PLAYING="playing",r.PAUSED="paused",r.SUSPEND="suspend",r.STALLED="stalled",r.WAITING="waiting",r.ERROR="error",r.DESTROYED="destroyed",r.ABORT="abort",r.ENDED="ended",r.EMPTIED="emptied",r.LOADEDDATA="loadeddata",r})({}),gs=(function(r){return r[r.VideoStateStopped=0]="VideoStateStopped",r[r.VideoStateStarting=1]="VideoStateStarting",r[r.VideoStateDecoding=2]="VideoStateDecoding",r[r.VideoStateFrozen=3]="VideoStateFrozen",r})({}),Th={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},IC=(function(r){return r.OPEN="open",r.MESSAGE="message",r.CLOSE="close",r.CLOSING="closing",r.ERROR="error",r})({});function Hn(r,e,t,n,i){var s,o,c={};return Object.keys(n).forEach(function(d){c[d]=n[d]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=Ks(s=zS(o=t.slice()).call(o)).call(s,function(d,u){return u(r,e,d)||d},c),i&&c.initializer!==void 0&&(c.value=c.initializer?c.initializer.call(i):void 0,c.initializer=void 0),c.initializer===void 0?(Object.defineProperty(r,e,c),null):c}function Ce(r,e,t){return(e=(function(n){var i=(function(s,o){if(typeof s!="object"||!s)return s;var c=s[Symbol.toPrimitive];if(c!==void 0){var d=c.call(s,"string");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)})(n);return typeof i=="symbol"?i:i+""})(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Le(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Xi(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Le(Object(t),!0).forEach(function(n){Ce(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Le(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}class Ji extends Sr{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(Rv.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,t){super(),Ce(this,"trackMediaType",void 0),Ce(this,"_ID",void 0),Ce(this,"_rtpTransceiver",void 0),Ce(this,"_lowRtpTransceiver",void 0),Ce(this,"_hints",[]),Ce(this,"_isClosed",!1),Ce(this,"_originMediaStreamTrack",void 0),Ce(this,"mediaStreamTrack",void 0),Ce(this,"_external",{}),this._ID=t||In(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,(function(n){Re(xm).call(xm,n)||xm.push(n)})(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||Lm(()=>{var t;Ye.reportApiInvoke(null,{name:Zr.GET_MEDIA_STREAM_TRACK,options:[],tag:Cn.TRACER}).onSuccess(((t=this._mediaStreamTrack)===null||t===void 0?void 0:t.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===Ni.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,(function(e){let t=xm.indexOf(e);t!==-1&&xm.splice(t,1)})(this),this.emit(Sh.CLOSED),this.removeAllListeners(Rv.SEI_RECEIVED)}_updateRtpTransceiver(e,t){if(t===Ni.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(Rv.TRANSCEIVER_UPDATED,e,t)}}class Cv extends Ji{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,t){super(e,t),Ce(this,"_enabled",!0),Ce(this,"_muted",!1),Ce(this,"_isExternalTrack",!1),Ce(this,"_isClosed",!1),Ce(this,"_enabledMutex",void 0),Ce(this,"processor",void 0),Ce(this,"_processorContext",void 0),Ce(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new ha("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,t;return(e=(t=this._originMediaStreamTrack)===null||t===void 0?void 0:t.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,V.debug("[".concat(this.getTrackId(),"] close")),this.emit(It.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=n,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await On(this,It.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){V.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Sh.TRACK_ENDED)}stateCheck(e,t){if(V.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),Ge(t,e),this._enabled&&this._muted&&e==="enabled"&&t===!1)throw new H(z.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",V);if(!this._enabled&&!this._muted&&e==="muted"&&t===!0)throw new H(z.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",V)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():De.resolve([])}}let bv=window.AudioContext||window.webkitAudioContext,Xl=null,Yn=new class extends Sr{constructor(){super(...arguments),Ce(this,"prevState",void 0),Ce(this,"curState",void 0),Ce(this,"currentTime",void 0),Ce(this,"currentTimeStuckAt",void 0),Ce(this,"interruptDetectorTrack",void 0),Ce(this,"onLocalAudioTrackMute",()=>{V.info("ios15-interruption-start"),this.emit(Po.IOS_15_16_INTERRUPTION_START)}),Ce(this,"onLocalAudioTrackUnmute",async()=>{V.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?V.info("ios15-interruption-end-canceled"):(Xl&&await Xl.suspend(),this.emit(Po.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(r){V.debug("webaudio bindInterruptDetectorTrack ".concat(r.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=r,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(r){V.debug("webaudio unbindInterruptDetectorTrack ".concat(r.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===r&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Ai(){if(!Xl){if((function(){if(!bv)return void V.error("your browser is not support web audio");V.info("create audio context");let r=Xi({},te("WEBAUDIO_INIT_OPTIONS"));V.debug("audio context init option:",JSON.stringify(r)),Xl=new bv(r),Yn.curState=Xl.state,Xl.onstatechange=()=>{Yn.prevState=Yn.curState,Yn.curState=Xl?Xl.state:void 0;let{prevState:e,curState:t}=Yn,n=t==="running",i=t==="interrupted",s=e==="running",o=e==="suspended",c=e==="interrupted",d=Qn().osVersion;(fi()||gu())&&s&&i&&(V.info("ios".concat(d,"-interruption-start")),Yn.emit(Po.IOS_INTERRUPTION_START)),(fi()||gu())&&(o||c)&&n&&(V.info("ios".concat(d,"-interruption-end")),Yn.emit(Po.IOS_INTERRUPTION_END)),e!==t&&Yn.emit(Po.STATE_CHANGE,t,e)},setInterval(()=>{var e;let t=(e=Xl)===null||e===void 0?void 0:e.currentTime;Yn.currentTime!==t?(Yn.currentTimeStuckAt&&(V.debug("AudioContext current time resume at ".concat(t)),Yn.currentTimeStuckAt=void 0),Yn.currentTime=t):(t!==Yn.currentTimeStuckAt&&(Ye.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:t},tag:Cn.TRACER}).onSuccess(),V.warning("AudioContext current time stuck at ".concat(t))),Yn.currentTimeStuckAt=t)},5e3),(async function(e){let t=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],n,i=!1,s=!1,o=!1;function c(I){e.state==="running"?d(!1):fi()||gu()?e.state==="suspended"&&(d(!0),I&&e.resume().then(u,u)):e.state!=="closed"&&(d(!0),I&&e.resume().then(u,u))}function d(I){if(i!==I){i=I;for(let A=0,w=t;A<w.length;A+=1){let k=w[A];I?window.addEventListener(k,p,{capture:!0,passive:!0}):window.removeEventListener(k,p,{capture:!0,passive:!0})}}}function u(){c(!1)}function p(){c(!0)}function m(I){if(!o)if(n.paused)if(I){let A;g(!1),o=!0;try{A=n.play(),A?A.then(T,T):(n.addEventListener("playing",T),n.addEventListener("abort",T),n.addEventListener("error",T))}catch{T()}}else g(!0);else g(!1)}function g(I){if(s!==I){s=I;for(let A=0,w=t;A<w.length;A++){let k=w[A];I?window.addEventListener(k,R,{capture:!0,passive:!0}):window.removeEventListener(k,R,{capture:!0,passive:!0})}}}function T(){n.removeEventListener("playing",T),n.removeEventListener("abort",T),n.removeEventListener("error",T),o=!1,m(!1)}function R(){m(!0)}if(fi()){let I=e.createMediaStreamDestination(),A=document.createElement("div");A.innerHTML="<audio x-webkit-airplay='deny'></audio>",n=A.children.item(0),n.controls=!1,n.disableRemotePlayback=!0,n.preload="auto",n.srcObject=I.stream,m(!0)}Yn.on(Po.STATE_CHANGE,function(){c(!0)}),c(!1)})(Xl)})(),!Xl)throw new H(z.NOT_SUPPORTED,"can not create audio context");return Xl}return Xl}function vh(r){if((function(){if(Vm!==null)return Vm;let n=Ai(),i=n.createBufferSource(),s=n.createGain(),o=n.createGain();i.connect(s),i.connect(o),i.disconnect(s);let c=!1;try{i.disconnect(s)}catch{c=!0}return i.disconnect(),Vm=c,c})())return;let e=r.connect,t=r.disconnect;r.connect=(n,i,s)=>{var o;return r._inputNodes||(r._inputNodes=[]),Re(o=r._inputNodes).call(o,n)||(n instanceof AudioNode?(r._inputNodes.push(n),e.call(r,n,i,s)):e.call(r,n,i)),r},r.disconnect=(n,i,s)=>{t.call(r),n?$r(r._inputNodes,n):r._inputNodes=[];for(let o of r._inputNodes)e.call(r,o)}}let Vm=null;function kw(r,e){let t=!1,n=1/e;if(te("DISABLE_WEBAUDIO")){let i=window.setInterval(()=>{t?window.clearInterval(i):r(performance.now()/1e3)},1e3*n)}else{let i=Ai(),s=i.createGain();s.gain.value=0,s.connect(i.destination);let o=()=>{if(t)return void(s=null);let c=i.createOscillator();c.onended=o,c.connect(s),c.start(0),c.stop(i.currentTime+n),r(i.currentTime)};o()}return()=>{t=!0}}class jD{constructor(){Ce(this,"context",void 0),Ce(this,"analyserNode",void 0),Ce(this,"sourceNode",void 0),this.context=Ai(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||fi()||gu()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;let e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{let n=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(n);for(let i=0;i<e.length;++i)e[i]=n[i]/128-1}let t=Ks(e).call(e,(n,i)=>n+i*i,0)/e.length;return Math.max(10*Math.log10(t)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,t;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(t=this.sourceNode)===null||t===void 0||t.connect(this.analyserNode)}catch{V.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class nx extends Sr{get processSourceNode(){return this.sourceNode}set processedNode(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var n;(n=this.sourceNode)===null||n===void 0||n.disconnect(this.outputNode)}catch{}(t=this._processedNode)===null||t===void 0||t.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Ce(this,"outputNode",void 0),Ce(this,"outputTrack",void 0),Ce(this,"isPlayed",!1),Ce(this,"sourceNode",void 0),Ce(this,"context",void 0),Ce(this,"audioBufferNode",void 0),Ce(this,"destNode",void 0),Ce(this,"audioOutputLevel",0),Ce(this,"volumeLevelAnalyser",void 0),Ce(this,"_processedNode",void 0),Ce(this,"playNode",void 0),Ce(this,"isDestroyed",!1),Ce(this,"onNoAudioInput",void 0),Ce(this,"isNoAudioInput",!1),Ce(this,"_noAudioInputCount",0),this.context=Ai(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),vh(this.outputNode),this.volumeLevelAnalyser=new jD}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=t=>{this.emit(rc.ON_AUDIO_BUFFER,(function(n){for(let i=0;i<n.outputBuffer.numberOfChannels;i+=1){let s=n.outputBuffer.getChannelData(i);for(let o=0;o<s.length;o+=1)s[o]=0}return n.inputBuffer})(t))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!on().webAudioMediaStreamDest)throw new H(z.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&km(()=>{Yn.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;fi()||gu()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();let t=this.volumeLevelAnalyser.getAnalyserNode(),n;t.getFloatTimeDomainData?(n=new Float32Array(t.fftSize),t.getFloatTimeDomainData(n)):(n=new Uint8Array(t.fftSize),t.getByteTimeDomainData(n));let i=!1;for(let s=0;s<n.length;s++)n[s]!==0&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await Jo(200),await this.checkHasAudioInput(e?e+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,t;(e=this.processedNode)===null||e===void 0||e.disconnect(),(t=this.sourceNode)===null||t===void 0||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class ix extends nx{get isFreeze(){return!1}constructor(e,t,n){var i;if(super(),Ce(this,"sourceNode",void 0),Ce(this,"track",void 0),Ce(this,"clonedTrack",void 0),Ce(this,"audioElement",void 0),Ce(this,"isCurrentTrackCloned",!1),Ce(this,"isRemoteTrack",!1),Ce(this,"originVolumeLevelAnalyser",void 0),Ce(this,"rebuildWebAudio",async()=>{if(V.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void V.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>V.info("resume success")),V.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let c=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?c.stop():this.isCurrentTrackCloned=!0;let d=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(d),vh(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let u=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(u,this.context.currentTime),vh(this.outputNode),this.emit(rc.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=d,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new H(z.UNEXPECTED_ERROR);this.track=e;let s=new MediaStream([this.track]);if(this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(s),vh(this.sourceNode),n){let c=n.clone();c.enabled=!0,this.clonedTrack=c,V.debug("create an unmuted track ".concat(c.id," from the original track ").concat(n.id," to get the volume"));let d=this.context.createMediaStreamSource(new MediaStream([c]));vh(d),this.originVolumeLevelAnalyser=new jD,this.originVolumeLevelAnalyser.updateSource(d)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=s;let o=Qn();t&&o.os===Br.IOS&&Number((i=o.osVersion)===null||i===void 0?void 0:i.split(".")[0])<15&&(Yn.on(Po.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(c=>{c||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;let t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),vh(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(rc.UPDATE_SOURCE),this.audioElement.srcObject=t}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),Yn.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){let t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),V.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));let n=this.context.createMediaStreamSource(new MediaStream([t]));vh(n),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(n)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function rx(r,e,t){let n=(s,o)=>s?typeof s!="number"?s.max||s.exact||s.ideal||s.min||o:s:o,i={audio:!!t&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxHeight:n(e.height,1080),maxWidth:n(e.width,1920)}}};return e.frameRate&&typeof e.frameRate!="number"?(i.video.mandatory.maxFrameRate=e.frameRate.max,i.video.mandatory.minFrameRate=e.frameRate.min):typeof e.frameRate=="number"&&(i.video.mandatory.maxFrameRate=e.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function f4(r,e){let t=await _4(r.mediaSource),{sourceId:n,audio:i}=await(function(s){let o=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new De((c,d)=>{let u=document.createElement("div");u.innerText="share screen",u.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let p=document.createElement("div");p.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let m=document.createElement("div");m.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",m.setAttribute("style","height: 12%;");let g=document.createElement("div");g.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let T=document.createElement("div");T.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let R=document.createElement("button");R.innerHTML="cancel",R.setAttribute("style","width: 85px;"),R.onclick=()=>{document.body.removeChild(w);let k=new Error("NotAllowedError");k.name="NotAllowedError",d(k)};let I=o,A=document.createElement("div");if(o){let k=document.createElement("input");k.setAttribute("type","checkbox");let L=document.createElement("span");k.setAttribute("style","margin-right: 6px;"),L.innerText="Share audio",k.checked=I,k.onchange=()=>{I=k.checked},A.appendChild(k),A.appendChild(L)}T.appendChild(A),T.appendChild(R),p.appendChild(m),p.appendChild(g),p.appendChild(T);let w=document.createElement("div");w.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),w.appendChild(u),w.appendChild(p),document.body.appendChild(w),s.map(k=>{if(k.id){let L=document.createElement("div");L.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let j=k.thumbnail;try{let{width:K}=j.getSize();K>1920&&(j=j.resize({width:1920}))}catch(K){throw K&&K.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),K}L.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+j.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+k.name.replace(/[\u00A0-\u9999<>\&]/g,function(K){return"&#"+K.charCodeAt(0)+";"})+"</span>",L.onclick=()=>{document.body.removeChild(w),c({sourceId:k.id,audio:I})},g.appendChild(L)}})})})(t,e);return await rx(n,r,i)}async function _4(r){let e=["window","screen"];r!=="application"&&r!=="window"||(e=["window"]),r==="screen"&&(e=["screen"]);let t=fC();if(!t)throw console.error("failed to fetch electron, please mount it to window"),new H(z.ELECTRON_IS_NULL);let n=null;try{var i;n=((i=t.desktopCapturer)===null||i===void 0?void 0:i.getSources({types:e}))||t.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:e})}catch{n=null}n&&n.then||(n=new De((s,o)=>{t.desktopCapturer.getSources({types:e},(c,d)=>{c?o(c):s(d)})}));try{return await n}catch(s){throw new H(z.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,s.toString())}}let GD=new ha("safari"),WD=!1,sx=!1;async function Jl(r,e){let t=0,n=null;for(;t<2;)try{n=await Dd(r,e,t>0);break}catch(i){if(i instanceof H)throw V.error("[".concat(e,"] ").concat(i.toString())),i;let s=HD(i.name||i.code||i,i.message);if(s.code===z.MEDIA_OPTION_INVALID){V.debug("[".concat(e,"] detect media option invalid, retry")),t+=1,await Jo(500);continue}throw V.error("[".concat(e,"] ").concat(s.toString())),s}if(!n)throw new H(z.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return n}async function Dd(r,e,t){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new H(z.NOT_SUPPORTED,"can not find getUserMedia");t&&(r.video&&(delete r.video.width,delete r.video.height),r.screen&&(delete r.screen.width,delete r.screen.height));let n=on(),i=new MediaStream;if(r.audioSource&&i.addTrack(r.audioSource),r.videoSource&&i.addTrack(r.videoSource),!r.audio&&!r.video&&!r.screen)return V.debug("Using Video Source/ Audio Source"),i;if(r.screen)if(fC())r.screen.sourceId?Fm(i,await rx(r.screen.sourceId,r.screen,!!r.screenAudio)):Fm(i,await f4(r.screen,!!r.screenAudio));else if(fh()&&r.screen.extensionId&&r.screen.mandatory){if(!n.getStreamFromExtension)throw new H(z.NOT_SUPPORTED,"This browser does not support screen sharing");V.debug("[".concat(e,'] Screen access on chrome stable, looking for extension"'));let g=await(o=r.screen.extensionId,c=e,new De((T,R)=>{try{chrome.runtime.sendMessage(o,{getStream:!0},I=>{if(!I||!I.streamId)return V.error("[".concat(c,"] No response from Chrome Plugin. Plugin not installed properly"),I),void R(new H(z.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));T(I.streamId)})}catch(I){V.error("[".concat(c,"] AgoraRTC screensharing plugin is not accessible(").concat(o,")"),I.toString()),R(new H(z.CHROME_PLUGIN_NOT_INSTALL))}}));r.screen.mandatory.chromeMediaSourceId=g,Fm(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:r.screen.mandatory}}))}else if(n.getDisplayMedia){var s;r.screen.mediaSource&&yv(r.screen.mediaSource);let g={width:r.screen.width,height:r.screen.height,frameRate:r.screen.frameRate,displaySurface:(s=r.screen.displaySurface)!==null&&s!==void 0?s:r.screen.mediaSource==="screen"?"monitor":r.screen.mediaSource},{selfBrowserSurface:T,surfaceSwitching:R,systemAudio:I,preferCurrentTab:A}=r.screen,w={selfBrowserSurface:T,surfaceSwitching:R,systemAudio:I,preferCurrentTab:A};!T&&delete w.selfBrowserSurface,!R&&delete w.surfaceSwitching,!I&&delete w.systemAudio,!A&&delete w.preferCurrentTab,V.debug("[".concat(e,"] getDisplayMedia:"),JSON.stringify({video:g,audio:r.screenAudio,controls:w})),Fm(i,await navigator.mediaDevices.getDisplayMedia(Xi({video:g,audio:r.screenAudio},w)))}else{if(!jr())throw V.error("[".concat(e,"] This browser does not support screenSharing")),new H(z.NOT_SUPPORTED,"This browser does not support screen sharing");{r.screen.mediaSource&&yv(r.screen.mediaSource);let g={video:{mediaSource:r.screen.mediaSource,width:r.screen.width,height:r.screen.height,frameRate:r.screen.frameRate}};V.debug("[".concat(e,"] getUserMedia: ").concat(JSON.stringify(g))),Fm(i,await navigator.mediaDevices.getUserMedia(g))}}var o,c;if(!r.video&&!r.audio)return i;let d={video:r.video,audio:r.audio},u=te("MEDIA_DEVICE_CONSTRAINTS");if(u)try{typeof u=="string"&&(u=JSON.parse(u)),d=OD(d,u)}catch{}V.debug("[".concat(e,"] GetUserMedia"),JSON.stringify(d)),Qn();let p,m=null;(ms()||fi()||Tw())&&(m=await GD.lock());try{p=await navigator.mediaDevices.getUserMedia(d)}catch(g){throw m&&m(),g}return d.audio&&(WD=!0),d.video&&(sx=!0),Fm(i,p),m&&m(),i}function HD(r,e){switch(r){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new H(z.MEDIA_OPTION_INVALID,"".concat(r,": ").concat(e));case"NotFoundError":case"DevicesNotFoundError":return new H(z.DEVICE_NOT_FOUND,"".concat(r,": ").concat(e));case"NotSupportedError":return new H(z.NOT_SUPPORTED,"".concat(r,": ").concat(e));case"NotReadableError":return new H(z.NOT_READABLE,"".concat(r,": ").concat(e));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new H(z.PERMISSION_DENIED,"".concat(r,": ").concat(e));case"ConstraintNotSatisfiedError":return new H(z.CONSTRAINT_NOT_SATISFIED,"".concat(r,": ").concat(e));default:return V.error("getUserMedia unexpected error",r),new H(z.UNEXPECTED_ERROR,"".concat(r,": ").concat(e))}}function Fm(r,e){let t=r.getVideoTracks()[0],n=r.getAudioTracks()[0],i=e.getVideoTracks()[0],s=e.getAudioTracks()[0];s&&(n&&r.removeTrack(n),r.addTrack(s)),i&&(t&&r.removeTrack(t),r.addTrack(i))}let oc=new class extends Sr{get state(){return this._state}set state(r){r!==this._state&&(this.emit(Zp.STATE_CHANGE,r),this._state=r)}constructor(){super(),Ce(this,"_state",yc.IDLE),Ce(this,"isAccessMicrophonePermission",!1),Ce(this,"isAccessCameraPermission",!1),Ce(this,"lastAccessMicrophonePermission",!1),Ce(this,"lastAccessCameraPermission",!1),Ce(this,"checkdeviceMatched",!1),Ce(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(te("ENUMERATE_DEVICES_INTERVAL")||(_h()||gw()===Br.HARMONY_OS)&&Xp())&&this.updateDevicesInfo()},te("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(r=>V.error(r.toString()))}async enumerateDevices(r,e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new H(z.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();let n=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(n),s=!this.isAccessMicrophonePermission&&r,o=!this.isAccessCameraPermission&&e;i.audio&&(s=!1),i.video&&(o=!1);let c=null,d=null,u=null;if(!t&&(s||o)){if(GD.isLocked&&(V.debug("[device manager] wait GUM lock"),(await GD.lock())(),V.debug("[device manager] GUM unlock")),WD&&(s=!1,this.isAccessMicrophonePermission=!0),sx&&(o=!1,this.isAccessCameraPermission=!0),V.debug("[device manager] check media device permissions",r,e,s,o),s&&o){try{u=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(p){let m=HD(p.name||p.code||p,p.message);if(m.code===z.PERMISSION_DENIED)throw m;V.warning("getUserMedia failed in getDevices",m)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(s){try{c=await navigator.mediaDevices.getUserMedia({audio:r})}catch(p){let m=HD(p.name||p.code||p,p.message);if(m.code===z.PERMISSION_DENIED)throw m;V.warning("getUserMedia failed in getDevices",m)}this.isAccessMicrophonePermission=!0}else if(o){try{d=await navigator.mediaDevices.getUserMedia({video:e})}catch(p){let m=HD(p.name||p.code||p,p.message);if(m.code===z.PERMISSION_DENIED)throw m;V.warning("getUserMedia failed in getDevices",m)}this.isAccessCameraPermission=!0}V.debug("[device manager] mic permission",r,"cam permission",e)}try{let p=await navigator.mediaDevices.enumerateDevices();return c&&c.getTracks().forEach(m=>m.stop()),d&&d.getTracks().forEach(m=>m.stop()),u&&u.getTracks().forEach(m=>m.stop()),c=null,d=null,u=null,p}catch(p){return c&&c.getTracks().forEach(m=>m.stop()),d&&d.getTracks().forEach(m=>m.stop()),u&&u.getTracks().forEach(m=>m.stop()),c=null,d=null,u=null,new H(z.ENUMERATE_DEVICES_FAILED,p.toString()).throw()}}async getRecordingDevices(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,r)).filter(e=>e.kind==="audioinput")}async getCamerasDevices(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,r)).filter(e=>e.kind==="videoinput")}async getSpeakers(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,r)).filter(e=>e.kind==="audiooutput")}searchDeviceIdByName(r){let e=null;return this.deviceInfoMap.forEach(t=>{t.device.label===r&&(e=t.device.deviceId)}),e}async getDeviceById(r){let e=(await this.enumerateDevices(!0,!0,!0)).find(t=>t.deviceId===r);if(!e)throw new H(z.DEVICE_NOT_FOUND,"deviceId: ".concat(r));return e}async init(){this.state=yc.INITING;try{await this.updateDevicesInfo(),this.state=yc.INITEND}catch(r){throw V.warning("Device Detection functionality cannot start properly.",r.toString()),this.state=yc.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new H(z.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),r}}async updateDevicesInfo(){let r=await this.enumerateDevices(!0,!0,!0),e=Date.now(),t=[];if(r[0]&&r[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;let i=r.find(o=>o.kind==="audioinput"&&o.deviceId==="default"),s=r.find(o=>o.kind==="audiooutput"&&o.deviceId==="default");i&&s?s.groupId===i.groupId?V.debug("[device-check] default input ".concat(i.label," and output ").concat(s.label," is the same group")):V.debug("[device-check] default input ".concat(i.label," and output ").concat(s.label," is not the same group")):V.debug("[device-check] default input or output not found")}let n=this.checkMediaDeviceInfoIsOk(r);if(r.forEach(i=>{if(!i.deviceId)return;let s=this.deviceInfoMap.get("".concat(i.kind,"_").concat(i.deviceId));if((s?s.state:"INACTIVE")!=="ACTIVE"){let o={initAt:e,updateAt:e,device:i,state:"ACTIVE"};this.deviceInfoMap.set("".concat(i.kind,"_").concat(i.deviceId),o),t.push(o)}s&&(s.updateAt=e)}),this.deviceInfoMap.forEach((i,s)=>{i.state==="ACTIVE"&&i.updateAt!==e&&(i.state="INACTIVE",t.push(i))}),this.state!==yc.INITEND)return n.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(n.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));t.forEach(i=>{switch(i.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Zp.RECORDING_DEVICE_CHANGED,i);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Zp.CAMERA_DEVICE_CHANGED,i);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Zp.PLAYOUT_DEVICE_CHANGED,i)}}),n.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),n.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(r){let e=r.filter(i=>i.kind==="audioinput"),t=r.filter(i=>i.kind==="videoinput"),n={audio:!1,video:!1};for(let i of e)if(i.label&&i.deviceId){n.audio=!0;break}for(let i of t)if(i.label&&i.deviceId){n.video=!0;break}return n}},_l=!1,ml=new class extends Sr{constructor(){super(...arguments),Ce(this,"onAutoplayFailed",void 0),Ce(this,"onAudioAutoplayFailed",void 0)}};function Ql(){if(Qn(),!_l){let r=e=>{e.preventDefault(),_l=!1,Fg()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};_l=!0,Fg()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),V.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),ml.onAutoplayFailed?ml.onAutoplayFailed():ml.onAudioAutoplayFailed?V.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):V.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),ml.emit("autoplay-failed")}}function ox(r,e,t,n){if(!r)return;let i=Ye.getBaseInfoBySessionId(r);if(!i)return;let s=i.info,o=Date.now(),c=Xi(Xi({},s),{},{vid:s.vid===void 0?0:Number(s.vid),lts:o,elapse:o-i.startTime,cbRegistered:ml.onAutoplayFailed||ml.onAudioAutoplayFailed?1:-1,errorMsg:t,mediaType:e,trackId:n,extend:void 0});Ye.send({type:Nn.AUTOPLAY_FAILED,data:c},!0)}let m4=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Hc=new class{constructor(){Ce(this,"onAutoplayFailed",void 0),Ce(this,"elementMap",new Map),Ce(this,"elementStateMap",new Map),Ce(this,"elementsNeedToResume",[]),Ce(this,"sinkIdMap",new Map),Ce(this,"autoResumeAfterInterruption",r=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e,i=this.elementStateMap.get(t),s=n.srcObject.getAudioTracks()[0],o=s&&s.readyState;if(V.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(o," ").concat(r)),o==="live"){if(r)return n.pause(),void n.play();if(Yn.curState==="running")return gv()?(n.pause(),void n.play()):void(i&&i==="paused"&&n.play())}})}),Ce(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(r=>{let[e,t]=r,n=t.srcObject.getAudioTracks()[0];n&&n.readyState==="live"&&(V.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),t.pause(),t.play())})}),this.autoResumeAudioElement(),Yn.on(Po.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Yn.on(Po.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Yn.on(Po.STATE_CHANGE,()=>{fi()&&Yn.prevState==="suspended"&&Yn.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(r,e){let t=this.elementMap.get(r);if(this.sinkIdMap.set(r,e),t)try{await t.setSinkId(e)}catch(n){throw new H(z.PERMISSION_DENIED,"can not set sink id: "+n.toString())}}play(r,e,t,n){if(this.elementMap.has(e))return;let i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([r]),this.bindAudioElementEvents(e,i),this.elementMap.set(e,i),this.elementStateMap.set(e,qs.INIT),this.setVolume(e,t);let s=this.sinkIdMap.get(e);if(s)try{i.setSinkId(s).catch(c=>{V.warning("[".concat(e,"] set sink id failed"),c.toString())})}catch(c){V.warning("[".concat(e,"] set sink id failed"),c.toString())}let o=i.play();o&&o.then&&o.catch(c=>{n&&ox(n,"audio",c.message,e),V.warning("audio element play warning",c.toString()),this.elementMap.has(e)&&c.name==="NotAllowedError"&&(V.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),km(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),Ql()}))})}updateTrack(r,e){let t=this.elementMap.get(r);t&&(t.srcObject=new MediaStream([e]))}isPlaying(r){return this.elementMap.has(r)&&this.elementStateMap.get(r)==="playing"}setVolume(r,e){let t=this.elementMap.get(r);t&&(e=Math.max(0,Math.min(100,e)),t.volume=e/100)}stop(r){let e=this.elementMap.get(r);if(this.sinkIdMap.delete(r),!e)return;let t=this.elementsNeedToResume.indexOf(e);this.elementsNeedToResume.splice(t,1),e.srcObject=null,e.remove(),this.elementMap.delete(r),this.elementStateMap.delete(r)}bindAudioElementEvents(r,e){m4.forEach(t=>{e.addEventListener(t,n=>{let i=this.elementStateMap.get(r),s=n.type==="pause"?"paused":n.type;if(V.debug("[".concat(r,"] audio-element-status change ").concat(i," => ").concat(s)),n.type==="error"){let o=e?.error;o&&V.error("[".concat(r,"] media error, code: ").concat(o.code,", message: ").concat(o.message))}this.elementStateMap.set(r,s)})})}getPlayerState(r){return this.elementStateMap.get(r)||"uninit"}autoResumeAudioElement(){let r=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(t=>{V.debug("Auto resume audio element success")}).catch(t=>{V.warning("Auto resume audio element failed!",t)})}),this.elementsNeedToResume=[]};new De(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{Fg()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0))})}};function wi(){return function(r,e,t){let n=t.value;return typeof n=="function"&&(t.value=function(){this._isClosed&&new H(z.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",V);for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];let c=n.apply(this,s);return c instanceof De?new De((d,u)=>{c.then(d).catch(u)}):c}),t}}class Yr extends Sr{constructor(e){super(),Ce(this,"name","VideoProcessorDestination"),Ce(this,"ID","0"),Ce(this,"_source",void 0),Ce(this,"videoContext",void 0),Ce(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new H(z.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new H(z.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(sc.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(sc.ON_TRACK,void 0)}}class ax extends Sr{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t){super(),Ce(this,"constraintsMap",new Map),Ce(this,"statsRegistry",[]),Ce(this,"usageRegistry",[]),Ce(this,"trackId",void 0),Ce(this,"direction",void 0),Ce(this,"_chained",!1),this.trackId=e,this.direction=t}async getConstraints(){return await Ys(this,ds.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,t){var n;return V.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),On(this,ds.REQUEST_UPDATE_CONSTRAINTS,Array.from(cs(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return V.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),On(this,ds.REQUEST_UPDATE_CONSTRAINTS,Array.from(cs(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){let n=this.statsRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===t);n!==-1&&this.statsRegistry.splice(n,1)}gatherStats(){let e=[];for(let{processorID:t,processorName:n,type:i,cb:s}of this.statsRegistry)try{let o=s();e.push({processorID:t,processorName:n,type:i,stats:o})}catch(o){V.error(new H(z.UNEXPECTED_ERROR,o.message))}return e}registerUsage(e,t){this.usageRegistry.find(n=>n.processorID===e.ID&&n.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){let t=this.usageRegistry.findIndex(n=>n.processorID===e.ID&&n.processorName===e.name);t!==-1&&this.usageRegistry.splice(t,1)}async gatherUsage(){let e=[];if(!this.chained)return[];for(let{cb:t}of this.usageRegistry)try{let n=t();n instanceof De&&(n=await n),e.push(Xi(Xi({},n),{},{direction:this.direction}))}catch(n){V.error("gather extension usage error",n)}return e}getDirection(){return this.direction}}class cx extends Sr{constructor(e){super(),Ce(this,"name","AudioProcessorDestination"),Ce(this,"ID","0"),Ce(this,"inputTrack",void 0),Ce(this,"inputNode",void 0),Ce(this,"audioProcessorContext",void 0),Ce(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new H(z.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new H(z.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(sc.ON_TRACK,void 0),this.emit(sc.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(sc.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(sc.ON_NODE,this.inputNode))}}class lx extends Sr{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t,n){super(),Ce(this,"constraintsMap",new Map),Ce(this,"statsRegistry",[]),Ce(this,"audioContext",void 0),Ce(this,"trackId",void 0),Ce(this,"direction",void 0),Ce(this,"usageRegistry",[]),Ce(this,"_chained",!1),this.audioContext=e,this.trackId=t,this.direction=n}async getConstraints(){return Ys(this,ds.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,t){var n;return V.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),On(this,ds.REQUEST_UPDATE_CONSTRAINTS,Array.from(cs(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),On(this,ds.REQUEST_UPDATE_CONSTRAINTS,Array.from(cs(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===t)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){let n=this.statsRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===t);n!==-1&&this.statsRegistry.splice(n,1)}gatherStats(){let e=[];for(let{processorID:t,processorName:n,type:i,cb:s}of this.statsRegistry)try{let o=s();e.push({processorID:t,processorName:n,type:i,stats:o})}catch(o){V.error(new H(z.UNEXPECTED_ERROR,o.message))}return e}registerUsage(e,t){this.usageRegistry.find(n=>n.processorID===e.ID&&n.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){let t=this.usageRegistry.findIndex(n=>n.processorID===e.ID&&n.processorName===e.name);t!==-1&&this.usageRegistry.splice(t,1)}async gatherUsage(){let e=[];if(!this.chained)return[];for(let{cb:t}of this.usageRegistry)try{let n=t();n instanceof De&&(n=await n),e.push(Xi(Xi({},n),{},{direction:this.direction}))}catch(n){V.error("gather extension usage error",n)}return e}getDirection(){return this.direction}}class KD extends Sr{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Ce(this,"context",void 0),Ce(this,"processSourceNode",void 0),Ce(this,"outputTrack",void 0),Ce(this,"processedNode",void 0),Ce(this,"clonedTrack",void 0),Ce(this,"outputNode",void 0),this.outputNode=new dx}setVolume(){}createOutputTrack(){throw new H(z.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class dx{disconnect(){}connect(){}}function E4(r){return new De((e,t)=>{let n=!1,i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);let s=fi()?"canplay":"playing";i.addEventListener(s,()=>{let o=i.videoWidth,c=i.videoHeight;!o&&jr()||(n=!0,i.srcObject=null,i.remove(),e([o,c]))}),i.srcObject=new MediaStream([r]),i.play().catch(__),setTimeout(()=>{n||(i.srcObject=null,i.remove(),e([i.videoWidth,i.videoHeight]))},4e3)})}function Lw(r){let e={};r.facingMode&&(e.facingMode=r.facingMode),r.cameraId&&(e.deviceId={exact:r.cameraId});let t=gh(r.encoderConfig);return t.width!=null&&(e.width=t.width),t.height!=null&&(e.height=t.height),!GU()&&t.frameRate&&(e.frameRate=t.frameRate),FU()&&typeof e.frameRate=="object"&&(e.frameRate.max=60),jr()&&(e.frameRate={ideal:30,max:30}),e}function Mw(r){let e={};return GU()||(r.AGC!==void 0&&(e.autoGainControl=r.AGC),r.AEC!==void 0&&(e.echoCancellation=r.AEC),r.ANS!==void 0&&(e.noiseSuppression=r.ANS,fh()&&r.ANS&&(e.googHighpassFilter=r.ANS))),e}function ux(r){let e=Mw(r);if(r.encoderConfig){let t=FD(r.encoderConfig);e.channelCount=t.stereo?2:1,e.sampleRate=t.sampleRate,e.sampleSize=t.sampleSize}return r.microphoneId&&(e.deviceId={exact:r.microphoneId}),_h()&&(e.sampleRate=void 0),e}let g4=r=>{let e=r._encoderConfig;if(!e)return;let{frameRate:t,width:n,height:i}=r.getMediaStreamTrackSettings(),{frameRate:s=t,width:o=n,height:c=i}=e;if(!s||!o||!c)return;o=Tv(o),c=Tv(c),s=Tv(s);let{max:d,min:u}=(function(T,R,I){let A=200*Math.pow(I/15,.6)*Math.pow(T*R/640/360,.75);return{min:Math.floor(A),max:Math.floor(4*A)}})(o,c,s),{bitrateMax:p,bitrateMin:m}=e||{};p||V.debug("calculate bitrate: [w: ".concat(o,", h: ").concat(c,", fps: ").concat(s,"] => [brMax: ").concat(p,", brMin: ").concat(m,"]"));let{maxFramerate:g}=te("ENCODER_CONFIG_LIMIT");return g&&typeof g=="number"&&(s=Math.min(s,g)),{frameRate:s,bitrateMax:p||d,bitrateMin:m||u,scaleResolutionDownBy:1,scale:0}},S4=async(r,e,t)=>await(async(n,i,s)=>{let o=(function(u){let p=[];for(let m=0;m<u.length;m+=2)p.push(parseInt(u.slice(m,m+2),16));return Uint8Array.from(p)})(DD(""+i+s)).slice(0,16),c=o.slice(0,12),d=await window.crypto.subtle.importKey("raw",o,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:c},d,n))})(r.buffer,e,t),zD=r=>{let e=document.createElement("canvas");return e.width=2,e.height=2,new De((t,n)=>{e.toBlob(async i=>{if(e.remove(),i){let s=await YD(i);t({buffer:s,width:e.width,height:e.height})}else n(new H(z.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,1)})},YD=async r=>{let e=await r.arrayBuffer();return new Uint8Array(e)};var hx,px,fx,_x,mx,Ex,gx,Sx,Tx,vx,yx,Rx,Cx,bx,Ix,Ax,wx,Ox,Dr,Pr,Nx,Dx,Px,kx,Lx,$p,ef,Mx,Ux,xx,Vx,Fx,Bx,jx,Gx,Wx,Hx,Kx,zx,Zo;let ci=(hx=Gt({argsMap:(r,e)=>[r.getTrackId(),e],throttleTime:300}),px=Gt({argsMap:(r,e)=>[r.getTrackId(),e]}),fx=wi(),_x=ro("LocalAudioTrack","_enabledMutex"),mx=Gt({argsMap:(r,e)=>[r.getTrackId(),e]}),Ex=wi(),gx=ro("LocalAudioTrack","_enabledMutex"),Sx=Gt({argsMap:(r,e)=>[r.getTrackId(),e]}),Tx=wi(),vx=wi(),yx=wi(),Rx=Gt({argsMap:r=>[r.getTrackId()]}),Cx=wi(),bx=Gt({argsMap:r=>[r.getTrackId()]}),Ix=wi(),Ax=Gt({argsMap:r=>[r.getTrackId()]}),wx=Gt({argsMap:(r,e)=>[r.getTrackId(),e.name]}),Ox=Gt({argsMap:r=>[r.getTrackId()]}),Hn((Dr=class extends Cv{get _source(){return this.initWebAudio()}set _source(r){this._trackSource=r}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Hc.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(r,e,t,n){super(r,t),Ce(this,"trackMediaType",vc.AUDIO),Ce(this,"_encoderConfig",void 0),Ce(this,"_trackSource",void 0),Ce(this,"metadata",[]),Ce(this,"_enabled",!0),Ce(this,"_volume",100),Ce(this,"_useAudioElement",!0),Ce(this,"_bypassWebAudio",!1),Ce(this,"processor",void 0),Ce(this,"_processorContext",void 0),Ce(this,"_processorDestination",void 0),Ce(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=e,this._getOriginVolumeLevel=!!n,this._trackSource=new KD,te("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),te("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),ms()&&!Xl?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(r){Tn(r,"volume",0,1e3),this._volume=r,this._source.setVolume(r/100),this._useAudioElement&&Hc.setVolume(this.getTrackId(),r);try{if(this._bypassWebAudio)return void V.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,On(this,It.NEED_REPLACE_TRACK,this).then(()=>{V.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(t=>{V.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),t)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(r){if(!this._useAudioElement||!ai())throw new H(z.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Hc.setSinkID(this.getTrackId(),r)}async setEnabled(r,e,t){return this._setEnabled(r,e,t)}async _setEnabled(r,e,t){if(!t){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(V.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){this._originMediaStreamTrack.enabled=!0;try{t||(this._enabled=!0),await On(this,It.NEED_ENABLE_TRACK,this),V.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(r," success"))}catch(n){throw t||(this._enabled=!1),V.error("[".concat(this.getTrackId(),"] setEnabled to true error"),n.toString()),n}}else{this._originMediaStreamTrack.enabled=!1,t||(this._enabled=!1);try{await On(this,It.NEED_DISABLE_TRACK,this)}catch(n){throw t||(this._enabled=!0),V.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}}}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,V.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await On(this,It.NEED_MUTE_TRACK,this):await On(this,It.NEED_UNMUTE_TRACK,this))}getStats(){return Lm(()=>{V.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),ei(this,It.GET_STATS)||Xi({},fl)}setAudioFrameCallback(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!r)return this._source.removeAllListeners(rc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(rc.ON_AUDIO_BUFFER),this._source.on(rc.ON_AUDIO_BUFFER,t=>r(t))}play(){V.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(V.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Hc.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){V.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Hc.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let r=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];V.debug("[".concat(this.getTrackId(),"] update player source track")),r&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Hc.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(r,e){this._originMediaStreamTrack!==r&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:r,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await On(this,It.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(r))}renewMediaStreamTrack(r){return De.resolve(void 0)}pipe(r){if(this._bypassWebAudio)throw new H(z.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===r)return r;if(r._source)throw new H(z.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),r}unpipe(){var r;if(!this.processor)return;let e=this.processor;(r=this._source.processSourceNode)===null||r===void 0||r.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(r){r.on(sc.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await On(this,It.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await On(this,It.NEED_REPLACE_TRACK,this))}),r.on(sc.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(r){r.removeAllListeners(sc.ON_TRACK),r.removeAllListeners(sc.ON_NODE)}bindProcessorContextEvents(r){r.on(ds.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(r){r.removeAllListeners(ds.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof KD&&(this._trackSource=new ix(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let r=new lx(this._source.context,this.getTrackId(),"local"),e=new cx(r);return this._processorContext=r,this._processorDestination=e,this.bindProcessorContextEvents(r),this.bindProcessorDestinationEvents(e),this._source.on(rc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:r})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Hc.stop(this.getTrackId()),this._source.play()),On(this,It.NEED_REPLACE_MIXING_TRACK,this).then(()=>{V.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(t=>{V.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),t)})),{processorContext:r,processorDestination:e}}}).prototype,"setVolume",[hx],Object.getOwnPropertyDescriptor(Dr.prototype,"setVolume"),Dr.prototype),Hn(Dr.prototype,"setPlaybackDevice",[px,fx],Object.getOwnPropertyDescriptor(Dr.prototype,"setPlaybackDevice"),Dr.prototype),Hn(Dr.prototype,"setEnabled",[_x,mx,Ex],Object.getOwnPropertyDescriptor(Dr.prototype,"setEnabled"),Dr.prototype),Hn(Dr.prototype,"setMuted",[gx,Sx,Tx],Object.getOwnPropertyDescriptor(Dr.prototype,"setMuted"),Dr.prototype),Hn(Dr.prototype,"getStats",[vx],Object.getOwnPropertyDescriptor(Dr.prototype,"getStats"),Dr.prototype),Hn(Dr.prototype,"setAudioFrameCallback",[yx],Object.getOwnPropertyDescriptor(Dr.prototype,"setAudioFrameCallback"),Dr.prototype),Hn(Dr.prototype,"play",[Rx,Cx],Object.getOwnPropertyDescriptor(Dr.prototype,"play"),Dr.prototype),Hn(Dr.prototype,"stop",[bx,Ix],Object.getOwnPropertyDescriptor(Dr.prototype,"stop"),Dr.prototype),Hn(Dr.prototype,"close",[Ax],Object.getOwnPropertyDescriptor(Dr.prototype,"close"),Dr.prototype),Hn(Dr.prototype,"pipe",[wx],Object.getOwnPropertyDescriptor(Dr.prototype,"pipe"),Dr.prototype),Hn(Dr.prototype,"unpipe",[Ox],Object.getOwnPropertyDescriptor(Dr.prototype,"unpipe"),Dr.prototype),Dr),Rr=(Pr=Gt({argsMap:(r,e)=>[r.getTrackId(),e]}),Nx=wi(),Dx=ro("MicrophoneAudioTrack","_enabledMutex"),Px=Gt({argsMap:(r,e,t)=>[r.getTrackId(),e,t]}),kx=wi(),Lx=Gt({argsMap:r=>[r.getTrackId()]}),Hn(($p=class extends ci{get __className__(){return"MicrophoneAudioTrack"}constructor(r,e,t,n){super(r,e.encoderConfig?FD(e.encoderConfig):{},n,te("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Ce(this,"_config",void 0),Ce(this,"_deviceName","default"),Ce(this,"_constraints",void 0),Ce(this,"_originalConstraints",void 0),Ce(this,"_enabled",!0),this._config=e,this._constraints=t,this._originalConstraints=t,this._deviceName=r.label,typeof e.bypassWebAudio=="boolean"&&(this._bypassWebAudio=e.bypassWebAudio),(gv()||Vg())&&Yn.bindInterruptDetectorTrack(this)}async setDevice(r){if(V.info("[".concat(this.getTrackId(),"] start set device to ").concat(r)),this._enabled)try{let e=await oc.getDeviceById(r),t={};t.audio=Xi({},this._constraints),t.audio.deviceId={exact:r},this._originMediaStreamTrack.stop();let n=null;try{n=await Jl(t,this.getTrackId())}catch(i){throw V.error("[".concat(this.getTrackId(),"] setDevice failed"),i.toString()),n=await Jl({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n.getAudioTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(n.getAudioTracks()[0],!1),this._deviceName=e.label,this._config.microphoneId=r,this._constraints.deviceId={exact:r}}catch(e){throw V.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{let e=await oc.getDeviceById(r);this._deviceName=e.label,this._config.microphoneId=r,this._constraints.deviceId={exact:r}}catch(e){throw V.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}V.info("[".concat(this.getTrackId(),"] set device to ").concat(r," success"))}async setEnabled(r,e,t){if(e)return V.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(r);if(!t){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(V.info("[".concat(this.getTrackId(),"] start setEnabled"),r),te("AUTO_RESET_AUDIO_ROUTE")&&(fi()||gu())){let o=navigator.audioSession;o&&(r||(o.type="playback"),o.type="auto")}if(!r){var n;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(n=this._source.clonedTrack)===null||n===void 0||n.stop(),t||(this._enabled=!1);try{await On(this,It.NEED_DISABLE_TRACK,this)}catch(o){throw V.error("[".concat(this.getTrackId(),"] setEnabled false failed"),o.toString()),o}return}let i=Xi({},this._constraints),s=oc.searchDeviceIdByName(this._deviceName);s&&!i.deviceId&&(i.deviceId=s);try{t||(this._enabled=!0);let o=await Jl({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(o.getAudioTracks()[0],!1),await On(this,It.NEED_ENABLE_TRACK,this)}catch(o){throw t||(this._enabled=!1),V.error("[".concat(this.getTrackId(),"] setEnabled true failed"),o.toString()),o}V.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(gv()||Vg())&&Yn.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((fi()||gu())&&this._enabled&&!this._isClosed&&Yn.duringInterruption){let r=async()=>{Yn.off(Po.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(V.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Yn.on(Po.IOS_INTERRUPTION_END,r)}else V.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Sh.TRACK_ENDED)}async renewMediaStreamTrack(r){let e=r||this._constraints,t=oc.searchDeviceIdByName(this._deviceName);if(t&&!e.deviceId&&(e.deviceId=t),this._constraints=e,this._enabled){this._originMediaStreamTrack.stop();let n=await Jl({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(n.getAudioTracks()[0],!0)}}bindProcessorContextEvents(r){super.bindProcessorContextEvents(r),r.on(ds.REQUEST_UPDATE_CONSTRAINTS,async(e,t,n)=>{try{let i=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(i),t()}catch(i){n(i)}})}unbindProcessorContextEvents(r){super.unbindProcessorContextEvents(r),r.removeAllListeners(ds.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[Pr,Nx],Object.getOwnPropertyDescriptor($p.prototype,"setDevice"),$p.prototype),Hn($p.prototype,"setEnabled",[Dx,Px,kx],Object.getOwnPropertyDescriptor($p.prototype,"setEnabled"),$p.prototype),Hn($p.prototype,"close",[Lx],Object.getOwnPropertyDescriptor($p.prototype,"close"),$p.prototype),$p),Uw=(ef=Gt({argsMap:(r,e)=>[r.getTrackId(),e,r.duration]}),Mx=wi(),Ux=Gt({argsMap:r=>[r.getTrackId()]}),xx=wi(),Vx=Gt({argsMap:r=>[r.getTrackId()]}),Fx=wi(),Bx=Gt({argsMap:r=>[r.getTrackId()]}),jx=wi(),Gx=Gt({argsMap:r=>[r.getTrackId()]}),Wx=wi(),Hx=Gt({argsMap:r=>[r.getTrackId()]}),Kx=Gt({argsMap:r=>[r.getTrackId()]}),zx=wi(),Hn((Zo=class extends ci{get __className__(){return"BufferSourceAudioTrack"}constructor(r,e,t,n){super(e.createOutputTrack(),t,n),Ce(this,"source",void 0),Ce(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=r,this._bufferSource=e,this._bufferSource.on(rc.AUDIO_SOURCE_STATE_CHANGE,i=>{this.safeEmit(Sh.SOURCE_STATE_CHANGE,i)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(r){r&&this._bufferSource.updateOptions(r),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(r){this._bufferSource.seekAudioBuffer(r)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(r){Tn(r,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(r)}}).prototype,"startProcessAudioBuffer",[ef,Mx],Object.getOwnPropertyDescriptor(Zo.prototype,"startProcessAudioBuffer"),Zo.prototype),Hn(Zo.prototype,"pauseProcessAudioBuffer",[Ux,xx],Object.getOwnPropertyDescriptor(Zo.prototype,"pauseProcessAudioBuffer"),Zo.prototype),Hn(Zo.prototype,"seekAudioBuffer",[Vx,Fx],Object.getOwnPropertyDescriptor(Zo.prototype,"seekAudioBuffer"),Zo.prototype),Hn(Zo.prototype,"resumeProcessAudioBuffer",[Bx,jx],Object.getOwnPropertyDescriptor(Zo.prototype,"resumeProcessAudioBuffer"),Zo.prototype),Hn(Zo.prototype,"stopProcessAudioBuffer",[Gx,Wx],Object.getOwnPropertyDescriptor(Zo.prototype,"stopProcessAudioBuffer"),Zo.prototype),Hn(Zo.prototype,"close",[Hx],Object.getOwnPropertyDescriptor(Zo.prototype,"close"),Zo.prototype),Hn(Zo.prototype,"setAudioBufferPlaybackSpeed",[Kx,zx],Object.getOwnPropertyDescriptor(Zo.prototype,"setAudioBufferPlaybackSpeed"),Zo.prototype),Zo);class Xs extends ci{get __className__(){return"MixingAudioTrack"}get isActive(){for(let e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){let e=Ai().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,In(8,"track-mix-")),Ce(this,"trackList",void 0),Ce(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return this.trackList.indexOf(e)!==-1}addAudioTrack(e){this.trackList.indexOf(e)===-1?(V.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):V.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(this.trackList.indexOf(e)!==-1){V.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch{}$r(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){let e={};this.trackList.forEach(t=>{t._encoderConfig&&((t._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=t._encoderConfig.bitrate),(t._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=t._encoderConfig.sampleRate),(t._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=t._encoderConfig.sampleSize),t._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(t=>{t instanceof Xs?t.emit(Rv.TRANSCEIVER_UPDATED,e):t._updateRtpTransceiver(e)}))}}class Js extends nx{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(rc.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Ce(this,"audioBuffer",void 0),Ce(this,"sourceNode",void 0),Ce(this,"startPlayTime",0),Ce(this,"startPlayOffset",0),Ce(this,"pausePlayTime",0),Ce(this,"options",void 0),Ce(this,"currentLoopCount",0),Ce(this,"currentPlaybackSpeed",100),Ce(this,"_currentState","stopped"),this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):V.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}let T4=new Map;function Yx(r,e){if(r.length===0||e.length===0)return 1/0;let t=jg(r),n=jg(e);return Math.floor(n/t)}class qD{get rendFrameRate(){let e=Math.max(1,Yx(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/e)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:qs.DESTROYED}set videoElementStatus(e){e!==this._videoElementStatus&&(V.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var t;e!==this._videoState&&(this._videoState=e,(t=this.onVideoStateChanged)===null||t===void 0||t.call(this,this.videoState))}constructor(e){Ce(this,"trackId",void 0),Ce(this,"config",void 0),Ce(this,"onFirstVideoFrameDecoded",void 0),Ce(this,"onFirstVideoFrameRender",void 0),Ce(this,"onVideoStateChanged",void 0),Ce(this,"freezeTimeCounterList",[]),Ce(this,"renderFreezeAccTime",0),Ce(this,"renderFreezeAccTime2",0),Ce(this,"isKeepLastFrame",!1),Ce(this,"isDestroyed",!1),Ce(this,"timeUpdatedCount",0),Ce(this,"freezeTime",0),Ce(this,"playbackTime",0),Ce(this,"lastTimeUpdatedTime",0),Ce(this,"autoplayFailed",!1),Ce(this,"videoTrack",void 0),Ce(this,"videoElement",void 0),Ce(this,"cacheVideoElement",void 0),Ce(this,"internal",!1),Ce(this,"_render_interframe_delays",[]),Ce(this,"_render_interframe_delays_sizes",[]),Ce(this,"_videoState",gs.VideoStateStopped),Ce(this,"videoElementCheckInterval",void 0),Ce(this,"videoElementFreezeTimeout",void 0),Ce(this,"_videoElementStatus",qs.NONE),Ce(this,"_isInPage",!0),Ce(this,"isGettingVideoDimensions",!1),Ce(this,"startGetVideoDimensions",()=>{let t=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return V.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(t,500)};!this.isGettingVideoDimensions&&t()}),Ce(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Yn.curState==="running"&&(V.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Sw())),yD()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Ce(this,"handleVideoEvents",t=>{switch(t.type){case"play":case"playing":t.type==="play"&&V.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=qs.PLAYING;break;case"loadeddata":if(this.videoState=gs.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=qs.CANPLAY;break;case"stalled":this.videoElementStatus=qs.STALLED;break;case"suspend":this.videoElementStatus=qs.SUSPEND;break;case"pause":this.videoElementStatus=qs.PAUSED,fi()||gu()||ms()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(V.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=qs.WAITING;break;case"abort":this.videoElementStatus=qs.ABORT;break;case"ended":this.videoElementStatus=qs.ENDED;break;case"emptied":this.videoElementStatus=qs.EMPTIED;break;case"error":{let n=this.videoElement.error;n&&(this.videoElementStatus=qs.ERROR,V.error("[".concat(this.trackId,"] media error: ").concat(n.message," (").concat(n.code,")")));break}case"timeupdate":{let n=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=n);let i=n-this.lastTimeUpdatedTime,s=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=n,$l.lastVisibleTime<$l.lastHiddenTime||s<$l.lastHiddenTime||s<$l.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(i>te("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=i),this.playbackTime+=i;this.playbackTime>=6e3;){this.playbackTime-=6e3;let o=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(o),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Ce(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(V.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Sw())),yD()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),Yn.on(Po.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Yn.on(Po.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){let t=this.videoElement.play();t&&t.catch&&t.catch(i=>{e&&ox(e,"video",i.message,this.trackId),i.name==="NotAllowedError"?(V.warning("detected video element autoplay failed",i),this.autoplayFailed=!0,this.handleAutoPlayFailed()):V.warning("[".concat(this.trackId,"] play warning: "),i)});let n=Qn();if((n.name==="Safari"&&Number(n.version)===15||gv())&&t&&t.then){let i=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t.then(i).catch(i)}}getCurrentFrame(){let e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;let t=e.getContext("2d");if(!t)return V.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);let n=t.getImageData(0,0,e.width,e.height);return e.remove(),n}async getCurrentFrameToUint8Array(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;let i=n.getContext("2d");return i?(i.drawImage(this.videoElement,0,0,n.width,n.height),new De((s,o)=>{n.toBlob(async c=>{if(n.remove(),c){let d=await YD(c);s({buffer:d,width:n.width,height:n.height})}else o(new H(z.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,t<0?.1:t>1?1:t)})):await zD(e)}destroy(){this.isDestroyed=!0,Yn.off(Po.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Yn.off(Po.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=gs.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=qs.INIT,!this.videoElementCheckInterval&&(XD.forEach(s=>{this.videoElement.addEventListener(s,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=(function(s){return s!==document.body&&document.body.contains(s)})(this.videoElement)},1e3),te("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,t;let s,o=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",o),this.videoElementFreezeTimeout=window.setTimeout(c,te("VIDEO_FREEZE_DURATION")))},c=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===gs.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=gs.VideoStateFrozen:document.addEventListener("visibilitychange",o))},d=(u,p)=>{if(this.videoElementStatus===qs.PLAYING){if(s){let T=p.presentationTime-s.presentationTime,R=p.presentedFrames-s.presentedFrames;this._render_interframe_delays_sizes.push(R),this._render_interframe_delays.push(T);let I=jg(this._render_interframe_delays_sizes),A=I-this._render_interframe_delays_sizes[0];if(I>30&&A>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===gs.VideoStateStarting&&(this.videoState=gs.VideoStateDecoding),this.videoState===gs.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(c,te("VIDEO_FREEZE_DURATION"))),T<te("VIDEO_FREEZE_DURATION")&&this.videoState===gs.VideoStateFrozen&&(this.videoState=gs.VideoStateDecoding),T>te("VIDEO_FREEZE_DURATION")&&$l.lastVisibleTime>=$l.lastHiddenTime&&s.timestamp>$l.lastVisibleTime&&s.timestamp>$l.lastHiddenTime){let w=Math.min(66,Yx(this._render_interframe_delays_sizes,this._render_interframe_delays)),k=Math.max(0,T-(R-1)*w);this.renderFreezeAccTime2+=k>w?k:0,this.renderFreezeAccTime+=T}}s=Xi(Xi({},p),{},{timestamp:u})}else this.isSkipCalcRenderFreezeTime()&&(s=Xi(Xi({},p),{},{timestamp:u}));var m,g;te("ENABLE_VIDEO_FRAME_CALLBACK")&&((m=(g=this.videoElement).requestVideoFrameCallback)===null||m===void 0||m.call(g,d))};(e=(t=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(t,d)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),_h()&&!te("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let n=Qn();n.name==="Safari"&&Number(n.version)===15||gv()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,jr()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,jr()&&this.videoElement.load());let i=this.videoElement.play();i!==void 0&&i.catch(s=>{V.debug("[".concat(this.trackId,"] playback interrupted"),s.toString())})}resetVideoElement(){XD.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=qs.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===qs.DESTROYED||this.internal}handleAutoPlayFailed(){let e=t=>{t.preventDefault(),this.videoElement.play().then(()=>{V.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(n=>{V.error(n)}),this.autoplayFailed=!1,Fg()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};Fg()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),Ql()}}let XD=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class JD extends qD{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(e),Ce(this,"container",void 0),Ce(this,"slot",void 0),this.slot=e.element,this.internal=t,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;let t=e.element;var n;!this.internal||this.slot?(t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()):(this.slot=t,t&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(n=this.slot)===null||n===void 0||n.appendChild(this.container)):this.createElements())}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var t;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,n):await zD(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var e;this.container.remove(),(e=this.slot)===null||e===void 0||e.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var e;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",te("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(e=this.slot)===null||e===void 0||e.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var QD,qx,Xx,Jx,Qx,Zx,$x,eV,tV,nV,iV,rV,sV,oV,aV,cV,lV,dV,uV,hV,pV,fV,_V,mV,EV,gV,SV,TV,Pn,kn,vV,yV,RV,CV,bV,IV,AV,Zl;let Ei=(QD=Gt({argsMap:(r,e,t)=>[r.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",t]}),qx=wi(),Xx=Gt({argsMap:r=>[r.getTrackId()]}),Jx=ro("LocalVideoTrack","_enabledMutex"),Qx=Gt({argsMap:(r,e)=>[r.getTrackId(),e]}),Zx=wi(),$x=ro("LocalVideoTrack","_enabledMutex"),eV=Gt({argsMap:(r,e)=>[r.getTrackId(),e]}),tV=wi(),nV=Gt({argsMap:(r,e)=>[r.getTrackId(),e,r._saveEncodeBitrateRatio]}),iV=wi(),rV=Gt({argsMap:(r,e)=>[r.getTrackId(),e]}),sV=wi(),oV=wi(),aV=Gt({argsMap:(r,e,t)=>[r.getTrackId(),e,t]}),cV=wi(),lV=wi(),dV=wi(),uV=Gt({argsMap:r=>[r.getTrackId()]}),hV=wi(),pV=wi(),fV=wi(),_V=wi(),mV=wi(),EV=Gt({argsMap:(r,e)=>[r.getTrackId(),e.name]}),gV=Gt({argsMap:r=>[r.getTrackId()]}),SV=Gt({argsMap:r=>[r.getTrackId()]}),TV=Gt({argsMap:(r,e,t)=>[r.getTrackId(),e.label,t]}),Pn=class gie extends Cv{get videoHeight(){if(ms()){let{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(ms()){let{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==qs.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,t,n,i,s,o){if(super(e,s),Ce(this,"trackMediaType",vc.VIDEO),Ce(this,"_player",void 0),Ce(this,"isUseScaleResolutionDownBy",!1),Ce(this,"_videoVisibleTimer",null),Ce(this,"_previousVideoVisibleStatus",void 0),Ce(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Ce(this,"_encoderConfig",void 0),Ce(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Ce(this,"_optimizationMode",void 0),Ce(this,"_saveEncodeBitrateRatio",1),Ce(this,"_videoHeight",void 0),Ce(this,"_videoWidth",void 0),Ce(this,"_forceBitrateLimit",void 0),Ce(this,"_enabled",!0),Ce(this,"_processorDestination",void 0),Ce(this,"_processorContext",void 0),ms()){let{width:c,height:d}=e.getSettings();this._videoWidth=c,this._videoHeight=d}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=n,this._optimizationMode=i,this._hints=o||[],t&&this._hints.indexOf(rt.CUSTOM_TRACK)!==-1?this._encoderConfig=sr(t):this._encoderConfig=t,this._hints.indexOf(rt.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(gD(sn.CHROME,115)&&gw().indexOf("Windows")!==-1){let c=(function(d,u){if("VideoFrame"in window&&"TransformStream"in window&&on().supportWebRTCInsertableStream){let p=new MediaStreamTrackProcessor(d),m=new MediaStreamTrackGenerator({kind:"video"}),g,T,R=Date.now(),I=()=>{A&&(clearInterval(A),A=void 0),g&&(g.close(),g=void 0),d.stop(),T=void 0,m.removeEventListener("ended",I)},A=window.setInterval(()=>{if(T&&g&&Date.now()-R>1e3)try{m.readyState==="live"?T.enqueue(g.clone()):I()}catch{I()}},1e3),w=new TransformStream({transform:(k,L)=>{m.readyState==="live"?(T=L,R=Date.now(),g===void 0?(g=k,L.enqueue(k.clone())):(L.enqueue(g),g=k)):k.close()}});return m.addEventListener("ended",I),p.readable.pipeThrough(w).pipeTo(m.writable),m}})(e);c&&(V.info("local screen video track begin to inject frame"),this._mediaStreamTrack=c)}t&&this._hints.indexOf(rt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(t),this._processorContext=new ax(this.getTrackId(),"local"),this._processorDestination=new Yr(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){let i=document.getElementById(e);i?e=i:(V.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}V.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let n=Xi(Xi(Xi({},this._getDefaultPlayerConfig()),t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new qD(n):this._player=new JD(n),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let i=this.getVideoElementVisibleStatus();this.safeEmit(Sh.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},te("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,V.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(V.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await On(this,It.NEED_DISABLE_TRACK,this)}catch(n){throw V.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}return t||(this._enabled=!1),void V.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await On(this,It.NEED_ENABLE_TRACK,this)}catch(n){throw V.error("[".concat(this.getTrackId(),"] setEnabled to true error"),n.toString()),n}V.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,V.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await On(this,It.NEED_MUTE_TRACK,this):await On(this,It.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*e),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*e),V.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(e)),this._saveEncodeBitrateRatio=1;try{await On(this,It.NEED_UPDATE_VIDEO_ENCODER,this)}catch(t){return t.throw(V)}}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new H(z.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=gh(e),te("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){let n=Lw({encoderConfig:e});(ms()||fi()||gu())&&(n.deviceId=void 0),V.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(n));try{await this._originMediaStreamTrack.applyConstraints(n),this.updateMediaStreamTrackResolution()}catch(i){let s=new H(z.UNEXPECTED_ERROR,i.toString());throw V.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}}this._encoderConfig=e,this._hints.indexOf(rt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await On(this,It.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(V)}}getStats(){return Lm(()=>{V.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),ei(this,It.GET_STATS)||Xi({},Pw)}async setBeautyEffect(e){V.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,t):await zD(e)}async findClosestProfile(){let{width:e,height:t,frameRate:n}=this.getMediaStreamTrackSettings(),{width:i,height:s,frameRate:o}=this._encoderConfig||{},c=Tv(this._videoWidth||e||i||0),d=Tv(this._videoHeight||t||s||0),u=(function(p,m,g){if(!Array.isArray(te("VIDEO_ENCODER_CONFIG_LIST"))||te("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;let T=Math.min(p,m);return!(T>=480)&&Xi(Xi({},te("VIDEO_ENCODER_CONFIG_LIST").find(R=>R.height>T)),{},{frameRate:g})})(c,d,Tv(n||o||15));if(u)return V.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(c,"x").concat(d," => ").concat(JSON.stringify(u))),this.setEncoderConfiguration(u)}async setBitrateLimit(e){V.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e&&(this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate))}async setOptimizationMode(e){if(e!=="motion"&&e!=="detail"&&e!=="balanced")return void V.error(z.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let t=this._optimizationMode;try{this._optimizationMode=e,await On(this,It.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(n){throw this._optimizationMode=t,V.error("[".concat(this.getTrackId(),"] set optimization mode failed"),n.toString()),n}V.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(e.numSpatialLayers===1&&e.numTemporalLayers!==1)return V.error(z.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,V.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){E4(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(__)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new H(z.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");V.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=gh(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,this._hints.indexOf(rt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await On(this,It.NEED_UPDATE_VIDEO_ENCODER,this)}catch(t){return t.throw(V)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:e,height:t,frameRate:n}=this.getMediaStreamTrackSettings();if(!e||!t||!n)return;let{bitrateMax:i,bitrateMin:s}=this._encoderConfig;if(s==null||i==null){let{max:o,min:c}=(function(d,u,p,m,g){let T=te("BITRATE_ADAPTER_TYPE");if(T==="DEFAULT_BITRATE")return{min:m,max:g};if(g===void 0){let R=Math.floor(200*Math.pow(p/15,.6)*Math.pow(d*u/640/360,.75));g=T==="STANDARD_BITRATE"?4*R:2*R,m=m??R}else m=m??Math.floor(g/10);return{min:m,max:g}})(e,t,n,s,i);if(this._encoderConfig.bitrateMin=c,this._encoderConfig.bitrateMax=o,te("VIDEO_STANDARD_BITRATE_VERSION")&&s==null&&i==null){let[d,u]=(function(p,m,g){let T=4*Math.floor(2e5*Math.pow(g/15,.6)*Math.pow(p*m/230400,.75)),R=p*m,I=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),A=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]),w=cs(I).call(I).next().value,k=1;if(I.has(R))w=I.get(R);else{var L;let ge=Zt(L=Array.from(I.entries())).call(L,(_t,ht)=>{let[Ct]=_t,[Ft]=ht;return Ct-Ft}),je=ge.find(_t=>{let[ht]=_t;return ht>R});if(je){let _t=ge.indexOf(je);if(_t>0){let ht=ge[_t-1],Ct=(R-ht[0])/(je[0]-ht[0]);w=ht[1]+Ct*(je[1]-ht[1])}else w=je[1]}else w=ge[ge.length-1][1]}if(A.has(R))k=A.get(R);else{var j;let ge=Zt(j=Array.from(A.entries())).call(j,(_t,ht)=>{let[Ct]=_t,[Ft]=ht;return Ct-Ft}),je=ge.find(_t=>{let[ht]=_t;return ht>R});if(je){let _t=ge.indexOf(je);if(_t>0){let ht=ge[_t-1],Ct=(R-ht[0])/(je[0]-ht[0]);k=ht[1]+Ct*(je[1]-ht[1])}else k=je[1]}else k=ge[ge.length-1][1]}let K=te("VIDEO_NEW_BITRATE_RATIO");K&&K>0&&(w=K/100);let W=Math.floor(T*w),Y=Math.floor(65e4*Math.pow(p*m/230400,.5)*Math.pow(g/15,.69)),se=W,de=te("VIDEO_STANDARD_BITRATE_VERSION");return de&&de>0&&(de===1?se=T:de===2?se=W:de===3&&(se=Y)),[Math.floor(se/1e3),k]})(e,t,n);this._encoderConfig.bitrateMax=d,this._encoderConfig.bitrateMin=c?Math.min(c,d):d,this._saveEncodeBitrateRatio=u,V.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(n,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else V.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(n,"] => [brMax: ").concat(o,", brMin: ").concat(c,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var e,t;let n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),i={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n?.parentElement},{element:s,slot:o}=i;if(this.isPlaying&&s instanceof HTMLVideoElement&&o instanceof HTMLElement){let c=CD.checkOneElementVisible(s),d=Object.assign({},c);if(d.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=d.visible;let u=Ye.reportApiInvoke(null,{tag:Cn.TRACER,name:Zr.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});d.visible?u.onSuccess("Video is visible"):u.onSuccess("Invisible because of ".concat(d.reason))}return d}return}catch(n){throw new H(z.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new H(z.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],n=this._encoderConfig;e&&(n=Xi(Xi({},n),gh(e))),n=Ki(n);let i=In(8,"track-video-cloned-"),s=new gie(t?this._mediaStreamTrack.clone():this._mediaStreamTrack,n,Ki(this._scalabilityMode),this._optimizationMode,i,Ki(this._hints));return e&&n&&s.setEncoderConfiguration(n),V.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(t)),s}async replaceTrack(e,t){if(!(e instanceof MediaStreamTrack))throw new H(z.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(e.kind!=="video")throw new H(z.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,t,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(Lm(()=>{Ye.reportApiInvoke(null,{name:Zr.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Cn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!te("ENABLE_VIDEO_SEI")||!te("ENABLE_ENCODED_TRANSFORM"))return void V.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new H(z.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let t=this.getRTCRtpTransceiver();if(!t)return void V.warning("Video track is not published, SEI can not be send");let n=t.sender.getParameters();if(n.codecs.length===0)return;let i=n.codecs[0].mimeType.toLocaleLowerCase();i==="video/h264"||i==="video/h265"?this.safeEmit("sei-to-send",e):V.warning("SEI is not supported by ".concat(i))}bindProcessorDestinationEvents(){this.processorDestination.on(sc.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await On(this,It.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await On(this,It.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(sc.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(ds.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(ds.REQUEST_CONSTRAINTS)}},Hn(Pn.prototype,"play",[QD,qx],Object.getOwnPropertyDescriptor(Pn.prototype,"play"),Pn.prototype),Hn(Pn.prototype,"stop",[Xx],Object.getOwnPropertyDescriptor(Pn.prototype,"stop"),Pn.prototype),Hn(Pn.prototype,"setEnabled",[Jx,Qx,Zx],Object.getOwnPropertyDescriptor(Pn.prototype,"setEnabled"),Pn.prototype),Hn(Pn.prototype,"setMuted",[$x,eV,tV],Object.getOwnPropertyDescriptor(Pn.prototype,"setMuted"),Pn.prototype),Hn(Pn.prototype,"setSaveEncodeBitrateRatio",[nV,iV],Object.getOwnPropertyDescriptor(Pn.prototype,"setSaveEncodeBitrateRatio"),Pn.prototype),Hn(Pn.prototype,"setEncoderConfiguration",[rV,sV],Object.getOwnPropertyDescriptor(Pn.prototype,"setEncoderConfiguration"),Pn.prototype),Hn(Pn.prototype,"getStats",[oV],Object.getOwnPropertyDescriptor(Pn.prototype,"getStats"),Pn.prototype),Hn(Pn.prototype,"setBeautyEffect",[aV,cV],Object.getOwnPropertyDescriptor(Pn.prototype,"setBeautyEffect"),Pn.prototype),Hn(Pn.prototype,"getCurrentFrameData",[lV],Object.getOwnPropertyDescriptor(Pn.prototype,"getCurrentFrameData"),Pn.prototype),Hn(Pn.prototype,"getCurrentFrameImage",[dV],Object.getOwnPropertyDescriptor(Pn.prototype,"getCurrentFrameImage"),Pn.prototype),Hn(Pn.prototype,"findClosestProfile",[uV,hV],Object.getOwnPropertyDescriptor(Pn.prototype,"findClosestProfile"),Pn.prototype),Hn(Pn.prototype,"setBitrateLimit",[pV],Object.getOwnPropertyDescriptor(Pn.prototype,"setBitrateLimit"),Pn.prototype),Hn(Pn.prototype,"setOptimizationMode",[fV],Object.getOwnPropertyDescriptor(Pn.prototype,"setOptimizationMode"),Pn.prototype),Hn(Pn.prototype,"setScalabiltyMode",[_V],Object.getOwnPropertyDescriptor(Pn.prototype,"setScalabiltyMode"),Pn.prototype),Hn(Pn.prototype,"updateMediaStreamTrackResolution",[mV],Object.getOwnPropertyDescriptor(Pn.prototype,"updateMediaStreamTrackResolution"),Pn.prototype),Hn(Pn.prototype,"pipe",[EV],Object.getOwnPropertyDescriptor(Pn.prototype,"pipe"),Pn.prototype),Hn(Pn.prototype,"unpipe",[gV],Object.getOwnPropertyDescriptor(Pn.prototype,"unpipe"),Pn.prototype),Hn(Pn.prototype,"close",[SV],Object.getOwnPropertyDescriptor(Pn.prototype,"close"),Pn.prototype),Hn(Pn.prototype,"replaceTrack",[TV],Object.getOwnPropertyDescriptor(Pn.prototype,"replaceTrack"),Pn.prototype),Pn),zi=(kn=Gt({argsMap:(r,e)=>[r.getTrackId(),e]}),vV=wi(),yV=ro("CameraVideoTrack","_enabledMutex"),RV=Gt({argsMap:(r,e)=>[r.getTrackId(),e]}),CV=wi(),bV=Gt({argsMap:(r,e)=>[r.getTrackId(),e]}),IV=wi(),AV=Gt({argsMap:r=>[r.getTrackId()]}),Zl=class Sie extends Ei{get __className__(){return"CameraVideoTrack"}constructor(e,t,n,i,s,o){super(e,gh(t.encoderConfig),i,s,o),Ce(this,"_config",void 0),Ce(this,"_originalConstraints",void 0),Ce(this,"_constraints",void 0),Ce(this,"_enabled",!0),Ce(this,"_deviceName","default"),Ce(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(gv()||Vg())&&!(function(){let c=Qn();if(c.os!==Br.IOS||!c.osVersion)return!1;let d=c.osVersion.split(".");return Number(d[0])===15&&Number(d[1])>=2})()&&Su()&&this._enabled&&!this._isClosed&&(V.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=t,this._originalConstraints=n,this._constraints=n,this._deviceName=e.label,this._encoderConfig=gh(this._config.encoderConfig),Yn.on(Po.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Yn.on(Po.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return typeof e=="string"?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(V.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{let t=await oc.getDeviceById(e),n={};n.video=Xi({},this._constraints),n.video.deviceId={exact:e},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await Jl(n,this.getTrackId())}catch(s){throw V.error("[".concat(this.getTrackId(),"] setDevice failed"),s.toString()),i=await Jl({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),s}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(t){throw V.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{let t=await oc.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(t){throw V.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}V.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){V.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));let t={video:Xi(Xi({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let n=null;try{n=await Jl(t,this.getTrackId())}catch(i){throw V.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),i.toString()),n=await Jl({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=Xi({},t.video),V.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(V.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let n=await Jl({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1)}await On(this,It.NEED_ENABLE_TRACK,this)}catch(n){throw V.error("[".concat(this.getTrackId(),"] setEnabled true error"),n.toString()),n}this.updateMediaStreamTrackResolution(),V.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await On(this,It.NEED_DISABLE_TRACK,this)}catch(n){throw V.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}V.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new H(z.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=gh(e),te("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);let n=sr(this._config);n.encoderConfig=e;let i=Lw(n);(ms()||fi()||gu())&&(i.deviceId=void 0),V.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(s){let o=new H(z.UNEXPECTED_ERROR,s.toString());throw V.error("[".concat(this.getTrackId(),"] applyConstraints error"),o.toString()),o}this._config=n,this._constraints=i,this._originalConstraints=i,this._encoderConfig=e,this._hints.indexOf(rt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await On(this,It.NEED_UPDATE_VIDEO_ENCODER,this)}catch(s){return s.throw(V)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((fi()||gu())&&this._enabled&&!this._isClosed&&Yn.duringInterruption){let e=async()=>{Yn.off(Po.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(V.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Yn.on(Po.IOS_INTERRUPTION_END,e)}else V.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Sh.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,n=oc.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId={exact:n}),this._enabled){let i=await Jl({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Yn.off(Po.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Yn.off(Po.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],n=this._encoderConfig;e&&(n=Xi(Xi({},n),gh(e))),n=Ki(n);let i=In(8,"track-cam-cloned-"),s=new Sie(t?this._mediaStreamTrack.clone():this._mediaStreamTrack,Ki(Xi(Xi({},this._config),{},{encoderConfig:n})),Ki(this._constraints),Ki(this._scalabilityMode),this._optimizationMode,i);return e&&n&&s.setEncoderConfiguration(n),V.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(t)),s}bindProcessorContextEvents(){this.processorContext.on(ds.REQUEST_UPDATE_CONSTRAINTS,async(e,t,n)=>{try{let i=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(i),t()}catch(i){n(i)}}),this.processorContext.on(ds.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}},Hn(Zl.prototype,"setDevice",[kn,vV],Object.getOwnPropertyDescriptor(Zl.prototype,"setDevice"),Zl.prototype),Hn(Zl.prototype,"setEnabled",[yV,RV,CV],Object.getOwnPropertyDescriptor(Zl.prototype,"setEnabled"),Zl.prototype),Hn(Zl.prototype,"setEncoderConfiguration",[bV,IV],Object.getOwnPropertyDescriptor(Zl.prototype,"setEncoderConfiguration"),Zl.prototype),Hn(Zl.prototype,"close",[AV],Object.getOwnPropertyDescriptor(Zl.prototype,"close"),Zl.prototype),Zl);function AC(r,e,t,n){t.optimizationMode&&(n&&n.width&&n.height?(t.encoderConfig=Xi(Xi({},n),{},{bitrateMin:n.bitrateMin,bitrateMax:n.bitrateMax}),t.optimizationMode!=="motion"&&t.optimizationMode!=="detail"||(e.contentHint=t.optimizationMode,e.contentHint===t.optimizationMode?V.debug("[".concat(r,"] set content hint to"),t.optimizationMode):V.debug("[".concat(r,"] set content hint failed")))):V.warning("[".concat(r,"] can not apply optimization mode bitrate config, no encoderConfig")))}var ZD,wV,OV,NV,Pd,kd,DV,PV,kV,LV,MV,Ga;class Wa extends Ji{getUserId(){return this._userId}constructor(e,t,n,i){super(e,"track-".concat(e.kind,"-").concat(t,"-").concat(i.clientId,"_").concat(In(5,""))),Ce(this,"_userId",void 0),Ce(this,"_uintId",void 0),Ce(this,"_isDestroyed",!1),Ce(this,"store",void 0),Ce(this,"processor",void 0),Ce(this,"processorContext",void 0),this._userId=t,this._uintId=n,this.store=i}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,V.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Iv=(ZD=Gt({argsMap:(r,e,t)=>[r.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",t]}),wV=Gt({argsMap:r=>[r.getTrackId()]}),OV=Gt({argsMap:(r,e)=>[r.getTrackId(),e.name]}),NV=Gt({argsMap:r=>[r.getTrackId()]}),Hn((Pd=class extends Wa{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==qs.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(r,e,t,n,i){super(r,e,t,n),Ce(this,"_videoVisibleTimer",null),Ce(this,"_previousVideoVisibleStatus",void 0),Ce(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Ce(this,"trackMediaType",vc.VIDEO),Ce(this,"_videoWidth",void 0),Ce(this,"_videoHeight",void 0),Ce(this,"_player",void 0),Ce(this,"_prePlayer",void 0),Ce(this,"processorDestination",void 0),Ce(this,"processorContext",void 0),this._prePlayer=i,this.updateMediaStreamTrackResolution(),this.processorContext=new ax(this.getTrackId(),"remote"),this.processorDestination=new Yr(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Lm(()=>{V.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),ei(this,It.GET_STATS)||Xi({},p4)}play(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(Tc.PLAY_START),typeof r=="string"){let n=document.getElementById(r);n?r=n:(V.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}V.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));let t=Xi(Xi({fit:"cover"},e),{},{trackId:this.getTrackId(),element:r});if(this._player)this._player.updateConfig(t);else{let n=!1,i=!1;r instanceof HTMLVideoElement?(this._player=new qD(t),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,i=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,n=this._player.videoState>0,this._player.updateConfig(t)):this._player=new JD(t),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Tc.FIRST_FRAME_DECODED),i&&this.safeEmit(Tc.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=s=>{this.safeEmit(Tc.VIDEO_STATE_CHANGED,s)},n&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let n=this.getVideoElementVisibleStatus();this.safeEmit(Tc.VIDEO_ELEMENT_VISIBLE_STATUS,n)}catch{}},te("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(Tc.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,V.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){E4(this._originMediaStreamTrack).then(r=>{let[e,t]=r;this._videoHeight=t,this._videoWidth=e}).catch(__)}_updatePlayerSource(){V.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var r,e;let t=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),n={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:t?.parentElement},{element:i,slot:s}=n;if(this.isPlaying&&i instanceof HTMLVideoElement&&s instanceof HTMLElement){let o=CD.checkOneElementVisible(i),c=Object.assign({},o);if(c.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=c.visible;let d=Ye.reportApiInvoke(null,{tag:Cn.TRACER,name:Zr.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});c.visible?d.onSuccess("Video is visible"):d.onSuccess("Invisible because of ".concat(c.reason))}return c}return}catch(t){throw new H(z.GET_VIDEO_ELEMENT_VISIBLE_ERROR,t.message)}}pipe(r){if(this.processor===r)return r;if(r._source)throw new H(z.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;let r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(sc.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(sc.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(r){this.emit(Rv.SEI_RECEIVED,r)}}).prototype,"play",[ZD],Object.getOwnPropertyDescriptor(Pd.prototype,"play"),Pd.prototype),Hn(Pd.prototype,"stop",[wV],Object.getOwnPropertyDescriptor(Pd.prototype,"stop"),Pd.prototype),Hn(Pd.prototype,"pipe",[OV],Object.getOwnPropertyDescriptor(Pd.prototype,"pipe"),Pd.prototype),Hn(Pd.prototype,"unpipe",[NV],Object.getOwnPropertyDescriptor(Pd.prototype,"unpipe"),Pd.prototype),Pd),tf=(kd=Gt({argsMap:(r,e)=>[r.getTrackId(),e],throttleTime:300}),DV=Gt({argsMap:(r,e)=>[r.getTrackId(),e]}),PV=Gt({argsMap:r=>[r.getTrackId()]}),kV=Gt({argsMap:r=>[r.getTrackId()]}),LV=Gt({argsMap:(r,e)=>[r.getTrackId(),e.name]}),MV=Gt({argsMap:r=>[r.getTrackId()]}),Hn((Ga=class extends Wa{get isPlaying(){return this._useAudioElement?Hc.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(r,e,t,n){super(r,e,t,n),Ce(this,"trackMediaType",vc.AUDIO),Ce(this,"_source",void 0),Ce(this,"_useAudioElement",!0),Ce(this,"_volume",100),Ce(this,"processorContext",void 0),Ce(this,"processorDestination",void 0),Ce(this,"_played",!1),Ce(this,"_bypassWebAudio",!1),te("DISABLE_WEBAUDIO")?(this._source=new KD,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new ix(r,!0),te("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(rc.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Tc.FIRST_FRAME_DECODED)}),this.processorContext=new lx(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new cx(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(rc.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!r)return this._source.removeAllListeners(rc.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(rc.ON_AUDIO_BUFFER),this._source.on(rc.ON_AUDIO_BUFFER,t=>r(t))}setVolume(r){this._volume=r,this._useAudioElement?Hc.setVolume(this.getTrackId(),r):this._source.setVolume(r/100)}async setPlaybackDevice(r){if(!this._useAudioElement||!ai())throw new H(z.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Hc.setSinkID(this.getTrackId(),r)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Lm(()=>{V.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),ei(this,It.GET_STATS)||Xi({},BD)}play(){V.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(V.debug("[".concat(this.getTrackId(),"] use audio element to play")),Hc.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){V.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Hc.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let r=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];V.debug("[".concat(this.getTrackId(),"] update player source track")),r&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Hc.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(r){if(this._bypassWebAudio)throw new H(z.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===r)return r;if(r._source)throw new H(z.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),r}unpipe(){var r;if(this._bypassWebAudio)throw new H(z.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let e=this.processor;(r=this._source.processSourceNode)===null||r===void 0||r.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(sc.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(sc.ON_NODE,r=>{this._source.processedNode=r;let e=!r;this._useAudioElement!==e&&(this._played?(this.stop(),this._useAudioElement=e,this.play()):this._useAudioElement=e)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(sc.ON_TRACK),this.processorDestination.removeAllListeners(sc.ON_NODE)}}).prototype,"setVolume",[kd],Object.getOwnPropertyDescriptor(Ga.prototype,"setVolume"),Ga.prototype),Hn(Ga.prototype,"setPlaybackDevice",[DV],Object.getOwnPropertyDescriptor(Ga.prototype,"setPlaybackDevice"),Ga.prototype),Hn(Ga.prototype,"play",[PV],Object.getOwnPropertyDescriptor(Ga.prototype,"play"),Ga.prototype),Hn(Ga.prototype,"stop",[kV],Object.getOwnPropertyDescriptor(Ga.prototype,"stop"),Ga.prototype),Hn(Ga.prototype,"pipe",[LV],Object.getOwnPropertyDescriptor(Ga.prototype,"pipe"),Ga.prototype),Hn(Ga.prototype,"unpipe",[MV],Object.getOwnPropertyDescriptor(Ga.prototype,"unpipe"),Ga.prototype),Ga),$l=new class extends Sr{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Ce(this,"_lastHiddenTime",0),Ce(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),V.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class nf extends Sr{constructor(e,t){super(),Ce(this,"trackMediaType",vc.DATA),Ce(this,"_version",1),Ce(this,"_type",3),Ce(this,"_config",void 0),Ce(this,"_originDataChannel",void 0),Ce(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Ce(this,"_dataStreamPacketHandler",{serialize:n=>n,deserialize:n=>n}),Ce(this,"_datachannelEventMap",new Map),this._config=e,t&&(this._originDataChannel=t,this._bandDataChannelEvents(t)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return te("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,t;return(e=(t=this._originDataChannel)===null||t===void 0?void 0:t.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,t;return(e=(t=this._originDataChannel)===null||t===void 0?void 0:t.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new De((e,t)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();let n=setTimeout(()=>{var i;t(new H(z.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((i=this._originDataChannel)===null||i===void 0?void 0:i.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(n),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(n),new H(z.DATACHANNEL_CONNECTION_TIMEOUT)}}else t(new H(z.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){let e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[IC.OPEN,IC.CLOSE,IC.ERROR].forEach(t=>{let n=()=>{this.emit(t)};this._datachannelEventMap.set(t,n),e.addEventListener(t,n)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(t=>{let[n,i]=t;e.removeEventListener(n,i)}),this._datachannelEventMap.clear()}}class v4 extends nf{constructor(e){super(e),Ce(this,"_messageListener",void 0),this._messageListener=t=>{if(t.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let n=t.data.slice(0,this._dataStreamPacketHeader.byteLength),i=new DataView(n).getUint8(3);if(i!==this.id)return void(te("SHOW_DATASTREAM2_LOG")&&V.debug("invalid datachannel id: ".concat(i," !== ").concat(this.id)));let s=t.data.slice(this._dataStreamPacketHeader.byteLength);s=this._dataStreamPacketHandler.deserialize(s),this.emit(IC.MESSAGE,s)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Rz extends nf{send(e){if(this._originDataChannel){let t=e;t=this._dataStreamPacketHandler.serialize(e);let n=new Uint8Array(this._dataStreamPacketHeader.byteLength+t.byteLength);n.set(new Uint8Array(this._dataStreamPacketHeader),0),n.set(new Uint8Array(t),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(n.buffer)}}}function $D(){let r=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>XT.revokeObjectURL(r),0),new Worker(XT.createObjectURL(r))}let xw=71,eP=1,Vw=2,Fw=1,tP=2;var Bm=(function(r){return r[r.AUDIO_LEVEL=1]="AUDIO_LEVEL",r[r.METADATA=2]="METADATA",r[r.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",r})(Bm||{});function E_(r){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1],t=r.getUint8(0);if(t!==xw)return;let n=r.getUint16(1),i=eP+Vw+n,s=new Uint8Array(r.byteLength-i);s.set(new Uint8Array(r.buffer,i,r.byteLength-i));let o={m:t,tlvLen:n,tlv:[],frame:s},c=eP+Vw;for(;c<i;){let d=r.getUint8(c),u=r.getUint16(c+Fw),p=Fw+tP;if(d===Bm.AUDIO_LEVEL){let m=r.getUint8(c+p);for(let g=1;g<u;g++)m=m<<8|r.getUint8(c+p+g);o.tlv.push({tag:d,length:u,value:e?127^m>>1:127&m})}else if(d===Bm.METADATA||d===Bm.AUDIO_64_BIT_PTS){let m=new Uint8Array(u);for(let g=0;g<u;g++)m[g]=r.getUint8(c+p+g);o.tlv.push({tag:d,length:u,value:m})}c+=p+u}return o}let wC=new Map,Av=127,g_=1e-10,jm=139/13,OC=new Map;function NC(r,e,t){let n="".concat(r,"-").concat(e,"-").concat(t),i=0;return OC.has(n)?i=OC.get(n):(i=Math.log((function(s,o){let c=s-o;o<c&&(o=c);let d=1;for(let u=s,p=1;u>o;u--,p++)d=d*u/p;return d})(e,r))+r*Math.log(.5)+(e-r)*Math.log(1-.5)-Math.log(t)+t*r,OC.set(n,i)),i<g_&&(i=g_),i}function nP(r,e,t){let n=e.length,i=r.length/n,s=!1;for(let o=0,c=0;o<n;o++){let d=0;for(let u=c+i;c<u;c++)r[c]>t&&d++;e[o]!==d&&(e[o]=d,s=!0)}return s}window.cache=OC;let y4=0;class R4{constructor(e){Ce(this,"id",void 0),Ce(this,"immediates",[]),Ce(this,"lastNonSilence",-1),Ce(this,"immediateSpeechActivityScore",g_),Ce(this,"lastLevelChangedTime",Date.now()),Ce(this,"levels",[]),Ce(this,"longs",[]),Ce(this,"longSpeechActivityScore",g_),Ce(this,"mediums",[]),Ce(this,"mediumSpeechActivityScore",g_),Ce(this,"minLevel",0),Ce(this,"nextMinLevel",0),Ce(this,"nextMinLevelWindowLength",0),Ce(this,"energyScore",0),this.id=e||"".concat(y4++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){let e=this.immediates,t=this.levels,n=this.minLevel+jm,i=!1;for(let s=0;s<e.length;++s){let o=t[s];o<n&&(o=0);let c=Math.floor(o/jm);e[s]!==c&&(e[s]=c,i=!0)}return i}computeLongs(){return nP(this.mediums,this.longs,4)}computeMediums(){return nP(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=NC(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(e){this.longSpeechActivityScore=NC(this.longs[0],10,47),this.longSpeechActivityScore>g_&&(this.lastNonSilence=e)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=NC(this.mediums[0],5,24)}evaluateSpeechActivityScores(e){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(e)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var e;return"[".concat(zS(e=[...this.levels]).call(e).join(),"]")}getSpeechActivityScore(e){switch(e){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+e)}}levelChanged(e,t){if(this.lastLevelChangedTime<=t){this.lastLevelChangedTime=t;let n=e;return e<0&&(n=0),e>Av&&(n=Av),this.levels.unshift(n),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(n),n>=this.minLevel+jm?n:n/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(e){if(e!==0){if(this.minLevel===0||this.minLevel>e)return this.minLevel=e,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=e,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>e&&(this.nextMinLevel=e),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let t=Math.sqrt(this.minLevel*this.nextMinLevel);t<0?t=0:t>Av&&(t=Av),this.minLevel=t,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class C4{constructor(e){Ce(this,"algorithm",void 0),this.algorithm=e}execute(){let e=!this.algorithm;if(!e)try{let t=this.algorithm.runInDecisionMaker(this);t<=0?e=!0:setTimeout(this.execute.bind(this),t)}catch{e=!0}e&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class UV{constructor(e,t,n){Ce(this,"isDominant",void 0),Ce(this,"energyRanking",void 0),Ce(this,"energyScore",void 0),this.isDominant=e,this.energyRanking=t,this.energyScore=n}}class xV extends Sr{constructor(e){super(),Ce(this,"dominantId",null),Ce(this,"lastDecisionTime",0),Ce(this,"lastLevelChangedTime",0),Ce(this,"lastLevelIdleTime",0),Ce(this,"relativeSpeechActivities",[]),Ce(this,"speakers",new Map),Ce(this,"enableSilence",!1),Ce(this,"timeoutToSilenceInterval",0),Ce(this,"decisionMaker",null),Ce(this,"loudest",[]),Ce(this,"numLoudestToTrack",3),Ce(this,"energyExpireTimeMs",250),Ce(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=e,this.enableSilence=e>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=e,t!=null&&(this.energyExpireTimeMs=t),n!=null&&(this.energyAlphaPct=n),this.loudest.length>e&&this.loudest.splice(e)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(e){return this.loudest.some(t=>t.id===e)}levelChanged(e,t){let n=Date.now(),i=this.getOrCreateSpeaker(e);this.lastLevelChangedTime<n&&(this.lastLevelChangedTime=n,this.maybeStartDecisionMaker());let s=i.levelChanged(t,n);return this.updateLoudestList(i,s,n)}runInDecisionMaker(e){return this.decisionMaker!==e||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(e){this.decisionMaker===e&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(e){e.forEach(t=>{this.speakers.has(t.id)||this.speakers.set(t.id,t)})}removeSpeakers(e){e.forEach(t=>{this.speakers.delete(t.id)})}getOrCreateSpeaker(e){let t=this.speakers.get(e);return t||(t=new R4(e),this.speakers.set(e,t),this.maybeStartDecisionMaker()),t}updateLoudestList(e,t,n){let i=e.id===this.dominantId;if(t<0){let d=0;for(;d<this.loudest.length&&this.loudest[d]!==e;)++d;return new UV(i,d,e.energyScore)}if(e.energyScore=Math.floor((this.energyAlphaPct*t+(100-this.energyAlphaPct)*e.energyScore+50)/100),this.numLoudestToTrack===0)return new UV(i,0,e.energyScore);let s=n-this.energyExpireTimeMs,o=0;for(;o<this.loudest.length;){let d=this.loudest[o];if(d.getLastLevelChangedTime()<s&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(o,1);else if(d.id!==e.id)++o;else if(this.loudest.splice(o,1),this.loudest.length<this.numLoudestToTrack)break}let c=0;for(;c<this.loudest.length&&!(this.loudest[c].energyScore<e.energyScore);)++c;return c<this.numLoudestToTrack&&(this.loudest.splice(c,0,e),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new UV(i,c,e.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new C4(this),this.decisionMaker.execute())}makeDecision(e){let t=null,n=null,i=this.speakers.size,s=null;if(i===0)s=null;else if(i===1){var o;let c=cs(o=this.speakers).call(o).next().value;this.enableSilence&&c&&(s=c.id,c.evaluateSpeechActivityScores(e),e-c.lastNonSilence>this.timeoutToSilenceInterval&&(s=null))}else{let c=this.dominantId==null?null:this.speakers.get(this.dominantId);if(c==null){let p=this.speakers.entries().next();p.value&&(s=p.value[0],c=p.value[1])}else s=c.id;c?.evaluateSpeechActivityScores(e);let d=this.relativeSpeechActivities,u=2;for(let p of this.speakers.entries()){let[m,g]=p;if(g===c)continue;g.evaluateSpeechActivityScores(e);for(let A=0;A<d.length;++A){let w=c==null?g_:c.getSpeechActivityScore(A);d[A]=Math.log(g.getSpeechActivityScore(A)/w)}let T=d[0],R=d[1],I=d[2];T>3&&R>2&&I>0&&R>u&&(u=R,s=m)}this.enableSilence&&c!=null&&s===c.id&&e-c.lastNonSilence>this.timeoutToSilenceInterval&&(s=null)}s==null&&!this.enableSilence||s===this.dominantId||(t=this.dominantId,this.dominantId=s,n=this.dominantId),n==null&&!this.enableSilence||n===t||this.emit("ActiveSpeakerChanged",n)}_runInDecisionMaker(){let e=Date.now(),t=300-(e-this.lastLevelIdleTime),n=0;t<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(e),this.lastLevelIdleTime=e):n=t;let i=300-(e-this.lastDecisionTime);return i<=0&&(this.lastDecisionTime=e,this.makeDecision(e),i=300-(Date.now()-e)),i>0&&n>i&&(n=i),n}timeoutIdleLevels(e){let t=[];for(let i of cs(n=this.speakers).call(n)){var n;let s=e-i.getLastLevelChangedTime();36e5<s&&(this.dominantId==null||i.id!==this.dominantId)?t.push(i.id):300<s&&i.levelTimedOut()}t.forEach(i=>this.speakers.delete(i))}}let DC=new Map,El=null,Ld=null,Bw=3,Kg=[],Kc=new Map,Md=new Map;class iP{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(e,t){Ce(this,"id",void 0),Ce(this,"track",void 0),Ce(this,"score",0),Ce(this,"active",!0),Ce(this,"muted",!1),Ce(this,"timer",0),Ce(this,"actives",0),Ce(this,"inactives",0),this.id=e,this.track=t,this.setActive(Kc.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){let e=this.active;this.active=this.activeRate>=.8;let{actives:t,inactives:n}=(function(){let i=[],s=[];return Array.from(cs(Kc).call(Kc)).forEach(o=>{o.active?i.push(o):s.push(o)}),{actives:i,inactives:s}})();if(t.length>3){let i;t.forEach(s=>{(!i||i.score>s.score)&&(i=s)}),i&&i.setActive(!1)}if(t.length<3&&n.length>0){let i;n.forEach(s=>{(!i||i.score<s.score)&&s.id!==this.id&&(i=s)}),i&&e&&!this.active&&(i.samples>40&&i.activeRate-this.activeRate>.4?i.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(e){this.active=e,this.resetTimer(),this.setMuted(!e)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){let e=(function(t){let n;return Array.from(cs(Kc).call(Kc)).forEach(i=>{!i.active||i.id===t||i.samples<40||(!n||i.score<n.score)&&(n=i)}),n})(this.id);e&&this.activeRate-e.activeRate>.4&&(e.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){let e=(function(t){let n;return Array.from(cs(Kc).call(Kc)).forEach(i=>{i.active||i.id===t||i.samples<40||(!n||i.score>n.score)&&(n=i)}),n})(this.id);e&&e.activeRate-this.activeRate>.4&&(e.setActive(!0),this.setActive(!1))}addSample(e){e?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(e){this.track&&(this.track.enabled=!e,this.muted=e)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let rP;function jw(r){let e=Kc.get(r);e&&(Kc.delete(r),e.clearTimer())}let Gw=new Map,sP=new Map,VV="video/h264",Ww="video/h265";function oP(r,e,t){let n=new Uint8Array(r,e,t),i=[],s=0;for(;i.length<t;)s+3<t&&n[s]===0&&n[s+1]===0&&n[s+2]===3&&(n[s+3]===0||n[s+3]===1||n[s+3]===2||n[s+3]===3)?(i.push(n[s],n[s+1],n[s+3]),s+=4):(i.push(n[s]),s++);return new Uint8Array(i)}function FV(r){let e=r.length,t=[],n=0;for(;n<e;)n+2<e&&r[n]===0&&r[n+1]===0&&(r[n+2]===0||r[n+2]===1||r[n+2]===2||r[n+2]===3)?(t.push(r[n],r[n+1],3,r[n+2]),n+=3):(t.push(r[n]),n++);return new Uint8Array(t)}function BV(r){if(r.length<5)return"";let e=-1;for(let i=0;i<r.length-3;i++){if(r[i]===0&&r[i+1]===0&&r[i+2]===1){e=i;break}if(i<r.length-4&&r[i]===0&&r[i+1]===0&&r[i+2]===0&&r[i+3]===1){e=i;break}}if(e===-1)return"";let t=e+(r[e+2]===0?4:3);if(t>=r.length)return"";let n=r[t];return 128&n?"":(n>>1&63)>=32||t+1<r.length&&!(248&r[t+1])?Ww:(31&n)<=31?VV:""}let Hw=new Map,zg=new Map;(function(){let r=Qn();Pe.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Pe.getStreamFromExtension=r.name===sn.CHROME&&Number(r.version)>34,Pe.supportUnifiedPlan=(function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let e=new RTCPeerConnection,t=!1;try{e.addTransceiver("audio"),t=!0}catch{}return e.close(),t})(),Pe.supportMinBitrate=r.name===sn.CHROME||r.name===sn.EDGE,Pe.supportSetRtpSenderParameters=(function(){let e=Qn();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Xp()||!(!ms()&&!Tw())||e.name===sn.FIREFOX&&Number(e.version)>=64)})(),r.name===sn.SAFARI&&(Number(r.version)>=14?Pe.supportDualStream=!0:Pe.supportDualStream=!1),Pe.webAudioMediaStreamDest=(function(){let e=Qn();return!(e.name===sn.SAFARI&&Number(e.version)<12)})(),Pe.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Pe.supportWebGL=typeof WebGLRenderingContext<"u",Pe.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Xp()||(Pe.webAudioWithAEC=!0),Pe.supportShareAudio=(function(){let e=Qn();return(e.os===Br.WIN_10||e.os===Br.WIN_81||e.os===Br.WIN_7||e.os===Br.LINUX||e.os===Br.MAC_OS||e.os===Br.CHROMIUM_OS)&&e.name===sn.CHROME&&Number(e.version)>=74})(),Pe.supportDataChannel=!!(mo(76)||yw(68)||SD(14)),Pe.supportPCSetConfiguration=(function(){let e=window.RTCPeerConnection;return!jr()&&!!e&&e.prototype.setConfiguration instanceof Function})(),Pe.supportWebRTCEncodedTransform=mo(87)||Xo()||yw(117),Pe.supportWebRTCInsertableStream=(function(){let e=Qn();return(e.name===sn.CHROME||e.name===sn.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window})(),Pe.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Pe.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,km(()=>{Pe.supportDualStreamEncoding=(function(){let e=Qn();return!!te("DISABLE_WEBAUDIO")||e.name==="Safari"&&Number(e.version)>=14||!!(e.name==="Chrome"&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&te("CHROME_DUAL_STREAM_USE_ENCODING"))})(),V.debug("browser ua: ",navigator.userAgent),V.info("browser info: ",r),V.info("browser compatibility: ",Pe)})})();let Kw=["CHINA","GLOBAL"],b4=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Yg=[],yh=[];function Rh(r,e){return!!e&&Yg.some(t=>t.uid===r&&t.channelName===e)}function Gm(){return yh.length>0}var jV=B3.forEach,I4=Qu("forEach")?[].forEach:function(r){return jV(this,r,arguments.length>1?arguments[1]:void 0)};Ut({target:"Array",proto:!0,forced:[].forEach!==I4},{forEach:I4});var A4=to("Array","forEach"),Cz=fc,bz=bi,Iz=ee,Az=A4,GV=Array.prototype,WV={DOMTokenList:!0,NodeList:!0},wz=function(r){var e=r.forEach;return r===GV||Iz(GV,r)&&e===GV.forEach||bz(WV,Cz(r))?Az:e},Oz=S(wz),Nz=Ao,w4=fp;Ut({target:"Object",stat:!0,forced:y(function(){w4(1)})},{keys:function(r){return w4(Nz(r))}});var O4=S(xn.Object.keys),Dz=S(ap),Pz=S(Fy),kz=Ut,N4=tl,D4=$f,Lz=vn,P4=lt,k4=Vr,Mz=Gi,Uz=dA,xz=Fn,Vz=Do,Fz=O2("slice"),Bz=xz("species"),HV=Array,KV=Math.max;kz({target:"Array",proto:!0,forced:!Fz},{slice:function(r,e){var t,n,i,s=Mz(this),o=k4(s),c=P4(r,o),d=P4(e===void 0?o:e,o);if(N4(s)&&(t=s.constructor,(D4(t)&&(t===HV||N4(t.prototype))||Lz(t)&&(t=t[Bz])===null)&&(t=void 0),t===HV||t===void 0))return Vz(s,c,d);for(n=new(t===void 0?HV:t)(KV(d-c,0)),i=0;c<d;c++,i++)c in s&&Uz(n,i,s[c]);return n.length=i,n}});var jz=to("Array","slice"),Gz=ee,Wz=jz,zV=Array.prototype,YV=function(r){var e=r.slice;return r===zV||Gz(zV,r)&&e===zV.slice?Wz:e},Hz=S(YV);function Dt(r,e,t,n,i){var s,o,c,d={};return Oz(s=O4(n)).call(s,function(u){d[u]=n[u]}),d.enumerable=!!d.enumerable,d.configurable=!!d.configurable,("value"in d||d.initializer)&&(d.writable=!0),d=Dz(o=Pz(c=Hz(t).call(t)).call(c)).call(o,function(u,p){return p(r,e,u)||u},d),i&&d.initializer!==void 0&&(d.value=d.initializer?d.initializer.call(i):void 0,d.initializer=void 0),d.initializer===void 0?(b2(r,e,d),null):d}let At=(function(r){return r[r.ACCESS_POINT=101]="ACCESS_POINT",r[r.UNILBS=201]="UNILBS",r[r.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",r})({}),PC=(function(r){return r[r.IIIEGAL_APPID=1]="IIIEGAL_APPID",r[r.IIIEGAL_UID=2]="IIIEGAL_UID",r[r.INTERNAL_ERROR=3]="INTERNAL_ERROR",r})({}),Ud=(function(r){return r[r.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",r[r.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",r[r.INTERNAL_ERROR=8]="INTERNAL_ERROR",r[r.NO_AUTHORIZED=9]="NO_AUTHORIZED",r[r.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",r[r.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",r[r.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",r[r.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",r[r.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",r[r.USER_OVERLOAD=16]="USER_OVERLOAD",r[r.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",r[r.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",r})({}),bs=(function(r){return r[r.NO_FLAG_SET=100]="NO_FLAG_SET",r[r.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",r[r.INVALID_FALG_SET=102]="INVALID_FALG_SET",r[r.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",r[r.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",r[r.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",r[r.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",r[r.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",r[r.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",r[r.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",r[r.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",r[r.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",r[r.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",r[r.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",r[r.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",r[r.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",r[r.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",r[r.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",r[r.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",r})({}),Mt=(function(r){return r[r.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",r[r.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",r[r.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",r[r.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",r[r.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",r[r.K_TICKET_INVALID=7]="K_TICKET_INVALID",r[r.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",r[r.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",r[r.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",r[r.K_UID_BANNED=14]="K_UID_BANNED",r[r.K_IP_BANNED=15]="K_IP_BANNED",r[r.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",r[r.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",r[r.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",r[r.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",r[r.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",r[r.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",r[r.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",r[r.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",r[r.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",r[r.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",r[r.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",r[r.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",r[r.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",r[r.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",r[r.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",r[r.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",r[r.ERR_INVALID_UID=117]="ERR_INVALID_UID",r[r.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",r[r.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",r[r.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",r[r.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",r[r.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",r[r.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",r[r.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",r[r.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",r[r.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",r[r.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",r[r.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",r[r.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",r[r.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",r[r.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",r[r.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",r[r.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",r[r.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",r[r.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",r[r.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",r[r.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",r[r.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",r[r.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",r[r.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",r[r.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",r[r.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",r[r.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",r[r.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",r[r.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",r[r.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",r[r.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",r[r.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",r[r.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",r[r.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",r[r.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",r[r.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",r[r.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",r[r.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",r})({}),gt=(function(r){return r.CONNECTING="connecting",r.CONNECTED="connected",r.RECONNECTING="reconnecting",r.CLOSED="closed",r})({}),Pt=(function(r){return r.WS_CONNECTED="ws_connected",r.WS_RECONNECTING="ws_reconnecting",r.WS_CLOSED="ws_closed",r.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",r.ON_BINARY_DATA="on_binary_data",r.REQUEST_RECOVER="request_recover",r.REQUEST_JOIN_INFO="request_join_info",r.REQUEST_REJOIN_INFO="req_rejoin_info",r.IS_P2P_DISCONNECTED="is_p2p_dis",r.DISCONNECT_P2P="dis_p2p",r.ABORT_P2P_EXECUTION="abort_p2p_execution",r.NEED_RENEW_SESSION="need-sid",r.REPORT_JOIN_GATEWAY="report_join_gateway",r.REQUEST_TIMEOUT="request_timeout",r.REQUEST_SUCCESS="request_success",r.JOIN_RESPONSE="join_response",r.PRE_CONNECT_PC="pre_connect_pc",r.P2P_CONNECTION="p2p_connection",r.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",r.P2P_SUBSCRIBE="p2p_subscribe",r.P2P_UNSUBSCRIBE="p2p_unsubscribe",r.P2P_EXCHANGE_SDP="p2p_exchange_sdp",r.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",r.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",r.RECOVER_NOTIFICATION="recover_notification",r})({}),st=(function(r){return r.PING="ping",r.PING_BACK="ping_back",r.JOIN="join_v3",r.REJOIN="rejoin_v3",r.LEAVE="leave",r.SET_CLIENT_ROLE="set_client_role",r.PUBLISH="publish",r.PUBLISH_DATASTREAM="publish_datastream",r.UNPUBLISH="unpublish",r.UNPUBLISH_DATASTREAM="unpublish_datastream",r.SUBSCRIBE="subscribe",r.PRE_SUBSCRIBE="pre_subscribe",r.SUBSCRIBE_DATASTREAM="subscribe_datastream",r.SUBSCRIBE_STREAMS="subscribe_streams",r.UNSUBSCRIBE="unsubscribe",r.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",r.UNSUBSCRIBE_STREAMS="unsubscribe_streams",r.SUBSCRIBE_CHANGE="subscribe_change",r.TRAFFIC_STATS="traffic_stats",r.RENEW_TOKEN="renew_token",r.SWITCH_VIDEO_STREAM="switch_video_stream",r.DEFAULT_VIDEO_STREAM="default_video_stream",r.SET_FALLBACK_OPTION="set_fallback_option",r.GATEWAY_INFO="gateway_info",r.CONTROL="control",r.SEND_METADATA="send_metadata",r.DATA_STREAM="data_stream",r.PICK_SVC_LAYER="pick_svc_layer",r.RESTART_ICE="restart_ice",r.CONNECT_PC="connect_pc",r.SET_VIDEO_PROFILE="set_video_profile",r.SET_PARAMETER="set_parameter",r.SET_RTM2_FLAG="set_rtm2_flag",r.DOWNGRADE_CODEC="downgrade_codec",r})({}),Yt=(function(r){return r.WRTC_STATS="wrtc_stats",r.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",r.DENOISER_STATS="denoiser_stats",r.EXTENSION_USAGE_STATS="extension_usage_stats",r})({}),Ln=(function(r){return r.ON_USER_ONLINE="on_user_online",r.ON_USER_OFFLINE="on_user_offline",r.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",r.ON_PUBLISH_STREAM="on_publish_stream",r.ON_UPLINK_STATS="on_uplink_stats",r.ON_P2P_LOST="on_p2p_lost",r.ON_REMOVE_STREAM="on_remove_stream",r.ON_ADD_AUDIO_STREAM="on_add_audio_stream",r.ON_ADD_VIDEO_STREAM="on_add_video_stream",r.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",r.ON_USER_BANNED="on_user_banned",r.ON_USER_LICENSE_BANNED="on_user_license_banned",r.ON_NOTIFICATION="on_notification",r.ON_CRYPT_ERROR="on_crypt_error",r.MUTE_AUDIO="mute_audio",r.MUTE_VIDEO="mute_video",r.UNMUTE_AUDIO="unmute_audio",r.UNMUTE_VIDEO="unmute_video",r.ON_P2P_OK="on_p2p_ok",r.RECEIVE_METADATA="receive_metadata",r.ON_DATA_STREAM="on_data_stream",r.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",r.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",r.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",r.ENABLE_LOCAL_VIDEO="enable_local_video",r.DISABLE_LOCAL_VIDEO="disable_local_video",r.ENABLE_LOCAL_AUDIO="enable_local_audio",r.DISABLE_LOCAL_AUDIO="disable_local_audio",r.ON_PUBLISHED_USER_LIST="on_published_user_list",r})({}),an=(function(r){return r.SEND_ONLY="SEND_ONLY",r.RECEIVE_ONLY="RECEIVE_ONLY",r})({}),Wt=(function(r){return r.CONNECTED="websocket:connected",r.RECONNECTING="websocket:reconnecting",r.WILL_RECONNECT="websocket:will_reconnect",r.CLOSED="websocket:closed",r.FAILED="websocket:failed",r.ON_MESSAGE="websocket:on_message",r.REQUEST_NEW_URLS="websocket:request_new_urls",r.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",r})({});function cn(r){if(typeof r!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(r))throw V.error("Invalid Channel Name ".concat(r)),new fe(z.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function wv(r){if(e=r,!(typeof e=="number"&&Math.floor(e)===e&&0<=e&&e<=4294967295||Gr(r,1,255)))throw new fe(z.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var e;typeof r=="string"&&V.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Ch=(function(r){return r.TRANSCODE="mix_streaming",r.RAW="raw_streaming",r})({}),Wm={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},qV={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function zw(r,e){Eo(r.url,"".concat(e,".url"),1,1e3,!1),Hi(r.x)||Tn(r.x,"".concat(e,".x"),0,1e4),Hi(r.y)||Tn(r.y,"".concat(e,".y"),0,1e4),Hi(r.width)||Tn(r.width,"".concat(e,".width"),0,1e4),Hi(r.height)||Tn(r.height,"".concat(e,".height"),0,1e4),Hi(r.zOrder)||Tn(r.zOrder,"".concat(e,".zOrder"),0,255),Hi(r.alpha)||Tn(r.alpha,"".concat(e,".alpha"),0,1,!1)}let XV={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},qg=(function(r){return r.WARNING="@live_uap-warning",r.ERROR="@line_uap-error",r.PUBLISH_STREAM_STATUS="@live_uap-publish-status",r.WORKER_STATUS="@live_uap-worker-status",r.REQUEST_NEW_ADDRESS="@live_uap-request-address",r})({}),S_=(function(r){return r.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",r})({}),Is=(function(r){return r[r.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",r[r.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",r[r.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",r[r.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",r[r.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",r[r.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",r[r.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",r[r.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",r[r.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",r[r.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",r[r.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",r[r.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",r[r.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",r[r.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",r[r.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",r[r.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",r[r.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",r[r.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",r[r.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",r[r.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",r[r.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",r})({});function Gs(r){if(!r.channelName)throw new fe(z.INVALID_PARAMS,"invalid channelName in info");if(typeof r.uid!="number")throw new fe(z.INVALID_PARAMS,"invalid uid in info, uid must be a number");return r.token&&Eo(r.token,"info.token",1,2047),wv(r.uid),cn(r.channelName),!0}let ac=(function(r){return r[r.SetSdkProfile=0]="SetSdkProfile",r[r.SetSourceChannel=1]="SetSourceChannel",r[r.SetSourceUserId=2]="SetSourceUserId",r[r.SetDestChannel=3]="SetDestChannel",r[r.StartPacketTransfer=4]="StartPacketTransfer",r[r.StopPacketTransfer=5]="StopPacketTransfer",r[r.UpdateDestChannel=6]="UpdateDestChannel",r[r.Reconnect=7]="Reconnect",r[r.SetVideoProfile=8]="SetVideoProfile",r})({}),oo=(function(r){return r.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",r.NETWORK_CONNECTED="NETWORK_CONNECTED",r.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",r.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",r.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",r.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",r.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",r.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",r.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",r.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",r})({}),ko=(function(r){return r.RELAY_STATE_IDLE="RELAY_STATE_IDLE",r.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",r.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",r.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",r})({}),wa=(function(r){return r.RELAY_OK="RELAY_OK",r.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",r.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",r.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",r})({}),vi=(function(r){return r.High="high",r.Low="low",r.Audio="audio",r.Screen="screen",r.ScreenLow="screen_low",r})({}),gn=(function(r){return r.DISCONNECT="disconnect",r.CONNECTION_STATE_CHANGE="connection-state-change",r.NETWORK_QUALITY="network-quality",r.STREAM_TYPE_CHANGE="stream-type-change",r.IS_P2P_DISCONNECTED="is-p2p-dis",r.DISCONNECT_P2P="dis-p2p",r.REQUEST_NEW_GATEWAY_LIST="req-gate-url",r.NEED_RENEW_SESSION="need-sid",r.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",r.JOIN_RESPONSE="join-response",r.RESET_CONNECTION_EVENTS="reset-connection-events",r.PRE_CONNECT_PC="pre-connect_pc",r.UPDATE_GATEWAY_CONFIG="update-gateway-config",r})({}),Qs=(function(r){return r.P2P_DISCONNECTED="P2P_DISCONNECTED",r.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",r.TIMEOUT="TIMEOUT",r.UNKNOWN_REASON="UNKNOWN_REASON",r})({}),Ws=(function(r){return r[r.Nothing=0]="Nothing",r[r.Audio=1]="Audio",r[r.LwoVideo=2]="LwoVideo",r[r.Video=4]="Video",r[r.Data=8]="Data",r[r.DataStream0=256]="DataStream0",r[r.DataStream1=512]="DataStream1",r[r.DataStream2=1024]="DataStream2",r[r.DataStream3=2048]="DataStream3",r[r.DataStream4=4096]="DataStream4",r[r.DataStream5=8192]="DataStream5",r[r.DataStream6=16384]="DataStream6",r[r.DataStream7=32768]="DataStream7",r})({}),dn=(function(r){return r.CHINA="CHINA",r.ASIA="ASIA",r.NORTH_AMERICA="NORTH_AMERICA",r.EUROPE="EUROPE",r.JAPAN="JAPAN",r.INDIA="INDIA",r.KOREA="KOREA",r.HKMC="HKMC",r.US="US",r.OCEANIA="OCEANIA",r.SOUTH_AMERICA="SOUTH_AMERICA",r.AFRICA="AFRICA",r.OVERSEA="OVERSEA",r.GLOBAL="GLOBAL",r.EXTENSIONS="EXTENSIONS",r})({}),Ri=[dn.AFRICA,dn.ASIA,dn.CHINA,dn.EUROPE,dn.GLOBAL,dn.INDIA,dn.JAPAN,dn.NORTH_AMERICA,dn.OCEANIA,dn.OVERSEA,dn.SOUTH_AMERICA],pa=(function(r){return r.CHINA="CN",r.ASIA="AS",r.NORTH_AMERICA="NA",r.EUROPE="EU",r.JAPAN="JP",r.INDIA="IN",r.KOREA="KR",r.HKMC="HK",r.US="US",r.OCEANIA="OC",r.SOUTH_AMERICA="SA",r.AFRICA="AF",r.OVERSEA="OVERSEA",r.GLOBAL="GLOBAL",r.EXTENSIONS="GLOBAL",r})({}),Lo={CHINA:{},ASIA:{CODE:pa.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:pa.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:pa.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:pa.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:pa.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:pa.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:pa.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:pa.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:pa.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:pa.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:pa.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:pa.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:pa.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};ql&&(Lo.CHINA={CODE:pa.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let Xg=(function(r){return r.UPDATE_BITRATE_LIMIT="update_bitrate_limit",r.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",r})({});function kC(r){return!!r&&!(!r.uplink||!r.id)&&r.uplink.max_bitrate!==void 0&&r.uplink.min_bitrate!==void 0}class JV extends Sr{constructor(e,t){super(),Z(this,"onICEConnectionStateChange",void 0),Z(this,"onConnectionStateChange",void 0),Z(this,"onDTLSTransportStateChange",void 0),Z(this,"onDTLSTransportError",void 0),Z(this,"onICETransportStateChange",void 0),Z(this,"onFirstAudioReceived",void 0),Z(this,"onFirstVideoReceived",void 0),Z(this,"onFirstAudioDecoded",void 0),Z(this,"onFirstVideoDecoded",void 0),Z(this,"onFirstVideoRender",void 0),Z(this,"onFirstVideoDecodedTimeout",void 0),Z(this,"onSelectedLocalCandidateChanged",void 0),Z(this,"onSelectedRemoteCandidateChanged",void 0),Z(this,"onICECandidateError",void 0),Z(this,"getLocalVideoStats",void 0)}}class QV extends JV{constructor(e,t){super(e,t),Z(this,"establishPromise",void 0)}}let vt=(function(r){return r.VIDEO="video",r.AUDIO="audio",r})({}),dt=(function(r){return r.UDP_RELAY="udp_relay",r.UDP_TCP_RELAY="udp_tcp_relay",r.TCP_RELAY="tcp_relay",r.RELAY="relay",r})({}),As=(function(r){return r[r.FIRST_CONNECTION=0]="FIRST_CONNECTION",r[r.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",r[r.RELAY_RESTART=2]="RELAY_RESTART",r[r.TCP_RESTART=3]="TCP_RESTART",r[r.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",r[r.OLD_RESTART=11]="OLD_RESTART",r[r.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",r})({}),T_=["disconnected","failed"],$e=(function(r){return r.LocalVideoTrack="videoTrack",r.LocalAudioTrack="audioTrack",r.LocalVideoLowTrack="videoLowTrack",r})({}),He=(function(r){return r.New="new",r.Connected="connected",r.Reconnecting="reconnecting",r.Disconnected="disconnected",r})({}),ut=(function(r){return r.AudioMetadata="audioMetadata",r.AudioPts="audioPts",r.StateChange="stateChange",r.IceConnectionStateChange="iceConnectionStateChange",r.RequestMuteLocal="requestMuteLocal",r.RequestUnmuteLocal="requestUnmuteLocal",r.RequestRePublish="requestRePublish",r.RequestRePublishDataChannel="requestRePublishDataChannel",r.RequestReSubscribe="requestReSubscribe",r.RequestUploadStats="requestUploadStats",r.RequestUpload="requestUpload",r.MediaReconnectStart="MediaReconnectStart",r.MediaReconnectEnd="MediaReconnectEnd",r.NeedSignalRTT="NeedSignalRTT",r.RequestRestartICE="RequestRestartIce",r.PeerConnectionStateChange="PeerConnectionStateChange",r.RequestReconnect="RequestReconnect",r.RequestReconnectPC="RequestReconnectPC",r.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",r.P2PLost="P2PLost",r.UpdateVideoEncoder="UpdateVideoEncoder",r.ConnectionTypeChange="ConnectionTypeChange",r.RequestLowStreamParameter="RequestLowStreamParameter",r.QueryClientConnectionState="QueryClientConnectionState",r.LocalCandidate="LocalCandidate",r.RequestP2PMuteLocal="requestP2PMuteLocal",r.RequestP2PUnPublish="RequestP2PUnPublish",r.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",r.RequestP2PMuteRemote="RequestP2PMuteRemote",r.RequestP2PRestartICE="RequestP2PRestartICE",r})({}),kt=(function(r){return r.CONNECTING="CONNECTING",r.RECONNECTING="RECONNECTING",r.CONNECTED="CONNECTED",r.CLOSED="CLOSED",r})({}),$o=(function(r){return r[r.CONNECT_AP=0]="CONNECT_AP",r[r.AP_CONNECTED=1]="AP_CONNECTED",r[r.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",r[r.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",r[r.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",r[r.CONNECT_WORKER=5]="CONNECT_WORKER",r[r.WORKER_CONNECTED=6]="WORKER_CONNECTED",r[r.CLOSED=7]="CLOSED",r})({}),kr=(function(r){return r.CONNECTION_STATE_CHANGE="connection-state-change",r.STATE_CHANGE="state-change",r.INSPECT_RESULT="inspect-result",r.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",r.REQUEST_NEW_WORKER_URL="request-new-worker-url",r})({}),So=(function(r){return r.CONNECTED="transmitter:connected",r.RECONNECTING="transmitter:reconnecting",r.WILL_RECONNECT="transmitter:will_reconnect",r.CLOSED="transmitter:closed",r.FAILED="transmitter:failed",r.ON_MESSAGE="transmitter:on_message",r.REQUEST_NEW_URLS="transmitter:request_new_urls",r.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",r.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",r.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",r.FAILBACK="transmitter:failback",r.PRE_CONNECT_PC="transmitter:pre_connect_pc",r})({}),rf=(function(r){return r.CAMERA_CHANGED="camera-changed",r.MICROPHONE_CHANGED="microphone-changed",r.PLAYBACK_DEVICE_CHANGED="playback-device-changed",r.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",r.AUTOPLAY_FAILED="autoplay-failed",r.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",r.SECURITY_POLICY_VIOLATION="security-policy-violation",r})({}),fa=(function(r){return r.CONNECTING="CONNECTING",r.RECONNECTING="RECONNECTING",r.CONNECTED="CONNECTED",r.CLOSED="CLOSED",r})({}),ea=(function(r){return r.CONNECTION_STATE_CHANGE="connection-state-change",r.STATE_CHANGE="state-change",r.INSPECT_RESULT="inspect-result",r.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",r.REQUEST_NEW_WORKER_URL="request-new-worker-url",r})({}),gl=(function(r){return r[r.CONNECT_AP=0]="CONNECT_AP",r[r.AP_CONNECTED=1]="AP_CONNECTED",r[r.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",r[r.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",r[r.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",r[r.CONNECT_WORKER=5]="CONNECT_WORKER",r[r.WORKER_CONNECTED=6]="WORKER_CONNECTED",r[r.CLOSED=7]="CLOSED",r})({}),Lr=(function(r){return r.CALL="call",r.CANDIDATE="candidate",r.PUBLISH="publish",r.UNPUBLISH="unpublish",r.CONTROL="control",r.RESTART_ICE="restart_ice",r.ACK="ack",r.RESPONSE="response",r.JOIN="join",r.CHECK="check",r})({}),Mr=(function(r){return r.ABORT="abort",r})({}),Ru=(function(r){return r.MUTE_LOCAL_AUDIO="mute_local_audio",r.MUTE_LOCAL_VIDEO="mute_local_video",r.UNMUTE_LOCAL_AUDIO="unmute_local_audio",r.UNMUTE_LOCAL_VIDEO="unmute_local_video",r})({}),Jg=(function(r){return r.P2P_TOKEN_TIMEOUT="p2p_token_timeout",r.P2P_TOKEN_CHANGED="p2p_token_changed",r})({}),Kz={[At.ACCESS_POINT]:{[bs.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[bs.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[bs.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[bs.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[bs.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[bs.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[bs.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[bs.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[bs.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[bs.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[bs.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[bs.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[bs.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[bs.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[bs.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[bs.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[bs.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[bs.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[At.UNILBS]:{[Ud.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Ud.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Ud.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Ud.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Ud.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Ud.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Ud.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Ud.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Ud.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Ud.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Ud.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Ud.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[At.STRING_UID_ALLOCATOR]:{[PC.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[PC.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[PC.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function LC(r){let e=Kz[Math.floor(r/1e4)];if(!e)return{desc:"unknown error",retry:!1};let t=e[r%1e4];if(!t){if(Math.floor(r/1e4)===At.ACCESS_POINT){let n=r%1e4;if(n.toString()[0]==="1")return{desc:r.toString(),retry:!1};if(n.toString()[0]==="2")return{desc:r.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return t}let MC={[Mt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Mt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Mt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Mt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Mt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Mt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Mt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Mt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Mt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Mt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Mt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Mt.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[Mt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[Mt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Mt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Mt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Mt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Mt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Mt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Mt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Mt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Mt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Mt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Mt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Mt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Mt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Mt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Mt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Mt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Mt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Mt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Mt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Mt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Mt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Mt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Mt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Mt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Mt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Mt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Mt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Mt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Mt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Mt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Mt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Mt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Mt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Mt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Mt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Mt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Mt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Mt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Mt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Mt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Mt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Mt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Mt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Mt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Mt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Mt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Mt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Mt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Mt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Mt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Mt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Yw(r){return MC[r]||{desc:"UNKNOWN_ERROR_".concat(r),action:"failed"}}function UC(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function aP(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?UC(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):UC(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function qw(r,e){if(typeof r=="string")return r;let{proxy:t,host:n,port:i}=r;if(e){let s=te("JOIN_GATEWAY_FALLBACK_PORT")||443;return s===443?"wss://".concat(n,"/ws/?p=").concat(Number(i)+150):"wss://".concat(n,":").concat(s,"/ws/?p=").concat(Number(i)+150)}return t?"wss://".concat(t,"/ws/?h=").concat(n,"&p=").concat(i):"wss://".concat(n,":").concat(i)}let ZV=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,zz=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,Yz=/wss:\/\/(.+):([0-9]+)\/?/,qz=/wss:\/\/(.[^\/]+)\/?/,Xz=0;class Jz{constructor(e,t){Z(this,"id",0),Z(this,"store",void 0),Z(this,"recordIndex",void 0),Z(this,"websockets",[]),Z(this,"try443PortDuration",2e3),Z(this,"forceCloseWSDuration",5e3),Z(this,"try443PortTimeout",null),Z(this,"forceCloseTimeout",null),Z(this,"isTry443PortFailed",!1),Z(this,"isNormalPortFailed",!1),Z(this,"useDoubleDomain",!1),Z(this,"useProxy",!1),Z(this,"startTime",Date.now()),this.id=++Xz,this.try443PortDuration=te("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=t}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var e;let t=Date.now()-this.startTime;for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];V.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(t,"ms:"),...i)}createWebSocket(e,t,n){this.logger("createWebSocket:",e,{isTry443Port:t,hasTimeoutDetection:n});let i=te("GATEWAY_DOMAINS"),s=Date.now(),o=[],c=i.find(g=>{var T;return Re(T=e.host).call(T,g)});c||(this.useDoubleDomain=!1);let d=[];if(this.useDoubleDomain)i.forEach(g=>{d.push(qw(aP(aP({},e),{},{host:e.host.replace(c,g)}),t))});else{let g=aP({},e);if(t&&c){let T=i.find(R=>R!==c);T&&(g.host=g.host.replace(c,T))}d.push(qw(g,t))}try{d.forEach(g=>{let T=new WebSocket(g);T.binaryType="arraybuffer",o.push(T),this.logger("ws is connecting:",T.url)})}catch(g){if(this.logger("ws create failed"),o.forEach(T=>T.close()),o.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,t,n);if(!t&&Number(e.port)!==443)return this.createWebSocket(e,!0,n);throw new fe(z.WS_ERR,"init websocket failed! Error: ".concat(g.toString()))}let u=Ew();this.store&&this.store.recordJoinChannelService({urls:o.map(g=>g.url),service:"gateway"},this.recordIndex),o.forEach(g=>{g.onopen=()=>{this.logger("onopen: ws ".concat(g.url," open cost ").concat(Date.now()-s,"ms")),this.websockets.forEach(T=>{T!==g&&(T.onopen=null,T.onclose=null,T.onmessage=null,T.close(),this.logger("close backup websocket: ".concat(T.url)))}),this.websockets.length=0,u.resolve(g)},g.onclose=T=>{this.logger("onclose: ws ".concat(g.url," closed cost ").concat(Date.now()-s,"ms state: ").concat(g.readyState));let R=o.every(I=>I.readyState===WebSocket.CLOSED||I.readyState===WebSocket.CLOSING);this.logger("".concat(t?"443":"47xx"," websocket closed, all failed: ").concat(R)),R&&(t||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(T.reason)),u.reject({code:T.code,reason:Qs.A_ROUND_WS_FAILED})):!t&&R&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),m()),t?this.isTry443PortFailed=R:this.isNormalPortFailed=R},g.onmessage=T=>this.logger("".concat(g.url," onmessage: ").concat(T.data))}),this.websockets.push(...o);let p=()=>{this.websockets.forEach(g=>g.readyState!==WebSocket.OPEN&&g.close())},m=()=>{if(u.isResolved)return p();Qn().os===Br.MAC_OS&&jr()&&p(),this.createWebSocket(e,!0,!0).then(g=>{u.resolve(g)}).catch(g=>{this.isNormalPortFailed&&u.reject(g),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",u.isResolved),this.forceCloseTimeout=null,p()},this.forceCloseWSDuration)};return n||(()=>{if(t||this.useProxy)return this.logger("add 5s timeout at ".concat(t?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,p()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",u.isResolved),this.try443PortTimeout=null,m()},this.try443PortDuration)})(),u.promise}chooseBestWebsocket(e,t,n,i){return this.useDoubleDomain=!!t,typeof e=="string"&&(e=(function(s){let o,c,d;return[,o,c,d]=s.match(ZV)||[],o||([,c,d]=s.match(zz)||[]),c&&d||([,c,d]=s.match(Yz)||[]),c&&d||([,c]=s.match(qz)||[]),c||V.warning("un-destructible url: ",s),{proxy:o,host:c,port:d||"443"}})(e)),this.recordIndex=i,this.useProxy=!!e.proxy,n&&this.useProxy&&(V.warn("cannot use 443 only when use proxy"),n=!1),this.createWebSocket(e,!!n,!1).finally(()=>this.clearTimeout())}}function L4(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}class $V extends Sr{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var t;Re(t=["tryNext","recover"]).call(t,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(Wt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Wt.CONNECTED):this._state==="closed"?this.emit(Wt.CLOSED):this._state==="failed"&&this.emit(Wt.FAILED))}resetReconnectCount(e){V.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3],s=arguments.length>4&&arguments[4]!==void 0&&arguments[4],o=arguments.length>5?arguments[5]:void 0;super(),Z(this,"_websocketUrl",null),Z(this,"connectionID",0),Z(this,"currentURLIndex",0),Z(this,"urls",[]),Z(this,"_reconnectMode","tryNext"),Z(this,"reconnectReason",void 0),Z(this,"_initMutex",void 0),Z(this,"name",void 0),Z(this,"_state","closed"),Z(this,"reconnectInterrupter",void 0),Z(this,"websocket",void 0),Z(this,"retryConfig",void 0),Z(this,"reconnectCount",0),Z(this,"forceCloseTimeout",5e3),Z(this,"onlineReconnectListener",void 0),Z(this,"useCompress",void 0),Z(this,"tryDoubleDomain",!1),Z(this,"use443PortOnly",!1),Z(this,"wsInflateLength",0),Z(this,"wsDeflateLength",0),Z(this,"closeEstablishingWs",()=>{}),Z(this,"store",void 0),Z(this,"joinGatewayRecordIndex",void 0),this.store=o,this.name=e,this.retryConfig=(function(m){for(var g=1;g<arguments.length;g++){var T=arguments[g]!=null?arguments[g]:{};g%2?L4(Object(T),!0).forEach(function(R){Z(m,R,T[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(m,Object.getOwnPropertyDescriptors(T)):L4(Object(T)).forEach(function(R){Object.defineProperty(m,R,Object.getOwnPropertyDescriptor(T,R))})}return m})({},t),this.useCompress=n,this.tryDoubleDomain=i,this.use443PortOnly=s,this._initMutex=new ha("websocket",o?o.clientId:void 0);let{timeout:c,timeoutFactor:d}=t,u=Math.max(300,Math.floor(3*c/5)),p=Math.max(1.2,Math.floor(8*d)/10);vr.ONLINE&&(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=p),Kr.on(ja.NETWORK_STATE_CHANGE,(m,g)=>{m!==g&&(this.resetReconnectCount("network state change: ".concat(g," -> ").concat(m)),m===vr.ONLINE?(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=p):(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=d))})}getConnection(){return this.websocket||void 0}async init(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,n=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=t,this.urls=e,this.state="connecting";try{var i;let s=Ew(),o=this.urls[this.currentURLIndex];(i=this.store)===null||i===void 0||i.beforeConnect(),(function(c){return!(Dw()||te("USE_NEW_TOKEN")||!te("ENABLE_PREALLOC_PC")&&(c==null||!c.autoSubscribe||te("FORCE_DISABLE_AUTO_SUB")))})(this.store)&&this.emit(So.PRE_CONNECT_PC),this.createWebSocketConnection(o).then(s.resolve).catch(s.reject),this.once(Wt.CLOSED,()=>{s.reject(new H(z.WS_DISCONNECT))}),this.once(Wt.CONNECTED,s.resolve),await s.promise}catch{}finally{n()}}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let n=this.websocket;t?setTimeout(()=>n.close(),500):n.close(),this.websocket=void 0,this._websocketUrl=null}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,t){if(!this.websocket)return void V.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),V.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinGatewayRecordIndex);let n=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),n&&n.bind(this.websocket)({code:9999,reason:t})}sendMessage(e){let t=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new H(z.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(n){throw new H(z.WS_ERR,"send websocket message error"+n.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){let e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var t;let n=Ew();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let i=p=>{var m;(m=this.store)===null||m===void 0||m.signalChannelOpen(),V.debug("[".concat(this.name,"] websocket opened:"),p),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n.resolve()},s=async p=>{var m;if(V.debug("[".concat(this.name,"] websocket close ").concat((m=this.websocket)===null||m===void 0?void 0:m.url,", code: ").concat(p.code,", reason: ").concat(p.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)n.reject(new H(z.WS_DISCONNECT,"websocket close: ".concat(p.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=p.reason,this.state="reconnecting");let g=ei(this,Wt.WILL_RECONNECT,this.reconnectMode,p.reason)||this.reconnectMode,T=await this.reconnectWithAction(g);if(this.state==="closed")return void V.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!T)return n.reject(new H(z.WS_DISCONNECT,"websocket reconnect failed: ".concat(p.code))),this.close(!0);n.resolve()}},o=p=>{this.emit(Wt.ON_MESSAGE,p)},c=p=>{V.warn("[".concat(this.connectionID,"] ws open error ").concat(p))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),te("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=te("GATEWAY_WSS_ADDRESS")),V.debug("[".concat(this.name,"] start connect, url:"),e);let d=(t=this.store)===null||t===void 0?void 0:t.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var u;this._websocketUrl=qw(e);let p=await this.chooseBestWebsocketConnection(e);this.websocket=p,i&&i(this.websocket.url),this.websocket.onclose=s,this.websocket.onmessage=o,this.websocket.onerror=c,(u=this.store)===null||u===void 0||u.recordJoinChannelService({endTs:Date.now(),status:"success"},d),this.joinGatewayRecordIndex=d}catch(p){let m=this.state==="closed",g=p instanceof H,T=g&&p.code===z.WS_ABORT,R=g&&p.code===z.WS_ERR,I=g?p.message:p&&(p.reason||p.toString());V.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(I)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:T?"aborted":"error",errors:[p]},d),m||R?(n.reject(m?new H(z.WS_DISCONNECT,"websocket is closed: ".concat(I)):new H(z.WS_ERR,"init websocket failed: ".concat(I))),R&&V.error("[".concat(this.name,"] init websocket failed: ").concat(I))):s&&s(p)}return n.promise}async reconnectWithAction(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;V.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||Kr.isOnline||!Kr.onlineWaiter||(this.onlineReconnectListener=Kr.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let n=!0;if(this.reconnectInterrupter=()=>n=!1,t){let o=Es(this.reconnectCount,this.retryConfig);V.debug("[".concat(this.name,"] wait ").concat(o,"ms to reconnect websocket, mode: ").concat(e)),await De.race([Jo(o),this.onlineReconnectListener||new De(()=>{})])}if(this._state==="closed"||!n)return!1;this.reconnectCount+=1;let i=async(o,c)=>{this.emit(Wt.RECONNECT_CREATE_CONNECTION,c),await this.createWebSocketConnection(o)};try{if(e==="retry")await i(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);V.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await i(this.urls[this.currentURLIndex],e)}else e==="recover"&&(V.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await Ys(this,Wt.REQUEST_NEW_URLS),this.currentURLIndex=0,await i(this.urls[this.currentURLIndex],e))}catch(o){var s;V.error("[".concat(this.name,"] reconnect failed ").concat(o&&o.toString()));let c=o==null||(s=o.data)===null||s===void 0?void 0:s.desc;return Array.isArray(c)&&Re(c).call(c,"dynamic key expired")?(this.emit(Wt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,t)}return!0}}class cP extends $V{constructor(e,t){super(e,t,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){let n=Ew(),i=(function(o,c){return new Jz(o,c)})(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{V.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),n.reject(new H(z.WS_ABORT,"choose best websocket aborted"))};let s=te("GATEWAY_DOMAINS");return V.debug("[choose-best-ws] currentDomain: ",e,", domains: ",s,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,t).then(n.resolve).catch(n.reject),n.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Ov extends $V{constructor(e,t){super(e,t,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,t){return new De((n,i)=>{let s=!1,o=[];this.closeEstablishingWs=()=>{V.debug("[choose-best-ws] close establishing websockets"),o.forEach(R=>{R.onclose=null,R.onopen=null,R.onmessage=null,R.close()}),i(new H(z.WS_ABORT,"choose best websocket aborted"))};let c=te("GATEWAY_DOMAINS"),d,u=e.indexOf("?h="),p=c.find(R=>u!==-1?Re(e).call(e,R,u):Re(e).call(e,R));V.debug("[choose-best-ws] currentDomain: ",p,", domains: ",c);let m=!this.tryDoubleDomain||!p;if(!m&&p){var g;let R=Date.now();try{c.forEach(I=>{let A=u===-1?e.replace(p,I):e.substr(0,u)+e.substr(u).replace(p,I),w=new WebSocket(A);w.binaryType="arraybuffer",o.push(w),V.debug("[choose-best-ws] ws is connecting:",w.url)})}catch{for(V.debug("[choose-best-ws] ws create failed, fallback to single url"),o.forEach(I=>I.close());o.length;)o.pop();m=!0}(g=this.store)===null||g===void 0||g.recordJoinChannelService({urls:o.map(I=>I.url),service:"gateway"},t),o.forEach(I=>{I.onopen=()=>{if(s)return;let A=Date.now()-R;V.debug("[choose-best-ws] ws open cost ".concat(A,"ms")),o.filter(w=>w!==I).forEach(w=>{V.debug("[choose-best-ws]close backup websocket: ".concat(w.url)),w.close()}),s=!0,n(I)},I.onclose=A=>{d=A,!s&&(o.find(w=>!(w.readyState===WebSocket.CLOSED||w.readyState===WebSocket.CLOSING))||(V.debug("[choose-best-ws] all websocket is closed"),s=!0,i(d)))},I.onmessage=A=>{V.debug("[choose-best-ws]".concat(I.url," onmessage: ").concat(A.data))}}),Jo(this.forceCloseTimeout).then(()=>{o.forEach(I=>{I.readyState!==WebSocket.OPEN&&I.close()})})}if(m){var T;let R;V.debug("[choose-best-ws] use single url: ",e),(T=this.store)===null||T===void 0||T.recordJoinChannelService({urls:[e],service:"gateway"},t);try{R=new WebSocket(e),o.push(R),R.binaryType="arraybuffer"}catch(I){let A=new H(z.WS_ERR,"init websocket failed! Error: ".concat(I.toString()));return V.error("[".concat(this.name,"]").concat(A)),void i(A)}R.onopen=()=>{n(R)},R.onclose=I=>{i(I)},R.onmessage=I=>{V.debug("[choose-best-ws]".concat(R.url," onmessage: ").concat(I.data))},Jo(this.forceCloseTimeout).then(()=>{R&&R.readyState!==WebSocket.OPEN&&R.close()})}}).then(n=>(this.closeEstablishingWs=void 0,n)).catch(n=>{throw this.closeEstablishingWs=void 0,n})}}class Xw extends Sr{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===gt.CONNECTED?this.emit(Pt.WS_CONNECTED):e===gt.RECONNECTING?this.emit(Pt.WS_RECONNECTING,this._websocketReconnectReason):e===gt.CLOSED&&this.emit(Pt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),Z(this,"_disconnectedReason",void 0),Z(this,"_websocketReconnectReason",void 0),Z(this,"_connectionState",gt.CLOSED),Z(this,"reconnectToken",void 0),Z(this,"websocket",void 0),Z(this,"openConnectionTime",void 0),Z(this,"clientId",void 0),Z(this,"lastMsgTime",Date.now()),Z(this,"uploadCache",[]),Z(this,"uploadCacheInterval",void 0),Z(this,"rttRolling",new bw(5)),Z(this,"pingpongTimer",void 0),Z(this,"wsInflateDataTimer",void 0),Z(this,"pingpongTimeoutCount",0),Z(this,"ortc",void 0),Z(this,"joinResponse",void 0),Z(this,"multiIpOption",void 0),Z(this,"initError",void 0),Z(this,"spec",void 0),Z(this,"store",void 0),Z(this,"onWebsocketMessage",n=>{if(n.data instanceof ArrayBuffer)return void this.emit(Pt.ON_BINARY_DATA,n.data);let i=JSON.parse(n.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){let s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){if(this.emit(i._type,i._message),i._type===Ln.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Ln.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Di.UID_BANNED);break;case 15:this.close(Di.IP_BANNED);break;case 16:this.close(Di.CHANNEL_BANNED)}if(i._type===Ln.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case Mt.ERR_LICENSE_MISSING:this.close(Di.LICENSE_MISSING);break;case Mt.ERR_LICENSE_EXPIRED:this.close(Di.LICENSE_EXPIRED);break;case Mt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Di.LICENSE_MINUTES_EXCEEDED);break;case Mt.ERR_LICENSE_PERIOD_INVALID:this.close(Di.LICENSE_PERIOD_INVALID);break;case Mt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Di.LICENSE_MULTIPLE_SDK_SERVICE);break;case Mt.ERR_LICENSE_ILLEGAL:this.close(Di.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new cP("gateway-".concat(this.clientId),this.spec.retryConfig,!0,te("JOIN_GATEWAY_USE_DUAL_DOMAIN"),te("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===gt.CONNECTED&&this.reconnect("retry",$t.OFFLINE)})}async request(e,t,n,i){let s=In(6,""),o={_id:s,_type:e,_message:t},c=this.websocket.connectionID,d=()=>new De((R,I)=>{if(this.connectionState===gt.CONNECTED)return R();let A=()=>{this.off(Pt.WS_CLOSED,w),R()},w=()=>{this.off(Pt.WS_CONNECTED,A),I(new fe(z.WS_ABORT))};this.once(Pt.WS_CONNECTED,A),this.once(Pt.WS_CLOSED,w),e!==st.PUBLISH&&e!==st.PUBLISH_DATASTREAM&&e!==st.SUBSCRIBE&&e!==st.SUBSCRIBE_DATASTREAM&&e!==st.UNSUBSCRIBE&&e!==st.UNSUBSCRIBE_DATASTREAM&&e!==st.UNPUBLISH&&e!==st.UNPUBLISH_DATASTREAM&&e!==st.CONTROL&&e!==st.RESTART_ICE||this.once(Pt.DISCONNECT_P2P,()=>{I(new fe(z.DISCONNECT_P2P))}),e!==st.PUBLISH&&e!==st.RESTART_ICE||this.once(Pt.ABORT_P2P_EXECUTION,()=>{I(new fe(z.DISCONNECT_P2P))})});if(this.connectionState!==gt.CONNECTING&&this.connectionState!==gt.RECONNECTING||e===st.JOIN||e===st.REJOIN||await d(),this.websocket.sendMessage(o,!0),i)return;let u=new De((R,I)=>{let A=!1,w=(L,j)=>{A=!0,R({isSuccess:L==="success",message:j||{}}),this.off(Pt.WS_CLOSED,k),this.off(Pt.WS_RECONNECTING,k),this.emit(Pt.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(s),w);let k=()=>{I(new fe(z.WS_ABORT,"type: ".concat(e))),this.off(Pt.WS_CLOSED,k),this.off(Pt.WS_RECONNECTING,k),this.off("res-@".concat(s),w)};this.once(Pt.WS_CLOSED,k),this.once(Pt.WS_RECONNECTING,k),Jo(te("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==c||A||(V.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(Pt.REQUEST_TIMEOUT,e,t))})}),p=null;try{p=await u}catch(R){if(this.connectionState===gt.CLOSED||e===st.LEAVE)throw new fe(z.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?R.throw():e===st.JOIN||e===st.REJOIN?null:(await d(),await this.request(e,t))}if(p.isSuccess)return p.message;let m=Number(p.message.error_code||p.message.code),g=Yw(m),T=new fe(z.UNEXPECTED_RESPONSE,"".concat(g.desc,": ").concat(p.message.error_str),{code:m,data:p.message,desc:g.desc});return g.action==="success"?p.message:(V.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(m,", message: ").concat(g.desc,", action: ").concat(g.action)),m===Mt.ERR_TOO_MANY_BROADCASTERS?((e===st.JOIN||e===st.REJOIN)&&(this.initError=T,this.close()),T.throw()):g.action==="failed"?T.throw():g.action==="quit"?(this.initError=T,this.close(),T.throw()):(m===Mt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,V.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",$t.MULTI_IP)):this.reconnect(g.action,$t.SERVER_ERROR),e===st.JOIN||e===st.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new De(n=>{let i=s=>{(!t||t(s))&&(this.off(e,i),n(s))};this.on(e,i)})}uploadWRTCStats(e){if(!this.store.sessionId)return void V.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Yt.WRTC_STATS,t)}upload(e,t){let n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch{let i=te("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>i&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==gt.CONNECTED)return;let s=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(s._type,s._message)},te("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){let n={_type:e,_message:t};this.websocket.sendMessage(n)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new De((t,n)=>{this.once(Pt.WS_CONNECTED,()=>t(this.joinResponse)),this.once(Pt.WS_CLOSED,i=>n(this.initError||new fe(z.WS_ABORT,i))),this.connectionState=gt.CONNECTING,this.websocket.init(e).catch(n),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||Di.LEAVE,this.connectionState=gt.CLOSED,V.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Pt.ABORT_P2P_EXECUTION),this.store.signalConnected();let e=await Ys(this,Pt.REQUEST_JOIN_INFO);this.store.joinReq();let t=await this.request(st.JOIN,e);if(this.ortc=e?.ortc,this.store.joinRep(),!t)return this.emit(Pt.REPORT_JOIN_GATEWAY,Qs.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(Pt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=gt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new fe(z.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let e=Sc(this,Pt.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;let t=await this.request(st.REJOIN,e);return!!t&&(this.connectionState=gt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach(n=>{this.emit(Ln.ON_USER_ONLINE,{uid:n.uid}),n.audio&&this.emit(Ln.ON_ADD_AUDIO_STREAM,{uid:n.uid,uint_id:n.uint_id,audio:!0,ssrcId:n.audio_ssrc}),n.video&&this.emit(Ln.ON_ADD_VIDEO_STREAM,{uid:n.uid,uint_id:n.uint_id,video:!0,ssrcId:n.video_ssrc}),n.audio_mute?this.emit(Ln.MUTE_AUDIO,{uid:n.uid}):this.emit(Ln.UNMUTE_AUDIO,{uid:n.uid}),n.video_mute?this.emit(Ln.MUTE_VIDEO,{uid:n.uid}):this.emit(Ln.UNMUTE_VIDEO,{uid:n.uid}),n.audio_enable_local?this.emit(Ln.ENABLE_LOCAL_AUDIO,{uid:n.uid}):this.emit(Ln.DISABLE_LOCAL_AUDIO,{uid:n.uid}),n.video_enable_local?this.emit(Ln.ENABLE_LOCAL_VIDEO,{uid:n.uid}):this.emit(Ln.DISABLE_LOCAL_VIDEO,{uid:n.uid}),n.audio||n.video||this.emit(Ln.ON_REMOVE_STREAM,{uid:n.uid,uint_id:n.uint_id})}),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}async downgradeCodec(e){if(!this.ortc)return!1;let t={downgrade_codec:e,ortc:this.ortc};return!!await this.request(st.DOWNGRADE_CODEC,t)}handleNotification(e){V.debug("[".concat(this.clientId,"] receive notification: "),e);let t=Yw(e.code);if(e.code===28&&"detail"in e&&(V.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(Pt.RECOVER_NOTIFICATION,e.detail)),t.action!=="success"){if(t.action!=="failed")return t.action==="quit"?(t.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Di.UID_BANNED),void this.close()):void this.reconnect(t.action,$t.SERVER_ERROR);V.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let e=te("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(V.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>te("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",$t.TIMEOUT):this.request(st.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let n=Date.now()-t;this.rttRolling.add(n),te("REPORT_STATS")&&this.send(st.PING_BACK,{pingpongElapse:n})}).catch(n=>{})}handleWsInflateData(){let{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();e!==0&&t!==0&&this.upload(Yt.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(Wt.RECONNECT_CREATE_CONNECTION,e=>{this.emit(Pt.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Wt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Wt.CLOSED,()=>{this.connectionState=gt.CLOSED}),this.websocket.on(Wt.FAILED,()=>{this._disconnectedReason=Di.NETWORK_ERROR,this.connectionState=gt.CLOSED}),this.websocket.on(Wt.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===gt.CONNECTED?this.connectionState=gt.RECONNECTING:this.connectionState=gt.CONNECTING}),this.websocket.on(Wt.WILL_RECONNECT,(e,t,n)=>{let i=Sc(this,Pt.IS_P2P_DISCONNECTED),s=i||e!=="retry";i&&e==="retry"&&(V.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",t=Qs.P2P_DISCONNECTED),s&&(V.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(Pt.REPORT_JOIN_GATEWAY,t||Qs.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Pt.DISCONNECT_P2P)),n(e)}),this.websocket.on(Wt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{V.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",$t.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(Pt.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof fe){if(e.code===z.UNEXPECTED_RESPONSE&&e.data.code===Mt.ERR_NO_AUTHORIZED)return this.initError=new fe(z.TOKEN_EXPIRE,"dynamic key expired"),void this.close(Di.TOKEN_EXPIRE);V.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",$t.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(Wt.REQUEST_NEW_URLS,(e,t)=>{Ys(this,Pt.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(Wt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ln.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(So.PRE_CONNECT_PC,()=>{this.emit(Pt.PRE_CONNECT_PC)})}}let Qz=(function(r){return r.NATIVE_RTC="native_rtc",r.NATIVE_RTM="native_rtm",r.WEB_RTC="web_rtc",r.WEB_RTM="web_rtm",r})({}),ws=(function(r){return r[r.CHOOSE_SERVER=11]="CHOOSE_SERVER",r[r.CLOUD_PROXY=18]="CLOUD_PROXY",r[r.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",r[r.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",r})({});function Ss(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Jw(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ss(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Ss(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function sf(r){return r.match(/^[\.\:\d]+$/)?"".concat(r.replace(/[^\d]/g,"-"),".").concat(te("TURN_DOMAIN")):(V.debug("Cannot recognized as ip address: ".concat(r,", use as host2")),r)}function of(r){try{let e=te("GATEWAY_DOMAINS").concat(te("TURN_DOMAIN")).find(t=>Re(r).call(r,t));return e?r.split(".".concat(e))[0].replace(/-/g,"."):r}catch{return V.debug("serverUrlToIp error, fallback to url",r),r}}function xC(r,e){r.addresses||(r.addresses=[]);let t=(function(c,d){if(te("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return c.map(m=>{let{ip:g,port:T}=m;return{address:"".concat(g,":").concat(T)}});let u=te("GATEWAY_DOMAINS"),p=u[1]&&Re(d).call(d,u[1])?1:0;return c.map(m=>{let{domain_prefix:g,port:T,ip:R}=m;if(g)return{address:"".concat(g,".").concat(u[p++%u.length],":").concat(T)};let I=/^[\.\:\d]+$/.test(R),A=I?"".concat(R.replace(/[^\d]/g,"-"),".").concat(u[p++%u.length],":").concat(T):"".concat(R,":").concat(T);return I||V.debug("Cannot recognized as ip address: ".concat(R,", use as host3")),{ip:R,port:T,address:A}})})(r.addresses,e),n=Array.isArray(r.detail)&&r.detail[18];if(n&&typeof n=="string"){let c=n.split(";");for(let d=0;d<c.length;d++){var i;let u=dr(i=c[d]).call(i);t[d]&&u&&(t[d].ip6=u)}}let s=r.detail&&r.detail.candidate,o;if(s){let[c,d]=s.split(":");c&&d&&(o={port:Number(d),ip:c,address:"".concat(c,":").concat(d)})}return{gatewayAddrs:t,apGatewayAddress:o,uid:r.uid,cid:r.cid,cert:r.cert,vid:r.detail&&r.detail[8],uni_lbs_ip:r.detail&&r.detail[1],res:r,csIp:r.detail&&r.detail[502]}}function zc(r){return typeof r=="number"?r:r.exact||r.ideal||r.max||r.min||0}function Sl(r){let e=r._encoderConfig;if(!e)return{};let t={resolution:e.width&&e.height?"".concat(zc(e.width),"x").concat(zc(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return typeof e.frameRate=="number"?(t.maxFrameRate=e.frameRate,t.minFrameRate=e.frameRate):e.frameRate&&(t.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,t.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),t}function eF(r){return r>=0&&r<.17?1:r>=.17&&r<.36?2:r>=.36&&r<.59?3:r>=.59&&r<=1?4:r>1?5:0}function VC(r,e){let t,n,i;switch(e){case ws.CHOOSE_SERVER:n=4096,i="choose server";break;case ws.CLOUD_PROXY:n=1048576,i="proxy";break;case ws.CLOUD_PROXY_5:n=4194304,i="proxy5";break;case ws.CLOUD_PROXY_FALLBACK:n=4194310,i="proxy fallback";break;default:throw new fe(z.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:r.detail&&r.detail[502],retry:!1})}if(r.response_body.forEach(s=>{s.buffer&&s.buffer.flag===n&&(t={code:s.buffer.code,addresses:(s.buffer.edges_services||[]).map(o=>Jw(Jw({},o),{},{ticket:s.buffer.cert})),server_ts:r.enter_ts,uid:s.buffer.uid,cid:s.buffer.cid,cname:s.buffer.cname,detail:Jw(Jw({},s.buffer.detail),r.detail),flag:s.buffer.flag,opid:r.opid,cert:s.buffer.cert})}),!t)throw new fe(z.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:r.detail&&r.detail[502]});return t}async function FC(r,e){return await De.all(r.addresses.map(async t=>({address:sf(t.ip),tcpport:t.port,udpport:t.port,username:e&&te("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?e.toString():Bs.username,password:e&&te("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await AD(e.toString()):Bs.password})))}function lP(r,e){let t=e.getMediaStreamTrack(!0).getSettings(),n=e.videoHeight||t.height,i=e.videoWidth||t.width;return n&&i?Math.max(Math.min(n,i)/Math.min(zc(r.height),zc(r.width)),1):(V.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function v_(r){let{candidateType:e,relayProtocol:t,type:n,address:i,port:s,protocol:o}=r,c={candidateType:e,relayProtocol:t,protocol:o};if(n!=="local-candidate"){let d=i.split(".");d.length>=4&&(d[1]="*",d[2]="*"),c.address=d.join("."),c.port=s}return c}function xd(r){let e=r.split(":"),t=r.split(/[-.]/),n=Re(r).call(r,"-")?"-":".",i=r;return e.length>1?t.length>1?(t[1]="**",i=t[0]+n+"**:"+e[e.length-1]):i=e.length>2?e[0]+n+"**:"+e[e.length-1]:"**:"+e[e.length-1]:t.length>1&&(i=t[0]+n+"**"),i}function y_(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:te("SVC_MODE");if(te("ENABLE_SVC"))return(function(e){return e in Gg})(r)?r:Gg.L1T3}let Qw={[vt.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[vt.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function Zw(r,e,t){e.forEach(n=>{var i;let s=Qw[r].find(c=>{var d;let{key:u}=c;return Re(d=n.extensionName).call(d,u)});if(!s)return;let o=t.find(c=>{let{extensionName:d}=c;return Re(d).call(d,s.key)});o&&Re(i=o.extensionName).call(i,"gdpr_forbidden")&&(n.extensionName=o.extensionName)})}function Hm(r,e){e.forEach(t=>{var n;let i=Qw[r].find(s=>{var o;let{key:c}=s;return Re(o=t.extensionName).call(o,c)});Re(n=t.extensionName).call(n,"gdpr_forbidden")&&i&&(t.extensionName=i.extensionName)})}function Nv(r){return r==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Re(r).call(r,"abs-send-time")}function $w(r){return r==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Re(r).call(r,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function e0(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function tF(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?e0(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):e0(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function BC(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0,{filterRTX:i,filterVideoFec:s,filterAudioFec:o,filterAudioCodec:c,filterVideoCodec:d,unsupportedVideoUplinkCodec:u,unsupportedVideoDownlinkCodec:p}=e,{useXR:m}=t,g=[],T=[],R=[],I=[],A=!1,w=!1;if(Wc(r).mediaDescriptions.forEach(L=>{n&&n!==L.attributes.direction||(L.media.mediaType!=="video"||A||(T=L.attributes.payloads,I=L.attributes.extmaps,A=!0),L.media.mediaType!=="audio"||w||(g=L.attributes.payloads,R=L.attributes.extmaps,w=!0))}),!I||T.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!R||g.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(T.forEach(L=>{var j;(j=L.rtpMap)!==null&&j!==void 0&&j.clockRate&&(L.rtpMap.clockRate=parseInt(L.rtpMap.clockRate)),m&&L.rtcpFeedbacks.push({type:"rrtr"})}),g.forEach(L=>{var j;(j=L.rtpMap)!==null&&j!==void 0&&j.clockRate&&(L.rtpMap.clockRate=parseInt(L.rtpMap.clockRate)),m&&L.rtcpFeedbacks.push({type:"rrtr"})}),i&&(g=g.filter(L=>{var j;return((j=L.rtpMap)===null||j===void 0?void 0:j.encodingName.toLowerCase())!=="rtx"}),T=T.filter(L=>{var j;return((j=L.rtpMap)===null||j===void 0?void 0:j.encodingName.toLowerCase())!=="rtx"})),s){let L=T.filter(W=>{var Y;return/(red)|(ulpfec)|(flexfec)/i.test(((Y=W.rtpMap)===null||Y===void 0?void 0:Y.encodingName)||"")}),j=Ih(L,T).map(W=>W.payloadType),K=[...L.map(W=>W.payloadType),...j];T=T.filter(W=>!Re(K).call(K,W.payloadType))}if(o&&(g=g.filter(L=>{var j;return!/(red)|(ulpfec)|(flexfec)/i.test(((j=L.rtpMap)===null||j===void 0?void 0:j.encodingName)||"")})),c&&c?.length>0&&(g=g.filter(L=>{var j;return Re(c).call(c,((j=L.rtpMap)===null||j===void 0?void 0:j.encodingName.toLowerCase())||"")})),d&&d?.length>0){let L=T.filter(j=>{var K;return Re(d).call(d,((K=j.rtpMap)===null||K===void 0?void 0:K.encodingName.toLowerCase())||"")});T=L.concat(i?[]:Ih(L,T))}let k=te("UNSUPPORTED_VIDEO_CODEC");if(k&&k.length>0){let L=T.filter(W=>W.rtpMap&&Re(k).call(k,W.rtpMap.encodingName.toLowerCase())),j=Ih(L,T),K=L.concat(j).map(W=>W.payloadType);T=T.filter(W=>!Re(K).call(K,W.payloadType)),V.debug("unsupportedVideoCodec: ".concat(k,", toBeRemoved: ").concat(K))}if(u&&u.length>0&&n==="sendonly"){let L=T.filter(W=>W.rtpMap&&Re(u).call(u,W.rtpMap.encodingName.toLowerCase())),j=Ih(L,T),K=L.concat(j).map(W=>W.payloadType);T=T.filter(W=>!Re(K).call(K,W.payloadType)),V.debug("unsupportedVideoUplinkCodec: ".concat(u,", toBeRemoved: ").concat(K))}if(p&&p.length>0&&n==="recvonly"){let L=T.filter(W=>W.rtpMap&&Re(p).call(p,W.rtpMap.encodingName.toLowerCase())),j=Ih(L,T),K=L.concat(j).map(W=>W.payloadType);T=T.filter(W=>!Re(K).call(K,W.payloadType)),V.debug("unsupportedVideoDownlinkCodec: ".concat(p,", toBeRemoved: ").concat(K))}return{audioCodecs:g,videoCodecs:T,audioExtensions:R,videoExtensions:I}}function bh(r){let e=Wc(r),t,n;for(let i of e.mediaDescriptions){if(!t){let s=i.attributes.iceUfrag,o=i.attributes.icePwd;if(!s||!o)throw new Error("Cannot get iceUfrag or icePwd from SDP.");t={iceUfrag:s,icePwd:o}}if(!n){let s=i.attributes.fingerprints;s.length>0&&(n={fingerprints:s})}}if(!n&&e.attributes.fingerprints.length>0&&(n={fingerprints:e.attributes.fingerprints}),!n||!t)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:t,dtlsParameters:n}}function Km(r,e){let t=[],n=r.attributes.ssrcGroups.filter(o=>o.semantic==="FID"),i=r.attributes.ssrcGroups.find(o=>o.semantic==="SIM"),s=r.attributes.ssrcs;if(i)i.ssrcIds.forEach(o=>{var c;let d=(c=n.find(u=>u.ssrcIds[0]===o))===null||c===void 0?void 0:c.ssrcIds[1];t.push({ssrcId:o,rtx:e?d:void 0})});else if(n.length>0){let o=n[0].ssrcIds[0],c=n[0].ssrcIds[1];t.push({ssrcId:o,rtx:e?c:void 0})}else{if(s.length===0)throw new Error("No ssrcs found on local media description.");t.push({ssrcId:s[0].ssrcId})}return t}function nF(r,e,t){let{cname:n}=r,i=[];e&&(i=iF(e)),i.length===0&&(i=r.iceParameters.candidates.map(p=>({foundation:p.foundation,componentId:"1",transport:p.protocol,priority:p.priority.toString(),connectionAddress:p.ip,port:p.port.toString(),type:p.type,extension:{}})),V.debug("Using candidates from gateway."));let s={fingerprints:r.dtlsParameters.fingerprints.map(p=>({hashFunction:p.algorithm,fingerprint:p.fingerprint}))},o={iceUfrag:r.iceParameters.iceUfrag,icePwd:r.iceParameters.icePwd},c;switch(r.dtlsParameters.role){case"server":c="passive";break;case"client":c="active";break;case"auto":c="actpass"}let d=ed(r.rtpCapabilities),u=[];return Array.isArray(t)&&t.length>0&&t.forEach(p=>{u.push({kind:vt.VIDEO,ssrcMsg:[{ssrcId:p.v,rtx:p.v_rtx}],mslabel:"".concat(p.v,"_").concat(p.a)},{kind:vt.AUDIO,ssrcMsg:[{ssrcId:p.a}],mslabel:"".concat(p.v,"_").concat(p.a)})}),{dtlsParameters:s,iceParameters:o,candidates:i,rtpCapabilities:d,setup:c,cname:n,preSSRCs:u}}function iF(r){let e=[];return r.ip&&typeof r.port=="number"&&(e=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:r.ip,port:r.port.toString(),type:"host",extension:{}}],V.debug("Using remote candidate from AP ".concat(xd(r.ip),":").concat(r.port)),r.ip6&&(e.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:r.ip6,port:r.port.toString(),type:"host",extension:{}}),V.debug("Using IPV6 remote candidate from AP ".concat(xd(r.ip6),":").concat(r.port)))),e}function jC(r,e,t){let n=[],i=[];return r.forEach(s=>{let{ssrcId:o,rtx:c}=s,d=In(8,"track-"),u={ssrcId:o,attributes:tF({label:d,mslabel:t=t||In(10,""),msid:"".concat(t," ").concat(d)},e&&{cname:e})};if(n.push(u),c!==void 0){let p={ssrcId:c,attributes:tF({label:d,mslabel:t,msid:"".concat(t," ").concat(d)},e&&{cname:e})};n.push(p),i.push({semantic:"FID",ssrcIds:[o,c]})}}),r.length>1&&i.push({semantic:"SIM",ssrcIds:r.map(s=>{let{ssrcId:o}=s;return o})}),{ssrcs:n,ssrcGroups:i}}function R_(r,e){e instanceof ci&&r.attributes.payloads.forEach(t=>{var n;let i=(n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase();if(!i||["opus","pcmu","pcma","g722"].indexOf(i)===-1)return;t.fmtp||(t.fmtp={parameters:{}}),i==="opus"&&typeof te("OPUS_PTIME")=="number"?t.fmtp.parameters.ptime=te("OPUS_PTIME"):t.fmtp.parameters.minptime="10",t.fmtp.parameters.useinbandfec="1";let s=e._encoderConfig;s&&(i!=="pcmu"&&i!=="pcma"&&i!=="g722"&&(s.bitrate&&!jr()&&(t.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*s.bitrate))),s.sampleRate&&(t.fmtp.parameters.maxplaybackrate="".concat(s.sampleRate),t.fmtp.parameters["sprop-maxcapturerate"]="".concat(s.sampleRate)),s.stereo&&(t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1")),e instanceof Rr&&i==="opus"&&e._config.DTX&&(t.fmtp.parameters.usedtx="1"))})}function Qg(r){let e=r.attributes.unrecognized.findIndex(t=>t.attField==="x-google-flag"&&t.attValue==="conference");e!==-1&&r.attributes.unrecognized.splice(e,1)}function t0(r,e){var t;if(!(e instanceof Ei&&e._encoderConfig&&e._hints.indexOf(rt.SCREEN_TRACK)===-1))return;let n=e._encoderConfig;on().supportMinBitrate&&n.bitrateMin&&r.attributes.payloads.forEach(i=>{var s,o;Re(s=["h264","h265","vp8","vp9","av1"]).call(s,((o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-min-bitrate"]="".concat(n.bitrateMin))}),on().supportMinBitrate&&!Re(t=e._hints).call(t,rt.LOW_STREAM)&&n.bitrateMax&&r.attributes.payloads.forEach(i=>{var s,o;Re(s=["h264","h265","vp8","vp9","av1"]).call(s,((o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-start-bitrate"]="".concat(te("X_GOOGLE_START_BITRATE")||Math.floor(n.bitrateMax)))})}function dP(r){if(r.media.mediaType!=="video")return;let e=Qn();if(e.name!==sn.SAFARI&&e.os!==Br.IOS)return;let t=r.attributes.extmaps.findIndex(n=>/video-orientation/g.test(n.extensionName));t!==-1&&r.attributes.extmaps.splice(t,1)}function n0(r,e,t){if(!e)return;let n,i;if(r.media.mediaType==="video"?(n=t.videoExtensions,i=t.videoCodecs):(n=t.audioExtensions,i=t.audioCodecs),e.twcc===!0){let s=n.find(o=>$w(o.extensionName));if(s){let o=s.extensionName;r.attributes.extmaps.find(c=>$w(c.extensionName))||r.attributes.extmaps.push({entry:s.entry,extensionName:o}),(function(c,d){return d.filter(u=>!!c.find(p=>p.payloadType===u.payloadType&&!!p.rtcpFeedbacks.find(m=>m.type==="transport-cc")))})(i,r.attributes.payloads).forEach(c=>{c.rtcpFeedbacks.find(d=>d.type==="transport-cc")||c.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(e.twcc===!1){let s=r.attributes.extmaps.findIndex(o=>$w(o.extensionName));s!==-1&&r.attributes.extmaps.splice(s,1),r.attributes.payloads.forEach(o=>{let c=o.rtcpFeedbacks.findIndex(d=>d.type==="transport-cc");c!==-1&&o.rtcpFeedbacks.splice(c,1)})}if(e.remb===!0){let s=n.find(o=>Nv(o.extensionName));if(s){let o=s.extensionName;r.attributes.extmaps.find(c=>c.extensionName===o)||r.attributes.extmaps.push({entry:s.entry,extensionName:o}),(function(c,d){return d.filter(u=>!!c.find(p=>p.payloadType===u.payloadType&&!!p.rtcpFeedbacks.find(m=>m.type==="goog-remb")))})(i,r.attributes.payloads).forEach(c=>{c.rtcpFeedbacks.find(d=>d.type==="goog-remb")||c.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(e.remb===!1){let s=r.attributes.extmaps.findIndex(o=>Nv(o.extensionName));s!==-1&&r.attributes.extmaps.splice(s,1),r.attributes.payloads.forEach(o=>{let c=o.rtcpFeedbacks.findIndex(d=>d.type==="goog-remb");c!==-1&&o.rtcpFeedbacks.splice(c,1)})}}function i0(r,e,t){if(jr()||r.media.mediaType!=="video"||!(e instanceof Ei)||t!=="vp9"&&t!=="vp8"||t==="vp8"&&!te("SIMULCAST")||t==="vp9"&&te("ENABLE_SVC")||e._scalabilityMode===void 0||e._scalabilityMode.numSpatialLayers<=1)return;let n=t==="vp8"?2:e._scalabilityMode.numSpatialLayers,i=r.attributes.ssrcs[0],s=r.attributes.ssrcGroups.find(c=>c.semantic==="FID"&&c.ssrcIds[0]===i.ssrcId),o={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let c=1;c<n;c++)r.attributes.ssrcs.push({ssrcId:i.ssrcId+c,attributes:sr(i.attributes)}),o.ssrcIds.push(i.ssrcId+c),s&&(r.attributes.ssrcs.push({ssrcId:s.ssrcIds[1]+c,attributes:sr(i.attributes)}),r.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+c,s.ssrcIds[1]+c]}));r.attributes.ssrcGroups.unshift(o)}async function rF(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=new RTCPeerConnection;t.addTransceiver("video",{direction:"sendonly"}),t.addTransceiver("audio",{direction:"sendonly"}),t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"});let n=(await t.createOffer()).sdp,{send:i,recv:s,sendrecv:o}=(function(){let c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=arguments.length>2?arguments[2]:void 0,p=BC(u,c,d,"sendonly"),m=BC(u,c,d,"recvonly"),g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},R={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Cu(p,m,"videoExtensions",g,T,R),Cu(p,m,"videoCodecs",g,T,R),Cu(p,m,"audioExtensions",g,T,R),Cu(p,m,"audioCodecs",g,T,R),te("RAISE_H264_BASELINE_PRIORITY")){let I=[],A=[];if(R.videoCodecs.forEach((w,k)=>{var L;if(((L=w.rtpMap)===null||L===void 0?void 0:L.encodingName.toLocaleLowerCase())==="h264"){var j,K;let W=R.videoCodecs[k+1],Y=W&&cF(w,W),se=(j=w.fmtp)===null||j===void 0?void 0:j.parameters["profile-level-id"],de=(K=w.fmtp)===null||K===void 0?void 0:K.parameters["packetization-mode"];!se||se!==te("FIRST_H264_PROFILE_LEVEL_ID")||te("FIRST_PACKETIZATION_MODE")&&de!==te("FIRST_PACKETIZATION_MODE")?Y?A.push([w,W]):A.push([w]):Y?I.push([w,W]):I.push([w])}}),I.length>0&&A.length>0){V.debug("raising H264 baseline profile priority"),R.videoCodecs.forEach((k,L)=>{var j;if(((j=k.rtpMap)===null||j===void 0?void 0:j.encodingName.toLocaleLowerCase())==="h264"){let K=cF(k,R.videoCodecs[L+1]),W=I.shift()||A.shift()||[];W.length>0&&(K?R.videoCodecs.splice(L,2,...W):R.videoCodecs.splice(L,1,...W))}});let w=T.videoCodecs.filter(k=>{var L,j;return((L=k.rtpMap)===null||L===void 0?void 0:L.encodingName.toLocaleLowerCase())==="h264"&&((j=k.fmtp)===null||j===void 0?void 0:j.parameters["profile-level-id"])!==te("FIRST_H264_PROFILE_LEVEL_ID")});if(w.length>0){let k=Ih(w,T.videoCodecs).map(j=>j.payloadType),L=[...w.map(j=>j.payloadType),...k];T.videoCodecs=T.videoCodecs.filter(j=>!Re(L).call(L,j.payloadType))}te("FILTER_SEND_H264_BASELINE")&&(g.videoCodecs=g.videoCodecs.filter(k=>{var L,j;return!(((L=k.rtpMap)===null||L===void 0?void 0:L.encodingName.toLocaleLowerCase())==="h264"&&((j=k.fmtp)===null||j===void 0?void 0:j.parameters["profile-level-id"])!==te("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:g,recv:T,sendrecv:R}}return{send:g,recv:T,sendrecv:R}})(r,e,n);try{t.close()}catch{}return{send:i,recv:s,sendrecv:o}}function sF(){let r={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},e=BC(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),t={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Cu(r,e,"videoExtensions",t,n,i),Cu(r,e,"videoCodecs",t,n,i),Cu(r,e,"audioExtensions",t,n,i),Cu(r,e,"audioCodecs",t,n,i),te("RAISE_H264_BASELINE_PRIORITY")){let s=i.videoCodecs.findIndex(o=>o.rtpMap&&o.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&o.fmtp&&o.fmtp.parameters["profile-level-id"]==="42001f");if(s!==-1){let o=i.videoCodecs.findIndex(c=>c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(o<s){V.debug("raising H264 baseline profile priority");let c=i.videoCodecs[s];i.videoCodecs.splice(s,1),i.videoCodecs.splice(o,0,c)}o!==-1&&(n.videoCodecs=n.videoCodecs.filter(c=>!(c.rtpMap&&c.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&c.fmtp&&c.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:t,recv:n,sendrecv:i}}function Cu(r,e,t,n,i,s){if(t==="videoExtensions"||t==="audioExtensions"){let o=[];return r[t].forEach(c=>{e[t].some((d,u)=>{if(c.entry===d.entry&&c.extensionName===d.extensionName)return o.push(u),!0})?s[t].push(c):n[t].push(c)}),void e[t].forEach((c,d)=>{o.indexOf(d)===-1&&i[t].push(c)})}if(t==="videoCodecs"||t==="audioCodecs"){let o=[];return r[t].forEach(c=>{e[t].some((d,u)=>{if(c.payloadType===d.payloadType&&JSON.stringify(c)===JSON.stringify(d))return o.push(u),!0})?s[t].push(c):n[t].push(c)}),void e[t].forEach((c,d)=>{o.indexOf(d)===-1&&i[t].push(c)})}}function ed(r){let{send:e,recv:t,sendrecv:n}=r;if(!n){if(!e||!t)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:e,recv:t}}let i,s;return e?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...e.audioCodecs,...n.audioCodecs],i.videoCodecs=[...e.videoCodecs,...n.videoCodecs],i.audioExtensions=[...e.audioExtensions,...n.audioExtensions],i.videoExtensions=[...e.videoExtensions,...n.videoExtensions]):i=n,t?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...t.audioCodecs,...n.audioCodecs],s.videoCodecs=[...t.videoCodecs,...n.videoCodecs],s.audioExtensions=[...t.audioExtensions,...n.audioExtensions],s.videoExtensions=[...t.videoExtensions,...n.videoExtensions]):s=n,{send:i,recv:s}}function zm(r){r.media.mediaType==="audio"&&r.attributes.payloads.filter(e=>{var t;return((t=e.rtpMap)===null||t===void 0?void 0:t.encodingName.toLowerCase())==="opus"}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function C_(r,e,t,n){let i=[];if(r===vt.VIDEO){if(te("H264_PROFILE_LEVEL_ID")&&n==="h264"&&(i=e.videoCodecs.filter(s=>{var o;return Re(o=s.rtpMap&&s.rtpMap.encodingName.toLowerCase()||"").call(o,n)&&s&&s.fmtp&&s.fmtp.parameters["profile-level-id"]===te("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i)||i.length===0){let s=[],o=[],c=[],d=[];if(t.videoCodecs.forEach(u=>{let p=u.rtpMap&&u.rtpMap.encodingName.toLowerCase()||"";Re(p).call(p,n)?s.push(u):Re(p).call(p,"vp9")?o.push(u):Re(p).call(p,"vp8")?c.push(u):Re(p).call(p,"h264")&&d.push(u)}),s.length===0){let u="";o.length!==0?(s=o,u="vp9"):c.length!==0?(s=c,u="vp8"):d.length!==0&&(s=d,u="h264"),V.warning("codec ".concat(n," not included in rtpCapabilities, fallback to default payloads: ").concat(u))}s.length!==0&&(i=e.videoCodecs.filter(u=>s.some(p=>p.payloadType===u.payloadType)))}if(i.length===0&&(V.warning("codec ".concat(n," not included in rtpCapabilities, fallback to default payloads: ").concat(e.videoCodecs[0].rtpMap&&e.videoCodecs[0].rtpMap.encodingName)),i=e.videoCodecs),te("USE_PUB_RTX")||te("USE_SUB_RTX")){let s=Ih(i,e.videoCodecs);i=[...i,...s]}}else{i=e.audioCodecs.filter(o=>{var c;return Re(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,n)});let s=e.audioCodecs.filter(o=>{var c;return Re(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,"red")});i.length===0&&(V.warning("codec ".concat(n," not included in rtpCapabilities, fallback to opus")),i=e.audioCodecs.filter(o=>{var c;return Re(c=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(c,"opus")})),te("ENABLE_AUDIO_RED")&&s.length!==0&&(i=[...s,...i])}return i}function Ih(r,e){let t=r.map(n=>n.payloadType.toString());return e.filter(n=>n.rtpMap&&n.rtpMap.encodingName==="rtx"&&n.fmtp&&n.fmtp.parameters.apt&&Re(t).call(t,n.fmtp&&n.fmtp.parameters.apt))}async function td(r,e,t){let n=e.toString(),i=oF(n,"offer","remote","exchangeSDP");await r.setRemoteDescription({type:"offer",sdp:n});let s=await r.createAnswer();if(!s.sdp)throw new Error("cannot get answer sdp");let o=s.sdp;o=Ym(o,t||{}),i?.(o||""),await r.setLocalDescription({type:"answer",sdp:o})}function Ym(r,e,t){let n=Wc(r),{useXR:i}=e;return n.mediaDescriptions.forEach(s=>{var o;s.attributes.mid&&(Array.isArray(t)&&!Re(t).call(t,s.attributes.mid)||(s.media.mediaType==="audio"&&zm(s),i&&Re(o=["audio","video"]).call(o,s.media.mediaType)&&s.attributes.payloads.forEach(c=>{c.rtcpFeedbacks.findIndex(d=>d.type==="rrtr")===-1&&c.rtcpFeedbacks.push({type:"rrtr"})})))}),Qo(n)}function oF(r,e,t,n){if(te("SDP_LOGGING"))return V.upload("exchanging ".concat(t," ").concat(e," SDP during P2PConnection.").concat(n,`
`),r),e==="offer"?i=>{oF(i,"answer",t==="local"?"remote":"local",n)}:void 0}function aF(r){let e=te("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(e)&&e.length>0)&&e.some(t=>Re(r).call(r,t))}function cF(r,e){try{var t;return((t=r.fmtp)===null||t===void 0?void 0:t.parameters.apt)===e.payloadType.toString()}catch{return!1}}function lF(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function nd(r,e){return typeof te(r)===e?te(r):void 0}function Vd(){try{let r=te("EXPERIMENTS")||{};return typeof r=="string"||Array.isArray(r)?{}:(function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?lF(Object(n),!0).forEach(function(i){Z(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lF(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e})({},r)}catch(r){return V.debug("handle gateway attributes failed: ",r),{}}}let M4={};function qm(r){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&V.debug("install service ".concat(r.name)),M4[r.name]=r}function Tl(r){let e=M4[r];if(!e)throw new H(z.INVALID_OPERATION,"".concat(r," not found, please use AgoraRTC.use(").concat(r,"Service) to load it first"));return e}function b_(r,e){return Tl("DataStream").create(r,e)}function r0(){return Tl("InterceptFrame").create()}function s0(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Oa(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?s0(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):s0(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}let _a=new Map;class dF extends Sr{get state(){return this._state}set state(e){if(e===this._state)return;let t=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(gn.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(gn.CONNECTION_STATE_CHANGE,e,t)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){V.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,t){var n,i,s;super(),Z(this,"store",void 0),Z(this,"joinInfo",void 0),Z(this,"key",void 0),Z(this,"ntpOffset",0),Z(this,"signal",void 0),Z(this,"role",void 0),Z(this,"isPreallocation",void 0),Z(this,"isPreSub",void 0),Z(this,"inChannelInfo",{joinAt:null,duration:0}),Z(this,"spec",void 0),Z(this,"_state","DISCONNECTED"),Z(this,"_statsCollector",void 0),Z(this,"_disconnectedReason",void 0),Z(this,"isSignalRecover",!1),Z(this,"hasChangeBGPAddress",!1),Z(this,"trafficStatsInterval",void 0),Z(this,"networkQualityInterval",void 0),Z(this,"_joinGatewayStartTime",0),Z(this,"_signalTimeout",!1),Z(this,"_clientRoleOptions",void 0),Z(this,"_isProactiveJoin",!1),this.store=e,this.spec=t,this.signal=this.store.useP2P?(n={spec:Oa(Oa({},t),{},{retryConfig:t.websocketRetryConfig}),store:e},(i=(s=Tl("P2PChannel")).createSubmodule)===null||i===void 0?void 0:i.call(s,n)):new Xw(Oa(Oa({},t),{},{retryConfig:t.websocketRetryConfig}),e),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}async join(e,t,n){this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let i=Date.now(),s=_a.get(e.cname);if(s||(s=new Map,_a.set(e.cname,s)),this._isProactiveJoin=!0,s.has(e.uid)){let u=new fe(z.UID_CONFLICT);throw Ye.joinGateway(e.sid,{lts:i,succ:!1,ec:u.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),u}s.set(e.uid,!0),this.joinInfo=e,this.key=t;let o=0;this.joinGatewayStartTime=i;let c=e.proxyServer;try{V.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(o));let u=e.gatewayAddrs.map(p=>{let{address:m}=p,[g,T]=m.split(":"),R={host:g,port:T};return e.proxyServer&&(R.proxy=e.proxyServer),R});o=(await this.signal.init(u)).uid,V.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(o," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(u){var d;throw V.error("[".concat(this.store.clientId,"] User join failed"),u.toString()),Ye.joinGateway(e.sid,{lts:i,succ:!1,ec:((d=u.data)===null||d===void 0?void 0:d.desc)||u.code,errorMsg:u.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,isProxy:!!c,signalChannel:"0",preload:e.preload}),s.delete(e.uid),this.signal.close(),u}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),V.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(u=>{V.warning("[".concat(this.store.clientId,"] get traffic stats error"),u.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(gn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(gn.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(gn.NETWORK_QUALITY,{uplinkNetworkQuality:eF(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:eF(this._statsCollector.trafficStats.B_dnq)}):this.emit(gn.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),o}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){t!==Di.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==gt.CONNECTED||await(function(n,i){return i===1/0?n:De.race([n,n4(i)])})(this.signal.request(st.LEAVE,void 0,!0),3e3)}catch(n){V.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),n)}this.signal.close(t),t!==Di.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new fe(z.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let i={state:"offer",p2p_id:this.store.p2pId,ortc:t,mode:this.spec.mode,extend:te("PUB_EXTEND"),twcc:!!te("PUBLISH_TWCC"),rtx:!!te("USE_PUB_RTX")};try{return(await this.signal.request(st.PUBLISH,i,!0))._message}catch(s){if(n&&s.data&&s.data.code===Mt.ERR_PUBLISH_REQUEST_INVALID)return V.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),s.toString()),await this.tryUnpubBeforeRepub(e,t),this.publish(e,t,!1);throw s}}async publishDataChannel(e,t,n){var i;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new fe(z.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let s={stream_id:t.streamId,ordered:t.ordered?1:0,max_retrans_times:(i=t.maxRetransmits)!==null&&i!==void 0?i:10,channel_id:t.channelId,metadata:t.metadata};try{await this.signal.request(st.PUBLISH_DATASTREAM,s,!0)}catch(o){if(n&&o.data&&o.data.code===Mt.ERR_PUBLISH_REQUEST_INVALID)return V.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),o.toString()),await this.tryUnpubDataChannelBeforeRepub(e,t),this.publishDataChannel(e,t,!1);throw o}}async unpublish(e,t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new fe(z.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(st.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(n){V.warning("[".concat(this.store.clientId,"] unpublish warning: "),n)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new fe(z.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await De.all(e.map(t=>this.signal.request(st.UNPUBLISH_DATASTREAM,{channel_id:t},!0)))}catch(t){V.warning("unpublish datachannels warning: ",t)}}async presubscribe(e,t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new fe(z.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let i={stream_id:e,stream_type:t,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!te("SUBSCRIBE_TWCC"),rtx:!!te("USE_SUB_RTX")||void 0,extend:te("SUB_EXTEND"),svc:Array.isArray(te("SVC"))&&te("SVC").length!==0?te("SVC"):void 0};try{return await this.signal.request(st.PRE_SUBSCRIBE,i,!0)}catch(s){if(n&&s.data&&s.data.code===Mt.ERR_SUBSCRIBE_REQUEST_INVALID)return V.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),s.toString()),this.presubscribe(e,t,!1);throw s}}async subscribe(e,t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new fe(z.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let i={stream_id:e,stream_type:t.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!te("SUBSCRIBE_TWCC"),rtx:!!te("USE_SUB_RTX"),extend:te("SUB_EXTEND"),ssrcId:t.ssrcId,svc:Array.isArray(te("SVC"))&&te("SVC").length!==0?te("SVC"):void 0};try{return(await this.signal.request(st.SUBSCRIBE,i,!0))._message}catch(s){if(n&&s.data&&s.data.code===Mt.ERR_SUBSCRIBE_REQUEST_INVALID)return V.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),s.toString()),await this.tryUnsubBeforeResub(e,t),await this.subscribe(e,t,!1);throw s}}async subscribeDataChannel(e,t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new fe(z.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let i={uid:e,stream_id:t.id,channel_id:t.datachannelId};try{return void await this.signal.request(st.SUBSCRIBE_DATASTREAM,i,!0)}catch(s){if(n&&s.data&&s.data.code===Mt.ERR_SUBSCRIBE_REQUEST_INVALID)return V.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),s.toString()),await this.tryUnsubDataChannelBeforeResub(e,t),await this.subscribeDataChannel(e,t,!1);throw s}}async subscribeAll(e,t){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new fe(z.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let n={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!te("USE_SUB_RTX"),twcc:!!te("SUBSCRIBE_TWCC"),svc:Array.isArray(te("SVC"))&&te("SVC").length!==0?te("SVC"):void 0};try{return await this.signal.request(st.SUBSCRIBE_STREAMS,n,!0)}catch(i){if(t&&i.data&&i.data.code===Mt.ERR_SUBSCRIBE_REQUEST_INVALID)return V.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),i.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw i}}async setVideoProfile(e){let t=(function(n){if(!(n.bitrateMax&&n.bitrateMin&&n.frameRate&&n.height&&n.width))return;let i=n.frameRate,s=n.width,o=n.height,c=!0;return typeof i!="number"&&(i=i.exact||i.ideal||i.max||i.min||0,i||(c=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,s||(c=!1)),typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,i||(c=!1)),c?{stream_type:0,width:s,height:o,fps:i,start_bps:1e3*n.bitrateMax,min_bps:1e3*n.bitrateMin,target_bps:1e3*n.bitrateMax}:void 0})(e);if(t)return this.signal.request(st.SET_VIDEO_PROFILE,t);V.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,t){try{await this.signal.request(st.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:t},!0)}catch(n){V.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),n)}}async unsubscribeDataChannel(e,t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new fe(z.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await De.all(e.map(n=>this.signal.request(st.UNSUBSCRIBE_DATASTREAM,{stream_id:n,uid:t},!0)))}catch(n){V.warning("unsubscribeDataChannel warning: ",n)}}async massUnsubscribe(e){try{await this.signal.request(st.UNSUBSCRIBE_STREAMS,e,!0)}catch(t){V.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),t)}}async reconnectPC(e){let{iceParameters:t,dtlsParameters:n,rtpCapabilities:i}=e;return{gatewayEstablishParams:await this.signal.request(st.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t,dtlsParameters:n,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(st.GATEWAY_INFO)}async renewToken(e){await this.signal.request(st.RENEW_TOKEN,e),this.key=e.token}updateClientRole(e,t){t&&(this._clientRoleOptions=Object.assign({},t)),te("CLIENT_ROLE_OPTIONS")&&(V.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(te("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},te("CLIENT_ROLE_OPTIONS"))),this.role=e}async setClientRole(e,t){if(t&&(this._clientRoleOptions=Object.assign({},t)),te("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},te("CLIENT_ROLE_OPTIONS")),V.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(te("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=e);let n,i=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(n=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0;let s=Object.assign({},t);delete s.delay,delete s.level,await this.signal.request(st.SET_CLIENT_ROLE,Oa(Oa({role:e,level:i,delay:n},s),{},{client_ts:Date.now()})),this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request(st.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(st.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,t){await this.signal.request(st.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request(st.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}async setRTM2Flag(e){await this.signal.request(st.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,t,n){if(this.store.useP2P)return this.signal.sendExtensionMessage(e,t,n)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Oa({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(st.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let e=_a.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;let e=(function(t){let n;return n=t.startsWith("dc")?t.match(/(dc\:\/\/)?([^:]+):(\d+)/):t.match(/(wss\:\/\/)?([^:]+):(\d+)/),n?{username:Bs.username,password:Bs.password,turnServerURL:n[2],tcpport:parseInt(n[3])+30,udpport:parseInt(n[3])+30,forceturn:!1}:null})((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Oa(Oa({},Bs),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;let e=await this.signal.request(st.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(t=>{let n=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(i=>i.peer_uid===t.peer_uid);n&&n.B_st!==t.B_st&&km(()=>{this.emit(gn.STREAM_TYPE_CHANGE,t.peer_uid,t.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){var t,n;if(!this.joinInfo||!this.key)throw new fe(z.UNEXPECTED_ERROR,"can not generate join message, no join info");let i=Object.assign({},this.joinInfo.apResponse),s=te("REPORT_APP_SCENARIO");if(typeof s!="string")try{s=JSON.stringify(s)}catch{s=void 0}var o;s&&s.length>128&&(s=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(gn.UPDATE_GATEWAY_CONFIG),o=this.store.clientId,Re(yh).call(yh,o)||yh.push(o);let c=RC(this.store),d=!((t=this.isPreallocation)===null||t===void 0||!t.call(this)),u=xD(this.store),p=Vd(),m=mo(87)||Xo()||yw(117),g=((function(){let R=Qn();if(R.name!==sn.SAFARI||!R.browserVersion)return!1;let I=R.browserVersion.split(".");return Number(I[0])>18||Number(I[0])===18&&Number(I[1])>=4})()||BU(18,4,!1))&&TD(18,6,!0)&&this.spec.codec==="h264"&&te("ENABLE_ABSSENDTIME_AS_SENTTS"),T=Oa({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Yl,browser:navigator.userAgent,process_id:te("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:i,extend:te("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:s,attributes:{userAttributes:Oa(Oa({enableEncodedTransform:(!!te("ENABLE_AUDIO_METADATA")||!!te("ENABLE_AUDIO_PTS"))&&m||!!te("ENABLE_AUDIO_TOPN")&&gD(sn.CHROME,87,116)||void 0,enableAudioMetadata:!!te("ENABLE_AUDIO_METADATA")&&m,enableAudioPts:!!te("ENABLE_AUDIO_PTS")&&m,topnSmoothLevel:te("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:te("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:te("TOPN_SWITCH_HOLD_MS"),topnAudioGain:te("TOPN_AUDIO_GAIN"),enablePublishedUserList:te("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:te("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:nd("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:nd("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:nd("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:te("USE_PUB_RTX")===!0||te("USE_SUB_RTX")===!0||void 0,disableFEC:te("DISABLE_FEC"),enableNTPReport:!!te("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:u,enableFulllinkAvSync:!!te("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:nd("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!te("FORCE_ENABLE_AUT_CC")||!Dw()&&(!!te("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!te("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:nd("USE_XR","boolean"),enableLossbasedBwe:nd("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!te("FORCE_ENABLE_AUT_CC")||!Dw()&&(!!te("ENABLE_AUT_CC")||void 0),enableCCFallback:nd("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:d,preSubNum:c?nd("PRE_SUB_NUM","number"):void 0,enablePubTWCC:nd("PUBLISH_TWCC","boolean"),enableSubTWCC:nd("SUBSCRIBE_TWCC","boolean"),enablePubRTX:nd("USE_PUB_RTX","boolean"),enableSubRTX:nd("USE_SUB_RTX","boolean"),enableSubSVC:te("ENABLE_SVC")?te("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(te("SVC"))&&te("SVC").length!==0?te("SVC"):void 0,enableSvcExtended:te("ENABLE_SVC")&&Array.isArray(te("SVC_EXTENDED"))&&te("SVC_EXTENDED").length!==0?te("SVC_EXTENDED"):void 0},p),{},{audioDuplicate:nd("ENABLE_AUDIO_RED","boolean")?(n=nd("AUDIO_DUPLICATE_NUM","number"))!==null&&n!==void 0?n:2:void 0,senttsUsesAbsSendTime:!!g||void 0})},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(T.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(T.aes_mode=this.joinInfo.aesmode,te("ENCRYPT_AES")?(T.aes_secret=this.joinInfo.aespassword,T.aes_encrypt=!0):T.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(T.aes_salt=this.joinInfo.aessalt)),i.addresses[this.signal.websocket.currentURLIndex]&&(T.ap_response.ticket=i.addresses[this.signal.websocket.currentURLIndex].ticket,delete i.addresses),this.joinInfo.defaultVideoStream!==void 0&&(T.default_video_stream=this.joinInfo.defaultVideoStream),T}getRejoinMessage(){if(!this.joinInfo)throw new fe(z.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Pt.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Pt.WS_RECONNECTING,e=>{this.joinInfo&&Ye.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||$t.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Ye.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Pt.WS_CLOSED,e=>{let t;switch(e){case Di.LEAVE:t=$t.LEAVE;break;case Di.UID_BANNED:case Di.IP_BANNED:case Di.CHANNEL_BANNED:case Di.SERVER_ERROR:t=$t.SERVER_ERROR;break;case Di.FALLBACK:t=$t.FALLBACK;break;case Di.LICENSE_MISSING:case Di.LICENSE_EXPIRED:case Di.LICENSE_MINUTES_EXCEEDED:case Di.LICENSE_PERIOD_INVALID:case Di.LICENSE_MULTIPLE_SDK_SERVICE:case Di.LICENSE_ILLEGAL:case Di.TOKEN_EXPIRE:t=e;break;default:t=$t.NETWORK_ERROR}V.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t||"undefined -> "+$t.NETWORK_ERROR)),this.joinInfo&&Ye.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===Di.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this._disconnectedReason=e,e!==Di.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Pt.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){let e=te("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;e&&(e.level||e.delay)&&(V.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(e.level,", delay: ").concat(e.delay)),this.setClientRole(this.role,e))}if(Ye.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){let e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void V.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));en("EVENT_REPORT_DOMAIN",e[1]),en("EVENT_REPORT_BACKUP_DOMAIN",e[1]),en("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}}),this.signal.on(Ln.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(Pt.REQUEST_RECOVER,(e,t,n)=>{if(!this.joinInfo)return n(new fe(z.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Ys(this,gn.REQUEST_NEW_GATEWAY_LIST).then(t).catch(n)}),this.signal.on(Pt.REQUEST_JOIN_INFO,async(e,t,n)=>{var i,s,o;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));let c=sr((i=this.joinInfo)===null||i===void 0?void 0:i.turnServer);if(te("NEW_TURN_MODE")&&c&&((s=this.joinInfo)===null||s===void 0?void 0:s.cloudProxyServer)==="disabled"){var d;let g=c.servers.map(I=>"turnServerURL"in I&&te("USE_TURN_IP")?Oa(Oa({},I),{},{turnServerURL:of(I.turnServerURL)}):I),T=(d=c.serversFromGateway)===null||d===void 0?void 0:d.map(I=>te("USE_TURN_IP")?Oa(Oa({},I),{},{turnServerURL:of(I.turnServerURL)}):I),R=this.signal.currentURLIndex;g.length>0&&(g=[g[R%g.length]],c.servers=g),Array.isArray(T)&&T.length>0&&(T=[T[0]],c.serversFromGateway=T),V.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(R))}let{iceParameters:u,dtlsParameters:p,rtpCapabilities:m}=await Ys(this,gn.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:c,cloudProxyServer:(o=this.joinInfo)===null||o===void 0?void 0:o.cloudProxyServer});try{e(this.getJoinMessage({ortc:{iceParameters:u,dtlsParameters:p,rtpCapabilities:m,version:"2"}}))}catch(g){t(g)}}),this.signal.on(Pt.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(Pt.REPORT_JOIN_GATEWAY,(e,t)=>{if(!this.joinInfo)return;let n,i="";var s;e instanceof fe?(n=((s=e.data)===null||s===void 0?void 0:s.desc)||e.code,i=e.message):n=e,Ye.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:n,errorMsg:i,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Pt.IS_P2P_DISCONNECTED,e=>{e(Sc(this,gn.IS_P2P_DISCONNECTED))}),this.signal.on(Pt.DISCONNECT_P2P,()=>{this.emit(gn.DISCONNECT_P2P)}),this.signal.on(Pt.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Pt.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Pt.JOIN_RESPONSE,e=>{let t=this.getCurrentGatewayAddress();this.emit(gn.JOIN_RESPONSE,e,t)}),this.signal.on(Pt.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var e,t;this.updateTurnConfigFromSignal();let i=this.getCurrentGatewayAddress(),s=sr((e=this.joinInfo)===null||e===void 0?void 0:e.turnServer);if(te("NEW_TURN_MODE")&&s&&((t=this.joinInfo)===null||t===void 0?void 0:t.cloudProxyServer)==="disabled"){var n;let c=s.servers.map(p=>"turnServerURL"in p&&te("USE_TURN_IP")?Oa(Oa({},p),{},{turnServerURL:of(p.turnServerURL)}):p),d=(n=s.serversFromGateway)===null||n===void 0?void 0:n.map(p=>te("USE_TURN_IP")?Oa(Oa({},p),{},{turnServerURL:of(p.turnServerURL)}):p),u=this.signal.currentURLIndex;c.length>0&&(c=[c[u%c.length]],s.servers=c),Array.isArray(d)&&d.length>0&&(d=[d[0]],s.serversFromGateway=d),V.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(u,",in pre pc"))}let o=te("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(i&&o){let c=iF(i);this.emit(gn.PRE_CONNECT_PC,{candidates:c,fingerprint:o,turnServer:s})}}}),this.signal.on(Pt.RECOVER_NOTIFICATION,e=>{this.joinInfo&&typeof te("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(te("AP_REQUEST_DETAIL"),";").concat(e))})}async tryUnsubBeforeResub(e,t){try{await this.signal.request(st.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[t]},!0)}catch(n){throw V.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),n),n}}async tryUnsubDataChannelBeforeResub(e,t){try{await this.signal.request(st.UNSUBSCRIBE,{stream_id:t.id},!0)}catch(n){throw V.warning("unsubscribe datachannel warning",n),n}}async tryUnpubBeforeRepub(e,t){try{await this.signal.request(st.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(n){throw V.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),n),n}}async tryUnpubDataChannelBeforeRepub(e,t){try{await this.signal.request(st.UNPUBLISH_DATASTREAM,{channnel_id:t.channelId},!0)}catch(n){throw V.warning("unpublish datastream warning: ",n),n}}async tryMassUnsubBeforeResub(e){let t={users:e.map(n=>({stream_id:n.stream_id,stream_type:n.stream_type}))};try{await this.signal.request(st.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){throw V.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),n),n}}async muteLocal(e,t){let n={action:e.find(i=>i.stream_type===vi.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(st.CONTROL,n,!0,!0)}catch(i){throw V.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),i),i}}async unmuteLocal(e,t){let n={action:e.find(i=>i.stream_type===vi.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request(st.CONTROL,n,!0,!0)}catch(i){throw V.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),i),i}}async muteRemote(e,t){let n={action:e===vt.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(st.CONTROL,n,!0,!0)}catch(i){throw V.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),i),i}}async unmuteRemote(e,t){let n={action:e===vt.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:t};try{await this.signal.request(st.CONTROL,n,!0,!0)}catch(i){throw V.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),i),i}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,t){this.signal.upload(e,t)}getSignalRTT(){return this.signal.rtt}async restartICE(e){let t={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(st.RESTART_ICE,t,!0)}catch(n){throw V.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),n),n}}reconnect(e,t){this.state==="CONNECTED"&&this.signal.reconnect(e||void 0,t||$t.P2P_FAILED)}getCurrentGatewayAddress(){var e,t;if(!te("GATEWAY_WSS_ADDRESS"))return te("USE_CANDIDATE_FROM_AP_DETAIL")&&(e=this.joinInfo)!==null&&e!==void 0&&e.apGatewayAddress?(V.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(t=this.joinInfo)!==null&&t!==void 0&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(st.SET_PARAMETER,{enablePublishAudioFilter:e})}downgradeCodec(e){this.signal.downgradeCodec(e)}}let uP=0,GC=0;function bu(r,e,t,n){return new De((i,s)=>{e.timeout=e.timeout||te("HTTP_CONNECT_TIMEOUT"),e.responseType=e.responseType||"json",e.data&&!t?(e.data=JSON.stringify(e.data),uP+=Jp(e.data)):t&&(e.data.size?uP+=e.data.size:e.data instanceof FormData?uP+=Qp(e.data):uP+=Jp(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=r,Er.request(e).then(o=>{typeof o.data=="string"?GC+=Jp(o.data):o.data instanceof ArrayBuffer||o.data instanceof Uint8Array?GC+=o.data.byteLength:GC+=Jp(JSON.stringify(o.data)),n&&i({data:o.data,headers:o.headers}),i(o.data)}).catch(o=>{Er.isCancel(o)?s(new fe(z.OPERATION_ABORTED,"cancel token canceled")):o.code==="ECONNABORTED"?s(new fe(z.NETWORK_TIMEOUT,o.message)):o.response?s(new fe(z.NETWORK_RESPONSE_ERROR,o.response.status)):s(new fe(z.NETWORK_ERROR,o.message))})})}(function(){var r;function e(We){var Se=0;return function(){return Se<We.length?{done:!1,value:We[Se++]}:{done:!0}}}var t=typeof Object.defineProperties=="function"?Object.defineProperty:function(We,Se,we){return We==Array.prototype||We==Object.prototype||(We[Se]=we.value),We},n,i=(function(We){We=[typeof globalThis=="object"&&globalThis,We,typeof window=="object"&&window,typeof self=="object"&&self,typeof _=="object"&&_];for(var Se=0;Se<We.length;++Se){var we=We[Se];if(we&&we.Math==Math)return we}throw Error("Cannot find global object")})(this);function s(We,Se){if(Se)e:{var we=i;We=We.split(".");for(var be=0;be<We.length-1;be++){var M=We[be];if(!(M in we))break e;we=we[M]}(Se=Se(be=we[We=We[We.length-1]]))!=be&&Se!=null&&t(we,We,{configurable:!0,writable:!0,value:Se})}}function o(We){return(We={next:We})[Symbol.iterator]=function(){return this},We}function c(We){var Se=typeof Symbol<"u"&&Symbol.iterator&&We[Symbol.iterator];return Se?Se.call(We):{next:e(We)}}if(s("Symbol",function(We){function Se(M,O){this.A=M,t(this,"description",{configurable:!0,writable:!0,value:O})}if(We)return We;Se.prototype.toString=function(){return this.A};var we="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",be=0;return function M(O){if(this instanceof M)throw new TypeError("Symbol is not a constructor");return new Se(we+(O||"")+"_"+be++,O)}}),s("Symbol.iterator",function(We){if(We)return We;We=Symbol("Symbol.iterator");for(var Se="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),we=0;we<Se.length;we++){var be=i[Se[we]];typeof be=="function"&&typeof be.prototype[We]!="function"&&t(be.prototype,We,{configurable:!0,writable:!0,value:function(){return o(e(this))}})}return We}),typeof Object.setPrototypeOf=="function")n=Object.setPrototypeOf;else{var d;e:{var u={};try{u.__proto__={a:!0},d=u.a;break e}catch{}d=!1}n=d?function(We,Se){if(We.__proto__=Se,We.__proto__!==Se)throw new TypeError(We+" is not extensible");return We}:null}var p=n;function m(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function g(We){if(We.m)throw new TypeError("Generator is already running");We.m=!0}function T(We,Se){return We.h=3,{value:Se}}function R(We){this.g=new m,this.G=We}function I(We,Se,we,be){try{var M=Se.call(We.g.j,we);if(!(M instanceof Object))throw new TypeError("Iterator result "+M+" is not an object");if(!M.done)return We.g.m=!1,M;var O=M.value}catch(G){return We.g.j=null,We.g.s(G),A(We)}return We.g.j=null,be.call(We.g,O),A(We)}function A(We){for(;We.g.h;)try{var Se=We.G(We.g);if(Se)return We.g.m=!1,{value:Se.value,done:!1}}catch(we){We.g.v=void 0,We.g.s(we)}if(We.g.m=!1,We.g.l){if(Se=We.g.l,We.g.l=null,Se.F)throw Se.D;return{value:Se.return,done:!0}}return{value:void 0,done:!0}}function w(We){this.next=function(Se){return We.o(Se)},this.throw=function(Se){return We.s(Se)},this.return=function(Se){return(function(we,be){g(we.g);var M=we.g.j;return M?I(we,"return"in M?M.return:function(O){return{value:O,done:!0}},be,we.g.return):(we.g.return(be),A(we))})(We,Se)},this[Symbol.iterator]=function(){return this}}function k(We,Se){return Se=new w(new R(Se)),p&&We.prototype&&p(Se,We.prototype),Se}if(m.prototype.o=function(We){this.v=We},m.prototype.s=function(We){this.l={D:We,F:!0},this.h=this.C||this.u},m.prototype.return=function(We){this.l={return:We},this.h=this.u},R.prototype.o=function(We){return g(this.g),this.g.j?I(this,this.g.j.next,We,this.g.o):(this.g.o(We),A(this))},R.prototype.s=function(We){return g(this.g),this.g.j?I(this,this.g.j.throw,We,this.g.o):(this.g.s(We),A(this))},s("Array.prototype.entries",function(We){return We||function(){return(function(Se,we){Se instanceof String&&(Se+="");var be=0,M=!1,O={next:function(){if(!M&&be<Se.length){var G=be++;return{value:we(G,Se[G]),done:!1}}return M=!0,{done:!0,value:void 0}}};return O[Symbol.iterator]=function(){return O},O})(this,function(Se,we){return[Se,we]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var L=function(We,Se){for(var we=0;we<We.length;we++)Se(We[we])},j=function(We){return We.replace(/\r?\n|\r/g,`\r
`)},K=function(We,Se,we){return Se instanceof Blob?(we=we!==void 0?we+"":typeof Se.name=="string"?Se.name:"blob",Se.name===we&&Object.prototype.toString.call(Se)!=="[object Blob]"||(Se=new File([Se],we)),[String(We),Se]):[String(We),String(Se)]},W=function(We,Se){if(We.length<Se)throw new TypeError(Se+" argument required, but only "+We.length+" present.")},Y=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,se=Y.FormData,de=Y.XMLHttpRequest&&Y.XMLHttpRequest.prototype.send,ge=Y.Request&&Y.fetch,je=Y.navigator&&Y.navigator.sendBeacon,_t=Y.Element&&Y.Element.prototype,ht=Y.Symbol&&Symbol.toStringTag;ht&&(Blob.prototype[ht]||(Blob.prototype[ht]="Blob"),"File"in Y&&!File.prototype[ht]&&(File.prototype[ht]="File"));try{new File([],"")}catch{Y.File=function(We,Se,we){return We=new Blob(We,we||{}),Object.defineProperties(We,{name:{value:Se},lastModified:{value:+(we&&we.lastModified!==void 0?new Date(we.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),ht&&Object.defineProperty(We,ht,{value:"File"}),We}}var Ct=function(We){return We.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Ft=function(We){this.i=[];var Se=this;We&&L(We.elements,function(we){if(we.name&&!we.disabled&&we.type!=="submit"&&we.type!=="button"&&!we.matches("form fieldset[disabled] *"))if(we.type==="file"){var be=we.files&&we.files.length?we.files:[new File([],"",{type:"application/octet-stream"})];L(be,function(M){Se.append(we.name,M)})}else we.type==="select-multiple"||we.type==="select-one"?L(we.options,function(M){!M.disabled&&M.selected&&Se.append(we.name,M.value)}):we.type==="checkbox"||we.type==="radio"?we.checked&&Se.append(we.name,we.value):(be=we.type==="textarea"?j(we.value):we.value,Se.append(we.name,be))})};if((r=Ft.prototype).append=function(We,Se,we){W(arguments,2),this.i.push(K(We,Se,we))},r.delete=function(We){W(arguments,1);var Se=[];We=String(We),L(this.i,function(we){we[0]!==We&&Se.push(we)}),this.i=Se},r.entries=function We(){var Se,we=this;return k(We,function(be){if(be.h==1&&(Se=0),be.h!=3)return Se<we.i.length?be=T(be,we.i[Se]):(be.h=0,be=void 0),be;Se++,be.h=2})},r.forEach=function(We,Se){W(arguments,1);for(var we=c(this),be=we.next();!be.done;be=we.next()){var M=c(be.value);be=M.next().value,M=M.next().value,We.call(Se,M,be,this)}},r.get=function(We){W(arguments,1);var Se=this.i;We=String(We);for(var we=0;we<Se.length;we++)if(Se[we][0]===We)return Se[we][1];return null},r.getAll=function(We){W(arguments,1);var Se=[];return We=String(We),L(this.i,function(we){we[0]===We&&Se.push(we[1])}),Se},r.has=function(We){W(arguments,1),We=String(We);for(var Se=0;Se<this.i.length;Se++)if(this.i[Se][0]===We)return!0;return!1},r.keys=function We(){var Se,we,be,M,O=this;return k(We,function(G){if(G.h==1&&(Se=c(O),we=Se.next()),G.h!=3)return we.done?void(G.h=0):(be=we.value,M=c(be),T(G,M.next().value));we=Se.next(),G.h=2})},r.set=function(We,Se,we){W(arguments,2),We=String(We);var be=[],M=K(We,Se,we),O=!0;L(this.i,function(G){G[0]===We?O&&(O=!be.push(M)):be.push(G)}),O&&be.push(M),this.i=be},r.values=function We(){var Se,we,be,M,O=this;return k(We,function(G){if(G.h==1&&(Se=c(O),we=Se.next()),G.h!=3)return we.done?void(G.h=0):(be=we.value,(M=c(be)).next(),T(G,M.next().value));we=Se.next(),G.h=2})},Ft.prototype._asNative=function(){for(var We=new se,Se=c(this),we=Se.next();!we.done;we=Se.next()){var be=c(we.value);we=be.next().value,be=be.next().value,We.append(we,be)}return We},Ft.prototype._blob=function(){var We="----formdata-polyfill-"+Math.random(),Se=[],we="--"+We+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(be,M){return typeof be=="string"?Se.push(we+Ct(j(M))+`"\r
\r
`+j(be)+`\r
`):Se.push(we+Ct(j(M))+'"; filename="'+Ct(be.name)+`"\r
Content-Type: `+(be.type||"application/octet-stream")+`\r
\r
`,be,`\r
`)}),Se.push("--"+We+"--"),new Blob(Se,{type:"multipart/form-data; boundary="+We})},Ft.prototype[Symbol.iterator]=function(){return this.entries()},Ft.prototype.toString=function(){return"[object FormData]"},_t&&!_t.matches&&(_t.matches=_t.matchesSelector||_t.mozMatchesSelector||_t.msMatchesSelector||_t.oMatchesSelector||_t.webkitMatchesSelector||function(We){for(var Se=(We=(this.document||this.ownerDocument).querySelectorAll(We)).length;0<=--Se&&We.item(Se)!==this;);return-1<Se}),ht&&(Ft.prototype[ht]="FormData"),de){var mn=Y.XMLHttpRequest.prototype.setRequestHeader;Y.XMLHttpRequest.prototype.setRequestHeader=function(We,Se){mn.call(this,We,Se),We.toLowerCase()==="content-type"&&(this.B=!0)},Y.XMLHttpRequest.prototype.send=function(We){We instanceof Ft?(We=We._blob(),this.B||this.setRequestHeader("Content-Type",We.type),de.call(this,We)):de.call(this,We)}}ge&&(Y.fetch=function(We,Se){return Se&&Se.body&&Se.body instanceof Ft&&(Se.body=Se.body._blob()),ge.call(this,We,Se)}),je&&(Y.navigator.sendBeacon=function(We,Se){return Se instanceof Ft&&(Se=Se._asNative()),je.call(this,We,Se)}),Y.FormData=Ft}})();let id=()=>{let r=te("AREAS");return r.length===0&&r.push(dn.GLOBAL),Ks(r).call(r,(e,t,n)=>{let i=WC(t);return i?n===0?i:"".concat(e,",").concat(i):e},"")},WC=r=>r===dn.OVERSEA?"".concat(pa.ASIA,",").concat(pa.EUROPE,",").concat(pa.AFRICA,",").concat(pa.NORTH_AMERICA,",").concat(pa.SOUTH_AMERICA,",").concat(pa.OCEANIA):pa[r],U4=r=>{let e={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return r.map(t=>{let n=Lo[t],i=Object.keys(n);i&&i.map(s=>{s!=="CODE"&&(e[s]=e[s].concat(n[s]))})}),e},hP={GLOBAL:{ASIA:[dn.CHINA,dn.JAPAN,dn.INDIA,dn.KOREA,dn.HKMC],EUROPE:[],NORTH_AMERICA:[dn.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},Dv=Object.keys(hP[dn.GLOBAL]),HC=[dn.CHINA,dn.NORTH_AMERICA,dn.EUROPE,dn.ASIA,dn.JAPAN,dn.INDIA,dn.OCEANIA,dn.SOUTH_AMERICA,dn.AFRICA,dn.KOREA,dn.HKMC,dn.US],uF=function(r,e){let t=[];if(Re(r).call(r,dn.GLOBAL)){let s=[dn.GLOBAL,dn.OVERSEA],o=Object.keys(Lo);if(e===dn.GLOBAL)throw new fe(z.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(e===dn.CHINA)t=[dn.OVERSEA];else if(i=e,Re(Dv).call(Dv,i)){let c=(n=e,hP[dn.GLOBAL][n]||[]),d=[...s,e,...c];t=o.filter(u=>!Re(d).call(d,u))}else if((function(c){let d=!1;return Dv.forEach(u=>{var p;Re(p=hP[dn.GLOBAL][u]).call(p,c)&&(d=!0)}),d})(e)){let c=(function(u){let p;return Dv.forEach(m=>{var g;Re(g=hP[dn.GLOBAL][m]).call(g,u)&&(p=m)}),p})(e),d=[...s,c,e];t=o.filter(u=>!Re(d).call(d,u))}else t=r;t=(function(c){let d=[];return HC.forEach(u=>{Re(c).call(c,u)&&d.push(u)}),d.concat(c.filter(u=>!Re(HC).call(HC,u)))})(t)}else t=r;var n,i;return t};function x4(r){var e,t;if(!r&&Re(e=te("AREAS")).call(e,dn.EXTENSIONS))return V.debug("update area from ap : reset"),void pP(Kw,!0);if(!Re(t=te("AREAS")).call(t,dn.GLOBAL)||!r)return;let n=Lo.EXTENSIONS;n&&(n={CODE:WC(dn.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(r,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(r,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(r,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(r,".agora.io"),"cds-ap-web-2-".concat(r,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(r,".agora.io"),"sua-ap-web-2-".concat(r,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(r,".agora.io"),"uap-ap-web-2-".concat(r,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(r,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(r,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(r,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(r,".agora.io")]},V.debug("update area from ap success: ".concat(r,",config is "),n),en("AREAS",[dn.EXTENSIONS],!0),Object.keys(n).map(i=>{i==="LOG_UPLOAD_SERVER"||i==="EVENT_REPORT_DOMAIN"||i==="EVENT_REPORT_BACKUP_DOMAIN"||i==="PROXY_SERVER_TYPE3"?en(i,n[i][0]):en(i,n[i])}))}function pP(r){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1],t=Ye.reportApiInvoke(null,{name:Zr.SET_AREA,options:r,tag:Cn.TRACER});try{let n=[];if(typeof r=="string"&&(n=[r]),Array.isArray(r)&&(r.forEach(s=>{if(!Re(Ri).call(Ri,s))throw new fe(z.INVALID_PARAMS,"invalid area code")}),n=r),Object.prototype.toString.call(r)==="[object Object]"){let{areaCode:s,excludedArea:o}=r;if(!s)throw new fe(z.INVALID_PARAMS,"area code is needed");let c=s;typeof s=="string"&&(c=[s]),n=o?uF(c,o):c}if(!e){if(Eh.AREAS){let s=new fe(z.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return t.onError(s),void V.warning("setArea is prohibited because of config-distribute")}if(Re(n).call(n,dn.GLOBAL)&&te("AREAS")===dn.EXTENSIONS){let s=new fe(z.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return t.onError(s),void V.warning("setArea is prohibited because of ap extensions")}}en("AREAS",n,e);let i=U4(n);Object.keys(i).map(s=>{s==="LOG_UPLOAD_SERVER"||s==="EVENT_REPORT_DOMAIN"||s==="EVENT_REPORT_BACKUP_DOMAIN"||s==="PROXY_SERVER_TYPE3"?en(s,i[s][0]):en(s,i[s])}),V.debug("set area success:",n.join(","))}catch(n){throw t.onError(n),n}t.onSuccess()}function fP(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function af(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?fP(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):fP(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}let Ah=1;function hF(r,e,t,n,i){Ah+=1;let s={sid:t.sid,command:"convergeAllocateEdge",uid:"666",appId:t.appId,ts:Math.floor(Date.now()/1e3),seq:Ah,requestId:Ah,version:Yl,cname:t.cname},o={service_name:e,json_body:JSON.stringify(s)},c,d,u=r[0];return Tu(async()=>{c=Date.now();let p=await bu(u,{data:o,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(d=Date.now()-c,p.code!==0){let T=new fe(z.UNEXPECTED_RESPONSE,"live streaming ap error, code"+p.code,{retry:!0,responseTime:d});throw V.error(T.toString()),T}let m=JSON.parse(p.json_body);if(m.code!==200){let T=new fe(z.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(m.code,", reason: ").concat(m.reason),{code:m.code,responseTime:d});throw V.error(T.toString()),T}if(!m.servers||m.servers.length===0){let T=new fe(z.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:m.code,responseTime:d});throw V.error(T.toString()),T}let g=(function(T,R){return{addressList:T.servers.map(I=>"wss://".concat(I.address.replace(/\./g,"-"),".").concat(te("WORKER_DOMAIN"),":").concat(I.wss,"?serviceName=").concat(encodeURIComponent(R))),workerToken:T.workerToken,vid:T.vid}})(m,e);return te("LIVE_STREAMING_ADDRESS")&&(g.addressList=te("LIVE_STREAMING_ADDRESS")instanceof Array?te("LIVE_STREAMING_ADDRESS"):[te("LIVE_STREAMING_ADDRESS")]),af(af({},g),{},{responseTime:d})},(p,m)=>(Ye.apworkerEvent(t.sid,{success:!0,sc:200,serviceName:e,responseDetail:JSON.stringify(p.addressList),firstSuccess:m===0,responseTime:d,serverIp:r[m%r.length]}),!1),(p,m)=>(Ye.apworkerEvent(t.sid,{success:!1,sc:p.data&&p.data.code||200,serviceName:e,responseTime:d,serverIp:r[m%r.length]}),!!(p.code!==z.OPERATION_ABORTED&&p.code!==z.UNEXPECTED_RESPONSE||p.data&&p.data.retry)&&(u=r[(m+1)%r.length],!0)),i)}let pF=1;function _P(r,e,t,n){let{url:i,areaCode:s}=r,{clientId:o,sid:c}=e,d=Date.now(),u,p=e.role,[m,g]=EF(e,s,[ws.CHOOSE_SERVER]),T=Kr.networkState;return Tu(async()=>{T&&Kr.networkState===vr.OFFLINE&&Kr.onlineWaiter&&await De.race([Kr.onlineWaiter,Jo(n&&n.maxRetryTimeout||zr.maxRetryTimeout)]),T=Kr.networkState;let{data:R,headers:I}=await bu(i,{data:m,cancelToken:t,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u=I.http3==="1"?1:-1,Ye.reportResourceTiming(i,c),_F(R,i,e,d,[ws.CHOOSE_SERVER],u);let A=VC(R,ws.CHOOSE_SERVER);return mP(A),xC(A,i)},R=>(R&&Ye.joinChooseServer(c,{role:p,lts:d,succ:!0,csAddr:i,opid:g,serverList:R.gatewayAddrs.map(I=>I.address),ec:null,cid:R.cid.toString(),uid:R.uid.toString(),csIp:R.csIp,unilbsServerIds:[ws.CHOOSE_SERVER].toString(),isHttp3:u,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:R.res.detail&&R.res.detail[38]}),!1),R=>R.code!==z.OPERATION_ABORTED&&(R.code===z.CAN_NOT_GET_GATEWAY_SERVER?R.data.retry:(Ye.joinChooseServer(c,{role:p,lts:d,succ:!1,csAddr:i,serverList:null,opid:g,ec:R.code,csIp:R.data&&R.data.csIp,unilbsServerIds:[ws.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:T}),isHttp3:u,corssRegionTagReq:e.apRequestDetail}),V.warning("[".concat(o||"sid-".concat(c.slice(0,6)),"] Choose server network error, retry"),R),!0)),n)}function fF(r,e,t,n){let i,{url:s,areaCode:o,serviceIds:c}=r,d=Date.now(),u=e.role,[p,m]=EF(e,o,c),g;return Tu(async()=>{g&&Kr.networkState===vr.OFFLINE&&Kr.onlineWaiter&&await De.race([Kr.onlineWaiter,Jo(n&&n.maxRetryTimeout||zr.maxRetryTimeout)]),g=Kr.networkState;let{data:T,headers:R}=await bu(s,{data:p,cancelToken:t,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i=R.http3==="1"?1:-1,Ye.reportResourceTiming(s,e.sid),_F(T,s,e,d,c,i);let I=VC(T,ws.CHOOSE_SERVER),A=VC(T,e.cloudProxyServer==="proxy5"?ws.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?ws.CLOUD_PROXY:ws.CLOUD_PROXY_FALLBACK),w=performance.getEntriesByName(s),k=w[w.length-1],L;return k&&(L={name:k.name,protocol:"nextHopProtocol"in k?k.nextHopProtocol:"",dnscost:"domainLookupEnd"in k&&"domainLookupStart"in k&&typeof k.domainLookupEnd=="number"&&typeof k.domainLookupStart=="number"?k.domainLookupEnd-k.domainLookupStart:-1,tcpTlsCost:"connectEnd"in k&&"connectStart"in k&&typeof k.connectEnd=="number"&&typeof k.connectStart=="number"?k.connectEnd-k.connectStart:-1,reqCost:"requestStart"in k&&typeof k.requestStart=="number"&&"responseEnd"in k&&typeof k.responseEnd=="number"?k.responseEnd-k.requestStart:-1,handleCost:"leave_ts"in T&&"enter_ts"in T&&typeof T.leave_ts=="number"&&typeof T.enter_ts=="number"?T.leave_ts-T.enter_ts:-1}),mP(I),{gatewayInfo:xC(I,s),proxyInfo:A,url:s,resourceTimingInfo:L}},T=>(T.gatewayInfo&&Ye.joinChooseServer(e.sid,{role:u,lts:d,succ:!0,csAddr:s,serverList:T.gatewayInfo.gatewayAddrs.map(R=>R.address),ec:null,opid:m,cid:T.gatewayInfo.cid.toString(),uid:T.gatewayInfo.uid.toString(),csIp:T.gatewayInfo.csIp,unilbsServerIds:c.toString(),isHttp3:i,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:T.gatewayInfo.res.detail&&T.gatewayInfo.res.detail[38],resourceTimingInfo:T.resourceTimingInfo?JSON.stringify(T.resourceTimingInfo):void 0}),T.proxyInfo&&Ye.joinWebProxyAP(e.sid,{lts:d,sucess:1,apServerAddr:s,turnServerAddrList:T.proxyInfo.addresses.map(R=>R.ip).join(","),errorCode:null,eventType:e.cloudProxyServer,unilbsServerIds:c.toString()}),!1),T=>T.code!==z.OPERATION_ABORTED&&(T.code===z.CAN_NOT_GET_GATEWAY_SERVER?T.data.retry:(Ye.joinWebProxyAP(e.sid,{lts:d,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:T.code,eventType:e.cloudProxyServer,unilbsServerIds:c.toString(),extend:JSON.stringify({networkState:g})}),V.warning("[".concat(e.clientId,"] multi unilbs network error, retry"),T),!0)),n)}let _F=(r,e,t,n,i,s)=>{let{sid:o,clientId:c,cloudProxyServer:d}=t,u=[],p=m=>{m.flag===4096?Ye.joinChooseServer(o,{role:t.role,lts:n,succ:!1,csAddr:e,opid:r.opid,serverList:null,ec:m.error.message,csIp:m.error.data&&m.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:s,corssRegionTagReq:t.apRequestDetail}):m.flag!==1048576&&m.flag!==4194304&&m.flag!==4194310||Ye.joinWebProxyAP(o,{lts:n,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:m.error.code,eventType:d,unilbsServerIds:i.toString()})};if(r.response_body.forEach(m=>{let g=m.buffer.code;if(m.uri===23&&g===0&&!m.buffer.edges_services)if(m.buffer.flag===4194310)V.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),m.buffer.edges_services=[];else{let T={error:new fe(z.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:r.detail[502]}),flag:m.buffer.flag};u.push(T),p(T)}if(g!==0){let T=LC(g),R={error:new fe(z.CAN_NOT_GET_GATEWAY_SERVER,T.desc,{desc:T.desc,retry:T.retry,csIp:r.detail[502]}),flag:m.buffer.flag};m.buffer.flag===4194310?V.warning(R.error.toString()):u.push(R),p(R)}}),u.length)throw V.warning("[".concat(c||"sid-".concat(o.slice(0,6)),"] multi unilbs ").concat(e," failed, ").concat(u.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message,", retry: ").concat(m.error.data.retry)).join(" | "))),new fe(z.CAN_NOT_GET_GATEWAY_SERVER,u.map(m=>"flag: ".concat(m.flag,", message: ").concat(m.error.message)).join(" | "),{retry:!!u.find(m=>m.error.data.retry),csIp:r.detail[502],desc:[...new Set(u.map(m=>{var g;return m==null||(g=m.error)===null||g===void 0||(g=g.data)===null||g===void 0?void 0:g.desc}).filter(m=>!!m))]})},mP=r=>{var e,t,n,i;if(r.addresses&&r.addresses.length===0&&r.code===0)throw new fe(z.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:r.detail&&r.detail[502]});if(te("AP_AREA")&&((n=r.detail)!==null&&n!==void 0&&n[23]&&typeof((i=r.detail)===null||i===void 0?void 0:i[23])=="string"?x4(r.detail[23].toLowerCase()):x4()),(e=r.detail)!==null&&e!==void 0&&e[19]&&typeof((t=r.detail)===null||t===void 0?void 0:t[19])=="string"){let o=r.detail[19],c=o?.split(";");for(let d=0;d<c.length;d++){var s;let u=dr(s=c[d]).call(s);r.addresses[d]&&c&&(r.addresses[d].fingerprint=u)}}if(te("GATEWAY_ADDRESS")&&te("GATEWAY_ADDRESS").length>0){V.debug("assign gateway address to",te("GATEWAY_ADDRESS"));let o=te("GATEWAY_ADDRESS").map(c=>{var d,u;let p=(d=(u=r.addresses.find(m=>m.ip===c.ip&&m.port===c.port))===null||u===void 0?void 0:u.fingerprint)!==null&&d!==void 0?d:"";return{ip:c.ip,port:c.port,ticket:r.addresses[0]&&r.addresses[0].ticket,fingerprint:p}});r.addresses=o}},mF=(r,e)=>{if(r.response_body&&r.response_body.length){let t=r.response_body[0];if(t.buffer.code!==0){let n=LC(t.buffer.code);throw new fe(z.UPDATE_TICKET_FAILED,"[".concat(t.buffer.code,"]: ").concat(n.desc),{retry:n.retry})}return t.buffer.ticket}throw V.debug("update ticket request received ap response without response body:",e),new fe(z.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},EF=(r,e,t)=>{let n=Math.floor(Math.random()*1e12),i=r.role==="host"?"1":r.role==="audience"?"2":void 0,s={appid:r.appId,client_ts:Date.now(),opid:n,sid:r.sid,request_bodies:[{uri:22,buffer:{cname:r.cname,detail:af(af(af({6:r.stringUid,11:e,12:te("USE_NEW_TOKEN")?"1":void 0},i?{17:i}:{}),{},{22:e},r.apRequestDetail?{33:r.apRequestDetail}:{}),r.apRTM?{26:"RTM2"}:{}),key:r.token,service_ids:t,uid:r.uid||0}}]};s.request_bodies.forEach(c=>{r.multiIP&&r.multiIP.gateway_ip&&(c.buffer.detail[5]=JSON.stringify({vocs_ip:[r.multiIP.uni_lbs_ip],vos_ip:[r.multiIP.gateway_ip]}))});let o=new FormData;return o.append("request",JSON.stringify(s)),[o,n]},gF=(r,e)=>{let t=Math.floor(Math.random()*1e12),n={appid:r.appId,client_ts:Date.now(),opid:t,sid:r.sid,request_bodies:[{uri:28,buffer:{cname:r.cname,detail:{1:"",6:r.stringUid,12:"1"},token:r.token,service_ids:e,uid:r.uid||0,edges_services:r.apResponse.addresses.map(s=>({ip:s.ip,port:s.port}))}}]},i=new FormData;return i.append("request",JSON.stringify(n)),[i,t]},KC=0;function cf(r){return De.all(r.map(e=>e.then(t=>{throw t},t=>t))).then(e=>{throw e},e=>e)}let I_=async r=>{let{fragementLength:e,referenceList:t,asyncMapHandler:n,allFailedhandler:i,promisesCollector:s}=r,o=0,c=e,d,u=0,p=async()=>{let m=(()=>{let g=o*c,T=g+c;return t.slice(g,T).map(n)})();s&&s.push(...m);try{d=await cf(m)}catch(g){if(u+=c,o++,!(u>=t.length))return void await p();i(g)}m.forEach(g=>g.cancel())};return await p(),d},zC=async r=>{let{referenceList:e,asyncMapHandler:t,closeFn:n}=r,i=e.length,s=0,o=async()=>{let c=t(e.shift());try{return await c}catch(d){if(s++,s>=i||n!=null&&n(d))throw d;return o()}};return o()};async function V4(){if(typeof VideoDecoder>"u")return!0;let r,e=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],t=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],n=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],i=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],s=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],o=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new De((c,d)=>{let u;(async function(){r&&r.state!=="closed"||await(async function(){r=new VideoDecoder({output:m=>{m.close(),clearTimeout(u),c(!0)},error:m=>{clearTimeout(u),c(!1)}}),await r.configure({codec:"av01.0.05M.08",width:160,height:90})})();let p=[e,t,n,i,s,o];for(let m=0;m<p.length;m++){let g=new EncodedVideoChunk({type:m==0?"key":"delta",timestamp:33333*m,duration:33333,data:new Uint8Array(p[m])});try{await r.decode(g)}catch{return void c(!1)}}})(),u=setTimeout(()=>{c(!1)},5e3)})}async function SF(r,e,t,n){return{gatewayInfo:await(async function(i,s,o,c){let d=null,u=[],p=async()=>{let g=te("WEBCS_DOMAIN").slice(0,te("AJAX_REQUEST_CONCURRENT")).map(I=>({url:i.proxyServer?"https://".concat(i.proxyServer,"/ap/?url=").concat(I+"/api/v2/transpond/webrtc?v=2"):"https://".concat(I,"/api/v2/transpond/webrtc?v=2"),areaCode:id()})),T=c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(I=>I.url)}),R=await I_({fragementLength:te("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:I=>(V.debug("[".concat(i.clientId,"] Connect to choose_server:"),I.url),_P(I,i,s,o)),allFailedhandler:I=>{throw c.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},T),I[0]},promisesCollector:u});return c.recordJoinChannelService({endTs:Date.now(),status:"success"},T),R},m=async()=>{if(await Jo(1e3),d!==null)return d;let g=te("WEBCS_DOMAIN_BACKUP_LIST").map(I=>({url:i.proxyServer?"https://".concat(i.proxyServer,"/ap/?url=").concat(I+"/api/v2/transpond/webrtc?v=2"):"https://".concat(I,"/api/v2/transpond/webrtc?v=2"),areaCode:id()})),T=c.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:g.map(I=>I.url)}),R=await I_({fragementLength:te("FRAGEMENT_LENGTH"),referenceList:g,asyncMapHandler:I=>(V.debug("[".concat(i.clientId,"] Connect to backup choose_server:"),I.url),_P(I,i,s,o)),allFailedhandler:I=>{throw c.recordJoinChannelService({endTs:Date.now(),status:"error",errors:I},T),I[0]},promisesCollector:u});return c.recordJoinChannelService({endTs:Date.now(),status:"success"},T),R};try{return d=await cf([p(),m()]),u.length&&u.forEach(g=>g.cancel&&typeof g.cancel=="function"&&g.cancel()),d}catch(g){throw g[0]}})(r,e,t,n)}}async function EP(r,e,t,n,i){let s=r.cloudProxyServer;if(s==="disabled"){if(r.useLocalAccessPoint)return await SF(r,e,t,i);if(te("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:g,proxyInfo:T}=await vF(r,e,t,i);if(r.turnServer&&r.turnServer.mode!=="auto")return{gatewayInfo:g};let R=T.map(I=>({turnServerURL:I.address,tcpport:I.tcpport||Bs.tcpport,udpport:I.udpport||Bs.udpport,username:I.username||Bs.username,password:I.password||Bs.password,forceturn:!1,security:!0}));if(i.useP2P){var o;let I=(o=r.uid)!==null&&o!==void 0?o:g.uid,A="glb:".concat(I.toString()),w=await AD(A),k=T.map(L=>({turnServerURL:L.address,tcpport:L.tcpport||Bs.tcpport,udpport:L.udpport||Bs.udpport,username:A,password:w,forceturn:!1,security:!0}));R.push(...k)}return r.turnServer={mode:"manual",servers:R},{gatewayInfo:g}}return await SF(r,e,t,i)}let{proxyInfo:c,gatewayInfo:d}=await vF(r,e,t,i),u={gatewayInfo:d},p=c.map(g=>({turnServerURL:g.address,tcpport:s==="proxy3"?void 0:g.tcpport?g.tcpport:Bs.tcpport,udpport:s==="proxy4"?void 0:g.udpport?g.udpport:Bs.udpport,username:g.username||Bs.username,password:g.password||Bs.password,forceturn:s!=="proxy4",security:s==="proxy5"}));if(i.useP2P){var m;let g=(m=r.uid)!==null&&m!==void 0?m:d.uid,T="glb:".concat(g.toString()),R=await AD(T),I=c.map(A=>({turnServerURL:A.address,tcpport:s==="proxy3"?void 0:A.tcpport||Bs.tcpport,udpport:s==="proxy4"?void 0:A.udpport||Bs.udpport,username:T,password:R,forceturn:s!=="proxy4",security:s==="proxy5"}));p.push(...I)}return r.turnServer={mode:"manual",servers:p},V.debug("[".concat(r.clientId,"] set proxy server: ").concat(r.proxyServer,", mode: ").concat(s)),u}async function TF(r,e,t,n,i){let s=te("ACCOUNT_REGISTER").slice(0,te("AJAX_REQUEST_CONCURRENT")),o=[];o=e.proxyServer?s.map(d=>"https://".concat(e.proxyServer,"/ap/?url=").concat(d+"/api/v1")):s.map(d=>"https://".concat(d,"/api/v1"));let c=i?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:o});try{let d=await(async function(u,p,m,g,T){let R=Date.now(),I={sid:m.sid,opid:10,appid:m.appId,string_uid:p},A=u[0],w=await Tu(()=>bu(A+"".concat(A.indexOf("?")===-1?"?":"&","action=stringuid"),{data:I,cancelToken:g,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(k,L)=>{if(k.code===0){if(k.uid<=0||k.uid>=Math.pow(2,32))throw V.error("Invalid Uint Uid ".concat(p," => ").concat(k.uid),k),Ye.reqUserAccount(I.sid,{lts:R,success:!1,serverAddr:A,stringUid:I.string_uid,uid:k.uid,errorCode:z.INVALID_UINT_UID_FROM_STRING_UID,extend:I}),new fe(z.INVALID_UINT_UID_FROM_STRING_UID);return Ye.reqUserAccount(I.sid,{lts:R,success:!0,serverAddr:A,stringUid:I.string_uid,uid:k.uid,errorCode:null,extend:I}),!1}let j=LC(k.code);return j.retry&&(A=u[(L+1)%u.length]),Ye.reqUserAccount(I.sid,{lts:R,success:!1,serverAddr:A,stringUid:I.string_uid,uid:k.uid,errorCode:j.desc,extend:I}),j.retry},(k,L)=>k.code!==z.OPERATION_ABORTED&&(Ye.reqUserAccount(I.sid,{lts:R,success:!1,serverAddr:A,stringUid:I.string_uid,uid:null,errorCode:k.code,extend:I}),A=u[(L+1)%u.length],!0),T);if(w.code!==0){let k=LC(w.code);throw new fe(z.UNEXPECTED_RESPONSE,k.desc)}return w})(o,r,e,t,n);return i?.recordJoinChannelService({status:"success",endTs:Date.now()},c),d.uid}catch(d){throw i?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[d]},c),d}}async function F4(r,e,t){let n=te("ACCOUNT_REGISTER"),i=[];i=e.proxyServer?n.map(s=>"https://".concat(e.proxyServer,"/ap/?url=").concat(s+"/api/v1")):n.map(s=>"https://".concat(s,"/api/v1"));try{return await zC({referenceList:i,asyncMapHandler:s=>(async function(o,c,d,u){let p=Date.now(),m={sid:d.sid,opid:10,appid:d.appId,string_uid:c};try{let g=await bu(o+"".concat(o.indexOf("?")===-1?"?":"&","action=stringuid"),{data:m,cancelToken:u,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(g.code!==0){let T=LC(g.code);throw new fe(z.UNEXPECTED_RESPONSE,"preload sua error:".concat(T.desc),T)}if(g.uid<=0||g.uid>=Math.pow(2,32))throw new fe(z.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:p,url:o,req:m,uid:g.uid,elapse:Date.now()-p}}catch(g){throw g}})(s,r,e,t),closeFn:s=>s.code===z.OPERATION_ABORTED||s.code===z.UNEXPECTED_RESPONSE&&!s.data.retry})}catch(s){throw s}}async function Zz(r,e,t){let n=te("CDS_AP").slice(0,te("AJAX_REQUEST_CONCURRENT")).map(d=>r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(d+"/api/v1"):"https://".concat(d,"/api/v1?action=config")),i=n.map(d=>(function(u,p,m,g){let T=Qn(),R={flag:64,cipher_method:0,features:af(af(af(af(af({install_id:MD(),device:T.name,system:T.os,system_general:navigator.userAgent,vendor:p.appId,version:Yl,cname:p.cname,session_id:p.sid,proxyServer:p.proxyServer,sdk_type:Qz.WEB_RTC,browser_name:T.name,browser_version:T.version,user_agent:navigator.userAgent,channel_name:p.cname},p.stringUid&&{string_uid:p.stringUid}),p.uid&&{uid:p.uid+""}),T.os&&{os_name:T.os}),T.osVersion&&{os_version:T.osVersion}),{},{detail:""})};return Tu(()=>bu(u,{data:R,timeout:1e3,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,I=>I.code!==z.OPERATION_ABORTED,g)})(d,r,e,t)),s=null,o=null,c={};try{s=await cf(i)}catch(d){if(d.code===z.OPERATION_ABORTED)throw d;o=d}if(i.forEach(d=>d.cancel()),Ye.reportApiInvoke(r.sid,{name:Zr.REQUEST_CONFIG_DISTRIBUTE,options:{error:o,res:s}}).onSuccess(),s&&s.test_tags)try{c=(function(d){if(!d.test_tags)return{};let u=d.test_tags,p=Object.keys(u),m={};return p.forEach(g=>{var T;let R=dr(T=g.slice(4)).call(T),I=JSON.parse(u[g]),A=I[1];m[R]={tag:I[0]||"",value:A}}),m})(s)}catch{}return c}async function B4(r,e){let t=te("WEBCS_DOMAIN").concat(te("WEBCS_DOMAIN_BACKUP_LIST")).map(n=>({url:"https://".concat(n,"/api/v2/transpond/webrtc?v=2"),areaCode:id(),serviceIds:[ws.CHOOSE_SERVER,ws.CLOUD_PROXY_FALLBACK]}));try{return await zC({referenceList:t,asyncMapHandler:n=>(async function(i,s,o){let c,{url:d,areaCode:u,serviceIds:p}=i,m=Date.now(),[g,T]=EF(s,u,p),R=Kr.networkState;try{R&&Kr.networkState===vr.OFFLINE&&Kr.onlineWaiter&&await De.race([Kr.onlineWaiter,Jo(zr.maxRetryTimeout)]),R=Kr.networkState;let{data:I,headers:A}=await bu(d,{data:g,cancelToken:o,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=A.http3==="1"?1:-1,(L=>{let j=[];if(L.response_body.forEach(K=>{let W=K.buffer.code;if(K.uri===23&&W===0&&!K.buffer.edges_services)if(K.buffer.flag===4194310)K.buffer.edges_services=[];else{let Y={error:new fe(z.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:L.detail[502]}),flag:K.buffer.flag};j.push(Y)}if(W!==0){let Y=LC(W),se={error:new fe(z.CAN_NOT_GET_GATEWAY_SERVER,Y.desc,{desc:Y.desc,retry:Y.retry,csIp:L.detail[502]}),flag:K.buffer.flag};K.buffer.flag===4194310?V.warning(se.error.toString()):j.push(se)}}),j.length)throw new fe(z.CAN_NOT_GET_GATEWAY_SERVER,j.map(K=>"flag: ".concat(K.flag,", message: ").concat(K.error.message)).join(" | "),{retry:!!j.find(K=>K.error.data.retry),csIp:L.detail[502],desc:[...new Set(j.map(K=>{var W;return K==null||(W=K.error)===null||W===void 0||(W=W.data)===null||W===void 0?void 0:W.desc}).filter(K=>!!K))]})})(I);let w=VC(I,ws.CHOOSE_SERVER),k=VC(I,ws.CLOUD_PROXY_FALLBACK);return mP(w),{gatewayInfo:xC(w,d),proxyInfo:k,opid:T,requestTime:m,url:d,isHttp3:c,elapse:Date.now()-m}}catch(I){throw I}})(n,r,e),closeFn:n=>n.code===z.OPERATION_ABORTED||n.code===z.CAN_NOT_GET_GATEWAY_SERVER&&!n.data.retry})}catch(n){throw n}}async function vF(r,e,t,n){let i=te("PROXY_SERVER_TYPE3"),s=(T,R,I)=>{let A=I||i;return Array.isArray(A)&&(A=R%2==0&&i[1]||i[0]),"https://".concat(A,"/ap/?url=").concat(T)},o=null,c=[],d=async()=>{let T=te("WEBCS_DOMAIN").slice(0,te("AJAX_REQUEST_CONCURRENT")).map((A,w)=>{let k;return k=r.cloudProxyServer==="disabled"&&r.proxyServer?s("".concat(A,"/api/v2/transpond/webrtc?v=2"),w,r.proxyServer):r.cloudProxyServer==="disabled"||r.cloudProxyServer==="fallback"?"https://".concat(A,"/api/v2/transpond/webrtc?v=2"):s("".concat(A,"/api/v2/transpond/webrtc?v=2"),w),{url:k,areaCode:id(),serviceIds:[ws.CHOOSE_SERVER,r.cloudProxyServer==="proxy5"?ws.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?ws.CLOUD_PROXY:ws.CLOUD_PROXY_FALLBACK]}}),R=n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(A=>A.url)}),I=await I_({fragementLength:te("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:A=>(V.debug("[".concat(r.clientId,"] Connect to choose_server:"),A.url),fF(A,r,e,t)),allFailedhandler:A=>{throw n.recordJoinChannelService({endTs:Date.now(),status:"error",errors:A},R),A[0]},promisesCollector:c});return n.recordJoinChannelService({endTs:Date.now(),status:"success"},R),I},u=async()=>{if(await Jo(1e3),o!==null)return o;let T=te("WEBCS_DOMAIN_BACKUP_LIST").map((A,w)=>{let k;return k=r.cloudProxyServer==="disabled"&&r.proxyServer?s("".concat(A,"/api/v2/transpond/webrtc?v=2"),w,r.proxyServer):r.cloudProxyServer==="disabled"||r.cloudProxyServer==="fallback"?"https://".concat(A,"/api/v2/transpond/webrtc?v=2"):s("".concat(A,"/api/v2/transpond/webrtc?v=2"),w),{url:k,areaCode:id(),serviceIds:[ws.CHOOSE_SERVER,r.cloudProxyServer==="proxy5"?ws.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?ws.CLOUD_PROXY:ws.CLOUD_PROXY_FALLBACK]}}),R=n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:T.map(A=>A.url)}),I=await I_({fragementLength:te("FRAGEMENT_LENGTH"),referenceList:T,asyncMapHandler:A=>(V.debug("[".concat(r.clientId,"] Connect to backup choose_server:"),A.url),fF(A,r,e,t)),allFailedhandler:A=>{throw n.recordJoinChannelService({endTs:Date.now(),status:"error",errors:A},R),A[0]},promisesCollector:c});return n.recordJoinChannelService({endTs:Date.now(),status:"success"},R),I},p,m,g;try{({gatewayInfo:p,proxyInfo:m,url:g}=await cf([d(),u()]))}catch(T){throw T[0]}if(c.length&&c.forEach(T=>T.cancel&&typeof T.cancel=="function"&&T.cancel()),!p||!m)throw new fe(z.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(r.apUrl=g,r.cloudProxyServer!=="disabled"&&Array.isArray(i)&&g){let T=/^https?:\/\/(.+?)(\/.*)?$/.exec(g)[1];Re(i).call(i,T)&&(r.proxyServer=T,V.setProxyServer(T),Ye.setProxyServer(T))}return o={gatewayInfo:p,proxyInfo:await FC(m,p.uid)},o}async function j4(r,e,t){let n=te("UAP_AP").slice(0,te("AJAX_REQUEST_CONCURRENT")).map(s=>r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(s+"/api/v1?action=uap"):"https://".concat(s,"/api/v1?action=uap")),i=n.map(s=>(function(o,c,d,u){let p={command:"convergeAllocateEdge",sid:c.sid,appId:c.appId,token:c.token,ts:Date.now(),version:Yl,cname:c.cname,uid:c.uid.toString(),requestId:pF,seq:pF};pF+=1;let m={service_name:"tele_channel",json_body:JSON.stringify(p)};return Tu(async()=>{let g=await bu(o,{data:m,cancelToken:d,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(g.code!==0){let R=new fe(z.UNEXPECTED_RESPONSE,"cross channel ap error, code"+g.code,{retry:!0});throw V.error(R.toString()),R}let T=JSON.parse(g.json_body);if(T.code!==200){let R=new fe(z.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(T.code,", reason: ").concat(T.reason));throw V.error(R.toString()),R}if(!T.servers||T.servers.length===0){let R=new fe(z.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw V.error(R.toString()),R}return{vid:T.vid,workerToken:T.workerToken,addressList:(te("CHANNEL_MEDIA_RELAY_SERVERS")||T.servers).map(R=>"wss://".concat(R.address.replace(/\./g,"-"),".").concat(te("WORKER_DOMAIN"),":").concat(R.wss))}},void 0,g=>!!(g.code!==z.OPERATION_ABORTED&&g.code!==z.UNEXPECTED_RESPONSE||g.data&&g.data.retry),u)})(s,r,e,t));try{let s=await cf(i);return i.forEach(o=>o.cancel()),s}catch(s){throw s[0]}}async function $z(r,e,t){let n=null,i=[],s=async o=>{let c=te(o?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(d=>r.proxyServer?"https://".concat(r.proxyServer,"/ap/?url=").concat(d+"/api/v2/transpond/webrtc?v=2"):"https://".concat(d,"/api/v2/transpond/webrtc?v=2"));return o&&(await Jo(1e3),n!==null)?n:await I_({fragementLength:te("FRAGEMENT_LENGTH"),referenceList:c,asyncMapHandler:d=>(V.debug("[".concat(r.clientId,"] update ticket, Connect to ").concat(o?"backup":""," choose_server:"),d),(function(u,p,m,g){let[T]=gF(p,[ws.CHOOSE_SERVER]),R=Kr.networkState;return Tu(async()=>{R&&Kr.networkState===vr.OFFLINE&&Kr.onlineWaiter&&await De.race([Kr.onlineWaiter,Jo(g&&g.maxRetryTimeout||zr.maxRetryTimeout)]),R=Kr.networkState;let I=await bu(u,{data:T,cancelToken:m,headers:{"Content-Type":"multipart/form-data;"}},!0);return mF(I,u)},()=>!1,I=>I.code!==z.OPERATION_ABORTED&&(I.code===z.UPDATE_TICKET_FAILED?I.data.retry:(V.warning("[".concat(p.clientId,"] update ticket network error, retry"),I),!0)),g)})(d,r,e,t)),allFailedhandler:d=>{throw d[0]},promisesCollector:i})};try{return n=await cf([s(!1),s(!0)]),i.length&&i.forEach(o=>o.cancel&&typeof o.cancel=="function"&&o.cancel()),n}catch(o){throw o[0]}}function G4(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function gP(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?G4(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):G4(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}class yF extends Sr{get isSuccess(){return!!this.configs}constructor(e,t){super(),Z(this,"configs",void 0),Z(this,"store",void 0),Z(this,"joinInfo",void 0),Z(this,"cancelToken",void 0),Z(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),Z(this,"interval",void 0),Z(this,"mutex",void 0),Z(this,"mutableParamsRead",!1),Z(this,"configCache",{}),Z(this,"limit_bitrate",void 0),this.mutex=new ha("config-distribute",e),this.store=t}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),te("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},te("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Ye.reportApiInvoke(null,{options:void 0,name:Zr.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Cn.TRACER}).onSuccess(JSON.stringify(Eh))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void V.debug("[config-distribute] get config distribute interrupted have no joininfo");let e,t=await this.mutex.lock();try{e=await Zz(this.joinInfo,this.cancelToken,this.retryConfig),V.debug("[config-distribute] get config distribute",JSON.stringify(e));let n=(function(i){var s;let o=Zt(s=Object.keys(i).filter(u=>/^webrtc_ng_global_parameter/.test(u))).call(s);for(let u=0;u<o.length;u++)for(let p=o.length-1;p>u;p--){let m=o[p],g=i[m].value;if(typeof g.__priority=="number"){let T=g.__priority,R=o[p-1],I=i[R].value;if(typeof I.__priority=="number"){if(!(T>I.__priority))continue;{let A=m;o[p]=o[p-1],o[p-1]=A}}else{let A=m;o[p]=o[p-1],o[p-1]=A}}}let c=Date.now(),d={};return o.forEach(u=>{let p=i[u].value.__expires;p&&p<=c||(d[u]=i[u])}),d})(e);this.cacheGlobalParameterConfig(n),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=n}catch(n){let i=new fe(z.NETWORK_RESPONSE_ERROR,n);V.warning("[config-distribute] ".concat(i.toString()))}finally{t()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(e){kC(e)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==e.id&&this.emit(Xg.UPDATE_BITRATE_LIMIT,e):this.emit(Xg.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.limit_bitrate&&gP({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(e){try{let t={},n=Object.keys(e),i=[];n.forEach(s=>{let o=e[s].value;t[s]=o;let c=o.__id;if(c&&this.configCache[s]&&this.configCache[s].__id===c)return;let d=o.__type,u=e[s].value,p=e[s].tag,m=0;d?d===re.REALTIME&&(m=1):Object.keys(u).some(g=>Object.prototype.hasOwnProperty.call(Nw,g)||!Gm()&&Object.prototype.hasOwnProperty.call(go,g)?(m=1,!0):void 0),i.push({tag:p,isApplied:m,feature:s,params:JSON.stringify(o)})}),i.forEach(s=>{let{tag:o,feature:c,params:d,isApplied:u}=s;this.store.sessionId&&Ye.abTest(this.store.sessionId,{intSucc:1,isApplied:u,tag:o,feature:c,params:d,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=t}catch(t){V.debug("handleABTestConfigDistribute error",t)}}cacheGlobalParameterConfig(e){let t=(function(i){let s={};return Object.keys(i).forEach(o=>{let c=i[o].value,d=c.__expires,u=c.__type;Object.keys(c).forEach(p=>{p==="__id"||p==="__type"||p==="__priority"||p==="__expires"||Object.prototype.hasOwnProperty.call(s,p)||(s[p]=gP(gP({value:c[p]},d&&{expires:d}),u&&{type:u}))})}),s})(e);try{var n;let i=(n=t.LIMIT_BITRATE)===null||n===void 0?void 0:n.value;delete t.LIMIT_BITRATE,i&&kC(i)&&this.handleBitrateLimit(i),this.limit_bitrate=i,this.handleGlobalParameterConfig(t),this.handleABTestConfigDistribute(e),(function(c){try{let d=Date.now();Object.keys(c).forEach(u=>{let{value:p,type:m,expires:g}=c[u];g&&g<=d||((m===re.REALTIME||Object.prototype.hasOwnProperty.call(Nw,u))&&(Eh[u]=p,or[u]=p,V.debug("Update realtime parameters from config distribute",u,p)),m||Gm()||!Object.prototype.hasOwnProperty.call(go,u)||(Eh[u]=p,or[u]=p,V.debug("Update gateway parameters from config distribute",u,p)))})}catch(d){V.error("Error update config immediately: ".concat(c),d.message)}})(t);let s=JSON.stringify(t),o=window.btoa(s);window.localStorage.setItem("websdk_ng_global_parameter",o),V.debug("Caching global parameters ".concat(s))}catch(i){V.error("Error caching global parameters:",i.message)}}handleGlobalParameterConfig(e){try{let t=Date.now();Object.keys(e).forEach(n=>{if(n==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(or,n)){let{value:i,expires:s}=e[n];if(s&&s<=t)return;(function(o,c){try{return typeof o=="object"&&typeof c=="object"&&JSON.stringify(o)===JSON.stringify(c)}catch{return!1}})(or[n],i)||(Eh[n]=i,or[n]=i,this.emit(Xg.UPDATE_CLIENT_ROLE_OPTIONS,i),V.debug("Updating client role options: ".concat(JSON.stringify(i))))}})}catch(t){V.error("Error handling global parameter config:",t.message)}}}class eY extends Sr{constructor(){super(...arguments),Z(this,"resultStorage",new Map)}setLocalAudioStats(e,t,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(n,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(n,t))}setLocalVideoStats(e,t,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(n,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(n,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(n)),!t.muted&&this.record("VIDEO_ENCODE_FAILED",e,this.checResolutionSent(n))}setRemoteAudioStats(e,t){let n=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){let n=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(t))}record(e,t,n){if(te("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});let i=this.resultStorage.get(e);if(!i)return;i.result.push(n);let s=e==="VIDEO_ENCODE_FAILED"?te("ENCODE_EXCEPTION_TIMES"):5;if(i.result.length>=s){var o;let c=Re(o=i.result).call(o,!0);i.isPrevNormal&&!c&&this.emit("exception",RF[e],e,t),!i.isPrevNormal&&c&&this.emit("exception",RF[e]+2e3,e+"_RECOVER",t),i.isPrevNormal=c,i.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,t){return t instanceof Xs&&!t.isActive||!!t.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,t){let n=null;t._encoderConfig&&t._encoderConfig.frameRate&&(n=zc(t._encoderConfig.frameRate));let i=e.captureFrameRate;return!n||!i||!(n>10&&i<5||n<10&&n>=5&&i<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checResolutionSent(e){var t;return!(!e.codecType||Re(t=te("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(t,e.codecType.toLocaleLowerCase()))||!e.captureFrameRate||e.sendFrameRate!==0||e.sendResolutionWidth!==0||e.sendResolutionHeight!==0}checkSendVideoBitrate(e,t){return!!t.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,t){return t instanceof Xs&&!t.isActive||!!t.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}}let RF={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},ta=new class{markSubscribeStart(r,e){performance.mark("agora-web-sdk/".concat(r,"/subscribe-").concat(e))}markPublishStart(r,e){performance.mark("agora-web-sdk/".concat(r,"/publish-").concat(e))}measureFromSubscribeStart(r,e){let t=performance.getEntriesByName("agora-web-sdk/".concat(r,"/subscribe-").concat(e));if(t.length>0){let n=t[t.length-1];return Math.round(performance.now()-n.startTime)}return 0}measureFromPublishStart(r,e){let t=performance.getEntriesByName("agora-web-sdk/".concat(r,"/publish-").concat(e));if(t.length>0){let n=t[t.length-1];return Math.round(performance.now()-n.startTime)}return 0}};function ma(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Zg(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ma(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ma(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}class lf{constructor(e){Z(this,"store",void 0),Z(this,"onStatsException",void 0),Z(this,"onUploadPublishDuration",void 0),Z(this,"onStatsChanged",void 0),Z(this,"onVideoCodecChanged",void 0),Z(this,"localStats",new Map),Z(this,"remoteStats",new Map),Z(this,"updateStatsInterval",void 0),Z(this,"trafficStats",void 0),Z(this,"trafficStatsPeerList",[]),Z(this,"uplinkStats",void 0),Z(this,"exceptionMonitor",void 0),Z(this,"p2pChannel",void 0),Z(this,"scalabilityMode",Gg.L1T1),Z(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new eY,this.exceptionMonitor.on("exception",(t,n,i)=>{this.onStatsException&&this.onStatsException(t,n,i)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get($e.LocalAudioTrack)||Zg({},fl)}getLocalVideoTrackStats(){return this.localStats.get($e.LocalVideoTrack)||Zg({},Pw)}getRemoteAudioTrackStats(e){let t=(s,o)=>{if(!this.trafficStats)return o;let c=this.trafficStats.peer_delay.find(d=>d.peer_uid===s);return c&&(o.publishDuration=c.B_ppad+(Date.now()-this.trafficStats.timestamp)),o},n={};if(e){var i;let s=(i=this.remoteStats.get(e))===null||i===void 0?void 0:i.audioStats;s&&(n[e]=t(e,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[o,{audioStats:c}]=s;c&&(n[o]=t(o,c))});return n}getRemoteNetworkQualityStats(e){let t={};if(e){var n;let i=(n=this.remoteStats.get(e))===null||n===void 0?void 0:n.networkStats;i&&(t[e]=i)}else Array.from(this.remoteStats.entries()).forEach(i=>{let[s,{networkStats:o}]=i;o&&(t[s]=o)});return t}getRemoteVideoTrackStats(e){let t=(s,o)=>{if(!this.trafficStats)return o;let c=this.trafficStats.peer_delay.find(d=>d.peer_uid===s);return c&&(o.publishDuration=c.B_ppvd+(Date.now()-this.trafficStats.timestamp)),o},n={};if(e){var i;let s=(i=this.remoteStats.get(e))===null||i===void 0?void 0:i.videoStats;s&&(n[e]=t(e,s))}else Array.from(this.remoteStats.entries()).forEach(s=>{let[o,{videoStats:c}]=s;c&&(n[o]=t(o,c))});return n}getRTCStats(){let e=0,t=0,n=0,i=0,s=this.localStats.get($e.LocalAudioTrack);s&&(e+=s.sendBytes,t+=s.sendBitrate);let o=this.localStats.get($e.LocalVideoTrack);o&&(e+=o.sendBytes,t+=o.sendBitrate);let c=this.localStats.get($e.LocalVideoLowTrack);c&&(e+=c.sendBytes,t+=c.sendBitrate),this.remoteStats.forEach(u=>{let{audioStats:p,videoStats:m}=u;p&&(n+=p.receiveBytes,i+=p.receiveBitrate),m&&(n+=m.receiveBytes,i+=m.receiveBitrate)});let d=1;return this.trafficStats&&(d+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:d,SendBitrate:t,SendBytes:e,RecvBytes:n,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(t=>t.B_ppad!==void 0||t.B_ppvd!==void 0),e.peer_delay.filter(t=>this.trafficStatsPeerList.indexOf(t.peer_uid)===-1).forEach(t=>{var n;let i=(n=this.p2pChannel)===null||n===void 0?void 0:n.getRemoteMedia(t.peer_uid),s=i!=null&&i.videoSSRC?ta.measureFromSubscribeStart(this.store.clientId,i.videoSSRC):0,o=i!=null&&i.audioSSRC?ta.measureFromSubscribeStart(this.store.clientId,i.audioSSRC):0;t.B_ppad!==void 0&&t.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(t.peer_uid,t.B_ppad,t.B_ppvd,s>o?s:o),this.trafficStatsPeerList.push(t.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&V.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,t,n){if(!e)return!1;let i=!!n&&t.framesDecodeFreezeTime>n.framesDecodeFreezeTime,s=!n||t.framesDecodeCount>n.framesDecodeCount;return i||!s}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(t=>{let[n,i]=t;switch(n){case $e.LocalVideoTrack:case $e.LocalVideoLowTrack:{let c=i,d=Zg({},Pw),u=e.getStats(),p=e.getLocalMedia(n);if(u){let m=u.videoSend.find(g=>g.ssrc===p?.ssrcs[0].ssrcId);if(m){let g=e.getLocalVideoSize(),T=e.getEncoderConfig($e.LocalVideoTrack);var s;(m.codec==="H264"||m.codec==="H265"||m.codec==="VP8"||m.codec==="VP9"||m.codec==="AV1X"||m.codec==="AV1")&&(d.codecType=m.codec,c?.codecType!==m.codec&&((s=this.onVideoCodecChanged)===null||s===void 0||s.call(this,m.codec.toLocaleLowerCase()))),d.sendBytes=m.bytes,d.sendBitrate=c?8*Math.max(0,d.sendBytes-c.sendBytes):0,m.inputFrame?(d.captureFrameRate=m.inputFrame.frameRate,d.captureResolutionHeight=m.inputFrame.height,d.captureResolutionWidth=m.inputFrame.width):g&&(d.captureResolutionWidth=g.width,d.captureResolutionHeight=g.height),m.sentFrame?(d.sendFrameRate=m.sentFrame.frameRate,d.sendResolutionHeight=m.sentFrame.height,d.sendResolutionWidth=m.sentFrame.width):g&&(d.sendResolutionWidth=g.width,d.sendResolutionHeight=g.height),m.avgEncodeMs&&(d.encodeDelay=m.avgEncodeMs),T&&T.bitrateMax?d.targetSendBitrate=1e3*T.bitrateMax:m.targetBitrate&&(d.targetSendBitrate=m.targetBitrate),d.sendPackets=m.packets,d.sendPacketsLost=m.packetsLost,d.sendJitterMs=m.jitterMs,d.sendRttMs=m.rttMs,d.totalDuration=c?c.totalDuration+1:1,d.totalFreezeTime=c?c.totalFreezeTime:0,this.isLocalVideoFreeze(m)&&(d.totalFreezeTime+=1),m.scalabilityMode&&this.scalabilityMode!==m.scalabilityMode&&(V.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(m.scalabilityMode)),this.scalabilityMode=m.scalabilityMode)}this.trafficStats&&(d.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var o;this.localStats.set(n,d),(c?.sendResolutionWidth!==d.sendResolutionWidth||c?.sendResolutionHeight!==d.sendResolutionHeight)&&((o=this.onStatsChanged)===null||o===void 0||o.call(this,"resolution",{width:d.sendResolutionWidth,height:d.sendResolutionHeight})),d&&p&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,p.track,d);break}case $e.LocalAudioTrack:{let c=i,d=Zg({},fl),u=e.getStats(),p=e.getLocalMedia(n);if(u){let m=u.audioSend.find(g=>g.ssrc===p?.ssrcs[0].ssrcId);if(m){if(m.codec!=="opus"&&m.codec!=="aac"&&m.codec!=="PCMU"&&m.codec!=="PCMA"&&m.codec!=="G722"||(d.codecType=m.codec),m.inputLevel)d.sendVolumeLevel=Math.round(32767*m.inputLevel);else{let g=e.getLocalAudioVolume();g&&(d.sendVolumeLevel=Math.round(32767*g))}d.sendBytes=m.bytes,d.sendPackets=m.packets,d.sendPacketsLost=m.packetsLost,d.sendJitterMs=m.jitterMs,d.sendRttMs=m.rttMs,d.sendBitrate=c?8*Math.max(0,d.sendBytes-c.sendBytes):0}}this.trafficStats&&(d.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set($e.LocalAudioTrack,d),d&&p&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,p.track,d);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(t=>{var n,i;let[s,{videoStats:o,audioStats:c,videoPcStats:d}]=t,u=c,p=o,m=d,g=Zg({},BD),T=Zg({},p4),R=Zg({},h4),{audioTrack:I,videoTrack:A,audioSSRC:w,videoSSRC:k}=e.getRemoteMedia(s),L;L=this.store.useP2P?e.getStats(!0):e.getStats();let j=(n=L)===null||n===void 0?void 0:n.audioRecv.find(se=>se.ssrc===w),K=(i=L)===null||i===void 0?void 0:i.videoRecv.find(se=>se.ssrc===k),W=this.trafficStats&&this.trafficStats.peer_delay.find(se=>se.peer_uid===s);if(j&&(j.codec!=="opus"&&j.codec!=="aac"&&j.codec!=="PCMU"&&j.codec!=="PCMA"&&j.codec!=="G722"||(g.codecType=j.codec),j.outputLevel?g.receiveLevel=Math.round(32767*j.outputLevel):I&&(g.receiveLevel=Math.round(32767*I.getVolumeLevel())),g.receiveBytes=j.bytes,g.receivePackets=j.packets,g.receivePacketsLost=j.packetsLost,g.receivePacketsDiscarded=j.packetsDiscarded,g.packetLossRate=g.receivePacketsLost/(g.receivePackets+g.receivePacketsLost),g.receiveBitrate=u?8*Math.max(0,g.receiveBytes-u.receiveBytes):0,g.totalDuration=u?u.totalDuration+1:1,g.totalFreezeTime=u?u.totalFreezeTime:0,g.freezeRate=g.totalFreezeTime/g.totalDuration,g.receiveDelay=j.jitterBufferMs,g.totalDuration>10&&lf.isRemoteAudioFreeze(I)&&(g.totalFreezeTime+=1)),K){var Y;K.codec!=="H264"&&K.codec!=="H265"&&K.codec!=="VP8"&&K.codec!=="VP9"&&K.codec!=="AV1X"&&K.codec!=="AV1"||(T.codecType=K.codec),T.receiveBytes=K.bytes,T.receiveBitrate=p?8*Math.max(0,T.receiveBytes-p.receiveBytes):0,T.decodeFrameRate=K.decodeFrameRate<0?0:K.decodeFrameRate,T.renderFrameRate=K.decodeFrameRate<0?0:K.decodeFrameRate,K.outputFrame&&(T.renderFrameRate=K.outputFrame.frameRate),K.receivedFrame?(T.receiveFrameRate=K.receivedFrame.frameRate,T.receiveResolutionHeight=K.receivedFrame.height,T.receiveResolutionWidth=K.receivedFrame.width):A&&(T.receiveResolutionHeight=A._videoHeight||0,T.receiveResolutionWidth=A._videoWidth||0),K.framesRateFirefox!==void 0&&(T.receiveFrameRate=Math.round(K.framesRateFirefox)),T.receivePackets=K.packets,T.receivePacketsLost=K.packetsLost,T.packetLossRate=T.receivePacketsLost/(T.receivePackets+T.receivePacketsLost);let se=p?p.totalFreezeTime:0,de=p?p.totalDuration:0;T.totalDuration=p?p.totalDuration+1:1,T.totalFreezeTime=(Y=K.totalFreezesDuration)!==null&&Y!==void 0?Y:se||0,T.receiveDelay=K.jitterBufferMs||0;let ge=!!k&&e.getRemoteVideoIsReady(k);K.totalFreezesDuration===void 0&&A&&ge&&lf.isRemoteVideoFreeze(A,K,m)&&(T.totalFreezeTime+=1),T.freezeRate=Math.max(0,Math.min((T.totalFreezeTime-se)/(T.totalDuration-de),1))}W&&(g.end2EndDelay=W.B_ad,T.end2EndDelay=W.B_vd,g.transportDelay=W.B_ed,T.transportDelay=W.B_ed,g.currentPacketLossRate=W.B_ealr4/100,T.currentPacketLossRate=W.B_evlr4/100,R.uplinkNetworkQuality=W.B_punq?W.B_punq:0,R.downlinkNetworkQuality=W.B_pdnq?W.B_pdnq:0),this.remoteStats.set(s,{audioStats:g,videoStats:T,videoPcStats:K,networkStats:R}),I&&this.exceptionMonitor.setRemoteAudioStats(I,g),A&&this.exceptionMonitor.setRemoteVideoStats(A,T)})}}class YC{constructor(){Z(this,"destChannelMediaInfos",new Map),Z(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){Gs(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){Gs(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){cn(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function CF(r){if(!(r instanceof YC))return new fe(z.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let e=r.getSrcChannelMediaInfo(),t=r.getDestChannelMediaInfo();if(!e)return new fe(z.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(t.size===0)return new fe(z.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class Xm{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,t){Z(this,"uid",void 0),Z(this,"_uintid",void 0),Z(this,"_trust_in_room_",!0),Z(this,"_trust_audio_enabled_state_",!0),Z(this,"_trust_video_enabled_state_",!0),Z(this,"_trust_audio_mute_state_",!0),Z(this,"_trust_video_mute_state_",!0),Z(this,"_audio_muted_",!1),Z(this,"_video_muted_",!1),Z(this,"_audio_enabled_",!0),Z(this,"_video_enabled_",!0),Z(this,"_audio_added_",!1),Z(this,"_video_added_",!1),Z(this,"_is_pre_created",!1),Z(this,"_video_pre_subscribed",!1),Z(this,"_audio_pre_subscribed",!1),Z(this,"_trust_video_stream_added_state_",!0),Z(this,"_trust_audio_stream_added_state_",!0),Z(this,"_audioTrack",void 0),Z(this,"_videoTrack",void 0),Z(this,"_dataChannels",[]),Z(this,"_audioSSRC",void 0),Z(this,"_videoSSRC",void 0),Z(this,"_audioOrtc",void 0),Z(this,"_videoOrtc",void 0),Z(this,"_cname",void 0),Z(this,"_rtxSsrcId",void 0),Z(this,"_videoMid",void 0),Z(this,"_audioMid",void 0),this.uid=e,this._uintid=t}}function Jm(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function SP(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Jm(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Jm(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}let qC="9",XC=2e4,JC=4e4;function o0(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function A_(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?o0(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):o0(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}var Fd=(function(r){return r[r.DOWN=0]="DOWN",r[r.UP=1]="UP",r})(Fd||{});let Qm=new Map;function a0(r,e,t,n){let{scale:i}=r;if(i===0&&n===Fd.UP||i>=e.length-1&&n===Fd.DOWN)return r;let s=A_(A_({},r),{},{scale:n===Fd.DOWN?++i:--i});switch(t){case"maintain-framerate":s=A_(A_({},s),e[i].motion);break;case"maintain-resolution":s=A_(A_({},s),e[i].detail);break;case"balanced":s=A_(A_({},s),e[i].balanced)}return s}function bF(r,e){if(e){let t={overUse:0,underUse:0,adaptationList:IF(e)};Qm.set(r,t)}else Qm.delete(r)}function IF(r){let e=A_({},r),{bitrateMax:t,frameRate:n,scaleResolutionDownBy:i,bitrateMin:s}=e,{MIN_FRAME_RATE:o,MAX_THRESHOLD_FRAMERATE:c,MAX_SCALE:d,BITRATE_MIN_THRESHOLD:u,BITRATE_MAX_THRESHOLD:p,BWE_SCALE_UP_THRESHOLD:m,BWE_SCALE_DOWN_THRESHOLD:g,PERF_SCALE_DOWN_THRESHOLD:T,PERF_SCALE_UP_THRESHOLD:R,BALANCE_BITRATE_FACTOR:I,BALANCE_FRAMERATE_FACTOR:A,BALANCE_RESOLUTION_FACTOR:w,MOTION_RESOLUTION_FACTOR:k,MOTION_BITRATE_FACTOR:L,DETAIL_FRAMERATE_FACTOR:j,DETAIL_BITRATE_FACTOR:K}=TC,W=Math.min(e.frameRate,c),Y=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(g,1)*t),bwe_up:t,fps_down:Math.round(Math.pow(T,1)*W),fps_up:n},balanced:{scaleResolutionDownBy:1,frameRate:n,bitrateMax:t,bitrateMin:s},motion:{scaleResolutionDownBy:1,frameRate:n,bitrateMax:t,bitrateMin:s},detail:{scaleResolutionDownBy:1,frameRate:n,bitrateMax:t,bitrateMin:s}}];for(let se=1;se<=d;se++){let de={bwe_up:Math.round(Math.pow(m,se)*t),bwe_down:Math.round(Math.pow(g,se+1)*t),fps_up:Math.round(Math.pow(R,se)*W),fps_down:Math.round(Math.pow(T,se+1)*W)},ge={scaleResolutionDownBy:i/Math.pow(w,se),frameRate:Math.max(Math.round(Math.pow(A,se)*n),o),bitrateMax:Math.max(Math.round(Math.pow(I,se)*t),p),bitrateMin:Math.max(Math.round(Math.pow(I,se)*s),u)},je={scaleResolutionDownBy:i/Math.pow(k,se),frameRate:n,bitrateMax:Math.max(Math.round(Math.pow(L,se)*t),p),bitrateMin:Math.max(Math.round(Math.pow(L,se)*s),u)},_t={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(j,se)*n),o),bitrateMax:Math.max(Math.round(Math.pow(K,se)*t),p),bitrateMin:Math.max(Math.round(Math.pow(K,se)*s),u)};Y.push({scale:se,threshold:de,balanced:ge,motion:je,detail:_t})}return Y}function W4(r,e,t,n,i,s){let o=Qm.get(r)||{overUse:0,underUse:0,adaptationList:IF(i)},{adaptationList:c}=o;Qm.set(r,o);let{OVERUSE_TIMES_THRESHOLD:d,UNDERUSE_TIMES_THRESHOLD:u}=TC,{scale:p}=n,m,g;return typeof e=="number"&&e>0&&(function(T,R,I,A){if(R>=I.length)return!1;let{threshold:{fps_down:w}}=I[R];return te("FORCE_AG_HIGH_FRAMERATE")&&A==="maintain-framerate"&&(w=I[0].threshold.fps_down),T<w})(e,p,c,s)&&(o.overUse++,g=ww.CPU,o.overUse>d)||typeof t=="number"&&t>0&&(function(T,R,I){if(R>=I.length)return!1;let{threshold:{bwe_down:A}}=I[R];return T<A})(t,p,c)&&(o.overUse++,g=ww.BANDWIDTH,o.overUse>d)?(o.overUse=0,o.underUse=0,m=a0(n,c,s,Fd.DOWN),[m,g]):(typeof e=="number"&&e>0&&typeof t=="number"&&t>0&&(function(T,R,I,A){if(R===0)return;let{threshold:{fps_up:w}}=I[R];return te("FORCE_AG_HIGH_FRAMERATE")&&A==="maintain-framerate"&&(w=I[1].threshold.fps_up),T>w})(e,p,c,s)&&(function(T,R,I){if(R===0)return;let{threshold:{bwe_up:A}}=I[R];return T>A})(t,p,c)&&(o.underUse++,o.underUse>u&&(o.overUse=0,o.underUse=0,m=a0(n,c,s,Fd.UP),m.scale===0&&(g=ww.NONE))),[m,g])}function H4(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function TP(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?H4(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):H4(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}let QC=new Map;function Pv(r,e){let t=QC.get(r);if(t){let{timer:n}=t;window.clearTimeout(n),QC.delete(r)}e.qualityLimitationReason=ww.NONE,bF(r)}function vP(r,e){var t;let n;switch(e){case $e.LocalAudioTrack:n=vi.Audio;break;case $e.LocalVideoTrack:n=Re(t=r._hints).call(t,rt.SCREEN_TRACK)?vi.Screen:vi.High;break;case $e.LocalVideoLowTrack:n=vi.Low}return n}function AF(r){let e=on();if(r.some(t=>t._bypassWebAudio))throw new H(z.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!e.webAudioMediaStreamDest)throw new H(z.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function c0(r,e){AF(r);let t=new Xs;return r.forEach(n=>t.addAudioTrack(n)),t}let wF=!on().supportUnifiedPlan||te("CHROME_FORCE_PLAN_B")&&Xp();function yP(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var t;return wF?(t={spec:e,store:r},Tl("PlanBConnection").create(t)):new na(e,r)}function ZC(r){return r&&(r.iceConnectionState==="disconnected"||r.iceConnectionState==="checking"||r.iceConnectionState==="failed")}function RP(r){try{if(r.iceServers)return!1;if(r.turnServer&&r.turnServer.mode!=="off"){if(Ti(r.turnServer.servers))return!1;if(te("FORCE_TURN_TCP")||r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).some(e=>e.forceturn))return!0}return!1}catch{return!1}}var ti;function ni(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function wh(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ni(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ni(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}let na=(ti=class K0 extends QV{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return(e=(t=this.peerConnection.getReceivers()[0])===null||t===void 0||(t=t.transport)===null||t===void 0?void 0:t.state)!==null&&e!==void 0?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return Re(t=Object.keys(tn)).call(t,e)}))]}constructor(e,t){super(e,t),Z(this,"id",In(5,"connection-")),Z(this,"store",void 0),Z(this,"peerConnection",void 0),Z(this,"forceTurn",!1),Z(this,"remoteSDP",void 0),Z(this,"initialOffer",void 0),Z(this,"transportEventReceiver",void 0),Z(this,"statsFilter",void 0),Z(this,"extension",{useXR:te("USE_XR")}),Z(this,"localCapabilities",void 0),Z(this,"remoteCodecs",void 0),Z(this,"localCandidateCount",0),Z(this,"allCandidatesReceived",!1),Z(this,"isPreallocation",!1),Z(this,"preMediaMap",new Map),Z(this,"dataStreamChannelMap",new Map),Z(this,"establishPromise",void 0),Z(this,"recoveredDataChannelIds",[]),Z(this,"currentDataChannelId",1),Z(this,"supportAV1RtpSpec",!1),Z(this,"mutex",void 0),Z(this,"qualityLimitationReason",ww.NONE),Z(this,"isFirstConnected",!1),this.store=t,this.forceTurn=RP(e),this.mutex=new ha("P2PConnection-mutex",t.clientId),this.peerConnection=new RTCPeerConnection(K0.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=QU(this.peerConnection,te("STATS_UPDATE_INTERVAL"),void 0,jr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,e.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(e){return this.preMediaMap.get(e)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(e,t){if(this.remoteCodecs=t,!this.remoteSDP)return void V.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(t));if(this.remoteSDP.updateRemoteCodec(e,t,this.store.codec)){let n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n);let s=this.remoteSDP.toString();i?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}else V.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let i=bh(n.sdp),s=await rF({filterRTX:!te("USE_PUB_RTX")&&!te("USE_SUB_RTX"),filterVideoFec:te("FILTER_VIDEO_FEC"),filterAudioFec:te("FILTER_AUDIO_FEC"),filterVideoCodec:te("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:te("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:te("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=ed(s),this.initialOffer=n,te("ENABLE_SVC")&&this.store.codec=="av1"){let c=await(async function(){try{let d=new RTCPeerConnection;d.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:Gg.L1T3}]});let u=await d.createOffer();if(!u.sdp)return void d.close();let p=Wc(u.sdp).mediaDescriptions[0];if(!p)return;let m=p.attributes.extmaps.find(g=>g.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return d.close(),m}catch{return}})();var e;c&&(this.supportAV1RtpSpec=!0,(e=s.send)===null||e===void 0||e.videoExtensions.push(c))}let o;return n.sdp&&aF(n.sdp)&&(o=sr(s),(t=o).send&&(Hm(vt.VIDEO,t.send.videoExtensions),Hm(vt.AUDIO,t.send.audioExtensions)),t.recv&&(Hm(vt.VIDEO,t.recv.videoExtensions),Hm(vt.AUDIO,t.recv.audioExtensions)),t.sendrecv&&(Hm(vt.VIDEO,t.sendrecv.videoExtensions),Hm(vt.AUDIO,t.sendrecv.audioExtensions))),wh(wh({},i),{},{rtpCapabilities:o||s,offerSDP:n.sdp})}catch(n){throw new H(z.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}var t}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&aF(this.initialOffer.sdp)&&(t=e.rtpCapabilities,n=this.localCapabilities,t.send&&(Zw(vt.VIDEO,t.send.videoExtensions,n.send.videoExtensions),Zw(vt.AUDIO,t.send.audioExtensions,n.send.audioExtensions)),t.recv&&(Zw(vt.VIDEO,t.recv.videoExtensions,n.recv.videoExtensions),Zw(vt.AUDIO,t.recv.audioExtensions,n.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return sr(this._localCapabilities)}get rtpCapabilities(){return sr(this._rtpCapabilities)}get candidates(){return sr(this._candidates)}get iceParameters(){return sr(this._iceParameters)}get dtlsParameters(){return sr(this._dtlsParameters)}constructor(d){let u=arguments.length>1&&arguments[1]!==void 0&&arguments[1],p=arguments.length>2&&arguments[2]!==void 0&&arguments[2];Z(this,"sessionDesc",void 0),Z(this,"_localCapabilities",void 0),Z(this,"_rtpCapabilities",void 0),Z(this,"_candidates",void 0),Z(this,"_originCandidates",void 0),Z(this,"_iceParameters",void 0),Z(this,"_isUseExtmapAllowMixed",void 0),Z(this,"_isUseLocalCodecs",void 0),Z(this,"_dtlsParameters",void 0),Z(this,"setup",void 0),Z(this,"currentMidIndex",void 0),Z(this,"cname",void 0),Z(this,"useLocalCodecsMids",[]),Z(this,"preloadSsrcs",[]),Z(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=u,this._isUseLocalCodecs=p,d=sr(d);let{iceParameters:m,dtlsParameters:g,candidates:T,rtpCapabilities:R,setup:I,localCapabilities:A,cname:w}=d;this._rtpCapabilities=R,this._candidates=T,this._originCandidates=sr(T),this._iceParameters=m,this._dtlsParameters=g,this._localCapabilities=A,this.setup=I,this.cname=w,[this.sessionDesc]=this.updateRemoteRTPCapabilities(R),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(d){return d.length===this.preloadSsrcs.length&&d.every(u=>{var p;return Re(p=this.preloadSsrcs).call(p,u)})}preloadRemoteMedia(d){let u=0,p=[],m=[];for(;d>0;){let g=[SP({ssrcId:JC+u},te("USE_SUB_RTX")?{rtx:JC+u+1}:{})],T="".concat(JC+u,"_").concat(XC+u),{ssrcs:R,ssrcGroups:I}=jC(g,this.cname,te("SYNC_GROUP")?T:void 0),A=this.preCreateOrRecycleSendMedia("video",R,I,void 0),w=[{ssrcId:XC+u}],k="".concat(JC+u,"_").concat(XC+u),{ssrcs:L,ssrcGroups:j}=jC(w,this.cname,te("SYNC_GROUP")?k:void 0),K=this.preCreateOrRecycleSendMedia("audio",L,j,void 0);d--,u+=2,p.push(A,K),m.push(R[0].ssrcId,L[0].ssrcId)}return this.useLocalCodecsMids.push(...p),this.preloadSsrcs=m,{mids:p,preSSRCs:m,isAvailable:!0}}preCreateOrRecycleSendMedia(d,u,p,m){let g=this.rtpCapabilities.send.videoCodecs,T=this._isUseLocalCodecs||g.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;V.debug("create or recycle send media without remote rtp capabilities, ssrcs ",u[0].ssrcId);let R=d===vt.VIDEO?T.videoCodecs:T.audioCodecs,I=d===vt.VIDEO?T.videoExtensions:T.audioExtensions;this.currentMidIndex+=1;let A="".concat(this.currentMidIndex),w={media:{mediaType:d,port:qC,protos:["UDP","TLS","RTP","SAVPF"],fmts:R.map(k=>k.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:I,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:u,ssrcGroups:p,rtcpFeedbackWildcards:[],payloads:R,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(A)}};return w=this.mungSendMediaDesc(w,m),this.sessionDesc.mediaDescriptions.push(w),this.updateBundleMids(),A}toString(){return Qo(this.sessionDesc)}send(d,u,p,m){let{ssrcs:g,ssrcGroups:T}=jC(u,this.cname,te("SYNC_GROUP")?p:void 0),R=this.findPreloadMediaDesc(g);if(R){if(jr()&&this.firefoxSsrcMidMap.set(g[0].ssrcId,R.attributes.mid),m&&(m.twcc||m.remb)){let I=this.sessionDesc.mediaDescriptions.indexOf(R);return this.sessionDesc.mediaDescriptions[I]=this.mungSendMediaDesc(R,m),{mid:R.attributes.mid,needExchangeSDP:!0}}return{mid:R.attributes.mid,needExchangeSDP:!1}}{let I=this.findAvailableMediaIndex(d,g),A;return I===-1||I===1&&(ms()||(function(){let w=Qn();return!(w.name!==sn.CHROME||!w.osVersion)&&Number(w.version)<=90})()||te("ENABLE_ENCODED_TRANSFORM")&&fh())||I===0&&!(function(w){let k=Qn();return!(k.name!==sn.FIREFOX||!k.osVersion)&&Number(k.version)===w})(138)&&te("USE_SUB_RTX")||vD()?(A=this.createOrRecycleSendMedia(d,g,T,"sendonly",m),this.updateBundleMids()):(A=sr(this.sessionDesc.mediaDescriptions[I]),A.attributes.direction="sendonly",A.attributes.ssrcs=g,A.attributes.ssrcGroups=T,this.sessionDesc.mediaDescriptions[I]=this.mungSendMediaDesc(A,m)),jr()&&this.firefoxSsrcMidMap.set(g[0].ssrcId,A.attributes.mid),{mid:A.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:d,needExchangeSDP:u}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:d.attributes.mid,needExchangeSDP:u}}batchSend(d){let u=d.map(g=>{let{kind:T,ssrcMsg:R,mslabel:I}=g;return this.send(T,R,I)}),p=[],m=!1;return u.forEach(g=>{let{mid:T,needExchangeSDP:R}=g;R&&(m=!0),p.push(T)}),{mids:p,needExchangeSDP:m}}stopSending(d){let u=this.sessionDesc.mediaDescriptions.filter(p=>p.attributes.mid&&d.indexOf(p.attributes.mid)!==-1);if(u.length!==d.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");u.forEach(p=>{p.attributes.mid==="0"||jr()||vD()?p.attributes.ssrcs=[]:(p.attributes.ssrcs=[],p.attributes.direction="inactive",p.media.port="0")}),this.updateBundleMids()}mute(d){let u=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===d);if(!u)throw new Error("mediaDescription not found with ".concat(d," in remote SDP when calling RemoteSDP.mute."));u.attributes.direction="inactive"}unmute(d){let u=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===d);if(!u)throw new Error("mediaDescription not found with ".concat(d," in remote SDP when calling RemoteSDP.unmute."));u.attributes.direction="sendonly"}muteRemote(d){let u=this.sessionDesc.mediaDescriptions.filter(p=>Re(d).call(d,p.attributes.mid||""));if(u.length!==d.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");u.forEach(p=>{p.attributes.direction="inactive"})}unmuteRemote(d){let u=this.sessionDesc.mediaDescriptions.filter(p=>Re(d).call(d,p.attributes.mid||""));if(u.length!==d.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");u.forEach(p=>{p.attributes.direction="recvonly"})}receive(d,u,p,m){d.forEach((g,T)=>{this.createOrRecycleRecvMedia(g,[],"recvonly",u,p,m[T])}),this.updateBundleMids()}stopReceiving(d){let u=this.sessionDesc.mediaDescriptions.filter(p=>d.indexOf(p.attributes.mid)!==-1);if(u.length!==d.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");u.forEach(p=>{p.media.port="0",p.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(d){let u=this.sessionDesc||Wc((p=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(p?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var p;this._rtpCapabilities=d;let m=!1,g=this.rtpCapabilities.send,T=this.localCapabilities.send,R=this.localCapabilities.recv,I=R.videoCodecs,A=R.audioCodecs,w=R.videoExtensions,k=R.audioExtensions;for(let W of u.mediaDescriptions){var L;if(W.attributes.direction!=="sendonly"||typeof W.attributes.mid!="string"||!Re(L=this.useLocalCodecsMids).call(L,W.attributes.mid)){if(m=!0,W.attributes.iceUfrag=this._iceParameters.iceUfrag,W.attributes.icePwd=this._iceParameters.icePwd,W.attributes.fingerprints=this._dtlsParameters.fingerprints,W.attributes.candidates=this._candidates,W.attributes.setup=this.setup,W.media.mediaType==="application"&&(W.attributes.sctpPort="5000"),W.media.mediaType==="video")if(this._isUseLocalCodecs&&W.attributes.direction==="sendonly"){var j;W.media.fmts=I.map(se=>se.payloadType.toString(10)),W.attributes.payloads=I,W.attributes.extmaps=w;let Y=W.attributes.mid;typeof Y!="string"||Re(j=this.useLocalCodecsMids).call(j,Y)||this.useLocalCodecsMids.push(Y)}else if(g.videoCodecs.length===0){let Y=T.videoCodecs.filter(se=>{var de,ge;return(de=se.rtpMap)===null||de===void 0?void 0:Re(ge=de.encodingName.toLowerCase()).call(ge,"vp8")})||[T.videoCodecs[0]];W.media.fmts=Y.map(se=>se.payloadType.toString(10)),W.attributes.payloads=Y,W.attributes.extmaps=[]}else W.media.fmts=g.videoCodecs.map(Y=>Y.payloadType.toString(10)),W.attributes.payloads=g.videoCodecs,W.attributes.extmaps=g.videoExtensions;if(W.media.mediaType==="audio")if(this._isUseLocalCodecs&&W.attributes.direction==="sendonly"){var K;W.media.fmts=A.map(se=>se.payloadType.toString(10)),W.attributes.payloads=A,W.attributes.extmaps=k;let Y=W.attributes.mid;typeof Y!="string"||Re(K=this.useLocalCodecsMids).call(K,Y)||this.useLocalCodecsMids.push(Y)}else if(g.audioCodecs.length===0){let Y=T.audioCodecs.filter(se=>{var de,ge;return(de=se.rtpMap)===null||de===void 0?void 0:Re(ge=de.encodingName.toLowerCase()).call(ge,"opus")})||[T.audioCodecs[0]];W.media.fmts=Y.map(se=>se.payloadType.toString(10)),W.attributes.payloads=Y,W.attributes.extmaps=[]}else W.media.fmts=g.audioCodecs.map(Y=>Y.payloadType.toString(10)),W.attributes.payloads=g.audioCodecs,W.attributes.extmaps=g.audioExtensions,zm(W)}}return this.sessionDesc=u,this.currentMidIndex=u.mediaDescriptions.length-1,[this.sessionDesc,m]}updateCandidates(d){let u=this._originCandidates.filter(m=>m.transport==="udp"),p=[];if(u.forEach(m=>{p.push(SP(SP({},m),{},{foundation:"tcpcandidate",priority:Number(m.priority)-1+"",transport:"tcp",port:Number(m.port)+90+""}))}),u.length!==0){switch(d){case dt.TCP_RELAY:this._candidates=p;break;case dt.UDP_TCP_RELAY:case dt.RELAY:this._candidates=[...u,...p];break;default:this._candidates=u}for(let m of this.sessionDesc.mediaDescriptions)m.attributes.candidates=this.candidates}}restartICE(d){d=sr(d),this._iceParameters=d,this.sessionDesc.mediaDescriptions.forEach(u=>{u.attributes.iceUfrag=d.iceUfrag,u.attributes.icePwd=d.icePwd})}predictReceivingMids(d){let u=[];for(let p=0;p<d;p++)u.push((this.currentMidIndex+p+1).toString(10));return u}findAvailableMediaIndex(d,u){return this.sessionDesc.mediaDescriptions.findIndex(p=>{let m=p.media.mediaType===d&&p.media.port!=="0"&&(p.attributes.direction==="sendonly"||p.attributes.direction==="sendrecv")&&p.attributes.ssrcs.length===0;if(jr()){if(m){let g=this.firefoxSsrcMidMap.get(u[0].ssrcId);return!(g||p.attributes.mid!=="0"&&p.attributes.mid!=="1")||!(!g||g!==p.attributes.mid)}return!1}return m})}createOrRecycleDataChannel(){for(let p of this.sessionDesc.mediaDescriptions)if(p.media.mediaType==="application")return{mediaDesc:p,needExchangeSDP:!1};this.currentMidIndex+=1;let d="".concat(this.currentMidIndex),u={media:{mediaType:"application",port:qC,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(d),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(u),{mediaDesc:u,needExchangeSDP:!0}}createOrRecycleRecvMedia(d,u,p,m,g,T){let R=d._mediaStreamTrack.kind,I=this.rtpCapabilities.recv,A=C_(R,I,this.localCapabilities.send,R===vt.VIDEO?m:g),w=R===vt.VIDEO?I.videoExtensions:I.audioExtensions;this.currentMidIndex+=1;let k="".concat(this.currentMidIndex),L={media:{mediaType:R,port:qC,protos:["UDP","TLS","RTP","SAVPF"],fmts:A.map(K=>K.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:w,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:u,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:A,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:p,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(k)}};L=this.mungRecvMediaDsec(L,d,T);let j=this.findFirstClosedMedia(R);if(j){let K=this.sessionDesc.mediaDescriptions.indexOf(j);this.sessionDesc.mediaDescriptions[K]=L}else this.sessionDesc.mediaDescriptions.push(L);return L}updateRemoteDtlsParameters(d){let u=new Set(this._dtlsParameters.fingerprints.map(g=>g.fingerprint)),p=new Set(d.map(g=>g.fingerprint)),m=!1;u.size!==p.size&&(m=!0);for(let g of u)p.has(g)||(m=!0);return m}updateRemoteCodec(d,u,p){let m=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(L=>L.rtpMap&&L.rtpMap.encodingName.toLowerCase()||"").filter(L=>{var j;return Re(j=Object.keys(tn)).call(j,L)}))],g=new Set(u);if(m.every(L=>g.has(L)))return V.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(u)),!1;let T=this._rtpCapabilities.recv.videoCodecs.filter(L=>u.some(j=>{var K;return Re(K=L.rtpMap&&L.rtpMap.encodingName.toLowerCase()||"").call(K,j)}));if(T.length===0)return V.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(m," codecs: ").concat(u)),!1;let R=[...new Set(T.map(L=>L.rtpMap&&L.rtpMap.encodingName.toLowerCase()||""))],I;if(V.debug("updateRemoteCodec, from ".concat(m," to ").concat(R)),d.length===0)I=this.sessionDesc.mediaDescriptions.filter(L=>L.media.mediaType==="video"&&L.attributes.direction==="recvonly");else if(I=this.sessionDesc.mediaDescriptions.filter(L=>L.attributes.mid&&L.media.mediaType==="video"&&Re(d).call(d,L.attributes.mid)&&L.attributes.direction==="recvonly"),I.length!==d.length)return V.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(d,", codecs: ").concat(u)),!1;if(te("USE_PUB_RTX")||te("USE_SUB_RTX")){let L=Ih(T,this.rtpCapabilities.recv.videoCodecs);T.push(...L)}this._rtpCapabilities.recv.videoCodecs=T;let A=this.localCapabilities.send,w=this.rtpCapabilities.recv,k=C_(vt.VIDEO,w,A,p);return I.forEach(L=>{let j=k.map(K=>K.payloadType.toString(10));V.debug("updateRemoteCodec mid: ".concat(L.attributes.mid,", from"),L.attributes.payloads,"to",k),L.attributes.payloads=k,L.media.fmts=j}),!0}createOrRecycleSendMedia(d,u,p,m,g){let T=this.rtpCapabilities.send.videoCodecs,R=this._isUseLocalCodecs||T.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,I=d===vt.VIDEO?R.videoCodecs:R.audioCodecs,A=d===vt.VIDEO?R.videoExtensions:R.audioExtensions;this.currentMidIndex+=1;let w="".concat(this.currentMidIndex),k={media:{mediaType:d,port:qC,protos:["UDP","TLS","RTP","SAVPF"],fmts:I.map(j=>j.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:A,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:u,ssrcGroups:p,rtcpFeedbackWildcards:[],payloads:I,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:m,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(w)}};k=this.mungSendMediaDesc(k,g);let L=this.findFirstClosedMedia(d);if(L){let j=this.sessionDesc.mediaDescriptions.indexOf(L);this.sessionDesc.mediaDescriptions[j]=k}else this.sessionDesc.mediaDescriptions.push(k);return k}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(d=>d.media.port!=="0").map(d=>d.attributes.mid)}mungRecvMediaDsec(d,u,p){let m=sr(d);return Qg(m),R_(m,u),t0(m,u),dP(m),n0(m,p,this.localCapabilities.send),m}mungSendMediaDesc(d,u){let p=sr(d);return n0(p,u,this.localCapabilities.recv),zm(p),p}updateRecvMedia(d,u){let p=this.sessionDesc.mediaDescriptions.findIndex(m=>m.attributes.mid===d);if(p!==-1){let m=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[p],u);this.sessionDesc.mediaDescriptions[p]=m}}bumpMid(d){this.currentMidIndex+=d}findFirstClosedMedia(d){return this.sessionDesc.mediaDescriptions.find(u=>jr()?u.media.port==="0"&&u.media.mediaType===d:u.media.port==="0")}findPreloadMediaDesc(d){return this.sessionDesc.mediaDescriptions.find(u=>{var p;return((p=u.attributes)===null||p===void 0||(p=p.ssrcs[0])===null||p===void 0?void 0:p.ssrcId)===d[0].ssrcId})}getSSRC(d){var u;return(u=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===d))===null||u===void 0?void 0:u.attributes.ssrcs}}(wh(wh({},e),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!te("ENABLE_PRE_SUB_WITH_PRE_PC")||!te("PRE_USE_LOCAL_CODECS"))&&RC(this.store)),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let i=this.remoteSDP.toString(),s=Ym(this.initialOffer.sdp,this.extension),o=this.logSDPExchange(s||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:s}),o?.(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i});let c=this.peerConnection.getTransceivers()[0];if(c!=null&&c.receiver&&this.tryBindTransportEvents(c.receiver),RC(this.store))if(e.preallocation&&te("ENABLE_PRE_SUB_WITH_PRE_PC")){let d=te("PRE_SUB_NUM"),{mids:u,preSSRCs:p}=this.remoteSDP.preloadRemoteMedia(d);await td(this.peerConnection,this.remoteSDP,this.extension),V.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(p)),this.presetMedia(u,p)}else{let{preSSRCs:d=[]}=e,u=d.map(m=>m.ssrcMsg[0].ssrcId);if(d.length===0)return;let{mids:p}=this.remoteSDP.batchSend(d.map(m=>Object.assign({},m)));await td(this.peerConnection,this.remoteSDP,this.extension),V.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(u)),this.presetMedia(p,u)}}catch(i){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}var t,n}presetMedia(e,t){e.forEach((n,i)=>{this.peerConnection.getTransceivers().forEach(s=>{if(s.mid!=null&&n===s.mid&&s.receiver.track){let o=s.receiver.track,c;o.kind==="video"&&te("ENABLE_PRE_RENDER")&&(c=new JD({trackId:"track-".concat(o.kind,"-unknown-").concat(this.store.clientId,"_").concat(In(5,""))},!0),c.updateVideoTrack(o),c.onFirstVideoFrameRender=()=>{var d;let u=this.preMediaMap.get(t[i]);u&&(u.firstVideoRender=Date.now()),(d=this.onFirstVideoRender)===null||d===void 0||d.call(this,t[i])},c.play(this.store.sessionId||void 0)),this.preMediaMap.set(t[i],{mid:n,track:o,player:c,transceiver:s})}}),this.store.peerReceiver()})}checkDtlsParameters(e){return!!this.remoteSDP&&e.length>0&&this.remoteSDP.updateRemoteDtlsParameters(e)}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let t=!1,{rtpCapabilities:n}=e;if([,t]=this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){let o=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);t=t||o}let{preSSRCs:i=[]}=e,s=i.map(o=>o.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(s)){let o=[],c=[];if(Array.from(this.preMediaMap.entries()).every(d=>{let[u,{mid:p,player:m,track:g}]=d;return o.push(p),c.push(u),this.preMediaMap.delete(u),m&&m.destroy(),!0}),o.length>0&&(this.remoteSDP.stopSending(o),await td(this.peerConnection,this.remoteSDP,this.extension),V.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(c)),Ye.reportApiInvoke(this.store.sessionId,{name:Zr.PRELOAD_MEDIA_FAILED,options:[i,c],tag:Cn.TRACER}).onSuccess()),i.length>0){let{mids:d}=this.remoteSDP.batchSend(i.map(u=>Object.assign({},u)));await td(this.peerConnection,this.remoteSDP,this.extension),V.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(s)),this.presetMedia(d,s)}}t?(await td(this.peerConnection,this.remoteSDP,this.extension),V.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):V.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(t){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(t.toString()))}}send(e,t,n){var i=this;return zl(function*(){let s=yield zn(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let o=[],c=y_();e.forEach(A=>{let w=i.peerConnection.addTransceiver(A._mediaStreamTrack,wh({direction:"sendonly"},A.trackMediaType==="video"&&i.supportAV1RtpSpec&&c?{sendEncodings:[{scalabilityMode:c}]}:{}));o.push(w),A._updateRtpTransceiver(w)}),jr()&&te("SIMULCAST")===!0&&(yield zn(i.applySimulcastForFirefox(o,e)));let d=yield zn(i.peerConnection.createOffer()),u=i.remoteSDP.predictReceivingMids(e.length),p=i.mungSendOfferSDP(d.sdp,e,u),m=Wc(p),g=u.map(A=>{let w=m.mediaDescriptions.find(k=>k.attributes.mid===A);if(!w)throw new Error("Cannot extract ssrc from mediaDescription.");return Km(w,te("USE_PUB_RTX"))}),T;try{T=yield g}catch(A){T=[],i.remoteSDP.receive(e,t,n,T);let w=i.remoteSDP.toString();throw yield zn(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield zn(i.peerConnection.setRemoteDescription({type:"answer",sdp:w})),yield zn(i.stopSending(u,!0)),A}i.remoteSDP.receive(e,t,n,T);let R=i.remoteSDP.toString(),I=i.logSDPExchange(p,"offer","local","send");return yield zn(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield zn(i.applySimulcastEncodings(o,e)),yield zn(i.applySendEncodings(o,e)),I?.(R),yield zn(i.peerConnection.setRemoteDescription({type:"answer",sdp:R})),o.map((A,w)=>{let k=u[w];return{localSSRC:g[w],id:k,transceiver:A}})}catch(o){throw o instanceof H?o:new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}})()}async createDataChannels(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let n=this.dataStreamChannelMap.get(e);if(n&&n.readyState==="open")V.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let s=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof s!="number")throw new Error("create DataChannel error, because cannot get dc id");n=this.peerConnection.createDataChannel("datastream-channel",{id:s,negotiated:!0,ordered:!1,maxRetransmits:te("DATASTREAM_MAX_RETRANSMITS")}),n.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,n)}t.forEach(s=>{s._updateOriginDataChannel(n)});let{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){let s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});let o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o),V.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else V.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(n){throw n instanceof H?n:new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(n.toString()))}}async stopDataChannels(e){try{let t=this.dataStreamChannelMap.get(e);return t&&(t.id&&this.recoveredDataChannelIds.push(t.id),t.close()),void this.dataStreamChannelMap.delete(e)}catch(t){throw t instanceof H?t:new H(z.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(t.toString()))}}async stopSending(e,t){let n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let i=this.peerConnection.getTransceivers().filter(d=>e.indexOf(d.mid)!==-1);if(i.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(d=>{var u;Pv(this.id+d.mid,this),d.direction="inactive",(u=d.stop)===null||u===void 0||u.call(d)});let s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(e);let c=this.remoteSDP.toString();o?.(c),await this.peerConnection.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{n&&n()}}async receive(e,t,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));let{mid:s,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,i);o&&(await td(this.peerConnection,this.remoteSDP,this.extension),V.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));let c=this.peerConnection.getTransceivers().find(d=>d.mid===s);if(!c)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,id:s,transceiver:c}}catch(s){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:t,needExchangeSDP:n}=this.remoteSDP.batchSend(e);return n&&(await td(this.peerConnection,this.remoteSDP,this.extension),V.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),t.map(i=>{let s=this.peerConnection.getTransceivers().find(o=>o.mid===i);if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:i,transceiver:s}})}catch(t){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(t.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(s=>{Array.from(this.preMediaMap.entries()).some(o=>{let[c,{mid:d,player:u}]=o;if(d===s)return this.preMediaMap.delete(c),u&&u.destroy(),!0})}),this.remoteSDP.stopSending(e);let t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let i=await this.peerConnection.createAnswer();n?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(t){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);let t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let i=await this.peerConnection.createAnswer();n?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(t){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(t.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);let t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let i=await this.peerConnection.createAnswer();n?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(t){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(t.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter(o=>o.mid&&e.indexOf(o.mid)!==-1);if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(o=>{o.direction="inactive"});let n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);let s=this.remoteSDP.toString();i?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(t){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(t.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter(o=>o.mid&&e.indexOf(o.mid)!==-1);if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(async(o,c)=>{o.direction="sendonly"});let n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(e,this.remoteCodecs,this.store.codec);let s=this.remoteSDP.toString();i?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(t){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(t.toString()))}}restartICE(e){var t=this;return zl(function*(){let n=yield zn(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let i=on().supportPCSetConfiguration,s=te("FORCE_TURN_TCP")||t.forceTurn;if(e===dt.RELAY&&!i)return;if(i&&!s){let m=e===dt.RELAY?"relay":"all",g=t.peerConnection.getConfiguration();g.iceTransportPolicy!==m&&(V.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(g.iceTransportPolicy,"] to [").concat(m,"]")),g.iceTransportPolicy=m,t.peerConnection.setConfiguration(g))}t.remoteSDP.updateCandidates(e);let o=yield zn(t.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let c=bh(o.sdp),{remoteIceParameters:d}=yield c.iceParameters;t.remoteSDP.restartICE(d);let u=t.remoteSDP.toString(),p=t.logSDPExchange(o.sdp||"","offer","local","restartICE");t.store.descriptionStart(),yield zn(t.peerConnection.setLocalDescription(o)),p?.(u),yield zn(t.peerConnection.setRemoteDescription({type:"answer",sdp:u}))}catch(i){V.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),i)}finally{n()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;let e=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(dt.TCP_RELAY),await td(this.peerConnection,this.remoteSDP,this.extension)}catch(t){V.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),t)}finally{e()}}close(){var e;this.peerConnection.getTransceivers().forEach(t=>{Pv(this.id+t.mid,this)}),this.preMediaMap.forEach(t=>{let{player:n}=t;n&&n.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return wh(wh({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let n=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);let s=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),o?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new H(z.EXCHANGE_SDP_FAILED,n.toString())}}async updateSendParameters(e,t){let n=this.peerConnection.getTransceivers().filter(i=>i.mid===e);n.length===1&&(this.isVP8Simulcast(t)?jr()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){let n=this.peerConnection.getTransceivers().find(i=>i.mid===t);n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){let e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){let t=e[0].transport.iceTransport,{local:n,remote:i}=t.getSelectedCandidatePair();return{local:wh(wh({},mh),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:wh(wh({},mh),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=e=>{if(e&&(e.errorCode||e.errorText)){var t;let n="code: ".concat(e.errorCode,", message: ").concat(e.errorText),i=e.port?"local: ".concat(e.port):"",s=xd(e.url||"");V.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(n,"), url: ").concat(s||"",", host_candidate:").concat(i)),(t=this.onICECandidateError)===null||t===void 0||t.call(this,n)}},this.peerConnection.onicegatheringstatechange=e=>{e&&e.target&&"iceGatheringState"in e.target&&V.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(e.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,V.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,V.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},te("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){let t={iceServers:[]},n=e.cloudProxyServer||"disabled";return e.iceServers?t.iceServers=e.iceServers:e.turnServer&&(Ti(e.turnServer.servers)?t.iceServers=e.turnServer.servers:te("NEW_TURN_MODE")&&t.iceServers&&n==="disabled"?(te("USE_TURN_SERVER_OF_GATEWAY")?e.turnServer.serversFromGateway&&t.iceServers.push(...K0.newTurnServerConfigToIceServers(e.turnServer.serversFromGateway)):t.iceServers.push(...K0.newTurnServerConfigToIceServers(e.turnServer.servers)),te("NEW_FORCE_TURN")&&(t.iceTransportPolicy="relay")):e.turnServer.mode!=="off"&&(t.iceServers&&t.iceServers.push(...K0.turnServerConfigToIceServers(e.turnServer.servers)),te("USE_TURN_SERVER_OF_GATEWAY")&&t.iceServers&&e.turnServer.serversFromGateway&&t.iceServers.push(...K0.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),te("FORCE_TURN_TCP")?t.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(i=>{i.forceturn&&(t.iceTransportPolicy="relay")}))),te("ENABLE_ENCODED_TRANSFORM")&&on().supportWebRTCEncodedTransform&&(t.encodedInsertableStreams=!0),t}static turnServerConfigToIceServers(e){let t=[];return e.forEach(n=>{n.security?n.tcpport&&t.push({username:n.username,credential:n.password,credentialType:"password",urls:"turns:".concat(sf(n.turnServerURL),":").concat(n.tcpport,"?transport=tcp")}):(n.udpport&&!te("FORCE_TURN_TCP")&&t.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.udpport,"?transport=udp")}),n.tcpport&&t.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.tcpport,"?transport=tcp")}))}),t}static newTurnServerConfigToIceServers(e){let t=[];return e.forEach(n=>{let i=te("NEW_TURN_MODE");i===1?t.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":3478?transport=udp")}):i===2?t.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":3478?transport=tcp")}):i===3?t.push({username:n.username,credential:n.password,credentialType:"password",urls:"turns:".concat(sf(n.turnServerURL),":443?transport=tcp")}):i===4&&(t.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":3478?transport=udp")}),t.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":3478?transport=tcp")}),t.push({username:n.username,credential:n.password,credentialType:"password",urls:"turns:".concat(sf(n.turnServerURL),":443?transport=tcp")}))}),t}tryBindTransportEvents(e){let t=e.transport;if(t){this.transportEventReceiver=e,t.onstatechange=()=>{var i;t!=null&&t.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,t.state))},t.onerror=i=>{var s;(s=this.onDTLSTransportError)===null||s===void 0||s.call(this,"error"in i?i.error:i)};let n=t.iceTransport;n&&(n.onstatechange=()=>{let i=t?.iceTransport.state;var s;i&&((s=this.onICETransportStateChange)===null||s===void 0||s.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){let{local:i,remote:s}=n.getSelectedCandidatePair()||{};if(i&&s){let o=i.address+":"+i.port,c=s.address+":"+s.port;V.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(xd(o)),", remote ").concat(JSON.stringify(xd(c))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n,i;if(t||(t=this.peerConnection.getSenders().find(I=>I.track===e._mediaStreamTrack)),!t)return V.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return V.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!on().supportSetRtpSenderParameters)return V.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let s={},o={};switch(e._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;case"balanced":s.degradationPreference="balanced"}let c=(function(I,A){return I.getTransceivers().find(w=>w.sender.track===A||w.receiver.track===A)})(this.peerConnection,e._mediaStreamTrack),d=g4(e);if((function(I){var A;return!(!te("ENABLE_AG_ADAPTATION")||!(I instanceof zi||Re(A=I._hints).call(A,rt.CUSTOM_TRACK))||!te("FORCE_SUPPORT_AG_ADAPTATION")&&!(BU(14,0,!1)&&jU(17,4)||SD(14)&&TD(17,4,!0)))})(e)&&c&&t&&d&&this.getLocalVideoStats&&Re(n=["vp8","vp9"]).call(n,this.store.codec)){var u;let I=s.degradationPreference||(Re(u=e._hints).call(u,rt.CUSTOM_TRACK)?te("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(A,w,k,L,j,K){if(Pv(A,k),j(w),L!=="balanced"&&L!=="maintain-framerate"&&L!=="maintain-resolution")return;let W=-1;bF(A,w);let Y=window.setInterval(()=>{let de=QC.get(A);if(!te("ENABLE_AG_ADAPTATION")||!de)return Pv(A,k),void j(w);let ge=K();if(ge.sendPackets>0&&ge.OutgoingAvailableBandwidth>0){if(W===-1)return void(W=Date.now());if(Date.now()-W<1e3)return;let je=ge.sendFrameRate,_t=ge.OutgoingAvailableBandwidth,[ht,Ct]=W4(A,je,_t,de.adaptationConfig,w,L);Ct&&(k.qualityLimitationReason=Ct),ht&&de.adaptationConfig.scale!==ht.scale&&(V.debug("[".concat(A,"] applyAdaptation: ").concat(k.qualityLimitationReason,`
           sendFps `).concat(je,", bwe ").concat(_t,", switch from ").concat(de.adaptationConfig.scale," to ").concat(ht.scale," ")),de.adaptationConfig=TP(TP({},de.adaptationConfig),ht),j(ht))}},te("CHECK_LOCAL_STATS_INTERVAL")),se=TP({},w);QC.set(A,{timer:Y,adaptationConfig:se,originConfig:w,adaptationFunc:j}),V.debug("[".concat(A,"] start adaptation, originConfig: ").concat(JSON.stringify(w),", degradationPreference: ").concat(L))})(this.id+c.mid,d,this,I,A=>{t&&this.updateAdaptation(t,A)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var p;let{bitrateMax:I,frameRate:A,scaleResolutionDownBy:w}=e._encoderConfig;I&&(o.maxBitrate=1e3*I),(Re(p=e._hints).call(p,rt.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(A&&(o.maxFramerate=zc(A)),w&&w>=1&&(o.scaleResolutionDownBy=w))}let{maxFramerate:m}=te("ENCODER_CONFIG_LIMIT");if(m&&typeof m=="number"&&(o.maxFramerate=o.maxFramerate?Math.min(o.maxFramerate,m):m),te("DSCP_TYPE")&&Xp()){var g;let I=te("DSCP_TYPE");Re(g=["very-low","low","medium","high"]).call(g,I)&&(o.networkPriority=I)}let T=t.getParameters(),R=(i=T.encodings)===null||i===void 0?void 0:i[0];jr()&&!R&&(s.encodings=[o]),R&&Object.assign(R,o),Object.assign(T,s),V.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(T.encodings))),await t.setParameters(T),await(async function(I,A,w){try{var k;if(!on().supportSetRtpSenderParameters||!(function(Y){return Y==="vp9"||Y==="av1"})(I)||!te("ENABLE_SVC"))return;let L={},j={},K=A.getParameters(),W=(k=K.encodings)===null||k===void 0?void 0:k[0];j.scalabilityMode=y_(w),W&&Object.assign(W,j),Object.assign(K,L),await A.setParameters(K),V.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(K.encodings)))}catch(L){V.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",L)}})(this.store.codec,t,te("SVC_MODE"))}async updateAdaptation(e,t){var n,i;if(!e)return V.debug("[updateAdaptation] no rtpSender found");if(!on().supportSetRtpSenderParameters)return V.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let s={},{bitrateMax:o,frameRate:c,scaleResolutionDownBy:d}=t;o&&(s.maxBitrate=1e3*o),c&&(s.maxFramerate=zc(c)),d&&d>=1&&Re(n=["vp8","vp9"]).call(n,this.store.codec)&&(s.scaleResolutionDownBy=d);let u=e.getParameters(),p=(i=u.encodings)===null||i===void 0?void 0:i[0];p&&Object.assign(p,s),Object.assign(u,{});try{await e.setParameters(u),V.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(u.encodings)))}catch(m){!("transport"in e)||e.transport&&e.transport.state==="connected"?this.peerConnectionState!=="connected"?V.debug("[updateAdaptation] peerConnection not connected}"):V.debug("[updateAdaptation] updateRtpSenderEncodings failed",m):V.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,t){try{if(!on().supportSetRtpSenderParameters||e.length!==t.length)return;for(let n=0;n<e.length;n++){let i=e[n],s=t[n];s instanceof Ei&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch{V.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){let i=Wc(e);return t.forEach((s,o)=>{let c=n[o],d=i.mediaDescriptions.find(u=>u.attributes.mid===c);d&&(R_(d,s),i0(d,s,this.store.codec))}),Qo(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;(t=this.onFirstAudioReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;(t=this.onFirstVideoReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;(t=this.onFirstAudioDecoded)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;(n=this.onSelectedLocalCandidateChanged)===null||n===void 0||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;(n=this.onSelectedRemoteCandidateChanged)===null||n===void 0||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;(t=this.onFirstVideoDecodedTimeout)===null||t===void 0||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let d=0;d<e.length;d++){var n,i,s,o,c;let u=e[d],p=t[d];if(p instanceof Ei&&!Re(n=p._hints).call(n,rt.LOW_STREAM)&&(i=p._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=p._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=p._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=p._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){let m={},g={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:g.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:g.high}];let T=u.sender.getParameters();await u.sender.setParameters(Object.assign(T,m))}}}async applySimulcastEncodings(e,t){if(!jr()&&e.length===t.length)for(let n=0;n<e.length;n++){let i=t[n];if(i instanceof Ei&&this.isVP8Simulcast(i)){let s=e[n],o={},c={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];let d=s.sender.getParameters();await s.sender.setParameters(Object.assign(d,o))}}}isVP8Simulcast(e){var t,n,i,s,o;return!!(e instanceof Ei&&te("SIMULCAST")&&this.store.codec==="vp8"&&!Re(t=e._hints).call(t,rt.LOW_STREAM)&&(n=e._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((i=e._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=e._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=e._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1)}logSDPExchange(e,t,n,i){if(te("SDP_LOGGING"))return V.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(i,`
`),e),t==="offer"?s=>{this.logSDPExchange(s,"answer",n==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;let t=this.remoteSDP.getSSRC(e);return t&&t.length!==0?t[0].ssrcId:void 0}setConfiguration(e){if(on().supportPCSetConfiguration){let t=K0.resolvePCConfiguration(e);this.peerConnection.setConfiguration(t)}e.isPreallocation&&(this.isPreallocation=!0)}},Dt(ti.prototype,"updateRemoteRTPCapabilities",[Os],Object.getOwnPropertyDescriptor(ti.prototype,"updateRemoteRTPCapabilities"),ti.prototype),Dt(ti.prototype,"connect",[Os],Object.getOwnPropertyDescriptor(ti.prototype,"connect"),ti.prototype),Dt(ti.prototype,"updateRemoteConnect",[Os],Object.getOwnPropertyDescriptor(ti.prototype,"updateRemoteConnect"),ti.prototype),Dt(ti.prototype,"createDataChannels",[Os],Object.getOwnPropertyDescriptor(ti.prototype,"createDataChannels"),ti.prototype),Dt(ti.prototype,"receive",[Os],Object.getOwnPropertyDescriptor(ti.prototype,"receive"),ti.prototype),Dt(ti.prototype,"batchReceive",[Os],Object.getOwnPropertyDescriptor(ti.prototype,"batchReceive"),ti.prototype),Dt(ti.prototype,"stopReceiving",[Os],Object.getOwnPropertyDescriptor(ti.prototype,"stopReceiving"),ti.prototype),Dt(ti.prototype,"muteRemote",[Os],Object.getOwnPropertyDescriptor(ti.prototype,"muteRemote"),ti.prototype),Dt(ti.prototype,"unmuteRemote",[Os],Object.getOwnPropertyDescriptor(ti.prototype,"unmuteRemote"),ti.prototype),Dt(ti.prototype,"muteLocal",[Os],Object.getOwnPropertyDescriptor(ti.prototype,"muteLocal"),ti.prototype),Dt(ti.prototype,"unmuteLocal",[Os],Object.getOwnPropertyDescriptor(ti.prototype,"unmuteLocal"),ti.prototype),Dt(ti.prototype,"close",[Os],Object.getOwnPropertyDescriptor(ti.prototype,"close"),ti.prototype),Dt(ti.prototype,"updateEncoderConfig",[Os],Object.getOwnPropertyDescriptor(ti.prototype,"updateEncoderConfig"),ti.prototype),Dt(ti.prototype,"updateSendParameters",[Os],Object.getOwnPropertyDescriptor(ti.prototype,"updateSendParameters"),ti.prototype),Dt(ti.prototype,"replaceTrack",[Os],Object.getOwnPropertyDescriptor(ti.prototype,"replaceTrack"),ti.prototype),Dt(ti.prototype,"updateAdaptation",[Os],Object.getOwnPropertyDescriptor(ti.prototype,"updateAdaptation"),ti.prototype),Dt(ti.prototype,"getRemoteSSRC",[Os],Object.getOwnPropertyDescriptor(ti.prototype,"getRemoteSSRC"),ti.prototype),ti);function Os(r,e,t){let n=r[e];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return t.value=async function(){let i=this.mutex,s=await i.lock("From P2PConnection.".concat(e));try{for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return await n.apply(this,c)}finally{s()}},t}function cc(r,e){let t=document.createElement("video"),n=document.createElement("canvas");t.setAttribute("style","display:none"),n.setAttribute("style","display:none"),t.setAttribute("muted",""),t.muted=!0,t.setAttribute("autoplay",""),t.autoplay=!0,t.setAttribute("playsinline",""),n.width=zc(e.width),n.height=zc(e.height);let i=zc(e.framerate||15);document.body.append(t),document.body.append(n);let s=r._mediaStreamTrack;t.srcObject=new MediaStream([s]),t.play();let o=n.getContext("2d");if(!o)throw new fe(z.UNEXPECTED_ERROR,"can not get canvas context");let c=on(),d=n.captureStream(c.supportRequestFrame?0:i).getVideoTracks()[0];d.canvas||(d.canvas=n),n.startCapture=()=>{if(!t)return n.stopCapture&&n.stopCapture();if(t.paused&&t.play(),t.videoHeight>2&&t.videoWidth>2){let p=t.videoWidth,m=t.videoHeight/p,g=n.width*m;Math.abs(g-n.height)>=2&&(V.debug("adjust low stream resolution","".concat(n.width,"x").concat(n.height," -> ").concat(n.width,"x").concat(g)),n.height=g)}o.drawImage(t,0,0,n.width,n.height),d.requestFrame&&d.requestFrame(),s!==r._mediaStreamTrack&&(s=r._mediaStreamTrack,t.srcObject=new MediaStream([s]))},n.stopCapture=kw(()=>n.startCapture&&n.startCapture(),i);let u=d.stop;return d.stop=()=>{u.call(d),t&&(t.remove(),t.srcObject=null,t=null),n&&(n.width=0,n.remove(),n.stopCapture&&n.stopCapture(),n.startCapture=void 0,n.stopCapture=void 0,n=null),V.debug("clean low stream renderer")},d}var CP=(function(r){return r[r.Video_Send_Type=190]="Video_Send_Type",r})(CP||{}),Oh=(function(r){return r[r.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",r[r.Video_Send_Freeze=2082]="Video_Send_Freeze",r[r.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",r[r.Video_Recv_Freeze=2084]="Video_Recv_Freeze",r[r.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",r[r.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",r[r.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",r[r.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",r})(Oh||{}),qt=(function(r){return r[r.Video_Send_Retransmit=2062]="Video_Send_Retransmit",r[r.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",r[r.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",r[r.Video_Send_Transmit=2066]="Video_Send_Transmit",r[r.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",r[r.Video_Capture_Height=2033]="Video_Capture_Height",r[r.Video_Capture_Width=2035]="Video_Capture_Width",r[r.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",r[r.Video_Send_Low_Height=2073]="Video_Send_Low_Height",r[r.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",r[r.Video_Send_Low_Width=2077]="Video_Send_Low_Width",r[r.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",r[r.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",r[r.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",r[r.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",r[r.Video_Send_Width=2003]="Video_Send_Width",r[r.Video_Send_Height=2004]="Video_Send_Height",r[r.Video_Send_Disabled=2095]="Video_Send_Disabled",r[r.Video_Send_Adaptation=2032]="Video_Send_Adaptation",r[r.Video_Send_Player_Status=2128]="Video_Send_Player_Status",r[r.Video_Send_Nacks=2009]="Video_Send_Nacks",r[r.Video_Send_Plis=2010]="Video_Send_Plis",r[r.Video_Send_Firs=2011]="Video_Send_Firs",r[r.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",r[r.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",r[r.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",r[r.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",r[r.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",r[r.Video_Send_Bitrate=2012]="Video_Send_Bitrate",r[r.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",r[r.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",r[r.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",r[r.Audio_Send_Level=2038]="Audio_Send_Level",r[r.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",r[r.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",r[r.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",r[r.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",r[r.Audio_Send_Freeze=2081]="Audio_Send_Freeze",r[r.Audio_Send_Disabled=2096]="Audio_Send_Disabled",r[r.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",r[r.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",r[r.Video_Recv_Height=2019]="Video_Recv_Height",r[r.Video_Recv_Width=2018]="Video_Recv_Width",r[r.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",r[r.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",r[r.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",r[r.Video_Recv_Nacks=2026]="Video_Recv_Nacks",r[r.Video_Recv_Plis=2027]="Video_Recv_Plis",r[r.Video_Recv_Firs=2028]="Video_Recv_Firs",r[r.Video_Recv_Disabled=2101]="Video_Recv_Disabled",r[r.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",r[r.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",r[r.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",r[r.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",r[r.Audio_Render_Level=2043]="Audio_Render_Level",r[r.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",r[r.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",r[r.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",r[r.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",r[r.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",r[r.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",r[r.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",r[r.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",r[r.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",r[r.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",r[r.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",r[r.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",r})(qt||{}),Vt=(function(r){return r[r.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",r[r.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",r[r.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",r[r.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",r[r.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",r[r.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",r[r.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",r[r.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",r[r.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",r[r.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",r[r.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",r[r.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",r[r.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",r[r.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",r[r.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",r[r.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",r[r.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",r[r.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",r[r.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",r[r.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",r[r.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",r})(Vt||{}),$i=(function(r){return r[r.RTT=2006]="RTT",r[r.CONN_TYPE=801]="CONN_TYPE",r[r.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",r})($i||{}),Ha=(function(r){return r[r.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",r})(Ha||{});let w_=1e3,O_=6,$g=3,l0=Math.max(O_,$g,60);function jt(r,e,t){t!=null&&Number.isFinite(t)&&(r[e]=Math.round(Math.max(0,t)))}function Bt(r){let e={[$i.CONN_TYPE]:0,[$i.RTT]:r.rtt,[$i.STATS_UPDATE_INTERVAL]:r.updateInterval?Math.round(Math.max(0,r.updateInterval)):void 0};switch(r.selectedCandidatePair.localCandidate.candidateType){case"relay":{let t=r.selectedCandidatePair.localCandidate.relayProtocol;t==="udp"&&(e[$i.CONN_TYPE]=1),t==="tcp"&&(e[$i.CONN_TYPE]=3),t==="tls"&&(e[$i.CONN_TYPE]=4);break}case"srflx":e[$i.CONN_TYPE]=2;break;case"unknown":e[$i.CONN_TYPE]=5;break;default:e[$i.CONN_TYPE]=0}return e}function OF(r){let e=0;switch(r){case"none":e=0;break;case"cpu":e=1;break;case"bandwidth":e=2;break;case"other":e=3}return e}class NF extends Sr{constructor(e){super(),Z(this,"store",void 0),Z(this,"uploadWRTCStatsTimer",void 0),Z(this,"uploadOutboundDenoiserStatsTimer",void 0),Z(this,"uploadExtStatsTimer",void 0),Z(this,"uploadExtUsageStatsTimer",void 0),Z(this,"uploadInboundExtStatsTimer",void 0),Z(this,"requestStats",void 0),Z(this,"requestTransportStats",void 0),Z(this,"requestLocalMedia",void 0),Z(this,"requestRemoteMedia",void 0),Z(this,"requestAllTracks",void 0),Z(this,"requestVideoIsReady",void 0),Z(this,"requestUploadStats",void 0),Z(this,"requestUpload",void 0),Z(this,"uploadOutboundStarted",!1),Z(this,"uploadInboundStarted",!1),Z(this,"uploadTransportStarted",!1),Z(this,"uploadBaseStatsStarted",!1),Z(this,"uploadExtensionUsageStarted",!1),Z(this,"lastRecvStats",void 0),Z(this,"lastSendStats",void 0),Z(this,"lastRefRecvStats",void 0),Z(this,"lastRefSendStats",void 0),Z(this,"lastNormalRecvStats",void 0),Z(this,"lastNormalSendStats",void 0),Z(this,"lastExtendStats",{}),Z(this,"needUploadStats",{}),Z(this,"needUploadRenderFreezeTime",!0),Z(this,"lastUploadCompensateTime",-1),Z(this,"uploadCompensateDeltaTime",0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;let t=e%$g==0,n=e%O_==0,i=e%60==0,s,o;if(this.uploadTransportStarted&&(s=this.requestStats(),this.store.useP2P&&(o=this.requestStats(!0))),!s&&this.uploadOutboundStarted&&(s=this.requestStats()),!o&&this.uploadInboundStarted&&(o=this.requestStats(!0)),s||o){var c;let d={};if(this.uploadTransportStarted&&s){let p=this.getTransportStats(s,o,t);p&&(d.misc=[p])}if(this.uploadOutboundStarted&&s){let p=this.getOutboundStats(s,n?this.lastNormalSendStats:void 0,t?this.lastRefSendStats:void 0,this.lastSendStats,i);p&&(d.outbound=[p])}if(this.uploadInboundStarted&&o){this.uploadCompensateStats(e);let p=this.getInboundStats(o,n?this.lastNormalRecvStats:void 0,t?this.lastRefRecvStats:void 0,this.lastRecvStats);p&&(d.inbound=p)}let u=(c=this.requestTransportStats)===null||c===void 0?void 0:c.call(this).connectState;u&&(Array.isArray(d.misc)?d.misc[0]&&d.misc[0].addition&&(d.misc[0].addition[Ha.RTC_PEER_CONNECTION_STATE]=gC[u]):d.misc=[{addition:{[Ha.RTC_PEER_CONNECTION_STATE]:gC[u]}}]),this.needUploadStats.sendType&&(Array.isArray(d.outbound)&&d.outbound[0]&&d.outbound[0].high&&(d.outbound[0].high[CP.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(d)}this.lastRecvStats=o,this.lastSendStats=s,n&&(this.lastNormalRecvStats=o,this.lastNormalSendStats=s),t&&(this.lastRefRecvStats=o,this.lastRefSendStats=s)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var t,n;let i=(t=this.requestTransportStats)===null||t===void 0?void 0:t.call(this);return void(i&&((n=this.requestUploadStats)===null||n===void 0||n.call(this,{misc:[{addition:{[Ha.RTC_PEER_CONNECTION_STATE]:gC[i.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(e),++e===l0+1&&(e=1)},w_)}uploadCompensateStats(e){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;let t=e%$g==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!t)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());let n=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=n,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;let i=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*i;let s=this.requestStats(!0);new Array(i).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;let o={};if(this.uploadInboundStarted&&s){let c=this.requestRemoteMedia()||[],d=[];c.forEach(u=>{let[p,m]=u,g={peer:p.uid};if(p._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(p._videoSSRC)&&m.has(vt.VIDEO)&&p.videoTrack){let T=(function(R,I,A){if(!I.videoRecv.find(k=>k.ssrc===R))return;let w={};if(A&&A._player){let k=A._player,{renderFreezeAccTime2:L,videoElementStatus:j}=k;if($l.visibility==="visible"&&j===qs.PLAYING&&on().supportRequestVideoFrameCallback){let K=Math.min(6e3,L);k.renderFreezeAccTime2=Math.max(0,L-K),jt(w,Oh.Video_Render_Freeze_Time_Render2,K),te("USE_NEW_RENDER_FREEZE_TIME")&&jt(w,Oh.Video_Render_Freeze_Time_Render,K)}}return w})(p._videoSSRC,s,p.videoTrack);T&&(g.video=T)}g.video&&d.push(g)}),d.length>0&&(o.inbound=d,this.requestUploadStats(o))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(e,t,n){if(!this.requestStats)return;if(!n)return e.rtt==null?void 0:{addition:{[$i.RTT]:e.rtt,[$i.CONN_TYPE]:void 0,[$i.STATS_UPDATE_INTERVAL]:e.updateInterval||void 0}};let i=Bt(e);if(this.store.useP2P){if(t){let s=Bt(t);i[$i.CONN_TYPE]+=s[$i.CONN_TYPE]<<3}i[$i.CONN_TYPE]+=110}else i[$i.CONN_TYPE]+=100;return{addition:i}}getOutboundStats(e,t,n,i,s){if(!this.requestUploadStats||!this.requestLocalMedia)return;let o=this.requestLocalMedia();if(!o||o.length===0)return;let c,d,u;return o.forEach(p=>{let[m,{track:g,ssrcs:T}]=p;switch(m){case $e.LocalVideoLowTrack:case $e.LocalVideoTrack:if(m===$e.LocalVideoTrack){var R;let I=(function(L,j,K,W,Y,se){let de=j.videoSend.find(ht=>ht.ssrc===L);if(!de)return;let ge={},{sentFrame:je,inputFrame:_t}=de;if(W&&(jt(ge,Oh.Video_Send_Qp_Sum,de.qpSumPerFrame),_t&&je)){let ht=_t.frameRate,Ct=je.frameRate;ge[Oh.Video_Send_Freeze]=(function(Ft,mn){let We=!0;return We=!(Ft<=5)&&(Ft<=10?mn<3:Ft<=20?mn<4:mn<5),We})(ht,Ct)?1:0}if(Y){switch(je&&(jt(ge,qt.Video_Send_Height,je.height),jt(ge,qt.Video_Send_Width,je.width),jt(ge,qt.Video_Send_Frame_Rate,je.frameRate)),ge[qt.Video_Send_Disabled]=K._originMediaStreamTrack&&!K._originMediaStreamTrack.enabled||K._mediaStreamTrack&&!K._mediaStreamTrack.enabled?1:0,de.adaptionChangeReason){case"none":ge[qt.Video_Send_Adaptation]=0;break;case"cpu":ge[qt.Video_Send_Adaptation]=1;break;case"bandwidth":ge[qt.Video_Send_Adaptation]=2;break;case"other":ge[qt.Video_Send_Adaptation]=3}let ht=0;de.adaptionChangeReason&&(ht+=OF(de.adaptionChangeReason)),j.qualityLimitationReason&&(ht+=OF(j.qualityLimitationReason)<<3),ge[qt.Video_Send_Adaptation]=ht,ge[qt.Video_Send_Player_Status]=Th[K._player?K._player.videoElementStatus:"uninit"],jt(ge,qt.Video_Send_Nacks,de.nacksCount),jt(ge,qt.Video_Send_Plis,de.plisCount),jt(ge,qt.Video_Send_Firs,de.firsCount),jt(ge,qt.Video_Send_Avg_Encode,de.avgEncodeMs),jt(ge,qt.Video_Send_Huge_Frame_Sent,de.hugeFramesSent),jt(ge,qt.Video_Send_Bytes_Retransmit,de.retransmittedBytesSent),jt(ge,qt.Video_Send_Packages_Retransmit,de.retransmittedPacketsSent),jt(ge,qt.Video_Send_Key_Frames_Encoded,de.keyFramesEncoded);let Ct=Y.videoSend.find(Ft=>Ft.ssrc===L);if(Ct){let Ft=w_*$g;Ct.timestamp&&de.timestamp&&(Ft=de.timestamp-Ct.timestamp),Ct.packets!=null&&de.packets!=null&&jt(ge,qt.Video_Send_Package_Rate,1e3*(de.packets-Ct.packets)/Ft),de.packetsLost!=null&&Ct.packetsLost!=null&&jt(ge,qt.Video_Send_Package_Lost,de.packetsLost-Ct.packetsLost),Ct.bytes!=null&&de.bytes!=null&&jt(ge,qt.Video_Send_Bitrate,8*(de.bytes-Ct.bytes)/Ft)}}return ge})(T[0].ssrcId,e,g,t,n),A=g.__className__==="CameraVideoTrack"?3:Re(R=g._hints).call(R,rt.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==A||s)&&(this.needUploadStats={sendType:A},this.lastExtendStats.sendType=A);let w=g&&(function(L,j,K,W){let Y=j.videoSend.find(de=>de.ssrc===L);if(!Y)return null;let se={};if(W){let de=Y.inputFrame,ge=de&&de.height||K.videoHeight||0,je=de&&de.width||K.videoWidth||0,_t=de&&de.frameRate||0;jt(se,qt.Video_Capture_Height,ge),jt(se,qt.Video_Capture_Width,je),jt(se,qt.Video_Capture_Frame_Rate,_t)}return se})(T[0].ssrcId,e,g,!!n),k=(function(L,j){let K={};return j&&(jt(K,qt.Video_Send_Retransmit,L.bitrate.retransmit),jt(K,qt.Video_Send_Target_Encoded,L.bitrate.targetEncoded),jt(K,qt.Video_Send_Actual_Encoded,L.bitrate.actualEncoded),jt(K,qt.Video_Send_Transmit,L.bitrate.transmit),jt(K,qt.Video_Send_Bandwidth,L.sendBandwidth)),K})(e,!!n);d=Object.assign({},I,w,k)}else u=(function(I,A,w,k,L){let j=A.videoSend.find(W=>W.ssrc===I);if(!j)return;let K={};if(k){let W=j.sentFrame;W&&(jt(K,qt.Video_Send_Low_Height,W.height),jt(K,qt.Video_Send_Low_Width,W.width),jt(K,qt.Video_Send_Low_Frame_Rate,W.frameRate));let Y=k.videoSend.find(se=>se.ssrc===I);if(Y){let se=w_*O_;Y.timestamp&&j.timestamp&&(se=j.timestamp-Y.timestamp),Y.packets!=null&&j.packets!=null&&jt(K,qt.Video_Send_Low_Package_Rate,1e3*(j.packets-Y.packets)/se),j.packetsLost!=null&&Y.packetsLost!=null&&jt(K,qt.Video_Send_Low_Package_Lost,j.packetsLost-Y.packetsLost),Y.bytes!=null&&j.bytes!=null&&jt(K,qt.Video_Send_Low_Bitrate,8*(j.bytes-Y.bytes)/se)}}return K})(T[0].ssrcId,e,0,n);break;case $e.LocalAudioTrack:c=g&&(function(I,A,w,k,L,j){let K=A.audioSend.find(Y=>Y.ssrc===I);if(!K)return;let W={};if(L){W[qt.Audio_Send_Disabled]=w._originMediaStreamTrack&&!w._originMediaStreamTrack.enabled||w._mediaStreamTrack&&!w._mediaStreamTrack.enabled?1:0;let Y=100*w._source.getAccurateVolumeLevel(),se=K.inputLevel;if(se!=null){let ge=Math.ceil(50*Math.log10(100*se+1));jt(W,qt.Audio_Send_Level,ge)}jt(W,qt.Audio_Capture_PCM_Level,Y),jt(W,qt.Audio_Send_AEC_Return_Loss,K.aecReturnLoss),jt(W,qt.Audio_Send_AEC_Return_Loss_Enhancement,K.aecReturnLossEnhancement),jt(W,qt.Audio_Send_Bytes_Retransmit,K.retransmittedBytesSent),jt(W,qt.Audio_Send_Packages_Retransmit,K.retransmittedPacketsSent),W[qt.Audio_Send_Freeze]=0;let de=L.audioSend.find(ge=>ge.ssrc===I);if(de){let ge=w_*O_;de.timestamp&&K.timestamp&&(ge=K.timestamp-de.timestamp),de.bytes!=null&&K.bytes!=null&&jt(W,qt.Audio_Send_Bitrate,8*(K.bytes-de.bytes)/ge),de.packets!=null&&K.packets!=null&&jt(W,qt.Audio_Send_Package_Rate,1e3*(K.packets-de.packets)/ge)}}return W})(T[0].ssrcId,e,g,0,n)}}),{high:d,low:u,audio:c}}getInboundStats(e,t,n,i){if(!this.requestRemoteMedia)return;let s=this.requestRemoteMedia()||[],o=[];return s.forEach(c=>{let[d,u]=c,p={peer:d.uid};if(u.has(vt.VIDEO)&&d.videoTrack){let m=d._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(d._videoSSRC)||!1,g=d.videoTrack?(function(T,R,I,A,w,k,L,j){let K=R.videoRecv.find(ht=>ht.ssrc===T);if(!K)return;let W={},{receivedFrame:Y,outputFrame:se,decodeFrameRate:de}=K;jt(W,Vt.Video_Render_Frame_Rate_Decode,de),K.framesRateFirefox&&jt(W,Vt.Video_Recv_Frame_Rate,K.framesRateFirefox),Y&&jt(W,Vt.Video_Recv_Frame_Rate,Y.frameRate),jt(W,Vt.Video_Recv_Frame_Dropped,K.framesDroppedCount),jt(W,Vt.Video_Recv_Bytes_Retransmit,K.retransmittedBytesReceived),jt(W,Vt.Video_Recv_Packages_Retransmit,K.retransmittedPacketsReceived),jt(W,Vt.Video_Recv_Packages_Discarded,K.packetsDiscarded),jt(W,Vt.Video_Recv_Avg_Decode,K.avgDecodeMs),jt(W,Vt.Video_Recv_Avg_Processing_Delay,K.avgProcessingDelayMs),jt(W,Vt.Video_Recv_Avg_Assembly_Time,K.avgFramesAssembledFromMultiplePacketsMs),jt(W,Vt.Video_Recv_Avg_Inter_Frame_Delay,K.avgInterFrameDelayMs),jt(W,Vt.Video_Recv_Key_Frames_Decoded,K.keyFramesDecoded);let ge=j&&j.videoRecv.find(ht=>ht.ssrc===T);if(ge){let ht=R.timestamp-j.timestamp||w_;K.packetsLost!=null&&ge.packetsLost!=null&&jt(W,Vt.Video_Recv_Package_Lost,K.packetsLost-ge.packetsLost),ge.bytes!=null&&K.bytes!=null&&jt(W,Vt.Video_Recv_Bitrate,8*(K.bytes-ge.bytes)/ht),ge.packets!=null&&K.packets!=null&&jt(W,Vt.Video_Recv_Package_Rate,1e3*(K.packets-ge.packets)/ht)}let je=k&&k.videoRecv.find(ht=>ht.ssrc===T);if(je&&(jt(W,Oh.Video_Recv_Qp_Sum,K.qpSumPerFrame),W[Oh.Video_Recv_Freeze]=A&&lf.isRemoteVideoFreeze(I,K,je)?1:0),L){var _t;let ht=L.videoRecv.find(Ft=>Ft.ssrc===T);Y?(jt(W,qt.Video_Recv_Height,Y.height),jt(W,qt.Video_Recv_Width,Y.width)):I&&(jt(W,qt.Video_Recv_Height,I._videoHeight||0),jt(W,qt.Video_Recv_Width,I._videoWidth||0)),se&&jt(W,qt.Video_Recv_Frame_Rate_Output,se.frameRate);let Ct=(_t=I._player)===null||_t===void 0?void 0:_t.rendFrameRate.toFixed(0);if(Ct&&jt(W,qt.Video_Render_Frame_Rate_Render,+Ct),jt(W,qt.Video_Recv_Jitter_Buffer,K.jitterBufferMs),jt(W,qt.Video_Recv_Current_Delay,K.currentDelayMs),jt(W,qt.Video_Recv_Firs,K.firsCount),jt(W,qt.Video_Recv_Nacks,K.nacksCount),jt(W,qt.Video_Recv_Plis,K.plisCount),I){W[qt.Video_Recv_Disabled]=I._originMediaStreamTrack.enabled&&I._mediaStreamTrack.enabled?0:1;let Ft=I._player;if(Ft){let{freezeTimeCounterList:mn,renderFreezeAccTime:We,renderFreezeAccTime2:Se,videoElementStatus:we}=Ft;if(mn&&mn.length>0&&jt(W,Oh.Video_Render_Freeze_Time,mn.splice(0,1)[0]),w&&$l.visibility==="visible"&&we===qs.PLAYING&&on().supportRequestVideoFrameCallback){let be=Math.min(6e3,Se);Ft.renderFreezeAccTime2=Math.max(0,Se-be),jt(W,Oh.Video_Render_Freeze_Time_Render2,be);let M=Math.min(6e3,We);Ft.renderFreezeAccTime=Math.max(0,We-M),jt(W,Oh.Video_Render_Freeze_Time_Render,te("USE_NEW_RENDER_FREEZE_TIME")?be:M)}if(typeof K.totalFreezesDuration=="number"){let be=ht&&ht.totalFreezesDuration?K.totalFreezesDuration-ht.totalFreezesDuration:K.totalFreezesDuration;jt(W,qt.Video_Render_Freeze_Duration,1e3*be)}}}if(W[qt.Video_Recv_Player_Status]=Th[I._player?I._player.videoElementStatus:"uninit"],ht&&K.totalInterFrameDelay!==void 0&&K.totalSquaredInterFrameDelay!==void 0&&ht.totalInterFrameDelay!==void 0&&ht.totalSquaredInterFrameDelay!==void 0){let Ft=K.totalInterFrameDelay-ht.totalInterFrameDelay,mn=K.totalSquaredInterFrameDelay-ht.totalSquaredInterFrameDelay,We=K.framesDecodeCount-ht.framesDecodeCount,Se=Ft/We*1e3,we=Math.round(1e3*Math.sqrt((mn-Math.pow(Ft,2)/We)/We));!isNaN(we)&&Se+we>Math.max(3*Se,Se+150)&&(W[qt.Video_Recv_I_Frame_Delay]=we)}}return W})(d._videoSSRC,e,d.videoTrack,m===!0,this.needUploadRenderFreezeTime,t,n,i):void 0;g&&(p.video=g)}if(u.has(vt.AUDIO)&&d.audioTrack){let m=d.audioTrack?(function(g,T,R,I,A,w){let k=T.audioRecv.find(W=>W.ssrc===g);if(!k)return;let L={};jt(L,Vt.Audio_Recv_Jitter,k.jitterMs),jt(L,Vt.Audio_Recv_Bytes_Retransmit,k.retransmittedBytesReceived),jt(L,Vt.Audio_Recv_Packages_Retransmit,k.retransmittedPacketsReceived),jt(L,Vt.Audio_Recv_Packages_Discarded,k.packetsDiscarded),jt(L,Vt.Audio_Recv_Avg_Processing_Delay,k.avgProcessingDelayMs);let j=w&&w.audioRecv.find(W=>W.ssrc===g);if(j){let W=w_;k.packets!=null&&j.packets!=null&&jt(L,Vt.Audio_Recv_Package_Rate,1e3*(k.packets-j.packets)/W),k.packetsLost!=null&&j.packetsLost!=null&&jt(L,Vt.Audio_Recv_Package_Lost,k.packetsLost-j.packetsLost)}if(I){let{receivedFrames:W,droppedFrames:Y}=k;W!=null&&Y!=null&&(L[Oh.Audio_Recv_Freeze]=(K=W)===0||100*Y/K>20?1:0)}var K;if(A){let W=100*R._source.getAccurateVolumeLevel(),Y=k.outputLevel;if(Y!=null){let de=Math.ceil(50*Math.log10(100*Y+1));jt(L,qt.Audio_Render_Level,de)}jt(L,qt.Audio_Recv_PCM_Level,W),R&&(L[qt.Audio_Recv_Disabled]=R._originMediaStreamTrack.enabled&&R._mediaStreamTrack.enabled?0:1),jt(L,qt.Audio_Recv_Jitter_Buffer,k.jitterBufferMs),jt(L,qt.Audio_Recv_Current_Delay,k.jitterBufferMs),L[qt.Audio_Recv_Player_Status]=Th[Hc.getPlayerState(R.getTrackId())];let se=A.audioRecv.find(de=>de.ssrc===g);if(se){se.bytes!=null&&k.bytes!=null&&jt(L,qt.Audio_Recv_Bitrate,8*(k.bytes-se.bytes)/(w_*$g));let de=k.concealedSamples-se.concealedSamples;de>0&&jt(L,qt.Audio_Recv_Concealed_Samples,de);let ge=k.totalSamplesReceived-se.totalSamplesReceived;ge>0&&jt(L,qt.Audio_Recv_Total_Samples_Received,ge);let je=k.freezeSamples80-se.freezeSamples80;je>0&&jt(L,qt.Audio_Render_Freeze_Samples_80ms,je);let _t=k.freezeSamples200-se.freezeSamples200;_t>0&&jt(L,qt.Audio_Render_Freeze_Samples_200ms,_t);let ht=k.freezeMs80-se.freezeMs80;jt(L,qt.Audio_Render_Freeze_Time_80ms,ht<0?0:ht);let Ct=k.freezeMs200-se.freezeMs200;jt(L,qt.Audio_Render_Freeze_Time_200ms,Ct<0?0:Ct)}}return L})(d._audioSSRC,e,d.audioTrack,t,n,i):void 0;m&&(p.audio=m)}(p.video||p.audio)&&o.push(p)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,o}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;let e=(this.requestAllTracks()||[]).find(t=>t instanceof Rr);if(e&&e._external.getDenoiserStats){let t=e._external.getDenoiserStats();t&&this.requestUpload(Yt.DENOISER_STATS,t)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(t=>{this.requestUpload&&this.requestUpload(t.type,t.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[t,n]=e;n.has(vt.VIDEO)&&t.videoTrack&&t.videoTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)}),n.has(vt.AUDIO)&&t.audioTrack&&t.audioTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{let t=Date.now(),n={connectionInterval:te("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:t},i=[],s=this.requestAllTracks&&this.requestAllTracks()||[];for(let u of s)!u.muted&&u.enabled&&(i=i.concat(await u.getProcessorUsage()));let o=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(let[u,p]of o)p.has(vt.VIDEO)&&u.videoTrack&&(i=i.concat(await u.videoTrack.getProcessorUsage())),p.has(vt.AUDIO)&&u.audioTrack&&(i=i.concat(await u.audioTrack.getProcessorUsage()));if(i.length===0)return;n.details=(function(u,p){let m={};for(let{id:I,value:A,level:w,direction:k}of u){var g;let L=(g=p.get(I))!==null&&g!==void 0?g:0,j=A===2?L+te("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:L;var T,R;p.set(I,j),m[I]?(A===2&&(m[I].value=A),w>m[I].level&&(m[I].level=w),k==="remote"&&(m[I].remoteUidCount+=1),m[I].totalTs=(T=p.get(I))!==null&&T!==void 0?T:0):m[I]={value:A,level:w,remoteUidCount:k==="local"?0:1,totalTs:(R=p.get(I))!==null&&R!==void 0?R:0}}return Object.keys(m).map(I=>{let{level:A,value:w,totalTs:k}=m[I];return{id:I,level:A,value:w,totalTs:k}})})(i,e);let c=Date.now(),d=c>t?c:t+1;this.requestUpload&&this.requestUpload(Yt.EXTENSION_USAGE_STATS,{usageStats:n,sendTs:d})},te("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}let K4=te("ICE_RESTART_INTERVAL"),bP=new Map,Zm=new Map,Iu=[dt.UDP_TCP_RELAY,dt.TCP_RELAY,dt.RELAY],N_=te("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&on().supportPCSetConfiguration;function IP(r){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1],t=bP.get(r.id);t&&(window.clearTimeout(t),bP.delete(r.id));let n=Zm.get(r.id);e&&n&&n.index===Iu.length-1&&(V.debug("[".concat(r.id,"] reset ICE restart policy")),Zm.delete(r.id))}function DF(r,e,t){if(bP.size===0&&Zm.size===0&&(Array.isArray(te("RESTART_SEQUENCE"))&&te("RESTART_SEQUENCE").length>0&&!(function(c,d){if(c.length!==d.length)return!1;for(let u=0;u<c.length;u+=1){let p=c[u];if(c.filter(m=>m===p).length!==d.filter(m=>m===p).length)return!1}return!0})(Iu,te("RESTART_SEQUENCE"))&&(Iu=te("RESTART_SEQUENCE").filter(c=>{var d;if(Re(d=Object.values(dt)).call(d,c))return!0}),V.debug("use reconnection policy from config distribution, queues: ".concat(Iu.join(" => ")))),N_=te("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&on().supportPCSetConfiguration),Iu.length===0)return void t();let n,{index:i=0,type:s}=Zm.get(r.id)||{};if(N_&&s===dt.RELAY)return void t();let o=s&&i>=Iu.length-1;if(N_)s=dt.RELAY;else{if(o)return void t();s?(i++,s=Iu[i]):(s=Iu[0],i=0)}V.debug("[".concat(r.id,"] choose ICE restart policy: ").concat(s,", index: ").concat(i)),e(s),Zm.set(r.id,{index:i,type:s}),n=window.setTimeout(()=>DF(r,e,t),K4),bP.set(r.id,n)}var Mn;function Un(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function df(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Un(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Un(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function uf(r){var e,t,n,i=2;for(typeof Symbol<"u"&&(t=lC,n=Symbol.iterator);i--;){if(t&&(e=r[t])!=null)return e.call(r);if(n&&(e=r[n])!=null)return new d0(e.call(r));t="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function d0(r){function e(t){if(Object(t)!==t)return De.reject(new TypeError(t+" is not an object."));var n=t.done;return De.resolve(t.value).then(function(i){return{value:i,done:n}})}return d0=function(t){this.s=t,this.n=t.next},d0.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var n=this.s.return;return n===void 0?De.resolve({value:t,done:!0}):e(n.apply(this.s,arguments))},throw:function(t){var n=this.s.return;return n===void 0?De.reject(t):e(n.apply(this.s,arguments))}},new d0(r)}let eS=(Mn=class extends Sr{get state(){return this._state}set state(r){let e=this._state;this._state=r,this.emit(ut.StateChange,e,this._state)}constructor(r,e){super(),Z(this,"isPlanB",void 0),Z(this,"store",void 0),Z(this,"statsUploader",void 0),Z(this,"connection",void 0),Z(this,"localTrackMap",new Map),Z(this,"remoteUserMap",new Map),Z(this,"localDataChannels",[]),Z(this,"remoteDataChannelMap",new Map),Z(this,"pendingLocalTracks",[]),Z(this,"pendingRemoteTracks",[]),Z(this,"pendingLocalDataChannels",[]),Z(this,"pendingRemoteDataChannels",[]),Z(this,"statsCollector",void 0),Z(this,"shouldForwardP2PCreation",void 0),Z(this,"iceFailedCount",0),Z(this,"dtlsFailedCount",0),Z(this,"mutex",void 0),Z(this,"_state",He.Disconnected),Z(this,"_pcStatsUploadType",te("NEW_ICE_RESTART")?As.FIRST_CONNECTION:As.OLD_FIRST_CONNECTION),Z(this,"_isStartRestartIce",!1),Z(this,"_restartTimer",void 0),Z(this,"_isTryConnecting",!1),Z(this,"_iceError",null),Z(this,"_forceTurn",!1),Z(this,"_isWaitPcToRePub",!1),Z(this,"handleMuteLocalTrack",async(t,n,i)=>{let s=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==He.Connected)return void i(new H(z.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let o=this.filterTobeMutedTracks(t);if(o.length===0)return void n();let c=o.find(u=>u[0]==="videoLowTrack");if(c){let u=c[1];this.store.enableInstantMuteRestore?(u.track._originMediaStreamTrack.enabled=!1,V.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):u.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?V.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(o.map(u=>{let[,{id:p}]=u;return p}));let d=this.createMuteMessage(o);await On(this,ut.RequestMuteLocal,d),n()}catch(o){i(o)}finally{s()}}),Z(this,"handleUnmuteLocalTrack",async(t,n,i)=>{let s=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==He.Connected)return void i(new H(z.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let o=this.filterTobeUnmutedTracks(t);if(o.length===0)return void n();let c=o.find(u=>u[0]==="videoLowTrack");if(c){let u=c[1];if(this.store.enableInstantMuteRestore)u.track._originMediaStreamTrack.enabled=!0,V.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(u.track._originMediaStreamTrack.stop(),!te("DISABLE_DUAL_STREAM_USE_ENCODING")&&on().supportDualStreamEncoding){let p=t._mediaStreamTrack.clone();u.track._mediaStreamTrack=p,u.track._originMediaStreamTrack=p}else{let p=cc(t,Sc(this,ut.RequestLowStreamParameter));u.track._mediaStreamTrack=p,u.track._originMediaStreamTrack=p}await new De((p,m)=>{this.handleReplaceTrack(u.track,p,m,!0)})}}this.store.enableInstantMuteRestore?V.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(o.map(u=>{let[,{id:p}]=u;return p}));let d=this.createUnmuteMessage(o);await On(this,ut.RequestUnmuteLocal,d),n()}catch(o){i(o)}finally{s()}}),Z(this,"handleUpdateVideoEncoder",async(t,n,i,s)=>{let o;s||(o=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{let d=this.localTrackMap.get($e.LocalVideoTrack);if(!this.connection||!d||d.track!==t||this.state!==He.Connected)return void n();let{id:u,track:p}=d;await this.connection.updateSendParameters(u,p),await this.connection.updateEncoderConfig(u,p),this.emit(ut.UpdateVideoEncoder,p),n()}catch(d){i(d)}finally{var c;(c=o)===null||c===void 0||c()}}),Z(this,"handleUpdateVideoSendParameters",async(t,n,i)=>{let s=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let o=this.localTrackMap.get($e.LocalVideoTrack);if(!this.connection||!o||o.track!==t||this.state!==He.Connected)return void n();let{id:c,track:d}=o;await this.connection.updateSendParameters(c,d),n()}catch(o){i(o)}finally{s()}}),Z(this,"handleReplaceMixingTrack",async(t,n,i,s)=>{if(!this.connection||this.state!==He.Connected)return void n();let o=c0([t]),c;V.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(o.getTrackId(),"]")),typeof s=="boolean"&&s||(c=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(t,o),n()}catch(u){i(u)}finally{var d;(d=c)===null||d===void 0||d()}}),Z(this,"handleReplaceTrack",async(t,n,i,s)=>{let o;V.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(t.getTrackId(),"]")),typeof s=="boolean"&&s||(o=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var c;let u=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:m}]=p;return t===m});if(!this.connection||!u||this.state!==He.Connected)return void n();if(await((c=this.connection)===null||c===void 0?void 0:c.replaceTrack(t,u[1].id)),this.isPlanB){let p=u[1];p.id=t._mediaStreamTrack.id,this.localTrackMap.set(u[0],p)}if(u[0]===$e.LocalVideoTrack&&!te("DISABLE_DUAL_STREAM_USE_ENCODING")&&on().supportDualStreamEncoding){let p=this.localTrackMap.get($e.LocalVideoLowTrack);if(p){let m=t._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m,await new De((g,T)=>{this.handleReplaceTrack(p.track,g,T,!0)})}}n()}catch(u){i(u)}finally{var d;(d=o)===null||d===void 0||d()}}),Z(this,"handleGetRTCStats",t=>{t(this.statsCollector.getRTCStats())}),Z(this,"handleGetLocalVideoStats",t=>{t(this.statsCollector.getLocalVideoTrackStats())}),Z(this,"handleGetLocalAudioStats",t=>{t(this.statsCollector.getLocalAudioTrackStats())}),Z(this,"handleGetRemoteVideoStats",t=>this.statsCollector.getRemoteVideoTrackStats(t.uid)[t.uid]),Z(this,"handleGetRemoteAudioStats",t=>this.statsCollector.getRemoteAudioTrackStats(t.uid)[t.uid]),this.store=r,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new NF(this.store),this.bindStatsUploaderEvents(),this.mutex=new ha("P2PChannel-mutex",this.store.clientId),this.isPlanB=!on().supportUnifiedPlan||te("CHROME_FORCE_PLAN_B")&&Xp(),this.shouldForwardP2PCreation=te("FORWARD_P2P_CREATION")&&on().supportPCSetConfiguration&&RD(),this.shouldForwardP2PCreation&&(this.connection=yP(this.store),this.emit(ut.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(r,e){var t;this.state=He.New,this._forceTurn=RP(r),V.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));let n=this.shouldForwardP2PCreation&&((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||n||e)&&((n||e)&&this.connection&&(V.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=yP(this.store,r),this.emit(ut.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new H(z.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=te("NEW_ICE_RESTART")?As.FIRST_CONNECTION:As.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(r),this.connection.establishPromise}async connect(r){if(!this.connection)throw new H(z.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===He.Connected){if(this.connection instanceof na&&this.connection.checkDtlsParameters(r.dtlsParameters.fingerprints))return V.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),Ye.reportApiInvoke(this.store.sessionId,{name:Zr.MISMATCH_DTLS_PARAMETERS,options:[r.dtlsParameters.fingerprints],tag:Cn.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(ut.RequestReconnect)});await this.connection.updateRemoteConnect(r)}else this.store.peerConnectionStart(),await this.connection.connect(r),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=He.Connected}updateRemoteRTPCapabilities(r){let e=Array.from(this.localTrackMap.entries()).filter(i=>{var s;let[o]=i;return Re(s=[$e.LocalVideoLowTrack,$e.LocalVideoTrack]).call(s,o)}),t=e.map(i=>{let[,{id:s}]=i;return s}),n=e.map(i=>{let[s]=i;return s});if(this.connection instanceof na){if(Ye.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(n),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(r)}),!Re(r).call(r,this.store.codec)){let i=["vp9","vp8","h264"].find(s=>Re(r).call(r,s));i&&(this.store.codec=i,V.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i,".")))}this.connection.updateRemoteRTPCapabilities(t,r)}}async getEstablishParams(){var r;if(this.connection instanceof na&&this.connection.peerConnectionState!=="closed"&&Re(r=[He.New,He.Connected]).call(r,this.state))return this.connection.establishPromise}async publishDataChannel(r){if(!this.connection||this.state!==He.Connected){if(this.state===He.Disconnected)throw new H(z.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return r.forEach(t=>{var n;Re(n=this.pendingLocalDataChannels).call(n,t)||this.pendingLocalDataChannels.push(t)}),[]}let e=this.filterTobePublishedDataChannels(r);return e.length===0?[]:(e.forEach(t=>{let n=Date.now();this.store.publish(t.id.toString(),"datachannel",n)}),await this.connection.createDataChannels(this.store.uid,e),e.forEach(t=>{this.localDataChannels.push(t);let n=Date.now();this.store.publish(t.id+"","datachannel",void 0,n)}),r.map(t=>({streamId:t.id,ordered:t.ordered,maxRetransmits:t.maxRetransmits,metadata:t.metadata,channelId:t._originDataChannelId})))}publish(r,e,t){var n=this;return zl(function*(){let i=yield zn(n.mutex.lock("From P2PChannel.publish"));try{var s;let o=n.connection&&Re(s=["disconnected","failed"]).call(s,n.connection.peerConnectionState);if(!n.connection||n.state!==He.Connected||o){if(n.state===He.Disconnected)throw new H(z.UNEXPECTED_ERROR,"PeerConnection already disconnected.");n.throwIfTrackTypeNotMatch(r);let d=r.filter(u=>n.pendingLocalTracks.indexOf(u)===-1);return n.pendingLocalTracks=n.pendingLocalTracks.concat(d),void(o&&(n._isWaitPcToRePub=!0))}n.store.pubId=n.store.pubId+1,ta.markPublishStart(n.store.clientId,n.store.pubId);let c=n.filterTobePublishedTracks(r,e,t);if(c.length===0)return void(yield zn(n.tryToUnmuteAudio(r)));yield*Jn(uf(n.doPublish(n.connection,c)))}finally{i()}})()}doPublish(r,e){var t=this;return zl(function*(){e.forEach(g=>{let{track:T,type:R}=g,I=Date.now();t.store.publish(T.getTrackId(),R===$e.LocalAudioTrack?"audio":"video",I)}),t.bindLocalTrackEvents(e);let n=e.map(g=>{let{track:T}=g;return T}),i=yield zn(r.send(n,t.store.codec,t.store.audioCodec)),s=(yield zn(i.next())).value,o=t.createGatewayPublishMessage(e,s),c;try{c=yield o}catch(g){throw i.throw(g),g?.code===z.WS_ABORT&&e.forEach(T=>{let{track:R}=T;t.pendingLocalTracks.indexOf(R)===-1&&t.pendingLocalTracks.push(R)}),t.unbindLocalTrackEvents(e),g}let d=t.mapPubResToRemoteConfig(o,c,n),u=(yield zn(i.next(d))).value;if(t.state===He.Disconnected)throw new H(z.UNEXPECTED_ERROR,"PeerConnection already disconnected.");te("ENABLE_VIDEO_SEI");let p=te("ENABLE_ENCODED_TRANSFORM"),m=te("ENABLE_AUDIO_METADATA");n.forEach(async g=>{let T=g.getRTCRtpTransceiver();if(!T||!p)return;let{interceptLocalVideoFrame:R,interceptLocalAudioFrame:I}=r0();g.trackMediaType===vt.VIDEO?await R(T.sender,g):g.trackMediaType===vt.AUDIO&&await I(T.sender,{metadata:m?()=>{let A=g.metadata.shift();return A&&A.value}:void 0})}),e.forEach(g=>{let{type:T}=g;t.statsCollector.addLocalStats(T)}),t.assignLocalTracks(e,u),t.statsUploader.startUploadOutboundStats(),e.forEach(g=>{let{track:T,type:R}=g,I=Date.now();t.store.publish(T.getTrackId(),R===$e.LocalAudioTrack?"audio":"video",void 0,I)})})()}async updateVideoStreamParameter(r,e){let t=this.localTrackMap.get(e);if(!t||!this.connection)return;if(!(t.track instanceof Ei))return V.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");let{track:n}=t,i=(function(s,o){let c={};return s.height&&s.width&&(c.scaleResolutionDownBy=lP(s,o)),c.maxFramerate=s.framerate?zc(s.framerate):void 0,c.maxBitrate=s.bitrate?1e3*s.bitrate:void 0,c})(r,n);if(n._encoderConfig||(n._encoderConfig={}),e!==$e.LocalVideoLowTrack||!te("DISABLE_DUAL_STREAM_USE_ENCODING")&&on().supportDualStreamEncoding)i.scaleResolutionDownBy!=null&&(n._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{let s=n._originMediaStreamTrack;if(!s.canvas)return V.warn("[".concat(n.getTrackId(),"] no canvas on track"));(function(o,c){let d=o.canvas;c.width&&(d.width=zc(c.width)),c.height&&(d.height=zc(c.height)),c.framerate&&(d.stopCapture&&d.stopCapture(),d.stopCapture=kw(()=>{!d.startCapture&&d.stopCapture&&d.stopCapture(),d.startCapture&&d.startCapture()},zc(c.framerate)))})(s,r)}i.maxBitrate!=null&&(n._encoderConfig.bitrateMax=i.maxBitrate/1e3),i.maxFramerate!=null&&(n._encoderConfig.frameRate&&typeof n._encoderConfig.frameRate=="object"?n._encoderConfig.frameRate.max=i.maxFramerate:n._encoderConfig.frameRate={max:i.maxFramerate}),V.debug("[".concat(n.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(n._encoderConfig))),await this.connection.updateRtpSenderEncodings(n)}publishLowStream(r){var e=this;return zl(function*(){if(!e.connection||e.state!==He.Connected)return;let t=yield zn(e.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let i=e.localTrackMap.get($e.LocalVideoTrack);if(!i)throw new H(z.UNEXPECTED_ERROR,"Could not find high stream");if(e.localTrackMap.has($e.LocalVideoLowTrack))throw new H(z.UNEXPECTED_ERROR,"[".concat(e.store.clientId,"] Can't publish low stream when stream already publish"));let s=[{track:e.getLowVideoTrack(i.track,r),type:$e.LocalVideoLowTrack}];if(yield*Jn(uf(e.doPublish(e.connection,s))),i.track.muted||!i.track.enabled){var n;let o=(n=e.localTrackMap.get($e.LocalVideoLowTrack))===null||n===void 0?void 0:n.id;o!==void 0&&(yield zn(e.connection.muteLocal([o])))}}finally{t()}})()}async republish(){this.pendingLocalTracks.length>0&&(V.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Ys(this,ut.RequestRePublish,this.pendingLocalTracks),this.emit(ut.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(V.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await Ys(this,ut.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(r){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){let{user:t,kind:n}=this.pendingRemoteTracks[e];(n!==vt.AUDIO||t._audio_added_&&t._audioSSRC)&&(n!==vt.VIDEO||t._video_added_&&t._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(r)await Ys(this,ut.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:e,kind:t}of this.pendingRemoteTracks)await this.subscribe(e,t,t===vt.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:t}=e;this.emit(ut.MediaReconnectEnd,t.uid)}),this.pendingRemoteTracks=[]}async unpublish(r){if(!this.connection||this.state!==He.Connected)return void r.forEach(n=>{let i=this.pendingLocalTracks.indexOf(n);i!==-1&&this.pendingLocalTracks.splice(i,1)});let e=this.filterTobeUnpublishedTracks(r);if(e.length===0)return;let t=e.find(n=>n[0]==="videoLowTrack");return t&&t[1].track.close(),this.doUnpublish(this.connection,e)}async unpublishDataChannel(r){if(!this.connection||this.state!==He.Connected)return void r.forEach(t=>{let n=this.pendingLocalDataChannels.indexOf(t);n!==-1&&this.pendingLocalDataChannels.splice(n,1)});let e=this.filterTobeUnpublishedDataChannels(r);return e.length!==0?(e.forEach(t=>{let n=this.localDataChannels.indexOf(t);n!==-1&&this.localDataChannels.splice(n,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),e.map(t=>t.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==He.Connected)return;let r=this.localTrackMap.get($e.LocalVideoLowTrack);if(!r)return;r.track.close();let e=[[$e.LocalVideoLowTrack,r]];return this.doUnpublish(this.connection,e)}async doUnpublish(r,e){let t=this.createGatewayUnpublishMessage(e);return await r.stopSending(e.map(n=>{let[,{id:i}]=n;return i})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(n=>{let[i,{track:s}]=n;return{type:i,track:s}})),e.forEach(n=>{let[i]=n;this.statsCollector.removeLocalStats(i)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),t}async subscribeDataChannel(r,e){if(!this.connection||this.state!==He.Connected)throw new H(z.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let t=e.filter(n=>{var i;return!((i=this.remoteDataChannelMap.get(r))!==null&&i!==void 0&&i.get(n.id))});if(t.length!==0)return await this.connection.createDataChannels(r.uid,t),t.forEach(n=>{var i;this.remoteDataChannelMap.has(r)?(i=this.remoteDataChannelMap.get(r))===null||i===void 0||i.set(n.id,n):this.remoteDataChannelMap.set(r,new Map([[n.id,n]]));let s=this.pendingRemoteDataChannels.findIndex(o=>{let{user:c,id:d}=o;return c.uid===r.uid&&d===n.id});s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),t.map(n=>n.id)}async subscribe(r,e,t,n,i){var s;if(!this.connection||this.state!==He.Connected)throw new H(z.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((s=this.remoteUserMap.get(r))!==null&&s!==void 0&&s.has(e))return;let o,c,d,u,p=this.connection.getPreMedia(t);if(p)V.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(t,", no need to send sub to gateway.")),d=p.transceiver,o=p.track,c=p.mid,u=p.player,p.firstVideoRender&&this.store.firstVideoFrameDecoded(r.uid,{firstPreRender:p.firstVideoRender});else if(i){let T=i.find(I=>{let{stream_type:A}=I;return A===e});if(!T)throw new H(z.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(e," for user: ").concat(r.uid," because subscribe answer from gateway does not contain stream_type: ").concat(e,"."));let R=await this.connection.receive(e,T.ssrcs,String(r._uintid),T.attributes);this.connection instanceof na&&(d=R.transceiver),o=R.track,c=R.id}else{let T=await this.connection.receive(e,[{ssrcId:t,rtx:n}],String(r._uintid),void 0);this.connection instanceof na&&(d=T.transceiver),o=T.track,c=T.id}if(e===vt.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(o):(r._audioTrack=new tf(o,r.uid,r._uintid,this.store),V.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),d&&r._audioTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(o):(r._videoTrack=new Iv(o,r.uid,r._uintid,this.store,u),V.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId())),r._videoTrack.once(Tc.PLAY_START,()=>{this.store.firstVideoFrameDecoded(r.uid,{playStart:Date.now()})}),r._videoTrack.once(Tc.PLAY_END,()=>{this.store.firstVideoFrameDecoded(r.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(r)}),u?r._videoTrack.once(Tc.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(r.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(r)}):r._videoTrack.once(Tc.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(r.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(r)})),d&&r._videoTrack._updateRtpTransceiver(d),this.bindRemoteTrackEvents(r,r._videoTrack)),d&&te("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:T,interceptRemoteAudioFrame:R}=r0();e==vt.VIDEO?await T(d.receiver,{onSei:te("ENABLE_VIDEO_SEI")&&(I=>{var A;return(A=r._videoTrack)===null||A===void 0?void 0:A._onSei(I)})}):e==vt.AUDIO&&await R(d.receiver,{enableTopn:!!te("ENABLE_AUDIO_TOPN"),enableMetadata:!!te("ENABLE_AUDIO_METADATA"),enablePts:!!te("ENABLE_AUDIO_PTS"),onMetadata:I=>{this.safeEmit(ut.AudioMetadata,I)},onPts:I=>{this.safeEmit(ut.AudioPts,I)}})}let m=this.remoteUserMap.get(r);m?m.set(e,c):this.remoteUserMap.set(r,new Map([[e,c]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadInboundStats();let g=this.pendingRemoteTracks.findIndex(T=>{let{user:R,kind:I}=T;return R.uid===r.uid&&e===I});g!==-1&&(this.pendingRemoteTracks.splice(g,1),this.emit(ut.MediaReconnectEnd,r.uid))}async massSubscribe(r){return this.massSubscribeNoLock(r)}async massSubscribeNoLock(r){if(!this.connection||this.state!==He.Connected)throw new H(z.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");r=r.filter(i=>{var s;let{user:o,mediaType:c}=i;return!((s=this.remoteUserMap.get(o))!==null&&s!==void 0&&s.has(c))});let e=[],t=new Map;r.forEach(i=>{if(!this.connection)return;let s=this.connection.getPreMedia(i.ssrcId);if(s){let{track:o,mid:c,transceiver:d,player:u}=s;t.set(i.ssrcId,{track:o,id:c,transceiver:d,player:u})}else e.push(i)});let n=await this.connection.batchReceive(e.map(i=>{let{user:s,mediaType:o,ssrcId:c,rtxSsrcId:d}=i;return{kind:o,ssrcMsg:[{ssrcId:c,rtx:d}],mslabel:String(s._uintid)}}));e.forEach((i,s)=>{t.set(i.ssrcId,n[s])});for(let{user:i,mediaType:s,ssrcId:o}of r){let c=t.get(o);if(!c)return void V.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(i.uid," subscribe data,").concat(s,", ").concat(o));let{track:d,id:u,transceiver:p,player:m}=c;if(p&&te("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:R,interceptRemoteAudioFrame:I}=r0();s==vt.VIDEO?await R(p.receiver,{onSei:te("ENABLE_VIDEO_SEI")&&(A=>{var w;return(w=i._videoTrack)===null||w===void 0?void 0:w._onSei(A)})}):s==vt.AUDIO&&await I(p.receiver,{enableTopn:!!te("ENABLE_AUDIO_TOPN"),enableMetadata:!!te("ENABLE_AUDIO_METADATA"),enablePts:!!te("ENABLE_AUDIO_PTS"),onMetadata:A=>{this.safeEmit(ut.AudioMetadata,A)},onPts:A=>{this.safeEmit(ut.AudioPts,A)}})}if(s===vt.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(d):(i._audioTrack=new tf(d,i.uid,i._uintid,this.store),V.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),p&&i._audioTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(d):(i._videoTrack=new Iv(d,i.uid,i._uintid,this.store,m),V.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),p&&i._videoTrack._updateRtpTransceiver(p),this.bindRemoteTrackEvents(i,i._videoTrack)),te("ENABLE_VIDEO_SEI")&&p){let{interceptRemoteVideoFrame:R,interceptRemoteAudioFrame:I}=r0();s==vt.VIDEO?await R(p.receiver,{onSei:A=>{var w;(w=i._videoTrack)===null||w===void 0||w._onSei(A)}}):s==vt.AUDIO&&await I(p.receiver)}let g=this.remoteUserMap.get(i);g?g.set(s,u):this.remoteUserMap.set(i,new Map([[s,u]])),this.statsCollector.addRemoteStats(i.uid),this.statsUploader.startUploadInboundStats();let T=this.pendingRemoteTracks.findIndex(R=>{let{user:I,kind:A}=R;return I.uid===i.uid&&s===A});T!==-1&&(this.pendingRemoteTracks.splice(T,1),this.emit(ut.MediaReconnectEnd,i.uid))}}async unsubscribe(r,e,t){let n=this.pendingRemoteTracks.filter(o=>{let{user:c,kind:d}=o;return e!==void 0?c.uid===r.uid&&e===d:c.uid===r.uid});if(n.forEach(o=>{let c=this.pendingRemoteTracks.indexOf(o);this.pendingRemoteTracks.splice(c,1)}),this.connection&&this.state===He.Connected||t||n.forEach(o=>{let{kind:c}=o;var d;if(c===vt.AUDIO)(d=r._audioTrack)===null||d===void 0||d._destroy(),r._audioTrack=void 0;else if(c===vt.VIDEO){var u;(u=r._videoTrack)===null||u===void 0||u._destroy(),r._videoTrack=void 0}}),!this.connection||this.state!==He.Connected)return;let i=this.filterTobeUnSubscribedTracks(r,e);if(i.length===0)return;await this.connection.stopReceiving(i.map(o=>{let[,{id:c}]=o;return c}));let s=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(o=>{let[c,{kind:d}]=o;var u,p;if(d===vt.VIDEO&&c._videoSSRC&&((u=this.connection)===null||u===void 0||u.setStatsRemoteVideoIsReady(c._videoSSRC,!1)),d===vt.VIDEO)this.unbindRemoteTrackEvents(c._videoTrack),t||((p=c._videoTrack)===null||p===void 0||p._destroy(),c._videoTrack=void 0);else if(d===vt.AUDIO){var m;this.unbindRemoteTrackEvents(c._audioTrack),!t&&((m=c._audioTrack)===null||m===void 0||m._destroy(),c._audioTrack=void 0)}}),s}async unsubscribeDataChannel(r,e){if(e.forEach(i=>{let s=this.pendingRemoteDataChannels.findIndex(o=>o.id===i.id);s!==-1&&this.pendingRemoteDataChannels.splice(s,1)}),!this.connection)return;let t=this.filterTobeUnSubscribedDataChannels(r,e);if(t.length===0)return;e.forEach(i=>{i._close()});let n=this.remoteDataChannelMap.get(r);return t.forEach(i=>{n&&n.delete(i.id)}),n&&n.size===0&&(this.remoteDataChannelMap.delete(r),await this.connection.stopDataChannels(r.uid)),t.map(i=>i.id)}async massUnsubscribe(r){return this.massUnsubscribeNoLock(r)}async massUnsubscribeNoLock(r){let e=[];for(let{user:i,mediaType:s}of r){let o=this.pendingRemoteTracks.filter(c=>{let{user:d,kind:u}=c;return s!==void 0?d.uid===i.uid&&s===u:d.uid===i.uid});o.forEach(c=>{let d=this.pendingRemoteTracks.indexOf(c);this.pendingRemoteTracks.splice(d,1)}),e=e.concat(o)}if(!this.connection||this.state!==He.Connected)return void e.forEach(i=>{let{user:s,kind:o}=i;var c;if(o===vt.AUDIO)(c=s._audioTrack)===null||c===void 0||c._destroy(),s._audioTrack=void 0;else if(o===vt.VIDEO){var d;(d=s._videoTrack)===null||d===void 0||d._destroy(),s._videoTrack=void 0}});let t=Ks(r).call(r,(i,s)=>{let{user:o,mediaType:c}=s,d=this.filterTobeUnSubscribedTracks(o,c);return i.concat(d)},[]);if(t.length===0)return;await this.connection.stopReceiving(t.map(i=>{let[,{id:s}]=i;return s}));let n=this.createUnsubscribeAllMessage(t);return this.withdrawRemoteTracks(t),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),t.forEach(i=>{let[s,{kind:o}]=i;var c,d;if(o===vt.VIDEO&&s._videoSSRC&&((c=this.connection)===null||c===void 0||c.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),o===vt.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),(d=s._videoTrack)===null||d===void 0||d._destroy(),s._videoTrack=void 0;else if(o===vt.AUDIO){var u;this.unbindRemoteTrackEvents(s._audioTrack),(u=s._audioTrack)===null||u===void 0||u._destroy(),s._audioTrack=void 0}}),n}isPreSubScribe(r){return!this.connection||this.state!==He.Connected?!1:!!this.connection.getPreMedia(r)}async muteRemote(r,e){if(!this.connection)return;let t=this.remoteUserMap.get(r);if(!t)return void V.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(r.uid,"."));if(!t.get(e))return void V.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(r.uid," media type ").concat(e,"."));let n=e===vt.VIDEO?r._videoSSRC:r._audioSSRC;n!==void 0&&this.connection.setStatsRemoteVideoIsReady(n,!1)}async unmuteRemote(r,e){return this.unmuteRemoteNoLock(r,e)}async unmuteRemoteNoLock(r,e){if(!this.connection)return;let t=this.remoteUserMap.get(r);if(!t)return void V.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(r.uid,"."));t.get(e)||V.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(r.uid," media type ").concat(e,"."))}addAudioMetadata(r){let e=this.localTrackMap.get($e.LocalAudioTrack),t=e&&e.track;t&&t.metadata.push(r)}getAllTracks(r){let e=this.localTrackMap.get($e.LocalAudioTrack);if(e?.track instanceof Xs){let t=e.track;return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return i!==$e.LocalAudioTrack}).filter(n=>{let[i]=n;return!(r&&i===$e.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i}).concat(t.trackList)}return Array.from(this.localTrackMap.entries()).filter(t=>{let[n]=t;return!(r&&n===$e.LocalVideoLowTrack)}).map(t=>{let[,{track:n}]=t;return n})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(r,e,t,n,i){if(r){let o=this.localTrackMap.get($e.LocalAudioTrack),c=n?this.localTrackMap.get($e.LocalVideoLowTrack):this.localTrackMap.get($e.LocalVideoTrack);Ye.publish(this.store.sessionId,{eventElapse:ta.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:r,ec:e,audioName:o?.track.getTrackLabel(),videoName:c?.track.getTrackLabel(),screenshare:c?.track._hints.indexOf(rt.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;t||(t=[]);let o=t.find(d=>d instanceof ci),c=n?(s=this.localTrackMap.get($e.LocalVideoTrack))===null||s===void 0?void 0:s.track:t.find(d=>d instanceof Ei);Ye.publish(this.store.sessionId,{eventElapse:ta.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:r,ec:e,audioName:o?.getTrackLabel(),videoName:c?.getTrackLabel(),screenshare:c?._hints.indexOf(rt.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(r,e,t,n){let i=n===vt.VIDEO?t._videoSSRC:t._audioSSRC;i&&Ye.subscribe(this.store.sessionId,{succ:r,ec:e,video:n===vt.VIDEO,audio:n===vt.AUDIO,peerid:t.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:ta.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){V.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new ha("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=yP(this.store),this.emit(ut.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let r=this.localTrackMap.get($e.LocalAudioTrack);if(r?.track instanceof Xs){if(r.track.trackList.length>0){let e=r.track;r.track.trackList.forEach(t=>{e.removeAudioTrack(t)})}r.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=He.Disconnected}getStats(){var r;return(r=this.connection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(r){var e;return((e=this.connection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(r))||!1}getLocalAudioVolume(){let r=this.localTrackMap.get($e.LocalAudioTrack);if(r)return r.track.getVolumeLevel()}getLocalVideoSize(){let r=this.localTrackMap.get($e.LocalVideoTrack);if(r)return{width:r.track.videoWidth||0,height:r.track.videoHeight||0}}getEncoderConfig(r){let e=this.localTrackMap.get(r);return e&&e.track instanceof Ei||e&&e.track instanceof ci?e.track._encoderConfig:void 0}getLocalMedia(r){return this.localTrackMap.get(r)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(r,e){if(!r)return this.remoteUserMap.size>0;let t=this.remoteUserMap.get(r);return!!t&&(!e||t.has(e))}async hasRemoteMediaWithLock(r,e){if(!r)return this.remoteUserMap.size>0;let t=this.remoteUserMap.get(r);return!!t&&(!e||t.has(e))}getRemoteMedia(r){var e;let t=Array.from(hl(e=this.remoteUserMap).call(e)).find(n=>n.uid===r);return t?{audioTrack:t.audioTrack,audioSSRC:t._audioSSRC,videoTrack:t.videoTrack,videoSSRC:t._videoSSRC}:{}}getAudioLevels(){let r=Array.from(this.remoteUserMap.entries()).map(t=>{let[n]=t;return{uid:n.uid,level:n.audioTrack?100*n.audioTrack._source.getAccurateVolumeLevel():0}}),e=this.localTrackMap.get($e.LocalAudioTrack);return e&&r.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),r=Zt(r).call(r,(t,n)=>t.level-n.level),r}async disconnectForReconnect(){this.connection&&(V.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=He.Reconnecting,te("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(r=>{let[e]=r;var t;e._videoTrack&&e._videoTrack._player&&((t=e._videoTrack._player.getVideoElement())===null||t===void 0||t.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=yP(this.store),this.emit(ut.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(r=>{var e;let[t,{track:n}]=r;switch(t){case $e.LocalVideoTrack:Re(e=n._hints).call(e,rt.LOW_STREAM)?n.close():this.pendingLocalTracks.push(n);break;case $e.LocalAudioTrack:n instanceof Xs?this.pendingLocalTracks=this.pendingLocalTracks.concat(n.trackList):this.pendingLocalTracks.push(n);case $e.LocalVideoLowTrack:}}),this.emit(ut.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(r=>{let[e,t]=r;Array.from(hl(t).call(t)).forEach(n=>{this.setPendingRemoteMedia(e,n)}),this.emit(ut.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(r=>{this.pendingLocalDataChannels.push(r)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(r=>{let[e,t]=r;Array.from(hl(t).call(t)).forEach(n=>{this.setPendingRemoteDataChannel(e,n)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),V.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(r,e){for(let t of this.pendingRemoteDataChannels){let{user:n,id:i}=t;if((r instanceof Xm?r.uid:r)===n.uid&&i===e)return!0}return!1}setPendingRemoteDataChannel(r,e){this.hasPendingRemoteDataChannel(r,e)||this.pendingRemoteDataChannels.push({user:r,id:e})}hasPendingRemoteMedia(r,e){for(let t of this.pendingRemoteTracks){let{user:n,kind:i}=t;if((r instanceof Xm?r.uid:r)===n.uid&&e===i)return!0}return!1}setPendingRemoteMedia(r,e){this.hasPendingRemoteMedia(r,e)||this.pendingRemoteTracks.push({user:r,kind:e})}restartICE(r){var e=this;return zl(function*(){if(!e.connection||e.state!==He.Connected)return;let t=yield zn(e.mutex.lock("From P2PChannel.restartICE")),n;try{n=yield zn(e.connection.restartICE(r));let s=yield zn(n.next());if(s.done)return;let o=s.value,c=yield o;switch(ZC(e.connection)&&e.reportPCStats(Date.now(),!1,e._pcStatsUploadType),r){case dt.UDP_TCP_RELAY:e._pcStatsUploadType=As.UDP_TCP_RESTART;break;case dt.TCP_RELAY:e._pcStatsUploadType=As.TCP_RESTART;break;case dt.RELAY:e._pcStatsUploadType=As.RELAY_RESTART;break;default:e._pcStatsUploadType=As.OLD_RESTART}e._isTryConnecting=!0,n.next(c)}catch(s){var i;(i=n)===null||i===void 0||i.throw(s)}finally{t()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;let r=this.connection.getStats(),e=this.localTrackMap.get($e.LocalVideoTrack),t=this.localTrackMap.get($e.LocalAudioTrack),n=r.videoSend.find(T=>T.ssrc===e?.ssrcs[0].ssrcId),i=r.audioSend.find(T=>T.ssrc===t?.ssrcs[0].ssrcId);if(!n||!i)return 1;let s=ei(this,ut.NeedSignalRTT),o=n?n.rttMs:void 0,c=i?i.rttMs:void 0,d=o&&c?(o+c)/2:o||c,u=(d&&s?(d+s)/2:d||s)||0,p=100*r.sendPacketLossRate*.7/50+.3*u/1500,m=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,g=e?.track;if(g&&g._encoderConfig&&g._hints.indexOf(rt.SCREEN_TRACK)===-1){let T=g._encoderConfig.bitrateMax,R=r.bitrate.actualEncoded;if(T&&R){let I=(1e3*T-R)/(1e3*T);return b4[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][m]}}return m}getDownlinkNetworkQuality(){if(!this.connection)return 0;let r=this.connection.getStats(),e=0;return Array.from(this.remoteUserMap.entries()).forEach(t=>{let[n]=t,i=n._audioSSRC,s=n._videoSSRC,o=r.audioRecv.find(R=>R.ssrc===i),c=r.videoRecv.find(R=>R.ssrc===s);if(!o&&!c)return void(e+=1);let d=ei(this,ut.NeedSignalRTT),u=r.rtt,p=(u&&d?(u+d)/2:u||d)||0,m=o?o.jitterMs:void 0,g=r.recvPacketLossRate,T=.7*g*100/50+.3*p/1500;m&&(T=.6*g*100/50+.2*p/1500+.2*m/400),e+=T<.1?1:T<.17?2:T<.36?3:T<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(r){return new De((e,t)=>{this.handleMuteLocalTrack(r,e,t)})}async replaceTrack(r,e){var t;if(V.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(r.getTrackId(),"] to [").concat(e.getTrackId(),"]")),!this.connection||this.state!==He.Connected)return;let n=Array.from(this.localTrackMap.entries()).find(s=>{let[,{track:o}]=s;return r===o});if(!n)return;let i=n[0];if(r!==e&&(this.unbindLocalTrackEvents([{track:r,type:i}]),this.bindLocalTrackEvents([{track:e,type:i}]),n[1].track=e),await((t=this.connection)===null||t===void 0?void 0:t.replaceTrack(e,n[1].id)),this.isPlanB){let s=n[1];s.id=e._mediaStreamTrack.id,this.localTrackMap.set(i,s)}if(i===$e.LocalVideoTrack&&!te("DISABLE_DUAL_STREAM_USE_ENCODING")&&on().supportDualStreamEncoding){let s=this.localTrackMap.get($e.LocalVideoLowTrack);if(s){let o=r._mediaStreamTrack.clone();s.track._originMediaStreamTrack.stop(),s.track._mediaStreamTrack=o,s.track._originMediaStreamTrack=o,await new De((c,d)=>{this.handleReplaceTrack(s.track,c,d,!0)})}}}filterTobePublishedTracks(r,e,t){let n=[],i=this.getAllTracks();r=Pm(r=r.filter(d=>i.indexOf(d)===-1));let s,o=!1,c=this.localTrackMap.get($e.LocalAudioTrack);for(let d of r){if(d instanceof Ei&&(this.localTrackMap.has($e.LocalVideoTrack)||o?new H(z.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(n.push({track:d,type:$e.LocalVideoTrack}),o=!0),e)){let u=this.getLowVideoTrack(d,t);n.push({track:u,type:$e.LocalVideoLowTrack})}if(d instanceof ci)if(c){let u=c.track;if(u instanceof Xs)AF([d]),u.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0);else{let p=c0([u,d]);V.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(p.getTrackId(),"]")),this.replaceTrack(u,p)}}else s instanceof Xs?(AF([d]),s.addAudioTrack(d)):s||!d._useAudioElement&&on().webAudioMediaStreamDest&&!d._bypassWebAudio?s=c0(s?[d,s]:[d]):s=d}return s&&(V.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(s.getTrackId(),"]")),n.push({track:s,type:$e.LocalAudioTrack})),n}filterTobeUnpublishedTracks(r){let e=[],t=this.getAllTracks();r=Pm(r=r.filter(n=>t.indexOf(n)!==-1));for(let n of r){if(n instanceof ci){let i=this.localTrackMap.get($e.LocalAudioTrack);if(!i)continue;i.track instanceof Xs?(i.track.removeAudioTrack(n),this.unbindLocalAudioTrackEvents(n),i.track.trackList.length===0&&(e.push([$e.LocalAudioTrack,i]),i.track.close())):e.push([$e.LocalAudioTrack,i])}if(n instanceof Ei){let i=this.localTrackMap.get($e.LocalVideoTrack);if(!i)continue;e.push([$e.LocalVideoTrack,i]);let s=this.localTrackMap.get($e.LocalVideoLowTrack);s&&e.push([$e.LocalVideoLowTrack,s])}}return e}filterTobePublishedDataChannels(r){return r=(r=Pm(r)).filter(e=>this.localDataChannels.findIndex(t=>t.id===e.id)===-1)}filterTobeUnpublishedDataChannels(r){return r=(r=(r=Pm(r)).filter(e=>this.localDataChannels.indexOf(e)!==-1)).filter(e=>e._originDataChannel)}bindLocalTrackEvents(r){r.forEach(e=>{let{track:t,type:n}=e;switch(n){case $e.LocalVideoTrack:t.addListener(It.GET_STATS,this.handleGetLocalVideoStats),t.addListener(It.GET_RTC_STATS,this.handleGetRTCStats),t.addListener(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(It.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(It.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(It.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case $e.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(r,e){r instanceof Xs?r.trackList.forEach(t=>{t.addListener(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(It.GET_STATS,this.handleGetLocalAudioStats),t.addListener(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(r.addListener(It.GET_STATS,this.handleGetLocalAudioStats),r.addListener(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||(r.addListener(It.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(It.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(r){r||(r=Array.from(this.localTrackMap.entries()).map(e=>{let[t,{track:n}]=e;return{track:n,type:t}})),r.forEach(e=>{let{track:t,type:n}=e;switch(n){case $e.LocalVideoTrack:t.off(It.GET_STATS,this.handleGetLocalVideoStats),t.off(It.GET_RTC_STATS,this.handleGetRTCStats),t.off(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(It.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(It.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(It.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case $e.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(r){r instanceof Xs?r.trackList.forEach(e=>{e.off(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(It.GET_STATS,this.handleGetLocalAudioStats),e.off(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(r.off(It.GET_STATS,this.handleGetLocalAudioStats),r.off(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(It.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(It.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),r.off(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(r,e){e instanceof Iv&&e.addListener(It.GET_STATS,t=>{t(this.handleGetRemoteVideoStats(r))}),e instanceof tf&&e.addListener(It.GET_STATS,t=>{t(this.handleGetRemoteAudioStats(r))})}unbindRemoteTrackEvents(r){r&&r.removeAllListeners(It.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(r=>{let[e,t]=r;t.has(vt.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),t.has(vt.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(r,e){return r.map((t,n)=>{var i;let s,o,{track:c,type:d}=t;switch(d){case $e.LocalAudioTrack:s=vi.Audio,o={dtx:c instanceof Rr&&c._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case $e.LocalVideoTrack:s=Re(i=c._hints).call(i,rt.SCREEN_TRACK)?vi.Screen:vi.High,o=df(df({},Sl(c)),{},{codec:this.store.codec,svc_mode:y_()});break;case $e.LocalVideoLowTrack:s=vi.Low,o=df(df({},Sl(c)),{},{codec:this.store.codec,svc_mode:y_()})}return{stream_type:s,attributes:o,ssrcs:e[n]}})}createGatewayUnpublishMessage(r){return r.map(e=>{var t;let n,[i,{track:s,ssrcs:o,id:c}]=e;switch(i){case $e.LocalVideoTrack:n=Re(t=s._hints).call(t,rt.SCREEN_TRACK)?vi.Screen:vi.High;break;case $e.LocalAudioTrack:n=vi.Audio;break;case $e.LocalVideoLowTrack:n=vi.Low}return{stream_type:n,ssrcs:o,mid:c}})}assignLocalTracks(r,e){r.forEach((t,n)=>{let{track:i,type:s}=t;this.localTrackMap.set(s,{track:i,id:e[n].id,ssrcs:e[n].localSSRC})})}withdrawLocalTracks(r){r.forEach(e=>{let[t]=e;this.localTrackMap.delete(t)})}bindConnectionEvents(r){r.onConnectionStateChange=async e=>{if(V.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(ut.PeerConnectionStateChange,e),e==="connecting"&&r instanceof na&&!jr()&&te("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{e==="connecting"&&r.extendCandidate()},te("FIRST_TCP_CANDIDATE_INTERVAL")),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),r instanceof na&&IP(r,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=As.DISCONNECTED_OR_FAILED,ei(this,ut.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){let t=this.pendingLocalTracks.map(i=>i.getTrackId()),n=this.pendingLocalDataChannels.map(i=>"dc_".concat(i.id));Ye.reportApiInvoke(this.store.sessionId,{name:Zr.REPUB_AFTER_PC_CONNECTED,options:t.concat(n),tag:Cn.TRACER}).onSuccess(),this.republish()}if(te("NEW_ICE_RESTART")&&r instanceof na&&!jr()&&!this._forceTurn){if(Re(T_).call(T_,e)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let t=i=>{ZC(r)&&(V.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(i)),ei(this,ut.QueryClientConnectionState)==="CONNECTED"&&this.emit(ut.RequestRestartICE,i))},n=()=>{ZC(r)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),V.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(ut.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{DF(r,t,n)},800))}}else{if(e==="disconnected"&&r.iceConnectionState==="disconnected")return setTimeout(()=>{r.iceConnectionState==="disconnected"&&te("ICE_RESTART")&&ei(this,ut.QueryClientConnectionState)==="CONNECTED"&&this.emit(ut.RequestRestartICE)},800),void setTimeout(()=>{r.peerConnectionState==="disconnected"&&(V.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(ut.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);e==="failed"&&(V.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(ut.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},r.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),V.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Ye.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:Cn.TRACER}).onSuccess(),this.emit(ut.IceConnectionStateChange,e)},r.onICETransportStateChange=e=>{V.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},r.onDTLSTransportStateChange=e=>{V.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},r.onDTLSTransportError=e=>{V.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},r.onFirstAudioDecoded=e=>{var t;let n=Array.from(hl(t=this.remoteUserMap).call(t)).find(s=>s._audioSSRC===e);var i;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),(i=n.audioTrack)===null||i===void 0||i.emit(Tc.FIRST_FRAME_DECODED),Ye.firstRemoteFrame(this.store.sessionId,so.FIRST_AUDIO_DECODE,Nn.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:ta.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},r.onFirstAudioReceived=e=>{var t;let n=Array.from(hl(t=this.remoteUserMap).call(t)).find(i=>i._audioSSRC===e);n&&Ye.firstRemoteFrame(this.store.sessionId,so.FIRST_AUDIO_RECEIVED,Nn.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:ta.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},r.onFirstVideoDecoded=(e,t,n)=>{var i;let s=Array.from(hl(i=this.remoteUserMap).call(i)).find(o=>o._videoSSRC===e);s&&this.store.firstVideoFrameDecoded(s.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(e,t,n)},r.onFirstVideoRender=e=>{var t;let n=Array.from(hl(t=this.remoteUserMap).call(t)).find(i=>i._videoSSRC===e);n&&(this.store.firstVideoFrameDecoded(n.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(n))},r.onFirstVideoReceived=e=>{var t;let n=Array.from(hl(t=this.remoteUserMap).call(t)).find(i=>i._videoSSRC===e);n&&(this.store.firstVideoFrameDecoded(n.uid,{firstReceived:Date.now()}),Ye.firstRemoteFrame(this.store.sessionId,so.FIRST_VIDEO_RECEIVED,Nn.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:ta.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},r.onSelectedLocalCandidateChanged=(e,t)=>{let n=e.candidateType==="relay",i=t.candidateType==="relay";t.candidateType!=="unknown"&&n===i||this.emit(ut.ConnectionTypeChange,n),V.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(v_(t))," -> ").concat(JSON.stringify(v_(e)),")"))},r.onSelectedRemoteCandidateChanged=(e,t)=>{V.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(v_(t))," -> ").concat(JSON.stringify(v_(e)),")"))},r.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},r.getLocalVideoStats=()=>{let e=this.statsCollector.getLocalVideoTrackStats(),t=this.statsCollector.getRTCStats();return df(df({},e),t)},r.onICECandidateError=e=>{this._iceError=e}}resetConnection(r){r instanceof na&&(function(e){Zm.delete(e.id),IP(e)})(r),r.close(),this.emit(ut.PeerConnectionStateChange,"closed"),(function(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.getLocalVideoStats=void 0})(r),this._isWaitPcToRePub=!1}filterTobeMutedTracks(r){let e=[];if(this.getAllTracks().indexOf(r)===-1)return e;let t=this.localTrackMap.get($e.LocalAudioTrack);if(r instanceof ci&&t?.track instanceof Xs)return t.track.isActive||e.push([$e.LocalAudioTrack,t]),e;let n=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return r===s});if(n&&(e.push(n),n[0]===$e.LocalVideoTrack)){let i=this.localTrackMap.get($e.LocalVideoLowTrack);i&&e.push([$e.LocalVideoLowTrack,i])}return e}filterTobeUnmutedTracks(r){let e=[],t=this.localTrackMap.get($e.LocalAudioTrack);if(r instanceof ci&&t?.track instanceof Xs)return t.track.isActive&&e.push([$e.LocalAudioTrack,t]),e;let n=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return r===s});if(n)if(n[0]===$e.LocalVideoTrack){e.push(n);let i=this.localTrackMap.get($e.LocalVideoLowTrack);i&&e.push([$e.LocalVideoLowTrack,i])}else e.push(n);return e}createMuteMessage(r){return r.map(e=>{var t;let n,[i,{track:s,ssrcs:o,id:c}]=e;switch(i){case $e.LocalAudioTrack:n=vi.Audio;break;case $e.LocalVideoTrack:n=Re(t=s._hints).call(t,rt.SCREEN_TRACK)?vi.Screen:vi.High;break;case $e.LocalVideoLowTrack:n=vi.Low}return{stream_type:n,ssrcs:o,mid:c}})}createUnmuteMessage(r){return r.map(e=>{var t;let n,[i,{track:s,ssrcs:o,id:c}]=e;switch(i){case $e.LocalAudioTrack:n=vi.Audio;break;case $e.LocalVideoTrack:n=Re(t=s._hints).call(t,rt.SCREEN_TRACK)?vi.Screen:vi.High;break;case $e.LocalVideoLowTrack:n=vi.Low}return{stream_type:n,ssrcs:o,mid:c}})}filterTobeUnSubscribedTracks(r,e){let t=[],n=this.remoteUserMap.get(r);if(!n)return t;if(e){let i=n.get(e);if(!i)return t;t.push([r,{kind:e,id:i}])}else Array.from(n.entries()).forEach(i=>{let[s,o]=i;t.push([r,{kind:s,id:o}])});return t}filterTobeUnSubscribedDataChannels(r,e){let t=[];return e.forEach(n=>{var i;(i=this.remoteDataChannelMap.get(r))!==null&&i!==void 0&&i.has(n.id)&&t.push(n)}),t}createUnsubscribeMessage(r){let e=[];return r.forEach(t=>{let[n,{kind:i,id:s}]=t;switch(i){case vt.VIDEO:return void(n._videoSSRC&&e.push({stream_type:vt.VIDEO,ssrcId:n._videoSSRC}));case vt.AUDIO:return void(n._audioSSRC&&e.push({stream_type:vt.AUDIO,ssrcId:n._audioSSRC}))}}),e}createUnsubscribeAllMessage(r){let e=new Map;return r.forEach(t=>{let[n,{kind:i}]=t;if(e.has(n)){let s=e.get(n);i===vt.VIDEO?s|=Ws.Video:s|=Ws.Audio,e.set(n,s)}else i===vt.VIDEO?e.set(n,Ws.Video):e.set(n,Ws.Audio)}),{users:Array.from(e.entries()).map(t=>{let[n,i]=t;return{stream_id:n.uid,stream_type:i}})}}withdrawRemoteTracks(r){r.forEach(e=>{let[t,{kind:n}]=e,i=this.remoteUserMap.get(t);i&&(i.delete(n),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(t))})}async updateBitrateLimit(r){let e=this.localTrackMap.get($e.LocalVideoTrack),t=this.localTrackMap.get($e.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(r.uplink),await new De((n,i)=>{this.handleUpdateVideoEncoder(e.track,n,i,!0)})),t&&r.low_stream_uplink&&(await t.track.setBitrateLimit({max_bitrate:r.low_stream_uplink.bitrate,min_bitrate:r.low_stream_uplink.bitrate||0}),await new De((n,i)=>{this.handleUpdateVideoEncoder(t.track,n,i,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof na&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof na&&this.connection.isPreSub()}mapPubResToRemoteConfig(r,e,t){return r.map((n,i)=>{var s;let{stream_type:o}=n,c=(s=e.find(d=>{let{stream_type:u}=d;return o===u}))===null||s===void 0?void 0:s.attributes;if(c&&te("DISABLE_SCREEN_SHARE_REMB")){let d=t[i]._hints;(Re(d).call(d,rt.SCREEN_TRACK)||Re(d).call(d,rt.SCREEN_LOW_TRACK))&&(c.remb=!1,V.debug("disable remb for screen share, hints:",d))}return c})}async tryToUnmuteAudio(r){for(let t=0;t<r.length;t++)if(r[t]instanceof ci){var e;let n=this.filterTobeUnmutedTracks(r[t]);if(n.length===0)continue;await((e=this.connection)===null||e===void 0?void 0:e.unmuteLocal(n.map(s=>{let[,{id:o}]=s;return o})));let i=this.createUnmuteMessage(n);return void await On(this,ut.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=r=>{var e;return!((e=this.connection)===null||e===void 0||!e.getRemoteVideoIsReady(r))},this.statsUploader.requestUpload=(r,e)=>this.emit(ut.RequestUpload,r,e),this.statsUploader.requestUploadStats=r=>this.emit(ut.RequestUploadStats,r),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var r;return{connectState:((r=this.connection)===null||r===void 0?void 0:r.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Jo(Es(this.dtlsFailedCount,zr)),this.emit(ut.RequestReconnect)}async reconnectP2P(){let r=Array.from(this.localTrackMap.entries()),e=this.createGatewayUnpublishMessage(r);Array.from(this.remoteUserMap.entries()),e.length>0&&await Ys(this,ut.RequestUnpublishForReconnectPC,e),this.disconnectForReconnect(),this.emit(ut.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has($e.LocalVideoTrack)||this.pendingLocalTracks.some(r=>r instanceof Ei)}throwIfTrackTypeNotMatch(r){if(r.filter(e=>e instanceof Ei).length>1)throw new H(z.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r.filter(e=>e instanceof ci).length>1&&(r.some(e=>e instanceof ci&&e._bypassWebAudio)||!on().webAudioMediaStreamDest))throw new H(z.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let e of r){if(e instanceof Ei&&this.pendingLocalTracks.some(t=>t instanceof Ei))throw new H(z.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof ci&&this.pendingLocalTracks.some(t=>t instanceof ci)&&(!on().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(t=>t instanceof ci&&t._bypassWebAudio)))throw new H(z.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(r,e){var t;let n=!te("DISABLE_DUAL_STREAM_USE_ENCODING")&&on().supportDualStreamEncoding,i=df(df({},{width:160,height:120,framerate:15,bitrate:50}),e),s;s=n?r._mediaStreamTrack.clone():cc(r,i);let o=In(8,"track-low-"),c=new Ei(s,df(df({},n&&{scaleResolutionDownBy:lP(i,r)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,o);return c.on(Rv.TRANSCEIVER_UPDATED,d=>{r._updateRtpTransceiver(d,Ni.LOW_STREAM)}),c._hints.push(rt.LOW_STREAM),Re(t=r._hints).call(t,rt.SCREEN_TRACK)&&c._hints.push(rt.SCREEN_LOW_TRACK),r.on("sei-to-send",d=>{c.emit("sei-to-send",d)}),r.addListener(It.NEED_CLOSE,()=>{c.close()}),c}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(r,e,t){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof na){var i,s,o,c;let d=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:u,dtlsTransportState:p,peerConnectionState:m}=this.connection,{local:g,remote:T}=await this.connection.getSelectedCandidatePair();Ye.pcStats(this.store.sessionId,{startTime:d,eventElapse:r-d||0,iceconnectionsate:u,dtlsstate:p,connectionstate:m,intSucc:e?1:2,error:this._iceError||n||"",selectedLocalCandidateProtocol:(i=g?.protocol)!==null&&i!==void 0?i:"",selectedLocalCandidateType:(s=g.candidateType)!==null&&s!==void 0?s:"",selectedLocalCandidateAddress:"".concat(g.address,":").concat(g.port),selectedRemoteCandidateProtocol:(o=T.protocol)!==null&&o!==void 0?o:"",selectedRemoteCandidateType:(c=T.candidateType)!==null&&c!==void 0?c:"",selectedRemoteCandidateAddress:"".concat(T.address,":").concat(T.port),restartCnt:t,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(r){let e=this.store.keyMetrics,t=e.firstVideoFrameDecoded.find(p=>p.userId===r.uid);if(!t)return;let{isInternalUpload:n,isExternalUpload:i}=t;if(n&&i)return;let{subscribeEnd:s,firstPreRender:o,peerPublishDuration:c,peerPubStatusMs:d}=t,{firstRender:u=0}=t;if(s&&(u||o)&&c&&d){t.isInternalUpload=!0;let{playEnd:p}=t;p&&(t.isExternalUpload=!0);let{firstPreRender:m=0}=t;u=m||u;let g=r.videoTrack,T={peer:r._uintid,width:g?._videoWidth||0,height:g?._videoHeight||0,ssrc:r._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:c,peerPubStatusMs:d,joinChannelStart:e.joinStart||0,preloadStart:e.preloadStart||0,preloadEnd:e.preloadEnd||0,apStart:e.requestAPStart||0,apEnd:e.requestAPEnd||0,suaEnd:e.requestSUAEnd||0,beforeConnect:e.beforeConnect||0,peerReceiver:e.peerReceiver||0,ice:e.iceConnectionEnd||0,pc:e.peerConnectionEnd||0,signalConnected:e.signalConnected||0,joinReq:e.joinReq||0,joinRes:e.joinRep||0,userJoinNotify:t.userJoinNotify||0,videoAddNotify:t.videoAddNotify||0,subscribeStart:t.subscribeStart||0,subscribeEnd:t.subscribeEnd||0,firstReceived:t.firstReceived||0,firstDecoded:t.firstDecoded||0,firstPreRender:m||0,firstRender:p?Math.max(u,p):Math.max(u,s),playStart:t.playStart||0,playEnd:t.playEnd||0,isPreSub:!(!r._videoSSRC||!this.isPreSubScribe(r._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:xD(this.store)};Ye.firstXLAPeerFirstVideoFrame(this.store.sessionId,T)}}reportVideoFirstFrameDecoded(r,e,t,n){var i;let s=Array.from(hl(i=this.remoteUserMap).call(i)).find(o=>o._videoSSRC===r);if(s){n||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());let o=this.store.keyMetrics,c=o.subscribe.find(d=>d.userId===s.uid&&d.type==="video");Ye.firstRemoteVideoDecode(this.store.sessionId,so.FIRST_VIDEO_DECODE,Nn.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:e,videoheight:t,subscribeElapse:ta.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:c?.subscribeEnd||0,subscriberStart:c?.subscribeStart||0,videoAddNotify:c?.streamAdded||0,state:n?1:0,firstFrame:c?.firstFrame||0})}}async remoteMediaSsrcChanged(r,e,t){if(!this.connection)return!1;let n=this.remoteUserMap.get(r);if(!n)return!1;let i=n.get(e);if(!i)return!1;let s=await this.connection.getRemoteSSRC(i);return s!==void 0&&s!==t}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(r=>{let[e,{track:t}]=r;e===$e.LocalVideoLowTrack?t._updateRtpTransceiver(void 0,Ni.LOW_STREAM):t._updateRtpTransceiver(void 0)})}},Dt(Mn.prototype,"startP2PConnection",[ia],Object.getOwnPropertyDescriptor(Mn.prototype,"startP2PConnection"),Mn.prototype),Dt(Mn.prototype,"connect",[ia],Object.getOwnPropertyDescriptor(Mn.prototype,"connect"),Mn.prototype),Dt(Mn.prototype,"updateRemoteRTPCapabilities",[ia],Object.getOwnPropertyDescriptor(Mn.prototype,"updateRemoteRTPCapabilities"),Mn.prototype),Dt(Mn.prototype,"publishDataChannel",[ia],Object.getOwnPropertyDescriptor(Mn.prototype,"publishDataChannel"),Mn.prototype),Dt(Mn.prototype,"unpublish",[ia],Object.getOwnPropertyDescriptor(Mn.prototype,"unpublish"),Mn.prototype),Dt(Mn.prototype,"unpublishDataChannel",[ia],Object.getOwnPropertyDescriptor(Mn.prototype,"unpublishDataChannel"),Mn.prototype),Dt(Mn.prototype,"unpublishLowStream",[ia],Object.getOwnPropertyDescriptor(Mn.prototype,"unpublishLowStream"),Mn.prototype),Dt(Mn.prototype,"subscribeDataChannel",[ia],Object.getOwnPropertyDescriptor(Mn.prototype,"subscribeDataChannel"),Mn.prototype),Dt(Mn.prototype,"subscribe",[ia],Object.getOwnPropertyDescriptor(Mn.prototype,"subscribe"),Mn.prototype),Dt(Mn.prototype,"massSubscribe",[ia],Object.getOwnPropertyDescriptor(Mn.prototype,"massSubscribe"),Mn.prototype),Dt(Mn.prototype,"unsubscribe",[ia],Object.getOwnPropertyDescriptor(Mn.prototype,"unsubscribe"),Mn.prototype),Dt(Mn.prototype,"unsubscribeDataChannel",[ia],Object.getOwnPropertyDescriptor(Mn.prototype,"unsubscribeDataChannel"),Mn.prototype),Dt(Mn.prototype,"massUnsubscribe",[ia],Object.getOwnPropertyDescriptor(Mn.prototype,"massUnsubscribe"),Mn.prototype),Dt(Mn.prototype,"muteRemote",[ia],Object.getOwnPropertyDescriptor(Mn.prototype,"muteRemote"),Mn.prototype),Dt(Mn.prototype,"unmuteRemote",[ia],Object.getOwnPropertyDescriptor(Mn.prototype,"unmuteRemote"),Mn.prototype),Dt(Mn.prototype,"hasRemoteMediaWithLock",[ia],Object.getOwnPropertyDescriptor(Mn.prototype,"hasRemoteMediaWithLock"),Mn.prototype),Dt(Mn.prototype,"disconnectForReconnect",[ia],Object.getOwnPropertyDescriptor(Mn.prototype,"disconnectForReconnect"),Mn.prototype),Dt(Mn.prototype,"updateBitrateLimit",[ia],Object.getOwnPropertyDescriptor(Mn.prototype,"updateBitrateLimit"),Mn.prototype),Dt(Mn.prototype,"remoteMediaSsrcChanged",[ia],Object.getOwnPropertyDescriptor(Mn.prototype,"remoteMediaSsrcChanged"),Mn.prototype),Mn);function ia(r,e,t){let n=r[e];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return t.value=async function(){let i=this.mutex,s=await i.lock("From P2PChannel.".concat(e));try{for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return await n.apply(this,c)}finally{s()}},t}function Ka(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function PF(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Ka(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Ka(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}let z4=Date.now(),tY=20,kF=new Map,$C=new Map;async function u0(r){let e=kF.get(r),t=Array.isArray(e)&&e[e.length-1],n=$C.get(r);if(!t)return void(n.isSyncing=!1);let i={uid:t.uid,payload:t.payload};n.firstRecvTs===0&&(n.firstRecvTs=t.recvTs,n.firstSendTs=t.sendTs);let s=t.sendTs-n.firstSendTs,o=s-(Date.now()-n.firstRecvTs);o>0&&(n.firstRecvTs=Date.now()-s);let c=t.mediaDelay+o;c<=0?(e.pop(),LF(t.context,i),c=0):c=Math.min(c,tY),setTimeout(()=>e.length&&u0(r),c)}function LF(r,e){r.safeEmit(jn.STREAM_MESSAGE,e.uid,e.payload),r.onStreamMessage&&r.onStreamMessage(e)}function Y4(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0;if(!r.syncWithAudio)return LF(t,{uid:r.uid,payload:r.payload});let n="".concat(t.id,"-").concat(r.uid),i=kF.get(n)||[],s=i.findIndex(u=>r.sendTs>=u.sendTs),o=PF(PF({},r),{},{context:t,mediaDelay:e,recvTs:Date.now()});s===-1?i.push(o):i.splice(s,0,o),kF.set(n,i);let c=!1;var d;$C.has(n)?c=!((d=$C.get(n))===null||d===void 0||!d.isSyncing):$C.set(n,{isSyncing:c,firstRecvTs:0,firstSendTs:0}),c||u0(n)}let nY=Qn().name;function q4(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function MF(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?q4(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):q4(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}let kv="websdk_ng_cache_parameter",eb=te("MAX_PRELOAD_ASYNC_LENGTH"),iY=1e4,Lv=new Map,Au=[],$m=null,h0=0,p0=0,tb=new Map,AP=(function(r,e){let t=[],n=0,i=async()=>{let s=t.shift();s&&await s(),t.length>0&&n<e?i():n--};return async function(){for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];return new De(async(d,u)=>{t.push(async()=>{try{let p=await r(...o);d(p)}catch(p){u(p)}}),n<e&&(n++,i())})}})(wP,eb),UF=Er.CancelToken.source();async function wP(r,e,t,n,i,s){try{if(!te("ENABLE_PRELOAD"))return;if(!on().supportWebCrypto)return void Lm(()=>{V.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!t&&t!==null)throw new H(z.INVALID_PARAMS,"Invalid token: ".concat(t,". If you don not use token, set it to null"));t&&Eo(t,"token",1,2047),Eo(r,"appid",1,2047),cn(e),n&&wv(n);let o=Oi();V.debug("preload channel ".concat(e,", uid is ").concat(n));let c={appId:r,cname:e,token:t||r,uid:typeof n!="string"?n:null,sid:o,proxyServer:i},d,u;typeof n=="string"?(c.stringUid=n,[u,d]=await De.all([F4(n,{sid:o,appId:r},UF.token),B4(MF(MF({},c),{},{token:t||r,uid:0}),UF.token)]),c.uid=u.uid,d.gatewayInfo.uid=c.uid,d.gatewayInfo.res.uid=c.uid):(s&&(c.stringUid=s),d=await B4(c,UF.token));let p={sid:o,appId:r,cname:e,token:t||r,uid:c.stringUid||n,intUid:c.uid||d.gatewayInfo.uid,stringUid:c.stringUid,ts:Date.now(),sua:u,ap:d};await(async function(m){let g;try{m.uid&&VF({appId:m.appId,cname:m.cname,token:m.token,uid:m.uid,stringUid:m.stringUid});let T=_0(m),R=await(async function(A,w){try{let k=await window.crypto.subtle.importKey("raw",Mm(w),"AES-GCM",!1,["encrypt"]),L=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},k,Cd(window.btoa(JSON.stringify(A))));return bd(new Uint8Array(L))}catch{return}})(m,m.token||m.appId);if(!R)return;g=BF(kv);let I=g?JSON.parse(g):[];I.push({[T]:R}),I.length>te("AP_CACHE_NUM")&&I.shift(),f0(kv,JSON.stringify(I))}catch(T){V.warn("Error caching server parameters:",T.message),f0(kv,"")}})(p),h0++}catch(o){throw p0++,(function(c){$m||($m=window.setTimeout(()=>{let u="";tb.forEach((p,m)=>{u+="".concat(m,": ").concat(p," ;")}),Ye.reportApiInvoke(null,{name:Zr.PRELOAD,options:{success:h0,failed:p0,err:u}}).onError(c),h0=0,p0=0,tb.clear(),$m=null},iY));let d=tb.get(c.code)||0;tb.set(c.code,d+1)})(o),o}}async function xF(r){try{if(te("AP_REQUEST_DETAIL")||te("ENABLE_ROLE_SELECT_EDGE"))return;let e=VF(r);if(!e||r.cloudProxyServer!=="disabled")return;let t=await(async function(n,i){try{let s=await window.crypto.subtle.importKey("raw",Mm(i),"AES-GCM",!1,["decrypt"]),o=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},s,Cd(n));return JSON.parse(window.atob(bd(new Uint8Array(o))))}catch{return}})(e,r.token||r.appId);if(!t||!(function(n,i){return n.cname===i.cname&&n.appId===i.appId&&n.token===i.token?i.stringUid?n.stringUid===i.stringUid:typeof i.uid=="number"?n.uid===i.uid:n.uid==i.uid:!1})(t,r))return;if(t&&Date.now()-t.ts<te("AP_CACHE_LIFETIME"))return t}catch(e){V.warn("Error get preloadInfo",e.message)}}function VF(r){let e;try{if(e=BF(kv),!e)return;let t=JSON.parse(e),n=_0(r),i=(function(o,c){for(let d=o.length-1;d>=0;d--)if(c(o[d]))return d;return-1})(t,o=>n in o);if(i===-1)return;let s=t.splice(i,1)[0];return f0(kv,JSON.stringify(t)),s[n]}catch(t){V.warn("Error delete preload info: ".concat(e),t.message),f0(kv,"")}}function OP(r){if(r){let e=Lv.get(r);e&&(window.clearTimeout(e),e=null,Lv.delete(r)),Re(Au).call(Au,r)||r.cloudProxyServer!=="disabled"||Au.push(r)}if(Lv.size<te("AP_CACHE_NUM")&&Au.length>0){let e=Au.shift();Lv.set(e,window.setTimeout(async()=>{let{appId:t,cname:n,token:i,stringUid:s,uid:o,proxyServer:c}=e;try{await AP(t,n,i,o,c,s),Lv.has(e)&&OP(e)}catch(d){V.warn("update preload failed",d.message),NP(e)}},te("AP_UPDATE_INTERVAL")))}}function NP(r){let e=Au.indexOf(r);e!==-1&&Au.splice(e,1);let t=Lv.get(r);t&&(window.clearTimeout(t),t=null,Lv.delete(r),OP())}function FF(r,e){let t=r.sua,n=r.ap;e&&t&&Ye.reqUserAccount(r.sid,{lts:t.requestTime,elapse:t.elapse,success:!0,serverAddr:t.url,stringUid:e,uid:r.intUid,errorCode:null,extend:t.req}),Ye.reportResourceTiming(r.ap.url,r.sid),Ye.joinWebProxyAP(r.sid,{lts:n.requestTime,elapse:n.elapse,sucess:1,apServerAddr:n.url,turnServerAddrList:n.proxyInfo.addresses.map(i=>i.ip).join(","),eventType:"disabled",unilbsServerIds:[ws.CHOOSE_SERVER,ws.CLOUD_PROXY_FALLBACK].toString()}),Ye.joinChooseServer(r.sid,{lts:n.requestTime,elapse:n.elapse,succ:!0,csAddr:n.url,opid:n.opid,serverList:n.gatewayInfo.gatewayAddrs.map(i=>i.address),ec:null,cid:n.gatewayInfo.cid.toString(),uid:n.gatewayInfo.uid.toString(),csIp:n.gatewayInfo.csIp,unilbsServerIds:[ws.CHOOSE_SERVER].toString(),isHttp3:n.isHttp3})}function BF(r){return window.atob(window.localStorage.getItem(r)||"")}function f0(r,e){window.localStorage.setItem(r,window.btoa(e))}function _0(r){let e="".concat(r.appId,"_").concat(r.cname);return typeof r.uid=="string"&&(e+="_s_".concat(r.uid)),typeof r.uid=="number"&&(e+="_".concat(r.uid)),r.token&&(e+="_".concat(r.token)),DD(e)}function X4(r){let e=(function(){let t=ib.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}})();return(function(t,n){let i=t.appId;i!==void 0&&(qr(n,10),eE(n,i));let s=t.cid;s!==void 0&&(qr(n,16),qr(n,s));let o=t.cname;o!==void 0&&(qr(n,26),eE(n,o));let c=t.deviceId;c!==void 0&&(qr(n,34),eE(n,c));let d=t.elapse;d!==void 0&&(qr(n,40),tS(n,d));let u=t.fileSize;u!==void 0&&(qr(n,48),tS(n,nb(u)));let p=t.height;p!==void 0&&(qr(n,56),tS(n,nb(p)));let m=t.jpg;m!==void 0&&(qr(n,66),qr(n,m.length),WF(n,m));let g=t.networkType;g!==void 0&&(qr(n,72),tS(n,nb(g)));let T=t.osType;T!==void 0&&(qr(n,80),tS(n,nb(T)));let R=t.requestId;R!==void 0&&(qr(n,90),eE(n,R));let I=t.sdkVersion;I!==void 0&&(qr(n,98),eE(n,I));let A=t.sequence;A!==void 0&&(qr(n,104),tS(n,nb(A)));let w=t.sid;w!==void 0&&(qr(n,114),eE(n,w));let k=t.timestamp;k!==void 0&&(qr(n,120),tS(n,k));let L=t.uid;L!==void 0&&(qr(n,128),qr(n,L));let j=t.vid;j!==void 0&&(qr(n,136),qr(n,j));let K=t.width;K!==void 0&&(qr(n,144),tS(n,nb(K)));let W=t.service;W!==void 0&&(qr(n,152),qr(n,W));let Y=t.callbackData;Y!==void 0&&(qr(n,162),qr(n,Y.length),WF(n,Y));let se=t.ticket;se!==void 0&&(qr(n,170),eE(n,se));let de=t.vendorConfigs;de!==void 0&&(qr(n,178),eE(n,de))})(r,e),(function(t){let n=t.bytes,i=t.limit;return n.length===i?n:n.subarray(0,i)})(e)}function rY(r){return(function(t){let n={};e:for(;!GF(t);){let i=rb(t);switch(i>>>3){case 0:break e;case 1:n.code=rb(t);break;case 2:n.msg=HF(t,rb(t));break;case 3:n.requestId=HF(t,rb(t));break;case 4:n.timestamp=Ns(t,!1);break;default:sY(t,7&i)}}return n})({bytes:e=r,offset:0,limit:e.length});var e}function sY(r,e){switch(e){case 0:for(;128&lc(r););break;case 2:jF(r,rb(r));break;case 5:jF(r,4);break;case 1:jF(r,8);break;default:throw new Error("Unimplemented type: "+e)}}function nb(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}let ib=[];function jF(r,e){if(r.offset+e>r.limit)throw new Error("Skip past limit");r.offset+=e}function GF(r){return r.offset>=r.limit}function DP(r,e){let t=r.bytes,n=r.offset,i=r.limit,s=n+e;if(s>t.length){let o=new Uint8Array(2*s);o.set(t),r.bytes=o}return r.offset=s,s>i&&(r.limit=s),n}function m0(r,e){let t=r.offset;if(t+e>r.limit)throw new Error("Read past limit");return r.offset+=e,t}function WF(r,e){let t=DP(r,e.length);r.bytes.set(e,t)}function HF(r,e){let t=m0(r,e),n=String.fromCharCode,i=r.bytes,s="�",o="";for(let c=0;c<e;c++){let d,u,p,m,g=i[c+t];128&g?(224&g)==192?c+1>=e?o+=s:(d=i[c+t+1],(192&d)!=128?o+=s:(m=(31&g)<<6|63&d,m<128?o+=s:(o+=n(m),c++))):(240&g)==224?c+2>=e?o+=s:(d=i[c+t+1],u=i[c+t+2],(49344&(d|u<<8))!=32896?o+=s:(m=(15&g)<<12|(63&d)<<6|63&u,m<2048||m>=55296&&m<=57343?o+=s:(o+=n(m),c+=2))):(248&g)==240?c+3>=e?o+=s:(d=i[c+t+1],u=i[c+t+2],p=i[c+t+3],(12632256&(d|u<<8|p<<16))!=8421504?o+=s:(m=(7&g)<<18|(63&d)<<12|(63&u)<<6|63&p,m<65536||m>1114111?o+=s:(m-=65536,o+=n(55296+(m>>10),56320+(1023&m)),c+=3))):o+=s:o+=n(g)}return o}function eE(r,e){let t=e.length,n=0;for(let o=0;o<t;o++){let c=e.charCodeAt(o);c>=55296&&c<=56319&&o+1<t&&(c=(c<<10)+e.charCodeAt(++o)-56613888),n+=c<128?1:c<2048?2:c<65536?3:4}qr(r,n);let i=DP(r,n),s=r.bytes;for(let o=0;o<t;o++){let c=e.charCodeAt(o);c>=55296&&c<=56319&&o+1<t&&(c=(c<<10)+e.charCodeAt(++o)-56613888),c<128?s[i++]=c:(c<2048?s[i++]=c>>6&31|192:(c<65536?s[i++]=c>>12&15|224:(s[i++]=c>>18&7|240,s[i++]=c>>12&63|128),s[i++]=c>>6&63|128),s[i++]=63&c|128)}}function lc(r){return r.bytes[m0(r,1)]}function wu(r,e){let t=DP(r,1);r.bytes[t]=e}function rb(r){let e,t=0,n=0;do e=lc(r),t<32&&(n|=(127&e)<<t),t+=7;while(128&e);return n}function qr(r,e){for(e>>>=0;e>=128;)wu(r,127&e|128),e>>>=7;wu(r,e)}function Ns(r,e){let t,n=0,i=0,s=0;return t=lc(r),n=127&t,128&t&&(t=lc(r),n|=(127&t)<<7,128&t&&(t=lc(r),n|=(127&t)<<14,128&t&&(t=lc(r),n|=(127&t)<<21,128&t&&(t=lc(r),i=127&t,128&t&&(t=lc(r),i|=(127&t)<<7,128&t&&(t=lc(r),i|=(127&t)<<14,128&t&&(t=lc(r),i|=(127&t)<<21,128&t&&(t=lc(r),s=127&t,128&t&&(t=lc(r),s|=(127&t)<<7))))))))),{low:n|i<<28,high:i>>>4|s<<24,unsigned:e}}function tS(r,e){let t=e.low>>>0,n=(e.low>>>28|e.high<<4)>>>0,i=e.high>>>24,s=i===0?n===0?t<16384?t<128?1:2:t<1<<21?3:4:n<16384?n<128?5:6:n<1<<21?7:8:i<128?9:10,o=DP(r,s),c=r.bytes;switch(s){case 10:c[o+9]=i>>>7&1;case 9:c[o+8]=s!==9?128|i:127&i;case 8:c[o+7]=s!==8?n>>>21|128:n>>>21&127;case 7:c[o+6]=s!==7?n>>>14|128:n>>>14&127;case 6:c[o+5]=s!==6?n>>>7|128:n>>>7&127;case 5:c[o+4]=s!==5?128|n:127&n;case 4:c[o+3]=s!==4?t>>>21|128:t>>>21&127;case 3:c[o+2]=s!==3?t>>>14|128:t>>>14&127;case 2:c[o+1]=s!==2?t>>>7|128:t>>>7&127;case 1:c[o]=s!==1?128|t:127&t}}let tE={},KF={},E0=4294967296,PP=E0*E0,oY=PP/2;Q4(0,!0);let zF=Q4(0),J4=sb(0,-2147483648,!1),aY=sb(-1,2147483647,!1);function Q4(r,e){let t,n,i;return e?(i=0<=(r>>>=0)&&r<256)&&(n=KF[r],n)?n:(t=sb(r,0,!0),i&&(KF[r]=t),t):(i=-128<=(r|=0)&&r<128)&&(n=tE[r],n)?n:(t=sb(r,r<0?-1:0,!1),i&&(tE[r]=t),t)}function sb(r,e,t){return{low:0|r,high:0|e,unsigned:!!t}}function ob(r,e){if(isNaN(r))return zF;{if(r<=-9223372036854776e3)return J4;if(r+1>=oY)return aY}return r<0?zF:sb(r%E0|0,r/E0|0,e)}function YF(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}class kP extends Sr{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;let t=this._connectionState;this._connectionState=e,this.emit(ea.CONNECTION_STATE_CHANGE,e,t)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var t;super(),Z(this,"name","AgoraRTCImageModeration"),Z(this,"_connectionState",fa.CONNECTING),Z(this,"_sequence",0),Z(this,"_moderationStartTime",void 0),Z(this,"_workerConnection",void 0),Z(this,"_workerMessageLengthLimit",void 0),Z(this,"_qualityRatio",void 0),Z(this,"_connectInfo",void 0),Z(this,"_cancelTokenSource",Er.CancelToken.source()),Z(this,"_retryConfig",void 0),Z(this,"_moderationInterval",void 0),Z(this,"_moderationTimer",null),Z(this,"_moderationMode",1),Z(this,"_quality",1),Z(this,"_qualityTimer",null),Z(this,"_ticket",void 0),Z(this,"_moderationIntervalMinimum",void 0),Z(this,"_uploadFailedNum",0),Z(this,"_uploadNum",0),Z(this,"_uploadTimer",null),Z(this,"_extraInfo",void 0),Z(this,"_vendor",""),Z(this,"_encoder",new TextEncoder),Z(this,"_moderationId",void 0),Z(this,"inspectImage",()=>{if(this.connectionState!==fa.CONNECTED)throw new fe(z.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===fa.CONNECTED?this.requestToInspectImage():V.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=In(5,"image-moderation-"),this._workerMessageLengthLimit=te("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=te("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(t=e.interval)!==null&&t!==void 0?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=te("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Ov("worker-"+this._moderationId,zr),this.on(ea.STATE_CHANGE,(n,i)=>{V.debug("[".concat(this._moderationId,"] Moderation operation :").concat(gl[n]," ").concat(i||""))}),this.handleWorkerEvents()}async init(e,t){this.emit(ea.STATE_CHANGE,gl.CONNECT_AP),this._connectInfo=e;let n=this._cancelTokenSource.token;return this._retryConfig=t,new De((i,s)=>{this.on(ea.CONNECTION_STATE_CHANGE,(o,c)=>{o===fa.CONNECTED&&i()}),this.requestAP(e,n,t).then(o=>{this.connectWorker(o)}).catch(o=>{s(o)})})}updateConfig(e){var t;this._moderationInterval=(t=e.interval)!==null&&t!==void 0?t:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),V.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===fa.CONNECTED&&this.inspectImage()}async requestAP(e,t,n){let i=te("WEBCS_DOMAIN").map(d=>"https://".concat(d,"/api/v1")),s=await(function(d,u,p,m){let{appId:g,areaCode:T,cname:R,sid:I,token:A,uid:w}=u;KC++;let k="moderation_plugin",L={service_name:k,json_body:JSON.stringify({appId:g,areaCode:T,cname:R,command:"allocateEdge",requestId:KC,seq:KC,sid:I,appToken:A,ts:Date.now(),uid:w+""})},j,K,W=d[0];return Tu(async()=>{j=Date.now();let Y=await bu(W,{data:L,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(K=Date.now()-j,Y.code!==0){let ge=new fe(z.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+Y.code,{retry:!0,responseTime:K});throw V.error(ge.toString()),ge}let se=JSON.parse(Y.json_body);if(se.code!==200){let ge=new fe(z.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(se.code,", reason: ").concat(se.reason),{code:se.code,responseTime:K});throw V.error(ge.toString()),ge}if(!se.servers||!Array.isArray(se.servers)||se.servers.length===0){let ge=new fe(z.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:se.code,responseTime:K});throw V.error(ge.toString()),ge}if(!se.servers.some(ge=>!!ge.wss)){let ge=new fe(z.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:se.code,responseTime:K});throw V.error(ge.toString()),ge}let de=te("IMAGE_MODERATION_WORKER_HOST");return{addressList:se.servers.map(ge=>{let{address:je,wss:_t}=ge;if(je&&_t)return"wss://".concat(je.replace(/\./g,"-"),".").concat(de,":").concat(_t,"/moderation")}).filter(ge=>!!ge),workerToken:se.workerToken,vid:se.vid,ticket:se.appTicket,responseTime:K}},(Y,se)=>(Ye.apworkerEvent(I,{success:!0,sc:200,serviceName:k,responseDetail:JSON.stringify(Y.addressList),firstSuccess:se===0,responseTime:K,serverIp:d[se%d.length]}),!1),(Y,se)=>(Ye.apworkerEvent(I,{success:!1,sc:Y.data&&Y.data.code||200,serviceName:k,responseTime:K,serverIp:d[se%d.length]}),!!(Y.code!==z.OPERATION_ABORTED&&Y.code!==z.UNEXPECTED_RESPONSE||Y.data&&Y.data.retry)&&(W=d[(se+1)%d.length],!0)),m)})(i,e,t,n);this.emit(ea.STATE_CHANGE,gl.AP_CONNECTED);let{addressList:o,ticket:c}=s;return this._ticket=c,o}async connectWorker(e){this.emit(ea.STATE_CHANGE,gl.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(Wt.CONNECTED,async()=>{this.emit(ea.STATE_CHANGE,gl.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=fa.CONNECTED}),this._workerConnection.on(Wt.CLOSED,()=>{this.connectionState=fa.CLOSED}),this._workerConnection.on(Wt.FAILED,()=>{this.connectionState=fa.CLOSED}),this._workerConnection.on(Wt.RECONNECTING,()=>{this.connectionState=this.connectionState===fa.CONNECTED?fa.RECONNECTING:fa.CONNECTING}),this._workerConnection.on(Wt.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){let t=rY(new Uint8Array(e.data));te("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&V.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(t)),this._uploadNum++,t.code===void 0||t.code===0||(this._uploadFailedNum++,V.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(t.code,", msg is ").concat(t.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{Ye.reportApiInvoke(this._connectInfo.sid||null,{name:Zr.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,t.code],tag:Cn.TRACER}).onError(new fe(z.IMAGE_MODERATION_UPLOAD_FAILED,t.msg)),this._uploadTimer=null},te("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else V.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Wt.WILL_RECONNECT,(e,t,n)=>{e==="recover"&&n(e),n("tryNext")}),this._workerConnection.on(Wt.REQUEST_NEW_URLS,(e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){let e=ei(this,ea.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(te("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&V.debug("Only the track being played can be inspected"));this._sequence++;let n=await this.generateRequestData(e,t);this._workerConnection.sendMessage(n,!0,!0)}else te("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&V.debug("Only the track being published can be inspected")}async generateRequestData(e,t){let{appId:n,cname:i,cid:s,vid:o,sid:c,uid:d}=t,u=Date.now(),p=await e.getCurrentFrameImage("image/jpeg",this.quality),m=await S4(p,n,i),g=this._sequence+"-"+s+"-"+d+"-"+u+"-"+In(12,""),T={appId:n,cid:s,cname:i,deviceId:"",elapse:kP.intToLong(Number(u-this._moderationStartTime)),fileSize:p.buffer.byteLength,height:p.height,width:p.width,jpg:m,networkType:6,osType:7,requestId:g,sdkVersion:"4.24.0",sequence:this._sequence,sid:c,timestamp:ob(u),uid:d,vid:o,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete T.callbackData;let R=X4(T);if(R.byteLength<this._workerMessageLengthLimit){if(te("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let I=(function(A){for(var w=1;w<arguments.length;w++){var k=arguments[w]!=null?arguments[w]:{};w%2?YF(Object(k),!0).forEach(function(L){Z(A,L,k[L])}):Object.getOwnPropertyDescriptors?Object.defineProperties(A,Object.getOwnPropertyDescriptors(k)):YF(Object(k)).forEach(function(L){Object.defineProperty(A,L,Object.getOwnPropertyDescriptor(k,L))})}return A})({},T);delete I.jpg,V.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(I))}return R}{let I=this.quality*this._qualityRatio;return this.quality=I,await this.generateRequestData(e,{appId:n,cname:i,cid:s,vid:o,sid:c,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Er.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=fa.CLOSED,this.emit(ea.STATE_CHANGE,gl.CLOSED)}}function LP(r){if(Tn(r.interval,"interval",1e3,1/0),r&&r.extraInfo&&r.extraInfo.length>1024)throw new fe(z.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(r&&r.vendor&&r.vendor.length>1024)throw new fe(z.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}let Z4={name:"ImageModeration",create:function(r){let{config:e}=r;return LP(e),new kP(e)}};var $4,qF,XF,JF,QF,ZF,$F,eB,tB,nB,iB,rB,sB,oB,aB,cB,lB,dB,uB,hB,pB,fB,_B,mB,EB,gB,SB,TB,vB,yB,RB,CB,bB,IB,AB,wB,OB,NB,DB,PB,kB,St;function Tt(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Ou(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Tt(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Tt(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}ha.setLogger(V);let Nh=($4=Gt(),qF=Gt({argsMap:(r,e)=>{if(!Array.isArray(e)){if(!(e instanceof Cv))return[e];e=[e]}return e.map(t=>t?Object(t).toString():"null")}}),XF=Gt({argsMap:(r,e)=>(e||(e=[]),Array.isArray(e)||e.trackMediaType!==vc.DATA?(Array.isArray(e)||(e=[e]),e.map(t=>t.getTrackId())):[e.getChannelId()])}),JF=Gt({argsMap:(r,e,t,n)=>[typeof e=="object"?e.uid:e,t,n]}),QF=Gt({argsMap:(r,e,t)=>[e,t]}),ZF=Gt({argsMap:(r,e)=>e.map(t=>{let{user:n,mediaType:i}=t;return[n?.uid,i]})}),$F=Gt({argsMap:(r,e,t,n)=>[typeof e=="object"?e.uid:e,t,n]}),eB=Gt({argsMap:(r,e)=>e.map(t=>{let{user:n,mediaType:i}=t;return{uid:n?.uid,mediaType:i}})}),tB=Gt(),nB=Gt(),iB=Gt(),rB=Gt(),sB=Gt(),oB=Gt(),aB=Gt(),cB=Gt(),lB=Gt(),dB=Gt(),uB=Gt(),hB=Gt(),pB=Gt(),fB=Gt(),_B=Gt(),mB=Gt({argsMap:(r,e)=>[e]}),EB=Gt(),gB=Gt(),SB=Gt(),TB=Gt(),vB=Gt(),yB=Gt(),RB=Gt(),CB=Gt(),bB=Gt({argsMap:(r,e)=>(Array.isArray(e)||(e=[e]),[JSON.stringify(e)])}),IB=Gt(),AB=Gt(),wB=Gt(),OB=Gt(),NB=Gt(),DB=Gt(),PB=Gt({reportResult:!0}),kB=Gt(),St=class extends Sr{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var r;return((r=this._config)===null||r===void 0?void 0:r.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(r,e){let t;if(super(),Z(this,"store",void 0),Z(this,"_uid",void 0),Z(this,"_channelName",void 0),Z(this,"_uintUid",void 0),Z(this,"_users",[]),Z(this,"_config",void 0),Z(this,"_clientId",void 0),Z(this,"_appId",void 0),Z(this,"_sessionId",null),Z(this,"_key",void 0),Z(this,"_rtmConfig",{}),Z(this,"_joinInfo",void 0),Z(this,"_gateway",void 0),Z(this,"_statsCollector",void 0),Z(this,"_configDistribute",void 0),Z(this,"_leaveMutex",void 0),Z(this,"_publishMutex",void 0),Z(this,"_renewTokenMutex",void 0),Z(this,"_subscribeMutex",void 0),Z(this,"_encryptionMode","none"),Z(this,"_encryptionSecret",null),Z(this,"_encryptionSalt",null),Z(this,"_encryptDataStream",!1),Z(this,"_encryptDataStreamKey",null),Z(this,"_encryptDataStreamIv",null),Z(this,"_proxyServer",void 0),Z(this,"_turnServer",{servers:[],mode:"auto"}),Z(this,"_cloudProxyServerMode","disabled"),Z(this,"_isDualStreamEnabled",!1),Z(this,"_defaultStreamFallbackType",void 0),Z(this,"_lowStreamParameter",void 0),Z(this,"_streamFallbackTypeCacheMap",new Map),Z(this,"_remoteStreamTypeCacheMap",new Map),Z(this,"_axiosCancelSource",Er.CancelToken.source()),Z(this,"_audioVolumeIndicationInterval",void 0),Z(this,"_networkQualityInterval",void 0),Z(this,"_userOfflineTimeout",void 0),Z(this,"_streamRemovedTimeout",void 0),Z(this,"_liveTranscodeStreamingClient",void 0),Z(this,"_liveRawStreamingClient",void 0),Z(this,"_channelMediaRelayClient",void 0),Z(this,"_networkQualitySensitivity","normal"),Z(this,"_p2pChannel",void 0),Z(this,"_useLocalAccessPoint",!1),Z(this,"_setLocalAPVersion",void 0),Z(this,"_joinAndNotLeaveYet",!1),Z(this,"_numberOfJoinCount",0),Z(this,"_joinResponse",null),Z(this,"_remoteDefaultVideoStreamType",void 0),Z(this,"_inspect",void 0),Z(this,"_moderation",void 0),Z(this,"_license",void 0),Z(this,"_pendingPublishedUsers",[]),Z(this,"ntpAlignErrorCount",0),Z(this,"remoteInboundOffset",0),Z(this,"_peerConnectionState",void 0),Z(this,"_handleLocalTrackEnable",(i,s,o)=>{this.publish(i,!1).then(s).catch(o)}),Z(this,"_handleLocalTrackDisable",(i,s,o)=>{this.unpublish(i).then(s).catch(o)}),Z(this,"_handleUserOnline",i=>{if(te("BLOCK_LOCAL_CLIENT")&&Rh(i.uid,this.channelName))return void V.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&V.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let s=this._users.find(o=>o.uid===i.uid);if(s)s._trust_in_room_=!0,s._is_pre_created&&(s._is_pre_created=!1,this.safeEmit(jn.USER_JOINED,s));else{let o=new Xm(i.uid,i.uint_id||i.uid);this._users.push(o),V.debug("[".concat(this._clientId,"] user online"),i.uid),this.store.firstVideoFrameDecoded(o.uid,{userJoinNotify:Date.now()}),this.safeEmit(jn.USER_JOINED,o)}}),Z(this,"_handleUserOffline",i=>{if(te("BLOCK_LOCAL_CLIENT")&&Rh(i.uid,this.channelName))return;let s=this._users.find(o=>o.uid===i.uid);s&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),s._audio_pre_subscribed||s._video_pre_subscribed?s._is_pre_created=!0:$r(this._users,s),this._remoteStreamTypeCacheMap.delete(s.uid),this._streamFallbackTypeCacheMap.delete(s.uid),V.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(jn.USER_LEAVED,s,i.reason))}),Z(this,"_handleAddAudioOrVideoStream",(i,s,o,c,d,u,p,m)=>{if(te("BLOCK_LOCAL_CLIENT")&&Rh(s,this.channelName))return;let g=this._users.find(R=>R.uid===s);if(!g)return void V.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));V.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(g.uid,i,void 0,void 0,void 0,Date.now()),i==="video"&&this.store.firstVideoFrameDecoded(g.uid,{videoAddNotify:Date.now()});let T=i==="audio"?g.hasAudio:g.hasVideo;if(g._uintid||(g._uintid=u||s),i==="audio"?g._trust_audio_stream_added_state_=!0:g._trust_video_stream_added_state_=!0,i==="audio"?(g._audio_added_=!0,o!==void 0&&(g._audioSSRC=o),c!==void 0&&(g._cname=c),p&&(g._audioOrtc=p)):(g._video_added_=!0,o!==void 0&&(g._videoSSRC=o),c!==void 0&&(g._cname=c),m!==void 0&&(g._rtxSsrcId=m),p&&(g._videoOrtc=p)),(i==="audio"?g.hasAudio:g.hasVideo)&&!T&&(V.info("[".concat(this._clientId,"] remote user ").concat(g.uid," published ").concat(i)),this.safeEmit(jn.USER_PUBLISHED,g,i)),i==="video"?Ye.onGatewayStream(this._sessionId,so.ON_ADD_VIDEO_STREAM,Nn.ON_ADD_VIDEO_STREAM,{peer:u||s,ssrc:g._videoSSRC}):Ye.onGatewayStream(this._sessionId,so.ON_ADD_AUDIO_STREAM,Nn.ON_ADD_AUDIO_STREAM,{peer:u||s,ssrc:g._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(g,i,o).then(R=>{if(R&&(V.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(g.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof eS))return this._p2pChannel.unsubscribe(g,i,!0).then(()=>this._subscribe(g,i,!0).catch(I=>{V.error("[".concat(this._clientId,"] resubscribe error"),I.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(g,i)&&(V.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(g.uid," after reconnect.")),this._subscribe(g,i,!0).catch(R=>{V.error("[".concat(this._clientId,"] resubscribe error"),R.toString())})),i==="video"&&!ms()&&!fi()){let R=this._getEncodingName(d);R?.toLocaleLowerCase()==tn.av1&&V4().then(I=>{I||this._gateway.downgradeCodec(R)})}}),Z(this,"_handleRemoveStream",i=>{if(te("BLOCK_LOCAL_CLIENT")&&Rh(i.uid,this.channelName))return;let s=this._users.find(c=>c.uid===i.uid);if(!s)return void V.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));V.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let o=()=>{};s.hasAudio&&s.hasVideo?o=()=>{V.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(jn.USER_UNPUBLISHED,s,"audio"),V.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(jn.USER_UNPUBLISHED,s,"video")}:s.hasVideo?o=()=>{V.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished video track")),this.safeEmit(jn.USER_UNPUBLISHED,s,"video")}:s.hasAudio&&(o=()=>{V.info("[".concat(this._clientId,"] remote user ").concat(s.uid," unpublished audio track")),this.safeEmit(jn.USER_UNPUBLISHED,s,"audio")}),s._video_pre_subscribed||s._audio_pre_subscribed||(s._trust_audio_stream_added_state_=!0,s._trust_video_stream_added_state_=!0,s._audio_added_=!1,s._video_added_=!1,this._p2pChannel instanceof eS&&this._p2pChannel.unsubscribe(s).then(c=>{if(c)return this._gateway.unsubscribe(c,s.uid)}),s._audioSSRC=void 0,s._videoSSRC=void 0,s._audioOrtc=void 0,s._videoOrtc=void 0,s._rtxSsrcId=void 0),Ye.onGatewayStream(this._sessionId,so.ON_REMOVE_STREAM,Nn.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),o()}),Z(this,"_handleSetStreamLocalEnable",(i,s,o)=>{if(te("BLOCK_LOCAL_CLIENT")&&Rh(s,this.channelName))return;let c=this._users.find(p=>p.uid===s);if(!c)return void V.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));V.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(o?"enabled":"disabled"," with uid ").concat(s));let d=i==="audio"?c.hasAudio:c.hasVideo;if(i==="audio"){c._trust_audio_enabled_state_=!0;let p=c._audio_enabled_;if(c._audio_enabled_=o,c._audio_enabled_===p)return;{let m=c._audio_enabled_?"enable-local-audio":"disable-local-audio";V.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(s,", msg: ").concat(m)),this.safeEmit(jn.USER_INFO_UPDATED,s,m)}}else{c._trust_video_enabled_state_=!0;let p=c._video_enabled_;if(c._video_enabled_=o,c._video_enabled_===p)return;{let m=c._video_enabled_?"enable-local-video":"disable-local-video";V.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(s,", msg: ").concat(m)),this.safeEmit(jn.USER_INFO_UPDATED,s,m)}}let u=i==="audio"?c.hasAudio:c.hasVideo;return d!==u?!d&&u?(V.info("[".concat(this._clientId,"] remote user ").concat(s," published ").concat(i)),void this.safeEmit(jn.USER_PUBLISHED,c,i)):(i==="video"&&c._videoTrack&&c._videoTrack._destroy(),i==="audio"&&c._audioTrack,this._p2pChannel.muteRemote(c,i),V.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished ").concat(i)),void this.safeEmit(jn.USER_UNPUBLISHED,c,i)):void 0}),Z(this,"_handleMuteStream",(i,s,o)=>{if(te("BLOCK_LOCAL_CLIENT")&&Rh(i,this.channelName))return;V.debug("[".concat(this._clientId,"] receive mute message"),i,s,o);let c=this._users.find(p=>p.uid===i);if(!c)return void V.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));let d=s==="audio"?c.hasAudio:c.hasVideo;if(s==="audio"){c._trust_audio_mute_state_=!0;let p=c._audio_muted_;if(c._audio_muted_=o,c._audio_muted_===p)return;{let m=c._audio_muted_?"mute-audio":"unmute-audio";V.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(m)),this.safeEmit(jn.USER_INFO_UPDATED,i,m)}}else{c._trust_video_mute_state_=!0;let p=c._video_muted_;if(c._video_muted_=o,c._video_muted_===p)return;{let m=c._video_muted_?"mute-video":"unmute-video";V.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(m)),this.safeEmit(jn.USER_INFO_UPDATED,i,m)}}let u=s==="audio"?c.hasAudio:c.hasVideo;if(d!==u){if(!d&&u)return(s==="audio"?c._audioSSRC:c._videoSSRC)?(V.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(s)),void this.safeEmit(jn.USER_PUBLISHED,c,s)):void V.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(s," unmute message  before add stream message, ").concat(s," SSRC doesn't exist yet."));s==="video"&&c._videoTrack&&!c._video_pre_subscribed&&c._videoTrack._destroy(),s==="audio"&&c._audioTrack,this._p2pChannel.muteRemote(c,s),V.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(s)),this.safeEmit(jn.USER_UNPUBLISHED,c,s)}}),Z(this,"_handleP2PLost",async i=>{V.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():V.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)}),Z(this,"_handleTokenWillExpire",()=>{V.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(jn.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),Z(this,"_handleBeforeUnload",i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),V.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),Z(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(jn.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(jn.NETWORK_QUALITY,i)}),Z(this,"_handleP2PAddAudioOrVideoStream",(i,s,o,c)=>{let d=this._users.find(p=>p.uid===s);if(!d)return void V.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));V.debug("[".concat(this._clientId,"] stream added with uid ").concat(s,", type ").concat(i)),this.store.subscribe(d.uid,i,void 0,void 0,void 0,Date.now());let u=i==="audio"?d.hasAudio:d.hasVideo;i==="audio"?d._trust_audio_stream_added_state_=!0:d._trust_video_stream_added_state_=!0,i==="audio"?(d._audio_added_=!0,o!==void 0&&(d._audioSSRC=o),c!==void 0&&(d._audioMid=c)):(d._video_added_=!0,o!==void 0&&(d._videoSSRC=o),c!==void 0&&(d._videoMid=c)),(i==="audio"?d.hasAudio:d.hasVideo)&&!u&&(V.info("[".concat(this._clientId,"] remote user ").concat(d.uid," published ").concat(i)),this.safeEmit(jn.USER_PUBLISHED,d,i)),this._p2pChannel.hasPendingRemoteMedia(d,i)&&(V.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(d.uid," after reconnect.")),this._subscribe(d,i,!0).catch(p=>{V.error("[".concat(this._clientId,"] resubscribe error"),p.toString())}))}),this._config=r,this._clientId=e||In(5,"client-"),this.store=new class{constructor(i,s,o,c){Qt(this,"state",void 0),this.state={codec:i,audioCodec:s,mode:o,clientId:c,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:Um.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(i){this.state=(function(s,o){switch(o.type){case zt.SET_SESSION_ID:return nt(nt({},s),{},{sessionId:o.sessionId});case zt.SET_P2P_ID:return nt(nt({},s),{},{p2pId:o.p2pId});case zt.SET_UID:return nt(nt({},s),{},{uid:o.uid});case zt.SET_INT_UID:return nt(nt({},s),{},{intUid:o.intUid});case zt.SET_PUB_ID:return nt(nt({},s),{},{pubId:o.pubId});case zt.KEY_METRIC_CLIENT_CREATED:return nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{clientCreated:o.metric})});case zt.KEY_METRIC_JOIN_START:return nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{joinStart:o.metric})});case zt.KEY_METRIC_PRELOAD_START:return nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{preloadStart:o.metric})});case zt.KEY_METRIC_PRELOAD_END:return nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{preloadEnd:o.metric})});case zt.KEY_METRIC_JOIN_END:return nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{joinEnd:o.metric})});case zt.KEY_METRIC_REQUEST_AP_START:return nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{requestAPStart:o.metric})});case zt.KEY_METRIC_REQUEST_AP_END:return nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{requestAPEnd:o.metric})});case zt.KEY_METRIC_REQUEST_SUA_END:return nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{requestSUAEnd:o.metric})});case zt.KEY_METRIC_BEFORE_CONNECT:return nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{beforeConnect:o.metric})});case zt.KEY_METRIC_PEER_RECEIVER:return nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{peerReceiver:o.metric})});case zt.KEY_METRIC_SIGNAL_CONNECTED:return nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{signalConnected:o.metric})});case zt.KEY_METRIC_JOIN_REQ:return nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{joinReq:o.metric})});case zt.KEY_METRIC_JOIN_REP:return nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{joinRep:o.metric})});case zt.KEY_METRIC_JOIN_GATEWAY_START:return nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{joinGatewayStart:o.metric})});case zt.KEY_METRIC_JOIN_GATEWAY_END:return nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{joinGatewayEnd:o.metric})});case zt.KEY_METRIC_PEER_CONNECTION_START:return nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{peerConnectionStart:o.metric})});case zt.KEY_METRIC_PEER_CONNECTION_END:return nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{peerConnectionEnd:o.metric})});case zt.KEY_METRIC_DESCRIPTION_START:return nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{descriptionStart:o.metric})});case zt.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{signalChannelOpen:o.metric})});case zt.KEY_METRIC_ICE_CONNECTION_END:return nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{iceConnectionEnd:o.metric})});case zt.KEY_METRIC_PUBLISH:{let c=s.keyMetrics.publish,d=c.findIndex(u=>u.trackId===o.metric.trackId);return d!==-1?(c[d]=nt(nt({},c[d]),o.metric),nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{publish:[...c]})})):nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{publish:[...s.keyMetrics.publish,o.metric]})})}case zt.KEY_METRIC_SUBSCRIBE:{let c=s.keyMetrics.subscribe,d=c.findIndex(u=>u.userId===o.metric.userId&&u.type===o.metric.type);return d!==-1?(c[d]=nt(nt({},c[d]),o.metric),nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{subscribe:[...c]})})):nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{subscribe:[...s.keyMetrics.subscribe,o.metric]})})}case zt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{let c=s.keyMetrics.firstVideoFrameDecoded,d=c.findIndex(u=>u.userId===o.metric.userId);return d!==-1?(c[d]=nt(nt({},c[d]),o.metric),nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{firstVideoFrameDecoded:[...c]})})):nt(nt({},s),{},{keyMetrics:nt(nt({},s.keyMetrics),{},{firstVideoFrameDecoded:[...s.keyMetrics.firstVideoFrameDecoded,o.metric]})})}case zt.RESET_FIRST_VIDEO_FRAME_DECODED:return s.keyMetrics.firstVideoFrameDecoded=[],s;case zt.SET_CLOUD_PROXY_SERVER_MODE:return s.cloudProxyServerMode=o.mode,s;case zt.RECORD_JOIN_CHANNEL_SERVICE:return typeof o.index!="number"?s.joinChannelServiceRecords=[...s.joinChannelServiceRecords,o.record]:(s.joinChannelServiceRecords[o.index]=nt(nt({},s.joinChannelServiceRecords[o.index]),o.record),s.joinChannelServiceRecords=[...s.joinChannelServiceRecords]),s;case zt.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return s.joinChannelServiceRecords=[],s;case zt.RESET_KEY_METRICS:return s.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},s;case zt.SET_USE_P2P:return nt(nt({},s),{},{useP2P:o.val});case zt.SET_TRANSPORT_TYPE:return nt(nt({},s),{},{p2pTransport:o.val});default:return s}})(this.state,i)}set autoSubscribe(i){this.state.autoSubscribe=i}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(i){this.state.enableInstantMuteRestore=i}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(i){this.dispatch({type:zt.SET_SESSION_ID,sessionId:i})}get sessionId(){return this.state.sessionId}set cid(i){this.state.cid=i}get cid(){return this.state.cid}set codec(i){this.state.codec=i}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(i){this.dispatch({type:zt.SET_P2P_ID,p2pId:i})}get p2pId(){return this.state.p2pId}set dcId(i){this.dispatch({type:zt.SET_DC_ID,dcId:i})}get dcId(){return this.state.dcId}set uid(i){this.dispatch({type:zt.SET_UID,uid:i})}get uid(){return this.state.uid}set intUid(i){this.dispatch({type:zt.SET_INT_UID,intUid:i})}get intUid(){return this.state.intUid}set pubId(i){this.dispatch({type:zt.SET_PUB_ID,pubId:i})}get pubId(){return this.state.pubId}set cloudProxyServerMode(i){this.dispatch({type:zt.SET_CLOUD_PROXY_SERVER_MODE,mode:i})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(i){this.dispatch({type:zt.SET_USE_P2P,val:i})}get useP2P(){return this.state.useP2P}set p2pTransport(i){this.dispatch({type:zt.SET_TRANSPORT_TYPE,val:i})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(i){this.state.hasStartJoinChannel=i}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(i){this.state.isABTestSuccess=i}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:zt.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:zt.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:zt.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:zt.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:zt.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:zt.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:zt.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:zt.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:zt.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:zt.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:zt.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:zt.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:zt.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:zt.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:zt.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:zt.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:zt.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(i,s){this.dispatch({type:zt.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:nt({userId:i},s)})}descriptionStart(){this.dispatch({type:zt.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:zt.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:zt.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(i,s,o,c){this.dispatch({type:zt.KEY_METRIC_PUBLISH,metric:nt(nt({trackId:i,type:s},o&&{publishStart:o}),c&&{publishEnd:c})})}subscribe(i,s,o,c,d,u,p){this.dispatch({type:zt.KEY_METRIC_SUBSCRIBE,metric:nt(nt(nt(nt(nt({userId:i,type:s},o&&{subscribeStart:o}),c&&{subscribeEnd:c}),d&&{firstFrame:d}),u&&{streamAdded:u}),p&&{firstDecoded:p})})}massSubscribe(i,s,o,c){i.forEach(d=>{this.dispatch({type:zt.KEY_METRIC_SUBSCRIBE,metric:nt(nt(nt({userId:d.userId,type:d.type},s&&{subscribeStart:s}),o&&{subscribeEnd:o}),c&&{firstFrame:c})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(i,s){i.service==="gateway"&&Array.isArray(i.urls)&&(i.urls=i.urls.map(o=>o.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof s!="number"?(this.dispatch({type:zt.RECORD_JOIN_CHANNEL_SERVICE,record:nt(nt({},i),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(s<0||s>=this.state.joinChannelServiceRecords.length||this.dispatch({type:zt.RECORD_JOIN_CHANNEL_SERVICE,record:i,index:s}),s)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:zt.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:zt.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:zt.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(r.codec,r.audioCodec,r.mode,this._clientId),this._leaveMutex=new ha("client-leave",this._clientId),this._publishMutex=new ha("client-publish",this._clientId),this._renewTokenMutex=new ha("client-renewtoken",this._clientId),this._subscribeMutex=new ha("client-subscribe",this._clientId),this.store.clientCreated(),r.proxyServer&&this.setProxyServer(r.proxyServer,!0),r.turnServer&&this.setTurnServer(r.turnServer,!0),V.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Yl," build: ").concat(Ow,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),r.clientRoleOptions)try{wD(r.clientRoleOptions),t=Object.assign({},r.clientRoleOptions)}catch(i){V.warning("[".concat(this._clientId,"] ").concat(i.toString()))}var n;this._statsCollector=new lf(this.store),this._statsCollector.onStatsException=(i,s,o)=>{V.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(s,", uid: ").concat(o)),i===RF.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(c=>{c instanceof zi&&te("ENABLE_ENCODE_EXCEPTION")&&c.findClosestProfile()}),this.safeEmit(jn.EXCEPTION,{code:i,msg:s,uid:o})},this._statsCollector.onUploadPublishDuration=(i,s,o,c)=>{let d=this._users.find(u=>u.uid===i);d&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(d._uintid,{peerPublishDuration:o,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(d)),Ye.peerPublishStatus(this._sessionId,{subscribeElapse:c,audioPublishDuration:s,videoPublishDuration:o,peer:d._uintid}))},this._statsCollector.onVideoCodecChanged=i=>{if(te("VIDEO_STANDARD_BITRATE_VERSION")&&(i==="av1"||i==="h265"||i==="h264")){let s=this.localTracks.find(o=>o instanceof Ei);s&&s._saveEncodeBitrateRatio!==1&&s.setSaveEncodeBitrateRatio(i==="h264"?te("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=r.mode==="p2p",this._gateway=new dF(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:r.websocketRetryConfig||zr,httpRetryConfig:r.httpRetryConfig||zr,forceWaitGatewayResponse:r.forceWaitGatewayResponse===void 0||r.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:r.role,clientRoleOptions:t}),this._configDistribute=new yF(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(n={store:this.store,statsCollector:this._statsCollector},Tl("P2PChannel").create(n)),this._handleP2PEvents()):this._p2pChannel=new eS(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(r,e,t,n,i){let s=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],o=arguments.length>6&&arguments[6]!==void 0&&arguments[6];en("JOIN_GATEWAY_USE_443PORT_ONLY",s),en("JOIN_GATEWAY_USE_DUAL_DOMAIN",o);let c=this._gateway.signal.websocket;return c instanceof cP&&(c.use443PortOnly=s,c.tryDoubleDomain=o),(async function(d,u,p){xg.get(d)||xg.set(d,[]),mv.get(d)||mv.set(d,u),mu.get(d)||mu.set(d,0);let m=xg.get(d),g=mv.get(d);if(!m||!g)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(mu.get(d)===g){let w=Ew();m.push(w),await w.promise}mu.set(d,mu.get(d)+1);for(var T=arguments.length,R=new Array(T>3?T-3:0),I=3;I<T;I++)R[I-3]=arguments[I];let A=await p(...R);return mu.set(d,mu.get(d)-1),mu.get(d)===g-1&&m.length>0&&(m[0].resolve(),m.shift()),mu.get(d)===0&&(xg.set(d,[]),mv.set(d,0),mu.set(d,0)),A})("client.join",te("JOIN_MAX_CONCURRENCY"),this.join.bind(this),r,e,t,n,i)}async join(r,e,t,n,i){let s=++this._numberOfJoinCount;this.store.joinStart(),n&&(this.store.uid=n);let o=(Id||Id||(Id=(window.location.protocol.split(":")[0]||"").toUpperCase(),Id))==="HTTPS",c=s4()?window.isSecureContext:"Browser Not Support";(!s4()&&!o||!window.isSecureContext)&&V.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let d;Ye.setAppId(r);try{if(!t&&t!==null)throw new fe(z.INVALID_PARAMS,"Invalid token: ".concat(t,". If you don not use token, set it to null"));if(t&&Eo(t,"token",1,2047),Eo(r,"appid",1,2047),cn(e),n&&wv(n),i)if(typeof i=="string")Eo(i,"optionalInfo",1,256),d=i;else{if(typeof i!="object")throw new fe(z.INVALID_PARAMS,"Invalid options: options is not a string or object");{let{autoSubscribe:A,enableInstantMuteRestore:w}=i;A&&(Ge(A,"autoSubscribe"),V.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(A)),this.store.autoSubscribe=A),w&&(Ge(w,"enableInstantMuteRestore"),V.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(w)),this.store.enableInstantMuteRestore=w)}}}catch(A){throw Ye.reportApiInvoke(Oi(),{name:Zr.JOIN,options:[r,e,t,n],states:{isHttps:o,isSecureContext:c},tag:Cn.TRACER}).onError(A),A}if(this._leaveMutex.isLocked&&(V.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),V.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){let A=new fe(z.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Ye.reportApiInvoke(Oi(),{name:Zr.JOIN,options:[r,e,t,n],states:{isHttps:o,isSecureContext:c},tag:Cn.TRACER}).onError(A),A}this._gateway.state="CONNECTING",this.store.preloadStart();let u=await xF({appId:r,cname:e,uid:n,stringUid:typeof n=="string"?n:void 0,token:t||r,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new fe(z.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));let p=u?.sid||Oi();V.info("[".concat(this._clientId,"] start join channel ").concat(e,", join number: ").concat(s)),this._sessionId||(this._sessionId=p,this.store.sessionId=this._sessionId);let m=Ye.reportApiInvoke(p,{id:this._clientId,name:Zr.JOIN,options:[r,e,t,n],states:{isHttps:o,isSecureContext:c},tag:Cn.TRACER}),g=Ou(Ou(Ou({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:r,sid:this._sessionId,cname:e,uid:typeof n!="string"?n:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:t||r,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:d,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!u},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:te("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(g.setLocalAPVersion=this._setLocalAPVersion),typeof n=="string"&&(g.stringUid=n,this._uintUid?(g.uid=this._uintUid,this._uintUid=void 0):g.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(g.aesmode=this._encryptionMode,g.aespassword=await(async A=>{let w=(function(K){let W=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),Y=new Uint8Array(new ArrayBuffer(W.length));for(let se=0;se<W.length;se+=1)Y[se]=W.charCodeAt(se);return Y})(),k=await window.crypto.subtle.importKey("spki",w,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),L=bD(A),j=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},k,L);return(function(K){let W="";for(let Y=0;Y<K.length;Y+=1)W+=String.fromCharCode(K[Y]);return window.btoa(W)})(new Uint8Array(j))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new fe(z.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(g.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){let A=new TextEncoder,w=te("USE_PURE_ENCRYPTION_MASTER_KEY")?A.encode(g.appId+this._encryptionSecret+this._encryptionSecret):A.encode(g.appId+g.cname+this._encryptionSecret);this._encryptDataStreamIv=await(async function(k,L,j){let K=await window.crypto.subtle.importKey("raw",L,"PBKDF2",!1,["deriveBits","deriveKey"]),W=k==="aes-128-gcm2"?128:256,Y=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:c4,hash:"SHA-256",salt:j},K,W+a4);return new Uint8Array(Y).subarray(W/8)})(this._encryptionMode,w,Cd(this._encryptionSalt)),this._encryptDataStreamKey=await(async function(k,L,j){let K=await window.crypto.subtle.importKey("raw",L,"PBKDF2",!1,["deriveBits","deriveKey"]),W=k==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:c4,hash:"SHA-256",salt:j},K,{name:"AES-GCM",length:W},!0,["encrypt","decrypt"])})(this._encryptionMode,w,Cd(this._encryptionSalt))}else c?V.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):V.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,V.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:e,appId:r,stringUid:g.stringUid});let T=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&T===this._sessionId&&Ye.joinChannelTimeout(this._sessionId,5)},5e3);try{var R;let A,w=g.cloudProxyServer;if(Re(R=["proxy3","proxy4","proxy5"]).call(R,w)){let W=te("PROXY_SERVER_TYPE3");Array.isArray(W)?g.proxyServer=W[0]:g.proxyServer=W}if(Ye.setProxyServer(g.proxyServer),V.setProxyServer(g.proxyServer),this.store.requestAPStart(),u){if(V.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(g.stringUid?", ".concat(g.stringUid," => ").concat(u.intUid):""," ")),g.stringUid&&!g.uid&&(g.uid=u.intUid),A={gatewayInfo:u.ap.gatewayInfo},te("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&g.turnServer.mode==="auto")if(u.ap.proxyInfo.addresses.length===0)V.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let W=(await FC(u.ap.proxyInfo,u.ap.gatewayInfo.uid)).map(Y=>({turnServerURL:Y.address,tcpport:Y.tcpport||Bs.tcpport,udpport:Y.udpport||Bs.udpport,username:Y.username||Bs.username,password:Y.password||Bs.password,forceturn:!1,security:!0}));g.turnServer={mode:"manual",servers:W}}FF(u,g.stringUid)}else{if(g.stringUid&&!g.uid){let W;[W,A]=await De.all([TF(g.stringUid,g,this._axiosCancelSource.token,this._config.httpRetryConfig||zr,this.store).finally(()=>{this.store.requestSUAEnd()}),EP(g,this._axiosCancelSource.token,this._config.httpRetryConfig||zr,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),V.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(g.stringUid," => ").concat(W)),g.uid=W,A.gatewayInfo.uid=W,A.gatewayInfo.res.uid=W}else A=await EP(g,this._axiosCancelSource.token,this._config.httpRetryConfig||zr,!0,this.store);if(!this._joinAndNotLeaveYet)throw new fe(z.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(g,this._axiosCancelSource.token),this._configDistribute.on(Xg.UPDATE_BITRATE_LIMIT,W=>{this._p2pChannel.updateBitrateLimit(W)}),this._configDistribute.on(Xg.UPDATE_CLIENT_ROLE_OPTIONS,W=>{this._setClientRoleOptions(W)})},0),this._key=t||r;let k=A.gatewayInfo,L=g.uid?g.uid:k.uid;this._joinInfo=Ou(Ou({},g),{},{cid:k.cid,uid:L,vid:k.vid,apResponse:k.res,apGatewayAddress:k.apGatewayAddress,uni_lbs_ip:k.uni_lbs_ip,gatewayAddrs:k.gatewayAddrs}),this.store.intUid=L,this.store.cid=k.cid;let j=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new fe(z.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));m.onSuccess(j),this._appId=r,this._channelName=g.cname,this._uid=j,this.store.uid=j,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(ms()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);let K=g.stringUid?"string uid: ".concat(g.stringUid,",uid: ").concat(g.uid):"uid: ".concat(this._uid);return V.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(e,",").concat(K)),setTimeout(()=>{V.startUpload()},5e3),this.store.joinEnd(),I=this,Re(Yg).call(Yg,I)||Yg.push(I),this._cloudProxyServerMode==="disabled"&&on().supportWebCrypto&&te("ENABLE_PRELOAD")&&OP(this._joinInfo),j}catch(A){let w=Array.isArray(A)?A[0]:A;throw w&&w.code===z.OPERATION_ABORTED?V.warning("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),w):V.error("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),w),w.code!==z.OPERATION_ABORTED&&this._numberOfJoinCount===s&&(this._gateway.state="DISCONNECTED",this._reset()),m.onError(w),w}var I}_joinGateway(){if(!this._joinInfo||!this._key)throw new fe(z.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!te("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){V.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(ms()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),(function(e){let t=Yg.indexOf(e);t!==-1&&Yg.splice(t,1)})(this),this._statsCollector.stopUpdateStats();let r=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return V.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void r();await this._gateway.leave(this.connectionState!=="CONNECTED",Di.LEAVE),V.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),r()}async publish(r){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(r)){if(!(r instanceof Cv))return this._publishDataChannel(r);r=[r]}if(r.length===0)throw new fe(z.INVALID_PARAMS,"param list is empty");let t=r;if(this._gateway.role==="audience")throw new fe(z.INVALID_OPERATION,"audience can not publish stream");for(let i of t){if(!(i instanceof Cv))throw new fe(z.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&e)throw new fe(z.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}V.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(t.map(i=>"".concat(i.getTrackId()," "))));let n=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),e&&t.forEach(i=>{let s=this._configDistribute.getBitrateLimit();i instanceof Ei&&s&&i.setBitrateLimit(s.uplink)});try{await this._publishHighStream(t),V.info("[".concat(this._clientId,"] Publish success, id ").concat(t.map(i=>"".concat(i.getTrackId()," "))))}catch(i){throw V.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{n()}}async _publishDataChannel(r){if(r==null)throw new fe(z.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(r)));Tn(r.id,"id",0,65535,!0),Ge(r.ordered,"ordered"),Eo(r.metadata,"metadata",0,512),V.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(r.id));let e=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(i=>i.id===r.id)!==-1)throw new fe(z.INVALID_PARAMS,"Invalid id: ".concat(r.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new fe(z.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new fe(z.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&te("FORCE_TURN")&&!te("TURN_ENABLE_TCP")&&!te("TURN_ENABLE_UDP"))throw new fe(z.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let t=(function(i){return b_(i,!1)})(r),n=await this._p2pChannel.publishDataChannel([t]);if(n.length>0){if(typeof t._originDataChannelId!="number")throw V.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new fe(z.CREATE_DATACHANNEL_ERROR);try{await De.all(n.map(i=>this._uid&&this._gateway.publishDataChannel(this._uid,i,!0))),await t._waitTillOpen()}catch(i){if(i.code!==z.DISCONNECT_P2P)throw i}}return V.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(t.id)),t}catch(t){throw V.error("[".concat(this._clientId,"] publish datachannels error"),t.toString()),t}finally{e()}}async unpublish(r){if(!this._joinInfo||this._uid===void 0)throw new fe(z.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let e=[];if(r)if(Array.isArray(r))e=r;else{if(!(r instanceof Cv))return this._unpublishDataChannel([r]);e=[r]}else this.store.useP2P||await this._unpublishDataChannel(),e=this._p2pChannel.getAllTracks(!0);V.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(n=>"".concat(n.getTrackId()," "))," "));let t=await this._publishMutex.lock();try{if(this.store.useP2P){let n=await this._p2pChannel.unpublish(e);n&&await this._gateway.sendExtensionMessage(Lr.UNPUBLISH,{unpubMsg:n},!0)}else{let n=await this._p2pChannel.unpublish(e);n&&await this._gateway.unpublish(n,this._uid),V.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(i=>"".concat(i.getTrackId()))))}}catch(n){throw V.error("[".concat(this._clientId,"] unpublish error"),n.toString()),n}finally{t&&t()}}async _unpublishDataChannel(r){r!==void 0&&r.length!==0||(r=this._p2pChannel.getAllDataChannels()),V.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(r.map(t=>"".concat(t.id," "))," "));let e=await this._publishMutex.lock();try{let t=await this._p2pChannel.unpublishDataChannel(r);t&&await this._gateway.unpublishDataChannel(t),V.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(r.map(n=>"".concat(n.id))))}catch(t){throw V.error("[".concat(this._clientId,"] unpublish dataChannel error"),t.toString()),t}finally{e&&e()}}async subscribe(r,e,t){if(!(r instanceof Xm)){let n=this.remoteUsers.find(i=>i.uid===r);if(!n)throw new fe(z.INVALID_REMOTE_USER,"user is not in the channel");r=n}return e==="datachannel"?this._subscribeDataChannel(r,t):this._subscribe(r,e)}async presubscribe(r,e){if(gr(e,"mediaType",["audio","video"]),this.store.useP2P)throw new fe(z.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new fe(z.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new fe(z.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let t=e===vt.AUDIO,n=e===vt.VIDEO,i=await this._subscribeMutex.lock();try{let{ssrcId:s,ortc:o,rtxSsrcId:c,cname:d,uint_id:u}=await this._gateway.presubscribe(r,e,!0);if(s==null)throw new fe(z.UNEXPECTED_RESPONSE,"no ssrc id");let p=this._users.find(g=>g.uid===r);p||(p=new Xm(r,u||r),p._is_pre_created=!0,this._users.push(p)),d&&(p._cname=d),p._uintid||(p._uintid=u||r),t&&(p._audioSSRC=s,p._audio_pre_subscribed=!0,o&&(p._audioOrtc=o)),n&&(p._videoSSRC=s,p._video_pre_subscribed=!0,o&&(p._videoOrtc=o),c!=null&&(p._rtxSsrcId=c)),V.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(s)),await this._p2pChannel.subscribe(p,e,s,c,o);let m=t?p._audioTrack:p._videoTrack;if(!m)throw new fe(z.UNEXPECTED_ERROR,"can not find remote track in user");return t&&(p._trust_audio_stream_added_state_=!0,p._audio_added_=!0),n&&(p._trust_video_stream_added_state_=!0,p._video_added_=!0),m}catch(s){throw V.error("[".concat(this._clientId,"] presub user ").concat(r," error"),s),s}finally{i()}}async _subscribeDataChannel(r,e){var t;if(Tn(e,"channelId",0,65535,!0),!this._joinInfo)throw new fe(z.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new fe(z.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(o=>o===r))throw V.error("[".concat(this._clientId,"] can not subscribe ").concat(r.uid,", this user is not in the channel")),new fe(z.INVALID_REMOTE_USER,"user is not in the channel");if(!r.hasAudio&&!r.hasVideo&&r._dataChannels.length===0)throw V.error("[".concat(this._clientId,"] can not subscribe ").concat(r.uid,", user is not published")),new fe(z.INVALID_REMOTE_USER,"user is not published");let n=(t=r._dataChannels)===null||t===void 0?void 0:t.find(o=>o.id===e);if(!n)throw V.error("[".concat(this._clientId,"] can not subscribe ").concat(r.uid," with mediaType datachannel, remote datachannel is not published")),new fe(z.REMOTE_USER_IS_NOT_PUBLISHED);let i=await this._subscribeMutex.lock();V.info("[".concat(this._clientId,"] subscribe user ").concat(r.uid,", mediaType: datachannel"));try{let o=await this._p2pChannel.subscribeDataChannel(r,[n]);if(o&&Re(o).call(o,n.id))try{var s;if(typeof n._originDataChannelId!="number")throw V.error("[".concat(this._clientId,"] can not subscribe ").concat(r.uid," with mediaType datachannel, cannot get RTCDatachannel")),new fe(z.CREATE_DATACHANNEL_ERROR);let c={id:n.id,datachannelId:n._originDataChannelId,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:(s=n.metadata)!==null&&s!==void 0?s:""};await this._gateway.subscribeDataChannel(r.uid,c,!0),await n._waitTillOpen()}catch(c){if(c?.code!==z.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(r,[n]),c;await this._p2pChannel.unsubscribeDataChannel(r,[n]),this._p2pChannel.setPendingRemoteDataChannel(r,n.id)}return V.info("[".concat(this._clientId,"] subscribe success user ").concat(r.uid,", mediaType: datachannel")),n}finally{i()}}async _p2pSubscribe(r,e,t){if(gr(e,"mediaType",["audio","video"]),!this._joinInfo)throw new fe(z.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new fe(z.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(i=>i===r)){let i=new fe(z.INVALID_REMOTE_USER,"user is not in the channel");throw V.error("[".concat(this._clientId,"] can not subscribe ").concat(r.uid,", this user is not in the channel")),i}if(!r.hasAudio&&!r.hasVideo){let i=new fe(z.INVALID_REMOTE_USER,"user is not published");throw V.error("[".concat(this._clientId,"] can not subscribe ").concat(r.uid,", user is not published")),i}if(!t&&(e==="audio"&&!r.hasAudio||e==="video"&&!r.hasVideo)){let i=new fe(z.REMOTE_USER_IS_NOT_PUBLISHED);throw V.error("[".concat(this._clientId,"] can not subscribe ").concat(r.uid," with mediaType ").concat(e,", remote track is not published")),i}let n=await this._subscribeMutex.lock();V.info("[".concat(this._clientId,"] subscribe user ").concat(r.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(r,e))await this._p2pChannel.unmuteRemote(r,e);else try{let s=e==="audio"?r._audioSSRC:r._videoSSRC,o=e==="audio"?r._audioMid:r._videoMid;this.store.subscribe(r.uid,e,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(r,e,s,o)}catch(s){throw s}V.info("[".concat(this._clientId,"] subscribe success user ").concat(r.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(r.uid,this._defaultStreamFallbackType).catch(s=>{V.warning("[".concat(this._clientId,"] auto set fallback failed"),s)});let i=e==="audio"?r._audioTrack:r._videoTrack;if(!i)throw new fe(z.UNEXPECTED_ERROR,"can not find remote track in user object");return i}catch(i){throw V.error("[".concat(this._clientId,"] subscribe user ").concat(r.uid," error"),i),i}finally{n()}}async _subscribe(r,e,t){if(this.store.useP2P)return this._p2pSubscribe(r,e);if(gr(e,"mediaType",["audio","video"]),!this._joinInfo)throw new fe(z.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new fe(z.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(d=>d===r)){let d=new fe(z.INVALID_REMOTE_USER,"user is not in the channel");throw V.error("[".concat(this._clientId,"] can not subscribe ").concat(r.uid,", this user is not in the channel")),d}if(!r.hasAudio&&!r.hasVideo){let d=new fe(z.INVALID_REMOTE_USER,"user is not published");throw V.error("[".concat(this._clientId,"] can not subscribe ").concat(r.uid,", user is not published")),d}if(!(t||(e!=="audio"||r.hasAudio&&r._audioSSRC!==void 0)&&(e!=="video"||r.hasVideo&&r._videoSSRC!==void 0))){let d=new fe(z.REMOTE_USER_IS_NOT_PUBLISHED);throw V.error("[".concat(this._clientId,"] can not subscribe ").concat(r.uid," with mediaType ").concat(e,", remote track is not published")),d}let n=e==="audio"?r._audioSSRC:r._videoSSRC,i=e==="audio"?r._audioOrtc:r._videoOrtc,s=e==="video"?r._rtxSsrcId:void 0,o={stream_type:e==="audio"?vt.AUDIO:vt.VIDEO,ssrcId:n};e==="video"&&this.store.firstVideoFrameDecoded(r.uid,{subscribeStart:Date.now()});let c=await this._subscribeMutex.lock();V.info("[".concat(this._clientId,"] subscribe user ").concat(r.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(r,e))await this._p2pChannel.unmuteRemote(r,e);else try{let u=e==="audio"?r._audioSSRC:r._videoSSRC;u!==void 0&&u!==n&&(n=u,i=e==="audio"?r._audioOrtc:r._videoOrtc,s=e==="video"?r._rtxSsrcId:void 0,o={stream_type:e==="audio"?vt.AUDIO:vt.VIDEO,ssrcId:n}),ta.markSubscribeStart(this.store.clientId,n),this.store.subscribe(r.uid,e,Date.now()),await this._p2pChannel.subscribe(r,e,n,s,i);try{this._p2pChannel.isPreSubScribe(n)||await this._gateway.subscribe(r.uid,o,!0)}catch(p){if(p?.code!==z.WS_ABORT)throw await this._p2pChannel.unsubscribe(r,e),p;await this._p2pChannel.unsubscribe(r,e,!0),this._p2pChannel.setPendingRemoteMedia(r,e)}this.store.subscribe(r.uid,e,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,r,e)}catch(u){throw this._p2pChannel.reportSubscribeEvent(!1,u?.code,r,e),u}V.info("[".concat(this._clientId,"] subscribe success user ").concat(r.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(r.uid,this._defaultStreamFallbackType).catch(u=>{V.warning("[".concat(this._clientId,"] auto set fallback failed"),u)});let d=e==="audio"?r._audioTrack:r._videoTrack;if(!d)throw new fe(z.UNEXPECTED_ERROR,"can not find remote track in user object");return e==="video"&&(this.store.firstVideoFrameDecoded(r.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(r)),d}catch(d){throw V.error("[".concat(this._clientId,"] subscribe user ").concat(r.uid," error"),d),d}finally{c()}}async massSubscribe(r){if(ls(r,"subscribeList"),!this._joinInfo)throw new fe(z.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new fe(z.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let e=Date.now(),t=new Map,n=await this._subscribeMutex.lock();V.info("[".concat(this._clientId,"]start massSubscribe user ").concat(r.map(c=>{let{user:d,mediaType:u}=c;return"user: ".concat(d?.uid,", mediaType: ").concat(u)}).join("; ")));let i=(r=[...r]).map(c=>{let{user:d,mediaType:u}=c;return{user:d,mediaType:u}}),s=await this._p2pChannel.globalLock();try{var o;for(let d=r.length-1;d>=0;d--){let u=r[d],{user:p,mediaType:m}=u;if(gr(m,"mediaType",["audio","video"]),!p){let R=new fe(z.INVALID_PARAMS,"user property does not exist in subscribeList item");throw V.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),R}if(!this._users.find(R=>R===p)){let R=new fe(z.INVALID_REMOTE_USER,"user is not in the channel");V.error("[".concat(this._clientId,"] can not massSubscribe ").concat(p.uid,", this user is not in the channel")),i[d].error=R,r.splice(d,1);continue}if(m==="audio"&&(!p.hasAudio||p._audioSSRC===void 0)||m==="video"&&(!p.hasVideo||p._videoSSRC===void 0)){let R=new fe(z.REMOTE_USER_IS_NOT_PUBLISHED);V.error("[".concat(this._clientId,"] can not subscribe ").concat(p.uid," with mediaType ").concat(m,", remote user is not published")),i[d].error=R,r.splice(d,1);continue}let g=Ws.Video|Ws.LwoVideo,T=t.get(p);if(T){if(m==="video"?T&g:T&Ws.Audio){r.splice(d,1),V.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(p.uid,", mediaType:").concat(m," twice"));continue}t.set(p,T|(m==="video"?g:Ws.Audio))}else t.set(p,m==="video"?g:Ws.Audio)}for(let d=r.length-1;d>=0;d--){let u=r[d],{user:p,mediaType:m}=u,g=Ws.Video|Ws.LwoVideo;if(this._p2pChannel.hasRemoteMedia(p,m)){await this._p2pChannel.unmuteRemoteNoLock(p,m);let T=t.get(p);t.set(p,m==="video"?T^g:T^Ws.Audio),r.splice(d,1)}}this.store.massSubscribe(r.map(d=>({userId:d.user.uid,type:d.mediaType})),e);let c=Ks(o=Array.from(t.entries())).call(o,(d,u)=>{let[p,m]=u;if(m===0)return d;let g={stream_id:p.uid,stream_type:m};return m&Ws.Audio&&(g.audio_ssrc=p._audioSSRC),m&Ws.Video&&(g.video_ssrc=p._videoSSRC),d.push(g),d},[]);try{r.length>0&&await this._p2pChannel.massSubscribeNoLock(r.map(u=>{let{user:p,mediaType:m}=u;return{user:p,mediaType:m,ssrcId:m===vt.VIDEO?p._videoSSRC:p._audioSSRC,rtxSsrcId:m===vt.VIDEO?p._rtxSsrcId:void 0}}));let d=new Map;if(c=c.filter(u=>u.video_ssrc&&!this._p2pChannel.isPreSubScribe(u.video_ssrc)||u.audio_ssrc&&!this._p2pChannel.isPreSubScribe(u.audio_ssrc)||!u.video_ssrc&&!u.audio_ssrc),c.length>0&&((await this._gateway.subscribeAll(c,!0))?.users||[]).forEach(p=>{let{stream_id:m,video_error_code:g,audio_error_code:T,error_code:R}=p;(g||T||R)&&d.set(m,{video_error_code:g,audio_error_code:T,error_code:R})}),Array.from(d.entries()).length>0){let u=[];Array.from(d.entries()).forEach(p=>{let[m,g]=p,T=this.remoteUsers.find(R=>R.uid===m);if(T){let R;g.error_code||g.video_error_code&&g.audio_error_code?R=void 0:g.video_error_code?R=vt.VIDEO:g.audio_error_code&&(R=vt.AUDIO),u.push({user:T,mediaType:R})}}),u.length>0&&await this._p2pChannel.massUnsubscribeNoLock(u)}for(let u of i){let p=d.get(u.user.uid);if(p){let m=p.error_code||u.mediaType==="audio"&&p.audio_error_code||u.mediaType==="video"&&p.video_error_code;if(m){let g=Yw(m);V.error("user:".concat(u.user.uid," mediaType:").concat(u.mediaType," has massSubscribe error ").concat(g.desc)),u.error=new fe(z.SUBSCRIBE_FAILED,"code ".concat(m,": ").concat(g.desc))}}u.error||(u.mediaType==="video"?u.track=u.user.videoTrack:u.track=u.user.audioTrack)}return this.store.massSubscribe(i.filter(u=>!u.error).map(u=>({userId:u.user.uid,type:u.mediaType})),void 0,Date.now()),i.forEach(u=>{var p;Ye.subscribe(this.store.sessionId,{succ:!!u.error,ec:((p=u.error)===null||p===void 0?void 0:p.code)||null,video:u.mediaType===vt.VIDEO,audio:u.mediaType===vt.AUDIO,peerid:u.user.uid,subscribeRequestid:u.mediaType===vt.VIDEO?u.user._videoSSRC:u.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-e),preSsrc:this._p2pChannel.isPreSubScribe(u.user._videoSSRC)},!0)}),V.info("[".concat(this._clientId,"] massSubscribe success ").concat(r.map(u=>{let{user:p,mediaType:m}=u;return"user: ".concat(p?.uid,", mediaType: ").concat(m)}).join("; "))),i}catch(d){throw await this._p2pChannel.massUnsubscribeNoLock(r),d}}finally{s(),n()}}async unsubscribe(r,e,t){if(!(r instanceof Xm)){let i=this.remoteUsers.find(s=>s.uid===r);if(!i)throw new fe(z.INVALID_REMOTE_USER,"user is not in the channel");r=i}if(e||this.store.useP2P){if(e==="datachannel")return this._unsubscribeDataChannel(r,t)}else await this._unsubscribeDataChannel(r,t);if(e&&gr(e,"mediaType",["audio","video"]),!this._joinInfo)throw new fe(z.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(i=>i===r)){let i=new fe(z.INVALID_REMOTE_USER,"user is not in the channel");throw V.error("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),i}V.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(r.uid,", mediaType: ").concat(e));let n=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(r,e);else{let i=await this._p2pChannel.unsubscribe(r,e);i&&await this._gateway.unsubscribe(i,r.uid),e&&e!=="audio"||(r._audio_pre_subscribed=!1),e&&e!=="video"||(r._video_pre_subscribed=!1),r._is_pre_created&&$r(this._users,r),V.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(r.uid,", mediaType: ").concat(e))}}catch(i){if(i.code===z.DISCONNECT_P2P)return void V.warning("disconnecting p2p, abort unsubscribe request.");throw V.error("[".concat(this._clientId,"] unsubscribe user ").concat(r.uid," error"),i.toString()),i}finally{n()}}async _unsubscribeDataChannel(r,e){if(e&&Tn(e,"id",0,65535,!0),!this._joinInfo)throw new fe(z.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(n=>n===r)){let n=new fe(z.INVALID_REMOTE_USER,"user is not in the channel");throw V.error("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),n}let t;if(typeof e=="number"){let n=r._dataChannels.find(i=>i.id===e);n&&(t=[n])}else t=r._dataChannels;if(t===void 0){let n=new fe(z.REMOTE_USER_IS_NOT_PUBLISHED);throw V.error("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid," with channelId ").concat(e,", remote datachannel is not published")),n}V.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(r.uid,", mediaType: datachannel, ids: ").concat(t.map(n=>n.id)));try{let n=await this._p2pChannel.unsubscribeDataChannel(r,t);n&&await this._gateway.unsubscribeDataChannel(n,r.uid),V.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(r.uid,", mediaType: datachannel, ids: ").concat(n))}catch(n){if(n.code===z.DISCONNECT_P2P)return void V.warning("disconnecting p2p, abort unsubscribe request.");throw V.error("[".concat(this._clientId,"] unsubscribe user ").concat(r.uid," error"),n.toString()),n}}async massUnsubscribe(r){if(ls(r,"unsubscribeList"),!this._joinInfo)throw new fe(z.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");V.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(r.map(t=>{let{user:n,mediaType:i}=t;return"user: ".concat(n?.uid,", mediaType: ").concat(i,";")}).join())),r=[...r];let e=new Map;for(let t=r.length-1;t>=0;t--){let{user:n,mediaType:i}=r[t];if(!n){let o=new fe(z.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw V.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),o}if(gr(i,"mediaType",["video","audio",void 0]),!this._users.find(o=>o===n)){V.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),r.splice(t,1);continue}let s=Ws.Video|Ws.LwoVideo;if(e.has(n)){let o=e.get(n),c;switch(i){case"video":c=o&s;break;case"audio":c=o&Ws.Audio;break;default:c=o&(Ws.Audio|s)}if(c){V.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(n.uid,",mediaType:").concat(i," twice.")),r.splice(t,1);continue}i?i==="audio"?e.set(n,o|Ws.Audio):i==="video"&&e.set(n,o|s):e.set(n,o|Ws.Audio|s)}else i?i==="audio"?e.set(n,Ws.Audio):i==="video"&&e.set(n,s):e.set(n,Ws.Audio|s)}try{let t=await this._p2pChannel.massUnsubscribe(r);t&&await this._gateway.massUnsubscribe(t),V.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(r.map(n=>{let{user:i,mediaType:s}=n;return"user: ".concat(i?.uid,", mediaType: ").concat(s,";")}).join()))}catch(t){if(t.code===z.DISCONNECT_P2P)return void V.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw V.error("[".concat(this._clientId,"] massUnsubscribe error"),t.toString()),t}}async setLowStreamParameter(r){(function(t){if(!t)throw new H(z.INVALID_PARAMS);Hi(t.width)||Mi(t.width,"streamParameter.width"),Hi(t.height)||Mi(t.height,"streamParameter.height"),Hi(t.framerate)||Mi(t.framerate,"streamParameter.framerate"),Hi(t.bitrate)||Tn(t.bitrate,"streamParameter.bitrate")})(r),(!r.width&&r.height||r.width&&!r.height)&&V.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),V.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(r));let e=this._configDistribute.getLowStreamConfigDistribute();if(e&&e.bitrate&&r.bitrate&&e.bitrate<r.bitrate&&(r.bitrate=e.bitrate),this._lowStreamParameter=r,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(r,$e.LocalVideoLowTrack)}async enableDualStream(){if(!on().supportDualStream)throw Ye.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new fe(z.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new fe(z.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(r){throw Ye.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),r}this._isDualStreamEnabled=!0,Ye.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),V.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new fe(z.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia($e.LocalVideoLowTrack))try{let r=await this._p2pChannel.unpublishLowStream();r&&await this._gateway.unpublish(r,this._joinInfo.stringUid||this._joinInfo.uid)}catch(r){throw Ye.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),r}this._isDualStreamEnabled=!1,Ye.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),V.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(r,e){if((function(n){gr(n,"role",["audience","host"])})(r),e&&wD(e),this.mode==="rtc"||this.mode==="p2p")throw V.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new fe(z.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(e&&e.level&&r==="host")throw new fe(z.INVALID_OPERATION,"host mode can not set audience latency level");if(r==="audience"&&this._p2pChannel.hasLocalMedia())throw new fe(z.INVALID_OPERATION,"can not set client role to audience when publishing stream");let t=this._config.role;this._joinInfo&&(this._joinInfo.role=r),r!==t&&te("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(r,e),this._config.role=r,this._gateway.reconnect("recover",$t.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(r,e),this._config.role=r),V.info("[".concat(this._clientId,"] set client role to ").concat(r,", level: ").concat(e&&e.level))}async _setClientRoleOptions(r){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let e=!1;try{r&&wD(r),await this._gateway.setClientRole(this._config.role,r),e=!0}catch{}finally{V.info("[".concat(this._clientId,"] set client role options ").concat(e?"succeed":"failed",", options is ").concat(r))}}getRemoteInboundOffset(){var r;let e=(r=this._p2pChannel.getStats())===null||r===void 0?void 0:r.audioSend[0];if(!e||!e.timestamp)return 0;let t=e.timestamp-Date.now();return Math.abs(t)>1e3+e.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?t:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(r,e){if(Eo(r,"proxyServer"),!e){if(this.connectionState!=="DISCONNECTED")throw new fe(z.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new fe(z.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=r,Ye.setProxyServer(this._proxyServer),V.setProxyServer(this._proxyServer),V.info("[".concat(this._clientId,"] Set proxy server ").concat(e?"by initialize call":""," success."))}setTurnServer(r,e){if(Array.isArray(r)||(r=[r]),!e){if(this.connectionState!=="DISCONNECTED")throw new fe(z.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new fe(z.INVALID_OPERATION,"You have already set the proxy")}if(Ti(r))return this._turnServer={servers:r,mode:"original-manual"},void V.info("[".concat(this._clientId,"] Set original turnserver ").concat(e?"by initialize call":""," success: ").concat(r.map(t=>t.urls).join(","),"."));r.forEach(t=>_C(t)),this._turnServer={servers:r,mode:"manual"},V.info("[".concat(this._clientId,"] Set turnserver ").concat(e?"by initialize call":""," success."))}setLicense(r){if(this.connectionState!=="DISCONNECTED")throw new fe(z.INVALID_OPERATION,"you should set license before join channel");if(Eo(r,"license",32,32),!/^[A-Za-z\d]+$/.test(r))throw new fe(z.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=r,V.info("[".concat(this._clientId,"] set license success"),r)}startProxyServer(r){if(this.connectionState!=="DISCONNECTED")throw new fe(z.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new fe(z.INVALID_OPERATION,"You have already set the proxy");let e=[3,4,5],t;switch(r===void 0&&(r=3),r){case 1:case 2:throw new fe(z.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:t="proxy3";break;case 4:t="proxy4";break;case 5:t="proxy5";break;default:throw new fe(z.INVALID_PARAMS,"proxy server mode must be ".concat(e.join("|")))}this._cloudProxyServerMode=t,this.store.cloudProxyServerMode=t,V.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new fe(z.INVALID_OPERATION,"Stop proxy server after leave channel");Ye.setProxyServer(),V.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",V.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(r){if(!r.accessPoints)throw new fe(z.INVALID_PARAMS,"accessPoints is required.");ls(r.accessPoints.serverList,"accessPoints.serverList"),Eo(r.accessPoints.domain,"accessPoints.domain");let e=(g,T)=>{Tn(g,T,0,65535,!0)},t=443;if(r.accessPoints.port&&(e(r.accessPoints.port,"accessPoints.port"),t=r.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new fe(z.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");te("CLOSE_AFB_FOR_LOCAL_AP")&&(en("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),en("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let n=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=r.accessPoints.domain,s=r.accessPoints.serverList.map(g=>n.test(g)?"".concat(g.replace(/\./g,"-"),".").concat(i):g),o=s.map(g=>"".concat(g,":").concat(t));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,en("WEBCS_DOMAIN",o),en("WEBCS_DOMAIN_BACKUP_LIST",o),en("GATEWAY_DOMAINS",[i]),r.report&&r.report.hostname&&Array.isArray(r.report.hostname)&&r.report.hostname.length?(ls(r.report.hostname,"report.hostname"),en("EVENT_REPORT_DOMAIN",r.report.hostname[0]),en("EVENT_REPORT_BACKUP_DOMAIN",r.report.hostname[1]||r.report.hostname[0])):(en("EVENT_REPORT_DOMAIN",s[0]),en("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]));let c=6443;r.report&&r.report.port&&(e(r.report.port,"report.port"),c=r.report.port),en("STATS_COLLECTOR_PORT",c),r.report?en("ENABLE_EVENT_REPORT",!0):en("ENABLE_EVENT_REPORT",!1);let d="";r.log&&r.log.hostname&&Array.isArray(r.log.hostname)&&r.log.hostname.length?(ls(r.log.hostname,"log.hostname"),d=r.log.hostname[0]):d=s[0];let u=6444;r.log&&r.log.port&&(e(r.log.port,"log.port"),u=r.log.port),en("LOG_UPLOAD_SERVER","".concat(d,":").concat(u));let p=[];r.cds&&r.cds.hostname&&Array.isArray(r.cds.hostname)&&r.cds.hostname.length?(ls(r.cds.hostname,"cds.hostname"),p=r.cds.hostname):p=s;let m=443;r.cds&&r.cds.port&&(e(r.cds.port,"cds.port"),m=r.cds.port),en("CDS_AP",p.map(g=>"".concat(g,":").concat(m))),r.cds?en("ENABLE_CONFIG_DISTRIBUTE",!0):en("ENABLE_CONFIG_DISTRIBUTE",!1),V.info("set local access point v2 success")}setLocalAccessPoints(r,e){if(ls(r,"serverList"),Eo(e,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new fe(z.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let t=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;r=r.map(n=>t.test(n)?"".concat(n.replace(/\./g,"-"),".").concat(e):n),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,en("WEBCS_DOMAIN",r),en("WEBCS_DOMAIN_BACKUP_LIST",r),en("GATEWAY_DOMAINS",[e]),en("EVENT_REPORT_DOMAIN",r[0]),en("EVENT_REPORT_BACKUP_DOMAIN",r[1]||r[0]),en("LOG_UPLOAD_SERVER","".concat(r[0],":6444")),V.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(r){if(gr(r,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=r,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(r),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw V.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else V.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(r))}async setRemoteVideoStreamType(r,e){gr(e,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(r,e),setTimeout(()=>{let t=this._users.find(n=>n.uid===r);t&&t.videoTrack&&t.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(t){throw V.error("[".concat(this._clientId,"] set remote video stream type error"),t.toString()),t}V.info("[".concat(this._clientId,"] set remote ").concat(r," video stream type to ").concat(e)),this._remoteStreamTypeCacheMap.set(r,e)}async setStreamFallbackOption(r,e){gr(e,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(r,e)}catch(t){throw V.error("[".concat(this._clientId,"] set stream fallback option"),t.toString()),t}V.info("[".concat(this._clientId,"] set remote ").concat(r," stream fallback type to ").concat(e)),this._streamFallbackTypeCacheMap.set(r,e)}setEncryptionConfig(r,e,t,n){(function(s){gr(s,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(r),Eo(e,"secret");let i=["aes-128-gcm2","aes-256-gcm2"];if(Re(i).call(i,r)){if(!t||!(t instanceof Uint8Array&&t.length===32))throw new fe(z.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(t)throw new fe(z.INVALID_PARAMS,"current encrypt mode does not need salt");if(n){if(Ge(n,"encryptDataStream"),!Re(i).call(i,r))throw new fe(z.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(e)||V.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=r,this._encryptionSecret=e,t&&(this._encryptionSalt=bd(t))}async renewToken(r){if(Eo(r,"token",1,2047),!this._key||!this._joinInfo)throw new fe(z.INVALID_OPERATION,"renewToken should not be called before user join");let e=this._key;this._key=r,this._joinInfo&&(this._joinInfo.token=r);let t=await this._renewTokenMutex.lock();try{if(te("USE_NEW_TOKEN")){V.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let n=await $z(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||zr);V.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:r,ticket:n})}else V.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:r});V.debug("[".concat(this._clientId,"] renewToken success"))}catch(n){throw this._key=e,this._joinInfo.token=e,V.error("[".concat(this._clientId,"] renewToken failed"),n.toString()),n}finally{t()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?V.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{let r=this._p2pChannel.getAudioLevels();this.safeEmit(jn.VOLUME_INDICATOR,r)},te("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let r=this._statsCollector.getRTCStats(),e=this._gateway.getInChannelInfo();return r.Duration=Math.round(e.duration/1e3),r}async startLiveStreaming(r,e){if(!e){if(this.codec!=="h264")throw new fe(z.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new fe(z.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(r)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(r))throw new fe(z.LIVE_STREAMING_TASK_CONFLICT);let t=e?Ch.TRANSCODE:Ch.RAW;return this._createLiveStreamingClient(t).startLiveStreamingTask(r,t)}setLiveTranscoding(r){return this._createLiveStreamingClient(Ch.TRANSCODE).setTranscodingConfig(r)}async stopLiveStreaming(r){let e=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(t=>t&&t.hasUrl(r));if(!e.length)throw new fe(z.INVALID_PARAMS,"can not find live streaming url to stop");await De.all(e.map(t=>t&&t.stopLiveStreamingTask(r)))}async startChannelMediaRelay(r){CF(r),await this._createChannelMediaRelayClient().startChannelMediaRelay(r)}async updateChannelMediaRelay(r){CF(r),await this._createChannelMediaRelayClient().updateChannelMediaRelay(r)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(r){this._p2pChannel instanceof eS&&this._p2pChannel.addAudioMetadata(r)}async sendStreamMessage(r){var e;let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new fe(z.INVALID_OPERATION,"can not send data stream, not joined");if((typeof r=="string"||r instanceof Uint8Array)&&(r={payload:r}),typeof r.payload=="string"){let i=new TextEncoder;r.payload=i.encode(r.payload)}let n=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Re(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)&&(n=!0,r.payload=await(async function(i,s,o){var c;let d=Ks(c=Array.from(o)).call(c,(I,A)=>I+A,0),u={serverTs:0,seq:yC++,length:o.length,checkSum:d},p=new Uint8Array(ND(d,2)),m=new ArrayBuffer(vv),g=new DataView(m);g.setUint32(0,u.serverTs),g.setUint16(4,u.seq),g.setUint16(6,u.length),g.setUint16(8,u.checkSum);let T=16-o.length%16;o=WU(o,new Uint8Array(T));let R=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i,tagLength:vC,additionalData:p},s,o);return WU(new Uint8Array(m),new Uint8Array(R))})(this._encryptDataStreamIv,this._encryptDataStreamKey,r.payload)),new Blob([r.payload]).size>1024)throw new fe(z.INVALID_PARAMS,n?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(st.DATA_STREAM,{payload:bd(r.payload),syncWithAudio:r.syncWithAudio,sendTs:Date.now()-z4},!t)}sendMetadata(r){if(!this._joinInfo)throw new fe(z.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([r]).size>1024)throw new fe(z.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(st.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:bd(r)})}async sendCustomReportMessage(r){if(Array.isArray(r)||(r=[r]),r.forEach(u4),!this._joinInfo)throw new fe(z.INVALID_OPERATION,"can not send custom report, not joined");await Ye.sendCustomReportMessage(this._joinInfo.sid,r)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){let r=this._statsCollector.getRemoteNetworkQualityStats();if(te("DELETE_NEQ_AFTER_USER_LEAVE")){let e=this._users.map(t=>t.uid+"");Object.keys(r).forEach(t=>{Re(e).call(e,t)||delete r[t]})}return r}async pickSVCLayer(r,e){gr(e.spatialLayer,"spatialLayer",[0,1,2,3]),gr(e.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(r,e)}catch(t){throw V.error("[".concat(this._clientId,"] pick SVC layer failed"),t.toString()),t}}async setRTMConfig(r){let{apRTM:e=!1,rtmFlag:t}=r;if(Ge(e,"apRTM"),Tn(t,"rtmFlag",0),this._rtmConfig.apRTM=e,this._rtmConfig.rtmFlag=t,V.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(r)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=e,this._joinInfo.rtmFlag=t,this._gateway.setRTM2Flag(t)}_reset(){if(V.debug("[".concat(this._clientId,"] reset client")),(function(r){let e=yh.indexOf(r);e!==-1&&yh.splice(e,1)})(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Er.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&NP(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&Ye.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(r=>{r._audioTrack&&r._audioTrack._destroy(),r._videoTrack&&r._videoTrack._destroy(),r._dataChannels&&(r._dataChannels.forEach(e=>e._close()),r._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new ha("client-publish",this._clientId),this._subscribeMutex=new ha("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(r,e){var t;let n=r||Oi();r?V.debug("[".concat(this._clientId,"] new Session ").concat(n)):V.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(n));let i=r?"":this._sessionId||"";this._sessionId=n,this.store.sessionId=n,Ye.addSid(n);let s={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:e?.stringUid||((t=this._joinInfo)===null||t===void 0?void 0:t.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:this.role==="audience"?2:1};Ye.sessionInit(this._sessionId,Ou({cname:e.channel,appid:e.appId},s)),this._joinInfo&&(this._joinInfo.sid=n),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=n)}async _publishHighStream(r){if(!this._joinInfo||this._uid===void 0)throw new fe(z.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new fe(z.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&te("FORCE_TURN")&&!te("TURN_ENABLE_TCP")&&!te("TURN_ENABLE_UDP"))throw new fe(z.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");V.debug("[".concat(this._clientId,"] publish high stream"));try{let t=await this._p2pChannel.publish(r,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){let n=(await t.next()).value;if(n){try{await this._gateway.sendExtensionMessage(Lr.PUBLISH,n,!0)}catch(i){throw t.throw(i),i}await t.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let n=(await t.next()).value;if(n){var e;let i;try{i=await this._gateway.publish(this._uid,n,!0)}catch(s){if(s.code!==z.DISCONNECT_P2P)throw t.throw(s),s}await t.next(((e=i)===null||e===void 0?void 0:e.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(let i of r)i instanceof Ei&&i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig).catch(s=>{V.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!i.muted&&i.enabled||await this._p2pChannel.muteLocalTrack(i)}}catch(t){if(this._p2pChannel.reportPublishEvent(!1,t?.code,r),t?.code===z.WS_ABORT)return;throw t}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new fe(z.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new fe(z.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));V.debug("[".concat(this._clientId,"] publish low stream"));let r=this._configDistribute.getLowStreamConfigDistribute();r&&r.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&r.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=r.bitrate));try{let t=await this._p2pChannel.publishLowStream(this._lowStreamParameter),n=(await t.next()).value;if(n){var e;let i;try{i=await this._gateway.publish(this._uid,n,!0)}catch(s){if(s.code!==z.DISCONNECT_P2P)throw t.throw(s),s}t.next(((e=i)===null||e===void 0?void 0:e.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(t){if(this._p2pChannel.reportPublishEvent(!1,t?.code,void 0,!0),t?.code===z.WS_ABORT)return;throw t}}_createLiveStreamingClient(r){let e=()=>{if(!this._joinInfo||!this._appId)return new fe(z.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let t=(n={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Tl("LiveStreaming").create(n));var n;return t.onLiveStreamError=(i,s)=>{Ye.reportApiInvoke(this._sessionId,{name:Zr.ON_LIVE_STREAM_ERROR,options:[i,s],tag:Cn.TRACER}).onSuccess(),this.safeEmit(jn.LIVE_STREAMING_ERROR,i,s)},t.onLiveStreamWarning=(i,s)=>{Ye.reportApiInvoke(this._sessionId,{name:Zr.ON_LIVE_STREAM_WARNING,options:[i,s],tag:Cn.TRACER}).onSuccess(),this.safeEmit(jn.LIVE_STREAMING_WARNING,i,s)},t.on(S_.REQUEST_WORKER_MANAGER_LIST,(i,s,o)=>{if(!this._joinInfo)return o(new fe(z.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(c,d,u,p){let m=te("UAP_AP").slice(0,te("AJAX_REQUEST_CONCURRENT")).map(g=>d.proxyServer?"https://".concat(d.proxyServer,"/ap/?url=").concat(g+"/api/v1?action=uap"):"https://".concat(g,"/api/v1?action=uap"));return await hF(m,c,d,u,p)})(i,this._joinInfo,this._axiosCancelSource.token,zr).then(s).catch(o)}),t};return r===Ch.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||e(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||e(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new fe(z.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:e,sendResolutionHeight:t}=this.getLocalVideoStats(),n=(r={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:e,height:t}},Tl("ChannelMediaRelay").create(r));n.on("state",i=>{i===ko.RELAY_STATE_FAILURE&&n&&n.dispose(),this.safeEmit(jn.CHANNEL_MEDIA_RELAY_STATE,i)}),n.on("event",i=>{this.safeEmit(jn.CHANNEL_MEDIA_RELAY_EVENT,i)}),this._channelMediaRelayClient=n,this._statsCollector.onStatsChanged=(i,s)=>{var o;i==="resolution"&&((o=this._channelMediaRelayClient)===null||o===void 0||o.setVideoProfile(s))}}var r;return this._channelMediaRelayClient}_handleUpdateDataChannel(r,e){let{added:t,deleted:n}=r,i=[];if(e){let s=[];this._users.forEach(o=>{o._dataChannels.forEach(c=>{t.every(d=>d.uid!==o._uintid||d.stream_id!==c.id)&&s.push({uid:o._uintid,stream_id:c.id,ordered:c.ordered,max_retrans_times:c.maxRetransmits,metadata:c.metadata})})}),s.length>0&&this._handleUpdateDataChannel({added:[],deleted:s})}Array.isArray(t)&&t.length>0&&t.forEach(s=>{let{uid:o,stream_id:c,ordered:d,max_retrans_times:u,metadata:p}=s,m=this._users.find(g=>g._uintid===o);if(!m)return void V.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(V.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(o)),Re(i).call(i,m)||i.push(m),m._uintid||(m._uintid=o),m._dataChannels.findIndex(g=>g.id===s.stream_id)===-1){let g={id:c,ordered:!!d,maxRetransmits:u,metadata:p},T=(function(R){return b_(R,!0)})(g);m._dataChannels.push(T),V.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published datachannel")),e||this.safeEmit(jn.USER_PUBLISHED,m,"datachannel",g)}this._p2pChannel.hasPendingRemoteDataChannel(m,s.stream_id)&&(V.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(m.uid," after reconnect.")),this._subscribeDataChannel(m,s.stream_id).catch(g=>{V.error("[".concat(this._clientId,"] resubscribe datachannel error"),g.toString())}))}),e&&(this.safeEmit(jn.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(n)&&n.length>0&&n.forEach(s=>{let{uid:o,stream_id:c}=s,d=this._users.find(p=>p._uintid===o);if(!d)return void V.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let u=d._dataChannels.find(p=>p.id===s.stream_id);u&&(V.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(o)),this._p2pChannel.unsubscribeDataChannel(d,[u]).then(p=>{if(d._dataChannels=d._dataChannels.filter(m=>m!==u),p)return this._gateway.unsubscribeDataChannel(p,d.uid)}),V.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished datachannel ,id:").concat(u.id)),this.safeEmit(jn.USER_UNPUBLISHED,d,"datachannel",u._config))})}_getEncodingName(r){var e;if(!this._joinResponse)return;let t=(e=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||e===void 0?void 0:e.videoCodecs;if(t)for(let i of t){var n;if(i.payloadType===r)return i==null||(n=i.rtpMap)===null||n===void 0?void 0:n.encodingName}}_handleRemoveDataChannels(r){let e=this._users.find(t=>t.uid===r.uid);if(e){if(e._dataChannels!==void 0&&e._dataChannels.length>0){V.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(r.uid));let t=()=>{V.info("[".concat(this._clientId,"] remote user ").concat(e.uid," unpublished datachannel")),e._dataChannels.forEach(n=>{this.safeEmit(jn.USER_UNPUBLISHED,e,"datachannel",n._config)})};this._p2pChannel.unsubscribeDataChannel(e,e._dataChannels).then(n=>{if(n)return this._gateway.unsubscribeDataChannel(n,e.uid)}),t()}}else V.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(gn.UPDATE_GATEWAY_CONFIG,()=>{(function(){let r;try{r=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void V.error("Error loading sdk config",e.message)}if(r)try{let e=JSON.parse(window.atob(r)),t=Date.now();Object.keys(e).forEach(n=>{let{value:i,type:s,expires:o}=e[n];o&&o<=t||s||Gm()||!Object.prototype.hasOwnProperty.call(go,n)||(Eh[n]=i,or[n]=i,V.debug("Update gateway parameters from config distribute",n,i))})}catch(e){V.error("Error update config from local cache",e.message)}})()}),this._gateway.on(gn.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(gn.CONNECTION_STATE_CHANGE,(r,e,t)=>{var n;if(t===Di.FALLBACK)return;let i=()=>{this.safeEmit(jn.CONNECTION_STATE_CHANGE,r,e,t)};if(Ye.reportApiInvoke(this._sessionId||((n=this._gateway.joinInfo)===null||n===void 0?void 0:n.sid)||null,{name:Zr.CONNECTION_STATE_CHANGE,options:[r,e,t],tag:Cn.TRACER}).onSuccess(JSON.stringify({cur:r,prev:e,reason:t})),V.info("[".concat(this._clientId,"] signal connection state change: ").concat(e," -> ").concat(r)),r==="DISCONNECTED")return this._reset(),void i();if(r==="RECONNECTING")this._users.forEach(o=>{o._trust_in_room_=!1,o._trust_audio_enabled_state_=!1,o._trust_video_enabled_state_=!1,o._trust_audio_mute_state_=!1,o._trust_video_mute_state_=!1,o._trust_audio_stream_added_state_=!1,o._trust_video_stream_added_state_=!1,o._is_pre_created||(o._audio_pre_subscribed||(o._audioSSRC=void 0,o._audioOrtc=void 0),o._video_pre_subscribed||(o._videoSSRC=void 0,o._videoOrtc=void 0,o._rtxSsrcId=void 0),o._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(r==="CONNECTED"){var s;this._streamFallbackTypeCacheMap.forEach((o,c)=>{this._gateway.setStreamFallbackOption(c,o).catch(d=>{V.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),d)})}),this._remoteStreamTypeCacheMap.forEach((o,c)=>{this._gateway.setRemoteVideoStreamType(c,o).catch(d=>{V.warning("[".concat(this._clientId,"] auto set remote stream type failed"),d)})}),this._remoteDefaultVideoStreamType!==void 0&&((s=this._joinInfo)===null||s===void 0?void 0:s.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{V.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(o=>{V.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(o))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(o=>!o._trust_in_room_).forEach(o=>{V.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(o.uid)),this._handleUserOffline({uid:o.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(o=>{o._trust_audio_mute_state_||(V.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(o.uid)),this._handleMuteStream(o.uid,vt.AUDIO,!1)),o._trust_video_mute_state_||(V.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(o.uid)),this._handleMuteStream(o.uid,vt.VIDEO,!1)),o._trust_audio_enabled_state_||(V.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(o.uid)),this._handleSetStreamLocalEnable("audio",o.uid,!0)),o._trust_video_enabled_state_||(V.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(o.uid)),this._handleSetStreamLocalEnable("video",o.uid,!0)),o._trust_video_stream_added_state_||(V.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(o.uid)),this._handleResetAddStream(o,"video")),o._trust_audio_stream_added_state_||(V.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(o.uid)),this._handleResetAddStream(o,"audio")),o._video_added_||o._audio_added_||(V.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(o.uid)),this._handleRemoveStream({uid:o.uid,uint_id:o._uintid}))}))},1e3))}i()}),this._gateway.on(gn.REQUEST_NEW_GATEWAY_LIST,async(r,e)=>{if(!this._joinInfo)return e(new fe(z.UNEXPECTED_ERROR,"can not recover, no join info"));try{let t,n=await xF(Ou(Ou({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));n?(t=n.ap,FF(n),this._joinInfo.preload=!0):(t=await SF(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||zr,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=t.gatewayInfo.res,this._joinInfo.gatewayAddrs=t.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=t.gatewayInfo.uni_lbs_ip);let i=[];t.gatewayInfo.gatewayAddrs.forEach(s=>{let{address:o}=s,[c,d]=o.split(":");this._joinInfo&&this._joinInfo.proxyServer?i.push({proxy:this._joinInfo.proxyServer,host:c,port:d}):i.push({host:c,port:d})}),r(i)}catch(t){e(t)}}),this._gateway.on(gn.NETWORK_QUALITY,r=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(jn.NETWORK_QUALITY,r)}),this._gateway.on(gn.STREAM_TYPE_CHANGE,(r,e)=>{this.safeEmit(jn.STREAM_TYPE_CHANGED,r,e),Ye.reportApiInvoke(this._sessionId,{name:Zr.STREAM_TYPE_CHANGE,options:[r,e],tag:Cn.TRACER}).onSuccess(JSON.stringify({uid:r,streamType:e}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(gn.IS_P2P_DISCONNECTED,r=>{this._p2pChannel.isP2PDisconnected()?r(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?r(!1):r(!0)}),this._gateway.on(gn.REQUEST_P2P_CONNECTION_PARAMS,async(r,e,t)=>{try{let n=await this._p2pChannel.getEstablishParams();n&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(n=await this._p2pChannel.startP2PConnection(r)),e(n)}catch(n){t(n)}}),this._gateway.on(gn.JOIN_RESPONSE,(r,e)=>{if(this.store.useP2P)return;let t;this._joinResponse=r,r.attributes?t=r.attributes.userAttributes.preSubSsrcs:V.debug("no attributes in joinResponse");let n=nF(r.ortc,e,t);this._p2pChannel.connect(n)}),this._gateway.on(gn.PRE_CONNECT_PC,async r=>{let{candidates:e,fingerprint:t,turnServer:n}=r;if(this._joinInfo&&e.length>0&&!this._p2pChannel.isPlanB){let{cert:s,cid:o}=this._joinInfo.apResponse,c="".concat(o,"_").concat(s);if(c.length<4||c.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:n,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var i;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(o,"_").concat(s),icePwd:"".concat(o,"_").concat(s)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(i=te("FINGERPRINT"))!==null&&i!==void 0?i:t}]},candidates:e,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(d){d.code&&d.code===z.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:n,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Ln.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Ln.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Ln.ON_ADD_AUDIO_STREAM,r=>this._handleAddAudioOrVideoStream("audio",r.uid,r.ssrcId,r.cname,r.pt,r.uint_id,r.ortc)),this._gateway.signal.on(Ln.ON_ADD_VIDEO_STREAM,r=>this._handleAddAudioOrVideoStream("video",r.uid,r.ssrcId,r.cname,r.pt,r.uint_id,r.ortc,r.rtxSsrcId)),this._gateway.signal.on(Ln.ON_REMOTE_DATASTREAM_UPDATE,r=>{this._handleUpdateDataChannel(r)}),this._gateway.signal.on(Ln.ON_REMOTE_FULL_DATASTREAM_INFO,r=>{this._handleUpdateDataChannel({added:r.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Ln.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Ln.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Ln.MUTE_AUDIO,r=>this._handleMuteStream(r.uid,vt.AUDIO,!0)),this._gateway.signal.on(Ln.UNMUTE_AUDIO,r=>this._handleMuteStream(r.uid,vt.AUDIO,!1)),this._gateway.signal.on(Ln.MUTE_VIDEO,r=>this._handleMuteStream(r.uid,vt.VIDEO,!0)),this._gateway.signal.on(Ln.UNMUTE_VIDEO,r=>this._handleMuteStream(r.uid,vt.VIDEO,!1)),this._gateway.signal.on(Ln.RECEIVE_METADATA,r=>{let e=Cd(r.metadata);this.safeEmit(jn.RECEIVE_METADATA,r.uid,e)}),this._gateway.signal.on(Ln.ON_DATA_STREAM,async r=>{var e;if(!r)return;let t=Cd(r.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Re(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)){if(r.payload.length<vv)throw new fe(z.UNEXPECTED_RESPONSE,"payload length ".concat(r.payload.length," is less than header length ").concat(vv));t=await(async function(i,s,o){let c=o.subarray(0,vv),d=c.slice(8,vv),u=(d[0]<<8)+d[1],p=(c[6]<<8)+c[7],m=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:i,tagLength:vC,additionalData:new Uint8Array(ND(u,2))},s,o.subarray(vv));return new Uint8Array(m).subarray(0,p)})(this._encryptDataStreamIv,this._encryptDataStreamKey,t)}let n=0;if(r.ordered||r.syncWithAudio){let i=this._p2pChannel.getStats(),s=this.remoteUsers.find(c=>c.uid===r.uid);n=i?.audioRecv.find(c=>c.ssrc===s?._audioSSRC)?.jitterBufferMs}(n==null||Number.isNaN(n))&&(n=0),Y4(Ou(Ou({},r),{},{payload:t}),n,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Ln.ON_CRYPT_ERROR,()=>{Lm(()=>{V.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(jn.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Ln.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Ln.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{V.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,Di.TOKEN_EXPIRE),this.safeEmit(jn.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Ln.ON_STREAM_FALLBACK_UPDATE,r=>{V.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(r.stream_id,", attr: ").concat(r.stream_type)),this.safeEmit(jn.STREAM_FALLBACK,r.stream_id,r.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Ln.ON_PUBLISH_STREAM,r=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:r.proxy})),V.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(r))))}),this._gateway.signal.on(Ln.ENABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!0)}),this._gateway.signal.on(Ln.DISABLE_LOCAL_VIDEO,r=>{this._handleSetStreamLocalEnable("video",r.uid,!1)}),this._gateway.signal.on(Pt.REQUEST_TIMEOUT,(r,e)=>{if(this._joinInfo)switch(r){case st.PUBLISH:{if(!e)return;let i=e.ortc;if(i){var t,n;let s=i.some(d=>{let{stream_type:u}=d;return u===vi.Audio}),o=i.some(d=>{let{stream_type:u}=d;return u!==vi.Audio}),c=i.some(d=>{let{stream_type:u}=d;return u===vi.Screen||u===vi.ScreenLow});e.state==="offer"&&Ye.publish(this._joinInfo.sid,{eventElapse:ta.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:z.TIMEOUT,audio:s,video:o,p2pid:e.p2p_id,publishRequestid:this.store.pubId,screenshare:c,audioName:s?(t=i.find(d=>{let{stream_type:u}=d;return u===vi.Audio}))===null||t===void 0||(t=t.ssrcs[0])===null||t===void 0?void 0:t.ssrcId.toString():void 0,videoName:o?(n=i.find(d=>{let{stream_type:u}=d;return u!==vi.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0})}break}case st.SUBSCRIBE:e&&Ye.subscribe(this._joinInfo.sid,{succ:!1,ec:z.TIMEOUT,audio:e.stream_type===vt.AUDIO,video:e.stream_type===vt.VIDEO,peerid:e.stream_id,subscribeRequestid:e.ssrcId,p2pid:this.store.p2pId,eventElapse:ta.measureFromSubscribeStart(this.store.clientId,e.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(e.ssrcId)})}}),this._gateway.signal.on(Ln.ON_P2P_OK,r=>{this.uid,this._uid}),this._gateway.signal.on(Ln.ON_PUBLISHED_USER_LIST,r=>{if(r==null||!r.users)return;te("BLOCK_LOCAL_CLIENT")&&(r.users=r.users.filter(n=>!Rh(n.string_id||n.stream_id,this.channelName)));let e=[],t=[];for(let n of r.users){let i=this._users.find(p=>p._uintid===n.stream_id);i?i._trust_in_room_=!0:(i=new Xm(n.string_id||n.stream_id,n.stream_id),this._users.push(i),this.store.firstVideoFrameDecoded(i.uid,{userJoinNotify:Date.now()}),this.getListeners(jn.PUBLISHED_USER_LIST).length===0&&(V.debug("[".concat(this._clientId,"] user online"),n.stream_id),this.safeEmit(jn.USER_JOINED,i)));let s=Ws.Audio&n.stream_type,o=(Ws.Video|Ws.LwoVideo)&n.stream_type,c=(65280&n.stream_type)!=0,d=s&&i.hasAudio,u=o&&i.hasVideo;o&&(i._trust_video_stream_added_state_=!0,i._video_added_=!0,i._videoSSRC=n.video_ssrc,i._rtxSsrcId=n.video_rtx),s&&(i._trust_audio_stream_added_state_=!0,i._audio_added_=!0,i._audioSSRC=n.audio_ssrc),s&&!d&&this.getListeners(jn.PUBLISHED_USER_LIST).length===0&&(V.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published audio")),this.safeEmit(jn.USER_PUBLISHED,i,"audio")),o&&!u&&this.getListeners(jn.PUBLISHED_USER_LIST).length===0&&(V.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published video")),this.safeEmit(jn.USER_PUBLISHED,i,"video")),(s&&!d||o&&!u||c)&&e.push(i),o&&this._p2pChannel.hasPendingRemoteMedia(i,"video")&&t.push({user:i,mediaType:"video"}),s&&this._p2pChannel.hasPendingRemoteMedia(i,"audio")&&t.push({user:i,mediaType:"audio"})}t.length>0&&(V.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(t.map(n=>"user: ".concat(n.user.uid,", mediaType: ").concat(n.mediaType)).join("; ")," ")),this.massSubscribe(t).catch(n=>{V.error("[".concat(this._clientId,"] mass resubscribe error"),n.toString())})),this.getListeners(jn.PUBLISHED_USER_LIST).length>0?te("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=e:(V.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(e.map(n=>n.uid).join(", "))),this.safeEmit(jn.PUBLISHED_USER_LIST,e)):V.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(e.map(n=>n.uid).join(", ")))}),this._gateway.signal.on(Ln.ON_RTP_CAPABILITY_CHANGE,r=>{let{video_codec:e}=r;this._p2pChannel instanceof eS&&this._p2pChannel.updateRemoteRTPCapabilities(e.map(t=>t.toLowerCase()).filter(t=>{var n;return Re(n=Object.keys(tn)).call(n,t)}))})}_handleP2PEvents(){this._gateway.signal.on(Ln.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(Lr.PUBLISH,(r,e,t)=>{let{uid:n}=r;r.forEach(i=>{let{kind:s,ssrcs:o,mid:c,isMuted:d}=i;this._handleP2PAddAudioOrVideoStream(s,n,o[0].ssrcId,c);let u=this._users.find(p=>p.uid===n);return u&&this.store.useP2P?this._p2pChannel.mockSubscribe(u,s,o[0].ssrcId,c).then(()=>{e()}).catch(t):e(),this._handleMuteStream(n,s,!!d)})}),this._gateway.signal.on(Lr.CALL,async(r,e,t)=>{if(this.store.useP2P)try{var n;e(await this._p2pChannel.startP2P({turnServer:(n=this._joinInfo)===null||n===void 0?void 0:n.turnServer},r))}catch(i){t(i)}}),this._gateway.signal.on(Pt.P2P_CONNECTION,async r=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(r)}),this._gateway.signal.on(Lr.UNPUBLISH,async(r,e,t)=>{if(this.store.useP2P){let{unpubMsg:n,uid:i}=r,s=this._users.find(o=>o.uid===i);if(!s)return V.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void e();try{n.forEach(async o=>{let{stream_type:c}=o,d=c===vi.Audio?vt.AUDIO:vt.VIDEO;await this._p2pChannel.unsubscribe(s,d),this._handleMuteStream(i,d,!0)}),e()}catch(o){t(o)}}}),this._gateway.signal.on(Lr.CONTROL,async(r,e)=>{let{action:t}=r;switch(t){case Ru.MUTE_LOCAL_VIDEO:this._handleMuteStream(e,vt.VIDEO,!0);break;case Ru.MUTE_LOCAL_AUDIO:this._handleMuteStream(e,vt.AUDIO,!0);break;case Ru.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",e),this._handleMuteStream(e,vt.VIDEO,!1);break;case Ru.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",e),this._handleMuteStream(e,vt.AUDIO,!1)}}),this._gateway.signal.on(Lr.RESTART_ICE,async(r,e,t)=>{if(this.store.useP2P)try{let{direction:n,iceParameter:i}=r;n!==an.SEND_ONLY||i?e(await this._p2pChannel.restartICE(n,i)):(this._p2pChannel.handleDisconnect(n),e())}catch(n){t(n)}}),this._gateway.signal.on(Lr.CANDIDATE,r=>{if(this.store.useP2P){let{candidate:e,direction:t}=r;this._p2pChannel.addRemoteCandidate(e,t)}}),this._p2pChannel.on(ut.RequestP2PRestartICE,async(r,e,t)=>{try{let{direction:n}=r;e(await this._gateway.sendExtensionMessage(Lr.RESTART_ICE,r,n===an.SEND_ONLY))}catch(n){t(n)}}),this._p2pChannel.on(ut.LocalCandidate,r=>{this._gateway.sendExtensionMessage(Lr.CANDIDATE,JSON.stringify(r),!0)}),this._p2pChannel.on(ut.RequestP2PMuteLocal,async(r,e,t)=>{try{await this._gateway.sendExtensionMessage(Lr.CONTROL,r,!0),e()}catch(n){t(n)}}),this._p2pChannel.on(ut.RequestP2PUnmuteRemote,async(r,e,t)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(r,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(n){n.code===z.DISCONNECT_P2P?e():t(n)}else e()}),this._p2pChannel.on(ut.RequestP2PMuteRemote,async(r,e,t)=>{if(this._joinInfo)try{await this._gateway.muteRemote(r,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(n){n.code===z.DISCONNECT_P2P?e():t(n)}else e()}),this._p2pChannel.on(ut.StateChange,(r,e)=>{e===He.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(ut.PeerConnectionStateChange,r=>{let e=this._peerConnectionState;r!==e&&(this.safeEmit(jn.PEERCONNECTION_STATE_CHANGE,r,e),this._peerConnectionState=r)}),this._p2pChannel.on(ut.RequestMuteLocal,async(r,e,t)=>{if(this._joinInfo)try{await this._gateway.muteLocal(r,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(n){n.code===z.DISCONNECT_P2P?e():t(n)}else e()}),this._p2pChannel.on(ut.RequestUnmuteLocal,async(r,e,t)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(r,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(n){n.code===z.DISCONNECT_P2P?e():t(n)}else e()}),this._p2pChannel.on(ut.RequestRePublish,(r,e,t)=>{this.publish(r,!1).then(e).catch(t)}),this._p2pChannel.on(ut.RequestRePublishDataChannel,(r,e,t)=>{De.all(r.map(async n=>{let i=await this._p2pChannel.publishDataChannel([n]);try{i.forEach(s=>{this._uid&&this._gateway.publishDataChannel(this._uid,s,!0)})}catch(s){if(s.code!==z.DISCONNECT_P2P)throw s}})).then(e).catch(t)}),this._p2pChannel.on(ut.RequestReSubscribe,async(r,e,t)=>{try{for(let{user:n,kind:i}of r)i===vt.VIDEO?await this.subscribe(n,"video"):await this.subscribe(n,"audio");e()}catch(n){t(n)}}),this._p2pChannel.on(ut.RequestUpload,(r,e)=>{this._gateway.upload(r,e)}),this._p2pChannel.on(ut.RequestUploadStats,r=>{this._gateway.uploadWRTCStats(r)}),this._p2pChannel.on(ut.MediaReconnectStart,r=>{this.safeEmit(jn.MEDIA_RECONNECT_START,r)}),this._p2pChannel.on(ut.MediaReconnectEnd,r=>{this.safeEmit(jn.MEDIA_RECONNECT_END,r)}),this._p2pChannel.on(ut.NeedSignalRTT,r=>{r(this._gateway.getSignalRTT())}),this._p2pChannel.on(ut.RequestRestartICE,async r=>{if(this.store.useP2P)return;let e=await this._p2pChannel.restartICE(r),t=await e.next();if(t.done)return;let n=t.value,i;try{i=await this._gateway.restartICE({iceParameters:n})}catch(o){return void e.throw(o)}let{iceParameters:s}=(function(o){let c=o.iceParameters;return{iceParameters:{iceUfrag:c.iceUfrag,icePwd:c.icePwd}}})(i);await e.next({remoteIceParameters:s})}),this._p2pChannel.on(ut.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(ut.RequestReconnectPC,async()=>{var r;let{iceParameters:e,dtlsParameters:t,rtpCapabilities:n}=await this._p2pChannel.startP2PConnection({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer}),{gatewayEstablishParams:i,gatewayAddress:s}=await this._gateway.reconnectPC({iceParameters:e,dtlsParameters:t,rtpCapabilities:n}),o=nF(i,s);await this._p2pChannel.connect(o),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(ut.RequestUnpublishForReconnectPC,async(r,e,t)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(r,this._uid),e()):t()}),this._p2pChannel.on(ut.P2PLost,()=>{this.safeEmit(jn.P2P_LOST,this.store.uid)}),this._p2pChannel.on(ut.UpdateVideoEncoder,r=>{r._encoderConfig&&this._gateway.setVideoProfile(r._encoderConfig)}),this._p2pChannel.on(ut.ConnectionTypeChange,r=>{this.safeEmit(jn.IS_USING_CLOUD_PROXY,r)}),this._p2pChannel.on(ut.RequestLowStreamParameter,r=>{r(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(ut.QueryClientConnectionState,r=>{r(this.connectionState)}),this._p2pChannel.on(ut.AudioMetadata,r=>{this.safeEmit(jn.AUDIO_METADATA,r)}),this._p2pChannel.on(ut.AudioPts,r=>{this.safeEmit(jn.AUDIO_PTS,Number(r))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(r){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new fe(z.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new fe(z.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{let t=(e={config:r},Tl("ContentInspect").create(e));this._inspect=t,this.handleVideoInspectEvents(t);let{appId:n,cname:i,sid:s,token:o,uid:c,cid:d,vid:u}=this._joinInfo;await t.init({appId:n,areaCode:"",cname:i,sid:s,token:o,uid:c,cid:d,vid:u?Number(u):0},zr)}catch(t){throw Array.isArray(t)?t[0]:t}var e}handleVideoInspectEvents(r){r.on(kr.CONNECTION_STATE_CHANGE,(e,t)=>{if(this.safeEmit(jn.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,e,t),t===kt.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(jn.CONTENT_INSPECT_ERROR,new fe(z.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));r.inspectImage()}}),r.on(kr.INSPECT_RESULT,(e,t)=>{var n;if(t?.code===z.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return V.debug("Stop inspect content because that has left channel"),this==null||(n=this._inspect)===null||n===void 0||n.close(),void(this._inspect=void 0);this.safeEmit(jn.CONTENT_INSPECT_RESULT,e,t)}),r.on(kr.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(t=>t.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new fe(z.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}async setImageModeration(r,e){if(Ge(r,"enabled"),r){if(!e)throw new fe(z.INVALID_PARAMS,"config is required");if(LP(e),!this._joinInfo)throw new fe(z.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(e);else{let n=(t={config:e},Tl("ImageModeration").create(t));this._moderation=n,this.handleImageModerationEvents(n);let{appId:i,cname:s,sid:o,token:c,uid:d,cid:u,vid:p}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:s,sid:o,token:c,uid:d,cid:u,vid:p?Number(p):0},zr)}}catch(n){throw Array.isArray(n)?n[0]:n}}else{var t;if(!this._moderation)throw new fe(z.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(n){throw Array.isArray(n)?n[0]:n}}}handleImageModerationEvents(r){r.on(ea.CONNECTION_STATE_CHANGE,(e,t)=>{if(this.safeEmit(jn.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,e,t),e===fa.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new fe(z.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");r.inspectImage()}}),r.on(ea.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(t=>t.trackMediaType==="video")[0])})}setP2PTransport(r){if((function(e){gr(e,"transport",["default","auto","relay","sd-rtn"])})(r),this.mode!=="p2p")throw new fe(z.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=r,V.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(r))}getJoinChannelServiceRecords(){return V.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(r){Ge(r,"enabled"),en("ENABLE_PUBLISH_AUDIO_FILTER",r),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(r)}_handleResetAddStream(r,e){switch(e){case"audio":r._audio_added_=!1,r._trust_audio_stream_added_state_=!0;break;case"video":r._video_added_=!1,r._trust_video_stream_added_state_=!0}}},Dt(St.prototype,"leave",[$4],Object.getOwnPropertyDescriptor(St.prototype,"leave"),St.prototype),Dt(St.prototype,"publish",[qF],Object.getOwnPropertyDescriptor(St.prototype,"publish"),St.prototype),Dt(St.prototype,"unpublish",[XF],Object.getOwnPropertyDescriptor(St.prototype,"unpublish"),St.prototype),Dt(St.prototype,"subscribe",[JF],Object.getOwnPropertyDescriptor(St.prototype,"subscribe"),St.prototype),Dt(St.prototype,"presubscribe",[QF],Object.getOwnPropertyDescriptor(St.prototype,"presubscribe"),St.prototype),Dt(St.prototype,"massSubscribe",[ZF],Object.getOwnPropertyDescriptor(St.prototype,"massSubscribe"),St.prototype),Dt(St.prototype,"unsubscribe",[$F],Object.getOwnPropertyDescriptor(St.prototype,"unsubscribe"),St.prototype),Dt(St.prototype,"massUnsubscribe",[eB],Object.getOwnPropertyDescriptor(St.prototype,"massUnsubscribe"),St.prototype),Dt(St.prototype,"setLowStreamParameter",[tB],Object.getOwnPropertyDescriptor(St.prototype,"setLowStreamParameter"),St.prototype),Dt(St.prototype,"enableDualStream",[nB],Object.getOwnPropertyDescriptor(St.prototype,"enableDualStream"),St.prototype),Dt(St.prototype,"disableDualStream",[iB],Object.getOwnPropertyDescriptor(St.prototype,"disableDualStream"),St.prototype),Dt(St.prototype,"setClientRole",[rB],Object.getOwnPropertyDescriptor(St.prototype,"setClientRole"),St.prototype),Dt(St.prototype,"_setClientRoleOptions",[sB],Object.getOwnPropertyDescriptor(St.prototype,"_setClientRoleOptions"),St.prototype),Dt(St.prototype,"setProxyServer",[oB],Object.getOwnPropertyDescriptor(St.prototype,"setProxyServer"),St.prototype),Dt(St.prototype,"setTurnServer",[aB],Object.getOwnPropertyDescriptor(St.prototype,"setTurnServer"),St.prototype),Dt(St.prototype,"setLicense",[cB],Object.getOwnPropertyDescriptor(St.prototype,"setLicense"),St.prototype),Dt(St.prototype,"startProxyServer",[lB],Object.getOwnPropertyDescriptor(St.prototype,"startProxyServer"),St.prototype),Dt(St.prototype,"stopProxyServer",[dB],Object.getOwnPropertyDescriptor(St.prototype,"stopProxyServer"),St.prototype),Dt(St.prototype,"setLocalAccessPointsV2",[uB],Object.getOwnPropertyDescriptor(St.prototype,"setLocalAccessPointsV2"),St.prototype),Dt(St.prototype,"setLocalAccessPoints",[hB],Object.getOwnPropertyDescriptor(St.prototype,"setLocalAccessPoints"),St.prototype),Dt(St.prototype,"setRemoteDefaultVideoStreamType",[pB],Object.getOwnPropertyDescriptor(St.prototype,"setRemoteDefaultVideoStreamType"),St.prototype),Dt(St.prototype,"setRemoteVideoStreamType",[fB],Object.getOwnPropertyDescriptor(St.prototype,"setRemoteVideoStreamType"),St.prototype),Dt(St.prototype,"setStreamFallbackOption",[_B],Object.getOwnPropertyDescriptor(St.prototype,"setStreamFallbackOption"),St.prototype),Dt(St.prototype,"setEncryptionConfig",[mB],Object.getOwnPropertyDescriptor(St.prototype,"setEncryptionConfig"),St.prototype),Dt(St.prototype,"renewToken",[EB],Object.getOwnPropertyDescriptor(St.prototype,"renewToken"),St.prototype),Dt(St.prototype,"enableAudioVolumeIndicator",[gB],Object.getOwnPropertyDescriptor(St.prototype,"enableAudioVolumeIndicator"),St.prototype),Dt(St.prototype,"startLiveStreaming",[SB],Object.getOwnPropertyDescriptor(St.prototype,"startLiveStreaming"),St.prototype),Dt(St.prototype,"setLiveTranscoding",[TB],Object.getOwnPropertyDescriptor(St.prototype,"setLiveTranscoding"),St.prototype),Dt(St.prototype,"stopLiveStreaming",[vB],Object.getOwnPropertyDescriptor(St.prototype,"stopLiveStreaming"),St.prototype),Dt(St.prototype,"startChannelMediaRelay",[yB],Object.getOwnPropertyDescriptor(St.prototype,"startChannelMediaRelay"),St.prototype),Dt(St.prototype,"updateChannelMediaRelay",[RB],Object.getOwnPropertyDescriptor(St.prototype,"updateChannelMediaRelay"),St.prototype),Dt(St.prototype,"stopChannelMediaRelay",[CB],Object.getOwnPropertyDescriptor(St.prototype,"stopChannelMediaRelay"),St.prototype),Dt(St.prototype,"sendCustomReportMessage",[bB],Object.getOwnPropertyDescriptor(St.prototype,"sendCustomReportMessage"),St.prototype),Dt(St.prototype,"pickSVCLayer",[IB],Object.getOwnPropertyDescriptor(St.prototype,"pickSVCLayer"),St.prototype),Dt(St.prototype,"setRTMConfig",[AB],Object.getOwnPropertyDescriptor(St.prototype,"setRTMConfig"),St.prototype),Dt(St.prototype,"enableContentInspect",[wB],Object.getOwnPropertyDescriptor(St.prototype,"enableContentInspect"),St.prototype),Dt(St.prototype,"disableContentInspect",[OB],Object.getOwnPropertyDescriptor(St.prototype,"disableContentInspect"),St.prototype),Dt(St.prototype,"setImageModeration",[NB],Object.getOwnPropertyDescriptor(St.prototype,"setImageModeration"),St.prototype),Dt(St.prototype,"setP2PTransport",[DB],Object.getOwnPropertyDescriptor(St.prototype,"setP2PTransport"),St.prototype),Dt(St.prototype,"getJoinChannelServiceRecords",[PB],Object.getOwnPropertyDescriptor(St.prototype,"getJoinChannelServiceRecords"),St.prototype),Dt(St.prototype,"setPublishAudioFilterEnabled",[kB],Object.getOwnPropertyDescriptor(St.prototype,"setPublishAudioFilterEnabled"),St.prototype),St);class g0{constructor(e,t){Z(this,"id",0),Z(this,"element",void 0),Z(this,"peerPair",void 0),Z(this,"context",void 0),Z(this,"audioPlayerElement",void 0),Z(this,"audioTrack",void 0),g0.count+=1,this.id=g0.count,this.element=e,this.context=t}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{let t=document.createElement("audio");t.srcObject=new MediaStream([e.track]),t.play(),this.audioPlayerElement=t}}async switchSdp(){if(!this.peerPair)return;let e=async(n,i)=>{let s=i==="offer"?await n.createOffer():await n.createAnswer();return await n.setLocalDescription(s),n.iceGatheringState==="complete"?n.localDescription:new De(o=>{n.onicegatheringstatechange=()=>{n.iceGatheringState==="complete"&&o(n.localDescription)}})},t=async(n,i)=>await n.setRemoteDescription(i);try{let n=await e(this.peerPair[0],"offer");await t(this.peerPair[1],n);let i=await e(this.peerPair[1],"answer");await t(this.peerPair[0],i)}catch(n){throw new fe(z.LOCAL_AEC_ERROR,n.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let t;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),t=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(t)}catch(i){throw new fe(z.LOCAL_AEC_ERROR,i.toString()).print()}if(!t)throw new fe(z.LOCAL_AEC_ERROR,"no dest node when local aec").print();let n=t.stream.getAudioTracks()[0];return this.audioTrack=n,n}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let e=this.element,t=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(t),await this.switchSdp()}close(){V.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var ab,S0;Z(g0,"count",0);let MP=window.AudioContext||window.webkitAudioContext,cY=new(ab=Gt({report:Ye}),Dt((S0=class{constructor(){Z(this,"units",[]),Z(this,"context",void 0)}processExternalMediaAEC(r){if(!this._doesEnvironmentNeedAEC())return V.debug("the system does not need to process local aec"),-1;this.context||(this.context=new MP);let e=this.units.find(t=>t&&t.getElement()===r);return e||(e=new g0(r,this.context),this.units.push(e)),e.startEchoCancellation(),V.debug("start processing local audio echo cancellation, id is",e.id),e.id}_doesEnvironmentNeedAEC(){return Qn().name!==sn.SAFARI}}).prototype,"processExternalMediaAEC",[ab],Object.getOwnPropertyDescriptor(S0.prototype,"processExternalMediaAEC"),S0.prototype),S0);function e6(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function LB(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?e6(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):e6(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}let UP=window||document;function xP(r){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!UP)return;let t=Ds._cspEventHandlerPointer;if(t&&e)return void console.error(t,e);let n=i=>{if(!(i&&i.blockedURI&&(Ds.onSecurityPolicyViolation||Ds.getListeners(rf.SECURITY_POLICY_VIOLATION).length>0)))return;let s=i.blockedURI;te("CSP_DETECTED_HOSTNAME_LIST").some(o=>Re(s).call(s,o))&&(Ds.onSecurityPolicyViolation&&typeof Ds.onSecurityPolicyViolation=="function"&&Ds.onSecurityPolicyViolation(i),Ds.getListeners(rf.SECURITY_POLICY_VIOLATION).length>0&&Ds.safeEmit(rf.SECURITY_POLICY_VIOLATION,i))};t&&UP.removeEventListener("securitypolicyviolation",t),(e||r&&typeof r=="function"||Ds.getListeners(rf.SECURITY_POLICY_VIOLATION).length>0)&&UP.addEventListener("securitypolicyviolation",n),Ds._cspEventHandlerPointer=n}var t6=ee,lY=mU,n6=RegExp.prototype,i6=function(r){return r===n6||t6(n6,r)?lY(r):r.flags},dc=S(i6);function Mo(r){let e=r.length;for(;--e>=0;)r[e]=0}let nS=256,VP=286,cb=30,nE=15,Mv=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),lb=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),FP=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),r6=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),D_=new Array(576);Mo(D_);let Nu=new Array(60);Mo(Nu);let iE=new Array(512);Mo(iE);let rE=new Array(256);Mo(rE);let Uv=new Array(29);Mo(Uv);let db=new Array(cb);function ub(r,e,t,n,i){this.static_tree=r,this.extra_bits=e,this.extra_base=t,this.elems=n,this.max_length=i,this.has_stree=r&&r.length}let BP,MB,UB;function jP(r,e){this.dyn_tree=r,this.max_code=0,this.stat_desc=e}Mo(db);let GP=r=>r<256?iE[r]:iE[256+(r>>>7)],hb=(r,e)=>{r.pending_buf[r.pending++]=255&e,r.pending_buf[r.pending++]=e>>>8&255},Rc=(r,e,t)=>{r.bi_valid>16-t?(r.bi_buf|=e<<r.bi_valid&65535,hb(r,r.bi_buf),r.bi_buf=e>>16-r.bi_valid,r.bi_valid+=t-16):(r.bi_buf|=e<<r.bi_valid&65535,r.bi_valid+=t)},ra=(r,e,t)=>{Rc(r,t[2*e],t[2*e+1])},hf=(r,e)=>{let t=0;do t|=1&r,r>>>=1,t<<=1;while(--e>0);return t>>>1},xB=(r,e,t)=>{let n=new Array(16),i,s,o=0;for(i=1;i<=nE;i++)o=o+t[i-1]<<1,n[i]=o;for(s=0;s<=e;s++){let c=r[2*s+1];c!==0&&(r[2*s]=hf(n[c]++,c))}},VB=r=>{let e;for(e=0;e<VP;e++)r.dyn_ltree[2*e]=0;for(e=0;e<cb;e++)r.dyn_dtree[2*e]=0;for(e=0;e<19;e++)r.bl_tree[2*e]=0;r.dyn_ltree[512]=1,r.opt_len=r.static_len=0,r.sym_next=r.matches=0},FB=r=>{r.bi_valid>8?hb(r,r.bi_buf):r.bi_valid>0&&(r.pending_buf[r.pending++]=r.bi_buf),r.bi_buf=0,r.bi_valid=0},BB=(r,e,t,n)=>{let i=2*e,s=2*t;return r[i]<r[s]||r[i]===r[s]&&n[e]<=n[t]},WP=(r,e,t)=>{let n=r.heap[t],i=t<<1;for(;i<=r.heap_len&&(i<r.heap_len&&BB(e,r.heap[i+1],r.heap[i],r.depth)&&i++,!BB(e,n,r.heap[i],r.depth));)r.heap[t]=r.heap[i],t=i,i<<=1;r.heap[t]=n},HP=(r,e,t)=>{let n,i,s,o,c=0;if(r.sym_next!==0)do n=255&r.pending_buf[r.sym_buf+c++],n+=(255&r.pending_buf[r.sym_buf+c++])<<8,i=r.pending_buf[r.sym_buf+c++],n===0?ra(r,i,e):(s=rE[i],ra(r,s+nS+1,e),o=Mv[s],o!==0&&(i-=Uv[s],Rc(r,i,o)),n--,s=GP(n),ra(r,s,t),o=lb[s],o!==0&&(n-=db[s],Rc(r,n,o)));while(c<r.sym_next);ra(r,256,e)},KP=(r,e)=>{let t=e.dyn_tree,n=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems,o,c,d,u=-1;for(r.heap_len=0,r.heap_max=573,o=0;o<s;o++)t[2*o]!==0?(r.heap[++r.heap_len]=u=o,r.depth[o]=0):t[2*o+1]=0;for(;r.heap_len<2;)d=r.heap[++r.heap_len]=u<2?++u:0,t[2*d]=1,r.depth[d]=0,r.opt_len--,i&&(r.static_len-=n[2*d+1]);for(e.max_code=u,o=r.heap_len>>1;o>=1;o--)WP(r,t,o);d=s;do o=r.heap[1],r.heap[1]=r.heap[r.heap_len--],WP(r,t,1),c=r.heap[1],r.heap[--r.heap_max]=o,r.heap[--r.heap_max]=c,t[2*d]=t[2*o]+t[2*c],r.depth[d]=(r.depth[o]>=r.depth[c]?r.depth[o]:r.depth[c])+1,t[2*o+1]=t[2*c+1]=d,r.heap[1]=d++,WP(r,t,1);while(r.heap_len>=2);r.heap[--r.heap_max]=r.heap[1],((p,m)=>{let g=m.dyn_tree,T=m.max_code,R=m.stat_desc.static_tree,I=m.stat_desc.has_stree,A=m.stat_desc.extra_bits,w=m.stat_desc.extra_base,k=m.stat_desc.max_length,L,j,K,W,Y,se,de=0;for(W=0;W<=nE;W++)p.bl_count[W]=0;for(g[2*p.heap[p.heap_max]+1]=0,L=p.heap_max+1;L<573;L++)j=p.heap[L],W=g[2*g[2*j+1]+1]+1,W>k&&(W=k,de++),g[2*j+1]=W,j>T||(p.bl_count[W]++,Y=0,j>=w&&(Y=A[j-w]),se=g[2*j],p.opt_len+=se*(W+Y),I&&(p.static_len+=se*(R[2*j+1]+Y)));if(de!==0){do{for(W=k-1;p.bl_count[W]===0;)W--;p.bl_count[W]--,p.bl_count[W+1]+=2,p.bl_count[k]--,de-=2}while(de>0);for(W=k;W!==0;W--)for(j=p.bl_count[W];j!==0;)K=p.heap[--L],K>T||(g[2*K+1]!==W&&(p.opt_len+=(W-g[2*K+1])*g[2*K],g[2*K+1]=W),j--)}})(r,e),xB(t,u,r.bl_count)},zP=(r,e,t)=>{let n,i,s=-1,o=e[1],c=0,d=7,u=4;for(o===0&&(d=138,u=3),e[2*(t+1)+1]=65535,n=0;n<=t;n++)i=o,o=e[2*(n+1)+1],++c<d&&i===o||(c<u?r.bl_tree[2*i]+=c:i!==0?(i!==s&&r.bl_tree[2*i]++,r.bl_tree[32]++):c<=10?r.bl_tree[34]++:r.bl_tree[36]++,c=0,s=i,o===0?(d=138,u=3):i===o?(d=6,u=3):(d=7,u=4))},jB=(r,e,t)=>{let n,i,s=-1,o=e[1],c=0,d=7,u=4;for(o===0&&(d=138,u=3),n=0;n<=t;n++)if(i=o,o=e[2*(n+1)+1],!(++c<d&&i===o)){if(c<u)do ra(r,i,r.bl_tree);while(--c!=0);else i!==0?(i!==s&&(ra(r,i,r.bl_tree),c--),ra(r,16,r.bl_tree),Rc(r,c-3,2)):c<=10?(ra(r,17,r.bl_tree),Rc(r,c-3,3)):(ra(r,18,r.bl_tree),Rc(r,c-11,7));c=0,s=i,o===0?(d=138,u=3):i===o?(d=6,u=3):(d=7,u=4)}},GB=!1,WB=(r,e,t,n)=>{Rc(r,0+(n?1:0),3),FB(r),hb(r,t),hb(r,~t),t&&r.pending_buf.set(r.window.subarray(e,e+t),r.pending),r.pending+=t};var s6=r=>{GB||((()=>{let e,t,n,i,s,o=new Array(16);for(n=0,i=0;i<28;i++)for(Uv[i]=n,e=0;e<1<<Mv[i];e++)rE[n++]=i;for(rE[n-1]=i,s=0,i=0;i<16;i++)for(db[i]=s,e=0;e<1<<lb[i];e++)iE[s++]=i;for(s>>=7;i<cb;i++)for(db[i]=s<<7,e=0;e<1<<lb[i]-7;e++)iE[256+s++]=i;for(t=0;t<=nE;t++)o[t]=0;for(e=0;e<=143;)D_[2*e+1]=8,e++,o[8]++;for(;e<=255;)D_[2*e+1]=9,e++,o[9]++;for(;e<=279;)D_[2*e+1]=7,e++,o[7]++;for(;e<=287;)D_[2*e+1]=8,e++,o[8]++;for(xB(D_,287,o),e=0;e<cb;e++)Nu[2*e+1]=5,Nu[2*e]=hf(e,5);BP=new ub(D_,Mv,257,VP,nE),MB=new ub(Nu,lb,0,cb,nE),UB=new ub(new Array(0),FP,0,19,7)})(),GB=!0),r.l_desc=new jP(r.dyn_ltree,BP),r.d_desc=new jP(r.dyn_dtree,MB),r.bl_desc=new jP(r.bl_tree,UB),r.bi_buf=0,r.bi_valid=0,VB(r)},dY=(r,e,t,n)=>{let i,s,o=0;r.level>0?(r.strm.data_type===2&&(r.strm.data_type=(c=>{let d,u=4093624447;for(d=0;d<=31;d++,u>>>=1)if(1&u&&c.dyn_ltree[2*d]!==0)return 0;if(c.dyn_ltree[18]!==0||c.dyn_ltree[20]!==0||c.dyn_ltree[26]!==0)return 1;for(d=32;d<nS;d++)if(c.dyn_ltree[2*d]!==0)return 1;return 0})(r)),KP(r,r.l_desc),KP(r,r.d_desc),o=(c=>{let d;for(zP(c,c.dyn_ltree,c.l_desc.max_code),zP(c,c.dyn_dtree,c.d_desc.max_code),KP(c,c.bl_desc),d=18;d>=3&&c.bl_tree[2*r6[d]+1]===0;d--);return c.opt_len+=3*(d+1)+5+5+4,d})(r),i=r.opt_len+3+7>>>3,s=r.static_len+3+7>>>3,s<=i&&(i=s)):i=s=t+5,t+4<=i&&e!==-1?WB(r,e,t,n):r.strategy===4||s===i?(Rc(r,2+(n?1:0),3),HP(r,D_,Nu)):(Rc(r,4+(n?1:0),3),((c,d,u,p)=>{let m;for(Rc(c,d-257,5),Rc(c,u-1,5),Rc(c,p-4,4),m=0;m<p;m++)Rc(c,c.bl_tree[2*r6[m]+1],3);jB(c,c.dyn_ltree,d-1),jB(c,c.dyn_dtree,u-1)})(r,r.l_desc.max_code+1,r.d_desc.max_code+1,o+1),HP(r,r.dyn_ltree,r.dyn_dtree)),VB(r),n&&FB(r)},uY=(r,e,t)=>(r.pending_buf[r.sym_buf+r.sym_next++]=e,r.pending_buf[r.sym_buf+r.sym_next++]=e>>8,r.pending_buf[r.sym_buf+r.sym_next++]=t,e===0?r.dyn_ltree[2*t]++:(r.matches++,e--,r.dyn_ltree[2*(rE[t]+nS+1)]++,r.dyn_dtree[2*GP(e)]++),r.sym_next===r.sym_end),hY=r=>{Rc(r,2,3),ra(r,256,D_),(e=>{e.bi_valid===16?(hb(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(r)},pY={_tr_init:s6,_tr_stored_block:WB,_tr_flush_block:dY,_tr_tally:uY,_tr_align:hY},T0=(r,e,t,n)=>{let i=65535&r|0,s=r>>>16&65535|0,o=0;for(;t!==0;){o=t>2e3?2e3:t,t-=o;do i=i+e[n++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0};let v0=new Uint32Array((()=>{let r,e=[];for(var t=0;t<256;t++){r=t;for(var n=0;n<8;n++)r=1&r?3988292384^r>>>1:r>>>1;e[t]=r}return e})());var Cc=(r,e,t,n)=>{let i=v0,s=n+t;r^=-1;for(let o=n;o<s;o++)r=r>>>8^i[255&(r^e[o])];return-1^r},Uo={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},P_={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};let{_tr_init:YP,_tr_stored_block:HB,_tr_flush_block:KB,_tr_tally:iS,_tr_align:rS}=pY,{Z_NO_FLUSH:sS,Z_PARTIAL_FLUSH:oS,Z_FULL_FLUSH:fY,Z_FINISH:Dh,Z_BLOCK:Du,Z_OK:bc,Z_STREAM_END:Ic,Z_STREAM_ERROR:pf,Z_DATA_ERROR:k_,Z_BUF_ERROR:zB,Z_DEFAULT_COMPRESSION:YB,Z_FILTERED:_Y,Z_HUFFMAN_ONLY:qP,Z_RLE:XP,Z_FIXED:mY,Z_DEFAULT_STRATEGY:EY,Z_UNKNOWN:gY,Z_DEFLATED:JP}=P_,pb=286,qB=30,SY=19,TY=2*pb+1,vY=15,xv=258,vl=262,rd=42,Ph=113,ff=666,_f=(r,e)=>(r.msg=Uo[e],e),aS=r=>2*r-(r>4?9:0),sE=r=>{let e=r.length;for(;--e>=0;)r[e]=0},cS=r=>{let e,t,n,i=r.w_size;e=r.hash_size,n=e;do t=r.head[--n],r.head[n]=t>=i?t-i:0;while(--e);e=i,n=e;do t=r.prev[--n],r.prev[n]=t>=i?t-i:0;while(--e)},lS=(r,e,t)=>(e<<r.hash_shift^t)&r.hash_mask,za=r=>{let e=r.state,t=e.pending;t>r.avail_out&&(t=r.avail_out),t!==0&&(r.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+t),r.next_out),r.next_out+=t,e.pending_out+=t,r.total_out+=t,r.avail_out-=t,e.pending-=t,e.pending===0&&(e.pending_out=0))},To=(r,e)=>{KB(r,r.block_start>=0?r.block_start:-1,r.strstart-r.block_start,e),r.block_start=r.strstart,za(r.strm)},Fi=(r,e)=>{r.pending_buf[r.pending++]=e},Ur=(r,e)=>{r.pending_buf[r.pending++]=e>>>8&255,r.pending_buf[r.pending++]=255&e},Vv=(r,e,t,n)=>{let i=r.avail_in;return i>n&&(i=n),i===0?0:(r.avail_in-=i,e.set(r.input.subarray(r.next_in,r.next_in+i),t),r.state.wrap===1?r.adler=T0(r.adler,e,i,t):r.state.wrap===2&&(r.adler=Cc(r.adler,e,i,t)),r.next_in+=i,r.total_in+=i,i)},QP=(r,e)=>{let t,n,i=r.max_chain_length,s=r.strstart,o=r.prev_length,c=r.nice_match,d=r.strstart>r.w_size-vl?r.strstart-(r.w_size-vl):0,u=r.window,p=r.w_mask,m=r.prev,g=r.strstart+xv,T=u[s+o-1],R=u[s+o];r.prev_length>=r.good_match&&(i>>=2),c>r.lookahead&&(c=r.lookahead);do if(t=e,u[t+o]===R&&u[t+o-1]===T&&u[t]===u[s]&&u[++t]===u[s+1]){s+=2,t++;do;while(u[++s]===u[++t]&&u[++s]===u[++t]&&u[++s]===u[++t]&&u[++s]===u[++t]&&u[++s]===u[++t]&&u[++s]===u[++t]&&u[++s]===u[++t]&&u[++s]===u[++t]&&s<g);if(n=xv-(g-s),s=g-xv,n>o){if(r.match_start=e,o=n,n>=c)break;T=u[s+o-1],R=u[s+o]}}while((e=m[e&p])>d&&--i!=0);return o<=r.lookahead?o:r.lookahead},Fv=r=>{let e=r.w_size,t,n,i;do{if(n=r.window_size-r.lookahead-r.strstart,r.strstart>=e+(e-vl)&&(r.window.set(r.window.subarray(e,e+e-n),0),r.match_start-=e,r.strstart-=e,r.block_start-=e,r.insert>r.strstart&&(r.insert=r.strstart),cS(r),n+=e),r.strm.avail_in===0)break;if(t=Vv(r.strm,r.window,r.strstart+r.lookahead,n),r.lookahead+=t,r.lookahead+r.insert>=3)for(i=r.strstart-r.insert,r.ins_h=r.window[i],r.ins_h=lS(r,r.ins_h,r.window[i+1]);r.insert&&(r.ins_h=lS(r,r.ins_h,r.window[i+3-1]),r.prev[i&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=i,i++,r.insert--,!(r.lookahead+r.insert<3)););}while(r.lookahead<vl&&r.strm.avail_in!==0)},Bv=(r,e)=>{let t,n,i,s=r.pending_buf_size-5>r.w_size?r.w_size:r.pending_buf_size-5,o=0,c=r.strm.avail_in;do{if(t=65535,i=r.bi_valid+42>>3,r.strm.avail_out<i||(i=r.strm.avail_out-i,n=r.strstart-r.block_start,t>n+r.strm.avail_in&&(t=n+r.strm.avail_in),t>i&&(t=i),t<s&&(t===0&&e!==Dh||e===sS||t!==n+r.strm.avail_in)))break;o=e===Dh&&t===n+r.strm.avail_in?1:0,HB(r,0,0,o),r.pending_buf[r.pending-4]=t,r.pending_buf[r.pending-3]=t>>8,r.pending_buf[r.pending-2]=~t,r.pending_buf[r.pending-1]=~t>>8,za(r.strm),n&&(n>t&&(n=t),r.strm.output.set(r.window.subarray(r.block_start,r.block_start+n),r.strm.next_out),r.strm.next_out+=n,r.strm.avail_out-=n,r.strm.total_out+=n,r.block_start+=n,t-=n),t&&(Vv(r.strm,r.strm.output,r.strm.next_out,t),r.strm.next_out+=t,r.strm.avail_out-=t,r.strm.total_out+=t)}while(o===0);return c-=r.strm.avail_in,c&&(c>=r.w_size?(r.matches=2,r.window.set(r.strm.input.subarray(r.strm.next_in-r.w_size,r.strm.next_in),0),r.strstart=r.w_size,r.insert=r.strstart):(r.window_size-r.strstart<=c&&(r.strstart-=r.w_size,r.window.set(r.window.subarray(r.w_size,r.w_size+r.strstart),0),r.matches<2&&r.matches++,r.insert>r.strstart&&(r.insert=r.strstart)),r.window.set(r.strm.input.subarray(r.strm.next_in-c,r.strm.next_in),r.strstart),r.strstart+=c,r.insert+=c>r.w_size-r.insert?r.w_size-r.insert:c),r.block_start=r.strstart),r.high_water<r.strstart&&(r.high_water=r.strstart),o?4:e!==sS&&e!==Dh&&r.strm.avail_in===0&&r.strstart===r.block_start?2:(i=r.window_size-r.strstart,r.strm.avail_in>i&&r.block_start>=r.w_size&&(r.block_start-=r.w_size,r.strstart-=r.w_size,r.window.set(r.window.subarray(r.w_size,r.w_size+r.strstart),0),r.matches<2&&r.matches++,i+=r.w_size,r.insert>r.strstart&&(r.insert=r.strstart)),i>r.strm.avail_in&&(i=r.strm.avail_in),i&&(Vv(r.strm,r.window,r.strstart,i),r.strstart+=i,r.insert+=i>r.w_size-r.insert?r.w_size-r.insert:i),r.high_water<r.strstart&&(r.high_water=r.strstart),i=r.bi_valid+42>>3,i=r.pending_buf_size-i>65535?65535:r.pending_buf_size-i,s=i>r.w_size?r.w_size:i,n=r.strstart-r.block_start,(n>=s||(n||e===Dh)&&e!==sS&&r.strm.avail_in===0&&n<=i)&&(t=n>i?i:n,o=e===Dh&&r.strm.avail_in===0&&t===n?1:0,HB(r,r.block_start,t,o),r.block_start+=t,za(r.strm)),o?3:1)},ZP=(r,e)=>{let t,n;for(;;){if(r.lookahead<vl){if(Fv(r),r.lookahead<vl&&e===sS)return 1;if(r.lookahead===0)break}if(t=0,r.lookahead>=3&&(r.ins_h=lS(r,r.ins_h,r.window[r.strstart+3-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),t!==0&&r.strstart-t<=r.w_size-vl&&(r.match_length=QP(r,t)),r.match_length>=3)if(n=iS(r,r.strstart-r.match_start,r.match_length-3),r.lookahead-=r.match_length,r.match_length<=r.max_lazy_match&&r.lookahead>=3){r.match_length--;do r.strstart++,r.ins_h=lS(r,r.ins_h,r.window[r.strstart+3-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart;while(--r.match_length!=0);r.strstart++}else r.strstart+=r.match_length,r.match_length=0,r.ins_h=r.window[r.strstart],r.ins_h=lS(r,r.ins_h,r.window[r.strstart+1]);else n=iS(r,0,r.window[r.strstart]),r.lookahead--,r.strstart++;if(n&&(To(r,!1),r.strm.avail_out===0))return 1}return r.insert=r.strstart<2?r.strstart:2,e===Dh?(To(r,!0),r.strm.avail_out===0?3:4):r.sym_next&&(To(r,!1),r.strm.avail_out===0)?1:2},dS=(r,e)=>{let t,n,i;for(;;){if(r.lookahead<vl){if(Fv(r),r.lookahead<vl&&e===sS)return 1;if(r.lookahead===0)break}if(t=0,r.lookahead>=3&&(r.ins_h=lS(r,r.ins_h,r.window[r.strstart+3-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart),r.prev_length=r.match_length,r.prev_match=r.match_start,r.match_length=2,t!==0&&r.prev_length<r.max_lazy_match&&r.strstart-t<=r.w_size-vl&&(r.match_length=QP(r,t),r.match_length<=5&&(r.strategy===_Y||r.match_length===3&&r.strstart-r.match_start>4096)&&(r.match_length=2)),r.prev_length>=3&&r.match_length<=r.prev_length){i=r.strstart+r.lookahead-3,n=iS(r,r.strstart-1-r.prev_match,r.prev_length-3),r.lookahead-=r.prev_length-1,r.prev_length-=2;do++r.strstart<=i&&(r.ins_h=lS(r,r.ins_h,r.window[r.strstart+3-1]),t=r.prev[r.strstart&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=r.strstart);while(--r.prev_length!=0);if(r.match_available=0,r.match_length=2,r.strstart++,n&&(To(r,!1),r.strm.avail_out===0))return 1}else if(r.match_available){if(n=iS(r,0,r.window[r.strstart-1]),n&&To(r,!1),r.strstart++,r.lookahead--,r.strm.avail_out===0)return 1}else r.match_available=1,r.strstart++,r.lookahead--}return r.match_available&&(n=iS(r,0,r.window[r.strstart-1]),r.match_available=0),r.insert=r.strstart<2?r.strstart:2,e===Dh?(To(r,!0),r.strm.avail_out===0?3:4):r.sym_next&&(To(r,!1),r.strm.avail_out===0)?1:2};function sd(r,e,t,n,i){this.good_length=r,this.max_lazy=e,this.nice_length=t,this.max_chain=n,this.func=i}let Bd=[new sd(0,0,0,0,Bv),new sd(4,4,8,4,ZP),new sd(4,5,16,8,ZP),new sd(4,6,32,32,ZP),new sd(4,4,16,16,dS),new sd(8,16,32,32,dS),new sd(8,16,128,128,dS),new sd(8,32,128,256,dS),new sd(32,128,258,1024,dS),new sd(32,258,258,4096,dS)];function y0(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=JP,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*TY),this.dyn_dtree=new Uint16Array(2*(2*qB+1)),this.bl_tree=new Uint16Array(2*(2*SY+1)),sE(this.dyn_ltree),sE(this.dyn_dtree),sE(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(vY+1),this.heap=new Uint16Array(2*pb+1),sE(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*pb+1),sE(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}let R0=r=>{if(!r)return 1;let e=r.state;return!e||e.strm!==r||e.status!==rd&&e.status!==57&&e.status!==69&&e.status!==73&&e.status!==91&&e.status!==103&&e.status!==Ph&&e.status!==ff?1:0},fb=r=>{if(R0(r))return _f(r,pf);r.total_in=r.total_out=0,r.data_type=gY;let e=r.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?57:e.wrap?rd:Ph,r.adler=e.wrap===2?0:1,e.last_flush=-2,YP(e),bc},XB=r=>{let e=fb(r);return e===bc&&(t=>{t.window_size=2*t.w_size,sE(t.head),t.max_lazy_match=Bd[t.level].max_lazy,t.good_match=Bd[t.level].good_length,t.nice_match=Bd[t.level].nice_length,t.max_chain_length=Bd[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0})(r.state),e},JB=(r,e,t,n,i,s)=>{if(!r)return pf;let o=1;if(e===YB&&(e=6),n<0?(o=0,n=-n):n>15&&(o=2,n-=16),i<1||i>9||t!==JP||n<8||n>15||e<0||e>9||s<0||s>mY||n===8&&o!==1)return _f(r,pf);n===8&&(n=9);let c=new y0;return r.state=c,c.strm=r,c.status=rd,c.wrap=o,c.gzhead=null,c.w_bits=n,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=i+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+3-1)/3),c.window=new Uint8Array(2*c.w_size),c.head=new Uint16Array(c.hash_size),c.prev=new Uint16Array(c.w_size),c.lit_bufsize=1<<i+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new Uint8Array(c.pending_buf_size),c.sym_buf=c.lit_bufsize,c.sym_end=3*(c.lit_bufsize-1),c.level=e,c.strategy=s,c.method=t,XB(r)};var o6=(r,e)=>{if(R0(r)||e>Du||e<0)return r?_f(r,pf):pf;let t=r.state;if(!r.output||r.avail_in!==0&&!r.input||t.status===ff&&e!==Dh)return _f(r,r.avail_out===0?zB:pf);let n=t.last_flush;if(t.last_flush=e,t.pending!==0){if(za(r),r.avail_out===0)return t.last_flush=-1,bc}else if(r.avail_in===0&&aS(e)<=aS(n)&&e!==Dh)return _f(r,zB);if(t.status===ff&&r.avail_in!==0)return _f(r,zB);if(t.status===rd&&t.wrap===0&&(t.status=Ph),t.status===rd){let i=JP+(t.w_bits-8<<4)<<8,s=-1;if(s=t.strategy>=qP||t.level<2?0:t.level<6?1:t.level===6?2:3,i|=s<<6,t.strstart!==0&&(i|=32),i+=31-i%31,Ur(t,i),t.strstart!==0&&(Ur(t,r.adler>>>16),Ur(t,65535&r.adler)),r.adler=1,t.status=Ph,za(r),t.pending!==0)return t.last_flush=-1,bc}if(t.status===57){if(r.adler=0,Fi(t,31),Fi(t,139),Fi(t,8),t.gzhead)Fi(t,(t.gzhead.text?1:0)+(t.gzhead.hcrc?2:0)+(t.gzhead.extra?4:0)+(t.gzhead.name?8:0)+(t.gzhead.comment?16:0)),Fi(t,255&t.gzhead.time),Fi(t,t.gzhead.time>>8&255),Fi(t,t.gzhead.time>>16&255),Fi(t,t.gzhead.time>>24&255),Fi(t,t.level===9?2:t.strategy>=qP||t.level<2?4:0),Fi(t,255&t.gzhead.os),t.gzhead.extra&&t.gzhead.extra.length&&(Fi(t,255&t.gzhead.extra.length),Fi(t,t.gzhead.extra.length>>8&255)),t.gzhead.hcrc&&(r.adler=Cc(r.adler,t.pending_buf,t.pending,0)),t.gzindex=0,t.status=69;else if(Fi(t,0),Fi(t,0),Fi(t,0),Fi(t,0),Fi(t,0),Fi(t,t.level===9?2:t.strategy>=qP||t.level<2?4:0),Fi(t,3),t.status=Ph,za(r),t.pending!==0)return t.last_flush=-1,bc}if(t.status===69){if(t.gzhead.extra){let i=t.pending,s=(65535&t.gzhead.extra.length)-t.gzindex;for(;t.pending+s>t.pending_buf_size;){let c=t.pending_buf_size-t.pending;if(t.pending_buf.set(t.gzhead.extra.subarray(t.gzindex,t.gzindex+c),t.pending),t.pending=t.pending_buf_size,t.gzhead.hcrc&&t.pending>i&&(r.adler=Cc(r.adler,t.pending_buf,t.pending-i,i)),t.gzindex+=c,za(r),t.pending!==0)return t.last_flush=-1,bc;i=0,s-=c}let o=new Uint8Array(t.gzhead.extra);t.pending_buf.set(o.subarray(t.gzindex,t.gzindex+s),t.pending),t.pending+=s,t.gzhead.hcrc&&t.pending>i&&(r.adler=Cc(r.adler,t.pending_buf,t.pending-i,i)),t.gzindex=0}t.status=73}if(t.status===73){if(t.gzhead.name){let i,s=t.pending;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>s&&(r.adler=Cc(r.adler,t.pending_buf,t.pending-s,s)),za(r),t.pending!==0)return t.last_flush=-1,bc;s=0}i=t.gzindex<t.gzhead.name.length?255&t.gzhead.name.charCodeAt(t.gzindex++):0,Fi(t,i)}while(i!==0);t.gzhead.hcrc&&t.pending>s&&(r.adler=Cc(r.adler,t.pending_buf,t.pending-s,s)),t.gzindex=0}t.status=91}if(t.status===91){if(t.gzhead.comment){let i,s=t.pending;do{if(t.pending===t.pending_buf_size){if(t.gzhead.hcrc&&t.pending>s&&(r.adler=Cc(r.adler,t.pending_buf,t.pending-s,s)),za(r),t.pending!==0)return t.last_flush=-1,bc;s=0}i=t.gzindex<t.gzhead.comment.length?255&t.gzhead.comment.charCodeAt(t.gzindex++):0,Fi(t,i)}while(i!==0);t.gzhead.hcrc&&t.pending>s&&(r.adler=Cc(r.adler,t.pending_buf,t.pending-s,s))}t.status=103}if(t.status===103){if(t.gzhead.hcrc){if(t.pending+2>t.pending_buf_size&&(za(r),t.pending!==0))return t.last_flush=-1,bc;Fi(t,255&r.adler),Fi(t,r.adler>>8&255),r.adler=0}if(t.status=Ph,za(r),t.pending!==0)return t.last_flush=-1,bc}if(r.avail_in!==0||t.lookahead!==0||e!==sS&&t.status!==ff){let i=t.level===0?Bv(t,e):t.strategy===qP?((s,o)=>{let c;for(;;){if(s.lookahead===0&&(Fv(s),s.lookahead===0)){if(o===sS)return 1;break}if(s.match_length=0,c=iS(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++,c&&(To(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===Dh?(To(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(To(s,!1),s.strm.avail_out===0)?1:2})(t,e):t.strategy===XP?((s,o)=>{let c,d,u,p,m=s.window;for(;;){if(s.lookahead<=xv){if(Fv(s),s.lookahead<=xv&&o===sS)return 1;if(s.lookahead===0)break}if(s.match_length=0,s.lookahead>=3&&s.strstart>0&&(u=s.strstart-1,d=m[u],d===m[++u]&&d===m[++u]&&d===m[++u])){p=s.strstart+xv;do;while(d===m[++u]&&d===m[++u]&&d===m[++u]&&d===m[++u]&&d===m[++u]&&d===m[++u]&&d===m[++u]&&d===m[++u]&&u<p);s.match_length=xv-(p-u),s.match_length>s.lookahead&&(s.match_length=s.lookahead)}if(s.match_length>=3?(c=iS(s,1,s.match_length-3),s.lookahead-=s.match_length,s.strstart+=s.match_length,s.match_length=0):(c=iS(s,0,s.window[s.strstart]),s.lookahead--,s.strstart++),c&&(To(s,!1),s.strm.avail_out===0))return 1}return s.insert=0,o===Dh?(To(s,!0),s.strm.avail_out===0?3:4):s.sym_next&&(To(s,!1),s.strm.avail_out===0)?1:2})(t,e):Bd[t.level].func(t,e);if(i!==3&&i!==4||(t.status=ff),i===1||i===3)return r.avail_out===0&&(t.last_flush=-1),bc;if(i===2&&(e===oS?rS(t):e!==Du&&(HB(t,0,0,!1),e===fY&&(sE(t.head),t.lookahead===0&&(t.strstart=0,t.block_start=0,t.insert=0))),za(r),r.avail_out===0))return t.last_flush=-1,bc}return e!==Dh?bc:t.wrap<=0?Ic:(t.wrap===2?(Fi(t,255&r.adler),Fi(t,r.adler>>8&255),Fi(t,r.adler>>16&255),Fi(t,r.adler>>24&255),Fi(t,255&r.total_in),Fi(t,r.total_in>>8&255),Fi(t,r.total_in>>16&255),Fi(t,r.total_in>>24&255)):(Ur(t,r.adler>>>16),Ur(t,65535&r.adler)),za(r),t.wrap>0&&(t.wrap=-t.wrap),t.pending!==0?bc:Ic)},yY=(r,e)=>{let t=e.length;if(R0(r))return pf;let n=r.state,i=n.wrap;if(i===2||i===1&&n.status!==rd||n.lookahead)return pf;if(i===1&&(r.adler=T0(r.adler,e,t,0)),n.wrap=0,t>=n.w_size){i===0&&(sE(n.head),n.strstart=0,n.block_start=0,n.insert=0);let d=new Uint8Array(n.w_size);d.set(e.subarray(t-n.w_size,t),0),e=d,t=n.w_size}let s=r.avail_in,o=r.next_in,c=r.input;for(r.avail_in=t,r.next_in=0,r.input=e,Fv(n);n.lookahead>=3;){let d=n.strstart,u=n.lookahead-2;do n.ins_h=lS(n,n.ins_h,n.window[d+3-1]),n.prev[d&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=d,d++;while(--u);n.strstart=d,n.lookahead=2,Fv(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,r.next_in=o,r.input=c,r.avail_in=s,n.wrap=i,bc},C0={deflateInit:(r,e)=>JB(r,e,JP,15,8,EY),deflateInit2:JB,deflateReset:XB,deflateResetKeep:fb,deflateSetHeader:(r,e)=>R0(r)||r.state.wrap!==2?pf:(r.state.gzhead=e,bc),deflate:o6,deflateEnd:r=>{if(R0(r))return pf;let e=r.state.status;return r.state=null,e===Ph?_f(r,k_):bc},deflateSetDictionary:yY,deflateInfo:"pako deflate (from Nodeca project)"};let b0=(r,e)=>Object.prototype.hasOwnProperty.call(r,e);var $P={assign:function(r){let e=Array.prototype.slice.call(arguments,1);for(;e.length;){let t=e.shift();if(t){if(typeof t!="object")throw new TypeError(t+"must be non-object");for(let n in t)b0(t,n)&&(r[n]=t[n])}}return r},flattenChunks:r=>{let e=0;for(let n=0,i=r.length;n<i;n++)e+=r[n].length;let t=new Uint8Array(e);for(let n=0,i=0,s=r.length;n<s;n++){let o=r[n];t.set(o,i),i+=o.length}return t}};let I0=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{I0=!1}let _b=new Uint8Array(256);for(let r=0;r<256;r++)_b[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;_b[254]=_b[254]=1;var oE={string2buf:r=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(r);let e,t,n,i,s,o=r.length,c=0;for(i=0;i<o;i++)t=r.charCodeAt(i),(64512&t)==55296&&i+1<o&&(n=r.charCodeAt(i+1),(64512&n)==56320&&(t=65536+(t-55296<<10)+(n-56320),i++)),c+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(c),s=0,i=0;s<c;i++)t=r.charCodeAt(i),(64512&t)==55296&&i+1<o&&(n=r.charCodeAt(i+1),(64512&n)==56320&&(t=65536+(t-55296<<10)+(n-56320),i++)),t<128?e[s++]=t:t<2048?(e[s++]=192|t>>>6,e[s++]=128|63&t):t<65536?(e[s++]=224|t>>>12,e[s++]=128|t>>>6&63,e[s++]=128|63&t):(e[s++]=240|t>>>18,e[s++]=128|t>>>12&63,e[s++]=128|t>>>6&63,e[s++]=128|63&t);return e},buf2string:(r,e)=>{let t=e||r.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(r.subarray(0,e));let n,i,s=new Array(2*t);for(i=0,n=0;n<t;){let o=r[n++];if(o<128){s[i++]=o;continue}let c=_b[o];if(c>4)s[i++]=65533,n+=c-1;else{for(o&=c===2?31:c===3?15:7;c>1&&n<t;)o=o<<6|63&r[n++],c--;c>1?s[i++]=65533:o<65536?s[i++]=o:(o-=65536,s[i++]=55296|o>>10&1023,s[i++]=56320|1023&o)}}return((o,c)=>{if(c<65534&&o.subarray&&I0)return String.fromCharCode.apply(null,o.length===c?o:o.subarray(0,c));let d="";for(let u=0;u<c;u++)d+=String.fromCharCode(o[u]);return d})(s,i)},utf8border:(r,e)=>{(e=e||r.length)>r.length&&(e=r.length);let t=e-1;for(;t>=0&&(192&r[t])==128;)t--;return t<0||t===0?e:t+_b[r[t]]>e?t:e}},mb=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};let QB=Object.prototype.toString,{Z_NO_FLUSH:a6,Z_SYNC_FLUSH:RY,Z_FULL_FLUSH:CY,Z_FINISH:bY,Z_OK:ek,Z_STREAM_END:tk,Z_DEFAULT_COMPRESSION:IY,Z_DEFAULT_STRATEGY:AY,Z_DEFLATED:wY}=P_;function nk(r){this.options=$P.assign({level:IY,method:wY,chunkSize:16384,windowBits:15,memLevel:8,strategy:AY},r||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new mb,this.strm.avail_out=0;let t=C0.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(t!==ek)throw new Error(Uo[t]);if(e.header&&C0.deflateSetHeader(this.strm,e.header),e.dictionary){let n;if(n=typeof e.dictionary=="string"?oE.string2buf(e.dictionary):QB.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,t=C0.deflateSetDictionary(this.strm,n),t!==ek)throw new Error(Uo[t]);this._dict_set=!0}}function ik(r,e){let t=new nk(e);if(t.push(r,!0),t.err)throw t.msg||Uo[t.err];return t.result}nk.prototype.push=function(r,e){let t=this.strm,n=this.options.chunkSize,i,s;if(this.ended)return!1;for(s=e===~~e?e:e===!0?bY:a6,typeof r=="string"?t.input=oE.string2buf(r):QB.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;)if(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),(s===RY||s===CY)&&t.avail_out<=6)this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;else{if(i=C0.deflate(t,s),i===tk)return t.next_out>0&&this.onData(t.output.subarray(0,t.next_out)),i=C0.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===ek;if(t.avail_out!==0){if(s>0&&t.next_out>0)this.onData(t.output.subarray(0,t.next_out)),t.avail_out=0;else if(t.avail_in===0)break}else this.onData(t.output)}return!0},nk.prototype.onData=function(r){this.chunks.push(r)},nk.prototype.onEnd=function(r){r===ek&&(this.result=$P.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};var OY={deflate:ik};let rk=16209;var sk=function(r,e){let t,n,i,s,o,c,d,u,p,m,g,T,R,I,A,w,k,L,j,K,W,Y,se,de,ge=r.state;t=r.next_in,se=r.input,n=t+(r.avail_in-5),i=r.next_out,de=r.output,s=i-(e-r.avail_out),o=i+(r.avail_out-257),c=ge.dmax,d=ge.wsize,u=ge.whave,p=ge.wnext,m=ge.window,g=ge.hold,T=ge.bits,R=ge.lencode,I=ge.distcode,A=(1<<ge.lenbits)-1,w=(1<<ge.distbits)-1;e:do{T<15&&(g+=se[t++]<<T,T+=8,g+=se[t++]<<T,T+=8),k=R[g&A];t:for(;;){if(L=k>>>24,g>>>=L,T-=L,L=k>>>16&255,L===0)de[i++]=65535&k;else{if(!(16&L)){if(!(64&L)){k=R[(65535&k)+(g&(1<<L)-1)];continue t}if(32&L){ge.mode=16191;break e}r.msg="invalid literal/length code",ge.mode=rk;break e}j=65535&k,L&=15,L&&(T<L&&(g+=se[t++]<<T,T+=8),j+=g&(1<<L)-1,g>>>=L,T-=L),T<15&&(g+=se[t++]<<T,T+=8,g+=se[t++]<<T,T+=8),k=I[g&w];n:for(;;){if(L=k>>>24,g>>>=L,T-=L,L=k>>>16&255,!(16&L)){if(!(64&L)){k=I[(65535&k)+(g&(1<<L)-1)];continue n}r.msg="invalid distance code",ge.mode=rk;break e}if(K=65535&k,L&=15,T<L&&(g+=se[t++]<<T,T+=8,T<L&&(g+=se[t++]<<T,T+=8)),K+=g&(1<<L)-1,K>c){r.msg="invalid distance too far back",ge.mode=rk;break e}if(g>>>=L,T-=L,L=i-s,K>L){if(L=K-L,L>u&&ge.sane){r.msg="invalid distance too far back",ge.mode=rk;break e}if(W=0,Y=m,p===0){if(W+=d-L,L<j){j-=L;do de[i++]=m[W++];while(--L);W=i-K,Y=de}}else if(p<L){if(W+=d+p-L,L-=p,L<j){j-=L;do de[i++]=m[W++];while(--L);if(W=0,p<j){L=p,j-=L;do de[i++]=m[W++];while(--L);W=i-K,Y=de}}}else if(W+=p-L,L<j){j-=L;do de[i++]=m[W++];while(--L);W=i-K,Y=de}for(;j>2;)de[i++]=Y[W++],de[i++]=Y[W++],de[i++]=Y[W++],j-=3;j&&(de[i++]=Y[W++],j>1&&(de[i++]=Y[W++]))}else{W=i-K;do de[i++]=de[W++],de[i++]=de[W++],de[i++]=de[W++],j-=3;while(j>2);j&&(de[i++]=de[W++],j>1&&(de[i++]=de[W++]))}break}}break}}while(t<n&&i<o);j=T>>3,t-=j,T-=j<<3,g&=(1<<T)-1,r.next_in=t,r.next_out=i,r.avail_in=t<n?n-t+5:5-(t-n),r.avail_out=i<o?o-i+257:257-(i-o),ge.hold=g,ge.bits=T};let ok=15,ak=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),NY=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),DY=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),PY=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var A0=(r,e,t,n,i,s,o,c)=>{let d=c.bits,u,p,m,g,T,R,I=0,A=0,w=0,k=0,L=0,j=0,K=0,W=0,Y=0,se=0,de=null,ge=new Uint16Array(16),je=new Uint16Array(16),_t,ht,Ct,Ft=null;for(I=0;I<=ok;I++)ge[I]=0;for(A=0;A<n;A++)ge[e[t+A]]++;for(L=d,k=ok;k>=1&&ge[k]===0;k--);if(L>k&&(L=k),k===0)return i[s++]=20971520,i[s++]=20971520,c.bits=1,0;for(w=1;w<k&&ge[w]===0;w++);for(L<w&&(L=w),W=1,I=1;I<=ok;I++)if(W<<=1,W-=ge[I],W<0)return-1;if(W>0&&(r===0||k!==1))return-1;for(je[1]=0,I=1;I<ok;I++)je[I+1]=je[I]+ge[I];for(A=0;A<n;A++)e[t+A]!==0&&(o[je[e[t+A]]++]=A);if(r===0?(de=Ft=o,R=20):r===1?(de=ak,Ft=NY,R=257):(de=DY,Ft=PY,R=0),se=0,A=0,I=w,T=s,j=L,K=0,m=-1,Y=1<<L,g=Y-1,r===1&&Y>852||r===2&&Y>592)return 1;for(;;){_t=I-K,o[A]+1<R?(ht=0,Ct=o[A]):o[A]>=R?(ht=Ft[o[A]-R],Ct=de[o[A]-R]):(ht=96,Ct=0),u=1<<I-K,p=1<<j,w=p;do p-=u,i[T+(se>>K)+p]=_t<<24|ht<<16|Ct|0;while(p!==0);for(u=1<<I-1;se&u;)u>>=1;if(u!==0?(se&=u-1,se+=u):se=0,A++,--ge[I]==0){if(I===k)break;I=e[t+o[A]]}if(I>L&&(se&g)!==m){for(K===0&&(K=L),T+=w,j=I-K,W=1<<j;j+K<k&&(W-=ge[j+K],!(W<=0));)j++,W<<=1;if(Y+=1<<j,r===1&&Y>852||r===2&&Y>592)return 1;m=se&g,i[m]=L<<24|j<<16|T-s|0}}return se!==0&&(i[T+se]=I-K<<24|64<<16|0),c.bits=L,0};let{Z_FINISH:Eb,Z_BLOCK:c6,Z_TREES:ck,Z_OK:L_,Z_STREAM_END:jv,Z_NEED_DICT:kY,Z_STREAM_ERROR:kh,Z_DATA_ERROR:Pu,Z_MEM_ERROR:ZB,Z_BUF_ERROR:l6,Z_DEFLATED:d6}=P_,w0=16180,Gv=16190,Lh=16191,mf=16192,O0=16194,gb=16199,Wv=16200,Sb=16206,ao=16209,vo=r=>(r>>>24&255)+(r>>>8&65280)+((65280&r)<<8)+((255&r)<<24);function u6(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}let Hv=r=>{if(!r)return 1;let e=r.state;return!e||e.strm!==r||e.mode<w0||e.mode>16211?1:0},uS=r=>{if(Hv(r))return kh;let e=r.state;return r.total_in=r.total_out=e.total=0,r.msg="",e.wrap&&(r.adler=1&e.wrap),e.mode=w0,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,L_},$B=r=>{if(Hv(r))return kh;let e=r.state;return e.wsize=0,e.whave=0,e.wnext=0,uS(r)},ej=(r,e)=>{let t;if(Hv(r))return kh;let n=r.state;return e<0?(t=0,e=-e):(t=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?kh:(n.window!==null&&n.wbits!==e&&(n.window=null),n.wrap=t,n.wbits=e,$B(r))},tj=(r,e)=>{if(!r)return kh;let t=new u6;r.state=t,t.strm=r,t.window=null,t.mode=w0;let n=ej(r,e);return n!==L_&&(r.state=null),n},lk,N0,dk=!0,h6=r=>{if(dk){lk=new Int32Array(512),N0=new Int32Array(32);let e=0;for(;e<144;)r.lens[e++]=8;for(;e<256;)r.lens[e++]=9;for(;e<280;)r.lens[e++]=7;for(;e<288;)r.lens[e++]=8;for(A0(1,r.lens,0,288,lk,0,r.work,{bits:9}),e=0;e<32;)r.lens[e++]=5;A0(2,r.lens,0,32,N0,0,r.work,{bits:5}),dk=!1}r.lencode=lk,r.lenbits=9,r.distcode=N0,r.distbits=5},p6=(r,e,t,n)=>{let i,s=r.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(s.window.set(e.subarray(t-s.wsize,t),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>n&&(i=n),s.window.set(e.subarray(t-n,t-n+i),s.wnext),(n-=i)?(s.window.set(e.subarray(t-n,t),0),s.wnext=n,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0};var f6=(r,e)=>{let t,n,i,s,o,c,d,u,p,m,g,T,R,I,A,w,k,L,j,K,W,Y,se=0,de=new Uint8Array(4),ge,je,_t=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Hv(r)||!r.output||!r.input&&r.avail_in!==0)return kh;t=r.state,t.mode===Lh&&(t.mode=mf),o=r.next_out,i=r.output,d=r.avail_out,s=r.next_in,n=r.input,c=r.avail_in,u=t.hold,p=t.bits,m=c,g=d,Y=L_;e:for(;;)switch(t.mode){case w0:if(t.wrap===0){t.mode=mf;break}for(;p<16;){if(c===0)break e;c--,u+=n[s++]<<p,p+=8}if(2&t.wrap&&u===35615){t.wbits===0&&(t.wbits=15),t.check=0,de[0]=255&u,de[1]=u>>>8&255,t.check=Cc(t.check,de,2,0),u=0,p=0,t.mode=16181;break}if(t.head&&(t.head.done=!1),!(1&t.wrap)||(((255&u)<<8)+(u>>8))%31){r.msg="incorrect header check",t.mode=ao;break}if((15&u)!==d6){r.msg="unknown compression method",t.mode=ao;break}if(u>>>=4,p-=4,W=8+(15&u),t.wbits===0&&(t.wbits=W),W>15||W>t.wbits){r.msg="invalid window size",t.mode=ao;break}t.dmax=1<<t.wbits,t.flags=0,r.adler=t.check=1,t.mode=512&u?16189:Lh,u=0,p=0;break;case 16181:for(;p<16;){if(c===0)break e;c--,u+=n[s++]<<p,p+=8}if(t.flags=u,(255&dc(t))!==d6){r.msg="unknown compression method",t.mode=ao;break}if(57344&dc(t)){r.msg="unknown header flags set",t.mode=ao;break}t.head&&(t.head.text=u>>8&1),512&dc(t)&&4&t.wrap&&(de[0]=255&u,de[1]=u>>>8&255,t.check=Cc(t.check,de,2,0)),u=0,p=0,t.mode=16182;case 16182:for(;p<32;){if(c===0)break e;c--,u+=n[s++]<<p,p+=8}t.head&&(t.head.time=u),512&dc(t)&&4&t.wrap&&(de[0]=255&u,de[1]=u>>>8&255,de[2]=u>>>16&255,de[3]=u>>>24&255,t.check=Cc(t.check,de,4,0)),u=0,p=0,t.mode=16183;case 16183:for(;p<16;){if(c===0)break e;c--,u+=n[s++]<<p,p+=8}t.head&&(t.head.xflags=255&u,t.head.os=u>>8),512&dc(t)&&4&t.wrap&&(de[0]=255&u,de[1]=u>>>8&255,t.check=Cc(t.check,de,2,0)),u=0,p=0,t.mode=16184;case 16184:if(1024&dc(t)){for(;p<16;){if(c===0)break e;c--,u+=n[s++]<<p,p+=8}t.length=u,t.head&&(t.head.extra_len=u),512&dc(t)&&4&t.wrap&&(de[0]=255&u,de[1]=u>>>8&255,t.check=Cc(t.check,de,2,0)),u=0,p=0}else t.head&&(t.head.extra=null);t.mode=16185;case 16185:if(1024&dc(t)&&(T=t.length,T>c&&(T=c),T&&(t.head&&(W=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Uint8Array(t.head.extra_len)),t.head.extra.set(n.subarray(s,s+T),W)),512&dc(t)&&4&t.wrap&&(t.check=Cc(t.check,n,T,s)),c-=T,s+=T,t.length-=T),t.length))break e;t.length=0,t.mode=16186;case 16186:if(2048&dc(t)){if(c===0)break e;T=0;do W=n[s+T++],t.head&&W&&t.length<65536&&(t.head.name+=String.fromCharCode(W));while(W&&T<c);if(512&dc(t)&&4&t.wrap&&(t.check=Cc(t.check,n,T,s)),c-=T,s+=T,W)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=16187;case 16187:if(4096&dc(t)){if(c===0)break e;T=0;do W=n[s+T++],t.head&&W&&t.length<65536&&(t.head.comment+=String.fromCharCode(W));while(W&&T<c);if(512&dc(t)&&4&t.wrap&&(t.check=Cc(t.check,n,T,s)),c-=T,s+=T,W)break e}else t.head&&(t.head.comment=null);t.mode=16188;case 16188:if(512&dc(t)){for(;p<16;){if(c===0)break e;c--,u+=n[s++]<<p,p+=8}if(4&t.wrap&&u!==(65535&t.check)){r.msg="header crc mismatch",t.mode=ao;break}u=0,p=0}t.head&&(t.head.hcrc=dc(t)>>9&1,t.head.done=!0),r.adler=t.check=0,t.mode=Lh;break;case 16189:for(;p<32;){if(c===0)break e;c--,u+=n[s++]<<p,p+=8}r.adler=t.check=vo(u),u=0,p=0,t.mode=Gv;case Gv:if(t.havedict===0)return r.next_out=o,r.avail_out=d,r.next_in=s,r.avail_in=c,t.hold=u,t.bits=p,kY;r.adler=t.check=1,t.mode=Lh;case Lh:if(e===c6||e===ck)break e;case mf:if(t.last){u>>>=7&p,p-=7&p,t.mode=Sb;break}for(;p<3;){if(c===0)break e;c--,u+=n[s++]<<p,p+=8}switch(t.last=1&u,u>>>=1,p-=1,3&u){case 0:t.mode=16193;break;case 1:if(h6(t),t.mode=gb,e===ck){u>>>=2,p-=2;break e}break;case 2:t.mode=16196;break;case 3:r.msg="invalid block type",t.mode=ao}u>>>=2,p-=2;break;case 16193:for(u>>>=7&p,p-=7&p;p<32;){if(c===0)break e;c--,u+=n[s++]<<p,p+=8}if((65535&u)!=(u>>>16^65535)){r.msg="invalid stored block lengths",t.mode=ao;break}if(t.length=65535&u,u=0,p=0,t.mode=O0,e===ck)break e;case O0:t.mode=16195;case 16195:if(T=t.length,T){if(T>c&&(T=c),T>d&&(T=d),T===0)break e;i.set(n.subarray(s,s+T),o),c-=T,s+=T,d-=T,o+=T,t.length-=T;break}t.mode=Lh;break;case 16196:for(;p<14;){if(c===0)break e;c--,u+=n[s++]<<p,p+=8}if(t.nlen=257+(31&u),u>>>=5,p-=5,t.ndist=1+(31&u),u>>>=5,p-=5,t.ncode=4+(15&u),u>>>=4,p-=4,t.nlen>286||t.ndist>30){r.msg="too many length or distance symbols",t.mode=ao;break}t.have=0,t.mode=16197;case 16197:for(;t.have<t.ncode;){for(;p<3;){if(c===0)break e;c--,u+=n[s++]<<p,p+=8}t.lens[_t[t.have++]]=7&u,u>>>=3,p-=3}for(;t.have<19;)t.lens[_t[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,ge={bits:t.lenbits},Y=A0(0,t.lens,0,19,t.lencode,0,t.work,ge),t.lenbits=ge.bits,Y){r.msg="invalid code lengths set",t.mode=ao;break}t.have=0,t.mode=16198;case 16198:for(;t.have<t.nlen+t.ndist;){for(;se=t.lencode[u&(1<<t.lenbits)-1],A=se>>>24,w=se>>>16&255,k=65535&se,!(A<=p);){if(c===0)break e;c--,u+=n[s++]<<p,p+=8}if(k<16)u>>>=A,p-=A,t.lens[t.have++]=k;else{if(k===16){for(je=A+2;p<je;){if(c===0)break e;c--,u+=n[s++]<<p,p+=8}if(u>>>=A,p-=A,t.have===0){r.msg="invalid bit length repeat",t.mode=ao;break}W=t.lens[t.have-1],T=3+(3&u),u>>>=2,p-=2}else if(k===17){for(je=A+3;p<je;){if(c===0)break e;c--,u+=n[s++]<<p,p+=8}u>>>=A,p-=A,W=0,T=3+(7&u),u>>>=3,p-=3}else{for(je=A+7;p<je;){if(c===0)break e;c--,u+=n[s++]<<p,p+=8}u>>>=A,p-=A,W=0,T=11+(127&u),u>>>=7,p-=7}if(t.have+T>t.nlen+t.ndist){r.msg="invalid bit length repeat",t.mode=ao;break}for(;T--;)t.lens[t.have++]=W}}if(t.mode===ao)break;if(t.lens[256]===0){r.msg="invalid code -- missing end-of-block",t.mode=ao;break}if(t.lenbits=9,ge={bits:t.lenbits},Y=A0(1,t.lens,0,t.nlen,t.lencode,0,t.work,ge),t.lenbits=ge.bits,Y){r.msg="invalid literal/lengths set",t.mode=ao;break}if(t.distbits=6,t.distcode=t.distdyn,ge={bits:t.distbits},Y=A0(2,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,ge),t.distbits=ge.bits,Y){r.msg="invalid distances set",t.mode=ao;break}if(t.mode=gb,e===ck)break e;case gb:t.mode=Wv;case Wv:if(c>=6&&d>=258){r.next_out=o,r.avail_out=d,r.next_in=s,r.avail_in=c,t.hold=u,t.bits=p,sk(r,g),o=r.next_out,i=r.output,d=r.avail_out,s=r.next_in,n=r.input,c=r.avail_in,u=t.hold,p=t.bits,t.mode===Lh&&(t.back=-1);break}for(t.back=0;se=t.lencode[u&(1<<t.lenbits)-1],A=se>>>24,w=se>>>16&255,k=65535&se,!(A<=p);){if(c===0)break e;c--,u+=n[s++]<<p,p+=8}if(w&&!(240&w)){for(L=A,j=w,K=k;se=t.lencode[K+((u&(1<<L+j)-1)>>L)],A=se>>>24,w=se>>>16&255,k=65535&se,!(L+A<=p);){if(c===0)break e;c--,u+=n[s++]<<p,p+=8}u>>>=L,p-=L,t.back+=L}if(u>>>=A,p-=A,t.back+=A,t.length=k,w===0){t.mode=16205;break}if(32&w){t.back=-1,t.mode=Lh;break}if(64&w){r.msg="invalid literal/length code",t.mode=ao;break}t.extra=15&w,t.mode=16201;case 16201:if(t.extra){for(je=t.extra;p<je;){if(c===0)break e;c--,u+=n[s++]<<p,p+=8}t.length+=u&(1<<t.extra)-1,u>>>=t.extra,p-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=16202;case 16202:for(;se=t.distcode[u&(1<<t.distbits)-1],A=se>>>24,w=se>>>16&255,k=65535&se,!(A<=p);){if(c===0)break e;c--,u+=n[s++]<<p,p+=8}if(!(240&w)){for(L=A,j=w,K=k;se=t.distcode[K+((u&(1<<L+j)-1)>>L)],A=se>>>24,w=se>>>16&255,k=65535&se,!(L+A<=p);){if(c===0)break e;c--,u+=n[s++]<<p,p+=8}u>>>=L,p-=L,t.back+=L}if(u>>>=A,p-=A,t.back+=A,64&w){r.msg="invalid distance code",t.mode=ao;break}t.offset=k,t.extra=15&w,t.mode=16203;case 16203:if(t.extra){for(je=t.extra;p<je;){if(c===0)break e;c--,u+=n[s++]<<p,p+=8}t.offset+=u&(1<<t.extra)-1,u>>>=t.extra,p-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){r.msg="invalid distance too far back",t.mode=ao;break}t.mode=16204;case 16204:if(d===0)break e;if(T=g-d,t.offset>T){if(T=t.offset-T,T>t.whave&&t.sane){r.msg="invalid distance too far back",t.mode=ao;break}T>t.wnext?(T-=t.wnext,R=t.wsize-T):R=t.wnext-T,T>t.length&&(T=t.length),I=t.window}else I=i,R=o-t.offset,T=t.length;T>d&&(T=d),d-=T,t.length-=T;do i[o++]=I[R++];while(--T);t.length===0&&(t.mode=Wv);break;case 16205:if(d===0)break e;i[o++]=t.length,d--,t.mode=Wv;break;case Sb:if(t.wrap){for(;p<32;){if(c===0)break e;c--,u|=n[s++]<<p,p+=8}if(g-=d,r.total_out+=g,t.total+=g,4&t.wrap&&g&&(r.adler=t.check=dc(t)?Cc(t.check,i,g,o-g):T0(t.check,i,g,o-g)),g=d,4&t.wrap&&(dc(t)?u:vo(u))!==t.check){r.msg="incorrect data check",t.mode=ao;break}u=0,p=0}t.mode=16207;case 16207:if(t.wrap&&dc(t)){for(;p<32;){if(c===0)break e;c--,u+=n[s++]<<p,p+=8}if(4&t.wrap&&u!==(4294967295&t.total)){r.msg="incorrect length check",t.mode=ao;break}u=0,p=0}t.mode=16208;case 16208:Y=jv;break e;case ao:Y=Pu;break e;case 16210:return ZB;default:return kh}return r.next_out=o,r.avail_out=d,r.next_in=s,r.avail_in=c,t.hold=u,t.bits=p,(t.wsize||g!==r.avail_out&&t.mode<ao&&(t.mode<Sb||e!==Eb))&&p6(r,r.output,r.next_out,g-r.avail_out),m-=r.avail_in,g-=r.avail_out,r.total_in+=m,r.total_out+=g,t.total+=g,4&t.wrap&&g&&(r.adler=t.check=dc(t)?Cc(t.check,i,g,r.next_out-g):T0(t.check,i,g,r.next_out-g)),r.data_type=t.bits+(t.last?64:0)+(t.mode===Lh?128:0)+(t.mode===gb||t.mode===O0?256:0),(m===0&&g===0||e===Eb)&&Y===L_&&(Y=l6),Y},aE={inflateReset:$B,inflateReset2:ej,inflateResetKeep:uS,inflateInit:r=>tj(r,15),inflateInit2:tj,inflate:f6,inflateEnd:r=>{if(Hv(r))return kh;let e=r.state;return e.window&&(e.window=null),r.state=null,L_},inflateGetHeader:(r,e)=>{if(Hv(r))return kh;let t=r.state;return 2&t.wrap?(t.head=e,e.done=!1,L_):kh},inflateSetDictionary:(r,e)=>{let t=e.length,n,i,s;return Hv(r)?kh:(n=r.state,n.wrap!==0&&n.mode!==Gv?kh:n.mode===Gv&&(i=1,i=T0(i,e,t,0),i!==n.check)?Pu:(s=p6(r,e,t,t),s?(n.mode=16210,ZB):(n.havedict=1,L_)))},inflateInfo:"pako inflate (from Nodeca project)"},cE=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};let _6=Object.prototype.toString,{Z_NO_FLUSH:m6,Z_FINISH:LY,Z_OK:D0,Z_STREAM_END:Kv,Z_NEED_DICT:P0,Z_STREAM_ERROR:nj,Z_DATA_ERROR:E6,Z_MEM_ERROR:g6}=P_;function uk(r){this.options=$P.assign({chunkSize:65536,windowBits:15,to:""},r||{});let e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||r&&r.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&!(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new mb,this.strm.avail_out=0;let t=aE.inflateInit2(this.strm,e.windowBits);if(t!==D0)throw new Error(Uo[t]);if(this.header=new cE,aE.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=oE.string2buf(e.dictionary):_6.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(t=aE.inflateSetDictionary(this.strm,e.dictionary),t!==D0)))throw new Error(Uo[t])}function hk(r,e){let t=new uk(e);if(t.push(r),t.err)throw t.msg||Uo[t.err];return t.result}uk.prototype.push=function(r,e){let t=this.strm,n=this.options.chunkSize,i=this.options.dictionary,s,o,c;if(this.ended)return!1;for(o=e===~~e?e:e===!0?LY:m6,_6.call(r)==="[object ArrayBuffer]"?t.input=new Uint8Array(r):t.input=r,t.next_in=0,t.avail_in=t.input.length;;){for(t.avail_out===0&&(t.output=new Uint8Array(n),t.next_out=0,t.avail_out=n),s=aE.inflate(t,o),s===P0&&i&&(s=aE.inflateSetDictionary(t,i),s===D0?s=aE.inflate(t,o):s===E6&&(s=P0));t.avail_in>0&&s===Kv&&t.state.wrap>0&&r[t.next_in]!==0;)aE.inflateReset(t),s=aE.inflate(t,o);switch(s){case nj:case E6:case P0:case g6:return this.onEnd(s),this.ended=!0,!1}if(c=t.avail_out,t.next_out&&(t.avail_out===0||s===Kv))if(this.options.to==="string"){let d=oE.utf8border(t.output,t.next_out),u=t.next_out-d,p=oE.buf2string(t.output,d);t.next_out=u,t.avail_out=n-u,u&&t.output.set(t.output.subarray(d,d+u),0),this.onData(p)}else this.onData(t.output.length===t.next_out?t.output:t.output.subarray(0,t.next_out));if(s!==D0||c!==0){if(s===Kv)return s=aE.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(t.avail_in===0)break}}return!0},uk.prototype.onData=function(r){this.chunks.push(r)},uk.prototype.onEnd=function(r){r===D0&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=$P.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};var MY={inflate:hk};let{deflate:UY}=OY,{inflate:xY}=MY;var VY=UY,FY=xY,S6=(function(r){return r[r.ONE_BYTE=0]="ONE_BYTE",r[r.TWO_BYTE=1]="TWO_BYTE",r})(S6||{});class T6{constructor(){Z(this,"_sequence",0),Z(this,"_startTime",Date.now()),Z(this,"isUseOneByte",!0)}get startTime(){let e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){let t={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){let c=new Uint8Array(4);c.set([1,0,0,0]);let d={id:0,length:4,data:c.buffer},u={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[d]};t.commonPacketHeader.extension=1,t.extension=u,t.payload=this.compress(e),t.commonPacketHeader.length=8+(t.extension.length+2)+t.payload.byteLength}else t.commonPacketHeader.length=8+t.payload.byteLength;te("SHOW_DATASTREAM2_LOG")&&V.debug("send data header: ".concat(JSON.stringify(t.commonPacketHeader)));let n=new ArrayBuffer(t.commonPacketHeader.length),i=new Uint8Array(n),s=new DataView(n),o=0;if(s.setUint16(o,t.commonPacketHeader.extension<<15|t.commonPacketHeader.reserved<<14|t.commonPacketHeader.length,!0),o+=2,s.setUint32(o,t.commonPacketHeader.sequence,!0),o+=4,s.setUint16(o,t.commonStreamHeader,!0),o+=2,t.extension){let c=this.serializeExtension(t.extension);i.set(new Uint8Array(c),o),o+=c.byteLength}if(i.set(new Uint8Array(t.payload),o),o+=t.payload.byteLength,o!==t.commonPacketHeader.length)throw Error("serialize error!");return n}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);let t=new DataView(e),n=0,i=t.getUint16(n,!0);n+=2;let s={length:16383&i,reserved:(16384&i)>>14,extension:(32768&i)>>15,sequence:t.getUint16(n+2,!0)<<16|t.getUint16(n,!0)},o,c;if(n+=4,te("SHOW_DATASTREAM2_LOG")&&V.debug("receive data header: ".concat(JSON.stringify(s))),t.getUint16(n,!0),n+=2,s.extension){c=this.deserializeExtension(e.slice(n)),n+=2+c.length,o=e.slice(n);let d=!1;if(c.datas.length>0){let u=c.datas.find(p=>p.id===0);u&&(d=(1&new DataView(u.data).getUint32(0,!0))==1)}o=d?this.decompress(o):o}else o=e.slice(8);return o}serializeExtension(e){let{profile:t,length:n,datas:i}=e,s=new ArrayBuffer(n+2),o=new Uint8Array(s),c=new DataView(s),d=0;if(c.setUint8(d++,t),c.setUint8(d++,n),i.forEach(u=>{t?(c.setUint8(d++,u.id),c.setUint8(d++,u.length),o.set(new Uint8Array(u.data),d),d+=u.data.byteLength):(c.setUint8(d++,u.id|u.length<<4),o.set(new Uint8Array(u.data),d),d+=u.data.byteLength)}),d!==n+2)throw Error("serialize extension error, is ".concat(d,"!==").concat(n+2));return s}deserializeExtension(e){let t=new DataView(e),n=0,i=t.getUint8(n);n++;let s=t.getUint8(n);n++;let o=i===S6.TWO_BYTE,c=[],d=new DataView(e,2),u=0;for(;u<s;){let p=0,m=0,g=new ArrayBuffer(0);o?(p=d.getUint8(u),u++,m=d.getUint8(u),u++):(p=15&d.getUint8(u),m=d.getUint8(u)>>4,u++),m>0&&(g=d.buffer.slice(u+2,u+2+m),u+=g.byteLength),c.push({id:p,length:m,data:g})}if(u!==s)throw Error("parse error");return{profile:i,length:s,datas:c}}decompress(e){return FY(new Uint8Array(e))}compress(e){return VY(new Uint8Array(e))}}let BY={name:"DataStream",create:(r,e)=>{let t=e?new v4(r):new Rz(r);return t.useDataStream(new T6),t}};class jY extends Sr{constructor(e,t,n){super(),Z(this,"ws",void 0),Z(this,"requestId",1),Z(this,"heartBeatTimer",void 0),Z(this,"joinInfo",void 0),Z(this,"clientId",void 0),Z(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),Z(this,"onClose",i=>{this.emit("close"),this.dispose()}),Z(this,"onMessage",i=>{let s=JSON.parse(i.data);if(!s||s.command!=="serverResponse"||!s.requestId)return s&&s.command==="serverStatus"&&s.serverStatus&&s.serverStatus.command?(this.emit("status",s.serverStatus),void this.emit(s.serverStatus.command,s.serverStatus)):void 0;this.emit("req_".concat(s.requestId),s)}),this.joinInfo=e,this.clientId=t,this.ws=new Ov("cross-channel-".concat(this.clientId),n),this.ws.on(Wt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Wt.CONNECTED,this.onOpen),this.ws.on(Wt.ON_MESSAGE,this.onMessage),this.ws.on(Wt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){let t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new De((t,n)=>{let i=window.setTimeout(()=>{n(new fe(z.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,s=>{window.clearTimeout(i),s.state&&s.state!==0?n(new fe(z.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)}),this.once("dispose",()=>{window.clearTimeout(i),n(new fe(z.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new fe(z.WS_DISCONNECT);let t=()=>new De((o,c)=>{this.ws.once(Wt.CLOSED,()=>c(new fe(z.WS_ABORT))),this.ws.once(Wt.CONNECTED,o)});this.ws.state!=="connected"&&await t();let n=this.sendMessage(e),i=new De((o,c)=>{let d=()=>{c(new fe(z.WS_ABORT))};this.ws.once(Wt.RECONNECTING,d),this.ws.once(Wt.CLOSED,d),this.once("req_".concat(n),o),Jo(3e3).then(()=>{this.removeAllListeners("req_".concat(n)),this.ws.off(Wt.RECONNECTING,d),this.ws.off(Wt.CLOSED,d),c(new fe(z.TIMEOUT,"cross channel ws request timeout"))})}),s=await i;if(!s||s.code!==200)throw new fe(z.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(s)));return s}async connect(e){this.ws.removeAllListeners(Wt.REQUEST_NEW_URLS),this.ws.on(Wt.REQUEST_NEW_URLS,t=>{t(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){let t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class GY extends Sr{set state(e){e!==this._state&&(e!==ko.RELAY_STATE_FAILURE&&(this.errorCode=wa.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,t,n,i,s){super(),Z(this,"joinInfo",void 0),Z(this,"sid",void 0),Z(this,"clientId",void 0),Z(this,"cancelToken",Er.CancelToken.source()),Z(this,"workerToken",void 0),Z(this,"requestId",0),Z(this,"signal",void 0),Z(this,"prevChannelMediaConfig",void 0),Z(this,"httpRetryConfig",void 0),Z(this,"_resolution",void 0),Z(this,"_state",ko.RELAY_STATE_IDLE),Z(this,"errorCode",wa.RELAY_OK),Z(this,"onStatus",o=>{V.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(o))),o&&o.command&&(o.command==="onAudioPacketReceived"&&this.emit("event",oo.PACKET_RECEIVED_AUDIO_FROM_SRC),o.command==="onVideoPacketReceived"&&this.emit("event",oo.PACKET_RECEIVED_VIDEO_FROM_SRC),o.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=wa.SRC_TOKEN_EXPIRED,this.state=ko.RELAY_STATE_FAILURE),o.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=wa.DEST_TOKEN_EXPIRED,this.state=ko.RELAY_STATE_FAILURE))}),Z(this,"onReconnect",async()=>{V.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",oo.NETWORK_DISCONNECTED),this.state=ko.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(o=>{this.state!==ko.RELAY_STATE_IDLE&&(V.error("auto restart channel media relay failed",o.toString()),this.errorCode=wa.SERVER_CONNECTION_LOST,this.state=ko.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=t,this.sid=Oi(),this.signal=new jY(this.joinInfo,this.clientId,n),this.httpRetryConfig=i,this._resolution=s}async startChannelMediaRelay(e){if(this.state!==ko.RELAY_STATE_IDLE)throw new fe(z.INVALID_OPERATION);this.state=ko.RELAY_STATE_CONNECTING,await this.connect(),V.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(t){throw t.data&&t.data.serverResponse&&t.data.serverResponse.command==="SetSourceChannel"?new fe(z.CROSS_CHANNEL_FAILED_JOIN_SRC):t.data&&t.data.serverResponse&&t.serverResponse.command==="SetDestChannelStatus"?new fe(z.CROSS_CHANNEL_FAILED_JOIN_DEST):t.data&&t.data.serverResponse&&t.serverResponse.command==="StartPacketTransfer"?new fe(z.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):t}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==ko.RELAY_STATE_RUNNING)throw new fe(z.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==ko.RELAY_STATE_RUNNING)throw new fe(z.INVALID_OPERATION);let t=this.genMessage(ac.SetVideoProfile);await this.signal.request(t),V.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),V.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=ko.RELAY_STATE_IDLE,this.dispose()}dispose(){V.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Er.CancelToken.source(),this.state=ko.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let e=await j4(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",oo.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){let t=this.genMessage(ac.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),V.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));let n=this.genMessage(ac.SetSdkProfile,e);await this.signal.request(n),V.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let i=this.genMessage(ac.SetSourceChannel,e);await this.signal.request(i),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",oo.PACKET_JOINED_SRC_CHANNEL),V.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let s=this.genMessage(ac.SetSourceUserId,e);await this.signal.request(s),V.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let o=this.genMessage(ac.SetDestChannel,e);await this.signal.request(o),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",oo.PACKET_JOINED_DEST_CHANNEL),V.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let c=this.genMessage(ac.StartPacketTransfer,e);await this.signal.request(c),this.emit("event",oo.PACKET_SENT_TO_DEST_CHANNEL),this.state=ko.RELAY_STATE_RUNNING,V.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){let t=this.genMessage(ac.UpdateDestChannel,e);await this.signal.request(t),this.emit("event",oo.PACKET_UPDATE_DEST_CHANNEL),V.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let e=this.genMessage(ac.StopPacketTransfer);await this.signal.request(e),V.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){let n=[],i=[],s=[];this.requestId+=1;let o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Yl,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};o.sdkVersion==="4.24.0"&&(o.sdkVersion="0.0.1");let c=null,d=null;switch(e){case ac.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case ac.SetSourceChannel:if(d=t&&t.getSrcChannelMediaInfo(),!d)throw new fe(z.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:d.channelName,token:d.token||this.joinInfo.appId},o;case ac.SetSourceUserId:if(d=t&&t.getSrcChannelMediaInfo(),!d)throw new fe(z.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:d.uid+""},o;case ac.SetDestChannel:if(c=t&&t.getDestChannelMediaInfo(),!c)throw new fe(z.UNEXPECTED_ERROR,"can not find dest config");return c.forEach(u=>{n.push(u.channelName),i.push(u.uid+""),s.push(u.token||this.joinInfo.appId)}),o.clientRequest={command:"SetDestChannel",channelName:n,uid:i,token:s},o;case ac.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case ac.Reconnect:return o.clientRequest={command:"Reconnect"},o;case ac.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case ac.UpdateDestChannel:if(c=t&&t.getDestChannelMediaInfo(),!c)throw new fe(z.UNEXPECTED_ERROR,"can not find dest config");return c.forEach(u=>{n.push(u.channelName),i.push(u.uid+""),s.push(u.token||this.joinInfo.appId)}),o.clientRequest={command:"UpdateDestChannel",channelName:n,uid:i,token:s},o;case ac.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o}}let WY={name:"ChannelMediaRelay",create:function(r){return new GY(r.joinInfo,r.clientId,r.websocketRetryConfig||zr,r.httpRetryConfig||zr,r.resolution)}};function v6(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Tb(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?v6(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):v6(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}class k0 extends Sr{constructor(e,t,n,i){super(),Z(this,"spec",void 0),Z(this,"token",void 0),Z(this,"websocket",void 0),Z(this,"pingpongTimer",void 0),Z(this,"reconnectMode","retry"),Z(this,"serviceMode",void 0),Z(this,"reqId",0),Z(this,"commandReqId",0),Z(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),Z(this,"handleWebSocketMessage",s=>{if(!s.data)return;let o=JSON.parse(s.data);o.requestId?this.emit("@".concat(o.requestId,"-").concat(o.sid),o):(Ye.workerEvent(this.spec.sid,{actionType:"status",serverCode:o.code,workerType:this.serviceMode===Ch.TRANSCODE?1:2}),this.emit(qg.PUBLISH_STREAM_STATUS,o))}),this.spec=t,this.token=e,this.serviceMode=i,this.websocket=new Ov("live-streaming",n),this.websocket.on(Wt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Wt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Wt.REQUEST_NEW_URLS,(s,o)=>{Ys(this,qg.REQUEST_NEW_ADDRESS).then(s).catch(o)}),this.websocket.on(Wt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,t,n,i){this.reqId+=1,e==="request"&&(this.commandReqId+=1);let s=this.commandReqId,o=this.reqId;if(!o||!this.websocket)throw new fe(z.UNEXPECTED_ERROR);let c=Tb({command:e,sdkVersion:Yl==="4.24.0"?"0.0.1":Yl,seq:o,requestId:o,allocate:n,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t);if(this.websocket.state==="closed")throw new fe(z.WS_DISCONNECT);let d=()=>new De((g,T)=>{this.websocket.once(Wt.CLOSED,()=>T(new fe(z.WS_ABORT))),this.websocket.once(Wt.CONNECTED,g)});this.websocket.state!=="connected"&&await d(),c.clientRequest&&(c.clientRequest.workerToken=this.token);let u=new De((g,T)=>{let R=()=>{T(new fe(z.WS_ABORT))};this.websocket.once(Wt.RECONNECTING,R),this.websocket.once(Wt.CLOSED,R),this.once("@".concat(o,"-").concat(this.spec.sid),I=>{g(I)})});i&&Ye.workerEvent(this.spec.sid,Tb(Tb({},i),{},{requestId:s,actionType:"request",payload:JSON.stringify(t.clientRequest),serverCode:0,code:0}));let p=Date.now();this.websocket.sendMessage(c);let m=null;try{m=await u}catch(g){if(this.websocket.state==="closed")throw g;return await d(),await this.request(e,t,n)}return i&&Ye.workerEvent(this.spec.sid,Tb(Tb({},i),{},{requestId:s,actionType:"response",payload:JSON.stringify(m.serverResponse),serverCode:m.code,success:m.code===200,responseTime:Date.now()-p})),m.code!==200&&this.handleResponseError(m),m}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let e=Yl==="4.24.0"?"0.0.1":Yl;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case Is.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void V.warning("live stream response already exists stream");case Is.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Is.LIVE_STREAM_RESPONSE_BAD_STREAM:case Is.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new fe(z.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case Is.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream")return;throw new fe(z.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Is.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new fe(z.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case Is.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let t=new fe(z.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(qg.WARNING,t,e.serverResponse.url)}case Is.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let t=new fe(z.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(qg.WARNING,t,e.serverResponse.url)}case Is.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new fe(z.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Is.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new fe(z.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case Is.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let t=new fe(z.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(qg.WARNING,t,e.serverResponse.url)}case Is.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new fe(z.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case Is.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new fe(z.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Is.LIVE_STREAM_RESPONSE_WORKER_LOST:case Is.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream")return;throw new fe(z.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Is.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new fe(z.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new fe(z.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Is.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Is.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Is.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Is.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new fe(z.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(__)},6e3)}}function y6(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Yc(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?y6(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):y6(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}class yl extends Sr{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:zr,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:zr;super(),Z(this,"onLiveStreamWarning",void 0),Z(this,"onLiveStreamError",void 0),Z(this,"spec",void 0),Z(this,"retryTimeout",1e4),Z(this,"connection",void 0),Z(this,"httpRetryConfig",void 0),Z(this,"wsRetryConfig",void 0),Z(this,"streamingTasks",new Map),Z(this,"isStartingStreamingTask",!1),Z(this,"taskMutex",new ha("live-streaming")),Z(this,"cancelToken",Er.CancelToken.source()),Z(this,"transcodingConfig",void 0),Z(this,"uapResponse",void 0),Z(this,"lastTaskId",1),Z(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=n,this.wsRetryConfig=t}async setTranscodingConfig(e){let t=Yc(Yc({},XV),e);t.videoCodecProfile!==66&&t.videoCodecProfile!==77&&t.videoCodecProfile!==100&&(V.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(t.videoCodecProfile," -> 100")),t.videoCodecProfile=100),t.transcodingUsers||(t.transcodingUsers=t.userConfigs),t.transcodingUsers&&(t.transcodingUsers=t.transcodingUsers.map(o=>Yc(Yc(Yc({},Wm),o),{},{zOrder:o.zOrder?o.zOrder+1:1}))),(function(o){Hi(o.width)||Tn(o.width,"config.width",0,1e4),Hi(o.height)||Tn(o.height,"config.height",0,1e4),Hi(o.videoBitrate)||Tn(o.videoBitrate,"config.videoBitrate",1,1e6),Hi(o.videoFrameRate)||Tn(o.videoFrameRate,"config.videoFrameRate"),Hi(o.lowLatency)||Ge(o.lowLatency,"config.lowLatency"),Hi(o.audioSampleRate)||gr(o.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Hi(o.audioBitrate)||Tn(o.audioBitrate,"config.audioBitrate",1,128),Hi(o.audioChannels)||gr(o.audioChannels,"config.audioChannels",[1,2,3,4,5]),Hi(o.videoGop)||Tn(o.videoGop,"config.videoGop"),Hi(o.videoCodecProfile)||gr(o.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Hi(o.userCount)||Tn(o.userCount,"config.userCount",0,17),Hi(o.backgroundColor)||Tn(o.backgroundColor,"config.backgroundColor",0,16777215),Hi(o.userConfigExtraInfo)||Eo(o.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),o.transcodingUsers&&!Hi(o.transcodingUsers)&&(ls(o.transcodingUsers,"config.transcodingUsers"),o.transcodingUsers.forEach((c,d)=>{wv(c.uid),Hi(c.x)||Tn(c.x,"transcodingUser[".concat(d,"].x"),0,1e4),Hi(c.y)||Tn(c.y,"transcodingUser[".concat(d,"].y"),0,1e4),Hi(c.width)||Tn(c.width,"transcodingUser[".concat(d,"].width"),0,1e4),Hi(c.height)||Tn(c.height,"transcodingUser[".concat(d,"].height"),0,1e4),Hi(c.zOrder)||Tn(c.zOrder-1,"transcodingUser[".concat(d,"].zOrder"),0,100),Hi(c.alpha)||Tn(c.alpha,"transcodingUser[".concat(d,"].alpha"),0,1,!1)})),Hi(o.watermark)||zw(o.watermark,"watermark"),Hi(o.backgroundImage)||zw(o.backgroundImage,"backgroundImage"),o.images&&!Hi(o.images)&&(ls(o.images,"config.images"),o.images.forEach((c,d)=>{zw(c,"images[".concat(d,"]"))}))})(t);let n=[];t.images&&n.push(...t.images.map(o=>Yc(Yc(Yc({},qV),o),{},{zOrder:255}))),t.backgroundImage&&(n.push(Yc(Yc(Yc({},qV),t.backgroundImage),{},{zOrder:0})),delete t.backgroundImage),t.watermark&&(n.push(Yc(Yc(Yc({},qV),t.watermark),{},{zOrder:255})),delete t.watermark),t.images=n,t.transcodingUsers&&(t.userConfigs=t.transcodingUsers.map(o=>Yc({},o)),t.userCount=t.transcodingUsers.length,delete t.transcodingUsers);let i=(t.userConfigs||[]).map(o=>typeof o.uid=="number"?De.resolve(o.uid):TF(o.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await De.all(i)).forEach((o,c)=>{t.userConfigs&&t.userConfigs[c]&&(t.userConfigs[c].uid=o)}),this.transcodingConfig=t,this.connection)try{var s;let o=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(cs(s=this.streamingTasks).call(s)).map(c=>c.taskId).join("#")});V.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(o.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(o){if(!o.data||!o.data.retry)throw o;o.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(c=>{V.warning("[".concat(this.spec.clientId,"] live streaming receive error"),o.toString(),"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,o).then(()=>{V.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(c.url," success"))}).catch(d=>{V.error("[".concat(this.spec.clientId,"] live streaming republish failed"),c.url,d.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,d)})})}}async startLiveStreamingTask(e,t,n){if(!this.transcodingConfig&&t===Ch.TRANSCODE)throw new fe(z.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let i={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};V.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(t));let s=await this.taskMutex.lock();if(!this.connection&&n)return void s();if(this.streamingTasks.get(e)&&!n)return s(),new fe(z.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(c){throw s(),c}switch(t){case Ch.TRANSCODE:i.transcodingConfig=Yc({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let o=this.lastTaskId++;try{let c=new De((u,p)=>{Jo(this.retryTimeout).then(()=>{if(n)return p(n);let m=this.statusError.get(e);return m?(this.statusError.delete(e),p(m)):void 0})}),d=await De.race([this.connection.request("request",{clientRequest:i},!0,{url:e,command:"PublishStream",workerType:t===Ch.TRANSCODE?1:2,requestByUser:!n,tid:o.toString()}),c]);this.isStartingStreamingTask=!1,V.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(d.code)),this.streamingTasks.set(e,{clientRequest:i,mode:t,url:e,taskId:o}),s()}catch(c){if(s(),this.isStartingStreamingTask=!1,!c.data||!c.data.retry||n)throw c;return c.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,c)):await this.startLiveStreamingTask(e,t,c)}}stopLiveStreamingTask(e){return new De((t,n)=>{let i=this.streamingTasks.get(e);if(!i||!this.connection)return new fe(z.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let s=i.mode;i.abortTask=()=>{V.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:i.url}},!1,{url:e,command:"UnPublishStream",workerType:s===Ch.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(o=>{V.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(o.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),t()}).catch(n)})}resetAllTask(){var e;let t=Array.from(cs(e=this.streamingTasks).call(e));this.terminate();for(let n of t)this.startLiveStreamingTask(n.url,n.mode).catch(i=>{this.onLiveStreamError&&this.onLiveStreamError(n.url,i)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Er.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new fe(z.UNEXPECTED_ERROR,"live streaming connection has already connected");let t=await Ys(this,S_.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new k0(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(qg.WARNING,(n,i)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(i,n)),this.connection.on(qg.PUBLISH_STREAM_STATUS,n=>this.handlePublishStreamServer(n)),this.connection.on(qg.REQUEST_NEW_ADDRESS,(n,i)=>{if(!this.connection)return i(new fe(z.UNEXPECTED_ERROR,"can not get new live streaming address list"));Ys(this,S_.REQUEST_WORKER_MANAGER_LIST,e).then(s=>{this.uapResponse=s,n(s.addressList)}).catch(i)}),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){let t=e.serverStatus&&e.serverStatus.url||"empty_url",n=this.streamingTasks.get(t),i=e.reason;switch(e.code){case Is.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Is.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Is.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Is.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let o=new fe(z.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(n)return V.error(o.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,o);if(!this.isStartingStreamingTask)return;this.statusError.set(t,o)}case Is.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let o=new fe(z.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(t,o)}case Is.LIVE_STREAM_RESPONSE_WORKER_LOST:case Is.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var s;if(!this.connection)return;this.connection.tryNextAddress();let o=Array.from(cs(s=this.streamingTasks).call(s));for(let c of o)c.abortTask?c.abortTask():(V.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",c.url),this.startLiveStreamingTask(c.url,c.mode,new fe(z.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{V.debug("[".concat(this.spec.clientId,"] republish live stream success"),c.url)}).catch(d=>{V.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(c.url,d)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}}let HY={name:"LiveStreaming",create:function(r){return new yl(r.joinInfo,r.websocketRetryConfig||zr,r.httpRetryConfig||zr)}};function KY(r){let e=rj();return(function(t,n){let i=t.appId;i!==void 0&&(li(n,10),Ef(n,i));let s=t.cid;s!==void 0&&(li(n,16),li(n,s));let o=t.cname;o!==void 0&&(li(n,26),Ef(n,o));let c=t.deviceId;c!==void 0&&(li(n,34),Ef(n,c));let d=t.elapse;d!==void 0&&(li(n,40),gi(n,d));let u=t.fileSize;u!==void 0&&(li(n,48),gi(n,Na(u)));let p=t.height;p!==void 0&&(li(n,56),gi(n,Na(p)));let m=t.jpg;m!==void 0&&(li(n,66),li(n,m.length),(function(mn,We){let Se=Yv(mn,We.length);mn.bytes.set(We,Se)})(n,m));let g=t.networkType;g!==void 0&&(li(n,72),gi(n,Na(g)));let T=t.osType;T!==void 0&&(li(n,80),gi(n,Na(T)));let R=t.requestId;R!==void 0&&(li(n,90),Ef(n,R));let I=t.sdkVersion;I!==void 0&&(li(n,98),Ef(n,I));let A=t.sequence;A!==void 0&&(li(n,104),gi(n,Na(A)));let w=t.sid;w!==void 0&&(li(n,114),Ef(n,w));let k=t.timestamp;k!==void 0&&(li(n,120),gi(n,k));let L=t.uid;L!==void 0&&(li(n,128),li(n,L));let j=t.vid;j!==void 0&&(li(n,136),li(n,j));let K=t.width;K!==void 0&&(li(n,144),gi(n,Na(K)));let W=t.service;W!==void 0&&(li(n,152),li(n,W));let Y=t.callbackData;Y!==void 0&&(li(n,162),Ef(n,Y));let se=t.jpgEncryption;se!==void 0&&(li(n,168),li(n,se));let de=t.requestType;de!==void 0&&(li(n,176),li(n,de));let ge=t.scorePorn;ge!==void 0&&(li(n,185),L0(n,ge));let je=t.scoreSexy;je!==void 0&&(li(n,193),L0(n,je));let _t=t.scoreNeutral;_t!==void 0&&(li(n,201),L0(n,_t));let ht=t.scene;ht!==void 0&&(li(n,208),li(n,ht));let Ct=t.ossFilePrefix;Ct!==void 0&&(li(n,218),Ef(n,Ct));let Ft=t.serviceVendor;if(Ft!==void 0)for(let mn of Ft){li(n,226);let We=rj();qY(mn,We),li(n,We.limit),M_(n,We),b6(We)}})(r,e),(function(t){let n=t.bytes,i=t.limit;return n.length===i?n:n.subarray(0,i)})(e)}function zY(r){return(function(t){let n={};e:for(;!pk(t);){let i=Mh(t);switch(i>>>3){case 0:break e;case 1:n.code=Mh(t);break;case 2:n.msg=fk(t,Mh(t));break;case 3:{let s=XY(t);n.data=YY(t),t.limit=s;break}default:R6(t,7&i)}}return n})({bytes:e=r,offset:0,limit:e.length});var e}function YY(r){let e={};e:for(;!pk(r);){let t=Mh(r);switch(t>>>3){case 0:break e;case 1:e.requestId=fk(r,Mh(r));break;case 2:e.requestType=Mh(r)>>>0;break;case 3:e.scorePorn=_k(r);break;case 4:e.scoreSexy=_k(r);break;case 5:e.scoreNeutral=_k(r);break;case 6:e.requestScene=Mh(r)>>>0;break;case 7:e.scene=Mh(r)>>>0;break;default:R6(r,7&t)}}return e}function qY(r,e){let t=r.service;t!==void 0&&(li(e,8),li(e,t));let n=r.vendor;n!==void 0&&(li(e,16),li(e,n));let i=r.token;i!==void 0&&(li(e,26),Ef(e,i));let s=r.callbackUrl;s!==void 0&&(li(e,34),Ef(e,s))}function XY(r){let e=Mh(r),t=r.limit;return r.limit=r.offset+e,t}function R6(r,e){switch(e){case 0:for(;128&I6(r););break;case 2:sj(r,Mh(r));break;case 5:sj(r,4);break;case 1:sj(r,8);break;default:throw new Error("Unimplemented type: "+e)}}let C6=new Float32Array(1);new Uint8Array(C6.buffer);let ij=new Float64Array(1),Ac=new Uint8Array(ij.buffer);function Na(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}let zv=[];function rj(){let r=zv.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}}function b6(r){zv.push(r)}function sj(r,e){if(r.offset+e>r.limit)throw new Error("Skip past limit");r.offset+=e}function pk(r){return r.offset>=r.limit}function Yv(r,e){let t=r.bytes,n=r.offset,i=r.limit,s=n+e;if(s>t.length){let o=new Uint8Array(2*s);o.set(t),r.bytes=o}return r.offset=s,s>i&&(r.limit=s),n}function hS(r,e){let t=r.offset;if(t+e>r.limit)throw new Error("Read past limit");return r.offset+=e,t}function fk(r,e){let t=hS(r,e),n=String.fromCharCode,i=r.bytes,s="�",o="";for(let c=0;c<e;c++){let d,u,p,m,g=i[c+t];128&g?(224&g)==192?c+1>=e?o+=s:(d=i[c+t+1],(192&d)!=128?o+=s:(m=(31&g)<<6|63&d,m<128?o+=s:(o+=n(m),c++))):(240&g)==224?c+2>=e?o+=s:(d=i[c+t+1],u=i[c+t+2],(49344&(d|u<<8))!=32896?o+=s:(m=(15&g)<<12|(63&d)<<6|63&u,m<2048||m>=55296&&m<=57343?o+=s:(o+=n(m),c+=2))):(248&g)==240?c+3>=e?o+=s:(d=i[c+t+1],u=i[c+t+2],p=i[c+t+3],(12632256&(d|u<<8|p<<16))!=8421504?o+=s:(m=(7&g)<<18|(63&d)<<12|(63&u)<<6|63&p,m<65536||m>1114111?o+=s:(m-=65536,o+=n(55296+(m>>10),56320+(1023&m)),c+=3))):o+=s:o+=n(g)}return o}function Ef(r,e){let t=e.length,n=0;for(let o=0;o<t;o++){let c=e.charCodeAt(o);c>=55296&&c<=56319&&o+1<t&&(c=(c<<10)+e.charCodeAt(++o)-56613888),n+=c<128?1:c<2048?2:c<65536?3:4}li(r,n);let i=Yv(r,n),s=r.bytes;for(let o=0;o<t;o++){let c=e.charCodeAt(o);c>=55296&&c<=56319&&o+1<t&&(c=(c<<10)+e.charCodeAt(++o)-56613888),c<128?s[i++]=c:(c<2048?s[i++]=c>>6&31|192:(c<65536?s[i++]=c>>12&15|224:(s[i++]=c>>18&7|240,s[i++]=c>>12&63|128),s[i++]=c>>6&63|128),s[i++]=63&c|128)}}function M_(r,e){let t=Yv(r,e.limit),n=r.bytes,i=e.bytes;for(let s=0,o=e.limit;s<o;s++)n[s+t]=i[s]}function I6(r){return r.bytes[hS(r,1)]}function oj(r,e){let t=Yv(r,1);r.bytes[t]=e}function _k(r){let e=hS(r,8),t=r.bytes;return Ac[0]=t[e++],Ac[1]=t[e++],Ac[2]=t[e++],Ac[3]=t[e++],Ac[4]=t[e++],Ac[5]=t[e++],Ac[6]=t[e++],Ac[7]=t[e++],ij[0]}function L0(r,e){let t=Yv(r,8),n=r.bytes;ij[0]=e,n[t++]=Ac[0],n[t++]=Ac[1],n[t++]=Ac[2],n[t++]=Ac[3],n[t++]=Ac[4],n[t++]=Ac[5],n[t++]=Ac[6],n[t++]=Ac[7]}function Mh(r){let e,t=0,n=0;do e=I6(r),t<32&&(n|=(127&e)<<t),t+=7;while(128&e);return n}function li(r,e){for(e>>>=0;e>=128;)oj(r,127&e|128),e>>>=7;oj(r,e)}function gi(r,e){let t=e.low>>>0,n=(e.low>>>28|e.high<<4)>>>0,i=e.high>>>24,s=i===0?n===0?t<16384?t<128?1:2:t<1<<21?3:4:n<16384?n<128?5:6:n<1<<21?7:8:i<128?9:10,o=Yv(r,s),c=r.bytes;switch(s){case 10:c[o+9]=i>>>7&1;case 9:c[o+8]=s!==9?128|i:127&i;case 8:c[o+7]=s!==8?n>>>21|128:n>>>21&127;case 7:c[o+6]=s!==7?n>>>14|128:n>>>14&127;case 6:c[o+5]=s!==6?n>>>7|128:n>>>7&127;case 5:c[o+4]=s!==5?128|n:127&n;case 4:c[o+3]=s!==4?t>>>21|128:t>>>21&127;case 3:c[o+2]=s!==3?t>>>14|128:t>>>14&127;case 2:c[o+1]=s!==2?t>>>7|128:t>>>7&127;case 1:c[o]=s!==1?128|t:127&t}}function lE(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}let A6=new Map([["moderation",1],["supervise",2]]);class JY extends Sr{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;let t=this._connectionState;this._connectionState=e,this.emit(kr.CONNECTION_STATE_CHANGE,t,e)}get inspectType(){return this._inspectType}set inspectType(e){var t;this._inspectMode=Ks(t=e.map(n=>A6.get(n)||0)).call(t,(n,i)=>n+i),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),Z(this,"name","AgoraRTCVideoContentInspect"),Z(this,"_connectionState",kt.CONNECTING),Z(this,"_innerConnectionState",void 0),Z(this,"sequence",0),Z(this,"inspectStartTime",void 0),Z(this,"workerManagerConnection",void 0),Z(this,"workerConnection",void 0),Z(this,"workerMessageLengthLimit",void 0),Z(this,"inspectIntervalMinimum",void 0),Z(this,"qualityRatio",void 0),Z(this,"_connectInfo",void 0),Z(this,"_cancelTokenSource",Er.CancelToken.source()),Z(this,"_retryConfig",void 0),Z(this,"wmSequence",0),Z(this,"inspectInterval",void 0),Z(this,"inspectTimer",null),Z(this,"ossFilePrefix",void 0),Z(this,"extraInfo",void 0),Z(this,"_inspectType",void 0),Z(this,"_inspectMode",void 0),Z(this,"_quality",1),Z(this,"qualityTimer",null),Z(this,"_inspectId",void 0),Z(this,"_needWorkUrlOnly",!1),Z(this,"inspectImage",()=>{if(this.connectionState!==kt.CONNECTED)throw new fe(z.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===kt.CONNECTED?this.requestToInspectImage():V.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=In(5,"inspect-"),this.workerMessageLengthLimit=te("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=te("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=te("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Ov("worker-manager-"+this._inspectId,zr),this.on(kr.STATE_CHANGE,(t,n)=>{this._innerConnectionState=t,V.debug("[".concat(this._inspectId,"] Inspect operation :").concat($o[t]," ").concat(n||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Ov("worker-"+this._inspectId,zr),this.handleWorkerEvents()}async init(e,t){this.emit(kr.STATE_CHANGE,$o.CONNECT_AP),this._connectInfo=e;let n=this._cancelTokenSource.token;return this._retryConfig=t,new De((i,s)=>{this.on(kr.CONNECTION_STATE_CHANGE,(o,c)=>{c===kt.CONNECTED&&i()}),this.requestAP(e,n,t).then(o=>{this.connectWorkerManager(o)}).catch(o=>{s(o)})})}async requestAP(e,t,n){let i=te("WEBCS_DOMAIN").map(c=>"https://".concat(c,"/api/v1")),s=await(function(c,d,u,p){let{appId:m,areaCode:g,cname:T,sid:R,token:I,uid:A}=d;KC++;let w="image_moderation_api",k={service_name:w,json_body:JSON.stringify({appId:m,areaCode:g,cname:T,command:"allocateEdge",requestId:KC,seq:KC,sid:R,token:I,ts:Date.now(),uid:A+""})},L,j,K=c[0];return Tu(async()=>{L=Date.now();let W=await bu(K,{data:k,cancelToken:u,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(j=Date.now()-L,W.code!==0){let ge=new fe(z.UNEXPECTED_RESPONSE,"image inspect ap error, code"+W.code,{retry:!0,responseTime:j});throw V.error(ge.toString()),ge}let Y=JSON.parse(W.json_body);if(Y.code!==200){let ge=new fe(z.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Y.code,", reason: ").concat(Y.reason),{code:Y.code,responseTime:j});throw V.error(ge.toString()),ge}if(!Y.servers||!Array.isArray(Y.servers)||Y.servers.length===0){let ge=new fe(z.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Y.code,responseTime:j});throw V.error(ge.toString()),ge}let se=te("VIDEO_INSPECT_WORKER_MANAGER_HOST"),de=te("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Y.servers.map(ge=>{let{address:je,wss:_t}=ge;if(je&&_t)return"wss://".concat(je.replace(/\./g,"-"),".").concat(se,":").concat(de||_t)}).filter(ge=>!!ge),workerToken:Y.workerToken,vid:Y.vid,responseTime:j}},(W,Y)=>(Ye.apworkerEvent(R,{success:!0,sc:200,serviceName:w,responseDetail:JSON.stringify(W.addressList),firstSuccess:Y===0,responseTime:j,serverIp:c[Y%c.length]}),!1),(W,Y)=>(Ye.apworkerEvent(R,{success:!1,sc:W.data&&W.data.code||200,serviceName:w,responseTime:j,serverIp:c[Y%c.length]}),!!(W.code!==z.OPERATION_ABORTED&&W.code!==z.UNEXPECTED_RESPONSE||W.data&&W.data.retry)&&(K=c[(Y+1)%c.length],!0)),p)})(i,e,t,n);this.emit(kr.STATE_CHANGE,$o.AP_CONNECTED);let{addressList:o}=s;return this.wmSequence++,o}async connectWorkerManager(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=t,this.emit(kr.STATE_CHANGE,$o.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Wt.CONNECTED,async()=>{this.emit(kr.STATE_CHANGE,$o.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Wt.CLOSED,()=>{this._innerConnectionState<$o.GET_WORKER_MANAGER_RESPONSE&&V.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Wt.FAILED,()=>{this._innerConnectionState<$o.GET_WORKER_MANAGER_RESPONSE&&V.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Wt.RECONNECTING,()=>{this._innerConnectionState<$o.GET_WORKER_MANAGER_RESPONSE&&V.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Wt.ON_MESSAGE,async e=>{this.emit(kr.STATE_CHANGE,$o.GET_WORKER_MANAGER_RESPONSE);let t=this.workerManagerConnection.url;this.workerManagerConnection.close();let n=JSON.parse(e.data);if(n.code!==200)throw V.error("[".concat(this._inspectId,"] Unexpected code ").concat(n.code," from worker manager")),new fe(z.UNEXPECTED_RESPONSE,"response code of worker is unexpected",n);if(!(n.serverResponse&&n.serverResponse.portWss&&t))throw V.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(n))),new fe(z.UNEXPECTED_RESPONSE,"response content of worker is unexpected",n);{let i=te("VIDEO_INSPECT_WORKER_PORT")||n.serverResponse.portWss,s=t.replace(/:\d+\/?$/,":".concat(i));this.emit(kr.STATE_CHANGE,$o.CONNECT_WORKER,s),this._needWorkUrlOnly?this.emit(kr.REQUEST_NEW_WORKER_URL,s):await this.connectWorker(s)}}),this.workerManagerConnection.on(Wt.WILL_RECONNECT,(e,t,n)=>{n(e)}),this.workerManagerConnection.on(Wt.REQUEST_NEW_URLS,(e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)})}handleWorkerEvents(){this.workerConnection.on(Wt.CONNECTED,async()=>{this.emit(kr.STATE_CHANGE,$o.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=kt.CONNECTED}),this.workerConnection.on(Wt.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){let n=zY(new Uint8Array(e.data));if(te("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&V.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(n)),n.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(kr.INSPECT_RESULT,void 0,void 0);if(n.data&&n.data.scorePorn&&n.data.scoreSexy&&n.data.scoreNeutral){var t;let i={porn:n.data.scorePorn,sexy:n.data.scoreSexy,neutral:n.data.scoreNeutral},s=Ks(t=Object.keys(i)).call(t,(c,d)=>i[c]>i[d]?c:d,"porn"),o=Object.keys(i).find(c=>c===s);this.emit(kr.INSPECT_RESULT,o)}else this.emit(kr.INSPECT_RESULT,void 0,new fe(z.UNEXPECTED_RESPONSE,n.code+"","There is an unexpected data on message"))}else this.emit(kr.INSPECT_RESULT,void 0,new fe(z.UNEXPECTED_RESPONSE,n.code+"",n.msg))}else V.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(kr.INSPECT_RESULT,void 0,new fe(z.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Wt.CLOSED,()=>{this.connectionState=kt.CLOSED}),this.workerConnection.on(Wt.FAILED,()=>{this.connectionState=kt.CLOSED}),this.workerConnection.on(Wt.RECONNECTING,()=>{this.connectionState=this.connectionState===kt.CONNECTED?kt.RECONNECTING:kt.CONNECTING}),this.workerConnection.on(Wt.WILL_RECONNECT,(e,t,n)=>{e==="recover"&&n(e),n("tryNext")}),this.workerConnection.on(Wt.REQUEST_NEW_URLS,(e,t)=>{this.workerManagerConnection.close(),this.once(kr.REQUEST_NEW_WORKER_URL,n=>{e([n])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(n=>{this.connectWorkerManager(n,!0)}).catch(n=>{t(n)})})}async requestToInspectImage(){this.sequence++;let e=ei(this,kr.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(kr.INSPECT_RESULT,void 0,new fe(z.INVALID_OPERATION,"Only the track being played can be inspected"));let n=await this.generateRequestData(e,t);this.workerConnection.sendMessage(n,!0,!0)}else this.emit(kr.INSPECT_RESULT,void 0,new fe(z.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,t){let{appId:n,cname:i,cid:s,vid:o,sid:c,uid:d}=t,u=Date.now(),p=await e.getCurrentFrameImage("image/jpeg",this.quality),m=await S4(p,n,i),g=this.sequence+"-"+s+"-"+d+"-"+u+"-"+In(12,""),T={appId:n,cid:s,cname:i,deviceId:"",elapse:(R=Number(u-this.inspectStartTime),{low:R|=0,high:R>>31,unsigned:R>=0}),fileSize:m.byteLength,jpgEncryption:2,height:p.height,width:p.width,jpg:m,networkType:6,osType:7,requestId:g,sdkVersion:"4.24.0",sequence:this.sequence,sid:c,timestamp:ob(u),uid:d,vid:o,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var R;this.extraInfo===void 0&&delete T.callbackData,this.ossFilePrefix===void 0&&delete T.ossFilePrefix;let I=KY(T);if(I.byteLength<this.workerMessageLengthLimit){if(te("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let A=(function(w){for(var k=1;k<arguments.length;k++){var L=arguments[k]!=null?arguments[k]:{};k%2?lE(Object(L),!0).forEach(function(j){Z(w,j,L[j])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(L)):lE(Object(L)).forEach(function(j){Object.defineProperty(w,j,Object.getOwnPropertyDescriptor(L,j))})}return w})({},T);delete A.jpg,V.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(A))}return I}{let A=this.quality*this.qualityRatio;return this.quality=A,await this.generateRequestData(e,{appId:n,cname:i,cid:s,vid:o,sid:c,uid:d})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Er.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=kt.CLOSED,this.emit(kr.STATE_CHANGE,$o.CLOSED)}}let QY={name:"ContentInspect",create:function(r){let{config:e}=r;return(function(t){if(!t)throw new fe(z.INVALID_PARAMS,"inspectConfig is necessary.");if(!t.inspectType||!Array.isArray(t.inspectType))throw new fe(z.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{let n=[...new Set(t.inspectType)];n.forEach(i=>{var s;if(!Re(s=["supervise","moderation"]).call(s,i))throw new fe(z.INVALID_PARAMS,"".concat(i," is not a valid inspect type."))}),t.inspectType=n}if(t&&t.extraInfo&&t.extraInfo.length>1024)throw new fe(z.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")})(e),new JY(e)}};var w6=S(xn.Object.getOwnPropertySymbols),O6=Ut,ZY=kl.indexOf,$Y=Qu,aj=ye([].indexOf),mk=!!aj&&1/aj([1],1,-0)<0;O6({target:"Array",proto:!0,forced:mk||!$Y("indexOf")},{indexOf:function(r){var e=arguments.length>1?arguments[1]:void 0;return mk?aj(this,r,e)||0:ZY(this,r,e)}});var N6=to("Array","indexOf"),eq=ee,tq=N6,cj=Array.prototype,lj=function(r){var e=r.indexOf;return r===cj||eq(cj,r)&&e===cj.indexOf?tq:e},D6=S(lj);function P6(r,e){if(r==null)return{};var t,n,i=(function(o,c){if(o==null)return{};var d={};for(var u in o)if({}.hasOwnProperty.call(o,u)){if(D6(c).call(c,u)!==-1)continue;d[u]=o[u]}return d})(r,e);if(w6){var s=w6(r);for(n=0;n<s.length;n++)t=s[n],D6(e).call(e,t)===-1&&{}.propertyIsEnumerable.call(r,t)&&(i[t]=r[t])}return i}let k6=class{get localCapabilities(){return sr(this._localCapabilities)}get rtpCapabilities(){return sr(this._rtpCapabilities)}get candidates(){return sr(this._candidates)}get iceParameters(){return sr(this._iceParameters)}get dtlsParameters(){return sr(this._dtlsParameters)}constructor(r){Z(this,"sessionDesc",void 0),Z(this,"_localCapabilities",void 0),Z(this,"_rtpCapabilities",void 0),Z(this,"_candidates",void 0),Z(this,"_iceParameters",void 0),Z(this,"_dtlsParameters",void 0),Z(this,"setup",void 0),Z(this,"currentMidIndex",void 0),Z(this,"cname","o/i14u9pJrxRKAsu"),Z(this,"firefoxSsrcMidMap",new Map),r=sr(r);let{remoteIceParameters:e,remoteDtlsParameters:t,candidates:n,remoteRTPCapabilities:i,localCapabilities:s,direction:o,setup:c,videoCodec:d,audioCodec:u}=r,p;this.setup=c,p=o===an.RECEIVE_ONLY?Wc(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):Wc(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=i,this._candidates=n,this._iceParameters=e,this._dtlsParameters=t,this._localCapabilities=s;let m=o===an.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,g=o===an.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,T=o===an.RECEIVE_ONLY?i.send.videoCodecs:C_(vt.VIDEO,m,g,d),R=o===an.RECEIVE_ONLY?i.send.audioCodecs:C_(vt.AUDIO,m,g,u);for(let I of p.mediaDescriptions)I.attributes.iceUfrag=e.iceUfrag,I.attributes.icePwd=e.icePwd,I.attributes.fingerprints=t.fingerprints,I.attributes.candidates=n,I.attributes.setup=this.setup,I.media.mediaType==="application"&&(I.attributes.sctpPort="5000"),I.media.mediaType==="video"&&(I.media.fmts=T.map(A=>A.payloadType.toString(10)),I.attributes.payloads=T,I.attributes.extmaps=m.videoExtensions),I.media.mediaType==="audio"&&(I.media.fmts=R.map(A=>A.payloadType.toString(10)),I.attributes.payloads=R,I.attributes.extmaps=m.audioExtensions,zm(I));this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return Qo(this.sessionDesc)}hasMid(r){return Array.isArray(r)?r.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(e=>e.attributes.mid===r)}send(r,e,t,n,i){t=t.replace(/ /g,"-");let{ssrcs:s,ssrcGroups:o}=jC(e,this.cname,te("SYNC_GROUP")?t:void 0),c=this.findPreloadMediaDesc(s);if(c){if(jr()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,c.attributes.mid),i&&(i.twcc||i.remb)){let d=this.sessionDesc.mediaDescriptions.indexOf(c);return this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(c,i),{mid:c.attributes.mid,needExchangeSDP:!0}}return{mid:c.attributes.mid,needExchangeSDP:!1}}{let d=this.findAvailableMediaIndex(r,s,n),u;return d===-1?(u=this.createOrRecycleSendMedia(r,s,o,"sendonly",n,i),this.updateBundleMids()):(u=sr(this.sessionDesc.mediaDescriptions[d]),u.attributes.direction="sendonly",u.attributes.ssrcs=s,u.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[d]=this.mungSendMediaDesc(u,i)),jr()&&this.firefoxSsrcMidMap.set(s[0].ssrcId,u.attributes.mid),{needExchangeSDP:!0,mid:u.attributes.mid}}}stopSending(r){let e=this.sessionDesc.mediaDescriptions.filter(t=>t.attributes.mid&&r.indexOf(t.attributes.mid)!==-1);if(e.length!==r.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(t=>{t.attributes.ssrcs=[]}),this.updateBundleMids()}receive(r,e,t){let n=[];return r.forEach(i=>{let s=i._mediaStreamTrack.kind,o=this.findAvailableRecvMediaIndex(s),c,d=!1;o===-1?(d=!0,c=this.createOrRecycleRecvMedia(i,[],"recvonly",e,t),this.updateBundleMids()):(c=sr(this.sessionDesc.mediaDescriptions[o]),c.attributes.direction="recvonly"),n.push({mid:c.attributes.mid,needCreateTransceiver:d})}),n}stopReceiving(r){let e=this.sessionDesc.mediaDescriptions.filter(t=>r.indexOf(t.attributes.mid)!==-1);if(e.length!==r.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(t=>{t.media.port="0",t.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(r){let{foundation:e,protocol:t,address:n,port:i,type:s,relatedAddress:o,relatedPort:c,priority:d}=new RTCIceCandidate(r),u={foundation:e??"",componentId:"1",transport:t??"",priority:d?d+"":"",connectionAddress:n??"",port:i?i+"":"",type:s?s+"":"",relAddr:o??"",relPort:c?c+"":"",extension:{}};this.candidates.some(p=>p.priority===u.priority&&p.connectionAddress===u.connectionAddress&&p.port===u.port)||(this._candidates.push(u),this.sessionDesc.mediaDescriptions.forEach(p=>{p.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(r,e,t,n,i){let s=r._mediaStreamTrack.kind,o=this.rtpCapabilities.recv,c=C_(s,o,this.localCapabilities.send,s===vt.AUDIO?i:n),d=s===vt.VIDEO?o.videoExtensions:o.audioExtensions,u="".concat(++this.currentMidIndex),p={media:{mediaType:s,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(g=>g.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:t,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};p=this.mungRecvMediaDsec(p,r);let m=this.findFirstClosedMedia(s);if(m){let g=this.sessionDesc.mediaDescriptions.indexOf(m);this.sessionDesc.mediaDescriptions[g]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}muteRemote(r){let e=this.sessionDesc.mediaDescriptions.filter(t=>Re(r).call(r,t.attributes.mid||""));if(e.length!==r.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(t=>{t.attributes.direction="inactive"})}unmuteRemote(r){let e=this.sessionDesc.mediaDescriptions.filter(t=>Re(r).call(r,t.attributes.mid||""));if(e.length!==r.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(t=>{t.attributes.direction="recvonly"})}findAvailableMediaIndex(r,e,t){return this.sessionDesc.mediaDescriptions.findIndex(n=>{let i=n.media.mediaType===r&&n.media.port!=="0"&&(n.attributes.direction==="sendonly"||n.attributes.direction==="sendrecv")&&n.attributes.ssrcs.length===0;if(jr()){if(i){let s=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(s||n.attributes.mid!=="0"&&n.attributes.mid!=="1")||!(!s||s!==n.attributes.mid)}return!1}return i&&n.attributes.mid===t})}findAvailableRecvMediaIndex(r){return this.sessionDesc.mediaDescriptions.findIndex(e=>{let t=e.media.mediaType===r&&e.media.port!=="0"&&(e.attributes.direction==="recvonly"||e.attributes.direction==="sendrecv");return e.attributes.mid!=="0"&&e.attributes.mid!=="1"&&t})}predictReceivingMids(r){let e=[];for(let t=0;t<r;t++)e.push((this.currentMidIndex+t+1).toString(10));return e}restartICE(r){r=sr(r),this._iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=r.iceUfrag,e.attributes.icePwd=r.icePwd})}createOrRecycleSendMedia(r,e,t,n,i,s){let o=this.rtpCapabilities.send,c=r===vt.VIDEO?o.videoCodecs:o.audioCodecs,d=r===vt.VIDEO?o.videoExtensions:o.audioExtensions;jr()&&(i="".concat(++this.currentMidIndex));let u={media:{mediaType:r,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map(m=>m.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:d,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:t,rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:i}};u=this.mungSendMediaDesc(u,s);let p=this.findFirstClosedMedia(r);if(p){let m=this.sessionDesc.mediaDescriptions.indexOf(p);this.sessionDesc.mediaDescriptions[m]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}mungRecvMediaDsec(r,e,t){let n=sr(r);return Qg(n),R_(n,e),t0(n,e),dP(n),n0(n,t,this.localCapabilities.send),n}mungSendMediaDesc(r,e){let t=sr(r);return n0(t,e,this.localCapabilities.recv),zm(t),t}updateRecvMedia(r,e){let t=this.sessionDesc.mediaDescriptions.findIndex(n=>n.attributes.mid===r);if(t!==-1){let n=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[t],e);this.sessionDesc.mediaDescriptions[t]=n}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(r=>r.media.port!=="0").map(r=>r.attributes.mid)}findPreloadMediaDesc(r){return this.sessionDesc.mediaDescriptions.find(e=>{var t;return((t=e.attributes)===null||t===void 0||(t=t.ssrcs[0])===null||t===void 0?void 0:t.ssrcId)===r[0].ssrcId})}findFirstClosedMedia(r){return this.sessionDesc.mediaDescriptions.find(e=>jr()?e.media.port==="0"&&e.media.mediaType===r:e.media.port==="0")}},L6=["sdp"];var ar;function er(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function dE(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?er(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):er(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}let uE=(ar=class Nk extends JV{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t;return(e=(t=this.peerConnection.getReceivers()[0])===null||t===void 0||(t=t.transport)===null||t===void 0?void 0:t.state)!==null&&e!==void 0?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(e,t,n){super(e,t),Z(this,"direction",void 0),Z(this,"name",void 0),Z(this,"store",void 0),Z(this,"spec",void 0),Z(this,"peerConnection",void 0),Z(this,"initialOffer",void 0),Z(this,"transport",void 0),Z(this,"statsFilter",void 0),Z(this,"localCandidateCount",0),Z(this,"_isInRestartIce",!1),Z(this,"mutex",void 0),Z(this,"onLocalCandidate",void 0),Z(this,"remoteSDP",void 0),Z(this,"pendingCandidates",[]),Z(this,"localCapabilities",void 0),Z(this,"isReady",!1),Z(this,"restartCnt",0),Z(this,"curTurnServerIndex",0),this.store=t,this.spec=e,this.mutex=new ha("P2PConnection-mutex",t.clientId),this.peerConnection=new RTCPeerConnection(Nk.resolvePCConfiguration(e,t.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=n??an.SEND_ONLY,this.name=this.direction===an.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=QU(this.peerConnection,te("STATS_UPDATE_INTERVAL"),void 0,jr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{let t=await rF();if(this.localCapabilities=ed(t),e){let{sdp:n}=e,i=P6(e,L6),s=(function(){let p={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},m=BC(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},T={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},R={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Cu(m,p,"videoExtensions",g,T,R),Cu(m,p,"videoCodecs",g,T,R),Cu(m,p,"audioExtensions",g,T,R),Cu(m,p,"audioCodecs",g,T,R),te("RAISE_H264_BASELINE_PRIORITY")){let I=R.videoCodecs.findIndex(A=>A.rtpMap&&A.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&A.fmtp&&A.fmtp.parameters["profile-level-id"]==="42001f");if(I!==-1){let A=R.videoCodecs.findIndex(w=>w.rtpMap&&w.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(A<I){V.debug("raising H264 baseline profile priority");let w=R.videoCodecs[I];R.videoCodecs.splice(I,1),R.videoCodecs.splice(A,0,w)}A!==-1&&te("FILTER_SEND_H264_BASELINE")&&(g.videoCodecs=g.videoCodecs.filter(w=>!(w.rtpMap&&w.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&w.fmtp&&w.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:g,recv:T,sendrecv:R}})({},{},n);this.remoteSDP=new k6({remoteIceParameters:i.iceParameters,remoteDtlsParameters:i.dtlsParameters,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let o=await this.peerConnection.createAnswer();if(!o.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");let c=bh(o.sdp);await this.peerConnection.setLocalDescription(o);let d=await sF({},{},o.sdp);this.localCapabilities=ed(d);let u=this.peerConnection.getTransceivers()[0];return u!=null&&u.receiver&&u.receiver.transport&&this.tryBindTransportEvents(u.receiver.transport),dE(dE({},c),{},{sdp:o.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let i=bh(n.sdp);return this.initialOffer=n,dE(dE({},i),{},{sdp:n.sdp})}}catch(t){throw new H(z.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:t,iceParameters:n,dtlsParameters:i}=e,s=await sF({},{},t);this.remoteSDP=new k6({remoteIceParameters:n,remoteDtlsParameters:i,candidates:[],remoteRTPCapabilities:s,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let o=this.peerConnection.getTransceivers()[0];o!=null&&o.sender&&o.sender.transport&&this.tryBindTransportEvents(o.sender.transport)}catch(t){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(t.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(t=>{this.peerConnection.addIceCandidate(t)}),this.pendingCandidates=[])}catch(t){throw new H(z.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(t.toString()))}}send(e,t,n){var i=this;return zl(function*(){let s=yield zn(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let o=[],c=i.remoteSDP.receive(e,t,n);e.forEach((A,w)=>{if(c[w].needCreateTransceiver){let k=i.peerConnection.addTransceiver(A._mediaStreamTrack,{direction:"sendonly"});o.push(k),A._updateRtpTransceiver(k)}else{let k=i.peerConnection.getTransceivers().find(L=>L.mid===c[w].mid);if(!k)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(c[w].mid));o.push(k),A._updateRtpTransceiver(k)}}),jr()&&te("SIMULCAST")===!0&&(yield zn(i.applySimulcastForFirefox(o,e)));let d=c.map(A=>A.mid),u=yield zn(i.peerConnection.createOffer()),p=i.mungSendOfferSDP(u.sdp,e,d),m=Wc(p),g=d.map(A=>{let w=m.mediaDescriptions.find(k=>k.attributes.mid===A);if(!w)throw new Error("Cannot extract ssrc from mediaDescription.");return Km(w,te("USE_PUB_RTX"))}),T=o.map((A,w)=>{let k=d[w];return{localSSRC:g[w],id:k}});yield zn(i.peerConnection.setLocalDescription({type:"offer",sdp:p}));try{yield T}catch(A){let w=i.remoteSDP.toString();throw yield zn(i.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield zn(i.peerConnection.setRemoteDescription({type:"answer",sdp:w})),yield zn(i.stopSending(d,!0)),A}yield zn(i.applySimulcastEncodings(o,e)),yield zn(i.applySendEncodings(o,e));let R=i.remoteSDP.toString();return i.logSDPExchange(p,"offer","local","send")?.(R),yield zn(i.setRemoteDescription({type:"answer",sdp:R})),o.map((A,w)=>{let k=d[w];return{localSSRC:g[w],id:k}})}catch(o){throw o instanceof H?o:new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{s()}})()}async stopSending(e,t){let n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let i=this.peerConnection.getTransceivers().filter(d=>e.indexOf(d.mid)!==-1);if(i.length!==e.length)throw new Error("Transceivers' length (".concat(i.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));i.map(d=>{var u;d.direction="inactive",(u=d.stop)===null||u===void 0||u.call(d)});let s=await this.peerConnection.createOffer(),o=this.logSDPExchange(s.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(s),this.remoteSDP.stopReceiving(e);let c=this.remoteSDP.toString();o?.(c),await this.setRemoteDescription({type:"answer",sdp:c})}catch(i){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{n&&n()}}async receive(e,t,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));let{mid:s,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,i);if(o){let d=this.remoteSDP.toString(),u=this.logSDPExchange(d,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:d});let p=await this.peerConnection.createAnswer(),m=this.mungReceiveAnswerSDP(p.sdp,s,e);u?.(m||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:m}),V.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else V.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));let c=this.peerConnection.getTransceivers().find(d=>d.mid===s);if(!c||c.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:c.receiver.track,mid:c.mid,transceiver:c}}catch(s){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async mockReceive(e,t,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));let{mid:s,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,i);if(o){let c=this.remoteSDP.toString(),d=this.logSDPExchange(c,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:c});let u=await this.peerConnection.createAnswer(),p=this.mungReceiveAnswerSDP(u.sdp,s,e);d?.(p||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:p}),V.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else V.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(s){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);let t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:t});let i=await this.peerConnection.createAnswer();n?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(t){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}async restartICE(e){try{if(this.store.p2pTransport===Um.Auto&&(this.store.p2pTransport=Um.SdRtn,on().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Nk.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,on().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Nk.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!e){this.restartCnt++,this.isReady=!1;let t=await this.peerConnection.createOffer({iceRestart:!0});if(!t.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:n}=bh(t.sdp);return this.store.descriptionStart(),this.direction===an.SEND_ONLY&&await this.peerConnection.setLocalDescription(t),n}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(e),this.store.descriptionStart(),this.direction===an.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let t=await this.peerConnection.createAnswer();if(!t.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:n}=bh(t.sdp);return await this.peerConnection.setLocalDescription(t),n}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(t){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let n=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);let s=this.remoteSDP.toString(),o=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),o?.(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new H(z.EXCHANGE_SDP_FAILED,n.toString())}}async updateSendParameters(e,t){let n=this.peerConnection.getTransceivers().filter(i=>i.mid===e);n.length===1&&(this.isVP8Simulcast(t)?jr()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){let n=this.peerConnection.getTransceivers().find(i=>i.mid===t);n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){let e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){let t=e[0].transport.iceTransport,{local:n,remote:i}=t.getSelectedCandidatePair();return{local:dE(dE({},mh),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:dE(dE({},mh),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,t;Re(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{if(e.candidate){var t;e.candidate.candidate&&((t=this.onLocalCandidate)===null||t===void 0||t.call(this,e.candidate.toJSON())),this.localCandidateCount+=1}else V.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i={iceServers:[]};var s;return e.iceServers?i.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(Ti(e.turnServer.servers)?i.iceServers=e.turnServer.servers:(i.iceServers&&i.iceServers.push(...Nk.turnServerConfigToIceServers(e.turnServer.servers,t,n)),te("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&e.turnServer.serversFromGateway&&i.iceServers.push(...Nk.turnServerConfigToIceServers(e.turnServer.serversFromGateway,t,n)),Re(s=[Um.Relay,Um.SdRtn]).call(s,t)&&(i.iceTransportPolicy="relay"),te("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(o=>{o.forceturn&&(i.iceTransportPolicy="relay")}))),te("ENABLE_ENCODED_TRANSFORM")&&on().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),V.debug("P2PConnection p2pTransport is ".concat(t)),i}static turnServerConfigToIceServers(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=[],s=e.filter(c=>c.tcpport);V.debug("P2PConnection turnServers is ".concat(s,", current index is ").concat(n));let o=s.length>n?s[n]:s[0];switch(t){case Um.SdRtn:let c=e.filter(u=>{var p;return Re(p=u.username).call(p,"glb:")&&u.turnServerURL==u.turnServerURL}),d=c.length>n?c[n]:c[0];d&&(i.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(sf(d.turnServerURL),":").concat(d.tcpport,"?transport=udp")}),i.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(sf(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}));break;case Um.Relay:o&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(sf(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}));break;default:o&&(i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turn:".concat(o.turnServerURL,":").concat(o.tcpport,"?transport=udp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"turns:".concat(sf(o.turnServerURL),":").concat(o.tcpport,"?transport=tcp")}),i.push({username:o.username,credential:o.password,credentialType:"password",urls:"stun:".concat(o.turnServerURL,":").concat(o.tcpport)}))}return i}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var n;e!=null&&e.state&&((n=this.onDTLSTransportStateChange)===null||n===void 0||n.call(this,e.state))},e.onerror=n=>{var i;(i=this.onDTLSTransportError)===null||i===void 0||i.call(this,"error"in n?n.error:n)};let t=e.iceTransport;t&&(t.onstatechange=()=>{let n=e?.iceTransport.state;var i;n&&((i=this.onICETransportStateChange)===null||i===void 0||i.call(this,n))},t.getSelectedCandidatePair&&(t.onselectedcandidatepairchange=()=>{if(t.getSelectedCandidatePair()){let{local:n,remote:i}=t.getSelectedCandidatePair()||{};if(n&&i){let s=n.address+":"+n.port,o=i.address+":"+i.port;V.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(xd(s)),", remote ").concat(JSON.stringify(xd(o))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find(p=>p.track===e._mediaStreamTrack)),!t)return V.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return V.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!on().supportSetRtpSenderParameters)return V.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let i={},s={};switch(e._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(e._encoderConfig){var o;let{bitrateMax:p,frameRate:m,scaleResolutionDownBy:g}=e._encoderConfig;p&&(s.maxBitrate=1e3*p),Re(o=e._hints).call(o,rt.LOW_STREAM)&&(m&&(s.maxFramerate=zc(m)),g&&g>=1&&(s.scaleResolutionDownBy=g))}if(te("DSCP_TYPE")&&Xp()){var c;let p=te("DSCP_TYPE");Re(c=["very-low","low","medium","high"]).call(c,p)&&(s.networkPriority=p)}let d=t.getParameters(),u=(n=d.encodings)===null||n===void 0?void 0:n[0];jr()&&!u&&(i.encodings=[s]),u&&Object.assign(u,s),Object.assign(d,i),V.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(d.encodings))),await t.setParameters(d)}async applySendEncodings(e,t){try{if(!on().supportSetRtpSenderParameters||e.length!==t.length)return;for(let n=0;n<e.length;n++){let i=e[n],s=t[n];s instanceof Ei&&!this.isVP8Simulcast(s)&&await this.updateRtpSenderEncodings(s,i.sender)}}catch{V.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){let i=Wc(e);return t.forEach((s,o)=>{let c=n[o],d=i.mediaDescriptions.find(u=>u.attributes.mid===c);d&&(R_(d,s),i0(d,s,this.store.codec))}),Qo(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;(t=this.onFirstAudioReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;(t=this.onFirstVideoReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;(t=this.onFirstAudioDecoded)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;(n=this.onSelectedLocalCandidateChanged)===null||n===void 0||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;(n=this.onSelectedRemoteCandidateChanged)===null||n===void 0||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;(t=this.onFirstVideoDecodedTimeout)===null||t===void 0||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let d=0;d<e.length;d++){var n,i,s,o,c;let u=e[d],p=t[d];if(p instanceof Ei&&!Re(n=p._hints).call(n,rt.LOW_STREAM)&&(i=p._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((s=p._encoderConfig)===null||s===void 0?void 0:s.bitrateMax)>200&&(o=p._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((c=p._scalabilityMode)===null||c===void 0?void 0:c.numSpatialLayers)>1&&this.store.codec==="vp8"){let m={},g={high:1e3*(p._encoderConfig.bitrateMax-50),medium:5e4};m.encodings=[{rid:"m",active:!0,maxBitrate:g.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:g.high}];let T=u.sender.getParameters();await u.sender.setParameters(Object.assign(T,m))}}}async applySimulcastEncodings(e,t){if(!jr()&&e.length===t.length)for(let n=0;n<e.length;n++){let i=t[n];if(i instanceof Ei&&this.isVP8Simulcast(i)){let s=e[n],o={},c={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};o.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:c.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:c.medium,scaleResolutionDownBy:4}];let d=s.sender.getParameters();await s.sender.setParameters(Object.assign(d,o))}}}isVP8Simulcast(e){var t,n,i,s,o;return!!(e instanceof Ei&&te("SIMULCAST")&&this.store.codec==="vp8"&&!Re(t=e._hints).call(t,rt.LOW_STREAM)&&(n=e._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((i=e._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(s=e._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((o=e._scalabilityMode)===null||o===void 0?void 0:o.numSpatialLayers)>1)}logSDPExchange(e,t,n,i){if(te("SDP_LOGGING"))return V.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(i,`
`),e),t==="offer"?s=>{this.logSDPExchange(s,"answer",n==="local"?"remote":"local",i)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter(o=>o.mid&&e.indexOf(o.mid)!==-1);if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(o=>{o.direction="inactive"});let n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);let s=this.remoteSDP.toString();i?.(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(t){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(t.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let t=this.peerConnection.getTransceivers().filter(o=>o.mid&&e.indexOf(o.mid)!==-1);if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map(async o=>{o.direction="sendonly"});let n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);let s=this.remoteSDP.toString();i?.(s),await this.setRemoteDescription({type:"answer",sdp:s})}catch(t){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(t.toString()))}}async getRemoteSSRC(e,t){var n;if(t=t??((n=this.currentRemoteDescription)===null||n===void 0?void 0:n.sdp)){var i;return((i=Wc(t).mediaDescriptions.find(o=>o.attributes.mid===e))===null||i===void 0?void 0:i.attributes.ssrcs)?.[0].ssrcId}}async setRemoteDescription(e){var t;await this.peerConnection.setRemoteDescription(e),Re(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,t,n){let i=Wc(e),s=i.mediaDescriptions.find(o=>o.attributes.mid===t);return s&&n===vt.AUDIO&&s.media.mediaType==="audio"&&zm(s),Qo(i)}},Dt(ar.prototype,"establish",[ku],Object.getOwnPropertyDescriptor(ar.prototype,"establish"),ar.prototype),Dt(ar.prototype,"connect",[ku],Object.getOwnPropertyDescriptor(ar.prototype,"connect"),ar.prototype),Dt(ar.prototype,"receive",[ku],Object.getOwnPropertyDescriptor(ar.prototype,"receive"),ar.prototype),Dt(ar.prototype,"mockReceive",[ku],Object.getOwnPropertyDescriptor(ar.prototype,"mockReceive"),ar.prototype),Dt(ar.prototype,"stopReceiving",[ku],Object.getOwnPropertyDescriptor(ar.prototype,"stopReceiving"),ar.prototype),Dt(ar.prototype,"restartICE",[ku],Object.getOwnPropertyDescriptor(ar.prototype,"restartICE"),ar.prototype),Dt(ar.prototype,"close",[ku],Object.getOwnPropertyDescriptor(ar.prototype,"close"),ar.prototype),Dt(ar.prototype,"updateEncoderConfig",[ku],Object.getOwnPropertyDescriptor(ar.prototype,"updateEncoderConfig"),ar.prototype),Dt(ar.prototype,"updateSendParameters",[ku],Object.getOwnPropertyDescriptor(ar.prototype,"updateSendParameters"),ar.prototype),Dt(ar.prototype,"replaceTrack",[ku],Object.getOwnPropertyDescriptor(ar.prototype,"replaceTrack"),ar.prototype),Dt(ar.prototype,"muteLocal",[ku],Object.getOwnPropertyDescriptor(ar.prototype,"muteLocal"),ar.prototype),Dt(ar.prototype,"unmuteLocal",[ku],Object.getOwnPropertyDescriptor(ar.prototype,"unmuteLocal"),ar.prototype),ar);function ku(r,e,t){let n=r[e];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return t.value=async function(){let i=this.mutex,s=await i.lock("From P2PConnection.".concat(e));try{for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return await n.apply(this,c)}finally{s()}},t}let Ea=(function(r){return r.SEND_ONLY="SEND_ONLY",r.RECEIVE_ONLY="RECEIVE_ONLY",r})({});var Uh,dj,uj,hj,pj,fj,_j,mj,Ej,gj,Sj,Cr;function br(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function M0(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?br(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):br(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}let Ek=(Uh=gf(Ea.SEND_ONLY),dj=gf(Ea.SEND_ONLY),uj=gf(),hj=gf(Ea.RECEIVE_ONLY),pj=gf(Ea.RECEIVE_ONLY),fj=gf(Ea.RECEIVE_ONLY),_j=gf(Ea.RECEIVE_ONLY),mj=gf(Ea.RECEIVE_ONLY),Ej=gf(Ea.RECEIVE_ONLY),gj=gf(),Sj=gf(Ea.RECEIVE_ONLY),Cr=class extends Sr{get state(){return this._state}set state(r){let e=this._state;this._state=r,this.emit(ut.StateChange,e,this._state)}constructor(r,e){super(),Z(this,"isPlanB",!1),Z(this,"store",void 0),Z(this,"statsUploader",void 0),Z(this,"sendConnection",void 0),Z(this,"recvConnection",void 0),Z(this,"localTrackMap",new Map),Z(this,"remoteUserMap",new Map),Z(this,"localDataChannels",[]),Z(this,"pendingLocalTracks",[]),Z(this,"pendingRemoteTracks",[]),Z(this,"statsCollector",void 0),Z(this,"dtlsFailedCount",0),Z(this,"sendMutex",void 0),Z(this,"recvMutex",void 0),Z(this,"_state",He.Disconnected),Z(this,"_restartStates",["disconnected","failed"]),Z(this,"reconnectInterval",void 0),Z(this,"uploadUnplinkStarted",!1),Z(this,"uploadDownlinkStarted",!1),Z(this,"uplinkStateUploadInterval",void 0),Z(this,"downlinkStatsUploadInterval",void 0),Z(this,"handleMuteLocalTrack",async(t,n,i)=>{let s=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==He.Connected)return void i(new H(z.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let d=this.filterTobeMutedTracks(t);if(d.length===0)return void n();let u=d.find(T=>T[0]==="videoLowTrack");u&&u[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(d.map(T=>{let[,{id:R}]=T;return R}));let p=!1;var o,c;t.trackMediaType==="video"?p=!((o=this.localTrackMap.get($e.LocalAudioTrack))===null||o===void 0||!o.track._muted):p=((c=this.localTrackMap.get($e.LocalVideoTrack))===null||c===void 0?void 0:c.id)===void 0;let m=this.createMuteMessage(d);await On(this,ut.RequestMuteLocal,m);let g=t.trackMediaType==="video"?Ru.MUTE_LOCAL_VIDEO:Ru.MUTE_LOCAL_AUDIO;await On(this,ut.RequestP2PMuteLocal,{action:g,message:m,isMuteAll:p}),n()}catch(d){i(d)}finally{s()}}),Z(this,"handleUnmuteLocalTrack",async(t,n,i)=>{let s=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==He.Connected)return void i(new H(z.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let o=this.filterTobeUnmutedTracks(t);if(o.length===0)return void n();await this.sendConnection.unmuteLocal(o.map(u=>{let[,{id:p}]=u;return p}));let c=this.createUnmuteMessage(o),d=t.trackMediaType==="video"?Ru.UNMUTE_LOCAL_VIDEO:Ru.UNMUTE_LOCAL_AUDIO;await On(this,ut.RequestP2PMuteLocal,{action:d,message:c}),n()}catch(o){i(o)}finally{s()}}),Z(this,"handleUpdateVideoEncoder",async(t,n,i,s)=>{let o;typeof s=="boolean"&&s||(o=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{let d=this.localTrackMap.get($e.LocalVideoTrack);if(!this.sendConnection||!d||d.track!==t||this.state!==He.Connected)return void n();let{id:u,track:p}=d;u&&(await this.sendConnection.updateSendParameters(u,p),await this.sendConnection.updateEncoderConfig(u,p),this.emit(ut.UpdateVideoEncoder,p)),n()}catch(d){i(d)}finally{var c;(c=o)===null||c===void 0||c()}}),Z(this,"handleUpdateVideoSendParameters",async(t,n,i)=>{let s=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let o=this.localTrackMap.get($e.LocalVideoTrack);if(!this.sendConnection||!o||o.track!==t||this.state!==He.Connected)return void n();let{id:c,track:d}=o;c&&await this.sendConnection.updateSendParameters(c,d),n()}catch(o){i(o)}finally{s()}}),Z(this,"handleReplaceTrack",async(t,n,i,s)=>{let o;V.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(t.getTrackId(),"]")),typeof s=="boolean"&&s||(o=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var c;let u=Array.from(this.localTrackMap.entries()).find(p=>{let[,{track:m}]=p;return t===m});if(!this.sendConnection||!u||u[1].id===void 0||this.state!==He.Connected)return void n();if(await((c=this.sendConnection)===null||c===void 0?void 0:c.replaceTrack(t,u[1].id)),u[0]===$e.LocalVideoTrack&&on().supportDualStreamEncoding){let p=this.localTrackMap.get($e.LocalVideoLowTrack);if(p){let m=t._mediaStreamTrack.clone();p.track._originMediaStreamTrack.stop(),p.track._mediaStreamTrack=m,p.track._originMediaStreamTrack=m,await new De((g,T)=>{this.handleReplaceTrack(p.track,g,T,!0)})}}n()}catch(u){i(u)}finally{var d;(d=o)===null||d===void 0||d()}}),Z(this,"handleGetLocalVideoStats",t=>{t(this.statsCollector.getLocalVideoTrackStats())}),Z(this,"handleGetLocalAudioStats",t=>{t(this.statsCollector.getLocalAudioTrackStats())}),Z(this,"handleGetRemoteVideoStats",t=>this.statsCollector.getRemoteVideoTrackStats(t.uid)[t.uid]),Z(this,"handleGetRemoteAudioStats",t=>this.statsCollector.getRemoteAudioTrackStats(t.uid)[t.uid]),this.store=r,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new NF(r),this.bindStatsUploaderEvents(),this.sendMutex=new ha("P2PChannel2-send-mutex",r.clientId),this.recvMutex=new ha("P2PChannel2-recv-mutex",r.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(t=>{t&&(t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))})},te("ICE_RESTART_INTERVAL"))}async startP2PConnection(r,e){throw new H(z.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(r){throw new H(z.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(r,e){let t;try{if(e){this.recvConnection&&(V.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),t=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new uE(r,this.store,an.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let n=await this.recvConnection.establish(e);return{iceParameters:n.iceParameters,dtlsParameters:n.dtlsParameters,sdp:n.sdp}}{this.state=He.New,this.sendConnection&&(V.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),t=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new uE(r,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let n=await this.sendConnection.establish();return{iceParameters:n.iceParameters,dtlsParameters:n.dtlsParameters,sdp:n.sdp}}}finally{t&&t()}}async p2pConnect(r){if(!this.sendConnection)throw new H(z.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(r),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=He.Connected}async addRemoteCandidate(r,e){if(e===an.RECEIVE_ONLY){if(!this.sendConnection)throw new H(z.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(r)}else{if(!this.recvConnection)throw new H(z.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(r)}}publish(r,e,t){var n=this;return zl(function*(){let i=yield zn(n.sendMutex.lock("From P2PChannel.publish"));try{if(!n.sendConnection||n.state!==He.Connected){n.throwIfTrackTypeNotMatch(r);let u=r.filter(p=>n.pendingLocalTracks.indexOf(p)===-1);return void(n.pendingLocalTracks=n.pendingLocalTracks.concat(u))}n.store.pubId=n.store.pubId+1,ta.markPublishStart(n.store.clientId,n.store.pubId);let s=n.filterTobePublishedTracks(r,e,t);if(s.length===0)return void(yield zn(n.tryToUnmuteAudio(r)));s.forEach(u=>{let{track:p,type:m}=u,g=Date.now();n.store.publish(p.getTrackId(),m===$e.LocalAudioTrack?"audio":"video",g)}),n.bindLocalTrackEvents(s);let o=yield zn(n.sendConnection.send(s.map(u=>{let{track:p}=u;return p}),n.store.codec,n.store.audioCodec)),c=(yield zn(o.next())).value,d=n.createGatewayPublishMessage(s,c);try{yield d}catch(u){throw o.throw(u),u?.code===z.WS_ABORT&&s.forEach(p=>{let{track:m}=p;n.pendingLocalTracks.indexOf(m)===-1&&n.pendingLocalTracks.push(m)}),n.unbindLocalTrackEvents(s),u}yield zn(o.next()),s.forEach(u=>{let{type:p}=u;n.statsCollector.addLocalStats(p)}),n.statsUploader.startUploadOutboundStats(),n.assignLocalTracks(s,c),s.forEach(u=>{let{track:p,type:m}=u,g=Date.now();n.store.publish(p.getTrackId(),m===$e.LocalAudioTrack?"audio":"video",void 0,g)}),n.startUploadUplinkState()}finally{i()}})()}async unpublish(r){if(!this.sendConnection||this.state!==He.Connected)return void(r.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(i=>!Re(r).call(r,i)));let e=this.filterTobeUnpublishedTracks(r);if(e.length===0)return;let t=e.find(i=>i[0]==="videoLowTrack");t&&t[1].track.close();let n=this.createGatewayUnpublishMessage(e);if(await this.sendConnection.stopSending(e.map(i=>{let[,{id:s}]=i;return s})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(i=>{let[s,{track:o}]=i;return{type:s,track:o}})),e.forEach(i=>{let[s]=i;this.statsCollector.removeLocalStats(s)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===He.Connected)return t&&t[1].track.close(),n;r.forEach(i=>{let s=this.pendingLocalTracks.indexOf(i);s!==-1&&this.pendingLocalTracks.splice(s,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let r=()=>{let e=[],t=[];Array.from(this.localTrackMap.entries()).forEach(n=>{let[i,{track:s,ssrcs:o}]=n,c={stream_type:vP(s,i),ssrcs:o};s._muted||!s._enabled?e.push(c):t.push(c)}),e.length>0&&e.forEach(n=>{On(this,ut.RequestMuteLocal,[n])}),t.length>0&&t.forEach(n=>{On(this,ut.RequestUnmuteLocal,[n])})};r(),this.uplinkStateUploadInterval=window.setInterval(()=>{r()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(r){return zl(function*(){throw new H(z.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(V.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Ys(this,ut.RequestRePublish,this.pendingLocalTracks),this.emit(ut.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new H(z.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(r,e,t,n){var i;if(!this.recvConnection)throw new H(z.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((i=this.remoteUserMap.get(r))!==null&&i!==void 0&&i.has(e))return;let{track:s,mid:o,transceiver:c}=await this.recvConnection.receive(e,[{ssrcId:t}],String(r.uid),n);e===vt.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(s):(r._audioTrack=new tf(s,r.uid,r._uintid,this.store),V.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),c&&r._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoSSRC=t,r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(s):(r._videoTrack=new Iv(s,r.uid,r._uintid,this.store),V.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),c&&r._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(r,r._videoTrack));let d=this.remoteUserMap.get(r);d?d.set(e,o):this.remoteUserMap.set(r,new Map([[e,o]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let u=this.pendingRemoteTracks.findIndex(p=>{let{user:m,kind:g}=p;return m.uid===r.uid&&e===g});u!==-1&&(this.pendingRemoteTracks.splice(u,1),this.emit(ut.MediaReconnectEnd,r.uid))}async mockSubscribe(r,e,t,n){if(!this.recvConnection)throw new H(z.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(e,[{ssrcId:t}],String(r.uid),n)}async unsubscribe(r,e,t){let n=this.pendingRemoteTracks.filter(s=>{let{user:o,kind:c}=s;return e!==void 0?o.uid===r.uid&&e===c:o.uid===r.uid});if(n.forEach(s=>{let o=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(o,1)}),this.recvConnection||t||n.forEach(s=>{let{kind:o}=s;var c;if(o===vt.AUDIO)(c=r._audioTrack)===null||c===void 0||c._destroy(),r._audioTrack=void 0;else if(o===vt.VIDEO){var d;(d=r._videoTrack)===null||d===void 0||d._destroy(),r._videoTrack=void 0}}),!this.recvConnection)return;let i=this.filterTobeUnSubscribedTracks(r,e);i.length!==0&&(await this.recvConnection.stopReceiving(i.map(s=>{let[,{id:o}]=s;return o})),this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach(s=>{let[o,{kind:c}]=s;var d,u;if(c===vt.VIDEO&&o._videoSSRC&&((d=this.recvConnection)===null||d===void 0||d.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),c===vt.VIDEO)this.unbindRemoteTrackEvents(o._videoTrack),t||((u=o._videoTrack)===null||u===void 0||u._destroy(),o._videoTrack=void 0);else if(c===vt.AUDIO){var p;this.unbindRemoteTrackEvents(o._audioTrack),!t&&((p=o._audioTrack)===null||p===void 0||p._destroy(),o._audioTrack=void 0)}}),i.forEach(s=>{let[,{kind:o}]=s;On(this,ut.RequestP2PMuteRemote,o)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let r=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,t]=e;[vt.VIDEO,vt.AUDIO].forEach(n=>{t.has(n)?On(this,ut.RequestP2PUnmuteRemote,n):On(this,ut.RequestP2PMuteRemote,n)})});r(),this.downlinkStatsUploadInterval=window.setInterval(()=>{r()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(r){throw new H(z.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(r){throw new H(z.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(r){throw new H(z.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(r){throw new H(z.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(r,e){if(!this.recvConnection)return;let t=this.remoteUserMap.get(r);if(!t)return void V.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(r.uid,"."));if(!t.get(e))return void V.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(r.uid," media type ").concat(e,"."));let n=e===vt.VIDEO?r._videoSSRC:r._audioSSRC;n!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(n,!1)}async unmuteRemote(r,e){return this.unmuteRemoteNoLock(r,e)}async unmuteRemoteNoLock(r,e){if(!this.recvConnection)return;let t=this.remoteUserMap.get(r);if(!t)return void V.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(r.uid,"."));t.get(e)||V.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(r.uid," media type ").concat(e,"."))}getAllTracks(r){let e=this.localTrackMap.get($e.LocalAudioTrack);if(e?.track instanceof Xs){let t=e.track;return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return i!==$e.LocalAudioTrack}).filter(n=>{let[i]=n;return!(r&&i===$e.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i}).concat(t.trackList)}return Array.from(this.localTrackMap.entries()).filter(t=>{let[n]=t;return!(r&&n===$e.LocalVideoLowTrack)}).map(t=>{let[,{track:n}]=t;return n})}reportPublishEvent(r,e,t,n,i){if(r){let o=this.localTrackMap.get($e.LocalAudioTrack),c=n?this.localTrackMap.get($e.LocalVideoLowTrack):this.localTrackMap.get($e.LocalVideoTrack);Ye.publish(this.store.sessionId,{eventElapse:ta.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:r,ec:e,audioName:o?.track.getTrackLabel(),videoName:c?.track.getTrackLabel(),screenshare:c?.track._hints.indexOf(rt.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var s;t||(t=[]);let o=t.find(d=>d instanceof ci),c=n?(s=this.localTrackMap.get($e.LocalVideoTrack))===null||s===void 0?void 0:s.track:t.find(d=>d instanceof Ei);Ye.publish(this.store.sessionId,{eventElapse:ta.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:r,ec:e,audioName:o?.getTrackLabel(),videoName:c?.getTrackLabel(),screenshare:c?._hints.indexOf(rt.SCREEN_TRACK)!==-1,audio:!!o,video:!!c,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(r,e,t,n){let i=n===vt.VIDEO?t._videoSSRC:t._audioSSRC;i&&Ye.subscribe(this.store.sessionId,{succ:r,ec:e,video:n===vt.VIDEO,audio:n===vt.AUDIO,peerid:t.uid,subscribeRequestid:n===vt.VIDEO?t._videoSSRC:t._audioSSRC,p2pid:this.store.p2pId,eventElapse:ta.measureFromSubscribeStart(this.store.clientId,i)})}reset(){V.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new ha("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new ha("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let r=this.localTrackMap.get($e.LocalAudioTrack);if(r?.track instanceof Xs){if(r.track.trackList.length>0){let e=r.track;r.track.trackList.forEach(t=>{e.removeAudioTrack(t)})}r.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=He.Disconnected}getStats(r){var e,t;return r?(t=this.recvConnection)===null||t===void 0?void 0:t.getStats():(e=this.sendConnection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(r){var e;return((e=this.recvConnection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(r))||!1}getLocalAudioVolume(){let r=this.localTrackMap.get($e.LocalAudioTrack);if(r)return r.track.getVolumeLevel()}getLocalVideoSize(){let r=this.localTrackMap.get($e.LocalVideoTrack);if(r)return{width:r.track.videoWidth||0,height:r.track.videoHeight||0}}getEncoderConfig(r){let e=this.localTrackMap.get(r);return e&&e.track instanceof Ei||e&&e.track instanceof ci?e.track._encoderConfig:void 0}getLocalMedia(r){return this.localTrackMap.get(r)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(r,e){if(!r)return this.remoteUserMap.size>0;let t=this.remoteUserMap.get(r);return!!t&&(!e||t.has(e))}async hasRemoteMediaWithLock(r,e){if(!r)return this.remoteUserMap.size>0;let t=this.remoteUserMap.get(r);return!!t&&(!e||t.has(e))}getRemoteMedia(r){var e;let t=Array.from(hl(e=this.remoteUserMap).call(e)).find(n=>n.uid===r);return t?{audioTrack:t.audioTrack,audioSSRC:t._audioSSRC,videoTrack:t.videoTrack,videoSSRC:t._videoSSRC}:{}}getAudioLevels(){let r=Array.from(this.remoteUserMap.entries()).map(t=>{let[n]=t;return{uid:n.uid,level:n.audioTrack?100*n.audioTrack._source.getAccurateVolumeLevel():0}}),e=this.localTrackMap.get($e.LocalAudioTrack);return e&&r.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),r=Zt(r).call(r,(t,n)=>t.level-n.level),r}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(V.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=He.Reconnecting,te("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(r=>{let[e]=r;var t;e._videoTrack&&e._videoTrack._player&&((t=e._videoTrack._player.getVideoElement())===null||t===void 0||t.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(r=>{var e;let[t,{track:n}]=r;switch(t){case $e.LocalVideoTrack:Re(e=n._hints).call(e,rt.LOW_STREAM)?n.close():this.pendingLocalTracks.push(n);break;case $e.LocalAudioTrack:n instanceof Xs?this.pendingLocalTracks=this.pendingLocalTracks.concat(n.trackList):this.pendingLocalTracks.push(n);case $e.LocalVideoLowTrack:}}),this.emit(ut.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(r=>{let[e,t]=r;Array.from(hl(t).call(t)).forEach(n=>{this.setPendingRemoteMedia(e,n)}),this.emit(ut.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),V.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(r,e){for(let t of this.pendingRemoteTracks){let{user:n,kind:i}=t;if((r instanceof Xm?r.uid:r)===n.uid&&e===i)return!0}return!1}setPendingRemoteMedia(r,e){this.hasPendingRemoteMedia(r,e)||this.pendingRemoteTracks.push({user:r,kind:e})}async restartICE(r,e){let t,n;if(r===an.SEND_ONLY){if(!this.sendConnection)throw new H(z.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");t=await this.sendMutex.lock("From P2PChannel.restartICE"),n=this.sendConnection}else{if(!this.recvConnection)throw new H(z.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");t=await this.recvMutex.lock("From P2PChannel.restartICE"),n=this.recvConnection}try{if(e){let i=await n.restartICE(e);return n.isInRestartIce=!1,i}{let i=await n.restartICE();if(i){let s=await Ys(this,ut.RequestP2PRestartICE,{direction:an.RECEIVE_ONLY,iceParameter:i});await n.restartICE(s),n.isInRestartIce=!1}}}finally{t()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let r=this.sendConnection.getStats(),e=this.localTrackMap.get($e.LocalVideoTrack),t=this.localTrackMap.get($e.LocalAudioTrack),n=r.videoSend.find(T=>{var R;return T.ssrc===(e==null||(R=e.ssrcs)===null||R===void 0?void 0:R[0].ssrcId)}),i=r.audioSend.find(T=>{var R;return T.ssrc===(t==null||(R=t.ssrcs)===null||R===void 0?void 0:R[0].ssrcId)});if(!n||!i)return 1;let s=ei(this,ut.NeedSignalRTT),o=n?n.rttMs:void 0,c=i?i.rttMs:void 0,d=o&&c?(o+c)/2:o||c,u=(d&&s?(d+s)/2:d||s)||0,p=100*r.sendPacketLossRate*.7/50+.3*u/1500,m=p<.17?1:p<.36?2:p<.59?3:p<.1?4:5,g=e?.track;if(g&&g._encoderConfig&&g._hints.indexOf(rt.SCREEN_TRACK)===-1){let T=g._encoderConfig.bitrateMax,R=r.bitrate.actualEncoded;if(T&&R){let I=(1e3*T-R)/(1e3*T);return b4[I<.15?0:I<.3?1:I<.45?2:I<.6?3:4][m]}}return m}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let r=this.recvConnection.getStats(),e=0;return Array.from(this.remoteUserMap.entries()).forEach(t=>{let[n]=t,i=n._audioSSRC,s=n._videoSSRC,o=r.audioRecv.find(R=>R.ssrc===i),c=r.videoRecv.find(R=>R.ssrc===s);if(!o&&!c)return void(e+=1);let d=ei(this,ut.NeedSignalRTT),u=r.rtt,p=(u&&d?(u+d)/2:u||d)||0,m=o?o.jitterMs:void 0,g=r.recvPacketLossRate,T=.7*g*100/50+.3*p/1500;m&&(T=.6*g*100/50+.2*p/1500+.2*m/400),e+=T<.1?1:T<.17?2:T<.36?3:T<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(r){return new De((e,t)=>{this.handleMuteLocalTrack(r,e,t)})}filterTobePublishedTracks(r,e,t){let n=[],i=on(),s=this.getAllTracks();r=Pm(r=r.filter(d=>s.indexOf(d)===-1));let o=!1,c=!1;for(let d of r){if(d instanceof Ei&&(this.localTrackMap.has($e.LocalVideoTrack)||o?new H(z.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(n.push({track:d,type:$e.LocalVideoTrack}),o=!0),e)){let u=this.getLowVideoTrack(d,t);n.push({track:u,type:$e.LocalVideoLowTrack})}if(d instanceof ci){let u=this.localTrackMap.get($e.LocalAudioTrack);if(u){if(!(u.track instanceof Xs))throw new H(z.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new H(z.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");u.track.addAudioTrack(d),this.bindLocalAudioTrackEvents(d,!0)}else if(c){let p=n.find(m=>{let{type:g}=m;return g===$e.LocalAudioTrack});if(!(p.track instanceof Xs))throw new H(z.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(d._bypassWebAudio)throw new H(z.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");p.track.addAudioTrack(d)}else{if(!i.webAudioMediaStreamDest||d instanceof Xs||d._bypassWebAudio)n.push({track:d,type:$e.LocalAudioTrack});else{let p=new Xs;p.addAudioTrack(d),n.push({track:p,type:$e.LocalAudioTrack})}c=!0}}}return n}filterTobeUnpublishedTracks(r){let e=[],t=this.getAllTracks();r=Pm(r=r.filter(n=>t.indexOf(n)!==-1));for(let n of r){if(n instanceof ci){let i=this.localTrackMap.get($e.LocalAudioTrack);if(!i)continue;i.track instanceof Xs?(i.track.removeAudioTrack(n),this.unbindLocalAudioTrackEvents(n),i.track.trackList.length===0&&(e.push([$e.LocalAudioTrack,i]),i.track.close())):e.push([$e.LocalAudioTrack,i])}if(n instanceof Ei){let i=this.localTrackMap.get($e.LocalVideoTrack);if(!i)continue;e.push([$e.LocalVideoTrack,i]);let s=this.localTrackMap.get($e.LocalVideoLowTrack);s&&e.push([$e.LocalVideoLowTrack,s])}}return e}bindLocalTrackEvents(r){r.forEach(e=>{let{track:t,type:n}=e;switch(n){case $e.LocalVideoTrack:t.addListener(It.GET_STATS,this.handleGetLocalVideoStats),t.addListener(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(It.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(It.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.addListener(It.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case $e.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(r,e){r instanceof Xs?r.trackList.forEach(t=>{t.addListener(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(It.GET_STATS,this.handleGetLocalAudioStats),t.addListener(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(r.addListener(It.GET_STATS,this.handleGetLocalAudioStats),r.addListener(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||r.addListener(It.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(r){r||(r=Array.from(this.localTrackMap.entries()).map(e=>{let[t,{track:n}]=e;return{track:n,type:t}})),r.forEach(e=>{let{track:t,type:n}=e;switch(n){case $e.LocalVideoTrack:t.off(It.GET_STATS,this.handleGetLocalVideoStats),t.off(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(It.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(It.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),t.off(It.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $e.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case $e.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(r){r instanceof Xs?r.trackList.forEach(e=>{e.off(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(It.GET_STATS,this.handleGetLocalAudioStats),e.off(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(r.off(It.GET_STATS,this.handleGetLocalAudioStats),r.off(It.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(It.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(It.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(It.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(It.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(r,e){e instanceof Iv&&e.addListener(It.GET_STATS,t=>{t(this.handleGetRemoteVideoStats(r))}),e instanceof tf&&e.addListener(It.GET_STATS,t=>{t(this.handleGetRemoteAudioStats(r))})}unbindRemoteTrackEvents(r){r&&r.removeAllListeners(It.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(r=>{let[e,t]=r;t.has(vt.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),t.has(vt.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(r,e){return r.map((t,n)=>{var i;let s,{track:o,type:c}=t;switch(c){case $e.LocalAudioTrack:s=vi.Audio;break;case $e.LocalVideoTrack:s=Re(i=o._hints).call(i,rt.SCREEN_TRACK)?vi.Screen:vi.High;break;case $e.LocalVideoLowTrack:s=vi.Low}return{kind:c===$e.LocalAudioTrack?vt.AUDIO:vt.VIDEO,stream_type:s,mid:e[n].id,ssrcs:e[n].localSSRC,isMuted:o.muted||!o.enabled}})}createGatewayUnpublishMessage(r){return r.map(e=>{var t;let n,[i,{track:s,ssrcs:o,id:c}]=e;switch(i){case $e.LocalVideoTrack:n=Re(t=s._hints).call(t,rt.SCREEN_TRACK)?vi.Screen:vi.High;break;case $e.LocalAudioTrack:n=vi.Audio;break;case $e.LocalVideoLowTrack:n=vi.Low}return{stream_type:n,ssrcs:o,mid:c}})}assignLocalTracks(r,e){r.forEach((t,n)=>{let{track:i,type:s}=t;this.localTrackMap.set(s,{track:i,id:e[n].id,ssrcs:e[n].localSSRC})})}withdrawLocalTracks(r){r.forEach(e=>{let[t]=e;this.localTrackMap.delete(t)})}bindConnectionEvents(r){r.onConnectionStateChange=async e=>{var t;V.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(r.name,".onConnectionStateChange(").concat(e,")")),this.emit(ut.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(r.isInRestartIce=!1),Re(t=this._restartStates).call(t,e)&&!r.isInRestartIce&&(e==="disconnected"&&await Jo(800),r.iceConnectionState!=="disconnected"&&r.iceConnectionState!=="failed"||this.handleDisconnect(r.direction))},r.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),V.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Ye.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:Cn.TRACER}).onSuccess(),this.emit(ut.IceConnectionStateChange,e)},r.onICETransportStateChange=e=>{V.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},r.onDTLSTransportStateChange=e=>{V.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},r.onDTLSTransportError=e=>{V.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},r.onFirstAudioDecoded=e=>{var t;let n=Array.from(hl(t=this.remoteUserMap).call(t)).find(s=>s._audioSSRC===e);var i;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),(i=n.audioTrack)===null||i===void 0||i.emit(Tc.FIRST_FRAME_DECODED),Ye.firstRemoteFrame(this.store.sessionId,so.FIRST_AUDIO_DECODE,Nn.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:ta.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},r.onFirstAudioReceived=e=>{var t;let n=Array.from(hl(t=this.remoteUserMap).call(t)).find(i=>i._audioSSRC===e);n&&Ye.firstRemoteFrame(this.store.sessionId,so.FIRST_AUDIO_RECEIVED,Nn.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:ta.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},r.onFirstVideoDecoded=(e,t,n)=>{this.reportVideoFirstFrameDecoded(e,t,n)},r.onFirstVideoReceived=e=>{var t;let n=Array.from(hl(t=this.remoteUserMap).call(t)).find(i=>i._videoSSRC===e);n&&Ye.firstRemoteFrame(this.store.sessionId,so.FIRST_VIDEO_RECEIVED,Nn.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:ta.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},r.onSelectedLocalCandidateChanged=(e,t)=>{let n=e.candidateType==="relay",i=t.candidateType==="relay";t.candidateType!=="unknown"&&n===i||this.emit(ut.ConnectionTypeChange,n),V.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(v_(t))," -> ").concat(JSON.stringify(v_(e)),")"))},r.onSelectedRemoteCandidateChanged=(e,t)=>{V.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(v_(t))," -> ").concat(JSON.stringify(v_(e)),")"))},r.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},r.onLocalCandidate=e=>{this.emit(ut.LocalCandidate,{candidate:e,direction:r.direction})}}unbindConnectionEvents(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.onLocalCandidate=void 0}async handleDisconnect(r){let e=r===an.SEND_ONLY?this.sendConnection:this.recvConnection;e&&!e.isInRestartIce&&(e.isInRestartIce=!0,V.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(e.name,"] start use restartICE")),r===an.SEND_ONLY?this.restartICE(r):Ys(this,ut.RequestP2PRestartICE,{direction:an.SEND_ONLY}))}filterTobeMutedTracks(r){let e=[];if(this.getAllTracks().indexOf(r)===-1)return e;let t=this.localTrackMap.get($e.LocalAudioTrack);if(r instanceof ci&&t?.track instanceof Xs)return t.track.isActive||e.push([$e.LocalAudioTrack,t]),e;let n=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return r===s});if(n&&(e.push(n),n[0]===$e.LocalVideoTrack)){let i=this.localTrackMap.get($e.LocalVideoLowTrack);i&&e.push([$e.LocalVideoLowTrack,i])}return e}filterTobeUnmutedTracks(r){let e=[],t=this.localTrackMap.get($e.LocalAudioTrack);if(r instanceof ci&&t?.track instanceof Xs)return t.track.isActive&&e.push([$e.LocalAudioTrack,t]),e;let n=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:s}]=i;return r===s});if(n)if(n[0]===$e.LocalVideoTrack){e.push(n);let i=this.localTrackMap.get($e.LocalVideoLowTrack);i&&e.push([$e.LocalVideoLowTrack,i])}else e.push(n);return e}createMuteMessage(r){return r.map(e=>{var t;let n,[i,{track:s,ssrcs:o,id:c}]=e;switch(i){case $e.LocalAudioTrack:n=vi.Audio;break;case $e.LocalVideoTrack:n=Re(t=s._hints).call(t,rt.SCREEN_TRACK)?vi.Screen:vi.High;break;case $e.LocalVideoLowTrack:n=vi.Low}return{stream_type:n,ssrcs:o,mid:c}})}createUnmuteMessage(r){return r.map(e=>{var t;let n,[i,{track:s,ssrcs:o,id:c}]=e;switch(i){case $e.LocalAudioTrack:n=vi.Audio;break;case $e.LocalVideoTrack:n=Re(t=s._hints).call(t,rt.SCREEN_TRACK)?vi.Screen:vi.High;break;case $e.LocalVideoLowTrack:n=vi.Low}return{stream_type:n,ssrcs:o,mid:c}})}filterTobeUnSubscribedTracks(r,e){let t=[],n=this.remoteUserMap.get(r);if(!n)return t;if(e){let i=n.get(e);if(!i)return t;t.push([r,{kind:e,id:i}])}else Array.from(n.entries()).forEach(i=>{let[s,o]=i;t.push([r,{kind:s,id:o}])});return t}createUnsubscribeMessage(r){let e=[];return r.forEach(t=>{let[n,{kind:i,id:s}]=t;switch(i){case vt.VIDEO:return void(n._videoSSRC&&e.push({stream_type:vt.VIDEO,ssrcId:n._videoSSRC}));case vt.AUDIO:return void(n._audioSSRC&&e.push({stream_type:vt.AUDIO,ssrcId:n._audioSSRC}))}}),e}withdrawRemoteTracks(r){r.forEach(e=>{let[t,{kind:n}]=e,i=this.remoteUserMap.get(t);i&&(i.delete(n),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(t))})}async updateBitrateLimit(r){let e=this.localTrackMap.get($e.LocalVideoTrack),t=this.localTrackMap.get($e.LocalVideoLowTrack);e&&(await e.track.setBitrateLimit(r.uplink),await new De((n,i)=>{this.handleUpdateVideoEncoder(e.track,n,i,!0)})),t&&r.low_stream_uplink&&(await t.track.setBitrateLimit({max_bitrate:r.low_stream_uplink.bitrate,min_bitrate:r.low_stream_uplink.bitrate||0}),await new De((n,i)=>{this.handleUpdateVideoEncoder(t.track,n,i,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let r=this.sendConnection.peerConnectionState,e=this.recvConnection.peerConnectionState;return r!=="connected"&&e!=="connected"}return!0}async tryToUnmuteAudio(r){for(let e=0;e<r.length;e++)if(r[e]instanceof ci){let t=this.filterTobeUnmutedTracks(r[e]);if(t.length===0)continue;let n=this.createUnmuteMessage(t);return void await On(this,ut.RequestUnmuteLocal,n)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=r=>this.getStats(r),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(r=>{let[,{ssrcs:e}]=r;return!!e}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=r=>{var e;return!((e=this.recvConnection)===null||e===void 0||!e.getRemoteVideoIsReady(r))},this.statsUploader.requestUpload=(r,e)=>this.emit(ut.RequestUpload,r,e),this.statsUploader.requestUploadStats=r=>this.emit(ut.RequestUploadStats,r),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Jo(Es(this.dtlsFailedCount,zr)),this.emit(ut.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has($e.LocalVideoTrack)||this.pendingLocalTracks.some(r=>r instanceof Ei)}throwIfTrackTypeNotMatch(r){if(r.filter(e=>e instanceof Ei).length>1)throw new H(z.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r.filter(e=>e instanceof ci).length>1&&(r.some(e=>e instanceof ci&&e._bypassWebAudio)||!on().webAudioMediaStreamDest))throw new H(z.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let e of r){if(e instanceof Ei&&this.pendingLocalTracks.some(t=>t instanceof Ei))throw new H(z.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof ci&&this.pendingLocalTracks.some(t=>t instanceof ci)&&(!on().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(t=>t instanceof ci&&t._bypassWebAudio)))throw new H(z.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(r,e){let t=!te("DISABLE_DUAL_STREAM_USE_ENCODING")&&on().supportDualStreamEncoding,n=M0(M0({},{width:160,height:120,framerate:15,bitrate:50}),e),i;i=t?r._mediaStreamTrack.clone():cc(r,n);let s=In(8,"track-low-"),o=new Ei(i,M0(M0({},t&&{scaleResolutionDownBy:lP(n,r)}),{},{frameRate:n.framerate,bitrateMax:n.bitrate,bitrateMin:n.bitrate}),void 0,void 0,s);return o.on(Rv.TRANSCEIVER_UPDATED,c=>{r._updateRtpTransceiver(c,Ni.LOW_STREAM)}),o._hints.push(rt.LOW_STREAM),r.addListener(It.NEED_CLOSE,()=>{o.close()}),o}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(r,e,t,n){var i;let s=Array.from(hl(i=this.remoteUserMap).call(i)).find(o=>o._videoSSRC===r);if(s){n||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());let o=this.store.keyMetrics,c=o.subscribe.find(d=>d.userId===s.uid&&d.type==="video");Ye.firstRemoteVideoDecode(this.store.sessionId,so.FIRST_VIDEO_DECODE,Nn.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:e,videoheight:t,subscribeElapse:ta.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId,apEnd:o.requestAPEnd||0,apStart:o.requestAPStart||0,joinGwEnd:o.joinGatewayEnd||0,joinGwStart:o.joinGatewayStart||0,pcEnd:o.peerConnectionEnd||0,pcStart:o.peerConnectionStart||0,subscriberEnd:c?.subscribeEnd||0,subscriberStart:c?.subscribeStart||0,videoAddNotify:c?.streamAdded||0,state:n?1:0})}}async remoteMediaSsrcChanged(r,e,t){if(!this.recvConnection)return!1;let n=this.remoteUserMap.get(r);if(!n)return!1;let i=n.get(e);if(!i)return!1;let s=await this.recvConnection.getRemoteSSRC(i);return s!==void 0&&s!==t}isPreSubScribe(r){return!1}async publishDataChannel(r){throw new H(z.NOT_SUPPORTED)}async unpublishDataChannel(r){throw new H(z.NOT_SUPPORTED)}async subscribeDataChannel(r,e){throw new H(z.NOT_SUPPORTED)}async unsubscribeDataChannel(r,e){throw new H(z.NOT_SUPPORTED)}hasPendingRemoteDataChannel(r,e){throw new H(z.NOT_SUPPORTED)}setPendingRemoteDataChannel(r,e){throw new H(z.NOT_SUPPORTED)}async preConnect(r){throw new H(z.NOT_SUPPORTED)}getEstablishParams(){throw new H(z.NOT_SUPPORTED)}async reSubscribe(r){throw new H(z.NOT_SUPPORTED)}reportVideoFirstFrameRender(r){}async updateVideoStreamParameter(r,e){throw new H(z.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(r=>{let[e,{track:t}]=r;e===$e.LocalVideoLowTrack?t._updateRtpTransceiver(void 0,Ni.LOW_STREAM):t._updateRtpTransceiver(void 0)})}},Dt(Cr.prototype,"p2pConnect",[Uh],Object.getOwnPropertyDescriptor(Cr.prototype,"p2pConnect"),Cr.prototype),Dt(Cr.prototype,"unpublish",[dj],Object.getOwnPropertyDescriptor(Cr.prototype,"unpublish"),Cr.prototype),Dt(Cr.prototype,"unpublishLowStream",[uj],Object.getOwnPropertyDescriptor(Cr.prototype,"unpublishLowStream"),Cr.prototype),Dt(Cr.prototype,"subscribe",[hj],Object.getOwnPropertyDescriptor(Cr.prototype,"subscribe"),Cr.prototype),Dt(Cr.prototype,"mockSubscribe",[pj],Object.getOwnPropertyDescriptor(Cr.prototype,"mockSubscribe"),Cr.prototype),Dt(Cr.prototype,"unsubscribe",[fj],Object.getOwnPropertyDescriptor(Cr.prototype,"unsubscribe"),Cr.prototype),Dt(Cr.prototype,"muteRemote",[_j],Object.getOwnPropertyDescriptor(Cr.prototype,"muteRemote"),Cr.prototype),Dt(Cr.prototype,"unmuteRemote",[mj],Object.getOwnPropertyDescriptor(Cr.prototype,"unmuteRemote"),Cr.prototype),Dt(Cr.prototype,"hasRemoteMediaWithLock",[Ej],Object.getOwnPropertyDescriptor(Cr.prototype,"hasRemoteMediaWithLock"),Cr.prototype),Dt(Cr.prototype,"disconnectForReconnect",[gj],Object.getOwnPropertyDescriptor(Cr.prototype,"disconnectForReconnect"),Cr.prototype),Dt(Cr.prototype,"remoteMediaSsrcChanged",[Sj],Object.getOwnPropertyDescriptor(Cr.prototype,"remoteMediaSsrcChanged"),Cr.prototype),Cr);function gf(r){return function(e,t,n){let i=e[t];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){for(var s=arguments.length,o=new Array(s),c=0;c<s;c++)o[c]=arguments[c];switch(r){case Ea.SEND_ONLY:{let d=await this.sendMutex.lock("From P2PChannel2.".concat(t));try{return await i.apply(this,o)}finally{d()}}case Ea.RECEIVE_ONLY:{let d=await this.recvMutex.lock("From P2PChannel2.".concat(t));try{return await i.apply(this,o)}finally{d()}}default:{let d=await this.sendMutex.lock("From P2PChannel2.".concat(t)),u=await this.recvMutex.lock("From P2PChannel2.".concat(t));try{return await i.apply(this,o)}finally{d(),u()}}}},n}}class qc extends Sr{constructor(e,t){super(),Z(this,"signal",void 0),Z(this,"token",void 0),Z(this,"tokenTimeout",void 0),Z(this,"tokenInterval",void 0),Z(this,"_sequence",0),Z(this,"userMap",new Map),Z(this,"encoder",new TextEncoder),this.signal=e,this.token=t;let n=()=>{this.signal.connectionState===gt.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(n,1e3):this.tokenInterval=window.setTimeout(n,3*te("P2P_TOKEN_INTERVAL"))};n()}async send(e,t,n,i,s){var o;if(this.userMap.size===0)return;let c=Array.from(cs(o=this.userMap).call(o))[0].token;typeof t!="string"&&(t=JSON.stringify(t)),i=i??In(6,""),s=s??this._sequence++;let d={_id:i,_type:e,_seq:s,_message:t,token:"".concat(this.token,"_").concat(c)};te("SHOW_P2P_LOG")&&V.debug("send message",d,"noNeedResponse : ".concat(n)),this.splitMessage(JSON.stringify(d)).forEach(p=>{this.signal.request(st.DATA_STREAM,{payload:bd(this.encoder.encode(p))})});let u=new De((p,m)=>{let g=window.setTimeout(()=>{this.off("res-@".concat(i,"_ack"),T),this.off("res-@".concat(i),I),this.off(Mr.ABORT,R),V.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(i)),this.userMap.size===0?m(new H(z.INVALID_REMOTE_USER)):m(new H(z.TIMEOUT))},te("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),T=()=>{g&&window.clearTimeout(g),this.off(Mr.ABORT,R),n&&p()},R=()=>{g&&window.clearTimeout(g),this.off("res-@".concat(i,"_ack"),T),this.off("res-@".concat(i),I),m(new H(z.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(i)))};this.once(Mr.ABORT,R),this.once("res-@".concat(i,"_ack"),T);let I=(w,k)=>{A=!0,g&&window.clearTimeout(g),this.off("res-@".concat(i,"_ack"),T),this.off(Mr.ABORT,R),w==="success"?p(k):m(new H(z.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(i)))},A=!1;n||(this.once("res-@".concat(i),I),Jo(te("SIGNAL_REQUEST_TIMEOUT")).then(()=>{A||V.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(i,", ").concat(d))}))});try{return await u}catch(p){if(p.code===z.TIMEOUT)return await this.send(e,t,n,i,s);throw p}}onMessage(e){var t;let{_uid:n}=e,i,s=this.userMap.get(n);if(s)i=s.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==Lr.CHECK)return;let{token:u}=e;i=new Map,s={uid:n,isStart:!0,token:u,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(n,s),this.signal.emit(Ln.ON_USER_ONLINE,{uid:n}),this.handleUserOnline()}if("id"in e&&"total"in e){var o;let{id:u,total:p}=e,m=(o=i.get(u))!==null&&o!==void 0?o:[];if(m.push(e),i.has(u)||i.set(u,m),m.length!==p)return;{let g=Zt(m).call(m,(T,R)=>T.index-R.index).map(T=>T.payload).join("");i.delete(u),(e=JSON.parse(g))._uid=n}}let{_type:c,token:d}=e;if(Re(t=[Lr.ACK,Lr.CHECK]).call(t,c))return c===Lr.CHECK&&this.handleCheckToken(s,d),void this.receiveMessage(e);d==="".concat(s.token,"_").concat(this.token)?this.handleReceivedMessage(e):V.debug('Receive unexpected message", '.concat(d,", cur_token: ").concat(s.token,"_").concat(this.token),e)}check(){let e={_id:In(6,""),token:this.token,_type:Lr.CHECK};te("SHOW_P2P_LOG")&&V.debug("send message",e),this.signal.request(st.DATA_STREAM,{payload:bd(this.encoder.encode(JSON.stringify(e)))})}ack(e){let t={_id:e,_type:Lr.ACK,token:this.token};te("SHOW_P2P_LOG")&&V.debug("send message",t),this.signal.request(st.DATA_STREAM,{payload:bd(this.encoder.encode(JSON.stringify(t)))})}response(e,t,n){this.send(Lr.RESPONSE,JSON.stringify({success:!n,message:t}),!0,e)}handleReceivedMessage(e){let t=()=>{this.userMap.forEach(u=>{let{receivedMessagesMap:p,nextExpectedSequenceNumber:m}=u;for(;p.has(m);){let g=p.get(m);p.delete(m),this.receiveMessage(g),u.nextExpectedSequenceNumber++}})};if(!e)return void t();let{_uid:n,_seq:i}=e,s=this.userMap.get(n),{receivedMessagesMap:o,isStart:c,nextExpectedSequenceNumber:d}=s;if(i<d)return this.ack(e._id),void V.debug("[external-signal] receive old message, seq: ".concat(i,", ").concat(e._message));o.set(i,e),c&&i===d&&(this.receiveMessage(e),o.delete(d),s.nextExpectedSequenceNumber++,t())}receiveMessage(e){let{_id:t,_type:n,_message:i,_uid:s}=e;if(te("SHOW_P2P_LOG")&&V.debug("receive message",e),t){let o;switch(e._type!==Lr.ACK&&(i&&(o=JSON.parse(i)),this.ack(e._id)),e._type){case Lr.CANDIDATE:case Lr.CONTROL:this.signal.emit(n,o,s);break;case Lr.PUBLISH:case Lr.UNPUBLISH:case Lr.RESTART_ICE:case Lr.CALL:o.uid=s,Ys(this.signal,n,o).then(c=>{this.response(e._id,c)}).catch(()=>{this.response(e._id,void 0,!0)});break;case Lr.ACK:this.getListeners("res-@".concat(t,"_ack")).length>0&&this.emit("res-@".concat(t,"_ack"));break;case Lr.RESPONSE:{let{success:c,message:d}=o;this.emit("res-@".concat(t),c?"success":"failed",d);break}}}}splitMessage(e){if(e.length<qc.MAX_MESSAGE_SIZE)return[e];let t=[],{remoteToken:n}=JSON.parse(e),i=In(6,""),s=0,o=800,c=Math.ceil(e.length/o);for(;e.length>0;){s++;let d={id:i,index:s,total:c,payload:e.slice(0,o),token:"".concat(this.token,"_").concat(n)};JSON.stringify(d).length>qc.MAX_MESSAGE_SIZE?o-=50:(t.push(d),e=e.slice(o))}return t.map(d=>JSON.stringify(d))}handleCheckToken(e,t){return e.token!==t?(V.debug("token changed, from ".concat(e.token," to ").concat(t)),this.reset(e.uid,t),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{V.debug("token timeout, ".concat(t)),this.reset(e.uid)},te("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){let e=await Ys(this.signal,Lr.CALL,void 0),t=await this.send(Lr.CALL,e);this.signal.emit(Pt.P2P_CONNECTION,t,!0)}async reset(e,t){let n=this.userMap.get(e);n&&(this.emit(Mr.ABORT),this.signal.emit(Ln.ON_USER_OFFLINE,{uid:n.uid,reason:Jg.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),t||(V.debug("change local token from ".concat(t," to ").concat(t)),this.token=In(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Mr.ABORT)}}Z(qc,"MAX_SIZE",1),Z(qc,"MAX_MESSAGE_SIZE",1024);class qv extends Sr{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===gt.CONNECTED?this.emit(Pt.WS_CONNECTED):e===gt.RECONNECTING?this.emit(Pt.WS_RECONNECTING,this._websocketReconnectReason):e===gt.CLOSED&&this.emit(Pt.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),Z(this,"_disconnectedReason",void 0),Z(this,"_websocketReconnectReason",void 0),Z(this,"_connectionState",gt.CLOSED),Z(this,"reconnectToken",void 0),Z(this,"p2pToken",void 0),Z(this,"websocket",void 0),Z(this,"openConnectionTime",void 0),Z(this,"clientId",void 0),Z(this,"lastMsgTime",Date.now()),Z(this,"uploadCache",[]),Z(this,"uploadCacheInterval",void 0),Z(this,"rttRolling",new bw(5)),Z(this,"pingpongTimer",void 0),Z(this,"pingpongTimeoutCount",0),Z(this,"joinResponse",void 0),Z(this,"multiIpOption",void 0),Z(this,"initError",void 0),Z(this,"spec",void 0),Z(this,"store",void 0),Z(this,"_external_signal",void 0),Z(this,"onWebsocketMessage",n=>{if(n.data instanceof ArrayBuffer)return void this.emit(Pt.ON_BINARY_DATA,n.data);let i=JSON.parse(n.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){let s="res-@".concat(i._id);this.emit(s,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){switch(i._type){case Ln.ON_DATA_STREAM:return void this.handleDataStream(i._message);case Ln.MUTE_AUDIO:case Ln.MUTE_VIDEO:case Ln.ON_P2P_LOST:case Ln.ON_USER_ONLINE:return;case Ln.ON_USER_OFFLINE:let{uid:s}=i._message;return V.debug("[".concat(this.clientId,"] user-offline uid: ").concat(s)),void this._external_signal.reset(s)}if(this.emit(i._type,i._message),i._type===Ln.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Ln.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(Di.UID_BANNED);break;case 15:this.close(Di.IP_BANNED);break;case 16:this.close(Di.CHANNEL_BANNED)}if(i._type===Ln.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case Mt.ERR_LICENSE_MISSING:this.close(Di.LICENSE_MISSING);break;case Mt.ERR_LICENSE_EXPIRED:this.close(Di.LICENSE_EXPIRED);break;case Mt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Di.LICENSE_MINUTES_EXCEEDED);break;case Mt.ERR_LICENSE_PERIOD_INVALID:this.close(Di.LICENSE_PERIOD_INVALID);break;case Mt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Di.LICENSE_MULTIPLE_SDK_SERVICE);break;case Mt.ERR_LICENSE_ILLEGAL:this.close(Di.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new cP("gateway-".concat(this.clientId),this.spec.retryConfig,!0,te("JOIN_GATEWAY_USE_DUAL_DOMAIN"),te("JOIN_GATEWAY_USE_443PORT_ONLY"),t),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===gt.CONNECTED&&this.reconnect("retry",$t.OFFLINE)}),this.p2pToken=In(6,""),this._external_signal=new qc(this,this.p2pToken)}async request(e,t,n,i){let s=In(6,""),o={_id:s,_type:e,_message:t},c=this.websocket.connectionID,d=()=>new De((R,I)=>{if(this.connectionState===gt.CONNECTED)return R();let A=()=>{this.off(Pt.WS_CLOSED,w),R()},w=()=>{this.off(Pt.WS_CONNECTED,A),I(new H(z.WS_ABORT))};this.once(Pt.WS_CONNECTED,A),this.once(Pt.WS_CLOSED,w)});if(this.connectionState!==gt.CONNECTING&&this.connectionState!==gt.RECONNECTING||e===st.JOIN||e===st.REJOIN||await d(),this.websocket.sendMessage(o,!0),i)return;let u=new De((R,I)=>{let A=!1,w=(L,j)=>{A=!0,R({isSuccess:L==="success",message:j||{}}),this.off(Pt.WS_CLOSED,k),this.off(Pt.WS_RECONNECTING,k),this.emit(Pt.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(s),w);let k=()=>{I(new H(z.WS_ABORT,"type: ".concat(e))),this.off(Pt.WS_CLOSED,k),this.off(Pt.WS_RECONNECTING,k),this.off("res-@".concat(s),w)};this.once(Pt.WS_CLOSED,k),this.once(Pt.WS_RECONNECTING,k),Jo(te("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==c||A||(V.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(Pt.REQUEST_TIMEOUT,e,t))})}),p=null;try{p=await u}catch(R){if(this.connectionState===gt.CLOSED||e===st.LEAVE)throw new H(z.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?R.throw():e===st.JOIN||e===st.REJOIN?null:(await d(),await this.request(e,t))}if(p.isSuccess)return p.message;let m=Number(p.message.error_code||p.message.code),g=Yw(m),T=new H(z.UNEXPECTED_RESPONSE,"".concat(g.desc,": ").concat(p.message.error_str),{code:m,data:p.message,desc:g.desc});return g.action==="success"?p.message:(V.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(m,", message: ").concat(g.desc,", action: ").concat(g.action)),m===Mt.ERR_TOO_MANY_BROADCASTERS?((e===st.JOIN||e===st.REJOIN)&&(this.initError=T,this.close()),T.throw()):g.action==="failed"?T.throw():g.action==="quit"?(this.initError=T,this.close(),T.throw()):(m===Mt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=p.message.option,V.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",$t.MULTI_IP)):this.reconnect(g.action,$t.SERVER_ERROR),e===st.JOIN||e===st.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new De(n=>{let i=s=>{(!t||t(s))&&(this.off(e,i),n(s))};this.on(e,i)})}uploadWRTCStats(e){if(!this.store.sessionId)return void V.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let t={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Yt.WRTC_STATS,t)}upload(e,t){let n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch{let i=te("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>i&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==gt.CONNECTED)return;let s=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(s._type,s._message)},te("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){let n={_type:e,_message:t};this.websocket.sendMessage(n)}async sendExtensionMessage(e,t,n){return await this._external_signal.send(e,t,n)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new De((t,n)=>{this.once(Pt.WS_CONNECTED,()=>t(this.joinResponse)),this.once(Pt.WS_CLOSED,()=>n(this.initError||new H(z.WS_ABORT))),this.connectionState=gt.CONNECTING,this.websocket.init(e).catch(n)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||Di.LEAVE,this.connectionState=gt.CLOSED,V.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=In(6,""),this._external_signal.clear(),this._external_signal=new qc(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Pt.ABORT_P2P_EXECUTION);let e=await Ys(this,Pt.REQUEST_JOIN_INFO),t=await this.request(st.JOIN,e);if(!t)return this.emit(Pt.REPORT_JOIN_GATEWAY,z.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(Pt.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=gt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}async downgradeCodec(e){return!1}handleDataStream(e){try{var t;let n=Cd(e.payload),i=new TextDecoder().decode(n),s=JSON.parse(i);"total"in s&&"id"in s||Re(t=Object.values(Lr)).call(t,s._type)?(s._uid=e.uid,this._external_signal.onMessage(s)):this.emit(Ln.ON_DATA_STREAM,e)}catch{this.emit(Ln.ON_DATA_STREAM,e)}}handleNotification(e){V.debug("[".concat(this.clientId,"] receive notification: "),e);let t=Yw(e.code);if(t.action!=="success"){if(t.action!=="failed")return t.action==="quit"?(t.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Di.UID_BANNED),void this.close()):void this.reconnect(t.action,$t.SERVER_ERROR);V.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let e=te("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(V.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>te("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",$t.TIMEOUT):this.request(st.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let n=Date.now()-t;this.rttRolling.add(n),te("REPORT_STATS")&&this.send(st.PING_BACK,{pingpongElapse:n})}).catch(n=>{})}handleWebsocketEvents(){this.websocket.on(Wt.RECONNECT_CREATE_CONNECTION,e=>{this.emit(Pt.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(Wt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Wt.CLOSED,()=>{this.connectionState=gt.CLOSED}),this.websocket.on(Wt.FAILED,()=>{this._disconnectedReason=Di.NETWORK_ERROR,this.connectionState=gt.CLOSED}),this.websocket.on(Wt.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===gt.CONNECTED?this.connectionState=gt.RECONNECTING:this.connectionState=gt.CONNECTING}),this.websocket.on(Wt.WILL_RECONNECT,(e,t,n)=>{e!=="retry"?(V.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):V.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),n(e)}),this.websocket.on(Wt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(Pt.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof H&&e.code===z.UNEXPECTED_RESPONSE&&e.data.code===Mt.ERR_NO_AUTHORIZED)return V.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",$t.SERVER_ERROR);V.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",$t.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(Wt.REQUEST_NEW_URLS,(e,t)=>{Ys(this,Pt.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)}),this.websocket.on(Wt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Ln.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}let nq={name:"P2PChannel",create:function(r){let{store:e,statsCollector:t}=r;return new Ek(e,t)},createSubmodule:function(r){let{store:e,spec:t}=r;return new qv(t,e)}};function M6(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function Tj(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?M6(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):M6(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}class U6{constructor(e){Z(this,"sessionDesc",void 0),Z(this,"localCapabilities",void 0),Z(this,"rtpCapabilities",void 0),Z(this,"candidates",void 0),Z(this,"_originCandidates",void 0),Z(this,"iceParameters",void 0),Z(this,"dtlsParameters",void 0),Z(this,"setup",void 0),Z(this,"currentMidIndex",void 0),Z(this,"cname",void 0),e=sr(e);let{iceParameters:t,dtlsParameters:n,candidates:i,rtpCapabilities:s,setup:o,localCapabilities:c,sdkCodec:d,cname:u}=e,p=Wc(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=s,this.candidates=i,this._originCandidates=sr(i),this.iceParameters=t,this.dtlsParameters=n,this.setup=o,this.localCapabilities=c,this.cname=u;for(let m=0;m<p.mediaDescriptions.length;m++){let g=p.mediaDescriptions[m];if(g.attributes.iceUfrag=t.iceUfrag,g.attributes.icePwd=t.icePwd,g.attributes.fingerprints=n.fingerprints,g.attributes.candidates=i,g.attributes.setup=o,g.media.mediaType==="video"){g.media.fmts=s.videoCodecs.map(I=>I.payloadType.toString(10));let T=s.videoCodecs.filter(I=>{var A,w;return(A=I.rtpMap)===null||A===void 0?void 0:Re(w=A.encodingName.toLowerCase()).call(w,d)}),R=s.videoCodecs.filter(I=>!Re(T).call(T,I));g.attributes.payloads=[...T,...R],g.attributes.extmaps=s.videoExtensions}g.media.mediaType==="audio"&&(g.media.fmts=s.audioCodecs.map(T=>T.payloadType.toString(10)),g.attributes.payloads=s.audioCodecs,g.attributes.extmaps=s.audioExtensions),p.mediaDescriptions[m]=this.mungMediaDesc(g)}this.sessionDesc=p,this.currentMidIndex=p.mediaDescriptions.length-1}toString(){return Qo(this.sessionDesc)}send(e,t,n){let{ssrcs:i,ssrcGroups:s}=jC(t,this.cname),o=this.sessionDesc.mediaDescriptions.find(u=>e===vt.VIDEO?u.media.mediaType==="video":u.media.mediaType==="audio"),c=i[0].attributes.label,d=i[0].attributes.mslabel;return o.attributes.ssrcs=o.attributes.ssrcs.concat(i),o.attributes.ssrcGroups=o.attributes.ssrcGroups.concat(s),{id:c,mslabel:d}}batchSend(e){return e.map(t=>{let{kind:n,ssrcMsg:i}=t;return this.send(n,i,void 0)})}stopSending(e){this.sessionDesc.mediaDescriptions.forEach(t=>{let n=[],i=[],s=[];t.attributes.ssrcs.forEach(o=>{Re(e).call(e,o.attributes.label||"")?s.push(o):n.push(o)}),t.attributes.ssrcGroups.forEach(o=>{var c;Re(c=s.map(d=>d.ssrcId)).call(c,o.ssrcIds[0])||i.push(o)}),t.attributes.ssrcs=n,t.attributes.ssrcGroups=i})}mute(e){let t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){let t=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===e);if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}receive(e,t,n){e.forEach((i,s)=>{let o=i._mediaStreamTrack,c=this.sessionDesc.mediaDescriptions.findIndex(u=>u.attributes.mid===o.kind),d=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[c],i);this.sessionDesc.mediaDescriptions[c]=d})}stopReceiving(e){}updateCandidates(e){let t=this._originCandidates.filter(i=>i.transport==="udp"),n=[];if(t.forEach(i=>{n.push(Tj(Tj({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),t.length!==0){switch(e){case dt.TCP_RELAY:this.candidates=n;break;case dt.UDP_TCP_RELAY:case dt.RELAY:this.candidates=[...t,...n];break;default:this.candidates=t}for(let i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}}restartICE(e){e=sr(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}predictReceivingMids(e){let t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}mungRecvMediaDsec(e,t){let n=sr(e);return R_(n,t),t0(n,t),n}updateRecvMedia(e,t){let n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===e);if(n!==-1){let i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=i}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,t,n){let i=this.sessionDesc.mediaDescriptions.find(o=>e===vt.VIDEO?o.attributes.mid==="video":o.attributes.mid==="audio");if(i){let o=i.attributes.ssrcs.find(c=>c.attributes.label===t);var s;o&&(o.attributes.label=n,(s=o.attributes.msid)===null||s===void 0||s.replace(t,n))}}mungMediaDesc(e){let t=sr(e);return Qg(t),(function(n){let i=n.attributes.extmaps.find(s=>$w(s.extensionName));i&&n.attributes.extmaps.splice(n.attributes.extmaps.indexOf(i),1),n.attributes.payloads.forEach(s=>{let o=s.rtcpFeedbacks.findIndex(c=>c.type==="transport-cc");o!==-1&&s.rtcpFeedbacks.splice(o,1)})})(t),t}getSSRC(e){for(let t of this.sessionDesc.mediaDescriptions)for(let n of t.attributes.ssrcs)if(n.attributes.label===e)return[n]}}var Yi;function ji(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function U0(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ji(Object(t),!0).forEach(function(n){Z(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):ji(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}let gk=(Yi=class xj extends QV{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var t;return Re(t=Object.keys(tn)).call(t,e)}))]}constructor(e,t){super(e,t),Z(this,"store",void 0),Z(this,"peerConnection",void 0),Z(this,"remoteSDP",void 0),Z(this,"initialOffer",void 0),Z(this,"statsFilter",void 0),Z(this,"useRTX",!1),Z(this,"localCapabilities",void 0),Z(this,"localCandidateCount",0),Z(this,"allCandidatesReceived",!1),Z(this,"establishPromise",void 0),Z(this,"mutex",void 0),this.store=t,this.mutex=new ha("P2PConnection-mutex",t.clientId),this.peerConnection=new RTCPeerConnection(xj.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=QU(this.peerConnection,te("STATS_UPDATE_INTERVAL"),void 0,jr()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{let e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let t=bh(e.sdp),n=BC(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:te("FILTER_VIDEO_FEC"),filterAudioFec:te("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=n,this.initialOffer=e,U0(U0({},t),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:n},offerSDP:e.sdp})}catch(e){throw new H(z.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new U6(U0(U0({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));let t=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:t})}catch(t){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(t.toString()))}}async updateRemoteRTPCapabilities(e,t){throw new H(z.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,t){var n=this;return zl(function*(){let i=yield zn(n.mutex.lock());try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let s=e.map(g=>n.peerConnection.addTrack(g._mediaStreamTrack)),o=yield zn(n.peerConnection.createOffer()),c=Wc(o.sdp),d=e.map(g=>{let T=g._mediaStreamTrack,R=c.mediaDescriptions.find(I=>I.attributes.mid===T.kind);if(!R)throw new Error("Cannot extract ssrc from mediaDescription.");return(function(I,A,w){let k=I.attributes.ssrcs.filter(j=>j.attributes.label===A),L=I.attributes.ssrcGroups;if(k.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(L&&k.length>1){let j=L.find(K=>K.ssrcIds.indexOf(k[0].ssrcId)!==-1);return j?[{ssrcId:j.ssrcIds[0],rtx:w?j.ssrcIds[1]:void 0}]:[{ssrcId:k[0].ssrcId}]}return[{ssrcId:k[0].ssrcId}]})(R,T.id,n.useRTX)}),u;try{u=yield d}catch(g){throw s.forEach(T=>{ms()&&T.replaceTrack(null),n.peerConnection.removeTrack(T)}),g}let p=n.mungSendOfferSDP(o.sdp,e);n.remoteSDP.receive(e,t,u);let m=n.remoteSDP.toString();return yield zn(n.peerConnection.setLocalDescription({type:"offer",sdp:p})),yield zn(n.applySendEncodings(s,e)),yield zn(n.peerConnection.setRemoteDescription({type:"answer",sdp:m})),e.map((g,T)=>{let R=g._mediaStreamTrack.id;return{localSSRC:d[T],id:R}})}catch(s){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{i()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let t=this.peerConnection.getSenders().filter(s=>{var o;return e.indexOf(((o=s.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map(s=>{ms()&&s.replaceTrack(null),this.peerConnection.removeTrack(s)});let n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);let i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(t){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(t.toString()))}}async receive(e,t,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));let{id:s,mslabel:o}=this.remoteSDP.send(e,t,i),c=new De((p,m)=>{let g=setTimeout(()=>{m(new Error("Cannot receive track, id: ".concat(s)))},1e4),T=R=>{let I=Qn();if((I.name==="Safari"&&Number(I.version)===11||fi())&&R.track.id!==s&&R.streams[0].id===o){var A;let w=R.streams[0].getTracks()[0];return(A=this.remoteSDP)===null||A===void 0||A.updateTrackLabel(e,s,R.track.id),this.peerConnection.removeEventListener("track",T),clearTimeout(g),void p(w)}if(R.track.id===s)return this.peerConnection.removeEventListener("track",T),clearTimeout(g),void p(R.track)};this.peerConnection.addEventListener("track",T)}),d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});let u=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(u),{track:await c,id:s}}catch(s){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(s.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);let t=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});let n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n)}catch(t){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let t=this.peerConnection.getSenders().filter(n=>{var i;return e.indexOf(((i=n.track)===null||i===void 0?void 0:i.id)||"")!==-1});if(t.length!==e.length)throw new Error("sender' length doesn't match mids' length.");t.map(n=>{if(ms()&&n.track)n.track.enabled=!1;else{let i=n.getParameters();i.encodings.forEach(s=>s.active=!1),n.setParameters(i)}})}catch(t){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(t.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let t=this.peerConnection.getSenders().filter(s=>{var o;return e.indexOf(((o=s.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(t.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");t.map(async s=>{if(ms()&&s.track)s.track.enabled=!0;else{let o=s.getParameters();o.encodings.forEach(c=>c.active=!0),await s.setParameters(o)}});let n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n);let i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(t){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(t.toString()))}}restartICE(e){var t=this;return zl(function*(){let n=yield zn(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let i=on().supportPCSetConfiguration;if(e===dt.RELAY&&!i)return;if(i){let u=t.peerConnection.getConfiguration(),p=e===dt.RELAY?"relay":"all";u.iceTransportPolicy!==p&&(V.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(u.iceTransportPolicy,"] to [").concat(p,"]")),u.iceTransportPolicy=p,t.peerConnection.setConfiguration(u))}e!==dt.RELAY&&t.remoteSDP.updateCandidates(e);let s=yield zn(t.peerConnection.createOffer({iceRestart:!0}));if(!s.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let o=bh(s.sdp),{remoteIceParameters:c}=yield o.iceParameters;t.remoteSDP.restartICE(c);let d=t.remoteSDP.toString();yield zn(t.peerConnection.setLocalDescription(s)),yield zn(t.peerConnection.setRemoteDescription({type:"answer",sdp:d}))}catch(i){V.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),i)}finally{n()}})()}close(){var e;this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let n=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(n.sdp,[t]);this.remoteSDP.updateRecvMedia(t._mediaStreamTrack.kind,t);let s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(n){throw new H(z.EXCHANGE_SDP_FAILED,n.toString())}}async updateSendParameters(e,t){let n=this.peerConnection.getSenders().filter(i=>{var s;return((s=i.track)===null||s===void 0?void 0:s.id)===e});n.length===1&&await this.applySendEncodings(n,[t])}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){let n=this.peerConnection.getSenders().find(i=>{var s;return((s=i.track)===null||s===void 0?void 0:s.id)===t});n&&await n.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,t){throw new H(z.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new H(z.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,V.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,V.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},te("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){let t={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?t.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(Ti(e.turnServer.servers)?t.iceServers=e.turnServer.servers:(t.iceServers&&t.iceServers.push(...xj.turnServerConfigToIceServers(e.turnServer.servers)),te("USE_TURN_SERVER_OF_GATEWAY")&&t.iceServers&&e.turnServer.serversFromGateway&&t.iceServers.push(...xj.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(n=>{n.forceturn&&(t.iceTransportPolicy="relay")}))),t}static turnServerConfigToIceServers(e){let t=[];return e.forEach(n=>{n.security?n.tcpport&&t.push({username:n.username,credential:n.password,credentialType:"password",urls:"turns:".concat(n.turnServerURL,":").concat(n.tcpport,"?transport=tcp")}):(n.udpport&&t.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.udpport,"?transport=udp")}),n.tcpport&&t.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.tcpport,"?transport=tcp")}))}),t}async updateRtpSenderEncodings(e,t){var n;if(t||(t=this.peerConnection.getSenders().find(u=>{var p;return((p=u.track)===null||p===void 0?void 0:p.id)===e._mediaStreamTrack.id})),!t)return V.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!on().supportSetRtpSenderParameters)return V.warn("Browser not support set rtp-sender parameters");let i={},s={};if(e instanceof Ei)switch(e._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(te("DSCP_TYPE")&&Xp()){var o;let u=te("DSCP_TYPE");Re(o=["very-low","low","medium","high"]).call(o,u)&&(s.networkPriority=u)}let c=t.getParameters(),d=(n=c.encodings)===null||n===void 0?void 0:n[0];d&&Object.assign(d,s),Object.assign(c,i),V.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(c.encodings))),await t.setParameters(c)}async applySendEncodings(e,t){try{if(!on().supportSetRtpSenderParameters||e.length!==t.length)return;for(let n=0;n<e.length;n++){let i=e[n],s=t[n];i&&s&&await this.updateRtpSenderEncodings(s,i)}}catch{V.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t){let n=Wc(e);return t.forEach((i,s)=>{let o=i._mediaStreamTrack,c=n.mediaDescriptions.find(d=>d.attributes.mid===o.kind);c&&R_(c,i)}),Qo(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;(t=this.onFirstAudioReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;(t=this.onFirstVideoReceived)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;(t=this.onFirstAudioDecoded)===null||t===void 0||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;(n=this.onSelectedLocalCandidateChanged)===null||n===void 0||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;(n=this.onSelectedRemoteCandidateChanged)===null||n===void 0||n.call(this,e,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let t=this.remoteSDP.batchSend(e).map((s,o)=>{let{id:c,mslabel:d}=s,{kind:u}=e[o];return new De((p,m)=>{let g=setTimeout(()=>{m(new Error("Cannot receive track, id: ".concat(c)))},1e4),T=R=>{let I=Qn();if(I.name==="Safari"&&Number(I.version)===11&&R.track.id!==c&&R.streams[0].id===d){var A;let w=R.streams[0].getTracks()[0];return(A=this.remoteSDP)===null||A===void 0||A.updateTrackLabel(u,c,R.track.id),this.peerConnection.removeEventListener("track",T),clearTimeout(g),void p({track:w,id:c})}if(R.track.id===c)return this.peerConnection.removeEventListener("track",T),clearTimeout(g),void p({track:R.track,id:c})};this.peerConnection.addEventListener("track",T)})}),n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let i=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i),await De.all(t)}catch(t){throw new H(z.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(t.toString()))}}async getRemoteSSRC(e){return this.remoteSDP?this.remoteSDP.getSSRC(e)?.[0].ssrcId:void 0}setConfiguration(e){if(on().supportPCSetConfiguration){let t=xj.resolvePCConfiguration(e);this.peerConnection.setConfiguration(t)}}},Dt(Yi.prototype,"connect",[Lu],Object.getOwnPropertyDescriptor(Yi.prototype,"connect"),Yi.prototype),Dt(Yi.prototype,"stopSending",[Lu],Object.getOwnPropertyDescriptor(Yi.prototype,"stopSending"),Yi.prototype),Dt(Yi.prototype,"receive",[Lu],Object.getOwnPropertyDescriptor(Yi.prototype,"receive"),Yi.prototype),Dt(Yi.prototype,"stopReceiving",[Lu],Object.getOwnPropertyDescriptor(Yi.prototype,"stopReceiving"),Yi.prototype),Dt(Yi.prototype,"muteRemote",[Lu],Object.getOwnPropertyDescriptor(Yi.prototype,"muteRemote"),Yi.prototype),Dt(Yi.prototype,"unmuteRemote",[Lu],Object.getOwnPropertyDescriptor(Yi.prototype,"unmuteRemote"),Yi.prototype),Dt(Yi.prototype,"muteLocal",[Lu],Object.getOwnPropertyDescriptor(Yi.prototype,"muteLocal"),Yi.prototype),Dt(Yi.prototype,"unmuteLocal",[Lu],Object.getOwnPropertyDescriptor(Yi.prototype,"unmuteLocal"),Yi.prototype),Dt(Yi.prototype,"close",[Lu],Object.getOwnPropertyDescriptor(Yi.prototype,"close"),Yi.prototype),Dt(Yi.prototype,"updateEncoderConfig",[Lu],Object.getOwnPropertyDescriptor(Yi.prototype,"updateEncoderConfig"),Yi.prototype),Dt(Yi.prototype,"updateSendParameters",[Lu],Object.getOwnPropertyDescriptor(Yi.prototype,"updateSendParameters"),Yi.prototype),Dt(Yi.prototype,"replaceTrack",[Lu],Object.getOwnPropertyDescriptor(Yi.prototype,"replaceTrack"),Yi.prototype),Dt(Yi.prototype,"getRemoteSSRC",[Lu],Object.getOwnPropertyDescriptor(Yi.prototype,"getRemoteSSRC"),Yi.prototype),Yi);function Lu(r,e,t){let n=r[e];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return t.value=async function(){let i=this.mutex,s=await i.lock("Locking from P2PConnection.".concat(e));try{for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return await n.apply(this,c)}finally{s()}},t}let Mu={name:"PlanBConnection",create:function(r){let{store:e,spec:t}=r;return new gk(t,e)}},iq={interceptLocalAudioFrame:async function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!on().supportWebRTCEncodedTransform)return void V.warning("browser not support audio encoded transform");if(wC.has(r)||!r.track)return;let t={track:r.track};if(fh()){if(!r.createEncodedStreams)return void V.warning("browser not support createEncodedStreams() API");let i=null;try{i=r.createEncodedStreams()}catch(o){return void V.error("create audio-encoded-streams error",o&&o.message)}let s=new TransformStream({transform(o,c){t.controller||(t.controller=c),r.track&&r.track.id!==t.track.id&&(V.debug("audio track changed: ".concat(t.track.id," => ").concat(r.track.id)),t.track.removeEventListener("ended",n),t.track=r.track,t.track.addEventListener("ended",n));let d=e.metadata&&e.metadata();d?(function(u,p){let{chunk:m,controller:g}=p,T=Bm.METADATA;m.data=(function(R,I,A){let w=A.byteLength,k=w+Fw+tP,L=eP+Vw+k,j=new ArrayBuffer(R.byteLength+L),K=new DataView(j);K.setUint8(0,xw),K.setUint16(1,k),K.setUint8(3,I),K.setUint16(4,w);for(let Y=0;Y<w;Y++)K.setUint8(6+Y,A[Y]);let W=new Uint8Array(K.buffer);return W.set(new Uint8Array(R),L),W.buffer})(m.data,T,u),g.enqueue(m)})(d,{chunk:o,controller:c}):c.enqueue(o)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else if(ms()){if(typeof RTCRtpScriptTransform>"u")return void V.warning("browser not support RTCRtpScriptTransform");let i=$D(),s=new MessageChannel;await new De(c=>i.onmessage=d=>{d.data==="registered"&&c(void 0)});let o=new RTCRtpScriptTransform(i,{name:"audio-metadata-tx",port:s.port2},[s.port2]);r.transform=o,await new De(c=>i.onmessage=d=>{d.data==="started"&&c(void 0)}),s.port1.onmessage=c=>{var d;if(c.data.transformed&&r.track&&((d=r.track)===null||d===void 0?void 0:d.id)!==t.track.id)V.debug("audio track changed: ".concat(t.track.id," => ").concat(r.track.id)),t.track.removeEventListener("ended",n),t.track=r.track,t.track.addEventListener("ended",n);else if(c.data.getMetadata){let u=e.metadata&&e.metadata();u&&s.port1.postMessage({metadata:u})}},t.worker=i}function n(){if(r.track){if(this.id!==r.track.id)return;r.track.removeEventListener("ended",n)}let i=wC.get(r);if(i){wC.delete(r);try{var s,o;(s=i.controller)===null||s===void 0||s.terminate(),(o=i.worker)===null||o===void 0||o.terminate()}catch(c){V.warning(c&&c.message)}}}wC.set(r,t),r.track.addEventListener("ended",n)},interceptRemoteAudioFrame:async function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!on().supportWebRTCEncodedTransform)return void V.warning("browser not support audio encoded transform");if(Gw.has(r))return;let t={track:r.track,onMetadata:e.onMetadata,onPts:e.onPts};if(fh()&&!fi()){if(!r.createEncodedStreams)return void V.warning("browser not support createEncodedStreams() API");gD(sn.CHROME,87,116)||(e.enableTopn=!1);let i=null;try{i=r.createEncodedStreams()}catch(o){return void V.error("create audio-encoded-streams error",o&&o.message)}let s=new TransformStream({transform(o,c){t.controller||(t.controller=c),r.track&&r.track.id!==t.track.id&&(V.debug("audio track changed: ".concat(t.track.id," => ").concat(r.track.id)),t.track.removeEventListener("ended",n),t.track=r.track,t.track.addEventListener("ended",n)),e.enableTopn?(function(d,u,p){var m;let g=E_(new DataView(u.data));if(!g)return p.enqueue(u);let T=d.track.id;sP.set(T,d.track);let R=(m=g.tlv.find(j=>j.tag===Bm.AUDIO_LEVEL))===null||m===void 0?void 0:m.value,I=0;typeof R=="number"&&(I=127-R);let A=Math.round(Math.pow(10,I/60)-1),{selected:w,speaker:k}=(function(j,K){let W=DC.get(j);if(W||(W=(function(Y){let se=new R4;return DC.set(Y,se),El||(El=new xV(te("TOPN_SILENCE_THRESHOLD")||500),El.on("ActiveSpeakerChanged",de=>{de!=null&&(Ld=de)})),El.addSpeakers([se]),se})(j)),DC.size<=Bw)return{selected:!0,speaker:W};if(!El)throw new Error("no active speaker detector");return El.levelChanged(W.id,K),Kg=El.loudest.map(Y=>Y.id),Ld&&!Re(Kg).call(Kg,Ld)&&Kg.length>=Bw&&Kg.pop(),{selected:Re(Kg).call(Kg,W.id)||W.id===Ld,speaker:W}})(d,A),L=(function(j,K,W){let Y=Kc.get(j)||new iP(j,K);return Y.score=W,Kc.set(j,Y),(function(se){if(Md.set(se,!0),!rP)return void(rP=Date.now());let de=Date.now();de-rP>1e3&&(Md.get(se)?Md.set(se,!1):(jw(se),Md.delete(se)),rP=de)})(j),Y})(T,d.track,k.energyScore);L.addSample(w),L.active&&(u.data=g.frame.buffer,p.enqueue(u))})(r,o,c):e.enableMetadata||e.enablePts?(function(d,u,p,m){let g=new DataView(d.data),T=g.getUint8(0),R;if(128&T&&T!==71){let w=(function(k){if(k.byteLength<=0)return[];let L=[],j=0;for(;j<k.byteLength;){let W=(128&k.getUint8(j))>>7,Y=127&k.getUint8(j);if(!(W&&j+4<=k.byteLength)){j++;break}{let se=k.getUint32(j,!1),de=(16776192&se)>>10,ge=1023&se;L.push({pt:Y,ts_offset:de,length:ge,data:new Uint8Array}),j+=4}}let K=k.byteLength-j;for(let W of L){if(W.length>K)return console.warn("Broken red payload"),[];W.length>0&&(W.data=new Uint8Array(k.buffer,k.byteOffset+j,W.length),j+=W.length,K-=W.length)}if(K>0){let W={pt:L.length>0?L[L.length-1].pt:0,ts_offset:0,length:K,data:new Uint8Array(k.buffer,k.byteOffset+j,K)};L.push(W)}return L})(g);if(w.length>0){let k=(function(L){let j=0;for(let Y=0;Y<L.length;Y++)j+=Y<L.length-1?4:1,j+=L[Y].length;let K=new Uint8Array(j),W=0;for(let Y=0;Y<L.length;Y++)if(Y<L.length-1){let se=(2147483648|(127&L[Y].pt)<<24|(262143&L[Y].ts_offset)<<10|1023&L[Y].length)>>>0;K[W++]=se>>24&255,K[W++]=se>>16&255,K[W++]=se>>8&255,K[W++]=255&se}else K[W++]=127&L[Y].pt;for(let Y of L)K.set(Y.data,W),W+=Y.length;return K})(w.map(L=>{let j=new Uint8Array(L.length);j.set(L.data);let K=E_(new DataView(j.buffer));return K!=null&&K.frame&&(L.data=K?.frame),R=K,L}));d.data=k.buffer}}else R=E_(g),R&&(d.data=R.frame.buffer);if(u.enqueue(d),!R)return;let I=R.tlv.find(w=>w.tag===Bm.METADATA);I&&p&&I.value instanceof Uint8Array&&p(I.value);let A=R.tlv.find(w=>w.tag===Bm.AUDIO_64_BIT_PTS);A&&m&&A.value instanceof Uint8Array&&A.value.length==8&&m(new DataView(A.value.buffer).getBigUint64(0,!0))})(o,c,e.onMetadata,e.onPts):c.enqueue(o)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void V.warning("browser not support RTCRtpScriptTransform");let i=$D(),s=new MessageChannel;await new De(c=>i.onmessage=d=>{d.data==="registered"&&c(void 0)});let o=new RTCRtpScriptTransform(i,{name:"audio-metadata-rx",port:s.port2},[s.port2]);r.transform=o,await new De(c=>i.onmessage=d=>{d.data==="started"&&c(void 0)}),s.port1.onmessage=c=>{var d;c.data.transformed&&r.track&&((d=r.track)===null||d===void 0?void 0:d.id)!==t.track.id?(V.debug("audio track changed: ".concat(t.track.id," => ").concat(r.track.id)),t.track.removeEventListener("ended",n),t.track=r.track,t.track.addEventListener("ended",n)):c.data.metadata&&t.onMetadata?t.onMetadata(c.data.metadata):c.data.pts&&t.onPts&&t.onPts(c.data.pts)},t.worker=i}function n(){r.track.removeEventListener("ended",n),(function(i){let s=Gw.get(i);if(s){(function(d){let u=DC.get(d);u&&(DC.delete(d),El&&(El.removeSpeakers([u]),DC.size===0&&(El.destroy(),El=null)))})(i),jw(i.track.id),Gw.delete(i);try{var o,c;(o=s.controller)===null||o===void 0||o.terminate(),(c=s.worker)===null||c===void 0||c.terminate()}catch(d){V.warning(d&&d.message)}}})(r)}Gw.set(r,t),r.track.addEventListener("ended",n)},interceptLocalVideoFrame:async function(r,e){if(!on().supportWebRTCEncodedTransform)return void V.warning("browser not support video encoded transform");if(Hw.has(r)||!r.track)return;let t={track:r.track};if(fh()){if(!r.createEncodedStreams)return void V.warning("browser not support createEncodedStreams() API");let i=null;try{i=r.createEncodedStreams()}catch(c){return void V.error("create video-encoded-streams error",c&&c.message)}let s=[];e.on("sei-to-send",c=>{s.push(c)});let o=new TransformStream({transform(c,d){t.controller||(t.controller=d),r.track&&r.track.id!==t.track.id&&(V.debug("video track changed: ".concat(t.track.id," => ").concat(r.track.id)),t.track.removeEventListener("ended",n),t.track=r.track,t.track.addEventListener("ended",n));let u=BV(new Uint8Array(c.data)),p=s.shift();if(p){let m=(function(g,T,R){switch(R){case VV:return(function(I,A){let w=FV(A),k=w.length,L=Math.floor(k/255),j=k%255,K=new Uint8Array(6+L+1+k+I.byteLength);K[0]=0,K[1]=0,K[2]=0,K[3]=1,K[4]=6,K[5]=101;let W=0;for(;W<L;)K[6+W]=255,W++;return K[6+W]=j,W++,K.set(w,6+W),K.set(new Uint8Array(I),6+W+k),K.buffer})(g,T);case Ww:return(function(I,A){let w=FV(A),k=w.length,L=Math.floor(k/255),j=k%255,K=new Uint8Array(7+L+1+k+1+I.byteLength);K[0]=0,K[1]=0,K[2]=0,K[3]=1,K[4]=78,K[5]=1,K[6]=101;let W=0;for(;W<L;)K[7+W]=255,W++;return K[7+W]=j,W++,K.set(w,7+W),W+=k,K[7+W]=128,W++,K.set(new Uint8Array(I),7+W),K.buffer})(g,T);default:return null}})(c.data,p,u);m&&(c.data=m)}d.enqueue(c)}});i.readable.pipeThrough(o).pipeTo(i.writable)}else{if(!ms())return;{if(typeof RTCRtpScriptTransform>"u")return void V.warning("browser not support RTCRtpScriptTransform");let i=$D(),s=new MessageChannel;await new De(c=>i.onmessage=d=>{d.data==="registered"&&c(void 0)});let o=new RTCRtpScriptTransform(i,{name:"sei-tx",port:s.port2},[s.port2]);r.transform=o,await new De(c=>i.onmessage=d=>{d.data==="started"&&c(void 0)}),e.on("sei-to-send",c=>{s.port1.postMessage({sei:c})}),s.port1.onmessage=c=>{var d;c.data.transformed&&r.track&&((d=r.track)===null||d===void 0?void 0:d.id)!==t.track.id&&(V.debug("video track changed: ".concat(t.track.id," => ").concat(r.track.id)),t.track.removeEventListener("ended",n),t.track=r.track,t.track.addEventListener("ended",n))},t.worker=i}}function n(){if(r.track){if(this.id!==r.track.id)return;r.track.removeEventListener("ended",n)}let i=Hw.get(r);if(i){Hw.delete(r);try{var s,o;(s=i.controller)===null||s===void 0||s.terminate(),(o=i.worker)===null||o===void 0||o.terminate()}catch(c){V.warning(c&&c.message)}}}Hw.set(r,t),r.track.addEventListener("ended",n)},interceptRemoteVideoFrame:async function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!on().supportWebRTCEncodedTransform)return void V.warning("browser not support video encoded transform");if(!r.track)return;if(zg.has(r)){let i=zg.get(r);return void(i&&(i.onSei=e.onSei))}let t={track:r.track,onSei:e.onSei};if(fh()){if(!r.createEncodedStreams)return void V.warning("browser not support createEncodedStreams() API");let i=null;try{i=r.createEncodedStreams()}catch(o){return void V.error("create video-encoded-streams error",o&&o.message)}let s=new TransformStream({transform(o,c){t.controller||(t.controller=c),r.track&&r.track.id!==t.track.id&&(V.debug("video track changed: ".concat(t.track.id," => ").concat(r.track.id)),t.track.removeEventListener("ended",n),t.track=r.track,t.track.addEventListener("ended",n));let d=(function(u,p){switch(p){case VV:return(function(m){let g=new DataView(m.data),T=0;for(;T+4<m.data.byteLength;){if(g.getUint8(T+0)===0&&g.getUint8(T+1)===0&&g.getUint8(T+2)===0&&g.getUint8(T+3)===1&&g.getUint8(T+4)===6){let R=T+6,I=0,A=0;for(;(A=g.getUint8(R++))===255;)I+=255;I+=A;let w=oP(m.data,R,I);return new Uint8Array(w)}T++}return null})(u);case Ww:return(function(m){let g=new DataView(m.data),T=0;for(;T+5<m.data.byteLength;){if(g.getUint8(T+0)===0&&g.getUint8(T+1)===0&&g.getUint8(T+2)===0&&g.getUint8(T+3)===1&&g.getUint8(T+4)===78&&g.getUint8(T+5)===1&&g.getUint8(T+6)===101){let R=T+7,I=0,A=0;for(;(A=g.getUint8(R++))===255;)I+=255;I+=A;let w=oP(m.data,R,I);return new Uint8Array(w)}T++}return null})(u);default:return null}})(o,BV(new Uint8Array(o.data)));d&&t.onSei&&t.onSei(d),c.enqueue(o)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else if(ms()){if(typeof RTCRtpScriptTransform>"u")return void V.warning("browser not support RTCRtpScriptTransform");let i=$D(),s=new MessageChannel;await new De(c=>i.onmessage=d=>{d.data==="registered"&&c(void 0)});let o=new RTCRtpScriptTransform(i,{name:"sei-rx",port:s.port2},[s.port2]);r.transform=o,await new De(c=>i.onmessage=d=>{d.data==="started"&&c(void 0)}),s.port1.onmessage=c=>{var d;c.data.transformed&&r.track&&((d=r.track)===null||d===void 0?void 0:d.id)!==t.track.id?(V.debug("video track changed: ".concat(t.track.id," => ").concat(r.track.id)),t.track.removeEventListener("ended",n),t.track=r.track,t.track.addEventListener("ended",n)):c.data.sei&&t.onSei&&t.onSei(c.data.sei)},t.worker=i}function n(){if(r.track){if(this.id!==r.track.id)return;r.track.removeEventListener("ended",n)}(function(i){let s=zg.get(i);if(s){zg.delete(i);try{var o,c;(o=s.controller)===null||o===void 0||o.terminate(),(c=s.worker)===null||c===void 0||c.terminate()}catch(d){V.warning(d&&d.message)}}})(r)}zg.set(r,t),r.track.addEventListener("ended",n)}},rq={name:"InterceptFrame",create:()=>iq};MD(),en("PROCESS_ID","process-".concat(In(8,""),"-").concat(In(4,""),"-").concat(In(4,""),"-").concat(In(4,""),"-").concat(In(12,""))),(function(){let r;try{r=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void V.error("Error loading sdk config",e.message)}if(r)try{let e=JSON.parse(window.atob(r)),t=Date.now();V.debug("Loading global parameters from cache",e),Object.keys(e).forEach(n=>{if(Object.prototype.hasOwnProperty.call(or,n)){let{value:i,expires:s}=e[n];if(s&&s<=t)return;Eh[n]=i,or[n]=i}})}catch(e){V.error("Error loading mutableParamsCache: ".concat(r),e.message)}})(),Array.isArray(Eh.AREAS)&&Eh.AREAS.length>0&&pP(Eh.AREAS,!0);let x6=(r,e,t)=>{V.debug("setParameter key:".concat(r,", value:").concat(JSON.stringify(e))),en(r,e,t)};qm(WY,!1),qm(HY,!1),qm(Z4,!1),qm(QY,!1),qm(BY,!1),qm(nq,!1),qm(Mu,!1),qm(rq,!1);let Ds=(function(r){let e=new Sr,t=r,n={getListeners:e.getListeners.bind(e),on:(i,s)=>((function(o,c){o===rf.SECURITY_POLICY_VIOLATION&&xP(c,!0)})(i,s),e.on.bind(e)(i,s)),addListener:e.addListener.bind(e),once:e.once.bind(e),off:e.off.bind(e),removeAllListeners:e.removeAllListeners.bind(e),emit:e.emit.bind(e),safeEmit:e.safeEmit.bind(e)};return LB(LB({},t),n)})({__TRACK_LIST__:xm,VERSION:Yl,BUILD:Ow,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:x6,getParameter:te,getSupportedCodec:async function(){let r={audio:[],video:[]};try{let e=new RTCPeerConnection,t=await(async function(n){let i;return on().supportUnifiedPlan?(n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"}),i=(await n.createOffer()).sdp):i=(await n.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,i})(e);if(!t)return r;e.close(),e=null,r=(function(n){let i={video:[],audio:[]};return n.match(/ VP8/i)&&i.video.push("VP8"),n.match(/ VP9/i)&&i.video.push("VP9"),n.match(/ AV1/i)&&i.video.push("AV1"),n.match(/ H264/i)&&i.video.push("H264"),n.match(/ H265/i)&&i.video.push("H265"),n.match(/ opus/i)&&i.audio.push("OPUS"),n.match(/ PCMU/i)&&i.audio.push("PCMU"),n.match(/ PCMA/i)&&i.audio.push("PCMA"),n.match(/ G722/i)&&i.audio.push("G722"),i})(t)}catch(e){throw new fe(z.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return r},checkSystemRequirements:function(){let r=Ye.reportApiInvoke(null,{name:Zr.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Cn.TRACER}),e=!1;try{let s=window.RTCPeerConnection,o=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,c=window.WebSocket;e=!!(s&&o&&c),e&&RD()&&Ev(75)&&new s().close()}catch(s){return V.error("check system requirement failed: ",s),!1}let t=!1,n=Qn();n.name===sn.CHROME&&Number(n.version)>=58&&(ph.engine.name!=="WebKit"||(function(){let s=Qn();if(Tw()){if(s.os===Br.MAC_OS)return!0;if(s.os===Br.IOS){let o=ph.os.version&&ph.os.version.split(".");if(o&&Number(o[0])===14&&o[1]&&Number(o[1])>=3||o&&Number(o[0])>14)return!0}}return!1})())&&(t=!0),(n.name===sn.FIREFOX&&Number(n.version)>=56||n.name===sn.OPERA&&Number(n.version)>=45||n.name===sn.SAFARI&&Number(n.version)>=11||n.name==="WebKit"&&(fi()||gu())&&n.osVersion&&Number(n.osVersion.split(".")[0])>=11||Su()||Qn().name===sn.QQ)&&(t=!0),V.debug("checkSystemRequirements, api:",e,"browser",t);let i=e&&t;return r.onSuccess(i),i},getDevices:function(r){return oc.enumerateDevices(!0,!0,r)},getMicrophones:function(r){return oc.getRecordingDevices(r)},getCameras:function(r){return oc.getCamerasDevices(r)},getElectronScreenSources:_4,getPlaybackDevices:function(r){return oc.getSpeakers(r)},createClient:function(){var r;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},t=In(5,"client-"),n=Ye.reportApiInvoke(null,{id:t,name:Zr.CREATE_CLIENT,options:[e],tag:Cn.TRACER});try{(function(i){gr(i.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),gr(i.mode,"config.mode",["rtc","live","p2p"]),i.audioCodec!==void 0&&gr(i.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),i.proxyServer!==void 0&&Eo(i.proxyServer,"config.proxyServer",1,1e4),i.turnServer!==void 0&&_C(i.turnServer),i.httpRetryConfig!==void 0&&Tr(i.httpRetryConfig),i.websocketRetryConfig!==void 0&&Tr(i.websocketRetryConfig)})(e)}catch(i){throw n.onError(i),i}return(jU(16,0)||TD(16,0,!0))&&(e.codec==="vp9"&&(e.codec="vp8",V.debug("browser not support vp9, force use vp8")),en("UNSUPPORTED_VIDEO_CODEC",["vp9"])),e.audioCodec===void 0&&(e.audioCodec="opus"),n.onSuccess(),new Nh(Ou(Ou({forceWaitGatewayResponse:!0},e),{},{role:Re(r=["rtc","p2p"]).call(r,e.mode)?"host":e.role||"audience"}),t)},createCameraVideoTrack:async function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=te("CAMERA_CAPTURE_CONFIG"),t=In(8,"track-cam-"),n=Ye.reportApiInvoke(null,{id:t,tag:Cn.TRACER,name:Zr.CREATE_CAM_VIDEO_TRACK,options:[Xi({},r),e]});e&&(r.encoderConfig=e);let i=Lw(r),s=null;V.info("start create camera video track with config",JSON.stringify(r),"trackId",t);try{s=(await Jl({video:i},t)).getVideoTracks()[0]||null}catch(c){throw n.onError(c),c}if(!s){let c=new H(z.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(c),c.throw(V)}if(r.optimizationMode&&AC(t,s,r,gh(r.encoderConfig)),te("USE_STANDARD_BITRATE_DEFAULT")){let c=gh(r.encoderConfig);r.encoderConfig=c,delete c.bitrateMax,delete c.bitrateMin}let o=new zi(s,r,i,r.scalabiltyMode?CC(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,t);return n.onSuccess(o.getTrackId()),V.info("create camera video success, trackId:",t),o},createCustomVideoTrack:function(r){let e=In(8,"track-cus-"),t=Ye.reportApiInvoke(null,{id:e,tag:Cn.TRACER,name:Zr.CREATE_CUSTOM_VIDEO_TRACK,options:[r]});te("USE_STANDARD_BITRATE_DEFAULT")&&(delete r.bitrateMax,delete r.bitrateMin);let n=new Ei(r.mediaStreamTrack,{width:r.width,height:r.height,frameRate:r.frameRate,bitrateMax:r.bitrateMax,bitrateMin:r.bitrateMin},r.scalabiltyMode?CC(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,e,[rt.CUSTOM_TRACK]);return t.onSuccess(n.getTrackId()),V.info("create custom video track success with config",r,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable",t=typeof e=="object"?(function(g){return Mw(g)})(e):void 0;t&&(e="auto");let n=In(8,"track-scr-v-"),i=Ye.reportApiInvoke(null,{id:n,tag:Cn.TRACER,name:Zr.CREATE_SCREEN_VIDEO_TRACK,options:[Xi({},r),e]});r.encoderConfig?typeof r.encoderConfig=="string"||r.encoderConfig.width&&r.encoderConfig.height||(r.encoderConfig.width={max:1920},r.encoderConfig.height={max:1080}):r.encoderConfig="1080p_2";let s=(function(g){let T={};g.screenSourceType&&(T.mediaSource=g.screenSourceType),g.extensionId&&fh()&&(T.extensionId=g.extensionId);let{displaySurface:R,selfBrowserSurface:I,surfaceSwitching:A,systemAudio:w,preferCurrentTab:k}=g;(mo(107)||vw(107)||Rw(93))&&(R&&(gr(R,"displaySurface",["browser","window","monitor"]),T.displaySurface=R),I?(gr(I,"selfBrowserSurface",["exclude","include"]),T.selfBrowserSurface=I):T.selfBrowserSurface="include",A&&(gr(A,"surfaceSwitching",["exclude","include"]),T.surfaceSwitching=A)),(mo(105)||vw(105)||Rw(91))&&w&&(gr(w,"systemAudio",["exclude","include"]),T.systemAudio=w),(mo(94)||vw(94)||Rw(80))&&k&&(T.preferCurrentTab=!0),g.electronScreenSourceId&&(T.sourceId=g.electronScreenSourceId);let L=g.encoderConfig?Nd(g.encoderConfig):null;return T.mandatory={chromeMediaSource:"desktop",maxWidth:L?L.width:void 0,maxHeight:L?L.height:void 0},L&&(L.frameRate&&(typeof L.frameRate=="number"?(T.mandatory.maxFrameRate=L.frameRate,T.mandatory.minFrameRate=L.frameRate):(T.mandatory.maxFrameRate=L.frameRate.max||L.frameRate.ideal||L.frameRate.exact||void 0,T.mandatory.minFrameRate=L.frameRate.min||L.frameRate.ideal||L.frameRate.exact||void 0),T.frameRate=L.frameRate),L.width&&(T.width=L.width),L.height&&(T.height=L.height)),T})(r),o=null,c=null,d=on();if(!d.supportShareAudio&&e==="enable"){let g=new H(z.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(g),g.throw(V)}V.info("start create screen video track with config",r,"withAudio",e,"trackId",n);let u=d.supportShareAudio&&e!=="disable";try{let g=await Jl({screen:s,screenAudio:u?t||!0:void 0},n);o=g.getVideoTracks()[0]||null,c=g.getAudioTracks()[0]||null}catch(g){throw i.onError(g),g}if(!o){let g=new H(z.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(g),g.throw(V)}if(!c&&e==="enable"){o&&o.stop();let g=new H(z.SHARE_AUDIO_NOT_ALLOWED);return i.onError(g),g.throw(V)}r.optimizationMode||(r.optimizationMode="detail"),r.optimizationMode&&(AC(n,o,r,r.encoderConfig&&Nd(r.encoderConfig)||void 0),r.encoderConfig&&typeof r.encoderConfig!="string"&&(r.encoderConfig.bitrateMin=r.encoderConfig.bitrateMax));let p=new Ei(o,r.encoderConfig?Nd(r.encoderConfig):{},r.scalabiltyMode?CC(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,n,[rt.SCREEN_TRACK]);if(!c)return i.onSuccess(p.getTrackId()),V.info("create screen video track success","video:",p.getTrackId()),p;let m=new ci(c,void 0,In(8,"track-scr-a-"),!1);return i.onSuccess([p.getTrackId(),m.getTrackId()]),V.info("create screen video track success","video:",p.getTrackId(),"audio:",m.getTrackId()),[p,m]},createMicrophoneAndCameraTracks:async function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=te("CAMERA_CAPTURE_CONFIG"),n=In(8,"track-mic-"),i=In(8,"track-cam-"),s=Ye.reportApiInvoke(null,{id:"".concat(n,"-").concat(i),tag:Cn.TRACER,name:Zr.CREATE_MIC_AND_CAM_TRACKS,options:[r,e,t]});t&&(e.encoderConfig=t);let o=Lw(e),c=ux(r),d=null,u=null;V.info("start create camera video track(".concat(i,") and microphone audio track(").concat(n,") with config, audio: ").concat(JSON.stringify(r),", video: ").concat(JSON.stringify(e)));try{let g=await Jl({audio:c,video:o},"".concat(n,"-").concat(i));d=g.getAudioTracks()[0],u=g.getVideoTracks()[0]}catch(g){throw s.onError(g),g}if(!d||!u){let g=new H(z.UNEXPECTED_ERROR,"can not find tracks in media stream");return s.onError(g),g.throw(V)}if(e.optimizationMode&&AC(i,u,e,gh(e.encoderConfig)),te("USE_STANDARD_BITRATE_DEFAULT")){let g=gh(e.encoderConfig);e.encoderConfig=g,delete g.bitrateMax,delete g.bitrateMin}let p=new Rr(d,r,c,n),m=new zi(u,e,o,e.scalabiltyMode?CC(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return s.onSuccess([p.getTrackId(),m.getTrackId()]),V.info("create camera video track(".concat(i,") and microphone audio track(").concat(n,") success")),[p,m]},createMicrophoneAudioTrack:async function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=In(8,"track-mic-"),t=Ye.reportApiInvoke(null,{id:e,tag:Cn.TRACER,name:Zr.CREATE_MIC_AUDIO_TRACK,options:[r]}),n=ux(r),i=null;V.info("start create microphone audio track with config",JSON.stringify(r),"trackId",e);try{i=(await Jl({audio:n},e)).getAudioTracks()[0]||null}catch(o){throw t.onError(o),o}if(!i){let o=new H(z.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(o),o.throw(V)}let s=new Rr(i,r,n,e);return t.onSuccess(s.getTrackId()),V.info("create microphone audio track success, trackId:",e),s},createCustomAudioTrack:function(r){let e=In(8,"track-cus-"),t=Ye.reportApiInvoke(null,{id:e,tag:Cn.TRACER,name:Zr.CREATE_CUSTOM_AUDIO_TRACK,options:[r]}),n=new ci(r.mediaStreamTrack,r.encoderConfig?FD(r.encoderConfig):{},e,!1);return V.info("create custom audio track success with config",r,"trackId",n.getTrackId()),t.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(r){var e;let{cacheOnlineFile:t,encoderConfig:n}=r,{source:i}=r,s={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?(e=File.name)!==null&&e!==void 0?e:"File":i,cacheOnlineFile:t,encoderConfig:n},o=In(8,"track-buf-"),c=Ye.reportApiInvoke(null,{id:o,tag:Cn.TRACER,name:Zr.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(te("DISABLE_WEBAUDIO"))throw new H(z.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");V.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",o);let d=i;if(!(i instanceof AudioBuffer))try{i=await(async function(m,g){let T=null;if(typeof m=="string"){let I=T4.get(m);if(I)return V.debug("use cached audio resource: ",m),I;try{T=(await Tu(()=>Er.get(m,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(A){throw new H(z.FETCH_AUDIO_FILE_FAILED,A.toString())}}else T=await new De((I,A)=>{let w=new FileReader;w.onload=k=>{k.target?I(k.target.result):A(new H(z.READ_LOCAL_AUDIO_FILE_ERROR))},w.onerror=()=>{A(new H(z.READ_LOCAL_AUDIO_FILE_ERROR))},w.readAsArrayBuffer(m)});let R=await(function(I){let A=Ai();return new De((w,k)=>{A.decodeAudioData(I,L=>{w(L)},L=>{k(new H(z.DECODE_AUDIO_FILE_FAILED,L.toString()))})})})(T);return typeof m=="string"&&g&&T4.set(m,R),R})(i,t)}catch(m){return c.onError(m),m.throw(V)}let u=new Js(i),p=new Uw(d,u,n?FD(n):{},o);return V.info("create buffer source audio track success, trackId:",o),c.onSuccess(p.getTrackId()),p},setAppType:function(r){if(V.debug("setAppType: ".concat(r)),!(Number.isInteger(r)&&r>=0))throw V.debug("Invalid appType"),new fe(z.INVALID_PARAMS,"invalid app type",r);en("APP_TYPE",Math.floor(r))},setLogLevel:function(r){V.setLogLevel(r)},enableLogUpload:function(){te("USE_NEW_LOG")?en("UPLOAD_LOG",!0):V.enableLogUpload()},disableLogUpload:function(){te("USE_NEW_LOG")?en("UPLOAD_LOG",!1):V.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new YC},checkAudioTrackIsActive:async function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,t=Ye.reportApiInvoke(null,{tag:Cn.TRACER,name:Zr.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[e]});if(!(r instanceof ci||r instanceof tf)){let d=new fe(z.INVALID_TRACK,"the parameter is not a audio track");return t.onError(d),d.throw()}e&&e<1e3&&(e=1e3);let n=r instanceof ci?r.getTrackLabel():"remote_track",i=r.getVolumeLevel(),s=i,o=i,c=Date.now();return new De(d=>{let u=setInterval(()=>{let p=r.getVolumeLevel();s=p>s?p:s,o=p<o?p:o;let m=s-o>1e-4,g=Date.now()-c;if(m||g>e){clearInterval(u);let T=m,R={duration:g,deviceLabel:n,maxVolumeLevel:s,result:T};V.info("[track-".concat(r.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(R))),t.onSuccess(R),d(T)}},200)})},checkVideoTrackIsActive:async function(r){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,t=Ye.reportApiInvoke(null,{tag:Cn.TRACER,name:Zr.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[e]});if(!(r instanceof Ei||r instanceof Iv)){let m=new fe(z.INVALID_TRACK,"the parameter is not a video track");return t.onError(m),m.throw()}e&&e<1e3&&(e=1e3);let n=r instanceof Ei?r.getTrackLabel():"remote_track",i=r.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(ms()||Tw())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([i]),s.play();let o=document.createElement("canvas");o.width=160,o.height=120;let c=0,d=0;try{let m=Date.now();c=await(function(g,T,R,I){let A,w=0,k=null;return new De((L,j)=>{function K(){w>I&&A&&(A(),L(w));let W=R.getContext("2d");if(!W){let de=new fe(z.UNEXPECTED_ERROR,"can not get canvas 2d context.");return V.error(de.toString()),void j(de)}W.drawImage(g,0,0,160,120);let Y=W.getImageData(0,0,R.width,R.height),se=Math.floor(Y.data.length/3);if(k){for(let de=0;de<se;de+=3)if(Y.data[de]!==k[de])return w+=1,void(k=Y.data);k=Y.data}else k=Y.data}setTimeout(()=>{A&&(A(),L(w))},T),A=kw(()=>{K()},30)})})(s,e,o,4),d=Date.now()-m}catch(m){throw t.onError(m),m}nY===sn.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;let u=c>4,p={duration:d,changedPicNum:c,deviceLabel:n,result:u};return V.info("[track-".concat(r.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(p))),t.onSuccess(p),u},setArea:pP,audioElementPlayCenter:Hc,resumeAudioContext:function(){Hc.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(r){cY.processExternalMediaAEC(r)},registerExtensions:function(r){let e=te("PLUGIN_INFO")||[];r.forEach(t=>{"name"in t&&!Re(e).call(e,t.name)&&e.push(t.name);let n=t;n.__registered__=!0,n.logger.hookLog=V.extLog,n.reporter.hookApiInvoke=Ye.extApiInvoke,n.parameters&&Object.keys(n.parameters).forEach(i=>{n.parameters[i]=te(i)})}),x6("PLUGIN_INFO",e)},ChannelMediaRelayError:wa,ChannelMediaRelayEvent:oo,ChannelMediaRelayState:ko,RemoteStreamFallbackType:yz,RemoteStreamType:bC,ConnectionDisconnectedReason:Di,AudienceLatencyLevelType:t4,AREAS:dn,preload:async function(r,e,t,n){return wP(r,e,t,n)}});return Object.defineProperties(Ds,{onAudioAutoplayFailed:{get:()=>ml.onAudioAutoplayFailed,set:r=>{ml.onAudioAutoplayFailed=r}},onAutoplayFailed:{get:()=>ml.onAutoplayFailed,set:r=>{ml.onAutoplayFailed=r}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Ds._onSecurityPolicyViolation,set(r){Ds._onSecurityPolicyViolation=r,xP(r)}},__CLIENT_LIST__:{get:()=>te("SHOW_GLOBAL_CLIENT_LIST")?Yg:[]}}),oc.on(Zp.CAMERA_DEVICE_CHANGED,r=>{V.info("camera device changed",JSON.stringify(r)),Ds.onCameraChanged&&Ds.onCameraChanged(r),Ds.safeEmit(rf.CAMERA_CHANGED,r)}),oc.on(Zp.RECORDING_DEVICE_CHANGED,r=>{V.info("microphone device changed",JSON.stringify(r)),Ds.onMicrophoneChanged&&Ds.onMicrophoneChanged(r),Ds.safeEmit(rf.MICROPHONE_CHANGED,r)}),oc.on(Zp.PLAYOUT_DEVICE_CHANGED,r=>{V.debug("playout device changed",JSON.stringify(r)),Ds.onPlaybackDeviceChanged&&Ds.onPlaybackDeviceChanged(r),Ds.safeEmit(rf.PLAYBACK_DEVICE_CHANGED,r)}),Hc.onAutoplayFailed=()=>{V.info("detect audio element autoplay failed"),ml.onAudioAutoplayFailed&&ml.onAudioAutoplayFailed()},Yn.on("autoplay-failed",()=>{V.info("detect webaudio autoplay failed"),ml.onAudioAutoplayFailed&&ml.onAudioAutoplayFailed(),Ds.safeEmit(rf.AUTOPLAY_FAILED)}),Yn.on(Po.STATE_CHANGE,(r,e)=>{V.info("audio context state changed: ".concat(e," => ").concat(r)),Ds.onAudioContextStateChanged&&Ds.onAudioContextStateChanged(r,e),Ds.safeEmit(rf.AUDIO_CONTEXT_STATE_CHANGED,r,e)}),Kr.on(ja.NETWORK_STATE_CHANGE,(r,e)=>{V.info("[network-indicator] network state changed, ".concat(e," => ").concat(r))}),window&&(window.__ARTC__=Ds),Ds})}),Tie={};ETe(Tie,{AgoraRTCProvider:()=>Rie,AgoraRTCReactError:()=>Vu,AgoraRTCScreenShareProvider:()=>wTe,LocalAudioTrack:()=>Nie,LocalUser:()=>KTe,LocalVideoTrack:()=>AJ,RemoteAudioTrack:()=>Lie,RemoteUser:()=>Uie,RemoteVideoTrack:()=>Mie,TrackBoundary:()=>GTe,VERSION:()=>qTe,default:()=>XTe,useAutoPlayAudioTrack:()=>bJ,useAutoPlayVideoTrack:()=>CJ,useClientEvent:()=>bTe,useConnectionState:()=>NTe,useCurrentUID:()=>DTe,useIsConnected:()=>aL,useJoin:()=>bie,useLocalCameraTrack:()=>wie,useLocalMicrophoneTrack:()=>Aie,useLocalScreenTrack:()=>BTe,useNetworkQuality:()=>PTe,usePublish:()=>Iie,useRTCClient:()=>CE,useRTCScreenShareClient:()=>OTe,useRemoteAudioTracks:()=>xTe,useRemoteUserTrack:()=>k7,useRemoteUsers:()=>Oie,useRemoteVideoTracks:()=>VTe,useTrackEvent:()=>ITe,useVolumeLevel:()=>LTe});var STe=hO(pO());function Kd(l,a,h){return l.on(a,h),()=>l.off(a,h)}function TTe(l){try{return l()}catch(a){console.error(a)}}function fO(l){return()=>l.forEach(TTe)}function vTe(l,a){let h=setInterval(l,a);return()=>clearInterval(h)}function LW(l,a){let h=setTimeout(l,a);return()=>clearTimeout(h)}function yJ(){let l,a,h;function _(){if(a){let x=a;a=void 0,x()}}async function S(){if(h){let x=h;h=void 0;try{await x()}catch(q){console.error(q)}}}async function y(x){l=!0,await S();try{h=await x()}catch(q){console.error(q)}l=!1,_()}async function b(){l=!0,await S(),l=!1,_()}function D(x){l?a=()=>y(x):y(x)}function U(){l?a=b:b()}return{run:D,dispose:U}}var MW=typeof document<"u"?ae.useLayoutEffect:ae.useEffect;function yTe(l){return l!=null&&typeof l.then=="function"}function Bb(){let l=ae.useRef(!1);return ae.useEffect(()=>(l.current=!1,()=>{l.current=!0}),[]),l}function RTe(){let l=Bb();function a(h,_){return new Promise(async(S,y)=>{try{let b=await h;l.current||S(b)}catch(b){l.current?_&&_(b):y(b)}})}return ae.useCallback(a,[l])}function vie(l){let a=RTe(),[h,_]=ae.useState();return MW(()=>{yTe(l)?a(l).then(_):_(l)},[l,a]),h}function _O(l,a){let h=ae.useRef();ae.useEffect(()=>{let{run:_,dispose:S}=h.current||=yJ();return _(l),S},a)}function CTe(l,a){let h=l.split("."),_=a.split("."),S=Math.max(h.length,_.length);for(let y=0;y<S;y++){let b=parseInt(h[y]||"0"),D=parseInt(_[y]||"0");if(b>D)return 1;if(b<D)return-1}return 0}function bTe(l,a,h){let _=ae.useRef(h);MW(()=>{_.current=h},[h]),ae.useEffect(()=>{if(l)return Kd(l,a,(...S)=>{_.current&&_.current(...S)})},[a,l])}function ITe(l,a,h){let _=ae.useRef(h);MW(()=>{_.current=h},[h]),ae.useEffect(()=>{if(l)return Kd(l,a,(...S)=>{_.current&&_.current(...S)})},[a,l])}var yie=ae.createContext(null);function Rie({client:l,children:a}){return ze.jsx(yie.Provider,{value:l,children:a})}function ATe(l){let a=ae.useContext(yie);return l||a}function CE(l){let a=ATe(l);if(!a)throw new Error("Agora RTC client not found. Should be wrapped in <AgoraRTCProvider value={client} />");return a}var Cie=ae.createContext(null);function wTe({client:l,children:a}){return ze.jsx(Cie.Provider,{value:l,children:a})}function OTe(l){let a=ae.useContext(Cie);return l||a}function NTe(l){let a=CE(l),[h,_]=ae.useState(a?a.connectionState:"DISCONNECTED");return ae.useEffect(()=>{if(a){_(a.connectionState);let S;return fO([Kd(a,"connection-state-change",y=>{S?.(),y==="CONNECTED"?S=LW(()=>_(y),0):_(y)}),()=>S?.()])}else _("DISCONNECTED")},[a]),h}function aL(l){let a=CE(l),[h,_]=ae.useState(a?a.connectionState==="CONNECTED":!1);return ae.useEffect(()=>{if(a){_(a.connectionState==="CONNECTED");let S;return fO([Kd(a,"connection-state-change",y=>{S?.(),S=LW(()=>_(y==="CONNECTED"),0)}),()=>S?.()])}else _(!1)},[a]),h}function DTe(l){let a=CE(l),[h,_]=ae.useState(a?.uid);return ae.useEffect(()=>{if(a)return Kd(a,"connection-state-change",S=>{if(S==="CONNECTED")return LW(()=>_(a.uid),0);S==="DISCONNECTED"&&_(void 0)})},[a]),h}var Vu=class extends Error{rtcMethod;rtcError;name="AgoraRTCReactException";constructor(l,a){typeof a=="string"?super(a):super(a.message),this.rtcMethod=l,this.rtcError=a}log(l){console[l](this)}};function bie(l,a=!0,h){let _=CE(h),S=aL(h),y=ae.useRef(),[b,D]=ae.useState(!1),[U,x]=ae.useState(0),[q,J]=ae.useState(null),ee=Bb();return _O(async()=>{if(ee.current||(J(null),x(0),D(!1)),a&&_){try{ee.current||D(!0);let{appid:oe,channel:le,token:pe,uid:Ne}=typeof l=="function"?await l():l,Ve=await _.join(oe,le,pe,Ne);ee.current||x(Ve)}catch(oe){console.error(oe),ee.current||J(new Vu("IAgoraRTCClient.join",oe))}ee.current||D(!1);let ue=y.current||=yJ();return fO([()=>{ue.dispose()},()=>{ue.run(()=>_.unpublish(_.localTracks))},()=>{for(let oe of _.localTracks)oe.isPlaying&&oe.stop(),oe.close();ue.run(()=>_.leave())}])}},[a,h]),{data:U,isLoading:b,isConnected:S,error:q}}var A$=()=>({uplinkNetworkQuality:0,downlinkNetworkQuality:0,delay:0});function PTe(l){let a=CE(l),[h,_]=ae.useState(A$);return ae.useEffect(()=>{if(a)return Kd(a,"network-quality",S=>_({uplinkNetworkQuality:S.uplinkNetworkQuality,downlinkNetworkQuality:S.downlinkNetworkQuality,delay:a.getRTCStats().RTT??0}));_(A$())},[a]),h}var kTe=hO(pO());function Iie(l,a=!0,h){let _=CE(h),S=aL(h),y=ae.useRef([]),[b,D]=ae.useState(!1),[U,x]=ae.useState(null),q=Bb();return _O(async()=>{if(q.current||(D(!1),x(null)),!_||!S||!a)return;let J=l.filter(Boolean),ee=le=>{let pe=CTe(kTe.default.VERSION,"4.18.2")>=0;return pe||new Vu("usePublish","please check your agora-rtc-sdk-ng version in package.json, it's recommend upgrade to >= 4.18.2").log("warn"),pe?_.mode!=="live"||_.role!=="audience":!0},ue=le=>y.current.some(pe=>pe&&pe.getTrackId()===le.getTrackId()),oe=le=>ee()&&le.enabled&&a&&!ue(le);for(let le=0;le<J.length;le++){let pe=J[le];if(pe&&oe(pe)){await _.unpublish(y.current.filter(Ne=>Ne?.trackMediaType===pe.trackMediaType));try{q.current||D(!0),await _.publish(pe)}catch(Ne){console.error(Ne),q.current||x(new Vu("IAgoraRTCClient.publish",Ne))}q.current||D(!1)}}y.current=J},[S,a,_,l]),{isLoading:b,error:U}}function LTe(l){let[a,h]=ae.useState(0);return ae.useEffect(()=>{if(l)return vTe(()=>{h(l.getVolumeLevel())},1e3)},[l]),a}var MTe=hO(pO());function Aie(l=!0,a={ANS:!0,AEC:!0}){let[h,_]=ae.useState(null),[S,y]=ae.useState(!1),[b,D]=ae.useState(null),U=Bb();return _O(async()=>{if(U.current||(y(!1),D(null)),l&&!h){try{U.current||y(!0);let x=await MTe.default.createMicrophoneAudioTrack(a);U.current||_(x)}catch(x){console.error(x),U.current||D(new Vu("IAgoraRTC.createMicrophoneAudioTrack",x))}U.current||y(!1)}},[l]),{localMicrophoneTrack:h,isLoading:S,error:b}}var UTe=hO(pO());function wie(l=!0,a){let[h,_]=ae.useState(null),[S,y]=ae.useState(!1),[b,D]=ae.useState(null),U=Bb();return _O(async()=>{if(U.current||(y(!1),D(null)),l&&!h){try{U.current||y(!0);let x=await UTe.default.createCameraVideoTrack(a);U.current||_(x)}catch(x){console.error(x),U.current||D(new Vu("IAgoraRTC.createCameraVideoTrack",x))}U.current||y(!1)}},[l]),{localCameraTrack:h,isLoading:S,error:b}}function xTe(l,a){let h=CE(a),[_,S]=ae.useState([]),y=aL(),b=ae.useRef([]),[D,U]=ae.useState(!1),[x,q]=ae.useState(null),J=Bb();return _O(async()=>{if(J.current||q(null),!Array.isArray(l)||!y)return;let ee=async le=>{if(!le.audioTrack&&l.some(({uid:pe})=>le.uid===pe)){try{J.current||U(!0),await h.subscribe(le,"audio")}catch(pe){console.error(pe),J.current||q(new Vu("IAgoraRTCClient.subscribe",pe))}le.audioTrack&&!b.current.some(pe=>pe.getUserId()===le.uid)&&b.current.push(le.audioTrack),b.current=b.current.map(pe=>le.audioTrack&&pe.getUserId()===le.uid&&pe.getTrackId()!==le.audioTrack.getTrackId()?le.audioTrack:pe),J.current||(S([...b.current]),U(!1))}},ue=async le=>{if(l.some(({uid:pe})=>le.uid===pe)){J.current||(b.current=b.current.filter(pe=>pe.getUserId()!==le.uid),S([...b.current]));try{J.current||U(!0),await h.unsubscribe(le,"audio")}catch(pe){console.error(pe),J.current||q(new Vu("IAgoraRTCClient.unsubscribe",pe))}J.current||U(!1)}};l.map(le=>{!le.audioTrack&&le.hasAudio&&ee(le)});let oe=[];for(let le=0;le<b.current.length;le++){let pe=b.current[le];if(!l.some(Ne=>Ne.uid===pe.getUserId())){let Ne=h.remoteUsers.find(Ve=>Ve.uid===pe.getUserId());Ne&&oe.push({user:Ne,mediaType:"audio"}),b.current.splice(le,1),le--}}if(oe.length>0){try{J.current||U(!0),await h.massUnsubscribe(oe)}catch(le){console.error(le),J.current||q(new Vu("IAgoraRTCClient.massUnsubscribe",le))}J.current||(S(b.current.slice()),U(!1))}return fO([Kd(h,"user-published",(le,pe)=>{l.find(Ne=>Ne.uid===le.uid)&&pe==="audio"&&ee(le)}),Kd(h,"user-unpublished",(le,pe)=>{l.find(Ne=>Ne.uid===le.uid)&&pe==="audio"&&ue(le)})])},[y,h,l]),{audioTracks:_,isLoading:D,error:x}}function VTe(l,a){let h=CE(a),[_,S]=ae.useState([]),y=aL(),b=ae.useRef([]),[D,U]=ae.useState(!1),[x,q]=ae.useState(null),J=Bb();return _O(async()=>{if(J.current||q(null),!Array.isArray(l)||!y)return;let ee=async le=>{if(!le.videoTrack&&l.some(({uid:pe})=>le.uid===pe)){try{J.current||U(!0),await h.subscribe(le,"video")}catch(pe){console.error(pe),J.current||q(new Vu("IAgoraRTCClient.subscribe",pe))}le.videoTrack&&!b.current.some(pe=>pe.getUserId()===le.uid)&&b.current.push(le.videoTrack),b.current=b.current.map(pe=>le.videoTrack&&pe.getUserId()===le.uid&&pe.getTrackId()!==le.videoTrack.getTrackId()?le.videoTrack:pe),J.current||(S([...b.current]),U(!1))}},ue=async le=>{if(l.some(({uid:pe})=>le.uid===pe)){J.current||(b.current=b.current.filter(pe=>pe.getUserId()!==le.uid),S([...b.current]));try{J.current||U(!0),await h.unsubscribe(le,"video")}catch(pe){console.error(pe),J.current||q(new Vu("IAgoraRTCClient.unsubscribe",pe))}J.current||U(!1)}};l.map(le=>{!le.videoTrack&&le.hasVideo&&ee(le)});let oe=[];for(let le=0;le<b.current.length;le++){let pe=b.current[le];if(!l.some(Ne=>Ne.uid===pe.getUserId())){let Ne=h.remoteUsers.find(Ve=>Ve.uid===pe.getUserId());Ne&&oe.push({user:Ne,mediaType:"video"}),b.current.splice(le,1),le--}}if(oe.length>0){try{J.current||U(!0),await h.massUnsubscribe(oe)}catch(le){console.error(le),J.current||q(new Vu("IAgoraRTCClient.massUnsubscribe",le))}J.current||(S(b.current.slice()),U(!1))}return fO([Kd(h,"user-published",(le,pe)=>{l.find(Ne=>Ne.uid===le.uid)&&pe==="video"&&ee(le)}),Kd(h,"user-unpublished",(le,pe)=>{l.find(Ne=>Ne.uid===le.uid)&&pe==="video"&&ue(le)})])},[y,h,l]),{videoTracks:_,isLoading:D,error:x}}function k7(l,a,h){let _=CE(h),S=a==="audio"?"audioTrack":"videoTrack",[y,b]=ae.useState(l&&l[S]),D=aL(),U=ae.useRef(),[x,q]=ae.useState(!1),[J,ee]=ae.useState(null);return ae.useEffect(()=>{if(!l||!D)return;let ue=!1;ue||ee(null);let oe=a==="audio"?"hasAudio":"hasVideo",le=l.uid,pe=async(Ae,Ue)=>{if(Ae[S]&&_.remoteUsers.some(({uid:ke})=>Ae.uid===ke))try{ue||q(!0),await _.unsubscribe(Ae,Ue)}catch(ke){ue||ee(new Vu("IAgoraRTCClient.unsubscribe",ke)),console.error(ke)}ue||(b(void 0),q(!1))},Ne=async(Ae,Ue)=>{try{!Ae[S]&&_.remoteUsers.some(({uid:ke})=>Ae.uid===ke)&&(ue||q(!0),await _.subscribe(Ae,Ue)),ue||b(Ae[S])}catch(ke){ue||ee(new Vu("IAgoraRTCClient.subscribe",ke)),console.error(ke)}ue||q(!1)},Ve=U.current||=yJ();return!l[S]&&l[oe]?Ve.run(()=>Ne(l,a)):b(l[S]),fO([()=>{ue=!0,Ve.dispose()},Kd(_,"user-published",(Ae,Ue)=>{Ae.uid===le&&Ue===a&&Ve.run(()=>Ne(Ae,a))}),Kd(_,"user-unpublished",(Ae,Ue)=>{Ae.uid===le&&Ue===a&&Ve.run(()=>pe(Ae,a))})])},[D,_,l,a,S]),{track:y,isLoading:x,error:J}}function Oie(l){let a=CE(l),[h,_]=ae.useState(a?a.remoteUsers:[]);return ae.useEffect(()=>{if(a){let S=()=>_(a.remoteUsers.slice());return fO([Kd(a,"user-joined",S),Kd(a,"user-left",S),Kd(a,"user-published",S),Kd(a,"user-unpublished",S)])}},[a]),h}var FTe=hO(pO());function BTe(l=!0,a,h){let[_,S]=ae.useState(null),[y,b]=ae.useState(!1),[D,U]=ae.useState(null),x=Bb();return _O(async()=>{if(x.current||(b(!1),U(null)),l&&!_){try{x.current||b(!0);let q=await FTe.default.createScreenVideoTrack(a,h);x.current||S(q)}catch(q){console.error(q),x.current||U(new Vu("IAgoraRTC.createScreenVideoTrack",q))}x.current||b(!1)}},[l]),{screenTrack:_,isLoading:y,error:D}}function jTe(){let l=new Map,a=1500;return{onMount:h=>{let _=l.get(h);_&&(_(),l.delete(h))},onUnmount:h=>{let _=l.get(h);_&&_(),l.set(h,LW(()=>{h.isPlaying&&h.stop(),l.delete(h)},a))},dispose:()=>{for(let[h,_]of l)h.isPlaying&&h.stop(),_&&_();l.clear()}}}var RJ=ae.createContext(void 0);function GTe({children:l}){let[a]=ae.useState(jTe);return ae.useEffect(()=>a.dispose,[a]),ze.jsx(RJ.Provider,{value:a,children:l})}function CJ(l,a,h,_){let S=ae.useContext(RJ);ae.useEffect(()=>{if(l)return _&&a?l.play(_,h||void 0):l.stop(),S?(S.onMount(l),()=>S.onUnmount(l)):()=>{l.isPlaying&&l.stop()}},[l,_,a,S,h])}function bJ(l,a){let h=ae.useContext(RJ);MW(()=>{if(l)return a?l.play():l.stop(),h?(h.onMount(l),()=>h.onUnmount(l)):()=>{l.isPlaying&&l.stop()}},[l,a,h])}function Nie({track:l,play:a=!1,volume:h,disabled:_,muted:S,children:y}){let b=vie(l);return bJ(b,a),ae.useEffect(()=>{b&&h!=null&&b.setVolume(h)},[b,h]),ae.useEffect(()=>{b&&_!=null&&b.setEnabled(!_).catch(console.warn)},[_,b]),ae.useEffect(()=>{b&&S!=null&&b.setMuted(S).catch(console.warn)},[S,b]),y?ze.jsx(ze.Fragment,{children:y}):null}var Die={position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"#000"},Pie={width:"100%",height:"100%"},IJ={position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",zIndex:2},UW=(l,a)=>ae.useMemo(()=>({...l,...a}),[l,a]);function AJ({track:l,play:a,disabled:h,muted:_,style:S,videoPlayerConfig:y,...b}){let D=UW(Pie,S),[U,x]=ae.useState(null),q=vie(l);return CJ(q,a,y,U),ae.useEffect(()=>{q&&h!=null&&q.setEnabled(!h).catch(console.warn)},[h,q]),ae.useEffect(()=>{q&&_!=null&&q.setMuted(_).catch(console.warn)},[_,q]),ze.jsx("div",{...b,ref:x,style:D})}var WTe={width:"100%",height:"100%",background:"#1a1e21 center/cover no-repeat",filter:"blur(16px) brightness(0.4)"},HTe={position:"absolute",top:"50%",left:"50%",maxWidth:"50%",maxHeight:"50%",aspectRatio:"1",transform:"translate(-50%, -50%)",borderRadius:"50%",overflow:"hidden",objectFit:"cover"};function kie({cover:l}){return ze.jsx("div",{style:IJ,children:typeof l=="string"?ze.jsxs(ze.Fragment,{children:[ze.jsx("div",{style:{...WTe,backgroundImage:`url(${l})`}}),ze.jsx("img",{src:l,style:HTe})]}):l()})}function KTe({micOn:l,cameraOn:a,audioTrack:h,videoTrack:_,playAudio:S,playVideo:y,volume:b,cover:D,children:U,style:x,...q}){let J=UW(Die,x);return y=y??!!a,S=S??!!l,ze.jsxs("div",{...q,style:J,children:[ze.jsx(AJ,{disabled:!a,play:y,track:_}),ze.jsx(Nie,{disabled:!l,play:S,track:h,volume:b}),D&&!a&&ze.jsx(kie,{cover:D}),ze.jsx("div",{style:IJ,children:U})]})}function Lie({track:l,play:a=!1,playbackDeviceId:h,volume:_,children:S}){return bJ(l,a),ae.useEffect(()=>{l&&h!=null&&l.setPlaybackDevice(h).catch(console.warn)},[l,h]),ae.useEffect(()=>{l&&_!=null&&l.setVolume(_)},[l,_]),S?ze.jsx(ze.Fragment,{children:S}):null}function Mie({track:l,play:a,style:h,videoPlayerConfig:_,...S}){let y=UW(Pie,h),[b,D]=ae.useState(null);return CJ(l,a,_,b),ze.jsx("div",{...S,ref:D,style:y})}function Uie({user:l,playVideo:a,playAudio:h,playbackDeviceId:_,volume:S,cover:y,style:b,children:D,videoPlayerConfig:U,...x}){let q=UW(Die,b),{track:J}=k7(l,"video"),{track:ee}=k7(l,"audio");return a=a??l?.hasVideo,h=h??l?.hasAudio,ze.jsxs("div",{...x,style:q,children:[ze.jsx(Mie,{play:a,track:J,videoPlayerConfig:U}),ze.jsx(Lie,{play:h,playbackDeviceId:_,track:ee,volume:S}),y&&!a&&ze.jsx(kie,{cover:y}),ze.jsx("div",{style:IJ,children:D})]})}var zTe=hO(pO()),YTe=class{appType=1001;constructor(){zTe.default.setAppType(this.appType)}};new YTe;var qTe="2.5.0";gTe(Tie,hO(pO()));var XTe=STe.default;const JTe=dTe.createClient({mode:"rtc",codec:"vp8"});function QTe({appId:l,channel:a,token:h,vocalsGain:_}){return ze.jsx(Rie,{client:JTe,children:ze.jsx(ZTe,{channelName:a,AppID:l,token:h,vocalsGain:_})})}function ZTe({channelName:l,AppID:a,token:h,vocalsGain:_}){const{localMicrophoneTrack:S}=Aie(),{localCameraTrack:y}=wie(),b=Oie();return Iie([S,y]),bie({appid:a,channel:l,token:h}),mE.useEffect(()=>{S&&_&&S.setVolume(_.gain.value*100)},[S,_]),ze.jsxs("div",{style:{display:"flex",width:"100%",height:"100%"},children:[ze.jsx("div",{style:{display:"flex",flexDirection:"column",flex:1},children:b.map(D=>ze.jsx("div",{style:{flex:1},children:ze.jsx(Uie,{user:D,playVideo:!0,playAudio:!0})},D.uid))}),ze.jsx("div",{style:{position:"absolute",bottom:"20px",right:"20px",width:"200px",height:"150px",zIndex:1e3},children:ze.jsx(AJ,{track:y,play:!0,style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"10px"}})})]})}function $Te(){const[l,a]=ae.useState([]),[h,_]=ae.useState(""),[S,y]=ae.useState(50),[b,D]=ae.useState(50),[U,x]=ae.useState(null),[q,J]=ae.useState(null),ee=ae.useRef(null),ue=ae.useRef(null),oe=ae.useRef(null),le=ae.useRef(null),pe=ae.useRef(null),Ve=WEe(sTe,"chats/livestream1"),Ae="4b2f7bbd2ec047658ec7bf1963f649fa",Ue="main",ke="007eJxTYKjqrbFNDrCc7m3rlMXMyL1N/6Rj5qm3Yc85Y9ScvY6aXlFgMEkySjNPSkoxSk02MDE3M7VITTZPSjO0NDNOMzOxTEv0WXoioyGQkcGCu5iJkQECQXw2BufMgozUIgYGAJWVHQo=";ae.useEffect(()=>{const he=Kge(oTe,_e=>{J(_e)});return()=>he()},[]),ae.useEffect(()=>{ue.current=new(window.AudioContext||window.webkitAudioContext),le.current=ue.current.createGain(),pe.current=ue.current.createGain(),le.current.connect(ue.current.destination),pe.current.connect(ue.current.destination)},[]),ae.useEffect(()=>(YEe(Ve,he=>{const _e=he.val(),ye=_e?Object.values(_e):[];a(ye)}),()=>qEe(Ve)),[Ve]),ae.useEffect(()=>{ee.current?.scrollIntoView({behavior:"smooth"})},[l]),ae.useEffect(()=>{le.current&&(le.current.gain.value=S/100)},[S]),ae.useEffect(()=>{pe.current&&(pe.current.gain.value=b/100)},[b]),ae.useEffect(()=>{if(U&&ue.current){oe.current&&oe.current.stop();const he=new FileReader;he.onload=async _e=>{const ye=_e.target.result;try{const Ie=await ue.current.decodeAudioData(ye),$=ue.current.createBufferSource();$.buffer=Ie,$.connect(le.current),$.start(0),oe.current=$}catch(Ie){console.error("Error decoding audio data:",Ie)}},he.readAsArrayBuffer(U)}},[U]);const qe=he=>{he.preventDefault(),h.trim()&&q&&(HEe(Ve,{author:q.displayName||q.email,text:h,timestamp:Date.now()}),_(""))},Te=he=>{const _e=he.target.files[0];_e&&x(_e)};return ze.jsxs(mS,{sx:{display:"flex",height:"calc(100vh - 64px)",overflow:"hidden"},children:[ze.jsx(mS,{sx:{flex:1,position:"relative",background:"black"},children:ze.jsx(QTe,{appId:Ae,channel:Ue,token:ke,vocalsGain:pe.current})}),ze.jsxs(mS,{sx:{width:350,display:"flex",flexDirection:"column",borderLeft:"1px solid #333"},children:[ze.jsxs(mS,{sx:{flex:1,p:2,overflowY:"auto"},children:[ze.jsx($v,{variant:"h6",gutterBottom:!0,sx:{color:"#fff",fontWeight:"bold"},children:"Live Chat"}),l.map((he,_e)=>ze.jsxs($v,{variant:"body2",sx:{mb:1,color:"#ccc"},children:[ze.jsxs(mS,{component:"span",sx:{fontWeight:"bold",color:"#90caf9"},children:[he.author,":"]})," ",he.text]},_e)),ze.jsx("div",{ref:ee})]}),ze.jsxs(mS,{component:"form",onSubmit:qe,sx:{p:2,borderTop:"1px solid #333"},children:[ze.jsx(Ohe,{label:"Say something...",variant:"filled",fullWidth:!0,value:h,onChange:he=>_(he.target.value),sx:{"& .MuiFilledInput-root":{backgroundColor:"#333",borderRadius:"20px","&:hover":{backgroundColor:"#444"}},"& .MuiInputLabel-root":{color:"#aaa"}}}),ze.jsx(s3,{type:"submit",variant:"contained",sx:{display:"none"},children:"Send"})]}),ze.jsxs(mS,{sx:{p:2,borderTop:"1px solid #333",background:"#1e1e1e"},children:[ze.jsx($v,{variant:"h6",sx:{mb:2,color:"#fff",fontWeight:"bold"},children:"Mixing Console"}),ze.jsxs(mS,{children:[ze.jsx($v,{gutterBottom:!0,sx:{color:"#ccc"},children:"Instrumental"}),ze.jsx(ZQ,{value:S,onChange:(he,_e)=>y(_e),"aria-labelledby":"instrumental-volume-slider"}),ze.jsx($v,{gutterBottom:!0,sx:{color:"#ccc"},children:"Vocals"}),ze.jsx(ZQ,{value:b,onChange:(he,_e)=>D(_e),"aria-labelledby":"vocals-volume-slider"}),ze.jsxs(s3,{variant:"contained",component:"label",fullWidth:!0,sx:{mt:2,background:"linear-gradient(45deg, #FE6B8B 30%, #FF8E53 90%)",boxShadow:"0 3px 5px 2px rgba(255, 105, 135, .3)",borderRadius:"20px"},children:["Upload Instrumental",ze.jsx("input",{type:"file",hidden:!0,onChange:Te,accept:"audio/*"})]})]})]})]})]})}function eve(){return ze.jsx(Gle,{position:"static",sx:{background:"#1e1e1e",boxShadow:"none"},children:ze.jsxs(Che,{children:[ze.jsx($v,{variant:"h6",component:$j,to:"/",sx:{color:"#fff",textDecoration:"none",fontWeight:"bold"},children:"Rapper's Delight"}),ze.jsx("div",{style:{flexGrow:1}}),ze.jsx(s3,{color:"inherit",component:$j,to:"/",children:"Home"}),ze.jsx(s3,{color:"inherit",children:"About"})]})})}const tve=fW({palette:{mode:"dark",primary:{main:"#90caf9"},secondary:{main:"#f48fb1"},background:{default:"#121212",paper:"#1e1e1e"}},typography:{fontFamily:"Rubik, sans-serif",h1:{fontFamily:"Roboto, sans-serif"},h2:{fontFamily:"Roboto, sans-serif"},h3:{fontFamily:"Roboto, sans-serif"},h4:{fontFamily:"Roboto, sans-serif"},h5:{fontFamily:"Roboto, sans-serif"},h6:{fontFamily:"Roboto, sans-serif"}}});function nve(){return ze.jsxs(Gce,{theme:tve,children:[ze.jsx(yde,{}),ze.jsxs(ose,{children:[ze.jsx(eve,{}),ze.jsx(Ede,{sx:{mt:4},children:ze.jsxs(xre,{children:[ze.jsx(Kq,{path:"/",element:ze.jsx(Dhe,{})}),ze.jsx(Kq,{path:"/livestream/:id",element:ze.jsx($Te,{})})]})})]})]})}zie.createRoot(document.getElementById("root")).render(ze.jsx(ae.StrictMode,{children:ze.jsx(nve,{})}));
